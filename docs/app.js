/******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId]) {
/******/ 			return installedModules[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, {
/******/ 				configurable: false,
/******/ 				enumerable: true,
/******/ 				get: getter
/******/ 			});
/******/ 		}
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = 0);
/******/ })
/************************************************************************/
/******/ ([
/* 0 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
Object.defineProperty(__webpack_exports__, "__esModule", { value: true });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_bodymovin__ = __webpack_require__(1);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_bodymovin___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_bodymovin__);


var animation = __WEBPACK_IMPORTED_MODULE_0_bodymovin___default.a.loadAnimation({
  container: document.getElementById('bm'),
  renderer: 'svg',
  loop: true,
  autoplay: true,
  path: '/resources/mild_wave.json'
});
var animation2 = __WEBPACK_IMPORTED_MODULE_0_bodymovin___default.a.loadAnimation({
  container: document.getElementById('bm2'),
  renderer: 'svg',
  loop: true,
  autoplay: true,
  path: '/resources/check_mark.json'
});
var animation3 = __WEBPACK_IMPORTED_MODULE_0_bodymovin___default.a.loadAnimation({
  container: document.getElementById('bm3'),
  renderer: 'svg',
  loop: true,
  autoplay: true,
  path: '/resources/changing.json'
});
var animation4 = __WEBPACK_IMPORTED_MODULE_0_bodymovin___default.a.loadAnimation({
  container: document.getElementById('bm4'),
  renderer: 'svg',
  loop: true,
  autoplay: true,
  path: '/resources/jump_loader.json'
});

/***/ }),
/* 1 */
/***/ (function(module, exports, __webpack_require__) {

var __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_RESULT__;var window=(typeof window === "undefined")?{}:window;(function (root, factory) { if(true) { !(__WEBPACK_AMD_DEFINE_FACTORY__ = (factory),
				__WEBPACK_AMD_DEFINE_RESULT__ = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ?
				(__WEBPACK_AMD_DEFINE_FACTORY__.call(exports, __webpack_require__, exports, module)) :
				__WEBPACK_AMD_DEFINE_FACTORY__),
				__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__)); } else if(typeof module === "object" && module.exports) { module.exports = factory(); } else { root.bodymovin = factory(); } }(window, function() {var svgNS = "http://www.w3.org/2000/svg";
var subframeEnabled = false;
var expressionsPlugin;
var isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);
var cachedColors = {};
var bm_rounder = Math.round;
var bm_rnd;
var bm_pow = Math.pow;
var bm_sqrt = Math.sqrt;
var bm_abs = Math.abs;
var bm_floor = Math.floor;
var bm_max = Math.max;
var bm_min = Math.min;
var blitter = 10;

var BMMath = {};
(function(){
    var propertyNames = Object.getOwnPropertyNames(Math);
    var i, len = propertyNames.length;
    for(i=0;i<len;i+=1){
        BMMath[propertyNames[i]] = Math[propertyNames[i]];
    }
}());

function ProjectInterface(){return {}};

BMMath.random = Math.random;
BMMath.abs = function(val){
    var tOfVal = typeof val;
    if(tOfVal === 'object' && val.length){
        var absArr = Array.apply(null,{length:val.length});
        var i, len = val.length;
        for(i=0;i<len;i+=1){
            absArr[i] = Math.abs(val[i]);
        }
        return absArr;
    }
    return Math.abs(val);

}
var defaultCurveSegments = 150;
var degToRads = Math.PI/180;
var roundCorner = 0.5519;

function roundValues(flag){
    if(flag){
        bm_rnd = Math.round;
    }else{
        bm_rnd = function(val){
            return val;
        };
    }
}
roundValues(false);

function roundTo2Decimals(val){
    return Math.round(val*10000)/10000;
}

function roundTo3Decimals(val){
    return Math.round(val*100)/100;
}

function styleDiv(element){
    element.style.position = 'absolute';
    element.style.top = 0;
    element.style.left = 0;
    element.style.display = 'block';
    element.style.transformOrigin = element.style.webkitTransformOrigin = '0 0';
    element.style.backfaceVisibility  = element.style.webkitBackfaceVisibility = 'visible';
    element.style.transformStyle = element.style.webkitTransformStyle = element.style.mozTransformStyle = "preserve-3d";
}

function styleUnselectableDiv(element){
    element.style.userSelect = 'none';
    element.style.MozUserSelect = 'none';
    element.style.webkitUserSelect = 'none';
    element.style.oUserSelect = 'none';

}

function BMEnterFrameEvent(n,c,t,d){
    this.type = n;
    this.currentTime = c;
    this.totalTime = t;
    this.direction = d < 0 ? -1:1;
}

function BMCompleteEvent(n,d){
    this.type = n;
    this.direction = d < 0 ? -1:1;
}

function BMCompleteLoopEvent(n,c,t,d){
    this.type = n;
    this.currentLoop = c;
    this.totalLoops = t;
    this.direction = d < 0 ? -1:1;
}

function BMSegmentStartEvent(n,f,t){
    this.type = n;
    this.firstFrame = f;
    this.totalFrames = t;
}

function BMDestroyEvent(n,t){
    this.type = n;
    this.target = t;
}

function _addEventListener(eventName, callback){

    if (!this._cbs[eventName]){
        this._cbs[eventName] = [];
    }
    this._cbs[eventName].push(callback);

	return function() {
		this.removeEventListener(eventName, callback);
	}.bind(this);
}

function _removeEventListener(eventName,callback){

    if (!callback){
        this._cbs[eventName] = null;
    }else if(this._cbs[eventName]){
        var i = 0, len = this._cbs[eventName].length;
        while(i<len){
            if(this._cbs[eventName][i] === callback){
                this._cbs[eventName].splice(i,1);
                i -=1;
                len -= 1;
            }
            i += 1;
        }
        if(!this._cbs[eventName].length){
            this._cbs[eventName] = null;
        }
    }

}

function _triggerEvent(eventName, args){
    if (this._cbs[eventName]) {
        var len = this._cbs[eventName].length;
        for (var i = 0; i < len; i++){
            this._cbs[eventName][i](args);
        }
    }
}

function randomString(length, chars){
    if(chars === undefined){
        chars = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890';
    }
    var i;
    var result = '';
    for (i = length; i > 0; --i) result += chars[Math.round(Math.random() * (chars.length - 1))];
    return result;
}

function HSVtoRGB(h, s, v) {
    var r, g, b, i, f, p, q, t;
    if (arguments.length === 1) {
        s = h.s, v = h.v, h = h.h;
    }
    i = Math.floor(h * 6);
    f = h * 6 - i;
    p = v * (1 - s);
    q = v * (1 - f * s);
    t = v * (1 - (1 - f) * s);
    switch (i % 6) {
        case 0: r = v, g = t, b = p; break;
        case 1: r = q, g = v, b = p; break;
        case 2: r = p, g = v, b = t; break;
        case 3: r = p, g = q, b = v; break;
        case 4: r = t, g = p, b = v; break;
        case 5: r = v, g = p, b = q; break;
    }
    return [ r,
        g,
         b ];
}

function RGBtoHSV(r, g, b) {
    if (arguments.length === 1) {
        g = r.g, b = r.b, r = r.r;
    }
    var max = Math.max(r, g, b), min = Math.min(r, g, b),
        d = max - min,
        h,
        s = (max === 0 ? 0 : d / max),
        v = max / 255;

    switch (max) {
        case min: h = 0; break;
        case r: h = (g - b) + d * (g < b ? 6: 0); h /= 6 * d; break;
        case g: h = (b - r) + d * 2; h /= 6 * d; break;
        case b: h = (r - g) + d * 4; h /= 6 * d; break;
    }

    return [
         h,
         s,
         v
    ];
}

function addSaturationToRGB(color,offset){
    var hsv = RGBtoHSV(color[0]*255,color[1]*255,color[2]*255);
    hsv[1] += offset;
    if (hsv[1] > 1) {
        hsv[1] = 1;
    }
    else if (hsv[1] <= 0) {
        hsv[1] = 0;
    }
    return HSVtoRGB(hsv[0],hsv[1],hsv[2]);
}

function addBrightnessToRGB(color,offset){
    var hsv = RGBtoHSV(color[0]*255,color[1]*255,color[2]*255);
    hsv[2] += offset;
    if (hsv[2] > 1) {
        hsv[2] = 1;
    }
    else if (hsv[2] < 0) {
        hsv[2] = 0;
    }
    return HSVtoRGB(hsv[0],hsv[1],hsv[2]);
}

function addHueToRGB(color,offset) {
    var hsv = RGBtoHSV(color[0]*255,color[1]*255,color[2]*255);
    hsv[0] += offset/360;
    if (hsv[0] > 1) {
        hsv[0] -= 1;
    }
    else if (hsv[0] < 0) {
        hsv[0] += 1;
    }
    return HSVtoRGB(hsv[0],hsv[1],hsv[2]);
}

function componentToHex(c) {
    var hex = c.toString(16);
    return hex.length == 1 ? '0' + hex : hex;
}

var rgbToHex = (function(){
    var colorMap = [];
    var i;
    var hex;
    for(i=0;i<256;i+=1){
        hex = i.toString(16);
        colorMap[i] = hex.length == 1 ? '0' + hex : hex;
    }

    return function(r, g, b) {
        if(r<0){
            r = 0;
        }
        if(g<0){
            g = 0;
        }
        if(b<0){
            b = 0;
        }
        return '#' + colorMap[r] + colorMap[g] + colorMap[b];
    };
}());

function fillToRgba(hex,alpha){
    if(!cachedColors[hex]){
        var result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
        cachedColors[hex] = parseInt(result[1], 16)+','+parseInt(result[2], 16)+','+parseInt(result[3], 16);
    }
    return 'rgba('+cachedColors[hex]+','+alpha+')';
}

var fillColorToString = (function(){

    var colorMap = [];
    return function(colorArr,alpha){
        if(alpha !== undefined){
            colorArr[3] = alpha;
        }
        if(!colorMap[colorArr[0]]){
            colorMap[colorArr[0]] = {};
        }
        if(!colorMap[colorArr[0]][colorArr[1]]){
            colorMap[colorArr[0]][colorArr[1]] = {};
        }
        if(!colorMap[colorArr[0]][colorArr[1]][colorArr[2]]){
            colorMap[colorArr[0]][colorArr[1]][colorArr[2]] = {};
        }
        if(!colorMap[colorArr[0]][colorArr[1]][colorArr[2]][colorArr[3]]){
            colorMap[colorArr[0]][colorArr[1]][colorArr[2]][colorArr[3]] = 'rgba(' + colorArr.join(',')+')';
        }
        return colorMap[colorArr[0]][colorArr[1]][colorArr[2]][colorArr[3]];
    };
}());

function RenderedFrame(tr,o) {
    this.tr = tr;
    this.o = o;
}

function LetterProps(o,sw,sc,fc,m,p){
    this.o = o;
    this.sw = sw;
    this.sc = sc;
    this.fc = fc;
    this.m = m;
    this.props = p;
}

function iterateDynamicProperties(num){
    var i, len = this.dynamicProperties;
    for(i=0;i<len;i+=1){
        this.dynamicProperties[i].getValue(num);
    }
}

function reversePath(paths){
    var newI = [], newO = [], newV = [];
    var i, len, newPaths = {};
    var init = 0;
    if (paths.c) {
        newI[0] = paths.o[0];
        newO[0] = paths.i[0];
        newV[0] = paths.v[0];
        init = 1;
    }
    len = paths.i.length;
    var cnt = len - 1;

    for (i = init; i < len; i += 1) {
        newI.push(paths.o[cnt]);
        newO.push(paths.i[cnt]);
        newV.push(paths.v[cnt]);
        cnt -= 1;
    }

    newPaths.i = newI;
    newPaths.o = newO;
    newPaths.v = newV;

    return newPaths;
}
/*!
 Transformation Matrix v2.0
 (c) Epistemex 2014-2015
 www.epistemex.com
 By Ken Fyrstenberg
 Contributions by leeoniya.
 License: MIT, header required.
 */

/**
 * 2D transformation matrix object initialized with identity matrix.
 *
 * The matrix can synchronize a canvas context by supplying the context
 * as an argument, or later apply current absolute transform to an
 * existing context.
 *
 * All values are handled as floating point values.
 *
 * @param {CanvasRenderingContext2D} [context] - Optional context to sync with Matrix
 * @prop {number} a - scale x
 * @prop {number} b - shear y
 * @prop {number} c - shear x
 * @prop {number} d - scale y
 * @prop {number} e - translate x
 * @prop {number} f - translate y
 * @prop {CanvasRenderingContext2D|null} [context=null] - set or get current canvas context
 * @constructor
 */

var Matrix = (function(){

    function reset(){
        this.props[0] = 1;
        this.props[1] = 0;
        this.props[2] = 0;
        this.props[3] = 0;
        this.props[4] = 0;
        this.props[5] = 1;
        this.props[6] = 0;
        this.props[7] = 0;
        this.props[8] = 0;
        this.props[9] = 0;
        this.props[10] = 1;
        this.props[11] = 0;
        this.props[12] = 0;
        this.props[13] = 0;
        this.props[14] = 0;
        this.props[15] = 1;
        return this;
    }

    function rotate(angle) {
        if(angle === 0){
            return this;
        }
        var mCos = Math.cos(angle);
        var mSin = Math.sin(angle);
        return this._t(mCos, -mSin,  0, 0
            , mSin,  mCos, 0, 0
            , 0,  0,  1, 0
            , 0, 0, 0, 1);
    }

    function rotateX(angle){
        if(angle === 0){
            return this;
        }
        var mCos = Math.cos(angle);
        var mSin = Math.sin(angle);
        return this._t(1, 0, 0, 0
            , 0, mCos, -mSin, 0
            , 0, mSin,  mCos, 0
            , 0, 0, 0, 1);
    }

    function rotateY(angle){
        if(angle === 0){
            return this;
        }
        var mCos = Math.cos(angle);
        var mSin = Math.sin(angle);
        return this._t(mCos,  0,  mSin, 0
            , 0, 1, 0, 0
            , -mSin,  0,  mCos, 0
            , 0, 0, 0, 1);
    }

    function rotateZ(angle){
        if(angle === 0){
            return this;
        }
        var mCos = Math.cos(angle);
        var mSin = Math.sin(angle);
        return this._t(mCos, -mSin,  0, 0
            , mSin,  mCos, 0, 0
            , 0,  0,  1, 0
            , 0, 0, 0, 1);
    }

    function shear(sx,sy){
        return this._t(1, sy, sx, 1, 0, 0);
    }

    function skew(ax, ay){
        return this.shear(Math.tan(ax), Math.tan(ay));
    }

    function skewFromAxis(ax, angle){
        var mCos = Math.cos(angle);
        var mSin = Math.sin(angle);
        return this._t(mCos, mSin,  0, 0
            , -mSin,  mCos, 0, 0
            , 0,  0,  1, 0
            , 0, 0, 0, 1)
            ._t(1, 0,  0, 0
            , Math.tan(ax),  1, 0, 0
            , 0,  0,  1, 0
            , 0, 0, 0, 1)
            ._t(mCos, -mSin,  0, 0
            , mSin,  mCos, 0, 0
            , 0,  0,  1, 0
            , 0, 0, 0, 1);
        //return this._t(mCos, mSin, -mSin, mCos, 0, 0)._t(1, 0, Math.tan(ax), 1, 0, 0)._t(mCos, -mSin, mSin, mCos, 0, 0);
    }

    function scale(sx, sy, sz) {
        sz = isNaN(sz) ? 1 : sz;
        if(sx == 1 && sy == 1 && sz == 1){
            return this;
        }
        return this._t(sx, 0, 0, 0, 0, sy, 0, 0, 0, 0, sz, 0, 0, 0, 0, 1);
    }

    function setTransform(a, b, c, d, e, f, g, h, i, j, k, l, m, n, o, p) {
        this.props[0] = a;
        this.props[1] = b;
        this.props[2] = c;
        this.props[3] = d;
        this.props[4] = e;
        this.props[5] = f;
        this.props[6] = g;
        this.props[7] = h;
        this.props[8] = i;
        this.props[9] = j;
        this.props[10] = k;
        this.props[11] = l;
        this.props[12] = m;
        this.props[13] = n;
        this.props[14] = o;
        this.props[15] = p;
        return this;
    }

    function translate(tx, ty, tz) {
        tz = tz || 0;
        if(tx !== 0 || ty !== 0 || tz !== 0){
            return this._t(1,0,0,0,0,1,0,0,0,0,1,0,tx,ty,tz,1);
        }
        return this;
    }

    function transform(a2, b2, c2, d2, e2, f2, g2, h2, i2, j2, k2, l2, m2, n2, o2, p2) {

        if(a2 === 1 && b2 === 0 && c2 === 0 && d2 === 0 && e2 === 0 && f2 === 1 && g2 === 0 && h2 === 0 && i2 === 0 && j2 === 0 && k2 === 1 && l2 === 0){
            if(m2 !== 0 || n2 !== 0 || o2 !== 0){

                this.props[12] = this.props[12] * a2 + this.props[13] * e2 + this.props[14] * i2 + this.props[15] * m2 ;
                this.props[13] = this.props[12] * b2 + this.props[13] * f2 + this.props[14] * j2 + this.props[15] * n2 ;
                this.props[14] = this.props[12] * c2 + this.props[13] * g2 + this.props[14] * k2 + this.props[15] * o2 ;
                this.props[15] = this.props[12] * d2 + this.props[13] * h2 + this.props[14] * l2 + this.props[15] * p2 ;
            }
            this._identityCalculated = false;
            return this;
        }

        var a1 = this.props[0];
        var b1 = this.props[1];
        var c1 = this.props[2];
        var d1 = this.props[3];
        var e1 = this.props[4];
        var f1 = this.props[5];
        var g1 = this.props[6];
        var h1 = this.props[7];
        var i1 = this.props[8];
        var j1 = this.props[9];
        var k1 = this.props[10];
        var l1 = this.props[11];
        var m1 = this.props[12];
        var n1 = this.props[13];
        var o1 = this.props[14];
        var p1 = this.props[15];

        /* matrix order (canvas compatible):
         * ace
         * bdf
         * 001
         */
        this.props[0] = a1 * a2 + b1 * e2 + c1 * i2 + d1 * m2;
        this.props[1] = a1 * b2 + b1 * f2 + c1 * j2 + d1 * n2 ;
        this.props[2] = a1 * c2 + b1 * g2 + c1 * k2 + d1 * o2 ;
        this.props[3] = a1 * d2 + b1 * h2 + c1 * l2 + d1 * p2 ;

        this.props[4] = e1 * a2 + f1 * e2 + g1 * i2 + h1 * m2 ;
        this.props[5] = e1 * b2 + f1 * f2 + g1 * j2 + h1 * n2 ;
        this.props[6] = e1 * c2 + f1 * g2 + g1 * k2 + h1 * o2 ;
        this.props[7] = e1 * d2 + f1 * h2 + g1 * l2 + h1 * p2 ;

        this.props[8] = i1 * a2 + j1 * e2 + k1 * i2 + l1 * m2 ;
        this.props[9] = i1 * b2 + j1 * f2 + k1 * j2 + l1 * n2 ;
        this.props[10] = i1 * c2 + j1 * g2 + k1 * k2 + l1 * o2 ;
        this.props[11] = i1 * d2 + j1 * h2 + k1 * l2 + l1 * p2 ;

        this.props[12] = m1 * a2 + n1 * e2 + o1 * i2 + p1 * m2 ;
        this.props[13] = m1 * b2 + n1 * f2 + o1 * j2 + p1 * n2 ;
        this.props[14] = m1 * c2 + n1 * g2 + o1 * k2 + p1 * o2 ;
        this.props[15] = m1 * d2 + n1 * h2 + o1 * l2 + p1 * p2 ;

        this._identityCalculated = false;
        return this;
    }

    function isIdentity() {
        if(!this._identityCalculated){
            this._identity = !(this.props[0] !== 1 || this.props[1] !== 0 || this.props[2] !== 0 || this.props[3] !== 0
                || this.props[4] !== 0 || this.props[5] !== 1 || this.props[6] !== 0 || this.props[7] !== 0
                || this.props[8] !== 0 || this.props[9] !== 0 || this.props[10] !== 1 || this.props[11] !== 0
                || this.props[12] !== 0 || this.props[13] !== 0 || this.props[14] !== 0 || this.props[15] !== 1);
            this._identityCalculated = true;
        }
        return this._identity;
    }

    function clone(matr){
        var i;
        for(i=0;i<16;i+=1){
            matr.props[i] = this.props[i];
        }
    }

    function cloneFromProps(props){
        var i;
        for(i=0;i<16;i+=1){
            this.props[i] = props[i];
        }
    }

    function applyToPoint(x, y, z) {

        return {
            x: x * this.props[0] + y * this.props[4] + z * this.props[8] + this.props[12],
            y: x * this.props[1] + y * this.props[5] + z * this.props[9] + this.props[13],
            z: x * this.props[2] + y * this.props[6] + z * this.props[10] + this.props[14]
        };
        /*return {
         x: x * me.a + y * me.c + me.e,
         y: x * me.b + y * me.d + me.f
         };*/
    }
    function applyToX(x, y, z) {
        return x * this.props[0] + y * this.props[4] + z * this.props[8] + this.props[12];
    }
    function applyToY(x, y, z) {
        return x * this.props[1] + y * this.props[5] + z * this.props[9] + this.props[13];
    }
    function applyToZ(x, y, z) {
        return x * this.props[2] + y * this.props[6] + z * this.props[10] + this.props[14];
    }

    function inversePoint(pt) {
        var determinant = this.props[0] * this.props[5] - this.props[1] * this.props[4];
        var a = this.props[5]/determinant;
        var b = - this.props[1]/determinant;
        var c = - this.props[4]/determinant;
        var d = this.props[0]/determinant;
        var e = (this.props[4] * this.props[13] - this.props[5] * this.props[12])/determinant;
        var f = - (this.props[0] * this.props[13] - this.props[1] * this.props[12])/determinant;
        return [pt[0] * a + pt[1] * c + e, pt[0] * b + pt[1] * d + f, 0];
    }

    function inversePoints(pts){
        var i, len = pts.length, retPts = [];
        for(i=0;i<len;i+=1){
            retPts[i] = inversePoint(pts[i]);
        }
        return retPts;
    }

    function applyToPointArray(x,y,z,dimensions){
        if(dimensions && dimensions === 2) {
            var arr = point_pool.newPoint();
            arr[0] = x * this.props[0] + y * this.props[4] + z * this.props[8] + this.props[12]; 
            arr[1] = x * this.props[1] + y * this.props[5] + z * this.props[9] + this.props[13]; 
            return arr;    
        }
        return [x * this.props[0] + y * this.props[4] + z * this.props[8] + this.props[12],x * this.props[1] + y * this.props[5] + z * this.props[9] + this.props[13],x * this.props[2] + y * this.props[6] + z * this.props[10] + this.props[14]];
    }
    function applyToPointStringified(x, y) {
        if(this.isIdentity()) {
            return x + ',' + y;
        }
        return (bm_rnd(x * this.props[0] + y * this.props[4] + this.props[12]))+','+(bm_rnd(x * this.props[1] + y * this.props[5] + this.props[13]));
    }

    function toArray() {
        return [this.props[0],this.props[1],this.props[2],this.props[3],this.props[4],this.props[5],this.props[6],this.props[7],this.props[8],this.props[9],this.props[10],this.props[11],this.props[12],this.props[13],this.props[14],this.props[15]];
    }

    function toCSS() {
        if(isSafari){
            return "matrix3d(" + roundTo2Decimals(this.props[0]) + ',' + roundTo2Decimals(this.props[1]) + ',' + roundTo2Decimals(this.props[2]) + ',' + roundTo2Decimals(this.props[3]) + ',' + roundTo2Decimals(this.props[4]) + ',' + roundTo2Decimals(this.props[5]) + ',' + roundTo2Decimals(this.props[6]) + ',' + roundTo2Decimals(this.props[7]) + ',' + roundTo2Decimals(this.props[8]) + ',' + roundTo2Decimals(this.props[9]) + ',' + roundTo2Decimals(this.props[10]) + ',' + roundTo2Decimals(this.props[11]) + ',' + roundTo2Decimals(this.props[12]) + ',' + roundTo2Decimals(this.props[13]) + ',' + roundTo2Decimals(this.props[14]) + ',' + roundTo2Decimals(this.props[15]) + ')';
        } else {
            this.cssParts[1] = this.props.join(',');
            return this.cssParts.join('');
        }
    }

    function to2dCSS() {
        return "matrix(" + this.props[0] + ',' + this.props[1] + ',' + this.props[4] + ',' + this.props[5] + ',' + this.props[12] + ',' + this.props[13] + ")";
    }

    function toString() {
        return "" + this.toArray();
    }

    return function(){
        this.reset = reset;
        this.rotate = rotate;
        this.rotateX = rotateX;
        this.rotateY = rotateY;
        this.rotateZ = rotateZ;
        this.skew = skew;
        this.skewFromAxis = skewFromAxis;
        this.shear = shear;
        this.scale = scale;
        this.setTransform = setTransform;
        this.translate = translate;
        this.transform = transform;
        this.applyToPoint = applyToPoint;
        this.applyToX = applyToX;
        this.applyToY = applyToY;
        this.applyToZ = applyToZ;
        this.applyToPointArray = applyToPointArray;
        this.applyToPointStringified = applyToPointStringified;
        this.toArray = toArray;
        this.toCSS = toCSS;
        this.to2dCSS = to2dCSS;
        this.toString = toString;
        this.clone = clone;
        this.cloneFromProps = cloneFromProps;
        this.inversePoints = inversePoints;
        this.inversePoint = inversePoint;
        this._t = this.transform;
        this.isIdentity = isIdentity;
        this._identity = true;
        this._identityCalculated = false;

        this.props = [1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];

        this.cssParts = ['matrix3d(','',')'];
    }
}());

function Matrix() {


}

/*
 Copyright 2014 David Bau.

 Permission is hereby granted, free of charge, to any person obtaining
 a copy of this software and associated documentation files (the
 "Software"), to deal in the Software without restriction, including
 without limitation the rights to use, copy, modify, merge, publish,
 distribute, sublicense, and/or sell copies of the Software, and to
 permit persons to whom the Software is furnished to do so, subject to
 the following conditions:

 The above copyright notice and this permission notice shall be
 included in all copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.
 IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY
 CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,
 TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE
 SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

 */

(function (pool, math) {
//
// The following constants are related to IEEE 754 limits.
//
    var global = this,
        width = 256,        // each RC4 output is 0 <= x < 256
        chunks = 6,         // at least six RC4 outputs for each double
        digits = 52,        // there are 52 significant digits in a double
        rngname = 'random', // rngname: name for Math.random and Math.seedrandom
        startdenom = math.pow(width, chunks),
        significance = math.pow(2, digits),
        overflow = significance * 2,
        mask = width - 1,
        nodecrypto;         // node.js crypto module, initialized at the bottom.

//
// seedrandom()
// This is the seedrandom function described above.
//
    function seedrandom(seed, options, callback) {
        var key = [];
        options = (options == true) ? { entropy: true } : (options || {});

        // Flatten the seed string or build one from local entropy if needed.
        var shortseed = mixkey(flatten(
            options.entropy ? [seed, tostring(pool)] :
                (seed == null) ? autoseed() : seed, 3), key);

        // Use the seed to initialize an ARC4 generator.
        var arc4 = new ARC4(key);

        // This function returns a random double in [0, 1) that contains
        // randomness in every bit of the mantissa of the IEEE 754 value.
        var prng = function() {
            var n = arc4.g(chunks),             // Start with a numerator n < 2 ^ 48
                d = startdenom,                 //   and denominator d = 2 ^ 48.
                x = 0;                          //   and no 'extra last byte'.
            while (n < significance) {          // Fill up all significant digits by
                n = (n + x) * width;              //   shifting numerator and
                d *= width;                       //   denominator and generating a
                x = arc4.g(1);                    //   new least-significant-byte.
            }
            while (n >= overflow) {             // To avoid rounding up, before adding
                n /= 2;                           //   last byte, shift everything
                d /= 2;                           //   right using integer math until
                x >>>= 1;                         //   we have exactly the desired bits.
            }
            return (n + x) / d;                 // Form the number within [0, 1).
        };

        prng.int32 = function() { return arc4.g(4) | 0; }
        prng.quick = function() { return arc4.g(4) / 0x100000000; }
        prng.double = prng;

        // Mix the randomness into accumulated entropy.
        mixkey(tostring(arc4.S), pool);

        // Calling convention: what to return as a function of prng, seed, is_math.
        return (options.pass || callback ||
        function(prng, seed, is_math_call, state) {
            if (state) {
                // Load the arc4 state from the given state if it has an S array.
                if (state.S) { copy(state, arc4); }
                // Only provide the .state method if requested via options.state.
                prng.state = function() { return copy(arc4, {}); }
            }

            // If called as a method of Math (Math.seedrandom()), mutate
            // Math.random because that is how seedrandom.js has worked since v1.0.
            if (is_math_call) { math[rngname] = prng; return seed; }

            // Otherwise, it is a newer calling convention, so return the
            // prng directly.
            else return prng;
        })(
            prng,
            shortseed,
            'global' in options ? options.global : (this == math),
            options.state);
    }
    math['seed' + rngname] = seedrandom;

//
// ARC4
//
// An ARC4 implementation.  The constructor takes a key in the form of
// an array of at most (width) integers that should be 0 <= x < (width).
//
// The g(count) method returns a pseudorandom integer that concatenates
// the next (count) outputs from ARC4.  Its return value is a number x
// that is in the range 0 <= x < (width ^ count).
//
    function ARC4(key) {
        var t, keylen = key.length,
            me = this, i = 0, j = me.i = me.j = 0, s = me.S = [];

        // The empty key [] is treated as [0].
        if (!keylen) { key = [keylen++]; }

        // Set up S using the standard key scheduling algorithm.
        while (i < width) {
            s[i] = i++;
        }
        for (i = 0; i < width; i++) {
            s[i] = s[j = mask & (j + key[i % keylen] + (t = s[i]))];
            s[j] = t;
        }

        // The "g" method returns the next (count) outputs as one number.
        (me.g = function(count) {
            // Using instance members instead of closure state nearly doubles speed.
            var t, r = 0,
                i = me.i, j = me.j, s = me.S;
            while (count--) {
                t = s[i = mask & (i + 1)];
                r = r * width + s[mask & ((s[i] = s[j = mask & (j + t)]) + (s[j] = t))];
            }
            me.i = i; me.j = j;
            return r;
            // For robust unpredictability, the function call below automatically
            // discards an initial batch of values.  This is called RC4-drop[256].
            // See http://google.com/search?q=rsa+fluhrer+response&btnI
        })(width);
    }

//
// copy()
// Copies internal state of ARC4 to or from a plain object.
//
    function copy(f, t) {
        t.i = f.i;
        t.j = f.j;
        t.S = f.S.slice();
        return t;
    };

//
// flatten()
// Converts an object tree to nested arrays of strings.
//
    function flatten(obj, depth) {
        var result = [], typ = (typeof obj), prop;
        if (depth && typ == 'object') {
            for (prop in obj) {
                try { result.push(flatten(obj[prop], depth - 1)); } catch (e) {}
            }
        }
        return (result.length ? result : typ == 'string' ? obj : obj + '\0');
    }

//
// mixkey()
// Mixes a string seed into a key that is an array of integers, and
// returns a shortened string seed that is equivalent to the result key.
//
    function mixkey(seed, key) {
        var stringseed = seed + '', smear, j = 0;
        while (j < stringseed.length) {
            key[mask & j] =
                mask & ((smear ^= key[mask & j] * 19) + stringseed.charCodeAt(j++));
        }
        return tostring(key);
    }

//
// autoseed()
// Returns an object for autoseeding, using window.crypto and Node crypto
// module if available.
//
    function autoseed() {
        try {
            if (nodecrypto) { return tostring(nodecrypto.randomBytes(width)); }
            var out = new Uint8Array(width);
            (global.crypto || global.msCrypto).getRandomValues(out);
            return tostring(out);
        } catch (e) {
            var browser = global.navigator,
                plugins = browser && browser.plugins;
            return [+new Date, global, plugins, global.screen, tostring(pool)];
        }
    }

//
// tostring()
// Converts an array of charcodes to a string
//
    function tostring(a) {
        return String.fromCharCode.apply(0, a);
    }

//
// When seedrandom.js is loaded, we immediately mix a few bits
// from the built-in RNG into the entropy pool.  Because we do
// not want to interfere with deterministic PRNG state later,
// seedrandom will not call math.random on its own again after
// initialization.
//
    mixkey(math.random(), pool);

//
// Nodejs and AMD support: export the implementation as a module using
// either convention.
//

// End anonymous scope, and pass initial values.
})(
    [],     // pool: entropy pool starts empty
    BMMath    // math: package containing random, pow, and seedrandom
);
var BezierFactory = (function(){
    /**
     * BezierEasing - use bezier curve for transition easing function
     * by Gaëtan Renaudeau 2014 - 2015 – MIT License
     *
     * Credits: is based on Firefox's nsSMILKeySpline.cpp
     * Usage:
     * var spline = BezierEasing([ 0.25, 0.1, 0.25, 1.0 ])
     * spline.get(x) => returns the easing value | x must be in [0, 1] range
     *
     */

        var ob = {};
    ob.getBezierEasing = getBezierEasing;
    var beziers = {};

    function getBezierEasing(a,b,c,d,nm){
        var str = nm || ('bez_' + a+'_'+b+'_'+c+'_'+d).replace(/\./g, 'p');
        if(beziers[str]){
            return beziers[str];
        }
        var bezEasing = new BezierEasing([a,b,c,d]);
        beziers[str] = bezEasing;
        return bezEasing;
    }

// These values are established by empiricism with tests (tradeoff: performance VS precision)
    var NEWTON_ITERATIONS = 4;
    var NEWTON_MIN_SLOPE = 0.001;
    var SUBDIVISION_PRECISION = 0.0000001;
    var SUBDIVISION_MAX_ITERATIONS = 10;

    var kSplineTableSize = 11;
    var kSampleStepSize = 1.0 / (kSplineTableSize - 1.0);

    var float32ArraySupported = typeof Float32Array === "function";

    function A (aA1, aA2) { return 1.0 - 3.0 * aA2 + 3.0 * aA1; }
    function B (aA1, aA2) { return 3.0 * aA2 - 6.0 * aA1; }
    function C (aA1)      { return 3.0 * aA1; }

// Returns x(t) given t, x1, and x2, or y(t) given t, y1, and y2.
    function calcBezier (aT, aA1, aA2) {
        return ((A(aA1, aA2)*aT + B(aA1, aA2))*aT + C(aA1))*aT;
    }

// Returns dx/dt given t, x1, and x2, or dy/dt given t, y1, and y2.
    function getSlope (aT, aA1, aA2) {
        return 3.0 * A(aA1, aA2)*aT*aT + 2.0 * B(aA1, aA2) * aT + C(aA1);
    }

    function binarySubdivide (aX, aA, aB, mX1, mX2) {
        var currentX, currentT, i = 0;
        do {
            currentT = aA + (aB - aA) / 2.0;
            currentX = calcBezier(currentT, mX1, mX2) - aX;
            if (currentX > 0.0) {
                aB = currentT;
            } else {
                aA = currentT;
            }
        } while (Math.abs(currentX) > SUBDIVISION_PRECISION && ++i < SUBDIVISION_MAX_ITERATIONS);
        return currentT;
    }

    function newtonRaphsonIterate (aX, aGuessT, mX1, mX2) {
        for (var i = 0; i < NEWTON_ITERATIONS; ++i) {
            var currentSlope = getSlope(aGuessT, mX1, mX2);
            if (currentSlope === 0.0) return aGuessT;
            var currentX = calcBezier(aGuessT, mX1, mX2) - aX;
            aGuessT -= currentX / currentSlope;
        }
        return aGuessT;
    }

    /**
     * points is an array of [ mX1, mY1, mX2, mY2 ]
     */
    function BezierEasing (points) {
        this._p = points;
        this._mSampleValues = float32ArraySupported ? new Float32Array(kSplineTableSize) : new Array(kSplineTableSize);
        this._precomputed = false;

        this.get = this.get.bind(this);
    }

    BezierEasing.prototype = {

        get: function (x) {
            var mX1 = this._p[0],
                mY1 = this._p[1],
                mX2 = this._p[2],
                mY2 = this._p[3];
            if (!this._precomputed) this._precompute();
            if (mX1 === mY1 && mX2 === mY2) return x; // linear
            // Because JavaScript number are imprecise, we should guarantee the extremes are right.
            if (x === 0) return 0;
            if (x === 1) return 1;
            return calcBezier(this._getTForX(x), mY1, mY2);
        },

        // Private part

        _precompute: function () {
            var mX1 = this._p[0],
                mY1 = this._p[1],
                mX2 = this._p[2],
                mY2 = this._p[3];
            this._precomputed = true;
            if (mX1 !== mY1 || mX2 !== mY2)
                this._calcSampleValues();
        },

        _calcSampleValues: function () {
            var mX1 = this._p[0],
                mX2 = this._p[2];
            for (var i = 0; i < kSplineTableSize; ++i) {
                this._mSampleValues[i] = calcBezier(i * kSampleStepSize, mX1, mX2);
            }
        },

        /**
         * getTForX chose the fastest heuristic to determine the percentage value precisely from a given X projection.
         */
        _getTForX: function (aX) {
            var mX1 = this._p[0],
                mX2 = this._p[2],
                mSampleValues = this._mSampleValues;

            var intervalStart = 0.0;
            var currentSample = 1;
            var lastSample = kSplineTableSize - 1;

            for (; currentSample !== lastSample && mSampleValues[currentSample] <= aX; ++currentSample) {
                intervalStart += kSampleStepSize;
            }
            --currentSample;

            // Interpolate to provide an initial guess for t
            var dist = (aX - mSampleValues[currentSample]) / (mSampleValues[currentSample+1] - mSampleValues[currentSample]);
            var guessForT = intervalStart + dist * kSampleStepSize;

            var initialSlope = getSlope(guessForT, mX1, mX2);
            if (initialSlope >= NEWTON_MIN_SLOPE) {
                return newtonRaphsonIterate(aX, guessForT, mX1, mX2);
            } else if (initialSlope === 0.0) {
                return guessForT;
            } else {
                return binarySubdivide(aX, intervalStart, intervalStart + kSampleStepSize, mX1, mX2);
            }
        }
    };

    return ob;

}())


function matrixManagerFunction(){

    var mat = new Matrix();

    var returnMatrix2D = function(rX, scaleX, scaleY, tX, tY){
        return mat.reset().translate(tX,tY).rotate(rX).scale(scaleX,scaleY).toCSS();
    };

    var getMatrix = function(animData){
        return returnMatrix2D(animData.tr.r[2],animData.tr.s[0],animData.tr.s[1],animData.tr.p[0],animData.tr.p[1]);
    };

    return {
        getMatrix : getMatrix
    };

}
var MatrixManager = matrixManagerFunction;
(function () {
    var lastTime = 0;
    var vendors = ['ms', 'moz', 'webkit', 'o'];
    for(var x = 0; x < vendors.length && !window.requestAnimationFrame; ++x) {
        window.requestAnimationFrame = window[vendors[x] + 'RequestAnimationFrame'];
        window.cancelAnimationFrame = window[vendors[x] + 'CancelAnimationFrame'] || window[vendors[x] + 'CancelRequestAnimationFrame'];
    }
    if(!window.requestAnimationFrame)
        window.requestAnimationFrame = function (callback, element) {
            var currTime = new Date().getTime();
            var timeToCall = Math.max(0, 16 - (currTime - lastTime));
            var id = window.setTimeout(function () {
                    callback(currTime + timeToCall);
                },
                timeToCall);
            lastTime = currTime + timeToCall;
            return id;
        };
    if(!window.cancelAnimationFrame)
        window.cancelAnimationFrame = function (id) {
            clearTimeout(id);
        };
}());
function createElement(parent,child,params){
    if(child){
        child.prototype = Object.create(parent.prototype);
        child.prototype.constructor = child;
        child.prototype._parent = parent.prototype;
    }else{
        var instance = Object.create(parent.prototype,params);
        var getType = {};
        if(instance && getType.toString.call(instance.init) === '[object Function]'){
            instance.init();
        }
        return instance;
    }
}

function extendPrototype(source,destination){
    for (var attr in source.prototype) {
        if (source.prototype.hasOwnProperty(attr)) destination.prototype[attr] = source.prototype[attr];
    }
}
function bezFunction(){

    var easingFunctions = [];
    var math = Math;

    function pointOnLine2D(x1,y1, x2,y2, x3,y3){
        var det1 = (x1*y2) + (y1*x3) + (x2*y3) - (x3*y2) - (y3*x1) - (x2*y1);
        return det1 > -0.0001 && det1 < 0.0001;
    }

    function pointOnLine3D(x1,y1,z1, x2,y2,z2, x3,y3,z3){
        if(z1 === 0 && z2 === 0 && z3 === 0) {
            return pointOnLine2D(x1,y1, x2,y2, x3,y3);
        }
        var dist1 = Math.sqrt(Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2) + Math.pow(z2 - z1, 2));
        var dist2 = Math.sqrt(Math.pow(x3 - x1, 2) + Math.pow(y3 - y1, 2) + Math.pow(z3 - z1, 2));
        var dist3 = Math.sqrt(Math.pow(x3 - x2, 2) + Math.pow(y3 - y2, 2) + Math.pow(z3 - z2, 2));
        var diffDist;
        if(dist1 > dist2){
            if(dist1 > dist3){
                diffDist = dist1 - dist2 - dist3;
            } else {
                diffDist = dist3 - dist2 - dist1;
            }
        } else if(dist3 > dist2){
            diffDist = dist3 - dist2 - dist1;
        } else {
            diffDist = dist2 - dist1 - dist3;
        }
        return diffDist > -0.0001 && diffDist < 0.0001;
    }

    /*function getEasingCurve(aa,bb,cc,dd,encodedFuncName) {
        if(!encodedFuncName){
            encodedFuncName = ('bez_' + aa+'_'+bb+'_'+cc+'_'+dd).replace(/\./g, 'p');
        }
        if(easingFunctions[encodedFuncName]){
            return easingFunctions[encodedFuncName];
        }
        var A0, B0, C0;
        var A1, B1, C1;
        easingFunctions[encodedFuncName] = function(tt) {
            var x = tt;
            var i = 0, z;
            while (++i < 20) {
                C0 = 3 * aa;
                B0 = 3 * (cc - aa) - C0;
                A0 = 1 - C0 - B0;
                z = (x * (C0 + x * (B0 + x * A0))) - tt;
                if (bm_abs(z) < 1e-3) break;
                x -= z / (C0 + x * (2 * B0 + 3 * A0 * x));
            }
            C1 = 3 * bb;
            B1 = 3 * (dd - bb) - C1;
            A1 = 1 - C1 - B1;
            var polyB = x * (C1 + x * (B1 + x * A1));
            //return c * polyB + b;
            return polyB;
        };
        return easingFunctions[encodedFuncName];
    }*/
    var getBezierLength = (function(){

        function Segment(l,p){
            this.l = l;
            this.p = p;
        }

        return function(pt1,pt2,pt3,pt4){
            var curveSegments = defaultCurveSegments;
            var k;
            var i, len;
            var ptCoord,perc,addedLength = 0;
            var ptDistance;
            var point = [],lastPoint = [];
            var lengthData = {
                addedLength: 0,
                segments: []
            };
            len = pt3.length;
            for(k=0;k<curveSegments;k+=1){
                perc = k/(curveSegments-1);
                ptDistance = 0;
                for(i=0;i<len;i+=1){
                    ptCoord = bm_pow(1-perc,3)*pt1[i]+3*bm_pow(1-perc,2)*perc*pt3[i]+3*(1-perc)*bm_pow(perc,2)*pt4[i]+bm_pow(perc,3)*pt2[i];
                    point[i] = ptCoord;
                    if(lastPoint[i] !== null){
                        ptDistance += bm_pow(point[i] - lastPoint[i],2);
                    }
                    lastPoint[i] = point[i];
                }
                if(ptDistance){
                    ptDistance = bm_sqrt(ptDistance);
                    addedLength += ptDistance;
                }
                lengthData.segments.push(new Segment(addedLength,perc));
            }
            lengthData.addedLength = addedLength;
            return lengthData;
        };
    }());

    function BezierData(length){
        this.segmentLength = 0;
        this.points = new Array(length);
    }

    function PointData(partial,point){
        this.partialLength = partial;
        this.point = point;
    }

    var buildBezierData = (function(){

        var storedData = {};

        return function (keyData){
            var pt1 = keyData.s;
            var pt2 = keyData.e;
            var pt3 = keyData.to;
            var pt4 = keyData.ti;
            var bezierName = (pt1.join('_')+'_'+pt2.join('_')+'_'+pt3.join('_')+'_'+pt4.join('_')).replace(/\./g, 'p');
            if(storedData[bezierName]){
                keyData.bezierData = storedData[bezierName];
                return;
            }
        var curveSegments = defaultCurveSegments;
        var k, i, len;
            var ptCoord,perc,addedLength = 0;
            var ptDistance;
            var point,lastPoint = null;
            if(pt1.length === 2 && (pt1[0] != pt2[0] || pt1[1] != pt2[1]) && pointOnLine2D(pt1[0],pt1[1],pt2[0],pt2[1],pt1[0]+pt3[0],pt1[1]+pt3[1]) && pointOnLine2D(pt1[0],pt1[1],pt2[0],pt2[1],pt2[0]+pt4[0],pt2[1]+pt4[1])){
                curveSegments = 2;
            }
            var bezierData = new BezierData(curveSegments);
            len = pt3.length;
            for(k=0;k<curveSegments;k+=1){
            point = new Array(len);
                perc = k/(curveSegments-1);
                ptDistance = 0;
                for(i=0;i<len;i+=1){
                ptCoord = bm_pow(1-perc,3)*pt1[i]+3*bm_pow(1-perc,2)*perc*(pt1[i] + pt3[i])+3*(1-perc)*bm_pow(perc,2)*(pt2[i] + pt4[i])+bm_pow(perc,3)*pt2[i];
                point[i] = ptCoord;
                    if(lastPoint !== null){
                    ptDistance += bm_pow(point[i] - lastPoint[i],2);
                    }
                }
            ptDistance = bm_sqrt(ptDistance);
                addedLength += ptDistance;
                bezierData.points[k] = new PointData(ptDistance,point);
                lastPoint = point;
            }
            bezierData.segmentLength = addedLength;
            keyData.bezierData = bezierData;
            storedData[bezierName] = bezierData;

        }
    }());

    function getDistancePerc(perc,bezierData){
        var segments = bezierData.segments;
        var len = segments.length;
        var initPos = bm_floor((len-1)*perc);
        var lengthPos = perc*bezierData.addedLength;
        var lPerc = 0;
        if(lengthPos == segments[initPos].l){
            return segments[initPos].p;
        }else{
            var dir = segments[initPos].l > lengthPos ? -1 : 1;
            var flag = true;
            while(flag){
                if(segments[initPos].l <= lengthPos && segments[initPos+1].l > lengthPos){
                    lPerc = (lengthPos - segments[initPos].l)/(segments[initPos+1].l-segments[initPos].l);
                    flag = false;
                }else{
                    initPos += dir;
                }
                if(initPos < 0 || initPos >= len - 1){
                    flag = false;
                }
            }
            return segments[initPos].p + (segments[initPos+1].p - segments[initPos].p)*lPerc;
        }
    }

    function SegmentPoints(){
        this.pt1 = new Array(2);
        this.pt2 = new Array(2);
        this.pt3 = new Array(2);
        this.pt4 = new Array(2);
    }

    function getNewSegment(pt1,pt2,pt3,pt4,startPerc,endPerc, bezierData){

        var pts = new SegmentPoints();
        startPerc = startPerc < 0 ? 0 : startPerc > 1 ? 1 : startPerc;
        var t0 = getDistancePerc(startPerc,bezierData);
        endPerc = endPerc > 1 ? 1 : endPerc;
        var t1 = getDistancePerc(endPerc,bezierData);
        var i, len = pt1.length;
        var u0 = 1 - t0;
        var u1 = 1 - t1;
        //Math.round(num * 100) / 100
        for(i=0;i<len;i+=1){
            pts.pt1[i] =  Math.round((u0*u0*u0* pt1[i] + (t0*u0*u0 + u0*t0*u0 + u0*u0*t0) * pt3[i] + (t0*t0*u0 + u0*t0*t0 + t0*u0*t0)* pt4[i] + t0*t0*t0* pt2[i])* 1000) / 1000;
            pts.pt3[i] = Math.round((u0*u0*u1*pt1[i] + (t0*u0*u1 + u0*t0*u1 + u0*u0*t1)* pt3[i] + (t0*t0*u1 + u0*t0*t1 + t0*u0*t1)* pt4[i] + t0*t0*t1* pt2[i])* 1000) / 1000;
            pts.pt4[i] = Math.round((u0*u1*u1* pt1[i] + (t0*u1*u1 + u0*t1*u1 + u0*u1*t1)* pt3[i] + (t0*t1*u1 + u0*t1*t1 + t0*u1*t1)* pt4[i] + t0*t1*t1* pt2[i])* 1000) / 1000;
            pts.pt2[i] = Math.round((u1*u1*u1* pt1[i] + (t1*u1*u1 + u1*t1*u1 + u1*u1*t1)* pt3[i] + (t1*t1*u1 + u1*t1*t1 + t1*u1*t1)*pt4[i] + t1*t1*t1* pt2[i])* 1000) / 1000;
        }
        return pts;
    }

    return {
        //getEasingCurve : getEasingCurve,
        getBezierLength : getBezierLength,
        getNewSegment : getNewSegment,
        buildBezierData : buildBezierData,
        pointOnLine2D : pointOnLine2D,
        pointOnLine3D : pointOnLine3D
    };
}

var bez = bezFunction();
function dataFunctionManager(){

    //var tCanvasHelper = document.createElement('canvas').getContext('2d');

    function completeLayers(layers, comps, fontManager){
        var layerData;
        var animArray, lastFrame;
        var i, len = layers.length;
        var j, jLen, k, kLen;
        for(i=0;i<len;i+=1){
            layerData = layers[i];
            if(!('ks' in layerData) || layerData.completed){
                continue;
            }
            layerData.completed = true;
            if(layerData.tt){
                layers[i-1].td = layerData.tt;
            }
            animArray = [];
            lastFrame = -1;
            if(layerData.hasMask){
                var maskProps = layerData.masksProperties;
                jLen = maskProps.length;
                for(j=0;j<jLen;j+=1){
                    if(maskProps[j].pt.k.i){
                        convertPathsToAbsoluteValues(maskProps[j].pt.k);
                    }else{
                        kLen = maskProps[j].pt.k.length;
                        for(k=0;k<kLen;k+=1){
                            if(maskProps[j].pt.k[k].s){
                                convertPathsToAbsoluteValues(maskProps[j].pt.k[k].s[0]);
                            }
                            if(maskProps[j].pt.k[k].e){
                                convertPathsToAbsoluteValues(maskProps[j].pt.k[k].e[0]);
                            }
                        }
                    }
                }
            }
            if(layerData.ty===0){
                layerData.layers = findCompLayers(layerData.refId, comps);
                completeLayers(layerData.layers,comps, fontManager);
            }else if(layerData.ty === 4){
                completeShapes(layerData.shapes);
            }else if(layerData.ty == 5){
                completeText(layerData, fontManager);
            }
        }
    }

    function findCompLayers(id,comps){
        var i = 0, len = comps.length;
        while(i<len){
            if(comps[i].id === id){
                if(!comps[i].layers.__used) {
                    comps[i].layers.__used = true;
                    return comps[i].layers;
                }
                return JSON.parse(JSON.stringify(comps[i].layers));
            }
            i += 1;
        }
    }

    function completeShapes(arr){
        var i, len = arr.length;
        var j, jLen;
        var hasPaths = false;
        for(i=len-1;i>=0;i-=1){
            if(arr[i].ty == 'sh'){
                if(arr[i].ks.k.i){
                    convertPathsToAbsoluteValues(arr[i].ks.k);
                }else{
                    jLen = arr[i].ks.k.length;
                    for(j=0;j<jLen;j+=1){
                        if(arr[i].ks.k[j].s){
                            convertPathsToAbsoluteValues(arr[i].ks.k[j].s[0]);
                        }
                        if(arr[i].ks.k[j].e){
                            convertPathsToAbsoluteValues(arr[i].ks.k[j].e[0]);
                        }
                    }
                }
                hasPaths = true;
            }else if(arr[i].ty == 'gr'){
                completeShapes(arr[i].it);
            }
        }
        /*if(hasPaths){
            //mx: distance
            //ss: sensitivity
            //dc: decay
            arr.splice(arr.length-1,0,{
                "ty": "ms",
                "mx":20,
                "ss":10,
                 "dc":0.001,
                "maxDist":200
            });
        }*/
    }

    function convertPathsToAbsoluteValues(path){
        var i, len = path.i.length;
        for(i=0;i<len;i+=1){
            path.i[i][0] += path.v[i][0];
            path.i[i][1] += path.v[i][1];
            path.o[i][0] += path.v[i][0];
            path.o[i][1] += path.v[i][1];
        }
    }

    function checkVersion(minimum,animVersionString){
        var animVersion = animVersionString ? animVersionString.split('.') : [100,100,100];
        if(minimum[0]>animVersion[0]){
            return true;
        } else if(animVersion[0] > minimum[0]){
            return false;
        }
        if(minimum[1]>animVersion[1]){
            return true;
        } else if(animVersion[1] > minimum[1]){
            return false;
        }
        if(minimum[2]>animVersion[2]){
            return true;
        } else if(animVersion[2] > minimum[2]){
            return false;
        }
    }

    var checkText = (function(){
        var minimumVersion = [4,4,14];

        function updateTextLayer(textLayer){
            var documentData = textLayer.t.d;
            textLayer.t.d = {
                k: [
                    {
                        s:documentData,
                        t:0
                    }
                ]
            }
        }

        function iterateLayers(layers){
            var i, len = layers.length;
            for(i=0;i<len;i+=1){
                if(layers[i].ty === 5){
                    updateTextLayer(layers[i]);
                }
            }
        }

        return function (animationData){
            if(checkVersion(minimumVersion,animationData.v)){
                iterateLayers(animationData.layers);
                if(animationData.assets){
                    var i, len = animationData.assets.length;
                    for(i=0;i<len;i+=1){
                        if(animationData.assets[i].layers){
                            iterateLayers(animationData.assets[i].layers);

                        }
                    }
                }
            }
        }
    }())

    var checkChars = (function() {
        var minimumVersion = [4,7,99];
        return function (animationData){
            if(animationData.chars && !checkVersion(minimumVersion,animationData.v)){
                var i, len = animationData.chars.length, j, jLen, k, kLen;
                var pathData, paths;
                for(i = 0; i < len; i += 1) {
                    if(animationData.chars[i].data && animationData.chars[i].data.shapes) {
                        paths = animationData.chars[i].data.shapes[0].it;
                        jLen = paths.length;

                        for(j = 0; j < jLen; j += 1) {
                            pathData = paths[j].ks.k;
                            convertPathsToAbsoluteValues(paths[j].ks.k);
                        }
                    }
                }
            }
        }

    }())

    var checkColors = (function(){
        var minimumVersion = [4,1,9];

        function iterateShapes(shapes){
            var i, len = shapes.length;
            var j, jLen;
            for(i=0;i<len;i+=1){
                if(shapes[i].ty === 'gr'){
                    iterateShapes(shapes[i].it);
                }else if(shapes[i].ty === 'fl' || shapes[i].ty === 'st'){
                    if(shapes[i].c.k && shapes[i].c.k[0].i){
                        jLen = shapes[i].c.k.length;
                        for(j=0;j<jLen;j+=1){
                            if(shapes[i].c.k[j].s){
                                shapes[i].c.k[j].s[0] /= 255;
                                shapes[i].c.k[j].s[1] /= 255;
                                shapes[i].c.k[j].s[2] /= 255;
                                shapes[i].c.k[j].s[3] /= 255;
                            }
                            if(shapes[i].c.k[j].e){
                                shapes[i].c.k[j].e[0] /= 255;
                                shapes[i].c.k[j].e[1] /= 255;
                                shapes[i].c.k[j].e[2] /= 255;
                                shapes[i].c.k[j].e[3] /= 255;
                            }
                        }
                    } else {
                        shapes[i].c.k[0] /= 255;
                        shapes[i].c.k[1] /= 255;
                        shapes[i].c.k[2] /= 255;
                        shapes[i].c.k[3] /= 255;
                    }
                }
            }
        }

        function iterateLayers(layers){
            var i, len = layers.length;
            for(i=0;i<len;i+=1){
                if(layers[i].ty === 4){
                    iterateShapes(layers[i].shapes);
                }
            }
        }

        return function (animationData){
            if(checkVersion(minimumVersion,animationData.v)){
                iterateLayers(animationData.layers);
                if(animationData.assets){
                    var i, len = animationData.assets.length;
                    for(i=0;i<len;i+=1){
                        if(animationData.assets[i].layers){
                            iterateLayers(animationData.assets[i].layers);

                        }
                    }
                }
            }
        }
    }());

    var checkShapes = (function(){
        var minimumVersion = [4,4,18];



        function completeShapes(arr){
            var i, len = arr.length;
            var j, jLen;
            var hasPaths = false;
            for(i=len-1;i>=0;i-=1){
                if(arr[i].ty == 'sh'){
                    if(arr[i].ks.k.i){
                        arr[i].ks.k.c = arr[i].closed;
                    }else{
                        jLen = arr[i].ks.k.length;
                        for(j=0;j<jLen;j+=1){
                            if(arr[i].ks.k[j].s){
                                arr[i].ks.k[j].s[0].c = arr[i].closed;
                            }
                            if(arr[i].ks.k[j].e){
                                arr[i].ks.k[j].e[0].c = arr[i].closed;
                            }
                        }
                    }
                    hasPaths = true;
                }else if(arr[i].ty == 'gr'){
                    completeShapes(arr[i].it);
                }
            }
        }

        function iterateLayers(layers){
            var layerData;
            var i, len = layers.length;
            var j, jLen, k, kLen;
            for(i=0;i<len;i+=1){
                layerData = layers[i];
                if(layerData.hasMask){
                    var maskProps = layerData.masksProperties;
                    jLen = maskProps.length;
                    for(j=0;j<jLen;j+=1){
                        if(maskProps[j].pt.k.i){
                            maskProps[j].pt.k.c = maskProps[j].cl;
                        }else{
                            kLen = maskProps[j].pt.k.length;
                            for(k=0;k<kLen;k+=1){
                                if(maskProps[j].pt.k[k].s){
                                    maskProps[j].pt.k[k].s[0].c = maskProps[j].cl;
                                }
                                if(maskProps[j].pt.k[k].e){
                                    maskProps[j].pt.k[k].e[0].c = maskProps[j].cl;
                                }
                            }
                        }
                    }
                }
                if(layerData.ty === 4){
                    completeShapes(layerData.shapes);
                }
            }
        }

        return function (animationData){
            if(checkVersion(minimumVersion,animationData.v)){
                iterateLayers(animationData.layers);
                if(animationData.assets){
                    var i, len = animationData.assets.length;
                    for(i=0;i<len;i+=1){
                        if(animationData.assets[i].layers){
                            iterateLayers(animationData.assets[i].layers);

                        }
                    }
                }
            }
        }
    }());

    /*function blitPaths(path){
        var i, len = path.i.length;
        for(i=0;i<len;i+=1){
            path.i[i][0] /= blitter;
            path.i[i][1] /= blitter;
            path.o[i][0] /= blitter;
            path.o[i][1] /= blitter;
            path.v[i][0] /= blitter;
            path.v[i][1] /= blitter;
        }
    }

    function blitShapes(arr){
        var i, len = arr.length;
        var j, jLen;
        var hasPaths = false;
        for(i=len-1;i>=0;i-=1){
            if(arr[i].ty == 'sh'){
                if(arr[i].ks.k.i){
                    blitPaths(arr[i].ks.k);
                }else{
                    jLen = arr[i].ks.k.length;
                    for(j=0;j<jLen;j+=1){
                        if(arr[i].ks.k[j].s){
                            blitPaths(arr[i].ks.k[j].s[0]);
                        }
                        if(arr[i].ks.k[j].e){
                            blitPaths(arr[i].ks.k[j].e[0]);
                        }
                    }
                }
                hasPaths = true;
            }else if(arr[i].ty == 'gr'){
                blitShapes(arr[i].it);
            }else if(arr[i].ty == 'rc'){
                blitProperty(arr[i].p);
                blitProperty(arr[i].s);
            }else if(arr[i].ty == 'st'){
                blitProperty(arr[i].w);
            }else if(arr[i].ty == 'tr'){
                blitProperty(arr[i].p);
                blitProperty(arr[i].sk);
                blitProperty(arr[i].a);
            }else if(arr[i].ty == 'el'){
                blitProperty(arr[i].p);
                blitProperty(arr[i].s);
            }else if(arr[i].ty == 'rd'){
                blitProperty(arr[i].r);
            }else{

                //console.log(arr[i].ty );
            }
        }
    }

    function blitText(data, fontManager){

    }

    function blitValue(val){
        if(typeof(val) === 'number'){
            val /= blitter;
        } else {
            var i = val.length-1;
            while(i>=0){
                val[i] /= blitter;
                i-=1;
            }
        }
        return val;
    }

    function blitProperty(data){
        if(!data.k.length){
            data.k = blitValue(data.k);
        }else if(typeof(data.k[0]) === 'number'){
            data.k = blitValue(data.k);
        } else {
            var i, len = data.k.length;
            for(i=0;i<len;i+=1){
                if(data.k[i].s){
                    //console.log('pre S: ', data.k[i].s);
                    data.k[i].s = blitValue(data.k[i].s);
                    //console.log('post S: ', data.k[i].s);
                }
                if(data.k[i].e){
                    //console.log('pre E: ', data.k[i].e);
                    data.k[i].e = blitValue(data.k[i].e);
                    //console.log('post E: ', data.k[i].e);
                }
            }
        }
    }

    function blitLayers(layers,comps, fontManager){
        var layerData;
        var animArray, lastFrame;
        var i, len = layers.length;
        var j, jLen, k, kLen;
        for(i=0;i<len;i+=1){
            layerData = layers[i];
            if(!('ks' in layerData)){
                continue;
            }
            blitProperty(layerData.ks.a);
            blitProperty(layerData.ks.p);
            layerData.completed = true;
            if(layerData.tt){
                layers[i-1].td = layerData.tt;
            }
            animArray = [];
            lastFrame = -1;
            if(layerData.hasMask){
                var maskProps = layerData.masksProperties;
                jLen = maskProps.length;
                for(j=0;j<jLen;j+=1){
                    if(maskProps[j].pt.k.i){
                        blitPaths(maskProps[j].pt.k);
                    }else{
                        kLen = maskProps[j].pt.k.length;
                        for(k=0;k<kLen;k+=1){
                            if(maskProps[j].pt.k[k].s){
                                blitPaths(maskProps[j].pt.k[k].s[0]);
                            }
                            if(maskProps[j].pt.k[k].e){
                                blitPaths(maskProps[j].pt.k[k].e[0]);
                            }
                        }
                    }
                }
            }
            if(layerData.ty===0){
                layerData.w = Math.round(layerData.w/blitter);
                layerData.h = Math.round(layerData.h/blitter);
                blitLayers(layerData.layers,comps, fontManager);
            }else if(layerData.ty === 4){
                blitShapes(layerData.shapes);
            }else if(layerData.ty == 5){
                blitText(layerData, fontManager);
            }else if(layerData.ty == 1){
                layerData.sh /= blitter;
                layerData.sw /= blitter;
            } else {
            }
        }
    }

    function blitAnimation(animationData,comps, fontManager){
        blitLayers(animationData.layers,comps, fontManager);
    }*/

    function completeData(animationData, fontManager){
        if(animationData.__complete){
            return;
        }
        checkColors(animationData);
        checkText(animationData);
        checkChars(animationData);
        checkShapes(animationData);
        completeLayers(animationData.layers, animationData.assets, fontManager);
        animationData.__complete = true;
        //blitAnimation(animationData, animationData.assets, fontManager);
    }

    function completeText(data, fontManager){
        var letters;
        var keys = data.t.d.k;
        var k, kLen = keys.length;
        for(k=0;k<kLen;k+=1){
            var documentData = data.t.d.k[k].s;
            letters = [];
            var i, len;
            var newLineFlag, index = 0, val;
            var anchorGrouping = data.t.m.g;
            var currentSize = 0, currentPos = 0, currentLine = 0, lineWidths = [];
            var lineWidth = 0;
            var maxLineWidth = 0;
            var j, jLen;
            var fontData = fontManager.getFontByName(documentData.f);
            var charData, cLength = 0;
            var styles = fontData.fStyle.split(' ');

            var fWeight = 'normal', fStyle = 'normal';
            len = styles.length;
            for(i=0;i<len;i+=1){
                if (styles[i].toLowerCase() === 'italic') {
                    fStyle = 'italic';
                }else if (styles[i].toLowerCase() === 'bold') {
                    fWeight = '700';
                } else if (styles[i].toLowerCase() === 'black') {
                    fWeight = '900';
                } else if (styles[i].toLowerCase() === 'medium') {
                    fWeight = '500';
                } else if (styles[i].toLowerCase() === 'regular' || styles[i].toLowerCase() === 'normal') {
                    fWeight = '400';
                } else if (styles[i].toLowerCase() === 'light' || styles[i].toLowerCase() === 'thin') {
                    fWeight = '200';
                }
            }
            documentData.fWeight = fWeight;
            documentData.fStyle = fStyle;
            len = documentData.t.length;
            if(documentData.sz){
                var boxWidth = documentData.sz[0];
                var lastSpaceIndex = -1;
                for(i=0;i<len;i+=1){
                    newLineFlag = false;
                    if(documentData.t.charAt(i) === ' '){
                        lastSpaceIndex = i;
                    }else if(documentData.t.charCodeAt(i) === 13){
                        lineWidth = 0;
                        newLineFlag = true;
                    }
                    if(fontManager.chars){
                        charData = fontManager.getCharData(documentData.t.charAt(i), fontData.fStyle, fontData.fFamily);
                        cLength = newLineFlag ? 0 : charData.w*documentData.s/100;
                    }else{
                        //tCanvasHelper.font = documentData.s + 'px '+ fontData.fFamily;
                        cLength = fontManager.measureText(documentData.t.charAt(i), documentData.f, documentData.s);
                    }
                    if(lineWidth + cLength > boxWidth){
                        if(lastSpaceIndex === -1){
                            //i -= 1;
                            documentData.t = documentData.t.substr(0,i) + "\r" + documentData.t.substr(i);
                            len += 1;
                        } else {
                            i = lastSpaceIndex;
                            documentData.t = documentData.t.substr(0,i) + "\r" + documentData.t.substr(i+1);
                        }
                        lastSpaceIndex = -1;
                        lineWidth = 0;
                    }else {
                        lineWidth += cLength;
                    }
                }
                len = documentData.t.length;
            }
            lineWidth = 0;
            cLength = 0;
            for (i = 0;i < len ;i += 1) {
                newLineFlag = false;
                if(documentData.t.charAt(i) === ' '){
                    val = '\u00A0';
                }else if(documentData.t.charCodeAt(i) === 13){
                    lineWidths.push(lineWidth);
                    maxLineWidth = lineWidth > maxLineWidth ? lineWidth : maxLineWidth;
                    lineWidth = 0;
                    val = '';
                    newLineFlag = true;
                    currentLine += 1;
                }else{
                    val = documentData.t.charAt(i);
                }
                if(fontManager.chars){
                    charData = fontManager.getCharData(documentData.t.charAt(i), fontData.fStyle, fontManager.getFontByName(documentData.f).fFamily);
                    cLength = newLineFlag ? 0 : charData.w*documentData.s/100;
                }else{
                    //var charWidth = fontManager.measureText(val, documentData.f, documentData.s);
                    //tCanvasHelper.font = documentData.s + 'px '+ fontManager.getFontByName(documentData.f).fFamily;
                    cLength = fontManager.measureText(val, documentData.f, documentData.s);
                }

                //
                lineWidth += cLength;
                letters.push({l:cLength,an:cLength,add:currentSize,n:newLineFlag, anIndexes:[], val: val, line: currentLine});
                if(anchorGrouping == 2){
                    currentSize += cLength;
                    if(val == '' || val == '\u00A0' || i == len - 1){
                        if(val == '' || val == '\u00A0'){
                            currentSize -= cLength;
                        }
                        while(currentPos<=i){
                            letters[currentPos].an = currentSize;
                            letters[currentPos].ind = index;
                            letters[currentPos].extra = cLength;
                            currentPos += 1;
                        }
                        index += 1;
                        currentSize = 0;
                    }
                }else if(anchorGrouping == 3){
                    currentSize += cLength;
                    if(val == '' || i == len - 1){
                        if(val == ''){
                            currentSize -= cLength;
                        }
                        while(currentPos<=i){
                            letters[currentPos].an = currentSize;
                            letters[currentPos].ind = index;
                            letters[currentPos].extra = cLength;
                            currentPos += 1;
                        }
                        currentSize = 0;
                        index += 1;
                    }
                }else{
                    letters[index].ind = index;
                    letters[index].extra = 0;
                    index += 1;
                }
            }
            documentData.l = letters;
            maxLineWidth = lineWidth > maxLineWidth ? lineWidth : maxLineWidth;
            lineWidths.push(lineWidth);
            if(documentData.sz){
                documentData.boxWidth = documentData.sz[0];
                documentData.justifyOffset = 0;
            }else{
                documentData.boxWidth = maxLineWidth;
                switch(documentData.j){
                    case 1:
                        documentData.justifyOffset = - documentData.boxWidth;
                        break;
                    case 2:
                        documentData.justifyOffset = - documentData.boxWidth/2;
                        break;
                    default:
                        documentData.justifyOffset = 0;
                }
            }
            documentData.lineWidths = lineWidths;

            var animators = data.t.a;
            jLen = animators.length;
            var based, ind, indexes = [];
            for(j=0;j<jLen;j+=1){
                if(animators[j].a.sc){
                    documentData.strokeColorAnim = true;
                }
                if(animators[j].a.sw){
                    documentData.strokeWidthAnim = true;
                }
                if(animators[j].a.fc || animators[j].a.fh || animators[j].a.fs || animators[j].a.fb){
                    documentData.fillColorAnim = true;
                }
                ind = 0;
                based = animators[j].s.b;
                for(i=0;i<len;i+=1){
                    letters[i].anIndexes[j] = ind;
                    if((based == 1 && letters[i].val != '') || (based == 2 && letters[i].val != '' && letters[i].val != '\u00A0') || (based == 3 && (letters[i].n || letters[i].val == '\u00A0' || i == len - 1)) || (based == 4 && (letters[i].n || i == len - 1))){
                        if(animators[j].s.rn === 1){
                            indexes.push(ind);
                        }
                        ind += 1;
                    }
                }
                data.t.a[j].s.totalChars = ind;
                var currentInd = -1, newInd;
                if(animators[j].s.rn === 1){
                    for(i = 0; i < len; i += 1){
                        if(currentInd != letters[i].anIndexes[j]){
                            currentInd = letters[i].anIndexes[j];
                            newInd = indexes.splice(Math.floor(Math.random()*indexes.length),1)[0];
                        }
                        letters[i].anIndexes[j] = newInd;
                    }
                }
            }
            if(jLen === 0 && !('m' in data.t.p)){
                data.singleShape = true;
            }
            documentData.yOffset = documentData.lh || documentData.s*1.2;
            documentData.ls = documentData.ls || 0;
            documentData.ascent = fontData.ascent*documentData.s/100;
        }

    }

    var moduleOb = {};
    moduleOb.completeData = completeData;

    return moduleOb;
}

var dataManager = dataFunctionManager();
var FontManager = (function(){

    var maxWaitingTime = 5000;

    function setUpNode(font, family){
        var parentNode = document.createElement('span');
        parentNode.style.fontFamily    = family;
        var node = document.createElement('span');
        // Characters that vary significantly among different fonts
        node.innerHTML = 'giItT1WQy@!-/#';
        // Visible - so we can measure it - but not on the screen
        parentNode.style.position      = 'absolute';
        parentNode.style.left          = '-10000px';
        parentNode.style.top           = '-10000px';
        // Large font size makes even subtle changes obvious
        parentNode.style.fontSize      = '300px';
        // Reset any font properties
        parentNode.style.fontVariant   = 'normal';
        parentNode.style.fontStyle     = 'normal';
        parentNode.style.fontWeight    = 'normal';
        parentNode.style.letterSpacing = '0';
        parentNode.appendChild(node);
        document.body.appendChild(parentNode);

        // Remember width with no applied web font
        var width = node.offsetWidth;
        node.style.fontFamily = font + ', '+family;
        return {node:node, w:width, parent:parentNode};
    }

    function checkLoadedFonts() {
        var i, len = this.fonts.length;
        var node, w;
        var loadedCount = len;
        for(i=0;i<len; i+= 1){
            if(this.fonts[i].loaded){
                loadedCount -= 1;
                continue;
            }
            if(this.fonts[i].fOrigin === 't' || this.fonts[i].origin === 2){
                if(window.Typekit && window.Typekit.load && this.typekitLoaded === 0){
                    this.typekitLoaded = 1;
                    try{window.Typekit.load({
                        async: true,
                        active: function() {
                            this.typekitLoaded = 2;
                        }.bind(this)
                    });}catch(e){}
                }
                if(this.typekitLoaded === 2) {
                    this.fonts[i].loaded = true;
                }
            } else if(this.fonts[i].fOrigin === 'n' || this.fonts[i].origin === 0){
                this.fonts[i].loaded = true;
            } else{
                node = this.fonts[i].monoCase.node;
                w = this.fonts[i].monoCase.w;
                if(node.offsetWidth !== w){
                    loadedCount -= 1;
                    this.fonts[i].loaded = true;
                }else{
                    node = this.fonts[i].sansCase.node;
                    w = this.fonts[i].sansCase.w;
                    if(node.offsetWidth !== w){
                        loadedCount -= 1;
                        this.fonts[i].loaded = true;
                    }
                }
                if(this.fonts[i].loaded){
                    this.fonts[i].sansCase.parent.parentNode.removeChild(this.fonts[i].sansCase.parent);
                    this.fonts[i].monoCase.parent.parentNode.removeChild(this.fonts[i].monoCase.parent);
                }
            }
        }

        if(loadedCount !== 0 && Date.now() - this.initTime < maxWaitingTime){
            setTimeout(checkLoadedFonts.bind(this),20);
        }else{
            setTimeout(function(){this.loaded = true;}.bind(this),0);

        }
    };

    function createHelper(def, fontData){
        var tHelper = document.createElementNS(svgNS,'text');
        tHelper.style.fontSize = '100px';
        tHelper.style.fontFamily = fontData.fFamily;
        tHelper.textContent = '1';
        if(fontData.fClass){
            tHelper.style.fontFamily = 'inherit';
            tHelper.className = fontData.fClass;
        } else {
            tHelper.style.fontFamily = fontData.fFamily;
        }
        def.appendChild(tHelper);
        var tCanvasHelper = document.createElement('canvas').getContext('2d');
        tCanvasHelper.font = '100px '+ fontData.fFamily;
        return tCanvasHelper;
        return tHelper;
    }

    function addFonts(fontData, defs){
        if(!fontData){
            this.loaded = true;
            return;
        }
        if(this.chars){
            this.loaded = true;
            this.fonts = fontData.list;
            return;
        }

        var fontArr = fontData.list;
        var i, len = fontArr.length;
        for(i=0; i<len; i+= 1){
            fontArr[i].loaded = false;
            fontArr[i].monoCase = setUpNode(fontArr[i].fFamily,'monospace');
            fontArr[i].sansCase = setUpNode(fontArr[i].fFamily,'sans-serif');
            if(!fontArr[i].fPath) {
                fontArr[i].loaded = true;
            }else if(fontArr[i].fOrigin === 'p' || fontArr[i].origin === 3){
                var s = document.createElement('style');
                s.type = "text/css";
                s.innerHTML = "@font-face {" + "font-family: "+fontArr[i].fFamily+"; font-style: normal; src: url('"+fontArr[i].fPath+"');}";
                defs.appendChild(s);
            } else if(fontArr[i].fOrigin === 'g' || fontArr[i].origin === 1){
                //<link href='https://fonts.googleapis.com/css?family=Montserrat' rel='stylesheet' type='text/css'>
                var l = document.createElement('link');
                l.type = "text/css";
                l.rel = "stylesheet";
                l.href = fontArr[i].fPath;
                defs.appendChild(l);
            } else if(fontArr[i].fOrigin === 't' || fontArr[i].origin === 2){
                //<link href='https://fonts.googleapis.com/css?family=Montserrat' rel='stylesheet' type='text/css'>
                var sc = document.createElement('script');
                sc.setAttribute('src',fontArr[i].fPath);
                defs.appendChild(sc);
            }
            fontArr[i].helper = createHelper(defs,fontArr[i]);
            this.fonts.push(fontArr[i]);
        }
        checkLoadedFonts.bind(this)();
    }

    function addChars(chars){
        if(!chars){
            return;
        }
        if(!this.chars){
            this.chars = [];
        }
        var i, len = chars.length;
        var j, jLen = this.chars.length, found;
        for(i=0;i<len;i+=1){
            j = 0;
            found = false;
            while(j<jLen){
                if(this.chars[j].style === chars[i].style && this.chars[j].fFamily === chars[i].fFamily && this.chars[j].ch === chars[i].ch){
                    found = true;
                }
                j += 1;
            }
            if(!found){
                this.chars.push(chars[i]);
                jLen += 1;
            }
        }
    }

    function getCharData(char, style, font){
        var i = 0, len = this.chars.length;
        while( i < len) {
            if(this.chars[i].ch === char && this.chars[i].style === style && this.chars[i].fFamily === font){
                return this.chars[i];
            }
            i+= 1;
        }
    }

    function measureText(char, fontName, size){
        var fontData = this.getFontByName(fontName);
        var tHelper = fontData.helper;
        //tHelper.textContent = char;
        return tHelper.measureText(char).width*size/100;
        //return tHelper.getComputedTextLength()*size/100;
    }

    function getFontByName(name){
        var i = 0, len = this.fonts.length;
        while(i<len){
            if(this.fonts[i].fName === name) {
                return this.fonts[i];
            }
            i += 1;
        }
        return 'sans-serif';
    }

    var Font = function(){
        this.fonts = [];
        this.chars = null;
        this.typekitLoaded = 0;
        this.loaded = false;
        this.initTime = Date.now();
    };
    Font.prototype.addChars = addChars;
    Font.prototype.addFonts = addFonts;
    Font.prototype.getCharData = getCharData;
    Font.prototype.getFontByName = getFontByName;
    Font.prototype.measureText = measureText;

    return Font;

}());
var PropertyFactory = (function(){

    var initFrame = -999999;

    function getValue(){
        if(this.elem.globalData.frameId === this.frameId){
            return;
        }
        this.mdf = false;
        var frameNum = this.comp.renderedFrame - this.offsetTime;
        if(!(frameNum === this.lastFrame || (this.lastFrame !== initFrame && ((this.lastFrame >= this.keyframes[this.keyframes.length- 1].t-this.offsetTime && frameNum >= this.keyframes[this.keyframes.length- 1].t-this.offsetTime) || (this.lastFrame < this.keyframes[0].t-this.offsetTime && frameNum < this.keyframes[0].t-this.offsetTime))))){
            var i = this.lastFrame < frameNum ? this._lastIndex : 0;
            var len = this.keyframes.length- 1,flag = true;
            var keyData, nextKeyData;

            while(flag){
                keyData = this.keyframes[i];
                nextKeyData = this.keyframes[i+1];
                if(i == len-1 && frameNum >= nextKeyData.t - this.offsetTime){
                    if(keyData.h){
                        keyData = nextKeyData;
                    }
                    break;
                }
                if((nextKeyData.t - this.offsetTime) > frameNum){
                    break;
                }
                if(i < len - 1){
                    i += 1;
                }else{
                    flag = false;
                }
            }

            this._lastIndex = i;

            var k, kLen,perc,jLen, j, fnc;
            if(keyData.to){

                if(!keyData.bezierData){
                    bez.buildBezierData(keyData);
                }
                var bezierData = keyData.bezierData;
                if(frameNum >= nextKeyData.t-this.offsetTime || frameNum < keyData.t-this.offsetTime){
                    var ind = frameNum >= nextKeyData.t-this.offsetTime ? bezierData.points.length - 1 : 0;
                    kLen = bezierData.points[ind].point.length;
                    for(k = 0; k < kLen; k += 1){
                        this.pv[k] = bezierData.points[ind].point[k];
                        this.v[k] = this.mult ? this.pv[k]*this.mult : this.pv[k];
                        if(this.lastPValue[k] !== this.pv[k]) {
                            this.mdf = true;
                            this.lastPValue[k] = this.pv[k];
                        }
                    }
                    this._lastBezierData = null;
                }else{
                    if(keyData.__fnct){
                        fnc = keyData.__fnct;
                    }else{
                        fnc = BezierFactory.getBezierEasing(keyData.o.x,keyData.o.y,keyData.i.x,keyData.i.y,keyData.n).get;
                        keyData.__fnct = fnc;
                    }
                    perc = fnc((frameNum-(keyData.t-this.offsetTime))/((nextKeyData.t-this.offsetTime)-(keyData.t-this.offsetTime)));
                    var distanceInLine = bezierData.segmentLength*perc;

                    var segmentPerc;
                    var addedLength =  (this.lastFrame < frameNum && this._lastBezierData === bezierData) ? this._lastAddedLength : 0;
                    j =  (this.lastFrame < frameNum && this._lastBezierData === bezierData) ? this._lastPoint : 0;
                    flag = true;
                    jLen = bezierData.points.length;
                    while(flag){
                        addedLength +=bezierData.points[j].partialLength;
                        if(distanceInLine === 0 || perc === 0 || j == bezierData.points.length - 1){
                            kLen = bezierData.points[j].point.length;
                            for(k=0;k<kLen;k+=1){
                                this.pv[k] = bezierData.points[j].point[k];
                                this.v[k] = this.mult ? this.pv[k]*this.mult : this.pv[k];
                                if(this.lastPValue[k] !== this.pv[k]) {
                                    this.mdf = true;
                                    this.lastPValue[k] = this.pv[k];
                                }
                            }
                            break;
                        }else if(distanceInLine >= addedLength && distanceInLine < addedLength + bezierData.points[j+1].partialLength){
                            segmentPerc = (distanceInLine-addedLength)/(bezierData.points[j+1].partialLength);
                            kLen = bezierData.points[j].point.length;
                            for(k=0;k<kLen;k+=1){
                                this.pv[k] = bezierData.points[j].point[k] + (bezierData.points[j+1].point[k] - bezierData.points[j].point[k])*segmentPerc;
                                this.v[k] = this.mult ? this.pv[k] * this.mult : this.pv[k];
                                if(this.lastPValue[k] !== this.pv[k]) {
                                    this.mdf = true;
                                    this.lastPValue[k] = this.pv[k];
                                }
                            }
                            break;
                        }
                        if(j < jLen - 1){
                            j += 1;
                        }else{
                            flag = false;
                        }
                    }
                    this._lastPoint = j;
                    this._lastAddedLength = addedLength - bezierData.points[j].partialLength;
                    this._lastBezierData = bezierData;
                }
            }else{
                var outX,outY,inX,inY, keyValue;
                len = keyData.s.length;
                for(i=0;i<len;i+=1){
                    if(keyData.h !== 1){
                        if(frameNum >= nextKeyData.t-this.offsetTime){
                            perc = 1;
                        }else if(frameNum < keyData.t-this.offsetTime){
                            perc = 0;
                        }else{
                            if(keyData.o.x instanceof Array){
                                if(!keyData.__fnct){
                                    keyData.__fnct = [];
                                }
                                if (!keyData.__fnct[i]) {
                                    outX = keyData.o.x[i] || keyData.o.x[0];
                                    outY = keyData.o.y[i] || keyData.o.y[0];
                                    inX = keyData.i.x[i] || keyData.i.x[0];
                                    inY = keyData.i.y[i] || keyData.i.y[0];
                                    fnc = BezierFactory.getBezierEasing(outX,outY,inX,inY).get;
                                    keyData.__fnct[i] = fnc;
                                } else {
                                    fnc = keyData.__fnct[i];
                                }
                            } else {
                                if (!keyData.__fnct) {
                                    outX = keyData.o.x;
                                    outY = keyData.o.y;
                                    inX = keyData.i.x;
                                    inY = keyData.i.y;
                                    fnc = BezierFactory.getBezierEasing(outX,outY,inX,inY).get;
                                    keyData.__fnct = fnc;
                                } else{
                                    fnc = keyData.__fnct;
                                }
                            }
                            perc = fnc((frameNum-(keyData.t-this.offsetTime))/((nextKeyData.t-this.offsetTime)-(keyData.t-this.offsetTime)));
                        }
                    }
                    if(this.sh && keyData.h !== 1){
                        var initP = keyData.s[i];
                        var endP = keyData.e[i];
                        if(initP-endP < -180){
                            initP += 360;
                        } else if(initP-endP > 180){
                            initP -= 360;
                        }
                        keyValue = initP+(endP-initP)*perc;
                    } else {
                        keyValue = keyData.h === 1 ? keyData.s[i] : keyData.s[i]+(keyData.e[i]-keyData.s[i])*perc;
                    }
                    if(len === 1){
                        this.v = this.mult ? keyValue*this.mult : keyValue;
                        this.pv = keyValue;
                        if(this.lastPValue != this.pv){
                            this.mdf = true;
                            this.lastPValue = this.pv;
                        }
                    }else{
                        this.v[i] = this.mult ? keyValue*this.mult : keyValue;
                        this.pv[i] = keyValue;
                        if(this.lastPValue[i] !== this.pv[i]){
                            this.mdf = true;
                            this.lastPValue[i] = this.pv[i];
                        }
                    }
                }
            }
        }
        this.lastFrame = frameNum;
        this.frameId = this.elem.globalData.frameId;
    }

    function getNoValue(){}

    function ValueProperty(elem,data, mult){
        this.mult = mult;
        this.v = mult ? data.k * mult : data.k;
        this.pv = data.k;
        this.mdf = false;
        this.comp = elem.comp;
        this.k = false;
        this.kf = false;
        this.vel = 0;
        this.getValue = getNoValue;
    }

    function MultiDimensionalProperty(elem,data, mult){
        this.mult = mult;
        this.data = data;
        this.mdf = false;
        this.comp = elem.comp;
        this.k = false;
        this.kf = false;
        this.frameId = -1;
        this.v = Array.apply(null, {length:data.k.length});
        this.pv = Array.apply(null, {length:data.k.length});
        this.lastValue = Array.apply(null, {length:data.k.length});
        var arr = Array.apply(null, {length:data.k.length});
        this.vel = arr.map(function () { return 0 });
        var i, len = data.k.length;
        for(i = 0;i<len;i+=1){
            this.v[i] = mult ? data.k[i] * mult : data.k[i];
            this.pv[i] = data.k[i];
        }
        this.getValue = getNoValue;
    }

    function KeyframedValueProperty(elem, data, mult){
        this.keyframes = data.k;
        this.offsetTime = elem.data.st;
        this.lastValue = -99999;
        this.lastPValue = -99999;
        this.frameId = -1;
        this._lastIndex = 0;
        this.k = true;
        this.kf = true;
        this.data = data;
        this.mult = mult;
        this.elem = elem;
        this.comp = elem.comp;
        this.lastFrame = initFrame;
        this.v = mult ? data.k[0].s[0]*mult : data.k[0].s[0];
        this.pv = data.k[0].s[0];
        this.getValue = getValue;
    }

    function KeyframedMultidimensionalProperty(elem, data, mult){
        var i, len = data.k.length;
        var s, e,to,ti;
        for(i=0;i<len-1;i+=1){
            if(data.k[i].to && data.k[i].s && data.k[i].e ){
                s = data.k[i].s;
                e = data.k[i].e;
                to = data.k[i].to;
                ti = data.k[i].ti;
                if((s.length === 2 && !(s[0] === e[0] && s[1] === e[1]) && bez.pointOnLine2D(s[0],s[1],e[0],e[1],s[0] + to[0],s[1] + to[1]) && bez.pointOnLine2D(s[0],s[1],e[0],e[1],e[0] + ti[0],e[1] + ti[1])) || (s.length === 3 && !(s[0] === e[0] && s[1] === e[1] && s[2] === e[2]) && bez.pointOnLine3D(s[0],s[1],s[2],e[0],e[1],e[2],s[0] + to[0],s[1] + to[1],s[2] + to[2]) && bez.pointOnLine3D(s[0],s[1],s[2],e[0],e[1],e[2],e[0] + ti[0],e[1] + ti[1],e[2] + ti[2]))){
                    data.k[i].to = null;
                    data.k[i].ti = null;
                }
            }
        }
        this.keyframes = data.k;
        this.offsetTime = elem.data.st;
        this.k = true;
        this.kf = true;
        this.mult = mult;
        this.elem = elem;
        this.comp = elem.comp;
        this.getValue = getValue;
        this.frameId = -1;
        this._lastIndex = 0;
        this.v = Array.apply(null, {length:data.k[0].s.length});
        this.pv = Array.apply(null, {length:data.k[0].s.length});
        this.lastValue = Array.apply(null, {length:data.k[0].s.length});
        this.lastPValue = Array.apply(null, {length:data.k[0].s.length});
        this.lastFrame = initFrame;
    }

    var TransformProperty = (function() {
        function positionGetter() {
            if(this.p) {
                return ExpressionValue(this.p);
            } else {
                return [this.px.v, this.py.v, this.pz ? this.pz.v : 0];
            }
        }
        function xPositionGetter() {
            return ExpressionValue(this.px);
        }
        function yPositionGetter() {
            return ExpressionValue(this.py);
        }
        function zPositionGetter() {
            return ExpressionValue(this.pz);
        }
        function anchorGetter() {
            return ExpressionValue(this.a);
        }
        function orientationGetter() {
            return ExpressionValue(this.or);
        }
        function rotationGetter() {
            if(this.r) {
                return ExpressionValue(this.r, 1/degToRads);
            } else {
                return ExpressionValue(this.rz, 1/degToRads);
            }
        }
        function scaleGetter() {
            return ExpressionValue(this.s, 100);
        }
        function opacityGetter() {
            return ExpressionValue(this.o, 100);
        }
        function skewGetter() {
            return ExpressionValue(this.sk);
        }
        function skewAxisGetter() {
            return ExpressionValue(this.sa);
        }
        function applyToMatrix(mat) {
            var i, len = this.dynamicProperties.length;
            for(i = 0; i < len; i += 1) {
                this.dynamicProperties[i].getValue();
                if (this.dynamicProperties[i].mdf) {
                    this.mdf = true;
                }
            }
            if (this.a) {
                mat.translate(-this.a.v[0], -this.a.v[1], this.a.v[2]);
            }
            if (this.s) {
                mat.scale(this.s.v[0], this.s.v[1], this.s.v[2]);
            }
            if (this.r) {
                mat.rotate(-this.r.v);
            } else {
                mat.rotateZ(-this.rz.v).rotateY(this.ry.v).rotateX(this.rx.v).rotateZ(-this.or.v[2]).rotateY(this.or.v[1]).rotateX(this.or.v[0]);
            }
            if (this.data.p.s) {
                if (this.data.p.z) {
                    mat.translate(this.px.v, this.py.v, -this.pz.v);
                } else {
                    mat.translate(this.px.v, this.py.v, 0);
                }
            } else {
                mat.translate(this.p.v[0], this.p.v[1], -this.p.v[2]);
            }
        }
        function processKeys(){
            if (this.elem.globalData.frameId === this.frameId) {
                return;
            }

            this.mdf = false;
            var i, len = this.dynamicProperties.length;

            for(i = 0; i < len; i += 1) {
                this.dynamicProperties[i].getValue();
                if (this.dynamicProperties[i].mdf) {
                    this.mdf = true;
                }
            }
            if (this.mdf) {
                this.v.reset();
                if (this.a) {
                    this.v.translate(-this.a.v[0], -this.a.v[1], this.a.v[2]);
                }
                if(this.s) {
                    this.v.scale(this.s.v[0], this.s.v[1], this.s.v[2]);
                }
                if (this.sk) {
                    this.v.skewFromAxis(-this.sk.v, this.sa.v);
                }
                if (this.r) {
                    this.v.rotate(-this.r.v);
                } else {
                    this.v.rotateZ(-this.rz.v).rotateY(this.ry.v).rotateX(this.rx.v).rotateZ(-this.or.v[2]).rotateY(this.or.v[1]).rotateX(this.or.v[0]);
                }
                if (this.autoOriented && this.p.keyframes && this.p.getValueAtTime) {
                    var v1,v2;
                    if (this.p.lastFrame+this.p.offsetTime <= this.p.keyframes[0].t) {
                        v1 = this.p.getValueAtTime((this.p.keyframes[0].t + 0.01) / this.elem.globalData.frameRate,0);
                        v2 = this.p.getValueAtTime(this.p.keyframes[0].t / this.elem.globalData.frameRate, 0);
                    } else if(this.p.lastFrame+this.p.offsetTime >= this.p.keyframes[this.p.keyframes.length - 1].t) {
                        v1 = this.p.getValueAtTime((this.p.keyframes[this.p.keyframes.length - 1].t / this.elem.globalData.frameRate), 0);
                        v2 = this.p.getValueAtTime((this.p.keyframes[this.p.keyframes.length - 1].t - 0.01) / this.elem.globalData.frameRate, 0);
                    } else {
                        v1 = this.p.pv;
                        v2 = this.p.getValueAtTime((this.p.lastFrame+this.p.offsetTime - 0.01) / this.elem.globalData.frameRate, this.p.offsetTime);
                    }
                    this.v.rotate(-Math.atan2(v1[1] - v2[1], v1[0] - v2[0]));
                }
                if(this.data.p.s){
                    if(this.data.p.z) {
                        this.v.translate(this.px.v, this.py.v, -this.pz.v);
                    } else {
                        this.v.translate(this.px.v, this.py.v, 0);
                    }
                }else{
                    this.v.translate(this.p.v[0],this.p.v[1],-this.p.v[2]);
                }
            }
            //console.log(this.v.to2dCSS())
            this.frameId = this.elem.globalData.frameId;
        }

        function setInverted(){
            this.inverted = true;
            this.iv = new Matrix();
            if(!this.k){
                if(this.data.p.s){
                    this.iv.translate(this.px.v,this.py.v,-this.pz.v);
                }else{
                    this.iv.translate(this.p.v[0],this.p.v[1],-this.p.v[2]);
                }
                if(this.r){
                    this.iv.rotate(-this.r.v);
                }else{
                    this.iv.rotateX(-this.rx.v).rotateY(-this.ry.v).rotateZ(this.rz.v);
                }
                if(this.s){
                    this.iv.scale(this.s.v[0],this.s.v[1],1);
                }
                if(this.a){
                    this.iv.translate(-this.a.v[0],-this.a.v[1],this.a.v[2]);
                }
            }
        }

        function autoOrient(){
            //
            //var prevP = this.getValueAtTime();
        }

        return function TransformProperty(elem,data,arr){
            this.elem = elem;
            this.frameId = -1;
            this.type = 'transform';
            this.dynamicProperties = [];
            this.mdf = false;
            this.data = data;
            this.getValue = processKeys;
            this.applyToMatrix = applyToMatrix;
            this.setInverted = setInverted;
            this.autoOrient = autoOrient;
            this.v = new Matrix();
            if(data.p.s){
                this.px = PropertyFactory.getProp(elem,data.p.x,0,0,this.dynamicProperties);
                this.py = PropertyFactory.getProp(elem,data.p.y,0,0,this.dynamicProperties);
                if(data.p.z){
                    this.pz = PropertyFactory.getProp(elem,data.p.z,0,0,this.dynamicProperties);
                }
            }else{
                this.p = PropertyFactory.getProp(elem,data.p,1,0,this.dynamicProperties);
            }
            if(data.r) {
                this.r = PropertyFactory.getProp(elem, data.r, 0, degToRads, this.dynamicProperties);
            } else if(data.rx) {
                this.rx = PropertyFactory.getProp(elem, data.rx, 0, degToRads, this.dynamicProperties);
                this.ry = PropertyFactory.getProp(elem, data.ry, 0, degToRads, this.dynamicProperties);
                this.rz = PropertyFactory.getProp(elem, data.rz, 0, degToRads, this.dynamicProperties);
                this.or = PropertyFactory.getProp(elem, data.or, 1, degToRads, this.dynamicProperties);
            }
            if(data.sk){
                this.sk = PropertyFactory.getProp(elem, data.sk, 0, degToRads, this.dynamicProperties);
                this.sa = PropertyFactory.getProp(elem, data.sa, 0, degToRads, this.dynamicProperties);
            }
            if(data.a) {
                this.a = PropertyFactory.getProp(elem,data.a,1,0,this.dynamicProperties);
            }
            if(data.s) {
                this.s = PropertyFactory.getProp(elem,data.s,1,0.01,this.dynamicProperties);
            }
            if(data.o){
                this.o = PropertyFactory.getProp(elem,data.o,0,0.01,arr);
            } else {
                this.o = {mdf:false,v:1};
            }
            if(this.dynamicProperties.length){
                arr.push(this);
            }else{
                if(this.a){
                    this.v.translate(-this.a.v[0],-this.a.v[1],this.a.v[2]);
                }
                if(this.s){
                    this.v.scale(this.s.v[0],this.s.v[1],this.s.v[2]);
                }
                if(this.sk){
                    this.v.skewFromAxis(-this.sk.v,this.sa.v);
                }
                if(this.r){
                    this.v.rotate(-this.r.v);
                }else{
                    this.v.rotateZ(-this.rz.v).rotateY(this.ry.v).rotateX(this.rx.v).rotateZ(-this.or.v[2]).rotateY(this.or.v[1]).rotateX(this.or.v[0]);
                }
                if(this.data.p.s){
                    if(data.p.z) {
                        this.v.translate(this.px.v, this.py.v, -this.pz.v);
                    } else {
                        this.v.translate(this.px.v, this.py.v, 0);
                    }
                }else{
                    this.v.translate(this.p.v[0],this.p.v[1],-this.p.v[2]);
                }
            }
            Object.defineProperty(this, "position", { get: positionGetter});
            Object.defineProperty(this, "xPosition", { get: xPositionGetter});
            Object.defineProperty(this, "yPosition", { get: yPositionGetter});
            Object.defineProperty(this, "orientation", { get: orientationGetter});
            Object.defineProperty(this, "anchorPoint", { get: anchorGetter});
            Object.defineProperty(this, "rotation", { get: rotationGetter});
            Object.defineProperty(this, "scale", { get: scaleGetter});
            Object.defineProperty(this, "opacity", { get: opacityGetter});
            Object.defineProperty(this, "skew", { get: skewGetter});
            Object.defineProperty(this, "skewAxis", { get: skewAxisGetter});
        }
    }());

    function getProp(elem,data,type, mult, arr) {
        var p;
        if(type === 2){
            p = new TransformProperty(elem, data, arr);
        } else if(data.a === 0){
            if(type === 0) {
                p = new ValueProperty(elem,data,mult);
            } else {
                p = new MultiDimensionalProperty(elem,data, mult);
            }
        } else if(data.a === 1){
            if(type === 0) {
                p = new KeyframedValueProperty(elem,data,mult);
            } else {
                p = new KeyframedMultidimensionalProperty(elem,data, mult);
            }
        } else if(!data.k.length){
            p = new ValueProperty(elem,data, mult);
        }else if(typeof(data.k[0]) === 'number'){
            p = new MultiDimensionalProperty(elem,data, mult);
        }else{
            switch(type){
                case 0:
                    p = new KeyframedValueProperty(elem,data,mult);
                    break;
                case 1:
                    p = new KeyframedMultidimensionalProperty(elem,data,mult);
                    break;
            }
        }
        if(p.k){
            arr.push(p);
        }
        return p;
    }

    var getGradientProp = (function(){

        function getValue(forceRender){
            this.prop.getValue();
            this.cmdf = false;
            this.omdf = false;
            if(this.prop.mdf || forceRender){
                var i, len = this.data.p*4;
                var mult, val;
                for(i=0;i<len;i+=1){
                    mult = i%4 === 0 ? 100 : 255;
                    val = Math.round(this.prop.v[i]*mult);
                    if(this.c[i] !== val){
                        this.c[i] = val;
                        this.cmdf = true;
                    }
                }
                if(this.o.length){
                    len = this.prop.v.length;
                    for(i=this.data.p*4;i<len;i+=1){
                        mult = i%2 === 0 ? 100 : 1;
                        val = i%2 === 0 ?  Math.round(this.prop.v[i]*100):this.prop.v[i];
                        if(this.o[i-this.data.p*4] !== val){
                            this.o[i-this.data.p*4] = val;
                            this.omdf = true;
                        }
                    }
                }
            }

        }

        function gradientProp(elem,data,arr){
            this.prop = getProp(elem,data.k,1,null,[]);
            this.data = data;
            this.k = this.prop.k;
            this.c = Array.apply(null,{length:data.p*4});
            var cLength = data.k.k[0].s ? (data.k.k[0].s.length - data.p*4) : data.k.k.length - data.p*4;
            this.o = Array.apply(null,{length:cLength});
            this.cmdf = false;
            this.omdf = false;
            this.getValue = getValue;
            if(this.prop.k){
                arr.push(this);
            }
            this.getValue(true);
        }

        return function getGradientProp(elem,data,arr){
            return new gradientProp(elem,data,arr);
        }
    }());




    var DashProperty = (function(){

        function processKeys(forceRender){
            var i = 0, len = this.dataProps.length;

            if(this.elem.globalData.frameId === this.frameId && !forceRender){
                return;
            }
            this.mdf = false;
            this.frameId = this.elem.globalData.frameId;
            while(i<len){
                if(this.dataProps[i].p.mdf){
                    this.mdf = true;
                    break;
                }
                i+=1;
            }
            if(this.mdf || forceRender){
                if(this.renderer === 'svg') {
                    this.dasharray = '';
                }
                for(i=0;i<len;i+=1){
                    if(this.dataProps[i].n != 'o'){
                        if(this.renderer === 'svg') {
                            this.dasharray += ' ' + this.dataProps[i].p.v;
                        }else{
                            this.dasharray[i] = this.dataProps[i].p.v;
                        }
                    }else{
                        this.dashoffset = this.dataProps[i].p.v;
                    }
                }
            }
        }

        return function(elem, data,renderer, dynamicProperties){
            this.elem = elem;
            this.frameId = -1;
            this.dataProps = new Array(data.length);
            this.renderer = renderer;
            this.mdf = false;
            this.k = false;
            if(this.renderer === 'svg'){
                this.dasharray = '';
            }else{

                this.dasharray = new Array(data.length - 1);
            }
            this.dashoffset = 0;
            var i, len = data.length, prop;
            for(i=0;i<len;i+=1){
                prop = PropertyFactory.getProp(elem,data[i].v,0, 0, dynamicProperties);
                this.k = prop.k ? true : this.k;
                this.dataProps[i] = {n:data[i].n,p:prop};
            }
            this.getValue = processKeys;
            if(this.k){
                dynamicProperties.push(this);
            }else{
                this.getValue(true);
            }

        }
    }());

    function getDashProp(elem, data,renderer, dynamicProperties) {
        return new DashProperty(elem, data,renderer, dynamicProperties);
    };

    var TextSelectorProp = (function(){
        var max = Math.max;
        var min = Math.min;
        var floor = Math.floor;
        function updateRange(){
            if(this.dynamicProperties.length){
                var i, len = this.dynamicProperties.length;
                for(i=0;i<len;i+=1){
                    this.dynamicProperties[i].getValue();
                    if(this.dynamicProperties[i].mdf){
                        this.mdf = true;
                    }
                }
            }
            var totalChars = this.data.totalChars;
            var divisor = this.data.r === 2 ? 1 : 100/totalChars;
            var o = this.o.v/divisor;
            var s = this.s.v/divisor + o;
            var e = (this.e.v/divisor) + o;
            if(s>e){
                var _s = s;
                s = e;
                e = _s;
            }
            this.finalS = s;
            this.finalE = e;
        }

        function getMult(ind){
            //var easer = bez.getEasingCurve(this.ne.v/100,0,1-this.xe.v/100,1);
            var easer = BezierFactory.getBezierEasing(this.ne.v/100,0,1-this.xe.v/100,1).get;
            var mult = 0;
            var s = this.finalS;
            var e = this.finalE;
            var type = this.data.sh;
            if(type == 2){
                if(e === s){
                    mult = ind >= e ? 1 : 0;
                }else{
                    mult = max(0,min(0.5/(e-s) + (ind-s)/(e-s),1));
                }
                mult = easer(mult);
            }else if(type == 3){
                if(e === s){
                    mult = ind >= e ? 0 : 1;
                }else{
                    mult = 1 - max(0,min(0.5/(e-s) + (ind-s)/(e-s),1));
                }

                mult = easer(mult);
            }else if(type == 4){
                if(e === s){
                    mult = 0;
                }else{
                    mult = max(0,min(0.5/(e-s) + (ind-s)/(e-s),1));
                    if(mult<.5){
                        mult *= 2;
                    }else{
                        mult = 1 - 2*(mult-0.5);
                    }
                }
                mult = easer(mult);
            }else if(type == 5){
                if(e === s){
                    mult = 0;
                }else{
                    var tot = e - s;
                    /*ind += 0.5;
                    mult = -4/(tot*tot)*(ind*ind)+(4/tot)*ind;*/
                    ind = min(max(0,ind+0.5-s),e-s);
                    var x = -tot/2+ind;
                    var a = tot/2;
                    mult = Math.sqrt(1 - (x*x)/(a*a));
                }
                mult = easer(mult);
            }else if(type == 6){
                if(e === s){
                    mult = 0;
                }else{
                    ind = min(max(0,ind+0.5-s),e-s);
                    mult = (1+(Math.cos((Math.PI+Math.PI*2*(ind)/(e-s)))))/2;
                    /*
                     ind = Math.min(Math.max(s,ind),e-1);
                     mult = (1+(Math.cos((Math.PI+Math.PI*2*(ind-s)/(e-1-s)))))/2;
                     mult = Math.max(mult,(1/(e-1-s))/(e-1-s));*/
                }
                mult = easer(mult);
            }else {
                if(ind >= floor(s)){
                    if(ind-s < 0){
                        mult = 1 - (s - ind);
                    }else{
                        mult = max(0,min(e-ind,1));
                    }
                }
                mult = easer(mult);
            }
            return mult*this.a.v;
        }

        return function TextSelectorProp(elem,data, arr){
            this.mdf = false;
            this.k = false;
            this.data = data;
            this.dynamicProperties = [];
            this.getValue = updateRange;
            this.getMult = getMult;
            this.comp = elem.comp;
            this.finalS = 0;
            this.finalE = 0;
            this.s = PropertyFactory.getProp(elem,data.s || {k:0},0,0,this.dynamicProperties);
            if('e' in data){
                this.e = PropertyFactory.getProp(elem,data.e,0,0,this.dynamicProperties);
            }else{
                this.e = {v:data.r === 2 ? data.totalChars : 100};
            }
            this.o = PropertyFactory.getProp(elem,data.o || {k:0},0,0,this.dynamicProperties);
            this.xe = PropertyFactory.getProp(elem,data.xe || {k:0},0,0,this.dynamicProperties);
            this.ne = PropertyFactory.getProp(elem,data.ne || {k:0},0,0,this.dynamicProperties);
            this.a = PropertyFactory.getProp(elem,data.a,0,0.01,this.dynamicProperties);
            if(this.dynamicProperties.length){
                arr.push(this);
            }else{
                this.getValue();
            }
        }
    }());

    function getTextSelectorProp(elem, data,arr) {
        return new TextSelectorProp(elem, data, arr);
    };

    var ob = {};
    ob.getProp = getProp;
    ob.getDashProp = getDashProp;
    ob.getTextSelectorProp = getTextSelectorProp;
    ob.getGradientProp = getGradientProp;
    return ob;
}());
function ShapePath(){
	this.c = false;
	this._length = 0;
	this._maxLength = 8;
	this.v = Array.apply(null,{length:this._maxLength});
	this.o = Array.apply(null,{length:this._maxLength});
	this.i = Array.apply(null,{length:this._maxLength});
};

ShapePath.prototype.setPathData = function(closed, len) {
	this.c = closed;
	while(len > this._maxLength){
		this.doubleArrayLength();
	}
	var i = 0;
	while(i < len){
		this.v[i] = point_pool.newPoint();
		this.o[i] = point_pool.newPoint();
		this.i[i] = point_pool.newPoint();
		i += 1;
	}
	this._length = len;
};

ShapePath.prototype.doubleArrayLength = function() {
	this.v = this.v.concat(Array.apply(null,{length:this._maxLength}))
	this.i = this.i.concat(Array.apply(null,{length:this._maxLength}))
	this.o = this.o.concat(Array.apply(null,{length:this._maxLength}))
	this._maxLength *= 2;
};

ShapePath.prototype.setXYAt = function(x, y, type, pos, replace) {
	var arr;
	this._length = Math.max(this._length, pos + 1);
	if(this._length >= this._maxLength) {
		this.doubleArrayLength();
	}
	switch(type){
		case 'v':
			arr = this.v;
			break;
		case 'i':
			arr = this.i;
			break;
		case 'o':
			arr = this.o;
			break;
	}
	if(!arr[pos] || (arr[pos] && !replace)){
		arr[pos] = point_pool.newPoint();
	}
	arr[pos][0] = x;
	arr[pos][1] = y;
};

ShapePath.prototype.setTripleAt = function(vX,vY,oX,oY,iX,iY,pos, replace) {
	this.setXYAt(vX,vY,'v',pos, replace);
	this.setXYAt(oX,oY,'o',pos, replace);
	this.setXYAt(iX,iY,'i',pos, replace);
};
var ShapePropertyFactory = (function(){

    var initFrame = -999999;

    function interpolateShape() {
        if(this.elem.globalData.frameId === this.frameId){
            return;
        }
        this.mdf = false;
        var frameNum = this.comp.renderedFrame - this.offsetTime;
        if(!((this.lastFrame !== initFrame && ((this.lastFrame < this.keyframes[0].t-this.offsetTime && frameNum < this.keyframes[0].t-this.offsetTime) || (this.lastFrame > this.keyframes[this.keyframes.length - 1].t-this.offsetTime && frameNum > this.keyframes[this.keyframes.length - 1].t-this.offsetTime))))){
            var keyPropS,keyPropE,isHold;
            if(frameNum < this.keyframes[0].t-this.offsetTime){
                keyPropS = this.keyframes[0].s[0];
                isHold = true;
                this._lastIndex = 0;
            }else if(frameNum >= this.keyframes[this.keyframes.length - 1].t-this.offsetTime){
                if(this.keyframes[this.keyframes.length - 2].h === 1){
                    keyPropS = this.keyframes[this.keyframes.length - 1].s[0];
                }else{
                    keyPropS = this.keyframes[this.keyframes.length - 2].e[0];
                }
                isHold = true;
            }else{
                var i = this.lastFrame < initFrame ? this._lastIndex : 0;
                var len = this.keyframes.length- 1,flag = true,keyData,nextKeyData, j, jLen, k, kLen;
                while(flag){
                    keyData = this.keyframes[i];
                    nextKeyData = this.keyframes[i+1];
                    if((nextKeyData.t - this.offsetTime) > frameNum){
                        break;
                    }
                    if(i < len - 1){
                        i += 1;
                    }else{
                        flag = false;
                    }
                }
                isHold = keyData.h === 1;
                this._lastIndex = i;

                var perc;
                if(!isHold){
                    if(frameNum >= nextKeyData.t-this.offsetTime){
                        perc = 1;
                    }else if(frameNum < keyData.t-this.offsetTime){
                        perc = 0;
                    }else{
                        var fnc;
                        if(keyData.__fnct){
                            fnc = keyData.__fnct;
                        }else{
                            fnc = BezierFactory.getBezierEasing(keyData.o.x,keyData.o.y,keyData.i.x,keyData.i.y).get;
                            keyData.__fnct = fnc;
                        }
                        perc = fnc((frameNum-(keyData.t-this.offsetTime))/((nextKeyData.t-this.offsetTime)-(keyData.t-this.offsetTime)));
                    }
                    keyPropE = keyData.e[0];
                }
                keyPropS = keyData.s[0];
            }
            jLen = this.v._length;
            kLen = keyPropS.i[0].length;
            var hasModified = false;
            var vertexValue;
            for(j=0;j<jLen;j+=1){
                for(k=0;k<kLen;k+=1){
                    if(isHold){
                        vertexValue = keyPropS.i[j][k];
                        if(this.v.i[j][k] !== vertexValue){
                            this.v.i[j][k] = vertexValue;
                            this.pv.i[j][k] = vertexValue;
                            hasModified = true;
                        }
                        vertexValue = keyPropS.o[j][k];
                        if(this.v.o[j][k] !== vertexValue){
                            this.v.o[j][k] = vertexValue;
                            this.pv.o[j][k] = vertexValue;
                            hasModified = true;
                        }
                        vertexValue = keyPropS.v[j][k];
                        if(this.v.v[j][k] !== vertexValue){
                            this.v.v[j][k] = vertexValue;
                            this.pv.v[j][k] = vertexValue;
                            hasModified = true;
                        }
                    }else{
                        vertexValue = keyPropS.i[j][k]+(keyPropE.i[j][k]-keyPropS.i[j][k])*perc;
                        if(this.v.i[j][k] !== vertexValue){
                            this.v.i[j][k] = vertexValue;
                            this.pv.i[j][k] = vertexValue;
                            hasModified = true;
                        }
                        vertexValue = keyPropS.o[j][k]+(keyPropE.o[j][k]-keyPropS.o[j][k])*perc;
                        if(this.v.o[j][k] !== vertexValue){
                            this.v.o[j][k] = vertexValue;
                            this.pv.o[j][k] = vertexValue;
                            hasModified = true;
                        }
                        vertexValue = keyPropS.v[j][k]+(keyPropE.v[j][k]-keyPropS.v[j][k])*perc;
                        if(this.v.v[j][k] !== vertexValue){
                            this.v.v[j][k] = vertexValue;
                            this.pv.v[j][k] = vertexValue;
                            hasModified = true;
                        }
                    }
                }
            }
            this.mdf = hasModified;
            this.v.c = keyPropS.c;
            this.paths = this.localShapeCollection;
        }

        this.lastFrame = frameNum;
        this.frameId = this.elem.globalData.frameId;
    }

    function getShapeValue(){
        return this.v;
    }

    function resetShape(){
        this.paths = this.localShapeCollection;
        if(!this.k){
            this.mdf = false;
        }
    }

    function ShapeProperty(elem, data, type){
        this.comp = elem.comp;
        this.k = false;
        this.mdf = false;
        this.v = shape_pool.newShape();
        var pathData = type === 3 ? data.pt.k : data.ks.k;
        this.v.v = pathData.v;
        this.v.i = pathData.i;
        this.v.o = pathData.o;
        this.v.c = pathData.c;
        this.v._length = this.v.v.length;
        this.getValue = getShapeValue;
        this.pv = shape_pool.clone(this.v);
        this.localShapeCollection = shapeCollection_pool.newShapeCollection();
        this.paths = this.localShapeCollection;
        this.paths.addShape(this.v);
        this.reset = resetShape;
    }

    function KeyframedShapeProperty(elem,data,type){
        this.comp = elem.comp;
        this.elem = elem;
        this.offsetTime = elem.data.st;
        this._lastIndex = 0;
        this.getValue = interpolateShape;
        this.keyframes = type === 3 ? data.pt.k : data.ks.k;
        this.k = true;
        this.kf = true;
        var i, len = this.keyframes[0].s[0].i.length;
        var jLen = this.keyframes[0].s[0].i[0].length;
        this.v = shape_pool.newShape();
        this.v.setPathData(this.keyframes[0].s[0].c, len);
        this.pv = shape_pool.clone(this.v);
        this.localShapeCollection = shapeCollection_pool.newShapeCollection();
        this.paths = this.localShapeCollection;
        this.paths.addShape(this.v);
        this.lastFrame = initFrame;
        this.reset = resetShape;
    }

    var EllShapeProperty = (function(){

        var cPoint = roundCorner;

        function convertEllToPath(){
            var p0 = this.p.v[0], p1 = this.p.v[1], s0 = this.s.v[0]/2, s1 = this.s.v[1]/2;
            if(this.d !== 3){
                this.v.v[0][0] = p0;
                this.v.v[0][1] = p1-s1;
                this.v.v[1][0] = p0 + s0;
                this.v.v[1][1] = p1;
                this.v.v[2][0] = p0;
                this.v.v[2][1] = p1+s1;
                this.v.v[3][0] = p0 - s0;
                this.v.v[3][1] = p1;
                this.v.i[0][0] = p0 - s0*cPoint;
                this.v.i[0][1] = p1 - s1;
                this.v.i[1][0] = p0 + s0;
                this.v.i[1][1] = p1 - s1*cPoint;
                this.v.i[2][0] = p0 + s0*cPoint;
                this.v.i[2][1] = p1 + s1;
                this.v.i[3][0] = p0 - s0;
                this.v.i[3][1] = p1 + s1*cPoint;
                this.v.o[0][0] = p0 + s0*cPoint;
                this.v.o[0][1] = p1 - s1;
                this.v.o[1][0] = p0 + s0;
                this.v.o[1][1] = p1 + s1*cPoint;
                this.v.o[2][0] = p0 - s0*cPoint;
                this.v.o[2][1] = p1 + s1;
                this.v.o[3][0] = p0 - s0;
                this.v.o[3][1] = p1 - s1*cPoint;
            }else{
                this.v.v[0][0] = p0;
                this.v.v[0][1] = p1-s1;
                this.v.v[1][0] = p0 - s0;
                this.v.v[1][1] = p1;
                this.v.v[2][0] = p0;
                this.v.v[2][1] = p1+s1;
                this.v.v[3][0] = p0 + s0;
                this.v.v[3][1] = p1;
                this.v.i[0][0] = p0 + s0*cPoint;
                this.v.i[0][1] = p1 - s1;
                this.v.i[1][0] = p0 - s0;
                this.v.i[1][1] = p1 - s1*cPoint;
                this.v.i[2][0] = p0 - s0*cPoint;
                this.v.i[2][1] = p1 + s1;
                this.v.i[3][0] = p0 + s0;
                this.v.i[3][1] = p1 + s1*cPoint;
                this.v.o[0][0] = p0 - s0*cPoint;
                this.v.o[0][1] = p1 - s1;
                this.v.o[1][0] = p0 - s0;
                this.v.o[1][1] = p1 + s1*cPoint;
                this.v.o[2][0] = p0 + s0*cPoint;
                this.v.o[2][1] = p1 + s1;
                this.v.o[3][0] = p0 + s0;
                this.v.o[3][1] = p1 - s1*cPoint;
            }
        }

        function processKeys(frameNum){
            var i, len = this.dynamicProperties.length;
            if(this.elem.globalData.frameId === this.frameId){
                return;
            }
            this.mdf = false;
            this.frameId = this.elem.globalData.frameId;

            for(i=0;i<len;i+=1){
                this.dynamicProperties[i].getValue(frameNum);
                if(this.dynamicProperties[i].mdf){
                    this.mdf = true;
                }
            }
            if(this.mdf){
                this.convertEllToPath();
            }
        }

        return function EllShapeProperty(elem,data) {
            /*this.v = {
                v: Array.apply(null,{length:4}),
                i: Array.apply(null,{length:4}),
                o: Array.apply(null,{length:4}),
                c: true
            };*/
            this.v = shape_pool.newShape();
            this.v.setPathData(true, 4);
            this.localShapeCollection = shapeCollection_pool.newShapeCollection();
            this.paths = this.localShapeCollection;
            this.localShapeCollection.addShape(this.v);
            this.d = data.d;
            this.dynamicProperties = [];
            this.elem = elem;
            this.comp = elem.comp;
            this.frameId = -1;
            this.mdf = false;
            this.getValue = processKeys;
            this.convertEllToPath = convertEllToPath;
            this.reset = resetShape;
            this.p = PropertyFactory.getProp(elem,data.p,1,0,this.dynamicProperties);
            this.s = PropertyFactory.getProp(elem,data.s,1,0,this.dynamicProperties);
            if(this.dynamicProperties.length){
                this.k = true;
            }else{
                this.convertEllToPath();
            }
        }
    }());

    var StarShapeProperty = (function() {

        function convertPolygonToPath(){
            var numPts = Math.floor(this.pt.v);
            var angle = Math.PI*2/numPts;
            /*this.v.v.length = numPts;
            this.v.i.length = numPts;
            this.v.o.length = numPts;*/
            var rad = this.or.v;
            var roundness = this.os.v;
            var perimSegment = 2*Math.PI*rad/(numPts*4);
            var i, currentAng = -Math.PI/ 2;
            var dir = this.data.d === 3 ? -1 : 1;
            currentAng += this.r.v;
            this.v._length = 0;
            for(i=0;i<numPts;i+=1){
                var x = rad * Math.cos(currentAng);
                var y = rad * Math.sin(currentAng);
                var ox = x === 0 && y === 0 ? 0 : y/Math.sqrt(x*x + y*y);
                var oy = x === 0 && y === 0 ? 0 : -x/Math.sqrt(x*x + y*y);
                x +=  + this.p.v[0];
                y +=  + this.p.v[1];
                this.v.setTripleAt(x,y,x-ox*perimSegment*roundness*dir,y-oy*perimSegment*roundness*dir,x+ox*perimSegment*roundness*dir,y+oy*perimSegment*roundness*dir, i, true);
                /*this.v.v[i] = [x,y];
                this.v.i[i] = [x+ox*perimSegment*roundness*dir,y+oy*perimSegment*roundness*dir];
                this.v.o[i] = [x-ox*perimSegment*roundness*dir,y-oy*perimSegment*roundness*dir];*/
                currentAng += angle*dir;
            }
            this.paths.length = 0;
            this.paths[0] = this.v;
        }

        function convertStarToPath() {
            var numPts = Math.floor(this.pt.v)*2;
            var angle = Math.PI*2/numPts;
            /*this.v.v.length = numPts;
            this.v.i.length = numPts;
            this.v.o.length = numPts;*/
            var longFlag = true;
            var longRad = this.or.v;
            var shortRad = this.ir.v;
            var longRound = this.os.v;
            var shortRound = this.is.v;
            var longPerimSegment = 2*Math.PI*longRad/(numPts*2);
            var shortPerimSegment = 2*Math.PI*shortRad/(numPts*2);
            var i, rad,roundness,perimSegment, currentAng = -Math.PI/ 2;
            currentAng += this.r.v;
            var dir = this.data.d === 3 ? -1 : 1;
            this.v._length = 0;
            for(i=0;i<numPts;i+=1){
                rad = longFlag ? longRad : shortRad;
                roundness = longFlag ? longRound : shortRound;
                perimSegment = longFlag ? longPerimSegment : shortPerimSegment;
                var x = rad * Math.cos(currentAng);
                var y = rad * Math.sin(currentAng);
                var ox = x === 0 && y === 0 ? 0 : y/Math.sqrt(x*x + y*y);
                var oy = x === 0 && y === 0 ? 0 : -x/Math.sqrt(x*x + y*y);
                x +=  + this.p.v[0];
                y +=  + this.p.v[1];
                this.v.setTripleAt(x,y,x-ox*perimSegment*roundness*dir,y-oy*perimSegment*roundness*dir,x+ox*perimSegment*roundness*dir,y+oy*perimSegment*roundness*dir, i, true);

                /*this.v.v[i] = [x,y];
                this.v.i[i] = [x+ox*perimSegment*roundness*dir,y+oy*perimSegment*roundness*dir];
                this.v.o[i] = [x-ox*perimSegment*roundness*dir,y-oy*perimSegment*roundness*dir];
                this.v._length = numPts;*/
                longFlag = !longFlag;
                currentAng += angle*dir;
            }
        }

        function processKeys() {
            if(this.elem.globalData.frameId === this.frameId){
                return;
            }
            this.mdf = false;
            this.frameId = this.elem.globalData.frameId;
            var i, len = this.dynamicProperties.length;

            for(i=0;i<len;i+=1){
                this.dynamicProperties[i].getValue();
                if(this.dynamicProperties[i].mdf){
                    this.mdf = true;
                }
            }
            if(this.mdf){
                this.convertToPath();
            }
        }

        return function StarShapeProperty(elem,data) {
            /*this.v = {
                v: [],
                i: [],
                o: [],
                c: true
            };*/
            this.v = shape_pool.newShape();
            this.v.setPathData(true, 0);
            this.elem = elem;
            this.comp = elem.comp;
            this.data = data;
            this.frameId = -1;
            this.d = data.d;
            this.dynamicProperties = [];
            this.mdf = false;
            this.getValue = processKeys;
            this.reset = resetShape;
            if(data.sy === 1){
                this.ir = PropertyFactory.getProp(elem,data.ir,0,0,this.dynamicProperties);
                this.is = PropertyFactory.getProp(elem,data.is,0,0.01,this.dynamicProperties);
                this.convertToPath = convertStarToPath;
            } else {
                this.convertToPath = convertPolygonToPath;
            }
            this.pt = PropertyFactory.getProp(elem,data.pt,0,0,this.dynamicProperties);
            this.p = PropertyFactory.getProp(elem,data.p,1,0,this.dynamicProperties);
            this.r = PropertyFactory.getProp(elem,data.r,0,degToRads,this.dynamicProperties);
            this.or = PropertyFactory.getProp(elem,data.or,0,0,this.dynamicProperties);
            this.os = PropertyFactory.getProp(elem,data.os,0,0.01,this.dynamicProperties);
            this.localShapeCollection = shapeCollection_pool.newShapeCollection();
            this.localShapeCollection.addShape(this.v);
            this.paths = this.localShapeCollection;
            if(this.dynamicProperties.length){
                this.k = true;
            }else{
                this.convertToPath();
            }
        }
    }());

    var RectShapeProperty = (function() {
        function processKeys(frameNum){
            if(this.elem.globalData.frameId === this.frameId){
                return;
            }
            this.mdf = false;
            this.frameId = this.elem.globalData.frameId;
            var i, len = this.dynamicProperties.length;

            for(i=0;i<len;i+=1){
                this.dynamicProperties[i].getValue(frameNum);
                if(this.dynamicProperties[i].mdf){
                    this.mdf = true;
                }
            }
            if(this.mdf){
                this.convertRectToPath();
            }

        }

        function convertRectToPath(){
            var p0 = this.p.v[0], p1 = this.p.v[1], v0 = this.s.v[0]/2, v1 = this.s.v[1]/2;
            var round = bm_min(v0,v1,this.r.v);
            var cPoint = round*(1-roundCorner);
            this.v._length = 0;

            if(this.d === 2 || this.d === 1) {
                this.v.setTripleAt(p0+v0, p1-v1+round,p0+v0, p1-v1+round,p0+v0,p1-v1+cPoint,0, true);
                this.v.setTripleAt(p0+v0, p1+v1-round,p0+v0, p1+v1-cPoint,p0+v0, p1+v1-round,1, true);
                if(round!== 0){
                    this.v.setTripleAt(p0+v0-round, p1+v1,p0+v0-round,p1+v1,p0+v0-cPoint,p1+v1,2, true);
                    this.v.setTripleAt(p0-v0+round,p1+v1,p0-v0+cPoint,p1+v1,p0-v0+round,p1+v1,3, true);
                    this.v.setTripleAt(p0-v0,p1+v1-round,p0-v0,p1+v1-round,p0-v0,p1+v1-cPoint,4, true);
                    this.v.setTripleAt(p0-v0,p1-v1+round,p0-v0,p1-v1+cPoint,p0-v0,p1-v1+round,5, true);
                    this.v.setTripleAt(p0-v0+round,p1-v1,p0-v0+round,p1-v1,p0-v0+cPoint,p1-v1,6, true);
                    this.v.setTripleAt(p0+v0-round,p1-v1,p0+v0-cPoint,p1-v1,p0+v0-round,p1-v1,7, true);
                } else {
                    this.v.setTripleAt(p0-v0,p1+v1,p0-v0+cPoint,p1+v1,p0-v0,p1+v1,2);
                    this.v.setTripleAt(p0-v0,p1-v1,p0-v0,p1-v1+cPoint,p0-v0,p1-v1,3);
                }
            }else{
                this.v.setTripleAt(p0+v0,p1-v1+round,p0+v0,p1-v1+cPoint,p0+v0,p1-v1+round,0, true);
                if(round!== 0){
                    this.v.setTripleAt(p0+v0-round,p1-v1,p0+v0-round,p1-v1,p0+v0-cPoint,p1-v1,1, true);
                    this.v.setTripleAt(p0-v0+round,p1-v1,p0-v0+cPoint,p1-v1,p0-v0+round,p1-v1,2, true);
                    this.v.setTripleAt(p0-v0,p1-v1+round,p0-v0,p1-v1+round,p0-v0,p1-v1+cPoint,3, true);
                    this.v.setTripleAt(p0-v0,p1+v1-round,p0-v0,p1+v1-cPoint,p0-v0,p1+v1-round,4, true);
                    this.v.setTripleAt(p0-v0+round,p1+v1,p0-v0+round,p1+v1,p0-v0+cPoint,p1+v1,5, true);
                    this.v.setTripleAt(p0+v0-round,p1+v1,p0+v0-cPoint,p1+v1,p0+v0-round,p1+v1,6, true);
                    this.v.setTripleAt(p0+v0,p1+v1-round,p0+v0,p1+v1-round,p0+v0,p1+v1-cPoint,7, true);
                } else {
                    this.v.setTripleAt(p0-v0,p1-v1,p0-v0+cPoint,p1-v1,p0-v0,p1-v1,1, true);
                    this.v.setTripleAt(p0-v0,p1+v1,p0-v0,p1+v1-cPoint,p0-v0,p1+v1,2, true);
                    this.v.setTripleAt(p0+v0,p1+v1,p0+v0-cPoint,p1+v1,p0+v0,p1+v1,3, true);

                }
            }
        }

        return function RectShapeProperty(elem,data) {
            this.v = shape_pool.newShape();
            this.v.c = true;
            this.localShapeCollection = shapeCollection_pool.newShapeCollection();
            this.localShapeCollection.addShape(this.v);
            this.paths = this.localShapeCollection;
            this.elem = elem;
            this.comp = elem.comp;
            this.frameId = -1;
            this.d = data.d;
            this.dynamicProperties = [];
            this.mdf = false;
            this.getValue = processKeys;
            this.convertRectToPath = convertRectToPath;
            this.reset = resetShape;
            this.p = PropertyFactory.getProp(elem,data.p,1,0,this.dynamicProperties);
            this.s = PropertyFactory.getProp(elem,data.s,1,0,this.dynamicProperties);
            this.r = PropertyFactory.getProp(elem,data.r,0,0,this.dynamicProperties);
            if(this.dynamicProperties.length){
                this.k = true;
            }else{
                this.convertRectToPath();
            }
        }
    }());

    function getShapeProp(elem,data,type, arr){
        var prop;
        if(type === 3 || type === 4){
            var dataProp = type === 3 ? data.pt : data.ks;
            var keys = dataProp.k;
            if(dataProp.a === 1 || keys.length){
                prop = new KeyframedShapeProperty(elem, data, type);
            }else{
                prop = new ShapeProperty(elem, data, type);
            }
        }else if(type === 5){
            prop = new RectShapeProperty(elem, data);
        }else if(type === 6){
            prop = new EllShapeProperty(elem, data);
        }else if(type === 7){
            prop = new StarShapeProperty(elem, data);
        }
        if(prop.k){
            arr.push(prop);
        }
        return prop;
    }

    var ob = {};
    ob.getShapeProp = getShapeProp;
    return ob;
}());
var ShapeModifiers = (function(){
    var ob = {};
    var modifiers = {};
    ob.registerModifier = registerModifier;
    ob.getModifier = getModifier;

    function registerModifier(nm,factory){
        if(!modifiers[nm]){
            modifiers[nm] = factory;
        }
    }

    function getModifier(nm,elem, data, dynamicProperties){
        return new modifiers[nm](elem, data, dynamicProperties);
    }

    return ob;
}());

function ShapeModifier(){}
ShapeModifier.prototype.initModifierProperties = function(){};
ShapeModifier.prototype.addShapeToModifier = function(){};
ShapeModifier.prototype.addShape = function(data){
    if(!this.closed){
        this.shapes.push({shape:data.sh, data: data, localShapeCollection:shapeCollection_pool.newShapeCollection()});
        this.addShapeToModifier(data.sh);
    }
}
ShapeModifier.prototype.init = function(elem,data,dynamicProperties){
    this.elem = elem;
    this.frameId = -1;
    this.shapes = [];
    this.dynamicProperties = [];
    this.mdf = false;
    this.closed = false;
    this.k = false;
    this.comp = elem.comp;
    this.initModifierProperties(elem,data);
    if(this.dynamicProperties.length){
        this.k = true;
        dynamicProperties.push(this);
    }else{
        this.getValue(true);
    }
}
function TrimModifier(){};
extendPrototype(ShapeModifier,TrimModifier);
TrimModifier.prototype.processKeys = function(forceRender){
    if(this.elem.globalData.frameId === this.frameId && !forceRender){
        return;
    }
    this.mdf = forceRender ? true : false;
    this.frameId = this.elem.globalData.frameId;
    var i, len = this.dynamicProperties.length;

    for(i=0;i<len;i+=1){
        this.dynamicProperties[i].getValue();
        if(this.dynamicProperties[i].mdf){
            this.mdf = true;
        }
    }
    if(this.mdf || forceRender){
        var o = (this.o.v%360)/360;
        if(o < 0){
            o += 1;
        }
        var s = this.s.v + o;
        var e = this.e.v + o;
        if(s == e){

        }
        if(s>e){
            var _s = s;
            s = e;
            e = _s;
        }
        this.sValue = s;
        this.eValue = e;
        this.oValue = o;
    }
}
TrimModifier.prototype.initModifierProperties = function(elem,data){
    this.sValue = 0;
    this.eValue = 0;
    this.oValue = 0;
    this.getValue = this.processKeys;
    this.s = PropertyFactory.getProp(elem,data.s,0,0.01,this.dynamicProperties);
    this.e = PropertyFactory.getProp(elem,data.e,0,0.01,this.dynamicProperties);
    this.o = PropertyFactory.getProp(elem,data.o,0,0,this.dynamicProperties);
    this.m = data.m;
    if(!this.dynamicProperties.length){
        this.getValue(true);
    }
};

TrimModifier.prototype.getSegmentsLength = function(shapeData){
    var closed = shapeData.c;
    var pathV = shapeData.v;
    var pathO = shapeData.o;
    var pathI = shapeData.i;
    var i, len = shapeData._length;
    var lengths = [];
    var totalLength = 0;
    for(i=0;i<len-1;i+=1){
        lengths[i] = bez.getBezierLength(pathV[i],pathV[i+1],pathO[i],pathI[i+1]);
        totalLength += lengths[i].addedLength;
    }
    if(closed){
        lengths[i] = bez.getBezierLength(pathV[i],pathV[0],pathO[i],pathI[0]);
        totalLength += lengths[i].addedLength;
    }
    return {lengths:lengths,totalLength:totalLength};
}

TrimModifier.prototype.calculateShapeEdges = function(s, e, shapeLength, addedLength, totalModifierLength) {
    var segments = []
    if(e <= 1){
        segments.push({
            s: s,
            e: e
        })
    }else if(s >= 1){
        segments.push({
            s: s - 1,
            e: e - 1
        })
    }else{
        segments.push({
            s: s,
            e: 1
        })
        segments.push({
            s: 0,
            e: e - 1
        })
    }
    var shapeSegments = [];
    var i, len = segments.length, segmentOb;
    for(i = 0; i < len; i += 1) {
        segmentOb = segments[i];
        if (segmentOb.e * totalModifierLength < addedLength || segmentOb.s * totalModifierLength > addedLength + shapeLength) {
            
        } else {
            var shapeS, shapeE;
            if(segmentOb.s * totalModifierLength <= addedLength) {
                shapeS = 0;
            } else {
                shapeS = (segmentOb.s * totalModifierLength - addedLength) / shapeLength;
            }
            if(segmentOb.e * totalModifierLength >= addedLength + shapeLength) {
                shapeE = 1;
            } else {
                shapeE = ((segmentOb.e * totalModifierLength - addedLength) / shapeLength);
            }
            shapeSegments.push([shapeS, shapeE]);
        }
    }
    if(!shapeSegments.length){
        shapeSegments.push([0,0]);
    }
    return shapeSegments;
}

TrimModifier.prototype.processShapes = function(firstFrame){
    var shapePaths;
    var i, len = this.shapes.length;
    var j, jLen;
    var s = this.sValue;
    var e = this.eValue;
    var pathsData,pathData, totalShapeLength, totalModifierLength = 0;

    if(e === s){
        for(i=0;i<len;i+=1){
            this.shapes[i].localShapeCollection.releaseShapes();
            this.shapes[i].shape.mdf = true;
            this.shapes[i].shape.paths = this.shapes[i].localShapeCollection;
        }
    } else if(!((e === 1 && s === 0) || (e===0 && s === 1))){
        var segments = [], shapeData, localShapeCollection;
        for(i=0;i<len;i+=1){
            shapeData = this.shapes[i];
            if(!shapeData.shape.mdf && !this.mdf && !firstFrame && this.m !== 2){
                shapeData.shape.paths = shapeData.localShapeCollection;
            } else {
                shapePaths = shapeData.shape.paths;
                jLen = shapePaths._length;
                totalShapeLength = 0;
                if(!shapeData.shape.mdf && shapeData.pathsData){
                    totalShapeLength = shapeData.totalShapeLength;
                } else {
                    pathsData = [];
                    for(j=0;j<jLen;j+=1){
                        pathData = this.getSegmentsLength(shapePaths.shapes[j]);
                        pathsData.push(pathData);
                        totalShapeLength += pathData.totalLength;
                    }
                    shapeData.totalShapeLength = totalShapeLength;
                    shapeData.pathsData = pathsData;
                }

                totalModifierLength += totalShapeLength;
                shapeData.shape.mdf = true;
            }
        }
        var shapeS = s, shapeE = e, addedLength = 0;
        var j, jLen;
        for(i = len - 1; i >= 0; i -= 1){
            shapeData = this.shapes[i];
            if (shapeData.shape.mdf) {
                localShapeCollection = shapeData.localShapeCollection;
                localShapeCollection.releaseShapes();
                if(this.m === 2 && len > 1) {
                    var edges = this.calculateShapeEdges(s, e, shapeData.totalShapeLength, addedLength, totalModifierLength);
                    addedLength += shapeData.totalShapeLength;
                } else {
                    edges = [[shapeS, shapeE]]
                }
                jLen = edges.length;
                for (j = 0; j < jLen; j += 1) {
                    shapeS = edges[j][0];
                    shapeE = edges[j][1];
                    segments.length = 0;
                    if(shapeE <= 1){
                        segments.push({
                            s:shapeData.totalShapeLength * shapeS,
                            e:shapeData.totalShapeLength * shapeE
                        })
                    }else if(shapeS >= 1){
                        segments.push({
                            s:shapeData.totalShapeLength * (shapeS - 1),
                            e:shapeData.totalShapeLength * (shapeE - 1)
                        })
                    }else{
                        segments.push({
                            s:shapeData.totalShapeLength * shapeS,
                            e:shapeData.totalShapeLength
                        })
                        segments.push({
                            s:0,
                            e:shapeData.totalShapeLength*(shapeE - 1)
                        })
                    }
                    var newShapesData = this.addShapes(shapeData,segments[0]);
                    if (segments[0].s !== segments[0].e) {
                        var lastPos;
                        if(segments.length > 1){
                            if(shapeData.shape.v.c){
                                var lastShape = newShapesData.pop();
                                this.addPaths(newShapesData, localShapeCollection);
                                newShapesData = this.addShapes(shapeData,segments[1], lastShape);
                            } else {
                                this.addPaths(newShapesData, localShapeCollection);
                                newShapesData = this.addShapes(shapeData,segments[1]);
                            }
                        } 
                        this.addPaths(newShapesData, localShapeCollection);
                    }
                    
                }
                shapeData.shape.paths = localShapeCollection;
            }
        }
    } else if(this.mdf){
        for(i=0;i<len;i+=1){
            this.shapes[i].shape.mdf = true;
        }
    }
    if(!this.dynamicProperties.length){
        this.mdf = false;
    }
}

TrimModifier.prototype.addPaths = function(newPaths, localShapeCollection) {
    var i, len = newPaths.length;
    for(i = 0; i < len; i += 1) {
        localShapeCollection.addShape(newPaths[i])
    }
}

TrimModifier.prototype.addSegment = function(pt1,pt2,pt3,pt4,shapePath,pos, newShape) {
    /*console.log(pt1, 'vertex: v, at: ', pos);
    console.log(pt2, 'vertex: o, at: ', pos);
    console.log(pt3, 'vertex: i, at: ', pos + 1);
    console.log(pt4, 'vertex: v, at: ', pos + 1);
    console.log('newShape: ', newShape);*/
    shapePath.setXYAt(pt2[0],pt2[1],'o',pos);
    shapePath.setXYAt(pt3[0],pt3[1],'i',pos + 1);
    if(newShape){
        shapePath.setXYAt(pt1[0],pt1[1],'v',pos);
    }
    shapePath.setXYAt(pt4[0],pt4[1],'v',pos + 1);
}

TrimModifier.prototype.addShapes = function(shapeData, shapeSegment, shapePath){
    var pathsData = shapeData.pathsData;
    var shapePaths = shapeData.shape.paths.shapes;
    var i, len = shapeData.shape.paths._length, j, jLen;
    var addedLength = 0;
    var currentLengthData,segmentCount;
    var lengths;
    var segment;
    var shapes = [];
    var initPos;
    var newShape = true;
    if(!shapePath){
        shapePath = shape_pool.newShape();
        segmentCount = 0;
        initPos = 0;
    } else {
        segmentCount = shapePath._length;
        initPos = shapePath._length;
    }
    shapes.push(shapePath);
    for(i=0;i<len;i+=1){
        lengths = pathsData[i].lengths;
        shapePath.c = shapePaths[i].c;
        jLen = shapePaths[i].c ? lengths.length : lengths.length + 1;
        for(j=1;j<jLen;j+=1){
            currentLengthData = lengths[j-1];
            if(addedLength + currentLengthData.addedLength < shapeSegment.s){
                addedLength += currentLengthData.addedLength;
                shapePath.c = false;
            } else if(addedLength > shapeSegment.e){
                shapePath.c = false;
                break;
            } else {
                if(shapeSegment.s <= addedLength && shapeSegment.e >= addedLength + currentLengthData.addedLength){
                    this.addSegment(shapePaths[i].v[j-1],shapePaths[i].o[j-1],shapePaths[i].i[j],shapePaths[i].v[j],shapePath,segmentCount,newShape);
                    newShape = false;
                } else {
                    segment = bez.getNewSegment(shapePaths[i].v[j-1],shapePaths[i].v[j],shapePaths[i].o[j-1],shapePaths[i].i[j], (shapeSegment.s - addedLength)/currentLengthData.addedLength,(shapeSegment.e - addedLength)/currentLengthData.addedLength, lengths[j-1]);
                    this.addSegment(segment.pt1,segment.pt3,segment.pt4,segment.pt2,shapePath,segmentCount,newShape);
                    newShape = false;
                    shapePath.c = false;
                }
                addedLength += currentLengthData.addedLength;
                segmentCount += 1;
            }
        }
        if(shapePaths[i].c){
            currentLengthData = lengths[j-1];
            if(addedLength <= shapeSegment.e){
                var segmentLength = lengths[j-1].addedLength;
                if(shapeSegment.s <= addedLength && shapeSegment.e >= addedLength + segmentLength){
                    this.addSegment(shapePaths[i].v[j-1],shapePaths[i].o[j-1],shapePaths[i].i[0],shapePaths[i].v[0],shapePath,segmentCount,newShape);
                    newShape = false;
                }else{
                    segment = bez.getNewSegment(shapePaths[i].v[j-1],shapePaths[i].v[0],shapePaths[i].o[j-1],shapePaths[i].i[0], (shapeSegment.s - addedLength)/segmentLength,(shapeSegment.e - addedLength)/segmentLength, lengths[j-1]);
                    this.addSegment(segment.pt1,segment.pt3,segment.pt4,segment.pt2,shapePath,segmentCount,newShape);
                    newShape = false;
                    shapePath.c = false;
                }
            } else {
                shapePath.c = false;
            }
            addedLength += currentLengthData.addedLength;
            segmentCount += 1;
        }
        if(shapePath._length){
            shapePath.setXYAt(shapePath.v[initPos][0],shapePath.v[initPos][1],'i',initPos);
            shapePath.setXYAt(shapePath.v[shapePath._length - 1][0],shapePath.v[shapePath._length - 1][1],'o',shapePath._length - 1);
        }
        if(addedLength > shapeSegment.e){
            break;
        }
        if(i<len-1){
            shapePath = shape_pool.newShape();
            newShape = true;
            shapes.push(shapePath);
            segmentCount = 0;
        }
    }
    return shapes;

}


ShapeModifiers.registerModifier('tm',TrimModifier);
function RoundCornersModifier(){};
extendPrototype(ShapeModifier,RoundCornersModifier);
RoundCornersModifier.prototype.processKeys = function(forceRender){
    if(this.elem.globalData.frameId === this.frameId && !forceRender){
        return;
    }
    this.mdf = forceRender ? true : false;
    this.frameId = this.elem.globalData.frameId;
    var i, len = this.dynamicProperties.length;

    for(i=0;i<len;i+=1){
        this.dynamicProperties[i].getValue();
        if(this.dynamicProperties[i].mdf){
            this.mdf = true;
        }
    }
}
RoundCornersModifier.prototype.initModifierProperties = function(elem,data){
    this.getValue = this.processKeys;
    this.rd = PropertyFactory.getProp(elem,data.r,0,null,this.dynamicProperties);
    if(!this.dynamicProperties.length){
        this.getValue(true);
    }
};

RoundCornersModifier.prototype.processPath = function(path, round){
    var cloned_path = shape_pool.newShape();
    cloned_path.c = path.c;
    var i, len = path._length;
    var currentV,currentI,currentO,closerV, newV,newO,newI,distance,newPosPerc,index = 0;
    var vX,vY,oX,oY,iX,iY;
    for(i=0;i<len;i+=1){
        currentV = path.v[i];
        currentO = path.o[i];
        currentI = path.i[i];
        if(currentV[0]===currentO[0] && currentV[1]===currentO[1] && currentV[0]===currentI[0] && currentV[1]===currentI[1]){
            if((i===0 || i === len - 1) && !path.c){
                cloned_path.setTripleAt(currentV[0],currentV[1],currentO[0],currentO[1],currentI[0],currentI[1],index);
                /*cloned_path.v[index] = currentV;
                cloned_path.o[index] = currentO;
                cloned_path.i[index] = currentI;*/
                index += 1;
            } else {
                if(i===0){
                    closerV = path.v[len-1];
                } else {
                    closerV = path.v[i-1];
                }
                distance = Math.sqrt(Math.pow(currentV[0]-closerV[0],2)+Math.pow(currentV[1]-closerV[1],2));
                newPosPerc = distance ? Math.min(distance/2,round)/distance : 0;
                vX = iX = currentV[0]+(closerV[0]-currentV[0])*newPosPerc;
                vY = iY = currentV[1]-(currentV[1]-closerV[1])*newPosPerc;
                oX = vX-(vX-currentV[0])*roundCorner;
                oY = vY-(vY-currentV[1])*roundCorner;
                cloned_path.setTripleAt(vX,vY,oX,oY,iX,iY,index);
                /*newV = [currentV[0]+(closerV[0]-currentV[0])*newPosPerc,currentV[1]-(currentV[1]-closerV[1])*newPosPerc];
                newI = newV;
                newO = [newV[0]-(newV[0]-currentV[0])*roundCorner,newV[1]-(newV[1]-currentV[1])*roundCorner];
                cloned_path.v[index] = newV;
                cloned_path.i[index] = newI;
                cloned_path.o[index] = newO;*/
                index += 1;

                if(i === len - 1){
                    closerV = path.v[0];
                } else {
                    closerV = path.v[i+1];
                }
                distance = Math.sqrt(Math.pow(currentV[0]-closerV[0],2)+Math.pow(currentV[1]-closerV[1],2));
                newPosPerc = distance ? Math.min(distance/2,round)/distance : 0;
                vX = oX = currentV[0]+(closerV[0]-currentV[0])*newPosPerc;
                vY = oY = currentV[1]+(closerV[1]-currentV[1])*newPosPerc;
                iX = vX-(vX-currentV[0])*roundCorner;
                iY = vY-(vY-currentV[1])*roundCorner;
                cloned_path.setTripleAt(vX,vY,oX,oY,iX,iY,index);

                /*newV = [currentV[0]+(closerV[0]-currentV[0])*newPosPerc,currentV[1]+(closerV[1]-currentV[1])*newPosPerc];
                newI = [newV[0]-(newV[0]-currentV[0])*roundCorner,newV[1]-(newV[1]-currentV[1])*roundCorner];
                newO = newV;
                cloned_path.v[index] = newV;
                cloned_path.i[index] = newI;
                cloned_path.o[index] = newO;*/
                index += 1;
            }
        } else {
            /*cloned_path.v[index] = path.v[i];
            cloned_path.o[index] = path.o[i];
            cloned_path.i[index] = path.i[i];*/
            cloned_path.setTripleAt(path.v[i][0],path.v[i][1],path.o[i][0],path.o[i][1],path.i[i][0],path.i[i][1],index);
            index += 1;
        }
    }
    return cloned_path;
}

RoundCornersModifier.prototype.processShapes = function(firstFrame){
    var shapePaths;
    var i, len = this.shapes.length;
    var j, jLen;
    var rd = this.rd.v;

    if(rd !== 0){
        var shapeData, newPaths, localShapeCollection;
        for(i=0;i<len;i+=1){
            shapeData = this.shapes[i];
            newPaths = shapeData.shape.paths;
            localShapeCollection = shapeData.localShapeCollection;
            if(!(!shapeData.shape.mdf && !this.mdf && !firstFrame)){
                localShapeCollection.releaseShapes();
                shapeData.shape.mdf = true;
                shapePaths = shapeData.shape.paths.shapes;
                jLen = shapeData.shape.paths._length;
                for(j=0;j<jLen;j+=1){
                    localShapeCollection.addShape(this.processPath(shapePaths[j],rd));
                }
            }
            shapeData.shape.paths = shapeData.localShapeCollection;
        }

    }
    if(!this.dynamicProperties.length){
        this.mdf = false;
    }
}


ShapeModifiers.registerModifier('rd',RoundCornersModifier);
function RepeaterModifier(){};
RepeaterModifier.prototype.processKeys = function(forceRender){
    if(this.elem.globalData.frameId === this.frameId && !forceRender){
        return;
    }
    this.mdf = forceRender ? true : false;
    var i, len = this.dynamicProperties.length;

    for(i=0;i<len;i+=1){
        this.dynamicProperties[i].getValue();
        if(this.dynamicProperties[i].mdf){
            this.mdf = true;
        }
    }
};

RepeaterModifier.prototype.initModifierProperties = function(elem,data){
    this.getValue = this.processKeys;
    this.c = PropertyFactory.getProp(elem,data.c,0,null,this.dynamicProperties);
    this.o = PropertyFactory.getProp(elem,data.o,0,null,this.dynamicProperties);
    this.tr = PropertyFactory.getProp(elem,data.tr,2,null,this.dynamicProperties);
    this.data = data;
    if(!this.dynamicProperties.length){
        this.getValue(true);
    }
    this.pMatrix = new Matrix();
    this.rMatrix = new Matrix();
    this.sMatrix = new Matrix();
    this.tMatrix = new Matrix();
    this.matrix = new Matrix();
};

RepeaterModifier.prototype.applyTransforms = function(pMatrix, rMatrix, sMatrix, transform, perc, inv){
    var dir = inv ? -1 : 1;
    var scaleX = transform.s.v[0] + (1 - transform.s.v[0]) * (1 - perc);
    var scaleY = transform.s.v[1] + (1 - transform.s.v[1]) * (1 - perc);
    pMatrix.translate(transform.p.v[0] * dir * perc, transform.p.v[1] * dir * perc, transform.p.v[2]);
    rMatrix.translate(-transform.a.v[0], -transform.a.v[1], transform.a.v[2]);
    rMatrix.rotate(-transform.r.v * dir * perc);
    rMatrix.translate(transform.a.v[0], transform.a.v[1], transform.a.v[2]);
    sMatrix.translate(-transform.a.v[0], -transform.a.v[1], transform.a.v[2]);
    sMatrix.scale(inv ? 1/scaleX : scaleX, inv ? 1/scaleY : scaleY);
    sMatrix.translate(transform.a.v[0], transform.a.v[1], transform.a.v[2]);
}

RepeaterModifier.prototype.init = function(elem, arr, pos, elemsData, dynamicProperties) {
    this.elem = elem;
    this.arr = arr;
    this.pos = pos;
    this.elemsData = elemsData;
    this._currentCopies = 0;
    this._elements = [];
    this._groups = [];
    this.dynamicProperties = [];
    this.frameId = -1;
    this.initModifierProperties(elem,arr[pos]);
    var cont = 0;
    while(pos>0){
        pos -= 1;
        //this._elements.unshift(arr.splice(pos,1)[0]);
        this._elements.unshift(arr[pos]);
        cont += 1;
    }
    if(this.dynamicProperties.length){
        this.k = true;
        dynamicProperties.push(this);
    }else{
        this.getValue(true);
    }
}

RepeaterModifier.prototype.resetElements = function(elements){
    var i, len = elements.length;
    for(i = 0; i < len; i += 1) {
        elements[i]._processed = false;
        if(elements[i].ty === 'gr'){
            this.resetElements(elements[i].it);
        }
    }
}

RepeaterModifier.prototype.cloneElements = function(elements){
    var i, len = elements.length;
    var newElements = JSON.parse(JSON.stringify(elements));
    this.resetElements(newElements);
    return newElements;
}

RepeaterModifier.prototype.changeGroupRender = function(elements, renderFlag) {
    var i, len = elements.length;
    for(i = 0; i < len ; i += 1) {
        elements[i]._render = renderFlag;
        if(elements[i].ty === 'gr') {
            this.changeGroupRender(elements[i].it, renderFlag);
        }
    }
}

RepeaterModifier.prototype.processShapes = function(firstFrame){

    if(this.elem.globalData.frameId === this.frameId){
        return;
    }
    this.frameId = this.elem.globalData.frameId;
    if(!this.dynamicProperties.length && !firstFrame){
        this.mdf = false;
    }
    if(this.mdf){
        var copies = Math.ceil(this.c.v);
        if(this._groups.length < copies){
            while(this._groups.length < copies){
                var group = {
                    it:this.cloneElements(this._elements),
                    ty:'gr'
                }
                group.it.push({"a":{"a":0,"ix":1,"k":[0,0]},"nm":"Transform","o":{"a":0,"ix":7,"k":100},"p":{"a":0,"ix":2,"k":[0,0]},"r":{"a":0,"ix":6,"k":0},"s":{"a":0,"ix":3,"k":[100,100]},"sa":{"a":0,"ix":5,"k":0},"sk":{"a":0,"ix":4,"k":0},"ty":"tr"});
                
                this.arr.splice(0,0,group);
                this._groups.splice(0,0,group);
                this._currentCopies += 1;
            }
            this.elem.reloadShapes();
        }
        var i, cont = 0, renderFlag;
        for(i = 0; i  <= this._groups.length - 1; i += 1){
            renderFlag = cont < copies;
            this._groups[i]._render = renderFlag;
            this.changeGroupRender(this._groups[i].it, renderFlag);
            cont += 1;
        }
        
        this._currentCopies = copies;
        this.elem.firstFrame = true;
        ////

        var offset = this.o.v;
        var offsetModulo = offset%1;
        var roundOffset = offset > 0 ? Math.floor(offset) : Math.ceil(offset);
        var k;
        var tMat = this.tr.v.props;
        var pProps = this.pMatrix.props;
        var rProps = this.rMatrix.props;
        var sProps = this.sMatrix.props;
        this.pMatrix.reset();
        this.rMatrix.reset();
        this.sMatrix.reset();
        this.tMatrix.reset();
        this.matrix.reset();
        var iteration = 0;

        if(offset > 0) {
            while(iteration<roundOffset){
                this.applyTransforms(this.pMatrix, this.rMatrix, this.sMatrix, this.tr, 1, false);
                iteration += 1;
            }
            if(offsetModulo){
                this.applyTransforms(this.pMatrix, this.rMatrix, this.sMatrix, this.tr, offsetModulo, false);
                iteration += offsetModulo;
            }
        } else if(offset < 0) {
            while(iteration>roundOffset){
                this.applyTransforms(this.pMatrix, this.rMatrix, this.sMatrix, this.tr, 1, true);
                iteration -= 1;
            }
            if(offsetModulo){
                this.applyTransforms(this.pMatrix, this.rMatrix, this.sMatrix, this.tr, - offsetModulo, true);
                iteration -= offsetModulo;
            }
        }
        i = this.data.m === 1 ? 0 : this._currentCopies - 1;
        var dir = this.data.m === 1 ? 1 : -1;
        cont = this._currentCopies;
        while(cont){
            if(iteration !== 0){
                if((i !== 0 && dir === 1) || (i !== this._currentCopies - 1 && dir === -1)){
                    this.applyTransforms(this.pMatrix, this.rMatrix, this.sMatrix, this.tr, 1, false);
                }
                this.matrix.transform(rProps[0],rProps[1],rProps[2],rProps[3],rProps[4],rProps[5],rProps[6],rProps[7],rProps[8],rProps[9],rProps[10],rProps[11],rProps[12],rProps[13],rProps[14],rProps[15]);
                this.matrix.transform(sProps[0],sProps[1],sProps[2],sProps[3],sProps[4],sProps[5],sProps[6],sProps[7],sProps[8],sProps[9],sProps[10],sProps[11],sProps[12],sProps[13],sProps[14],sProps[15]);
                this.matrix.transform(pProps[0],pProps[1],pProps[2],pProps[3],pProps[4],pProps[5],pProps[6],pProps[7],pProps[8],pProps[9],pProps[10],pProps[11],pProps[12],pProps[13],pProps[14],pProps[15]);
                var items = this.elemsData[i].it;
                var itemsTransform = items[items.length - 1].transform.mProps.v.props;
                var j, jLen = itemsTransform.length;
                for(j=0;j<jLen;j+=1) {
                    itemsTransform[j] = this.matrix.props[j];
                }
                this.matrix.reset();
            } else {
                this.matrix.reset();
                var items = this.elemsData[i].it;
                var itemsTransform = items[items.length - 1].transform.mProps.v.props;
                var j, jLen = itemsTransform.length;
                for(j=0;j<jLen;j+=1) {
                    itemsTransform[j] = this.matrix.props[j];
                }
            }
            iteration += 1;
            cont -= 1;
            i += dir;
        }
    }
}

RepeaterModifier.prototype.addShape = function(){}

ShapeModifiers.registerModifier('rp',RepeaterModifier);
function ShapeCollection(){
	this._length = 0;
	this._maxLength = 4;
	this.shapes = Array.apply(null,{length:this._maxLength});
};

ShapeCollection.prototype.addShape = function(shapeData){
	if(this._length === this._maxLength){
		this.shapes = this.shapes.concat(Array.apply(null,{length:this._maxLength}));
		this._maxLength *= 2;
	}
	this.shapes[this._length] = shapeData;
	this._length += 1;
};

ShapeCollection.prototype.releaseShapes = function(){
	var i;
	for(i = 0; i < this._length; i += 1) {
		shape_pool.release(this.shapes[i]);
	}
	this._length = 0;
};
var ImagePreloader = (function(){

    function imageLoaded(){
        this.loadedAssets += 1;
        if(this.loadedAssets === this.totalImages){
        }
    }

    function getAssetsPath(assetData){
        var path = '';
        if(this.assetsPath){
            var imagePath = assetData.p;
            if(imagePath.indexOf('images/') !== -1){
                imagePath = imagePath.split('/')[1];
            }
            path = this.assetsPath + imagePath;
        } else {
            path = this.path;
            path += assetData.u ? assetData.u : '';
            path += assetData.p;
        }
        return path;
    }

    function loadImage(path){
        var img = document.createElement('img');
        img.addEventListener('load', imageLoaded.bind(this), false);
        img.addEventListener('error', imageLoaded.bind(this), false);
        img.src = path;
    }
    function loadAssets(assets){
        this.totalAssets = assets.length;
        var i;
        for(i=0;i<this.totalAssets;i+=1){
            if(!assets[i].layers){
                loadImage.bind(this)(getAssetsPath.bind(this)(assets[i]));
                this.totalImages += 1;
            }
        }
    }

    function setPath(path){
        this.path = path || '';
    }

    function setAssetsPath(path){
        this.assetsPath = path || '';
    }

    return function ImagePreloader(){
        this.loadAssets = loadAssets;
        this.setAssetsPath = setAssetsPath;
        this.setPath = setPath;
        this.assetsPath = '';
        this.path = '';
        this.totalAssets = 0;
        this.totalImages = 0;
        this.loadedAssets = 0;
    }
}());
var featureSupport = (function(){
	var ob = {
		maskType: true
	}
	if (/MSIE 10/i.test(navigator.userAgent) || /MSIE 9/i.test(navigator.userAgent) || /rv:11.0/i.test(navigator.userAgent) || /Edge\/\d./i.test(navigator.userAgent)) {
	   ob.maskType = false;
	}
	return ob;
}());
var filtersFactory = (function(){
	var ob = {};
	ob.createFilter = createFilter;
	ob.createAlphaToLuminanceFilter = createAlphaToLuminanceFilter;

	function createFilter(filId){
        	var fil = document.createElementNS(svgNS,'filter');
        	fil.setAttribute('id',filId);
                fil.setAttribute('filterUnits','objectBoundingBox');
                fil.setAttribute('x','0%');
                fil.setAttribute('y','0%');
                fil.setAttribute('width','100%');
                fil.setAttribute('height','100%');
                return fil;
	}

	function createAlphaToLuminanceFilter(){
                var feColorMatrix = document.createElementNS(svgNS,'feColorMatrix');
                feColorMatrix.setAttribute('type','matrix');
                feColorMatrix.setAttribute('color-interpolation-filters','sRGB');
                feColorMatrix.setAttribute('values','0 0 0 1 0  0 0 0 1 0  0 0 0 1 0  0 0 0 0 1');
                return feColorMatrix;
	}

	return ob;
}())
var pooling = (function(){

	function double(arr){
		return arr.concat(Array.apply(null,{length:arr.length}))
	}

	return {
		double: double
	}
}());
var point_pool = (function(){
	var ob = {
		newPoint: newPoint,
		release: release
		/*,getLength:function(){return _length}
		,getCont:function(){return cont}*/
	}

	var _length = 0;
	var _maxLength = 8;
	var pool = Array.apply(null,{length:_maxLength});

	//var cont = 0;

	function newPoint(){
		//window.bm_newPoint = window.bm_newPoint ? window.bm_newPoint + 1 : 1;
		var point;
		if(_length){
			_length -= 1;
			point = pool[_length];
			//window.bm_reuse = window.bm_reuse ? window.bm_reuse + 1 : 1;
		} else {
			point = [0.1,0.1];
			//cont++;
			//console.log('new');
			//window.bm_new = window.bm_new ? window.bm_new + 1 : 1;
			//point._tst = cont++;
		}
		return point;
	}

	function release(point) {
		if(_length === _maxLength) {
			pool = pooling.double(pool);
			_maxLength = _maxLength*2;
		}
		pool[_length] = point;
		_length += 1;
		//window.bm_release = window.bm_release ? window.bm_release + 1 : 1;
		//console.log('release');
	}


	return ob;
}());
var shape_pool = (function(){
	var ob = {
		clone: clone,
		newShape: newShape,
		release: release,
		releaseArray: releaseArray
	}

	var _length = 0;
	var _maxLength = 4;
	var pool = Array.apply(null,{length:_maxLength});

	function newShape(){
		var shapePath;
		if(_length){
			_length -= 1;
			shapePath = pool[_length];
		} else {
			shapePath = new ShapePath();
		}
		return shapePath;
	}

	function release(shapePath) {
		if(_length === _maxLength) {
			pool = pooling.double(pool);
			_maxLength = _maxLength*2;
		}
		var len = shapePath._length, i;
		for(i = 0; i < len; i += 1) {
			point_pool.release(shapePath.v[i]);
			point_pool.release(shapePath.i[i]);
			point_pool.release(shapePath.o[i]);
			shapePath.v[i] = null;
			shapePath.i[i] = null;
			shapePath.o[i] = null;
		}
		shapePath._length = 0;
		shapePath.c = false;
		pool[_length] = shapePath;
		_length += 1;
	}

	function releaseArray(shapePathsCollection, length) {
		while(length--) {
			release(shapePathsCollection[length]);
		}
	}

	function clone(shape, transform) {
		var i, len = shape._length;
		var cloned = newShape();
		cloned._length = shape._length;
		cloned.c = shape.c;

		var pt;
		
		for(i = 0; i < len; i += 1) {
			if(transform){
				pt = transform.applyToPointArray(shape.v[i][0],shape.v[i][1],0,2);
				cloned.setXYAt(pt[0],pt[1],'v',i);
				point_pool.release(pt);
				pt = transform.applyToPointArray(shape.o[i][0],shape.o[i][1],0,2);
				cloned.setXYAt(pt[0],pt[1],'o',i);
				point_pool.release(pt);
				pt = transform.applyToPointArray(shape.i[i][0],shape.i[i][1],0,2);
				cloned.setXYAt(pt[0],pt[1],'i',i);
				point_pool.release(pt);
			}else{
				cloned.setTripleAt(shape.v[i][0],shape.v[i][1],shape.o[i][0],shape.o[i][1],shape.i[i][0],shape.i[i][1], i);
			}
		}
		return cloned
	}


	return ob;
}());
var shapeCollection_pool = (function(){
	var ob = {
		newShapeCollection: newShapeCollection,
		release: release,
		clone: clone
	}

	var _length = 0;
	var _maxLength = 4;
	var pool = Array.apply(null,{length:_maxLength});

	var cont = 0;

	function newShapeCollection(){
		var shapeCollection;
		if(_length){
			_length -= 1;
			shapeCollection = pool[_length];
		} else {
			shapeCollection = new ShapeCollection();
		}
		return shapeCollection;
	}

	function release(shapeCollection) {
		var i, len = shapeCollection._length;
		for(i = 0; i < len; i += 1) {
			shape_pool.release(shapeCollection.shapes[i]);
		}
		shapeCollection._length = 0;

		if(_length === _maxLength) {
			pool = pooling.double(pool);
			_maxLength = _maxLength*2;
		}
		pool[_length] = shapeCollection;
		_length += 1;
	}

	function clone(shapeCollection, originCollection) {
		release(shapeCollection);
		if(_length === _maxLength) {
			pool = pooling.double(pool);
			_maxLength = _maxLength*2;
		}
		pool[_length] = shapeCollection;
		_length += 1;
	}


	return ob;
}());
function BaseRenderer(){}
BaseRenderer.prototype.checkLayers = function(num){
    var i, len = this.layers.length, data;
    this.completeLayers = true;
    for (i = len - 1; i >= 0; i--) {
        if (!this.elements[i]) {
            data = this.layers[i];
            if(data.ip - data.st <= (num - this.layers[i].st) && data.op - data.st > (num - this.layers[i].st))
            {
                this.buildItem(i);
            }
        }
        this.completeLayers = this.elements[i] ? this.completeLayers:false;
    }
    this.checkPendingElements();
};

BaseRenderer.prototype.createItem = function(layer){
    switch(layer.ty){
        case 2:
            return this.createImage(layer);
        case 0:
            return this.createComp(layer);
        case 1:
            return this.createSolid(layer);
        case 4:
            return this.createShape(layer);
        case 5:
            return this.createText(layer);
        case 13:
            return this.createCamera(layer);
        case 99:
            return null;
    }
    return this.createBase(layer);
};

BaseRenderer.prototype.createCamera = function(){
    throw new Error('You\'re using a 3d camera. Try the html renderer.');
}

BaseRenderer.prototype.buildAllItems = function(){
    var i, len = this.layers.length;
    for(i=0;i<len;i+=1){
        this.buildItem(i);
    }
    this.checkPendingElements();
};

BaseRenderer.prototype.includeLayers = function(newLayers){
    this.completeLayers = false;
    var i, len = newLayers.length;
    var j, jLen = this.layers.length;
    for(i=0;i<len;i+=1){
        j = 0;
        while(j<jLen){
            if(this.layers[j].id == newLayers[i].id){
                this.layers[j] = newLayers[i];
                break;
            }
            j += 1;
        }
    }
};

BaseRenderer.prototype.setProjectInterface = function(pInterface){
    this.globalData.projectInterface = pInterface;
};

BaseRenderer.prototype.initItems = function(){
    if(!this.globalData.progressiveLoad){
        this.buildAllItems();
    }
};
BaseRenderer.prototype.buildElementParenting = function(element, parentName, hierarchy){
    hierarchy = hierarchy || [];
    var elements = this.elements;
    var layers = this.layers;
    var i=0, len = layers.length;
    while(i<len){
        if(layers[i].ind == parentName){
            if(!elements[i] || elements[i] === true){
                this.buildItem(i);
                this.addPendingElement(element);
            } else if(layers[i].parent !== undefined){
                hierarchy.push(elements[i]);
                elements[i]._isParent = true;
                this.buildElementParenting(element,layers[i].parent, hierarchy);
            } else {
                hierarchy.push(elements[i]);
                elements[i]._isParent = true;
                element.setHierarchy(hierarchy);
            }


        }
        i += 1;
    }
};

BaseRenderer.prototype.addPendingElement = function(element){
    this.pendingElements.push(element);
};
function SVGRenderer(animationItem, config){
    this.animationItem = animationItem;
    this.layers = null;
    this.renderedFrame = -1;
    this.globalData = {
        frameNum: -1
    };
    this.renderConfig = {
        preserveAspectRatio: (config && config.preserveAspectRatio) || 'xMidYMid meet',
        progressiveLoad: (config && config.progressiveLoad) || false,
        hideOnTransparent: (config && config.hideOnTransparent === false) ? false : true
    };
    this.globalData.renderConfig = this.renderConfig;
    this.elements = [];
    this.pendingElements = [];
    this.destroyed = false;

}

extendPrototype(BaseRenderer,SVGRenderer);

SVGRenderer.prototype.createBase = function (data) {
    return new SVGBaseElement(data, this.layerElement,this.globalData,this);
};

SVGRenderer.prototype.createShape = function (data) {
    return new IShapeElement(data, this.layerElement,this.globalData,this);
};

SVGRenderer.prototype.createText = function (data) {
    return new SVGTextElement(data, this.layerElement,this.globalData,this);

};

SVGRenderer.prototype.createImage = function (data) {
    return new IImageElement(data, this.layerElement,this.globalData,this);
};

SVGRenderer.prototype.createComp = function (data) {
    return new ICompElement(data, this.layerElement,this.globalData,this);

};

SVGRenderer.prototype.createSolid = function (data) {
    return new ISolidElement(data, this.layerElement,this.globalData,this);
};

SVGRenderer.prototype.configAnimation = function(animData){
    this.layerElement = document.createElementNS(svgNS,'svg');
    this.layerElement.setAttribute('xmlns','http://www.w3.org/2000/svg');
    this.layerElement.setAttribute('width',animData.w);
    this.layerElement.setAttribute('height',animData.h);
    this.layerElement.setAttribute('viewBox','0 0 '+animData.w+' '+animData.h);
    this.layerElement.setAttribute('preserveAspectRatio',this.renderConfig.preserveAspectRatio);
    this.layerElement.style.width = '100%';
    this.layerElement.style.height = '100%';
    //this.layerElement.style.transform = 'translate3d(0,0,0)';
    //this.layerElement.style.transformOrigin = this.layerElement.style.mozTransformOrigin = this.layerElement.style.webkitTransformOrigin = this.layerElement.style['-webkit-transform'] = "0px 0px 0px";
    this.animationItem.wrapper.appendChild(this.layerElement);
    //Mask animation
    var defs = document.createElementNS(svgNS, 'defs');
    this.globalData.defs = defs;
    this.layerElement.appendChild(defs);
    this.globalData.getAssetData = this.animationItem.getAssetData.bind(this.animationItem);
    this.globalData.getAssetsPath = this.animationItem.getAssetsPath.bind(this.animationItem);
    this.globalData.progressiveLoad = this.renderConfig.progressiveLoad;
    this.globalData.frameId = 0;
    this.globalData.nm = animData.nm;
    this.globalData.compSize = {
        w: animData.w,
        h: animData.h
    };
    this.data = animData;
    this.globalData.frameRate = animData.fr;
    var maskElement = document.createElementNS(svgNS, 'clipPath');
    var rect = document.createElementNS(svgNS,'rect');
    rect.setAttribute('width',animData.w);
    rect.setAttribute('height',animData.h);
    rect.setAttribute('x',0);
    rect.setAttribute('y',0);
    var maskId = 'animationMask_'+randomString(10);
    maskElement.setAttribute('id', maskId);
    maskElement.appendChild(rect);
    var maskedElement = document.createElementNS(svgNS,'g');
    maskedElement.setAttribute("clip-path", "url(#"+maskId+")");
    this.layerElement.appendChild(maskedElement);
    defs.appendChild(maskElement);
    this.layerElement = maskedElement;
    this.layers = animData.layers;
    this.globalData.fontManager = new FontManager();
    this.globalData.fontManager.addChars(animData.chars);
    this.globalData.fontManager.addFonts(animData.fonts,defs);
    this.elements = Array.apply(null,{length:animData.layers.length});
};


SVGRenderer.prototype.destroy = function () {
    this.animationItem.wrapper.innerHTML = '';
    this.layerElement = null;
    this.globalData.defs = null;
    var i, len = this.layers ? this.layers.length : 0;
    for (i = 0; i < len; i++) {
        if(this.elements[i]){
            this.elements[i].destroy();
        }
    }
    this.elements.length = 0;
    this.destroyed = true;
    this.animationItem = null;
};

SVGRenderer.prototype.updateContainerSize = function () {
};

SVGRenderer.prototype.buildItem  = function(pos){
    var elements = this.elements;
    if(elements[pos] || this.layers[pos].ty == 99){
        return;
    }
    elements[pos] = true;
    var element = this.createItem(this.layers[pos]);

    elements[pos] = element;
    if(expressionsPlugin){
        if(this.layers[pos].ty === 0){
            this.globalData.projectInterface.registerComposition(element);
        }
        element.initExpressions();
    }
    this.appendElementInPos(element,pos);
    if(this.layers[pos].tt){
        if(!this.elements[pos - 1] || this.elements[pos - 1] === true){
            this.buildItem(pos - 1);
            this.addPendingElement(element);
        } else {
            element.setMatte(elements[pos - 1].layerId);
        }
    }
};

SVGRenderer.prototype.checkPendingElements  = function(){
    while(this.pendingElements.length){
        var element = this.pendingElements.pop();
        element.checkParenting();
        if(element.data.tt){
            var i = 0, len = this.elements.length;
            while(i<len){
                if(this.elements[i] === element){
                    element.setMatte(this.elements[i - 1].layerId);
                    break;
                }
                i += 1;
            }
        }
    }
};

SVGRenderer.prototype.renderFrame = function(num){
    if(this.renderedFrame == num || this.destroyed){
        return;
    }
    if(num === null){
        num = this.renderedFrame;
    }else{
        this.renderedFrame = num;
    }
    //clearPoints();
    /*console.log('-------');
    console.log('FRAME ',num);*/
    this.globalData.frameNum = num;
    this.globalData.frameId += 1;
    this.globalData.projectInterface.currentFrame = num;
    var i, len = this.layers.length;
    if(!this.completeLayers){
        this.checkLayers(num);
    }
    for (i = len - 1; i >= 0; i--) {
        if(this.completeLayers || this.elements[i]){
            this.elements[i].prepareFrame(num - this.layers[i].st);
        }
    }
    for (i = len - 1; i >= 0; i--) {
        if(this.completeLayers || this.elements[i]){
            this.elements[i].renderFrame();
        }
    }
};

SVGRenderer.prototype.appendElementInPos = function(element, pos){
    var newElement = element.getBaseElement();
    if(!newElement){
        return;
    }
    var i = 0;
    var nextElement;
    while(i<pos){
        if(this.elements[i] && this.elements[i]!== true && this.elements[i].getBaseElement()){
            nextElement = this.elements[i].getBaseElement();
        }
        i += 1;
    }
    if(nextElement){
        this.layerElement.insertBefore(newElement, nextElement);
    } else {
        this.layerElement.appendChild(newElement);
    }
};

SVGRenderer.prototype.hide = function(){
    this.layerElement.style.display = 'none';
};

SVGRenderer.prototype.show = function(){
    this.layerElement.style.display = 'block';
};

SVGRenderer.prototype.searchExtraCompositions = function(assets){
    var i, len = assets.length;
    var floatingContainer = document.createElementNS(svgNS,'g');
    for(i=0;i<len;i+=1){
        if(assets[i].xt){
            var comp = this.createComp(assets[i],floatingContainer,this.globalData.comp,null);
            comp.initExpressions();
            //comp.compInterface = CompExpressionInterface(comp);
            //Expressions.addLayersInterface(comp.elements, this.globalData.projectInterface);
            this.globalData.projectInterface.registerComposition(comp);
        }
    }
};

function MaskElement(data,element,globalData) {
    this.dynamicProperties = [];
    this.data = data;
    this.element = element;
    this.globalData = globalData;
    this.paths = [];
    this.storedData = [];
    this.masksProperties = this.data.masksProperties;
    this.viewData = new Array(this.masksProperties.length);
    this.maskElement = null;
    this.firstFrame = true;
    var defs = this.globalData.defs;
    var i, len = this.masksProperties.length;


    var path, properties = this.masksProperties;
    var count = 0;
    var currentMasks = [];
    var j, jLen;
    var layerId = randomString(10);
    var rect, expansor, feMorph,x;
    var maskType = 'clipPath', maskRef = 'clip-path';
    for (i = 0; i < len; i++) {

        if((properties[i].mode !== 'a' && properties[i].mode !== 'n')|| properties[i].inv || properties[i].o.k !== 100){
            maskType = 'mask';
            maskRef = 'mask';
        }

        if((properties[i].mode == 's' || properties[i].mode == 'i') && count == 0){
            rect = document.createElementNS(svgNS, 'rect');
            rect.setAttribute('fill', '#ffffff');
            rect.setAttribute('width', this.element.comp.data.w);
            rect.setAttribute('height', this.element.comp.data.h);
            currentMasks.push(rect);
        } else {
            rect = null;
        }

        path = document.createElementNS(svgNS, 'path');
        if(properties[i].mode == 'n') {
            this.viewData[i] = {
                op: PropertyFactory.getProp(this.element,properties[i].o,0,0.01,this.dynamicProperties),
                prop: ShapePropertyFactory.getShapeProp(this.element,properties[i],3,this.dynamicProperties,null),
                elem: path
            };
            defs.appendChild(path);
            continue;
        }
        count += 1;

        if(properties[i].mode == 's'){
            path.setAttribute('fill', '#000000');
        }else{
            path.setAttribute('fill', '#ffffff');
        }
        path.setAttribute('clip-rule','nonzero');

        if(properties[i].x.k !== 0){
            maskType = 'mask';
            maskRef = 'mask';
            x = PropertyFactory.getProp(this.element,properties[i].x,0,null,this.dynamicProperties);
            var filterID = 'fi_'+randomString(10);
            expansor = document.createElementNS(svgNS,'filter');
            expansor.setAttribute('id',filterID);
            feMorph = document.createElementNS(svgNS,'feMorphology');
            feMorph.setAttribute('operator','dilate');
            feMorph.setAttribute('in','SourceGraphic');
            feMorph.setAttribute('radius','0');
            expansor.appendChild(feMorph);
            defs.appendChild(expansor);
            if(properties[i].mode == 's'){
                path.setAttribute('stroke', '#000000');
            }else{
                path.setAttribute('stroke', '#ffffff');
            }
        }else{
            feMorph = null;
            x = null;
        }


        this.storedData[i] = {
             elem: path,
             x: x,
             expan: feMorph,
            lastPath: '',
            lastOperator:'',
            filterId:filterID,
            lastRadius:0
        };
        if(properties[i].mode == 'i'){
            jLen = currentMasks.length;
            var g = document.createElementNS(svgNS,'g');
            for(j=0;j<jLen;j+=1){
                g.appendChild(currentMasks[j]);
            }
            var mask = document.createElementNS(svgNS,'mask');
            mask.setAttribute('mask-type','alpha');
            mask.setAttribute('id',layerId+'_'+count);
            mask.appendChild(path);
            defs.appendChild(mask);
            g.setAttribute('mask','url(#'+layerId+'_'+count+')');

            currentMasks.length = 0;
            currentMasks.push(g);
        }else{
            currentMasks.push(path);
        }
        if(properties[i].inv && !this.solidPath){
            this.solidPath = this.createLayerSolidPath();
        }
        this.viewData[i] = {
            elem: path,
            lastPath: '',
            op: PropertyFactory.getProp(this.element,properties[i].o,0,0.01,this.dynamicProperties),
            prop:ShapePropertyFactory.getShapeProp(this.element,properties[i],3,this.dynamicProperties,null)
        };
        if(rect){
            this.viewData[i].invRect = rect;
        }
        if(!this.viewData[i].prop.k){
            this.drawPath(properties[i],this.viewData[i].prop.v,this.viewData[i]);
        }
    }

    this.maskElement = document.createElementNS(svgNS, maskType);

    len = currentMasks.length;
    for(i=0;i<len;i+=1){
        this.maskElement.appendChild(currentMasks[i]);
    }

    this.maskElement.setAttribute('id', layerId);
    if(count > 0){
        this.element.maskedElement.setAttribute(maskRef, "url(#" + layerId + ")");
    }

    defs.appendChild(this.maskElement);
};

MaskElement.prototype.getMaskProperty = function(pos){
    return this.viewData[pos].prop;
};

MaskElement.prototype.prepareFrame = function(){
    var i, len = this.dynamicProperties.length;
    for(i=0;i<len;i+=1){
        this.dynamicProperties[i].getValue();

    }
};

MaskElement.prototype.renderFrame = function (finalMat) {
    var i, len = this.masksProperties.length;
    for (i = 0; i < len; i++) {
        if(this.viewData[i].prop.mdf || this.firstFrame){
            this.drawPath(this.masksProperties[i],this.viewData[i].prop.v,this.viewData[i]);
        }
        if(this.viewData[i].op.mdf || this.firstFrame){
            this.viewData[i].elem.setAttribute('fill-opacity',this.viewData[i].op.v);
        }
        if(this.masksProperties[i].mode !== 'n'){
            if(this.viewData[i].invRect && (this.element.finalTransform.mProp.mdf || this.firstFrame)){
                this.viewData[i].invRect.setAttribute('x', -finalMat.props[12]);
                this.viewData[i].invRect.setAttribute('y', -finalMat.props[13]);
            }
            if(this.storedData[i].x && (this.storedData[i].x.mdf || this.firstFrame)){
                var feMorph = this.storedData[i].expan;
                if(this.storedData[i].x.v < 0){
                    if(this.storedData[i].lastOperator !== 'erode'){
                        this.storedData[i].lastOperator = 'erode';
                        this.storedData[i].elem.setAttribute('filter','url(#'+this.storedData[i].filterId+')');
                    }
                    feMorph.setAttribute('radius',-this.storedData[i].x.v);
                }else{
                    if(this.storedData[i].lastOperator !== 'dilate'){
                        this.storedData[i].lastOperator = 'dilate';
                        this.storedData[i].elem.setAttribute('filter',null);
                    }
                    this.storedData[i].elem.setAttribute('stroke-width', this.storedData[i].x.v*2);

                }
            }
        }
    }
    this.firstFrame = false;
};

MaskElement.prototype.getMaskelement = function () {
    return this.maskElement;
};

MaskElement.prototype.createLayerSolidPath = function(){
    var path = 'M0,0 ';
    path += ' h' + this.globalData.compSize.w ;
    path += ' v' + this.globalData.compSize.h ;
    path += ' h-' + this.globalData.compSize.w ;
    path += ' v-' + this.globalData.compSize.h + ' ';
    return path;
};

MaskElement.prototype.drawPath = function(pathData,pathNodes,viewData){
    var pathString = " M"+pathNodes.v[0][0]+','+pathNodes.v[0][1];
    var i, len;
    len = pathNodes._length;
    for(i=1;i<len;i+=1){
        //pathString += " C"+pathNodes.o[i-1][0]+','+pathNodes.o[i-1][1] + " "+pathNodes.i[i][0]+','+pathNodes.i[i][1] + " "+pathNodes.v[i][0]+','+pathNodes.v[i][1];
        pathString += " C"+bm_rnd(pathNodes.o[i-1][0])+','+bm_rnd(pathNodes.o[i-1][1]) + " "+bm_rnd(pathNodes.i[i][0])+','+bm_rnd(pathNodes.i[i][1]) + " "+bm_rnd(pathNodes.v[i][0])+','+bm_rnd(pathNodes.v[i][1]);
    }
        //pathString += " C"+pathNodes.o[i-1][0]+','+pathNodes.o[i-1][1] + " "+pathNodes.i[0][0]+','+pathNodes.i[0][1] + " "+pathNodes.v[0][0]+','+pathNodes.v[0][1];
    if(pathNodes.c && len > 1){
        pathString += " C"+bm_rnd(pathNodes.o[i-1][0])+','+bm_rnd(pathNodes.o[i-1][1]) + " "+bm_rnd(pathNodes.i[0][0])+','+bm_rnd(pathNodes.i[0][1]) + " "+bm_rnd(pathNodes.v[0][0])+','+bm_rnd(pathNodes.v[0][1]);
    }
    //pathNodes.__renderedString = pathString;


    if(viewData.lastPath !== pathString){
        if(viewData.elem){
            if(!pathNodes.c){
                viewData.elem.setAttribute('d','');
            }else if(pathData.inv){
                viewData.elem.setAttribute('d',this.solidPath + pathString);
            }else{
                viewData.elem.setAttribute('d',pathString);
            }
        }
        viewData.lastPath = pathString;
    }
};

MaskElement.prototype.getMask = function(nm){
    var i = 0, len = this.masksProperties.length;
    while(i<len){
        if(this.masksProperties[i].nm === nm){
            return {
                maskPath: this.viewData[i].prop.pv
            }
        }
        i += 1;
    }
};

MaskElement.prototype.destroy = function(){
    this.element = null;
    this.globalData = null;
    this.maskElement = null;
    this.data = null;
    this.paths = null;
    this.masksProperties = null;
};
function BaseElement(){
};
BaseElement.prototype.checkMasks = function(){
    if(!this.data.hasMask){
        return false;
    }
    var i = 0, len = this.data.masksProperties.length;
    while(i<len) {
        if((this.data.masksProperties[i].mode !== 'n' && this.data.masksProperties[i].cl !== false)) {
            return true;
        }
        i += 1;
    }
    return false;
}

BaseElement.prototype.checkParenting = function(){
    if(this.data.parent !== undefined){
        this.comp.buildElementParenting(this, this.data.parent);
    }
}

BaseElement.prototype.prepareFrame = function(num){
    if(this.data.ip - this.data.st <= num && this.data.op - this.data.st > num)
    {
        if(this.isVisible !== true){
            this.elemMdf = true;
            this.globalData.mdf = true;
            this.isVisible = true;
            this.firstFrame = true;
            if(this.data.hasMask){
                this.maskManager.firstFrame = true;
            }
        }
    }else{
        if(this.isVisible !== false){
            this.elemMdf = true;
            this.globalData.mdf = true;
            this.isVisible = false;
        }
    }
    var i, len = this.dynamicProperties.length;
    for(i=0;i<len;i+=1){
        if(this.isVisible || (this._isParent && this.dynamicProperties[i].type === 'transform')){
            this.dynamicProperties[i].getValue();
            if(this.dynamicProperties[i].mdf){
                this.elemMdf = true;
                this.globalData.mdf = true;
            }
        }
    }
    if(this.data.hasMask && this.isVisible){
        this.maskManager.prepareFrame(num*this.data.sr);
    }
    
    /* TODO check this
    if(this.data.sy){
        if(this.data.sy[0].renderedData[num]){
            if(this.data.sy[0].renderedData[num].c){
                this.feFlood.setAttribute('flood-color','rgb('+Math.round(this.data.sy[0].renderedData[num].c[0])+','+Math.round(this.data.sy[0].renderedData[num].c[1])+','+Math.round(this.data.sy[0].renderedData[num].c[2])+')');
            }
            if(this.data.sy[0].renderedData[num].s){
                this.feMorph.setAttribute('radius',this.data.sy[0].renderedData[num].s);
            }
        }
    }
    */


    this.currentFrameNum = num*this.data.sr;
    return this.isVisible;
};

BaseElement.prototype.globalToLocal = function(pt){
    var transforms = [];
    transforms.push(this.finalTransform);
    var flag = true;
    var comp = this.comp;
    while(flag){
        if(comp.finalTransform){
            if(comp.data.hasMask){
                transforms.splice(0,0,comp.finalTransform);
            }
            comp = comp.comp;
        } else {
            flag = false;
        }
    }
    var i, len = transforms.length,ptNew;
    for(i=0;i<len;i+=1){
        ptNew = transforms[i].mat.applyToPointArray(0,0,0);
        //ptNew = transforms[i].mat.applyToPointArray(pt[0],pt[1],pt[2]);
        pt = [pt[0] - ptNew[0],pt[1] - ptNew[1],0];
    }
    return pt;
};

BaseElement.prototype.initExpressions = function(){
    this.layerInterface = LayerExpressionInterface(this);
    //layers[i].layerInterface = LayerExpressionInterface(layers[i]);
    //layers[i].layerInterface = LayerExpressionInterface(layers[i]);
    if(this.data.hasMask){
        this.layerInterface.registerMaskInterface(this.maskManager);
    }
    var effectsInterface = EffectsExpressionInterface.createEffectsInterface(this,this.layerInterface);
    this.layerInterface.registerEffectsInterface(effectsInterface);

    if(this.data.ty === 0 || this.data.xt){
        this.compInterface = CompExpressionInterface(this);
    } else if(this.data.ty === 4){
        this.layerInterface.shapeInterface = ShapeExpressionInterface.createShapeInterface(this.shapesData,this.itemsData,this.layerInterface);
    } else if(this.data.ty === 5){
        this.layerInterface.textInterface = TextExpressionInterface(this);
    }
}

BaseElement.prototype.setBlendMode = function(){
    var blendModeValue = '';
    switch(this.data.bm){
        case 1:
            blendModeValue = 'multiply';
            break;
        case 2:
            blendModeValue = 'screen';
            break;
        case 3:
            blendModeValue = 'overlay';
            break;
        case 4:
            blendModeValue = 'darken';
            break;
        case 5:
            blendModeValue = 'lighten';
            break;
        case 6:
            blendModeValue = 'color-dodge';
            break;
        case 7:
            blendModeValue = 'color-burn';
            break;
        case 8:
            blendModeValue = 'hard-light';
            break;
        case 9:
            blendModeValue = 'soft-light';
            break;
        case 10:
            blendModeValue = 'difference';
            break;
        case 11:
            blendModeValue = 'exclusion';
            break;
        case 12:
            blendModeValue = 'hue';
            break;
        case 13:
            blendModeValue = 'saturation';
            break;
        case 14:
            blendModeValue = 'color';
            break;
        case 15:
            blendModeValue = 'luminosity';
            break;
    }
    var elem = this.baseElement || this.layerElement;

    elem.style['mix-blend-mode'] = blendModeValue;
}

BaseElement.prototype.init = function(){
    if(!this.data.sr){
        this.data.sr = 1;
    }
    this.dynamicProperties = [];
    if(this.data.ef){
        this.effects = new EffectsManager(this.data,this,this.dynamicProperties);
        //this.effect = this.effectsManager.bind(this.effectsManager);
    }
    //this.elemInterface = buildLayerExpressionInterface(this);
    this.hidden = false;
    this.firstFrame = true;
    this.isVisible = false;
    this._isParent = false;
    this.currentFrameNum = -99999;
    this.lastNum = -99999;
    if(this.data.ks){
        this.finalTransform = {
            mProp: PropertyFactory.getProp(this,this.data.ks,2,null,this.dynamicProperties),
            matMdf: false,
            opMdf: false,
            mat: new Matrix(),
            opacity: 1
        };
        if(this.data.ao){
            this.finalTransform.mProp.autoOriented = true;
        }
        this.finalTransform.op = this.finalTransform.mProp.o;
        this.transform = this.finalTransform.mProp;
        if(this.data.ty !== 11){
            this.createElements();
        }
        if(this.data.hasMask){
            this.addMasks(this.data);
        }
    }
    this.elemMdf = false;
};
BaseElement.prototype.getType = function(){
    return this.type;
};

BaseElement.prototype.resetHierarchy = function(){
    if(!this.hierarchy){
        this.hierarchy = [];
    }else{
        this.hierarchy.length = 0;
    }
};

BaseElement.prototype.getHierarchy = function(){
    if(!this.hierarchy){
        this.hierarchy = [];
    }
    return this.hierarchy;
};

BaseElement.prototype.setHierarchy = function(hierarchy){
    this.hierarchy = hierarchy;
};

BaseElement.prototype.getLayerSize = function(){
    if(this.data.ty === 5){
        return {w:this.data.textData.width,h:this.data.textData.height};
    }else{
        return {w:this.data.width,h:this.data.height};
    }
};

BaseElement.prototype.hide = function(){

};

BaseElement.prototype.mHelper = new Matrix();
function SVGBaseElement(data,parentContainer,globalData,comp, placeholder){
    this.globalData = globalData;
    this.comp = comp;
    this.data = data;
    this.matteElement = null;
    this.transformedElement = null;
    this.isTransparent = false;
    this.parentContainer = parentContainer;
    this.layerId = placeholder ? placeholder.layerId : 'ly_'+randomString(10);
    this.placeholder = placeholder;
    this.init();
};

createElement(BaseElement, SVGBaseElement);

SVGBaseElement.prototype.createElements = function(){
    this.layerElement = document.createElementNS(svgNS,'g');
    this.transformedElement = this.layerElement;
    if(this.data.hasMask){
        this.maskedElement = this.layerElement;
    }
    var layerElementParent = null;
    if(this.data.td){
        if(this.data.td == 3 || this.data.td == 1){
            var masker = document.createElementNS(svgNS,'mask');
            masker.setAttribute('id',this.layerId);
            masker.setAttribute('mask-type',this.data.td == 3 ? 'luminance':'alpha');
            masker.appendChild(this.layerElement);
            layerElementParent = masker;
            this.globalData.defs.appendChild(masker);
            ////// This is only for IE and Edge when mask if of type alpha
            if(!featureSupport.maskType && this.data.td == 1){
                masker.setAttribute('mask-type','luminance');
                var filId = randomString(10);
                var fil = filtersFactory.createFilter(filId);
                this.globalData.defs.appendChild(fil);
                fil.appendChild(filtersFactory.createAlphaToLuminanceFilter());
                var gg = document.createElementNS(svgNS,'g');
                gg.appendChild(this.layerElement);
                layerElementParent = gg;
                masker.appendChild(gg);
                gg.setAttribute('filter','url(#'+filId+')');
            }
        }else if(this.data.td == 2){
            var maskGroup = document.createElementNS(svgNS,'mask');
            maskGroup.setAttribute('id',this.layerId);
            maskGroup.setAttribute('mask-type','alpha');
            var maskGrouper = document.createElementNS(svgNS,'g');
            maskGroup.appendChild(maskGrouper);
            var filId = randomString(10);
            var fil = filtersFactory.createFilter(filId);
            ////

            var feColorMatrix = document.createElementNS(svgNS,'feColorMatrix');
            feColorMatrix.setAttribute('type','matrix');
            feColorMatrix.setAttribute('color-interpolation-filters','sRGB');
            feColorMatrix.setAttribute('values','1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 -1 1');
            fil.appendChild(feColorMatrix);

            ////
            /*var feCTr = document.createElementNS(svgNS,'feComponentTransfer');
            feCTr.setAttribute('in','SourceGraphic');
            fil.appendChild(feCTr);
            var feFunc = document.createElementNS(svgNS,'feFuncA');
            feFunc.setAttribute('type','table');
            feFunc.setAttribute('tableValues','1.0 0.0');
            feCTr.appendChild(feFunc);*/
            this.globalData.defs.appendChild(fil);
            var alphaRect = document.createElementNS(svgNS,'rect');
            alphaRect.setAttribute('width',this.comp.data.w);
            alphaRect.setAttribute('height',this.comp.data.h);
            alphaRect.setAttribute('x','0');
            alphaRect.setAttribute('y','0');
            alphaRect.setAttribute('fill','#ffffff');
            alphaRect.setAttribute('opacity','0');
            maskGrouper.setAttribute('filter','url(#'+filId+')');
            maskGrouper.appendChild(alphaRect);
            maskGrouper.appendChild(this.layerElement);
            layerElementParent = maskGrouper;
            if(!featureSupport.maskType){
                maskGroup.setAttribute('mask-type','luminance');
                fil.appendChild(filtersFactory.createAlphaToLuminanceFilter());
                var gg = document.createElementNS(svgNS,'g');
                maskGrouper.appendChild(alphaRect);
                gg.appendChild(this.layerElement);
                layerElementParent = gg;
                maskGrouper.appendChild(gg);
            }
            this.globalData.defs.appendChild(maskGroup);
        }
    }else if(this.data.hasMask || this.data.tt){
        if(this.data.tt){
            this.matteElement = document.createElementNS(svgNS,'g');
            this.matteElement.appendChild(this.layerElement);
            layerElementParent = this.matteElement;
            this.baseElement = this.matteElement;
        }else{
            this.baseElement = this.layerElement;
        }
    }else{
        this.baseElement = this.layerElement;
    }
    if((this.data.ln || this.data.cl) && (this.data.ty === 4 || this.data.ty === 0)){
        if(this.data.ln){
            this.layerElement.setAttribute('id',this.data.ln);
        }
        if(this.data.cl){
            this.layerElement.setAttribute('class',this.data.cl);
        }
    }
    if(this.data.ty === 0){
            var cp = document.createElementNS(svgNS, 'clipPath');
            var pt = document.createElementNS(svgNS,'path');
            pt.setAttribute('d','M0,0 L'+this.data.w+',0'+' L'+this.data.w+','+this.data.h+' L0,'+this.data.h+'z');
            var clipId = 'cp_'+randomString(8);
            cp.setAttribute('id',clipId);
            cp.appendChild(pt);
            this.globalData.defs.appendChild(cp);
        if(this.checkMasks()){
            var cpGroup = document.createElementNS(svgNS,'g');
            cpGroup.setAttribute('clip-path','url(#'+clipId+')');
            cpGroup.appendChild(this.layerElement);
            this.transformedElement = cpGroup;
            if(layerElementParent){
                layerElementParent.appendChild(this.transformedElement);
            } else {
                this.baseElement = this.transformedElement;
            }
        } else {
            this.layerElement.setAttribute('clip-path','url(#'+clipId+')');
        }
        
    }
    if(this.data.bm !== 0){
        this.setBlendMode();
    }
    if(this.layerElement !== this.parentContainer){
        this.placeholder = null;
    }
    /* Todo performance killer
    if(this.data.sy){
        var filterID = 'st_'+randomString(10);
        var c = this.data.sy[0].c.k;
        var r = this.data.sy[0].s.k;
        var expansor = document.createElementNS(svgNS,'filter');
        expansor.setAttribute('id',filterID);
        var feFlood = document.createElementNS(svgNS,'feFlood');
        this.feFlood = feFlood;
        if(!c[0].e){
            feFlood.setAttribute('flood-color','rgb('+c[0]+','+c[1]+','+c[2]+')');
        }
        feFlood.setAttribute('result','base');
        expansor.appendChild(feFlood);
        var feMorph = document.createElementNS(svgNS,'feMorphology');
        feMorph.setAttribute('operator','dilate');
        feMorph.setAttribute('in','SourceGraphic');
        feMorph.setAttribute('result','bigger');
        this.feMorph = feMorph;
        if(!r.length){
            feMorph.setAttribute('radius',this.data.sy[0].s.k);
        }
        expansor.appendChild(feMorph);
        var feColorMatrix = document.createElementNS(svgNS,'feColorMatrix');
        feColorMatrix.setAttribute('result','mask');
        feColorMatrix.setAttribute('in','bigger');
        feColorMatrix.setAttribute('type','matrix');
        feColorMatrix.setAttribute('values','0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0');
        expansor.appendChild(feColorMatrix);
        var feComposite = document.createElementNS(svgNS,'feComposite');
        feComposite.setAttribute('result','drop');
        feComposite.setAttribute('in','base');
        feComposite.setAttribute('in2','mask');
        feComposite.setAttribute('operator','in');
        expansor.appendChild(feComposite);
        var feBlend = document.createElementNS(svgNS,'feBlend');
        feBlend.setAttribute('in','SourceGraphic');
        feBlend.setAttribute('in2','drop');
        feBlend.setAttribute('mode','normal');
        expansor.appendChild(feBlend);
        this.globalData.defs.appendChild(expansor);
        var cont = document.createElementNS(svgNS,'g');
        if(this.layerElement === this.parentContainer){
            this.layerElement = cont;
        }else{
            cont.appendChild(this.layerElement);
        }
        cont.setAttribute('filter','url(#'+filterID+')');
        if(this.data.td){
            cont.setAttribute('data-td',this.data.td);
        }
        if(this.data.td == 3){
            this.globalData.defs.appendChild(cont);
        }else if(this.data.td == 2){
            maskGrouper.appendChild(cont);
        }else if(this.data.td == 1){
            masker.appendChild(cont);
        }else{
            if(this.data.hasMask && this.data.tt){
                this.matteElement.appendChild(cont);
            }else{
                this.appendNodeToParent(cont);
            }
        }
    }*/
    if(this.data.ef){
        this.effectsManager = new SVGEffects(this);
    }
    this.checkParenting();
};


SVGBaseElement.prototype.setBlendMode = BaseElement.prototype.setBlendMode;

SVGBaseElement.prototype.renderFrame = function(parentTransform){
    if(this.data.ty === 3 || this.data.hd || !this.isVisible){
        return false;
    }

    this.lastNum = this.currentFrameNum;
    this.finalTransform.opMdf = this.firstFrame || this.finalTransform.op.mdf;
    this.finalTransform.matMdf = this.firstFrame || this.finalTransform.mProp.mdf;
    this.finalTransform.opacity = this.finalTransform.op.v;

    var mat;
    var finalMat = this.finalTransform.mat;

    if(this.hierarchy){
        var i = 0, len = this.hierarchy.length;
        if(!this.finalTransform.matMdf) {
            while(i < len) {
                if(this.hierarchy[i].finalTransform.mProp.mdf) {
                    this.finalTransform.matMdf = true;
                    break;
                }
                i += 1;
            }
        }
        
        if(this.finalTransform.matMdf) {
            mat = this.finalTransform.mProp.v.props;
            finalMat.cloneFromProps(mat);
            for(i=0;i<len;i+=1){
                mat = this.hierarchy[i].finalTransform.mProp.v.props;
                finalMat.transform(mat[0],mat[1],mat[2],mat[3],mat[4],mat[5],mat[6],mat[7],mat[8],mat[9],mat[10],mat[11],mat[12],mat[13],mat[14],mat[15]);
            }
        }
        
    }else if(this.isVisible){
        finalMat = this.finalTransform.mProp.v;
    }
    if(this.finalTransform.matMdf && this.layerElement){
        this.transformedElement.setAttribute('transform',finalMat.to2dCSS());
    }
    if(this.finalTransform.opMdf && this.layerElement){
        if(this.finalTransform.op.v <= 0) {
            if(!this.isTransparent && this.globalData.renderConfig.hideOnTransparent){
                this.isTransparent = true;
                this.hide();
            }
        } else if(this.hidden && this.isTransparent){
            this.isTransparent = false;
            this.show();
        }
        this.transformedElement.setAttribute('opacity',this.finalTransform.op.v);
    }

    if(this.data.hasMask){
        this.maskManager.renderFrame(finalMat);
    }
    if(this.effectsManager){
        this.effectsManager.renderFrame(this.firstFrame);
    }
    return this.isVisible;
};

SVGBaseElement.prototype.destroy = function(){
    this.layerElement = null;
    this.parentContainer = null;
    if(this.matteElement) {
        this.matteElement = null;
    }
    if(this.maskManager) {
        this.maskManager.destroy();
    }
};

SVGBaseElement.prototype.getBaseElement = function(){
    return this.baseElement;
};
SVGBaseElement.prototype.addMasks = function(data){
    this.maskManager = new MaskElement(data,this,this.globalData);
};

SVGBaseElement.prototype.setMatte = function(id){
    if(!this.matteElement){
        return;
    }
    this.matteElement.setAttribute("mask", "url(#" + id + ")");
};

SVGBaseElement.prototype.setMatte = function(id){
    if(!this.matteElement){
        return;
    }
    this.matteElement.setAttribute("mask", "url(#" + id + ")");
};

SVGBaseElement.prototype.hide = function(){
    if(!this.hidden){
        this.layerElement.style.display = 'none';
        this.hidden = true;
    }
};

SVGBaseElement.prototype.show = function(){
    if(this.isVisible && !this.isTransparent){
        this.hidden = false;
        this.layerElement.style.display = 'block';
    }
};

function IShapeElement(data,parentContainer,globalData,comp, placeholder){
    this.shapes = [];
    this.shapesData = data.shapes;
    this.stylesList = [];
    this.itemsData = [];
    this.prevViewData = [];
    this.shapeModifiers = [];
    this.processedElements = [];
    this._parent.constructor.call(this,data,parentContainer,globalData,comp, placeholder);
}
createElement(SVGBaseElement, IShapeElement);

IShapeElement.prototype.identityMatrix = new Matrix();

IShapeElement.prototype.lcEnum = {
    '1': 'butt',
    '2': 'round',
    '3': 'butt'
}

IShapeElement.prototype.ljEnum = {
    '1': 'miter',
    '2': 'round',
    '3': 'butt'
}

IShapeElement.prototype.searchProcessedElement = function(elem){
    var i = this.processedElements.length;
    while(i){
        i -= 1;
        if(this.processedElements[i].elem === elem){
            return this.processedElements[i].pos;
        }
    }
    return 0;
};

IShapeElement.prototype.addProcessedElement = function(elem, pos){
    var i = this.processedElements.length;
    while(i){
        i -= 1;
        if(this.processedElements[i].elem === elem){
            this.processedElements[i].pos = pos;
            break;
        }
    }
    if(i === 0){
        this.processedElements.push({
            elem: elem,
            pos: pos
        })
    }
};

IShapeElement.prototype.buildExpressionInterface = function(){};

IShapeElement.prototype.createElements = function(){
    //TODO check if I can use symbol so i can set its viewBox
    this._parent.createElements.call(this);
    this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,this.layerElement,this.dynamicProperties, 0, [], true);
    if(!this.data.hd || this.data.td){
        styleUnselectableDiv(this.layerElement);
    }
};

IShapeElement.prototype.setGradientData = function(pathElement,arr,data){

    var gradientId = 'gr_'+randomString(10);
    var gfill;
    if(arr.t === 1){
        gfill = document.createElementNS(svgNS,'linearGradient');
    } else {
        gfill = document.createElementNS(svgNS,'radialGradient');
    }
    gfill.setAttribute('id',gradientId);
    gfill.setAttribute('spreadMethod','pad');
    gfill.setAttribute('gradientUnits','userSpaceOnUse');
    var stops = [];
    var stop, j, jLen;
    jLen = arr.g.p*4;
    for(j=0;j<jLen;j+=4){
        stop = document.createElementNS(svgNS,'stop');
        gfill.appendChild(stop);
        stops.push(stop);
    }
    pathElement.setAttribute( arr.ty === 'gf' ? 'fill':'stroke','url(#'+gradientId+')');
    this.globalData.defs.appendChild(gfill);
    data.gf = gfill;
    data.cst = stops;
}

IShapeElement.prototype.setGradientOpacity = function(arr, data, styleOb){
    if((arr.g.k.k[0].s && arr.g.k.k[0].s.length > arr.g.p*4) || arr.g.k.k.length > arr.g.p*4){
        var opFill;
        var stop, j, jLen;
        var mask = document.createElementNS(svgNS,"mask");
        var maskElement = document.createElementNS(svgNS, 'path');
        mask.appendChild(maskElement);
        var opacityId = 'op_'+randomString(10);
        var maskId = 'mk_'+randomString(10);
        mask.setAttribute('id',maskId);
        if(arr.t === 1){
            opFill = document.createElementNS(svgNS,'linearGradient');
        } else {
            opFill = document.createElementNS(svgNS,'radialGradient');
        }
        opFill.setAttribute('id',opacityId);
        opFill.setAttribute('spreadMethod','pad');
        opFill.setAttribute('gradientUnits','userSpaceOnUse');
        jLen = arr.g.k.k[0].s ? arr.g.k.k[0].s.length : arr.g.k.k.length;
        var stops = [];
        for(j=arr.g.p*4;j<jLen;j+=2){
            stop = document.createElementNS(svgNS,'stop');
            stop.setAttribute('stop-color','rgb(255,255,255)');
            //stop.setAttribute('offset',Math.round(arr.y[j][0]*100)+'%');
            //stop.setAttribute('style','stop-color:rgb(255,255,255);stop-opacity:'+arr.y[j][1]);
            opFill.appendChild(stop);
            stops.push(stop);
        }
        maskElement.setAttribute( arr.ty === 'gf' ? 'fill':'stroke','url(#'+opacityId+')');
        this.globalData.defs.appendChild(opFill);
        this.globalData.defs.appendChild(mask);
        data.of = opFill;
        data.ost = stops;
        styleOb.msElem = maskElement;
        return maskId;
    }
};

IShapeElement.prototype.createStyleElement = function(data, level, dynamicProperties){
    var elementData = {
    };
    var styleOb = {
        data: data,
        type: data.ty,
        d: '',
        ld: '',
        lvl: level,
        mdf: false,
        closed: false
    };
    var pathElement = document.createElementNS(svgNS, "path");
    elementData.o = PropertyFactory.getProp(this,data.o,0,0.01,dynamicProperties);
    if(data.ty == 'st' || data.ty == 'gs') {
        pathElement.setAttribute('stroke-linecap', this.lcEnum[data.lc] || 'round');
        ////pathElement.style.strokeLinecap = this.lcEnum[data.lc] || 'round';
        pathElement.setAttribute('stroke-linejoin',this.ljEnum[data.lj] || 'round');
        ////pathElement.style.strokeLinejoin = this.ljEnum[data.lj] || 'round';
        pathElement.setAttribute('fill-opacity','0');
        ////pathElement.style.fillOpacity = 0;
        if(data.lj == 1) {
            pathElement.setAttribute('stroke-miterlimit',data.ml);
            ////pathElement.style.strokeMiterlimit = data.ml;
        }

        elementData.w = PropertyFactory.getProp(this,data.w,0,null,dynamicProperties);
        if(data.d){
            var d = PropertyFactory.getDashProp(this,data.d,'svg',dynamicProperties);
            if(!d.k){
                pathElement.setAttribute('stroke-dasharray', d.dasharray);
                ////pathElement.style.strokeDasharray = d.dasharray;
                pathElement.setAttribute('stroke-dashoffset', d.dashoffset);
                ////pathElement.style.strokeDashoffset = d.dashoffset;
            }
            elementData.d = d;
        }

    }
    if(data.ty == 'fl' || data.ty == 'st'){
        elementData.c = PropertyFactory.getProp(this,data.c,1,255,dynamicProperties);
    } else {
        elementData.g = PropertyFactory.getGradientProp(this,data.g,dynamicProperties);
        if(data.t == 2){
            elementData.h = PropertyFactory.getProp(this,data.h,1,0.01,dynamicProperties);
            elementData.a = PropertyFactory.getProp(this,data.a,1,degToRads,dynamicProperties);
        }
        elementData.s = PropertyFactory.getProp(this,data.s,1,null,dynamicProperties);
        elementData.e = PropertyFactory.getProp(this,data.e,1,null,dynamicProperties);
        this.setGradientData(pathElement,data,elementData, styleOb);
        var maskId = this.setGradientOpacity(data,elementData, styleOb);
        if(maskId){
            pathElement.setAttribute('mask','url(#'+maskId+')');
        }
    }
    elementData.elem = pathElement;
    //container.appendChild(pathElement);
    if(data.r === 2) {
        pathElement.setAttribute('fill-rule', 'evenodd');
    }

    if(data.ln){
        pathElement.setAttribute('id',data.ln);
    }
    if(data.cl){
        pathElement.setAttribute('class',data.cl);
    }
    styleOb.pElem = pathElement;
    this.stylesList.push(styleOb);
    elementData.style = styleOb;
    return elementData;
}

IShapeElement.prototype.createGroupElement = function(data) {
    var elementData = {
        it: [],
        prevViewData: []
    };
    var g = document.createElementNS(svgNS,'g');
    elementData.gr = g;
    if(data.ln){
        elementData.gr.setAttribute('id',data.ln);
    }
    return elementData;
}

IShapeElement.prototype.createTransformElement = function(data, dynamicProperties) {
    var elementData = {
        transform : {
            op: PropertyFactory.getProp(this,data.o,0,0.01,dynamicProperties),
            mProps: PropertyFactory.getProp(this,data,2,null,dynamicProperties)
        },
        elements: []
    };
    return elementData;
}

IShapeElement.prototype.createShapeElement = function(data, ownTransformers, level, dynamicProperties) {
    var elementData = {
        elements : [],
        caches:[],
        styles : [],
        transformers: ownTransformers,
        lStr: ''
    };
    var ty = 4;
    if(data.ty == 'rc'){
        ty = 5;
    }else if(data.ty == 'el'){
        ty = 6;
    }else if(data.ty == 'sr'){
        ty = 7;
    }
    elementData.sh = ShapePropertyFactory.getShapeProp(this,data,ty,dynamicProperties);
    elementData.lvl = level;
    this.shapes.push(elementData.sh);
    this.addShapeToModifiers(elementData);
    return elementData;
}

var cont = 0;

IShapeElement.prototype.setElementStyles = function(){
    var j, jLen = this.stylesList.length;
    var arr = [];
    for(j=0;j<jLen;j+=1){
        if(!this.stylesList[j].closed){
            arr.push(this.stylesList[j]);
        }
    }
    return arr;
}

IShapeElement.prototype.reloadShapes = function(){
    this.firstFrame = true;
    var i, len = this.itemsData.length;
    for(i=0;i<len;i+=1){
        this.prevViewData[i] = this.itemsData[i];
    }
    this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,this.layerElement,this.dynamicProperties, 0, [], true);
    var i, len = this.dynamicProperties.length;
    for(i=0;i<len;i+=1){
        this.dynamicProperties[i].getValue();
    }
    this.renderModifiers();
}

IShapeElement.prototype.searchShapes = function(arr,itemsData,prevViewData,container,dynamicProperties, level, transformers, render){
    var ownTransformers = [].concat(transformers);
    var i, len = arr.length - 1;
    var j, jLen;
    var ownStyles = [], ownModifiers = [], styleOb, currentTransform, modifier, processedPos;
    for(i=len;i>=0;i-=1){
        processedPos = this.searchProcessedElement(arr[i]);
        if(!processedPos){
            arr[i]._render = render;
        } else {
            itemsData[i] = prevViewData[processedPos - 1];
        }
        if(arr[i].ty == 'fl' || arr[i].ty == 'st' || arr[i].ty == 'gf' || arr[i].ty == 'gs'){
            if(!processedPos){
                itemsData[i] = this.createStyleElement(arr[i], level, dynamicProperties);
            } else {
                itemsData[i].style.closed = false;
            }
            if(arr[i]._render){
                container.appendChild(itemsData[i].elem);
            }
            ownStyles.push(itemsData[i].style);
        }else if(arr[i].ty == 'gr'){
            if(!processedPos){
                itemsData[i] = this.createGroupElement(arr[i]);
            } else {
                jLen = itemsData[i].it.length;
                for(j=0;j<jLen;j+=1){
                    itemsData[i].prevViewData[j] = itemsData[i].it[j];
                }
            }
            this.searchShapes(arr[i].it,itemsData[i].it,itemsData[i].prevViewData,itemsData[i].gr,dynamicProperties, level + 1, ownTransformers, render);
            if(arr[i]._render){
                container.appendChild(itemsData[i].gr);
            }
        }else if(arr[i].ty == 'tr'){
            if(!processedPos){
                itemsData[i] = this.createTransformElement(arr[i], dynamicProperties);
            }
            currentTransform = itemsData[i].transform;
            ownTransformers.push(currentTransform);
        }else if(arr[i].ty == 'sh' || arr[i].ty == 'rc' || arr[i].ty == 'el' || arr[i].ty == 'sr'){
            if(!processedPos){
                itemsData[i] = this.createShapeElement(arr[i], ownTransformers, level, dynamicProperties);
            }
            itemsData[i].elements = this.setElementStyles();

        }else if(arr[i].ty == 'tm' || arr[i].ty == 'rd' || arr[i].ty == 'ms'){
            if(!processedPos){
                modifier = ShapeModifiers.getModifier(arr[i].ty);
                modifier.init(this,arr[i],dynamicProperties);
                itemsData[i] = modifier;
                this.shapeModifiers.push(modifier);
            } else {
                modifier = itemsData[i];
                modifier.closed = false;
            }
            ownModifiers.push(modifier);
        }else if(arr[i].ty == 'rp'){
            if(!processedPos){
                modifier = ShapeModifiers.getModifier(arr[i].ty);
                itemsData[i] = modifier;
                modifier.init(this,arr,i,itemsData,dynamicProperties);
                this.shapeModifiers.push(modifier);
                render = false;
            }else{
                modifier = itemsData[i];
                modifier.closed = true;
            }
            ownModifiers.push(modifier);
        }
        this.addProcessedElement(arr[i], i + 1);
    }
    len = ownStyles.length;
    for(i=0;i<len;i+=1){
        ownStyles[i].closed = true;
    }
    len = ownModifiers.length;
    for(i=0;i<len;i+=1){
        ownModifiers[i].closed = true;
    }
};

IShapeElement.prototype.addShapeToModifiers = function(data) {
    var i, len = this.shapeModifiers.length;
    for(i=0;i<len;i+=1){
        this.shapeModifiers[i].addShape(data);
    }
};

IShapeElement.prototype.renderModifiers = function() {
    if(!this.shapeModifiers.length){
        return;
    }
    var i, len = this.shapes.length;
    for(i=0;i<len;i+=1){
        this.shapes[i].reset();
    }


    len = this.shapeModifiers.length;

    for(i=len-1;i>=0;i-=1){
        this.shapeModifiers[i].processShapes(this.firstFrame);
    }
};

IShapeElement.prototype.renderFrame = function(parentMatrix){
    //this.reloadShapes();
    var renderParent = this._parent.renderFrame.call(this,parentMatrix);
    if(renderParent===false){
        this.hide();
        return;
    }
    if(this.hidden){
        this.layerElement.style.display = 'block';
        this.hidden = false;
    }
    this.renderModifiers();
    var i, len = this.stylesList.length;
    for(i=0;i<len;i+=1){
        this.stylesList[i].d = '';
        this.stylesList[i].mdf = false;
    }
    this.renderShape(this.shapesData,this.itemsData, null);

    for (i = 0; i < len; i += 1) {
        if (this.stylesList[i].ld === '0') {
            this.stylesList[i].ld = '1';
            this.stylesList[i].pElem.style.display = 'block';
            //this.stylesList[i].parent.appendChild(this.stylesList[i].pElem);
        }
        if (this.stylesList[i].mdf || this.firstFrame) {
            this.stylesList[i].pElem.setAttribute('d', this.stylesList[i].d);
            if(this.stylesList[i].msElem){
                this.stylesList[i].msElem.setAttribute('d', this.stylesList[i].d);
            }
        }
    }
    if (this.firstFrame) {
        this.firstFrame = false;
    }
};

IShapeElement.prototype.hide = function(){
    if(!this.hidden){
        this.layerElement.style.display = 'none';
        var i, len = this.stylesList.length;
        for(i=len-1;i>=0;i-=1){
            if(this.stylesList[i].ld !== '0'){
                this.stylesList[i].ld = '0';
                this.stylesList[i].pElem.style.display = 'none';
                if(this.stylesList[i].pElem.parentNode){
                    this.stylesList[i].parent = this.stylesList[i].pElem.parentNode;
                    //this.stylesList[i].pElem.parentNode.removeChild(this.stylesList[i].pElem);
                }
            }
        }
        this.hidden = true;
    }
};

IShapeElement.prototype.renderShape = function(items,data, container){
    var i, len = items.length - 1;
    var ty;
    for(i=len;i>=0;i-=1){
        ty = items[i].ty;
        if(ty == 'tr'){
            if(this.firstFrame || data[i].transform.op.mdf && container){
                container.setAttribute('opacity',data[i].transform.op.v);
            }
            if(this.firstFrame || data[i].transform.mProps.mdf && container){
                container.setAttribute('transform',data[i].transform.mProps.v.to2dCSS());
            }
        }else if(ty == 'sh' || ty == 'el' || ty == 'rc' || ty == 'sr'){
            this.renderPath(items[i],data[i]);
        }else if(ty == 'fl'){
            this.renderFill(items[i],data[i]);
        }else if(ty == 'gf'){
            this.renderGradient(items[i],data[i]);
        }else if(ty == 'gs'){
            this.renderGradient(items[i],data[i]);
            this.renderStroke(items[i],data[i]);
        }else if(ty == 'st'){
            this.renderStroke(items[i],data[i]);
        }else if(ty == 'gr'){
            this.renderShape(items[i].it,data[i].it, data[i].gr);
        }else if(ty == 'tm'){
            //
        }
    }

};

IShapeElement.prototype.buildShapeString = function(pathNodes, length, closed, mat) {
    var i, shapeString = '';
    for(i = 1; i < length; i += 1) {
        if (i === 1) {
            shapeString += " M" + mat.applyToPointStringified(pathNodes.v[0][0], pathNodes.v[0][1]);
        }
        shapeString += " C" + mat.applyToPointStringified(pathNodes.o[i - 1][0], pathNodes.o[i - 1][1]) + " " + mat.applyToPointStringified(pathNodes.i[i][0], pathNodes.i[i][1]) + " " + mat.applyToPointStringified(pathNodes.v[i][0], pathNodes.v[i][1]);
    }
    if (length === 1) {
        shapeString += " M" + mat.applyToPointStringified(pathNodes.v[0][0], pathNodes.v[0][1]);
    }
    if (closed && length) {
        shapeString += " C" + mat.applyToPointStringified(pathNodes.o[i - 1][0], pathNodes.o[i - 1][1]) + " " + mat.applyToPointStringified(pathNodes.i[0][0], pathNodes.i[0][1]) + " " + mat.applyToPointStringified(pathNodes.v[0][0], pathNodes.v[0][1]);
        shapeString += 'z';
    }
    return shapeString;
};

IShapeElement.prototype.renderPath = function(pathData,itemData){
    var len, i, j, jLen,pathStringTransformed,redraw,pathNodes,l, lLen = itemData.elements.length;
    var lvl = itemData.lvl;
    if(!pathData._render){
        return;
    }
    for(l=0;l<lLen;l+=1){
        if(itemData.elements[l].data._render){
            redraw = itemData.sh.mdf || this.firstFrame;
            pathStringTransformed = 'M0 0';
            var paths = itemData.sh.paths;
            jLen = paths._length;
            if(itemData.elements[l].lvl < lvl){
                var mat = this.mHelper.reset(), props;
                var iterations = lvl - itemData.elements[l].lvl;
                var k = itemData.transformers.length-1;
                while(iterations > 0) {
                    redraw = itemData.transformers[k].mProps.mdf || redraw;
                    props = itemData.transformers[k].mProps.v.props;
                    mat.transform(props[0],props[1],props[2],props[3],props[4],props[5],props[6],props[7],props[8],props[9],props[10],props[11],props[12],props[13],props[14],props[15]);
                    iterations --;
                    k --;
                }
                if(redraw){
                    for(j=0;j<jLen;j+=1){
                        pathNodes = paths.shapes[j];
                        if(pathNodes && pathNodes._length){
                            pathStringTransformed += this.buildShapeString(pathNodes, pathNodes._length, pathNodes.c, mat);
                        }
                    }
                    itemData.caches[l] = pathStringTransformed;
                } else {
                    pathStringTransformed = itemData.caches[l];
                }
            } else {
                if(redraw){
                    for(j=0;j<jLen;j+=1){
                        pathNodes = paths.shapes[j];
                        if(pathNodes && pathNodes._length){
                            pathStringTransformed += this.buildShapeString(pathNodes, pathNodes._length, pathNodes.c, this.identityMatrix);
                        }
                    }
                    itemData.caches[l] = pathStringTransformed;
                } else {
                    pathStringTransformed = itemData.caches[l];
                }
            }
            itemData.elements[l].d += pathStringTransformed;
            itemData.elements[l].mdf = redraw || itemData.elements[l].mdf;
        } else {
            itemData.elements[l].mdf = true;
        }
    }
};

IShapeElement.prototype.renderFill = function(styleData,itemData){
    var styleElem = itemData.style;

    if(itemData.c.mdf || this.firstFrame){
        styleElem.pElem.setAttribute('fill','rgb('+bm_floor(itemData.c.v[0])+','+bm_floor(itemData.c.v[1])+','+bm_floor(itemData.c.v[2])+')');
        ////styleElem.pElem.style.fill = 'rgb('+bm_floor(itemData.c.v[0])+','+bm_floor(itemData.c.v[1])+','+bm_floor(itemData.c.v[2])+')';
    }
    if(itemData.o.mdf || this.firstFrame){
        styleElem.pElem.setAttribute('fill-opacity',itemData.o.v);
    }
};

IShapeElement.prototype.renderGradient = function(styleData,itemData){
    var gfill = itemData.gf;
    var opFill = itemData.of;
    var pt1 = itemData.s.v,pt2 = itemData.e.v;

    if(itemData.o.mdf || this.firstFrame){
        var attr = styleData.ty === 'gf' ? 'fill-opacity':'stroke-opacity';
        itemData.elem.setAttribute(attr,itemData.o.v);
    }
    //clippedElement.setAttribute('transform','matrix(1,0,0,1,-100,0)');
    if(itemData.s.mdf || this.firstFrame){
        var attr1 = styleData.t === 1 ? 'x1':'cx';
        var attr2 = attr1 === 'x1' ? 'y1':'cy';
        gfill.setAttribute(attr1,pt1[0]);
        gfill.setAttribute(attr2,pt1[1]);
        if(opFill){
            opFill.setAttribute(attr1,pt1[0]);
            opFill.setAttribute(attr2,pt1[1]);
        }
    }
    var stops, i, len, stop;
    if(itemData.g.cmdf || this.firstFrame){
        stops = itemData.cst;
        var cValues = itemData.g.c;
        len = stops.length;
        for(i=0;i<len;i+=1){
            stop = stops[i];
            stop.setAttribute('offset',cValues[i*4]+'%');
            stop.setAttribute('stop-color','rgb('+cValues[i*4+1]+','+cValues[i*4+2]+','+cValues[i*4+3]+')');
        }
    }
    if(opFill && (itemData.g.omdf || this.firstFrame)){
        stops = itemData.ost;
        var oValues = itemData.g.o;
        len = stops.length;
        for(i=0;i<len;i+=1){
            stop = stops[i];
            stop.setAttribute('offset',oValues[i*2]+'%');
            stop.setAttribute('stop-opacity',oValues[i*2+1]);
        }
    }
    if(styleData.t === 1){
        if(itemData.e.mdf  || this.firstFrame){
            gfill.setAttribute('x2',pt2[0]);
            gfill.setAttribute('y2',pt2[1]);
            if(opFill){
                opFill.setAttribute('x2',pt2[0]);
                opFill.setAttribute('y2',pt2[1]);
            }
        }
    } else {
        var rad;
        if(itemData.s.mdf || itemData.e.mdf || this.firstFrame){
            rad = Math.sqrt(Math.pow(pt1[0]-pt2[0],2)+Math.pow(pt1[1]-pt2[1],2));
            gfill.setAttribute('r',rad);
            if(opFill){
                opFill.setAttribute('r',rad);
            }
        }
        if(itemData.e.mdf || itemData.h.mdf || itemData.a.mdf || this.firstFrame){
            if(!rad){
                rad = Math.sqrt(Math.pow(pt1[0]-pt2[0],2)+Math.pow(pt1[1]-pt2[1],2));
            }
            var ang = Math.atan2(pt2[1]-pt1[1], pt2[0]-pt1[0]);

            var percent = itemData.h.v >= 1 ? 0.99 : itemData.h.v <= -1 ? -0.99:itemData.h.v;
            var dist = rad*percent;
            var x = Math.cos(ang + itemData.a.v)*dist + pt1[0];
            var y = Math.sin(ang + itemData.a.v)*dist + pt1[1];
            gfill.setAttribute('fx',x);
            gfill.setAttribute('fy',y);
            if(opFill){
                opFill.setAttribute('fx',x);
                opFill.setAttribute('fy',y);
            }
        }
        //gfill.setAttribute('fy','200');
    }
};

IShapeElement.prototype.renderStroke = function(styleData,itemData){
    var styleElem = itemData.style;
    //TODO fix dashes
    var d = itemData.d;
    var dasharray,dashoffset;
    if(d && d.k && (d.mdf || this.firstFrame)){
        styleElem.pElem.setAttribute('stroke-dasharray', d.dasharray);
        ////styleElem.pElem.style.strokeDasharray = d.dasharray;
        styleElem.pElem.setAttribute('stroke-dashoffset', d.dashoffset);
        ////styleElem.pElem.style.strokeDashoffset = d.dashoffset;
    }
    if(itemData.c && (itemData.c.mdf || this.firstFrame)){
        styleElem.pElem.setAttribute('stroke','rgb('+bm_floor(itemData.c.v[0])+','+bm_floor(itemData.c.v[1])+','+bm_floor(itemData.c.v[2])+')');
        ////styleElem.pElem.style.stroke = 'rgb('+bm_floor(itemData.c.v[0])+','+bm_floor(itemData.c.v[1])+','+bm_floor(itemData.c.v[2])+')';
    }
    if(itemData.o.mdf || this.firstFrame){
        styleElem.pElem.setAttribute('stroke-opacity',itemData.o.v);
    }
    if(itemData.w.mdf || this.firstFrame){
        styleElem.pElem.setAttribute('stroke-width',itemData.w.v);
        if(styleElem.msElem){
            styleElem.msElem.setAttribute('stroke-width',itemData.w.v);
        }
        ////styleElem.pElem.style.strokeWidth = itemData.w.v;
    }
};

IShapeElement.prototype.destroy = function(){
    this._parent.destroy.call(this._parent);
    this.shapeData = null;
    this.itemsData = null;
    this.parentContainer = null;
    this.placeholder = null;
};

function ITextElement(data, animationItem,parentContainer,globalData){
}
ITextElement.prototype.init = function(){
    this._parent.init.call(this);

    this.lettersChangedFlag = false;
    this.currentTextDocumentData = {};
    var data = this.data;
    this.viewData = {
        m:{
            a: PropertyFactory.getProp(this,data.t.m.a,1,0,this.dynamicProperties)
        }
    };
    var textData = this.data.t;
    if(textData.a.length){
        this.viewData.a = Array.apply(null,{length:textData.a.length});
        var i, len = textData.a.length, animatorData, animatorProps;
        for(i=0;i<len;i+=1){
            animatorProps = textData.a[i];
            animatorData = {
                a: {},
                s: {}
            };
            if('r' in animatorProps.a) {
                animatorData.a.r = PropertyFactory.getProp(this,animatorProps.a.r,0,degToRads,this.dynamicProperties);
            }
            if('rx' in animatorProps.a) {
                animatorData.a.rx = PropertyFactory.getProp(this,animatorProps.a.rx,0,degToRads,this.dynamicProperties);
            }
            if('ry' in animatorProps.a) {
                animatorData.a.ry = PropertyFactory.getProp(this,animatorProps.a.ry,0,degToRads,this.dynamicProperties);
            }
            if('sk' in animatorProps.a) {
                animatorData.a.sk = PropertyFactory.getProp(this,animatorProps.a.sk,0,degToRads,this.dynamicProperties);
            }
            if('sa' in animatorProps.a) {
                animatorData.a.sa = PropertyFactory.getProp(this,animatorProps.a.sa,0,degToRads,this.dynamicProperties);
            }
            if('s' in animatorProps.a) {
                animatorData.a.s = PropertyFactory.getProp(this,animatorProps.a.s,1,0.01,this.dynamicProperties);
            }
            if('a' in animatorProps.a) {
                animatorData.a.a = PropertyFactory.getProp(this,animatorProps.a.a,1,0,this.dynamicProperties);
            }
            if('o' in animatorProps.a) {
                animatorData.a.o = PropertyFactory.getProp(this,animatorProps.a.o,0,0.01,this.dynamicProperties);
            }
            if('p' in animatorProps.a) {
                animatorData.a.p = PropertyFactory.getProp(this,animatorProps.a.p,1,0,this.dynamicProperties);
            }
            if('sw' in animatorProps.a) {
                animatorData.a.sw = PropertyFactory.getProp(this,animatorProps.a.sw,0,0,this.dynamicProperties);
            }
            if('sc' in animatorProps.a) {
                animatorData.a.sc = PropertyFactory.getProp(this,animatorProps.a.sc,1,0,this.dynamicProperties);
            }
            if('fc' in animatorProps.a) {
                animatorData.a.fc = PropertyFactory.getProp(this,animatorProps.a.fc,1,0,this.dynamicProperties);
            }
            if('fh' in animatorProps.a) {
                animatorData.a.fh = PropertyFactory.getProp(this,animatorProps.a.fh,0,0,this.dynamicProperties);
            }
            if('fs' in animatorProps.a) {
                animatorData.a.fs = PropertyFactory.getProp(this,animatorProps.a.fs,0,0.01,this.dynamicProperties);
            }
            if('fb' in animatorProps.a) {
                animatorData.a.fb = PropertyFactory.getProp(this,animatorProps.a.fb,0,0.01,this.dynamicProperties);
            }
            if('t' in animatorProps.a) {
                animatorData.a.t = PropertyFactory.getProp(this,animatorProps.a.t,0,0,this.dynamicProperties);
            }
            animatorData.s = PropertyFactory.getTextSelectorProp(this,animatorProps.s,this.dynamicProperties);
            animatorData.s.t = animatorProps.s.t;
            this.viewData.a[i] = animatorData;
        }
    }else{
        this.viewData.a = [];
    }
    if(textData.p && 'm' in textData.p){
        this.viewData.p = {
            f: PropertyFactory.getProp(this,textData.p.f,0,0,this.dynamicProperties),
            l: PropertyFactory.getProp(this,textData.p.l,0,0,this.dynamicProperties),
            r: textData.p.r,
            m: this.maskManager.getMaskProperty(textData.p.m)
        };
        this.maskPath = true;
    } else {
        this.maskPath = false;
    }
};
ITextElement.prototype.prepareFrame = function(num) {
    var i = 0, len = this.data.t.d.k.length;
    var textDocumentData = this.data.t.d.k[i].s;
    i += 1;
    while(i<len){
        if(this.data.t.d.k[i].t > num){
            break;
        }
        textDocumentData = this.data.t.d.k[i].s;
        i += 1;
    }
    this.lettersChangedFlag = false;
    if(textDocumentData !== this.currentTextDocumentData){
        this.currentTextDocumentData = textDocumentData;
        this.lettersChangedFlag = true;
        this.buildNewText();
    }
    this._parent.prepareFrame.call(this, num);
}

ITextElement.prototype.createPathShape = function(matrixHelper, shapes) {
    var j,jLen = shapes.length;
    var k, kLen, pathNodes;
    var shapeStr = '';
    for(j=0;j<jLen;j+=1){
        pathNodes = shapes[j].ks.k;
        shapeStr += this.buildShapeString(pathNodes, pathNodes.i.length, true, matrixHelper);
        /*kLen = pathNodes.i.length;
        for(k=1;k<kLen;k+=1){
            if(k==1){
                shapeStr += " M"+matrixHelper.applyToPointStringified(pathNodes.v[0][0],pathNodes.v[0][1]);
            }
            shapeStr += " C"+matrixHelper.applyToPointStringified(pathNodes.o[k-1][0],pathNodes.o[k-1][1]) + " "+matrixHelper.applyToPointStringified(pathNodes.i[k][0],pathNodes.i[k][1]) + " "+matrixHelper.applyToPointStringified(pathNodes.v[k][0],pathNodes.v[k][1]);
        }
        shapeStr += " C"+matrixHelper.applyToPointStringified(pathNodes.o[k-1][0],pathNodes.o[k-1][1]) + " "+matrixHelper.applyToPointStringified(pathNodes.i[0][0],pathNodes.i[0][1]) + " "+matrixHelper.applyToPointStringified(pathNodes.v[0][0],pathNodes.v[0][1]);
        shapeStr += 'z';*/
    }
    return shapeStr;
};

ITextElement.prototype.getMeasures = function(){

    var matrixHelper = this.mHelper;
    var renderType = this.renderType;
    var data = this.data;
    var xPos,yPos;
    var i, len;
    var documentData = this.currentTextDocumentData;
    var letters = documentData.l;
    if(this.maskPath) {
        var mask = this.viewData.p.m;
        if(!this.viewData.p.n || this.viewData.p.mdf){
            var paths = mask.v;
            if(this.viewData.p.r){
                paths = reversePath(paths);
            }
            var pathInfo = {
                tLength: 0,
                segments: []
            };
            len = paths.v.length - 1;
            var pathData;
            var totalLength = 0;
            for (i = 0; i < len; i += 1) {
                pathData = {
                    s: paths.v[i],
                    e: paths.v[i + 1],
                    to: [paths.o[i][0] - paths.v[i][0], paths.o[i][1] - paths.v[i][1]],
                    ti: [paths.i[i + 1][0] - paths.v[i + 1][0], paths.i[i + 1][1] - paths.v[i + 1][1]]
                };
                bez.buildBezierData(pathData);
                pathInfo.tLength += pathData.bezierData.segmentLength;
                pathInfo.segments.push(pathData);
                totalLength += pathData.bezierData.segmentLength;
            }
            i = len;
            if (mask.v.c) {
                pathData = {
                    s: paths.v[i],
                    e: paths.v[0],
                    to: [paths.o[i][0] - paths.v[i][0], paths.o[i][1] - paths.v[i][1]],
                    ti: [paths.i[0][0] - paths.v[0][0], paths.i[0][1] - paths.v[0][1]]
                };
                bez.buildBezierData(pathData);
                pathInfo.tLength += pathData.bezierData.segmentLength;
                pathInfo.segments.push(pathData);
                totalLength += pathData.bezierData.segmentLength;
            }
            this.viewData.p.pi = pathInfo;
        }
        var pathInfo = this.viewData.p.pi;

        var currentLength = this.viewData.p.f.v, segmentInd = 0, pointInd = 1, currentPoint, prevPoint, points;
        var segmentLength = 0, flag = true;
        var segments = pathInfo.segments;
        if (currentLength < 0 && mask.v.c) {
            if (pathInfo.tLength < Math.abs(currentLength)) {
                currentLength = -Math.abs(currentLength) % pathInfo.tLength;
            }
            segmentInd = segments.length - 1;
            points = segments[segmentInd].bezierData.points;
            pointInd = points.length - 1;
            while (currentLength < 0) {
                currentLength += points[pointInd].partialLength;
                pointInd -= 1;
                if (pointInd < 0) {
                    segmentInd -= 1;
                    points = segments[segmentInd].bezierData.points;
                    pointInd = points.length - 1;
                }
            }

        }
        points = segments[segmentInd].bezierData.points;
        prevPoint = points[pointInd - 1];
        currentPoint = points[pointInd];
        var partialLength = currentPoint.partialLength;
        var perc, tanAngle;
    }


    len = letters.length;
    xPos = 0;
    yPos = 0;
    var yOff = documentData.s*1.2*.714;
    var firstLine = true;
    var renderedData = this.viewData, animatorProps, animatorSelector;
    var j, jLen;
    var lettersValue = Array.apply(null,{length:len}), letterValue;

    jLen = renderedData.a.length;
    var lastLetter;

    var mult, ind = -1, offf, xPathPos, yPathPos;
    var initPathPos = currentLength,initSegmentInd = segmentInd, initPointInd = pointInd, currentLine = -1;
    var elemOpacity;
    var sc,sw,fc,k;
    var lineLength = 0;
    var letterSw,letterSc,letterFc,letterM,letterP,letterO;
    for( i = 0; i < len; i += 1) {
        matrixHelper.reset();
        elemOpacity = 1;
        if(letters[i].n) {
            xPos = 0;
            yPos += documentData.yOffset;
            yPos += firstLine ? 1 : 0;
            currentLength = initPathPos ;
            firstLine = false;
            lineLength = 0;
            if(this.maskPath) {
                segmentInd = initSegmentInd;
                pointInd = initPointInd;
                points = segments[segmentInd].bezierData.points;
                prevPoint = points[pointInd - 1];
                currentPoint = points[pointInd];
                partialLength = currentPoint.partialLength;
                segmentLength = 0;
            }
            lettersValue[i] = this.emptyProp;
        }else{
            if(this.maskPath) {
                if(currentLine !== letters[i].line){
                    switch(documentData.j){
                        case 1:
                            currentLength += totalLength - documentData.lineWidths[letters[i].line];
                            break;
                        case 2:
                            currentLength += (totalLength - documentData.lineWidths[letters[i].line])/2;
                            break;
                    }
                    currentLine = letters[i].line;
                }
                if (ind !== letters[i].ind) {
                    if (letters[ind]) {
                        currentLength += letters[ind].extra;
                    }
                    currentLength += letters[i].an / 2;
                    ind = letters[i].ind;
                }
                currentLength += renderedData.m.a.v[0] * letters[i].an / 200;
                var animatorOffset = 0;
                for (j = 0; j < jLen; j += 1) {
                    animatorProps = renderedData.a[j].a;
                    if ('p' in animatorProps) {
                        animatorSelector = renderedData.a[j].s;
                        mult = animatorSelector.getMult(letters[i].anIndexes[j],data.t.a[j].s.totalChars);
                        if(mult.length){
                            animatorOffset += animatorProps.p.v[0] * mult[0];
                        } else{
                            animatorOffset += animatorProps.p.v[0] * mult;
                        }

                    }
                    if ('a' in animatorProps) {
                        animatorSelector = renderedData.a[j].s;
                        mult = animatorSelector.getMult(letters[i].anIndexes[j],data.t.a[j].s.totalChars);
                        if(mult.length){
                            animatorOffset += animatorProps.a.v[0] * mult[0];
                        } else{
                            animatorOffset += animatorProps.a.v[0] * mult;
                        }

                    }
                }
                flag = true;
                while (flag) {
                    if (segmentLength + partialLength >= currentLength + animatorOffset || !points) {
                        perc = (currentLength + animatorOffset - segmentLength) / currentPoint.partialLength;
                        xPathPos = prevPoint.point[0] + (currentPoint.point[0] - prevPoint.point[0]) * perc;
                        yPathPos = prevPoint.point[1] + (currentPoint.point[1] - prevPoint.point[1]) * perc;
                        matrixHelper.translate(-renderedData.m.a.v[0]*letters[i].an/200, -(renderedData.m.a.v[1] * yOff / 100));
                        flag = false;
                    } else if (points) {
                        segmentLength += currentPoint.partialLength;
                        pointInd += 1;
                        if (pointInd >= points.length) {
                            pointInd = 0;
                            segmentInd += 1;
                            if (!segments[segmentInd]) {
                                if (mask.v.c) {
                                    pointInd = 0;
                                    segmentInd = 0;
                                    points = segments[segmentInd].bezierData.points;
                                } else {
                                    segmentLength -= currentPoint.partialLength;
                                    points = null;
                                }
                            } else {
                                points = segments[segmentInd].bezierData.points;
                            }
                        }
                        if (points) {
                            prevPoint = currentPoint;
                            currentPoint = points[pointInd];
                            partialLength = currentPoint.partialLength;
                        }
                    }
                }
                offf = letters[i].an / 2 - letters[i].add;
                matrixHelper.translate(-offf, 0, 0);
            } else {
                offf = letters[i].an/2 - letters[i].add;
                matrixHelper.translate(-offf,0,0);

                // Grouping alignment
                matrixHelper.translate(-renderedData.m.a.v[0]*letters[i].an/200, -renderedData.m.a.v[1]*yOff/100, 0);
            }

            lineLength += letters[i].l/2;
            for(j=0;j<jLen;j+=1){
                animatorProps = renderedData.a[j].a;
                if ('t' in animatorProps) {
                    animatorSelector = renderedData.a[j].s;
                    mult = animatorSelector.getMult(letters[i].anIndexes[j],data.t.a[j].s.totalChars);
                    if(this.maskPath) {
                        if(mult.length) {
                            currentLength += animatorProps.t*mult[0];
                        } else {
                            currentLength += animatorProps.t*mult;
                        }
                    }else{
                        if(mult.length) {
                            xPos += animatorProps.t.v*mult[0];
                        } else {
                            xPos += animatorProps.t.v*mult;
                        }
                    }
                }
            }
            lineLength += letters[i].l/2;
            if(documentData.strokeWidthAnim) {
                sw = documentData.sw || 0;
            }
            if(documentData.strokeColorAnim) {
                if(documentData.sc){
                    sc = [documentData.sc[0], documentData.sc[1], documentData.sc[2]];
                }else{
                    sc = [0,0,0];
                }
            }
            if(documentData.fillColorAnim) {
                fc = [documentData.fc[0], documentData.fc[1], documentData.fc[2]];
            }
            for(j=0;j<jLen;j+=1){
                animatorProps = renderedData.a[j].a;
                if ('a' in animatorProps) {
                    animatorSelector = renderedData.a[j].s;
                    mult = animatorSelector.getMult(letters[i].anIndexes[j],data.t.a[j].s.totalChars);

                    if(mult.length){
                        matrixHelper.translate(-animatorProps.a.v[0]*mult[0], -animatorProps.a.v[1]*mult[1], animatorProps.a.v[2]*mult[2]);
                    } else {
                        matrixHelper.translate(-animatorProps.a.v[0]*mult, -animatorProps.a.v[1]*mult, animatorProps.a.v[2]*mult);
                    }
                }
            }
            for(j=0;j<jLen;j+=1){
                animatorProps = renderedData.a[j].a;
                if ('s' in animatorProps) {
                    animatorSelector = renderedData.a[j].s;
                    mult = animatorSelector.getMult(letters[i].anIndexes[j],data.t.a[j].s.totalChars);
                    if(mult.length){
                        matrixHelper.scale(1+((animatorProps.s.v[0]-1)*mult[0]),1+((animatorProps.s.v[1]-1)*mult[1]),1);
                    } else {
                        matrixHelper.scale(1+((animatorProps.s.v[0]-1)*mult),1+((animatorProps.s.v[1]-1)*mult),1);
                    }
                }
            }
            for(j=0;j<jLen;j+=1) {
                animatorProps = renderedData.a[j].a;
                animatorSelector = renderedData.a[j].s;
                mult = animatorSelector.getMult(letters[i].anIndexes[j],data.t.a[j].s.totalChars);
                if ('sk' in animatorProps) {
                    if(mult.length) {
                        matrixHelper.skewFromAxis(-animatorProps.sk.v * mult[0], animatorProps.sa.v * mult[1]);
                    } else {
                        matrixHelper.skewFromAxis(-animatorProps.sk.v * mult, animatorProps.sa.v * mult);
                    }
                }
                if ('r' in animatorProps) {
                    if(mult.length) {
                        matrixHelper.rotateZ(-animatorProps.r.v * mult[2]);
                    } else {
                        matrixHelper.rotateZ(-animatorProps.r.v * mult);
                    }
                }
                if ('ry' in animatorProps) {

                    if(mult.length) {
                        matrixHelper.rotateY(animatorProps.ry.v*mult[1]);
                    }else{
                        matrixHelper.rotateY(animatorProps.ry.v*mult);
                    }
                }
                if ('rx' in animatorProps) {
                    if(mult.length) {
                        matrixHelper.rotateX(animatorProps.rx.v*mult[0]);
                    } else {
                        matrixHelper.rotateX(animatorProps.rx.v*mult);
                    }
                }
                if ('o' in animatorProps) {
                    if(mult.length) {
                        elemOpacity += ((animatorProps.o.v)*mult[0] - elemOpacity)*mult[0];
                    } else {
                        elemOpacity += ((animatorProps.o.v)*mult - elemOpacity)*mult;
                    }
                }
                if (documentData.strokeWidthAnim && 'sw' in animatorProps) {
                    if(mult.length) {
                        sw += animatorProps.sw.v*mult[0];
                    } else {
                        sw += animatorProps.sw.v*mult;
                    }
                }
                if (documentData.strokeColorAnim && 'sc' in animatorProps) {
                    for(k=0;k<3;k+=1){
                        if(mult.length) {
                            sc[k] = Math.round(255*(sc[k] + (animatorProps.sc.v[k] - sc[k])*mult[0]));
                        } else {
                            sc[k] = Math.round(255*(sc[k] + (animatorProps.sc.v[k] - sc[k])*mult));
                        }
                    }
                }
                if (documentData.fillColorAnim) {
                    if('fc' in animatorProps){
                        for(k=0;k<3;k+=1){
                            if(mult.length) {
                                fc[k] = fc[k] + (animatorProps.fc.v[k] - fc[k])*mult[0];
                            } else {
                                fc[k] = fc[k] + (animatorProps.fc.v[k] - fc[k])*mult;
                                //console.log('mult',mult);
                                //console.log(Math.round(fc[k] + (animatorProps.fc.v[k] - fc[k])*mult));
                            }
                        }
                    }
                    if('fh' in animatorProps){
                        if(mult.length) {
                            fc = addHueToRGB(fc,animatorProps.fh.v*mult[0]);
                        } else {
                            fc = addHueToRGB(fc,animatorProps.fh.v*mult);
                        }
                    }
                    if('fs' in animatorProps){
                        if(mult.length) {
                            fc = addSaturationToRGB(fc,animatorProps.fs.v*mult[0]);
                        } else {
                            fc = addSaturationToRGB(fc,animatorProps.fs.v*mult);
                        }
                    }
                    if('fb' in animatorProps){
                        if(mult.length) {
                            fc = addBrightnessToRGB(fc,animatorProps.fb.v*mult[0]);
                        } else {
                            fc = addBrightnessToRGB(fc,animatorProps.fb.v*mult);
                        }
                    }
                }
            }

            for(j=0;j<jLen;j+=1){
                animatorProps = renderedData.a[j].a;

                if ('p' in animatorProps) {
                    animatorSelector = renderedData.a[j].s;
                    mult = animatorSelector.getMult(letters[i].anIndexes[j],data.t.a[j].s.totalChars);
                    if(this.maskPath) {
                        if(mult.length) {
                            matrixHelper.translate(0, animatorProps.p.v[1] * mult[0], -animatorProps.p.v[2] * mult[1]);
                        } else {
                            matrixHelper.translate(0, animatorProps.p.v[1] * mult, -animatorProps.p.v[2] * mult);
                        }
                    }else{
                        if(mult.length) {
                            matrixHelper.translate(animatorProps.p.v[0] * mult[0], animatorProps.p.v[1] * mult[1], -animatorProps.p.v[2] * mult[2]);
                        } else {
                            matrixHelper.translate(animatorProps.p.v[0] * mult, animatorProps.p.v[1] * mult, -animatorProps.p.v[2] * mult);
                        }
                    }
                }
            }
            if(documentData.strokeWidthAnim){
                letterSw = sw < 0 ? 0 : sw;
            }
            if(documentData.strokeColorAnim){
                letterSc = 'rgb('+Math.round(sc[0]*255)+','+Math.round(sc[1]*255)+','+Math.round(sc[2]*255)+')';
            }
            if(documentData.fillColorAnim){
                letterFc = 'rgb('+Math.round(fc[0]*255)+','+Math.round(fc[1]*255)+','+Math.round(fc[2]*255)+')';
            }

            if(this.maskPath) {
                matrixHelper.translate(0,-documentData.ls);

                matrixHelper.translate(0, renderedData.m.a.v[1]*yOff/100 + yPos,0);
                if (data.t.p.p) {
                    tanAngle = (currentPoint.point[1] - prevPoint.point[1]) / (currentPoint.point[0] - prevPoint.point[0]);
                    var rot = Math.atan(tanAngle) * 180 / Math.PI;
                    if (currentPoint.point[0] < prevPoint.point[0]) {
                        rot += 180;
                    }
                    matrixHelper.rotate(-rot * Math.PI / 180);
                }
                matrixHelper.translate(xPathPos, yPathPos, 0);
                currentLength -= renderedData.m.a.v[0]*letters[i].an/200;
                if(letters[i+1] && ind !== letters[i+1].ind){
                    currentLength += letters[i].an / 2;
                    currentLength += documentData.tr/1000*documentData.s;
                }
            }else{

                matrixHelper.translate(xPos,yPos,0);

                if(documentData.ps){
                    //matrixHelper.translate(documentData.ps[0],documentData.ps[1],0);
                    matrixHelper.translate(documentData.ps[0],documentData.ps[1] + documentData.ascent,0);
                }
                switch(documentData.j){
                    case 1:
                        matrixHelper.translate(documentData.justifyOffset + (documentData.boxWidth - documentData.lineWidths[letters[i].line]),0,0);
                        break;
                    case 2:
                        matrixHelper.translate(documentData.justifyOffset + (documentData.boxWidth - documentData.lineWidths[letters[i].line])/2,0,0);
                        break;
                }
                matrixHelper.translate(0,-documentData.ls);
                matrixHelper.translate(offf,0,0);
                matrixHelper.translate(renderedData.m.a.v[0]*letters[i].an/200,renderedData.m.a.v[1]*yOff/100,0);
                xPos += letters[i].l + documentData.tr/1000*documentData.s;
            }
            if(renderType === 'html'){
                letterM = matrixHelper.toCSS();
            }else if(renderType === 'svg'){
                letterM = matrixHelper.to2dCSS();
            }else{
                letterP = [matrixHelper.props[0],matrixHelper.props[1],matrixHelper.props[2],matrixHelper.props[3],matrixHelper.props[4],matrixHelper.props[5],matrixHelper.props[6],matrixHelper.props[7],matrixHelper.props[8],matrixHelper.props[9],matrixHelper.props[10],matrixHelper.props[11],matrixHelper.props[12],matrixHelper.props[13],matrixHelper.props[14],matrixHelper.props[15]];
            }
            letterO = elemOpacity;

            lastLetter = this.renderedLetters[i];
            if(lastLetter && (lastLetter.o !== letterO || lastLetter.sw !== letterSw || lastLetter.sc !== letterSc || lastLetter.fc !== letterFc)){
                this.lettersChangedFlag = true;
                letterValue = new LetterProps(letterO,letterSw,letterSc,letterFc,letterM,letterP);
            }else{
                if((renderType === 'svg' || renderType === 'html') && (!lastLetter || lastLetter.m !== letterM)){
                    this.lettersChangedFlag = true;
                    letterValue = new LetterProps(letterO,letterSw,letterSc,letterFc,letterM);
                }else if(renderType === 'canvas' && (!lastLetter || (lastLetter.props[0] !== letterP[0] || lastLetter.props[1] !== letterP[1] || lastLetter.props[4] !== letterP[4] || lastLetter.props[5] !== letterP[5] || lastLetter.props[12] !== letterP[12] || lastLetter.props[13] !== letterP[13]))){
                    this.lettersChangedFlag = true;
                    letterValue = new LetterProps(letterO,letterSw,letterSc,letterFc,null,letterP);
                } else {
                    letterValue = lastLetter;
                }
            }
            this.renderedLetters[i] = letterValue;
        }
    }
};

ITextElement.prototype.buildShapeString = IShapeElement.prototype.buildShapeString;

ITextElement.prototype.emptyProp = new LetterProps();

function SVGTextElement(data,parentContainer,globalData,comp, placeholder){
    this.textSpans = [];
    this.renderType = 'svg';
    this._parent.constructor.call(this,data,parentContainer,globalData,comp, placeholder);
}
createElement(SVGBaseElement, SVGTextElement);

SVGTextElement.prototype.init = ITextElement.prototype.init;
SVGTextElement.prototype.createPathShape = ITextElement.prototype.createPathShape;
SVGTextElement.prototype.getMeasures = ITextElement.prototype.getMeasures;
SVGTextElement.prototype.prepareFrame = ITextElement.prototype.prepareFrame;
SVGTextElement.prototype.buildShapeString = ITextElement.prototype.buildShapeString;

SVGTextElement.prototype.createElements = function(){

    this._parent.createElements.call(this);


    if(this.data.ln){
        this.layerElement.setAttribute('id',this.data.ln);
    }
    if(this.data.cl){
        this.layerElement.setAttribute('class',this.data.cl);
    }
};

SVGTextElement.prototype.buildNewText = function(){
    var i, len;

    var documentData = this.currentTextDocumentData;
    this.renderedLetters = Array.apply(null,{length:this.currentTextDocumentData.l ? this.currentTextDocumentData.l.length : 0});
    if(documentData.fc) {
        this.layerElement.setAttribute('fill', 'rgb(' + Math.round(documentData.fc[0]*255) + ',' + Math.round(documentData.fc[1]*255) + ',' + Math.round(documentData.fc[2]*255) + ')');
    }else{
        this.layerElement.setAttribute('fill', 'rgba(0,0,0,0)');
    }
    if(documentData.sc){
        this.layerElement.setAttribute('stroke', 'rgb(' + Math.round(documentData.sc[0]*255) + ',' + Math.round(documentData.sc[1]*255) + ',' + Math.round(documentData.sc[2]*255) + ')');
        this.layerElement.setAttribute('stroke-width', documentData.sw);
    }
    this.layerElement.setAttribute('font-size', documentData.s);
    var fontData = this.globalData.fontManager.getFontByName(documentData.f);
    if(fontData.fClass){
        this.layerElement.setAttribute('class',fontData.fClass);
    } else {
        this.layerElement.setAttribute('font-family', fontData.fFamily);
        var fWeight = documentData.fWeight, fStyle = documentData.fStyle;
        this.layerElement.setAttribute('font-style', fStyle);
        this.layerElement.setAttribute('font-weight', fWeight);
    }



    var letters = documentData.l || [];
    len = letters.length;
    if(!len){
        return;
    }
    var tSpan;
    var matrixHelper = this.mHelper;
    var shapes, shapeStr = '', singleShape = this.data.singleShape;
    if (singleShape) {
        var xPos = 0, yPos = 0, lineWidths = documentData.lineWidths, boxWidth = documentData.boxWidth, firstLine = true;
    }
    var cnt = 0;
    for (i = 0;i < len ;i += 1) {
        if(this.globalData.fontManager.chars){
            if(!singleShape || i === 0){
                tSpan = this.textSpans[cnt] ? this.textSpans[cnt] : document.createElementNS(svgNS,'path');
            }
        }else{
            tSpan = this.textSpans[cnt] ? this.textSpans[cnt] : document.createElementNS(svgNS,'text');
        }
        tSpan.style.display = 'inherit';
        tSpan.setAttribute('stroke-linecap', 'butt');
        tSpan.setAttribute('stroke-linejoin','round');
        tSpan.setAttribute('stroke-miterlimit','4');
        //tSpan.setAttribute('visibility', 'hidden');
        if(singleShape && letters[i].n) {
            xPos = 0;
            yPos += documentData.yOffset;
            yPos += firstLine ? 1 : 0;
            firstLine = false;
        }
        matrixHelper.reset();
        if(this.globalData.fontManager.chars) {
            matrixHelper.scale(documentData.s / 100, documentData.s / 100);
        }
        if (singleShape) {
            if(documentData.ps){
                matrixHelper.translate(documentData.ps[0],documentData.ps[1] + documentData.ascent,0);
            }
            matrixHelper.translate(0,-documentData.ls,0);
            switch(documentData.j){
                case 1:
                    matrixHelper.translate(documentData.justifyOffset + (boxWidth - lineWidths[letters[i].line]),0,0);
                    break;
                case 2:
                    matrixHelper.translate(documentData.justifyOffset + (boxWidth - lineWidths[letters[i].line])/2,0,0);
                    break;
            }
            matrixHelper.translate(xPos, yPos, 0);
        }
        if(this.globalData.fontManager.chars){
            var charData = this.globalData.fontManager.getCharData(documentData.t.charAt(i), fontData.fStyle, this.globalData.fontManager.getFontByName(documentData.f).fFamily);
            var shapeData;
            if(charData){
                shapeData = charData.data;
            } else {
                shapeData = null;
            }
            if(shapeData && shapeData.shapes){
                shapes = shapeData.shapes[0].it;
                if(!singleShape){
                    shapeStr = '';
                }
                shapeStr += this.createPathShape(matrixHelper,shapes);
                if(!singleShape){

                    tSpan.setAttribute('d',shapeStr);
                }
            }
            if(!singleShape){
                this.layerElement.appendChild(tSpan);
            }
        }else{
            tSpan.textContent = letters[i].val;
            tSpan.setAttributeNS("http://www.w3.org/XML/1998/namespace", "xml:space","preserve");
            this.layerElement.appendChild(tSpan);
            if(singleShape){
                tSpan.setAttribute('transform',matrixHelper.to2dCSS());
            }
        }
        if(singleShape) {
            xPos += letters[i].l || 0;
            xPos += documentData.tr/1000*documentData.s;
        }
        //
        this.textSpans[cnt] = tSpan;
        cnt += 1;
    }
    if(!singleShape){
        while(cnt < this.textSpans.length){
            this.textSpans[cnt].style.display = 'none';
            cnt += 1;
        }
    }
    if(singleShape && this.globalData.fontManager.chars){
        tSpan.setAttribute('d',shapeStr);
        this.layerElement.appendChild(tSpan);
    }
}

SVGTextElement.prototype.renderFrame = function(parentMatrix){

    var renderParent = this._parent.renderFrame.call(this,parentMatrix);
    if(renderParent===false){
        this.hide();
        return;
    }
    if(this.hidden){
        this.show();
    }

    if(this.data.singleShape){
        return;
    }
    this.getMeasures();
    if(!this.lettersChangedFlag){
        return;
    }
    var  i,len;
    var renderedLetters = this.renderedLetters;

    var letters = this.currentTextDocumentData.l;

    len = letters.length;
    var renderedLetter;
    for(i=0;i<len;i+=1){
        if(letters[i].n){
            continue;
        }
        renderedLetter = renderedLetters[i];
        this.textSpans[i].setAttribute('transform',renderedLetter.m);
        this.textSpans[i].setAttribute('opacity',renderedLetter.o);
        if(renderedLetter.sw){
            this.textSpans[i].setAttribute('stroke-width',renderedLetter.sw);
        }
        if(renderedLetter.sc){
            this.textSpans[i].setAttribute('stroke',renderedLetter.sc);
        }
        if(renderedLetter.fc){
            this.textSpans[i].setAttribute('fill',renderedLetter.fc);
        }
    }
    if(this.firstFrame) {
        this.firstFrame = false;
    }
}


SVGTextElement.prototype.destroy = function(){
    this._parent.destroy.call(this._parent);
};
function SVGTintFilter(filter, filterManager){
    this.filterManager = filterManager;
    var feColorMatrix = document.createElementNS(svgNS,'feColorMatrix');
    feColorMatrix.setAttribute('type','matrix');
    feColorMatrix.setAttribute('color-interpolation-filters','linearRGB');
    feColorMatrix.setAttribute('values','0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0 0 0 1 0');
    feColorMatrix.setAttribute('result','f1');
    filter.appendChild(feColorMatrix);
    feColorMatrix = document.createElementNS(svgNS,'feColorMatrix');
    feColorMatrix.setAttribute('type','matrix');
    feColorMatrix.setAttribute('color-interpolation-filters','sRGB');
    feColorMatrix.setAttribute('values','1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 1 0');
    feColorMatrix.setAttribute('result','f2');
    filter.appendChild(feColorMatrix);
    this.matrixFilter = feColorMatrix;
    if(filterManager.effectElements[2].p.v !== 100 || filterManager.effectElements[2].p.k){
        var feMerge = document.createElementNS(svgNS,'feMerge');
        filter.appendChild(feMerge);
        var feMergeNode;
        feMergeNode = document.createElementNS(svgNS,'feMergeNode');
        feMergeNode.setAttribute('in','SourceGraphic');
        feMerge.appendChild(feMergeNode);
        feMergeNode = document.createElementNS(svgNS,'feMergeNode');
        feMergeNode.setAttribute('in','f2');
        feMerge.appendChild(feMergeNode);
    }
}

SVGTintFilter.prototype.renderFrame = function(forceRender){
    if(forceRender || this.filterManager.mdf){
        var colorBlack = this.filterManager.effectElements[0].p.v;
        var colorWhite = this.filterManager.effectElements[1].p.v;
        var opacity = this.filterManager.effectElements[2].p.v/100;
        this.matrixFilter.setAttribute('values',(colorWhite[0]- colorBlack[0])+' 0 0 0 '+ colorBlack[0] +' '+ (colorWhite[1]- colorBlack[1]) +' 0 0 0 '+ colorBlack[1] +' '+ (colorWhite[2]- colorBlack[2]) +' 0 0 0 '+ colorBlack[2] +' 0 0 0 ' + opacity + ' 0');
    }
};
function SVGFillFilter(filter, filterManager){
    this.filterManager = filterManager;
    var feColorMatrix = document.createElementNS(svgNS,'feColorMatrix');
    feColorMatrix.setAttribute('type','matrix');
    feColorMatrix.setAttribute('color-interpolation-filters','sRGB');
    feColorMatrix.setAttribute('values','1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 1 0');
    filter.appendChild(feColorMatrix);
    this.matrixFilter = feColorMatrix;
}
SVGFillFilter.prototype.renderFrame = function(forceRender){
    if(forceRender || this.filterManager.mdf){
        var color = this.filterManager.effectElements[2].p.v;
        var opacity = this.filterManager.effectElements[6].p.v;
        this.matrixFilter.setAttribute('values','0 0 0 0 '+color[0]+' 0 0 0 0 '+color[1]+' 0 0 0 0 '+color[2]+' 0 0 0 '+opacity+' 0');
    }
};
function SVGStrokeEffect(elem, filterManager){
    this.initialized = false;
    this.filterManager = filterManager;
    this.elem = elem;
    this.paths = [];
}

SVGStrokeEffect.prototype.initialize = function(){

    var elemChildren = this.elem.layerElement.children || this.elem.layerElement.childNodes;
    var path,groupPath, i, len;
    if(this.filterManager.effectElements[1].p.v === 1){
        len = this.elem.maskManager.masksProperties.length;
        i = 0;
    } else {
        i = this.filterManager.effectElements[0].p.v - 1;
        len = i + 1;
    }
    groupPath = document.createElementNS(svgNS,'g'); 
    groupPath.setAttribute('fill','none');
    groupPath.setAttribute('stroke-linecap','round');
    groupPath.setAttribute('stroke-dashoffset',1);
    for(i;i<len;i+=1){
        path = document.createElementNS(svgNS,'path');
        groupPath.appendChild(path);
        this.paths.push({p:path,m:i});
    }
    if(this.filterManager.effectElements[10].p.v === 3){
        var mask = document.createElementNS(svgNS,'mask');
        var id = 'stms_' + randomString(10);
        mask.setAttribute('id',id);
        mask.setAttribute('mask-type','alpha');
        mask.appendChild(groupPath);
        this.elem.globalData.defs.appendChild(mask);
        var g = document.createElementNS(svgNS,'g');
        g.setAttribute('mask','url(#'+id+')');
        if(elemChildren[0]){
            g.appendChild(elemChildren[0]);
        }
        this.elem.layerElement.appendChild(g);
        this.masker = mask;
        groupPath.setAttribute('stroke','#fff');
    } else if(this.filterManager.effectElements[10].p.v === 1 || this.filterManager.effectElements[10].p.v === 2){
        if(this.filterManager.effectElements[10].p.v === 2){
            var elemChildren = this.elem.layerElement.children || this.elem.layerElement.childNodes;
            while(elemChildren.length){
                this.elem.layerElement.removeChild(elemChildren[0]);
            }
        }
        this.elem.layerElement.appendChild(groupPath);
        this.elem.layerElement.removeAttribute('mask');
        groupPath.setAttribute('stroke','#fff');
    }
    this.initialized = true;
    this.pathMasker = groupPath;
}

SVGStrokeEffect.prototype.renderFrame = function(forceRender){
    if(!this.initialized){
        this.initialize();
    }
    var i, len = this.paths.length;
    var mask, path;
    for(i=0;i<len;i+=1){
        mask = this.elem.maskManager.viewData[this.paths[i].m];
        path = this.paths[i].p;
        if(forceRender || this.filterManager.mdf || mask.prop.mdf){
            path.setAttribute('d',mask.lastPath);
        }
        if(forceRender || this.filterManager.effectElements[9].p.mdf || this.filterManager.effectElements[4].p.mdf || this.filterManager.effectElements[7].p.mdf || this.filterManager.effectElements[8].p.mdf || mask.prop.mdf){
            var dasharrayValue;
            if(this.filterManager.effectElements[7].p.v !== 0 || this.filterManager.effectElements[8].p.v !== 100){
                var s = Math.min(this.filterManager.effectElements[7].p.v,this.filterManager.effectElements[8].p.v)/100;
                var e = Math.max(this.filterManager.effectElements[7].p.v,this.filterManager.effectElements[8].p.v)/100;
                var l = path.getTotalLength();
                dasharrayValue = '0 0 0 ' + l*s + ' ';
                var lineLength = l*(e-s);
                var segment = 1+this.filterManager.effectElements[4].p.v*2*this.filterManager.effectElements[9].p.v/100;
                var units = Math.floor(lineLength/segment);
                var j;
                for(j=0;j<units;j+=1){
                    dasharrayValue += '1 ' + this.filterManager.effectElements[4].p.v*2*this.filterManager.effectElements[9].p.v/100 + ' ';
                }
                dasharrayValue += '0 ' + l*10 + ' 0 0';
            } else {
                dasharrayValue = '1 ' + this.filterManager.effectElements[4].p.v*2*this.filterManager.effectElements[9].p.v/100;
            }
            path.setAttribute('stroke-dasharray',dasharrayValue);
        }
    }
    if(forceRender || this.filterManager.effectElements[4].p.mdf){
        this.pathMasker.setAttribute('stroke-width',this.filterManager.effectElements[4].p.v*2);
    }
    
    if(forceRender || this.filterManager.effectElements[6].p.mdf){
        this.pathMasker.setAttribute('opacity',this.filterManager.effectElements[6].p.v);
    }
    if(this.filterManager.effectElements[10].p.v === 1 || this.filterManager.effectElements[10].p.v === 2){
        if(forceRender || this.filterManager.effectElements[3].p.mdf){
            var color = this.filterManager.effectElements[3].p.v;
            this.pathMasker.setAttribute('stroke','rgb('+bm_floor(color[0]*255)+','+bm_floor(color[1]*255)+','+bm_floor(color[2]*255)+')');
        }
    }
};
function SVGTritoneFilter(filter, filterManager){
    this.filterManager = filterManager;
    var feColorMatrix = document.createElementNS(svgNS,'feColorMatrix');
    feColorMatrix.setAttribute('type','matrix');
    feColorMatrix.setAttribute('color-interpolation-filters','linearRGB');
    feColorMatrix.setAttribute('values','0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0 0 0 1 0');
    feColorMatrix.setAttribute('result','f1');
    filter.appendChild(feColorMatrix);
    var feComponentTransfer = document.createElementNS(svgNS,'feComponentTransfer');
    feComponentTransfer.setAttribute('color-interpolation-filters','sRGB');
    filter.appendChild(feComponentTransfer);
    this.matrixFilter = feComponentTransfer;
    var feFuncR = document.createElementNS(svgNS,'feFuncR');
    feFuncR.setAttribute('type','table');
    feComponentTransfer.appendChild(feFuncR);
    this.feFuncR = feFuncR;
    var feFuncG = document.createElementNS(svgNS,'feFuncG');
    feFuncG.setAttribute('type','table');
    feComponentTransfer.appendChild(feFuncG);
    this.feFuncG = feFuncG;
    var feFuncB = document.createElementNS(svgNS,'feFuncB');
    feFuncB.setAttribute('type','table');
    feComponentTransfer.appendChild(feFuncB);
    this.feFuncB = feFuncB;
}

SVGTritoneFilter.prototype.renderFrame = function(forceRender){
    if(forceRender || this.filterManager.mdf){
        var color1 = this.filterManager.effectElements[0].p.v;
        var color2 = this.filterManager.effectElements[1].p.v;
        var color3 = this.filterManager.effectElements[2].p.v;
        var tableR = color3[0] + ' ' + color2[0] + ' ' + color1[0]
        var tableG = color3[1] + ' ' + color2[1] + ' ' + color1[1]
        var tableB = color3[2] + ' ' + color2[2] + ' ' + color1[2]
        this.feFuncR.setAttribute('tableValues', tableR);
        this.feFuncG.setAttribute('tableValues', tableG);
        this.feFuncB.setAttribute('tableValues', tableB);
        //var opacity = this.filterManager.effectElements[2].p.v/100;
        //this.matrixFilter.setAttribute('values',(colorWhite[0]- colorBlack[0])+' 0 0 0 '+ colorBlack[0] +' '+ (colorWhite[1]- colorBlack[1]) +' 0 0 0 '+ colorBlack[1] +' '+ (colorWhite[2]- colorBlack[2]) +' 0 0 0 '+ colorBlack[2] +' 0 0 0 ' + opacity + ' 0');
    }
};
function SVGProLevelsFilter(filter, filterManager){
    this.filterManager = filterManager;
    var effectElements = this.filterManager.effectElements;
    var feComponentTransfer = document.createElementNS(svgNS,'feComponentTransfer');
    var feFuncR, feFuncG, feFuncB;
    
    if(effectElements[9].p.k || effectElements[9].p.v !== 0 || effectElements[10].p.k || effectElements[10].p.v !== 1 || effectElements[11].p.k || effectElements[11].p.v !== 1 || effectElements[12].p.k || effectElements[12].p.v !== 0 || effectElements[13].p.k || effectElements[13].p.v !== 1){
        this.feFuncR = this.createFeFunc('feFuncR', feComponentTransfer);
    }
    if(effectElements[16].p.k || effectElements[16].p.v !== 0 || effectElements[17].p.k || effectElements[17].p.v !== 1 || effectElements[18].p.k || effectElements[18].p.v !== 1 || effectElements[19].p.k || effectElements[19].p.v !== 0 || effectElements[20].p.k || effectElements[20].p.v !== 1){
        this.feFuncG = this.createFeFunc('feFuncG', feComponentTransfer);
    }
    if(effectElements[23].p.k || effectElements[23].p.v !== 0 || effectElements[24].p.k || effectElements[24].p.v !== 1 || effectElements[25].p.k || effectElements[25].p.v !== 1 || effectElements[26].p.k || effectElements[26].p.v !== 0 || effectElements[27].p.k || effectElements[27].p.v !== 1){
        this.feFuncB = this.createFeFunc('feFuncB', feComponentTransfer);
    }
    if(effectElements[30].p.k || effectElements[30].p.v !== 0 || effectElements[31].p.k || effectElements[31].p.v !== 1 || effectElements[32].p.k || effectElements[32].p.v !== 1 || effectElements[33].p.k || effectElements[33].p.v !== 0 || effectElements[34].p.k || effectElements[34].p.v !== 1){
        this.feFuncA = this.createFeFunc('feFuncA', feComponentTransfer);
    }
    
    if(this.feFuncR || this.feFuncG || this.feFuncB || this.feFuncA){
        feComponentTransfer.setAttribute('color-interpolation-filters','sRGB');
        filter.appendChild(feComponentTransfer);
        feComponentTransfer = document.createElementNS(svgNS,'feComponentTransfer');
    }

    if(effectElements[2].p.k || effectElements[2].p.v !== 0 || effectElements[3].p.k || effectElements[3].p.v !== 1 || effectElements[4].p.k || effectElements[4].p.v !== 1 || effectElements[5].p.k || effectElements[5].p.v !== 0 || effectElements[6].p.k || effectElements[6].p.v !== 1){

        feComponentTransfer.setAttribute('color-interpolation-filters','sRGB');
        filter.appendChild(feComponentTransfer);
        this.feFuncRComposed = this.createFeFunc('feFuncR', feComponentTransfer);
        this.feFuncGComposed = this.createFeFunc('feFuncG', feComponentTransfer);
        this.feFuncBComposed = this.createFeFunc('feFuncB', feComponentTransfer);
    }
}

SVGProLevelsFilter.prototype.createFeFunc = function(type, feComponentTransfer) {
    var feFunc = document.createElementNS(svgNS,type);
    feFunc.setAttribute('type','table');
    feComponentTransfer.appendChild(feFunc);
    return feFunc;
};

SVGProLevelsFilter.prototype.getTableValue = function(inputBlack, inputWhite, gamma, outputBlack, outputWhite) {
    var cnt = 0;
    var segments = 256;
    var perc;
    var min = Math.min(inputBlack, inputWhite);
    var max = Math.max(inputBlack, inputWhite);
    var table = Array.call(null,{length:segments});
    var colorValue;
    var pos = 0;
    var outputDelta = outputWhite - outputBlack; 
    var inputDelta = inputWhite - inputBlack; 
    while(cnt <= 256) {
        perc = cnt/256;
        if(perc <= min){
            colorValue = inputDelta < 0 ? outputWhite : outputBlack;
        } else if(perc >= max){
            colorValue = inputDelta < 0 ? outputBlack : outputWhite;
        } else {
            colorValue = (outputBlack + outputDelta * Math.pow((perc - inputBlack) / inputDelta, 1 / gamma));
        }
        table[pos++] = colorValue;
        cnt += 256/(segments-1);
    }
    return table.join(' ');
};

SVGProLevelsFilter.prototype.renderFrame = function(forceRender){
    if(forceRender || this.filterManager.mdf){
        var val, cnt, perc, bezier;
        var effectElements = this.filterManager.effectElements;
        if(this.feFuncRComposed && (forceRender || effectElements[2].p.mdf || effectElements[3].p.mdf || effectElements[4].p.mdf || effectElements[5].p.mdf || effectElements[6].p.mdf)){
            val = this.getTableValue(effectElements[2].p.v,effectElements[3].p.v,effectElements[4].p.v,effectElements[5].p.v,effectElements[6].p.v);
            this.feFuncRComposed.setAttribute('tableValues',val);
            this.feFuncGComposed.setAttribute('tableValues',val);
            this.feFuncBComposed.setAttribute('tableValues',val);
        }

        if(this.feFuncR && (forceRender || effectElements[9].p.mdf || effectElements[10].p.mdf || effectElements[11].p.mdf || effectElements[12].p.mdf || effectElements[13].p.mdf)){
            val = this.getTableValue(effectElements[9].p.v,effectElements[10].p.v,effectElements[11].p.v,effectElements[12].p.v,effectElements[13].p.v);
            this.feFuncR.setAttribute('tableValues',val);
        }

        if(this.feFuncG && (forceRender || effectElements[16].p.mdf || effectElements[17].p.mdf || effectElements[18].p.mdf || effectElements[19].p.mdf || effectElements[20].p.mdf)){
            val = this.getTableValue(effectElements[16].p.v,effectElements[17].p.v,effectElements[18].p.v,effectElements[19].p.v,effectElements[20].p.v);
            this.feFuncG.setAttribute('tableValues',val);
        }

        if(this.feFuncB && (forceRender || effectElements[23].p.mdf || effectElements[24].p.mdf || effectElements[25].p.mdf || effectElements[26].p.mdf || effectElements[27].p.mdf)){
            val = this.getTableValue(effectElements[23].p.v,effectElements[24].p.v,effectElements[25].p.v,effectElements[26].p.v,effectElements[27].p.v);
            this.feFuncB.setAttribute('tableValues',val);
        }

        if(this.feFuncA && (forceRender || effectElements[30].p.mdf || effectElements[31].p.mdf || effectElements[32].p.mdf || effectElements[33].p.mdf || effectElements[34].p.mdf)){
            val = this.getTableValue(effectElements[30].p.v,effectElements[31].p.v,effectElements[32].p.v,effectElements[33].p.v,effectElements[34].p.v);
            this.feFuncA.setAttribute('tableValues',val);
        }
        
    }
};
function SVGDropShadowEffect(filter, filterManager){
    /*<feGaussianBlur in="SourceAlpha" stdDeviation="3"/> <!-- stdDeviation is how much to blur -->
  <feOffset dx="2" dy="2" result="offsetblur"/> <!-- how much to offset -->
  <feMerge> 
    <feMergeNode/> <!-- this contains the offset blurred image -->
    <feMergeNode in="SourceGraphic"/> <!-- this contains the element that the filter is applied to -->
  </feMerge>*/
  /*<feFlood flood-color="#3D4574" flood-opacity="0.5" result="offsetColor"/>*/
    filter.setAttribute('x','-100%');
    filter.setAttribute('y','-100%');
    filter.setAttribute('width','400%');
    filter.setAttribute('height','400%');
    this.filterManager = filterManager;

    var feGaussianBlur = document.createElementNS(svgNS,'feGaussianBlur');
    feGaussianBlur.setAttribute('in','SourceAlpha');
    feGaussianBlur.setAttribute('result','drop_shadow_1');
    feGaussianBlur.setAttribute('stdDeviation','0');
    this.feGaussianBlur = feGaussianBlur;
    filter.appendChild(feGaussianBlur);

    var feOffset = document.createElementNS(svgNS,'feOffset');
    feOffset.setAttribute('dx','25');
    feOffset.setAttribute('dy','0');
    feOffset.setAttribute('in','drop_shadow_1');
    feOffset.setAttribute('result','drop_shadow_2');
    this.feOffset = feOffset;
    filter.appendChild(feOffset);
    var feFlood = document.createElementNS(svgNS,'feFlood');
    feFlood.setAttribute('flood-color','#00ff00');
    feFlood.setAttribute('flood-opacity','1');
    feFlood.setAttribute('result','drop_shadow_3');
    this.feFlood = feFlood;
    filter.appendChild(feFlood);

    var feComposite = document.createElementNS(svgNS,'feComposite');
    feComposite.setAttribute('in','drop_shadow_3');
    feComposite.setAttribute('in2','drop_shadow_2');
    feComposite.setAttribute('operator','in');
    feComposite.setAttribute('result','drop_shadow_4');
    filter.appendChild(feComposite);


    var feMerge = document.createElementNS(svgNS,'feMerge');
    filter.appendChild(feMerge);
    var feMergeNode;
    feMergeNode = document.createElementNS(svgNS,'feMergeNode');
    feMerge.appendChild(feMergeNode);
    feMergeNode = document.createElementNS(svgNS,'feMergeNode');
    feMergeNode.setAttribute('in','SourceGraphic');
    this.feMergeNode = feMergeNode;
    this.feMerge = feMerge;
    this.originalNodeAdded = false;
    feMerge.appendChild(feMergeNode);
}

SVGDropShadowEffect.prototype.renderFrame = function(forceRender){
    if(forceRender || this.filterManager.mdf){
        if(forceRender || this.filterManager.effectElements[4].p.mdf){
            this.feGaussianBlur.setAttribute('stdDeviation', this.filterManager.effectElements[4].p.v / 4);
        }
        if(forceRender || this.filterManager.effectElements[0].p.mdf){
            var col = this.filterManager.effectElements[0].p.v;
            this.feFlood.setAttribute('flood-color',rgbToHex(Math.round(col[0]*255),Math.round(col[1]*255),Math.round(col[2]*255)));
        }
        if(forceRender || this.filterManager.effectElements[1].p.mdf){
            this.feFlood.setAttribute('flood-opacity',this.filterManager.effectElements[1].p.v/255);
        }
        if(forceRender || this.filterManager.effectElements[2].p.mdf || this.filterManager.effectElements[3].p.mdf){
            var distance = this.filterManager.effectElements[3].p.v
            var angle = (this.filterManager.effectElements[2].p.v - 90) * degToRads
            var x = distance * Math.cos(angle)
            var y = distance * Math.sin(angle)
            this.feOffset.setAttribute('dx', x);
            this.feOffset.setAttribute('dy', y);
        }
        /*if(forceRender || this.filterManager.effectElements[5].p.mdf){
            if(this.filterManager.effectElements[5].p.v === 1 && this.originalNodeAdded) {
                this.feMerge.removeChild(this.feMergeNode);
                this.originalNodeAdded = false;
            } else if(this.filterManager.effectElements[5].p.v === 0 && !this.originalNodeAdded) {
                this.feMerge.appendChild(this.feMergeNode);
                this.originalNodeAdded = true;
            }
        }*/
    }
};
function SVGEffects(elem){
    var i, len = elem.data.ef.length;
    var filId = randomString(10);
    var fil = filtersFactory.createFilter(filId);
    var count = 0;
    this.filters = [];
    var filterManager;
    for(i=0;i<len;i+=1){
        if(elem.data.ef[i].ty === 20){
            count += 1;
            filterManager = new SVGTintFilter(fil, elem.effects.effectElements[i]);
            this.filters.push(filterManager);
        }else if(elem.data.ef[i].ty === 21){
            count += 1;
            filterManager = new SVGFillFilter(fil, elem.effects.effectElements[i]);
            this.filters.push(filterManager);
        }else if(elem.data.ef[i].ty === 22){
            filterManager = new SVGStrokeEffect(elem, elem.effects.effectElements[i]);
            this.filters.push(filterManager);
        }else if(elem.data.ef[i].ty === 23){
            count += 1;
            filterManager = new SVGTritoneFilter(fil, elem.effects.effectElements[i]);
            this.filters.push(filterManager);
        }else if(elem.data.ef[i].ty === 24){
            count += 1;
            filterManager = new SVGProLevelsFilter(fil, elem.effects.effectElements[i]);
            this.filters.push(filterManager);
        }else if(elem.data.ef[i].ty === 25){
            count += 1;
            filterManager = new SVGDropShadowEffect(fil, elem.effects.effectElements[i]);
            this.filters.push(filterManager);
        }
    }
    if(count){
        elem.globalData.defs.appendChild(fil);
        elem.layerElement.setAttribute('filter','url(#'+filId+')');
    }
}

SVGEffects.prototype.renderFrame = function(firstFrame){
    var i, len = this.filters.length;
    for(i=0;i<len;i+=1){
        this.filters[i].renderFrame(firstFrame);
    }
};
function ICompElement(data,parentContainer,globalData,comp, placeholder){
    this._parent.constructor.call(this,data,parentContainer,globalData,comp, placeholder);
    this.layers = data.layers;
    this.supports3d = true;
    this.completeLayers = false;
    this.pendingElements = [];
    this.elements = this.layers ? Array.apply(null,{length:this.layers.length}) : [];
    if(this.data.tm){
        this.tm = PropertyFactory.getProp(this,this.data.tm,0,globalData.frameRate,this.dynamicProperties);
    }
    if(this.data.xt){
        this.layerElement = document.createElementNS(svgNS,'g');
        this.buildAllItems();
    } else if(!globalData.progressiveLoad){
        this.buildAllItems();
    }
}
createElement(SVGBaseElement, ICompElement);

ICompElement.prototype.hide = function(){
    if(!this.hidden){
        this._parent.hide.call(this);
        var i,len = this.elements.length;
        for( i = 0; i < len; i+=1 ){
            if(this.elements[i]){
                this.elements[i].hide();
            }
        }
    }
};

ICompElement.prototype.prepareFrame = function(num){
    this._parent.prepareFrame.call(this,num);
    if(this.isVisible===false && !this.data.xt){
        return;
    }

    if(this.tm){
        var timeRemapped = this.tm.v;
        if(timeRemapped === this.data.op){
            timeRemapped = this.data.op - 1;
        }
        this.renderedFrame = timeRemapped;
    } else {
        this.renderedFrame = num/this.data.sr;
    }
    var i,len = this.elements.length;
    if(!this.completeLayers){
        this.checkLayers(this.renderedFrame);
    }
    for( i = 0; i < len; i+=1 ){
        if(this.completeLayers || this.elements[i]){
            this.elements[i].prepareFrame(this.renderedFrame - this.layers[i].st);
        }
    }
};

ICompElement.prototype.renderFrame = function(parentMatrix){
    var renderParent = this._parent.renderFrame.call(this,parentMatrix);
    var i,len = this.layers.length;
    if(renderParent===false){
        this.hide();
        return;
    }

    if(this.hidden) {
        this.show();
    }
    for( i = 0; i < len; i+=1 ){
        if(this.completeLayers || this.elements[i]){
            this.elements[i].renderFrame();
        }
    }
    if(this.firstFrame){
        this.firstFrame = false;
    }
};

ICompElement.prototype.setElements = function(elems){
    this.elements = elems;
};

ICompElement.prototype.getElements = function(){
    return this.elements;
};

ICompElement.prototype.destroy = function(){
    this._parent.destroy.call(this._parent);
    var i,len = this.layers.length;
    for( i = 0; i < len; i+=1 ){
        if(this.elements[i]){
            this.elements[i].destroy();
        }
    }
};

ICompElement.prototype.checkLayers = SVGRenderer.prototype.checkLayers;
ICompElement.prototype.buildItem = SVGRenderer.prototype.buildItem;
ICompElement.prototype.buildAllItems = SVGRenderer.prototype.buildAllItems;
ICompElement.prototype.buildElementParenting = SVGRenderer.prototype.buildElementParenting;
ICompElement.prototype.createItem = SVGRenderer.prototype.createItem;
ICompElement.prototype.createImage = SVGRenderer.prototype.createImage;
ICompElement.prototype.createComp = SVGRenderer.prototype.createComp;
ICompElement.prototype.createSolid = SVGRenderer.prototype.createSolid;
ICompElement.prototype.createShape = SVGRenderer.prototype.createShape;
ICompElement.prototype.createText = SVGRenderer.prototype.createText;
ICompElement.prototype.createBase = SVGRenderer.prototype.createBase;
ICompElement.prototype.appendElementInPos = SVGRenderer.prototype.appendElementInPos;
ICompElement.prototype.checkPendingElements = SVGRenderer.prototype.checkPendingElements;
ICompElement.prototype.addPendingElement = SVGRenderer.prototype.addPendingElement;
function IImageElement(data,parentContainer,globalData,comp,placeholder){
    this.assetData = globalData.getAssetData(data.refId);
    this._parent.constructor.call(this,data,parentContainer,globalData,comp,placeholder);
}
createElement(SVGBaseElement, IImageElement);

IImageElement.prototype.createElements = function(){

    var assetPath = this.globalData.getAssetsPath(this.assetData);

    this._parent.createElements.call(this);

    this.innerElem = document.createElementNS(svgNS,'image');
    this.innerElem.setAttribute('width',this.assetData.w+"px");
    this.innerElem.setAttribute('height',this.assetData.h+"px");
    this.innerElem.setAttribute('preserveAspectRatio','xMidYMid slice');
    this.innerElem.setAttributeNS('http://www.w3.org/1999/xlink','href',assetPath);
    this.maskedElement = this.innerElem;
    this.layerElement.appendChild(this.innerElem);
    if(this.data.ln){
        this.layerElement.setAttribute('id',this.data.ln);
    }
    if(this.data.cl){
        this.layerElement.setAttribute('class',this.data.cl);
    }

};

IImageElement.prototype.renderFrame = function(parentMatrix){
    var renderParent = this._parent.renderFrame.call(this,parentMatrix);
    if(renderParent===false){
        this.hide();
        return;
    }
    if(this.hidden){
        this.show();
    }
    if(this.firstFrame){
        this.firstFrame = false;
    }
};

IImageElement.prototype.destroy = function(){
    this._parent.destroy.call(this._parent);
    this.innerElem =  null;
};
function ISolidElement(data,parentContainer,globalData,comp, placeholder){
    this._parent.constructor.call(this,data,parentContainer,globalData,comp, placeholder);
}
createElement(SVGBaseElement, ISolidElement);

ISolidElement.prototype.createElements = function(){
    this._parent.createElements.call(this);

    var rect = document.createElementNS(svgNS,'rect');
    ////rect.style.width = this.data.sw;
    ////rect.style.height = this.data.sh;
    ////rect.style.fill = this.data.sc;
    rect.setAttribute('width',this.data.sw);
    rect.setAttribute('height',this.data.sh);
    rect.setAttribute('fill',this.data.sc);
    this.layerElement.appendChild(rect);
    this.innerElem = rect;
    if(this.data.ln){
        this.layerElement.setAttribute('id',this.data.ln);
    }
    if(this.data.cl){
        this.layerElement.setAttribute('class',this.data.cl);
    }
};

ISolidElement.prototype.renderFrame = IImageElement.prototype.renderFrame;
ISolidElement.prototype.destroy = IImageElement.prototype.destroy;

var animationManager = (function(){
    var moduleOb = {};
    var registeredAnimations = [];
    var initTime = 0;
    var len = 0;
    var idled = true;
    var playingAnimationsNum = 0;

    function removeElement(ev){
        var i = 0;
        var animItem = ev.target;
        while(i<len) {
            if (registeredAnimations[i].animation === animItem) {
                registeredAnimations.splice(i, 1);
                i -= 1;
                len -= 1;
                if(!animItem.isPaused){
                    subtractPlayingCount();   
                }
            }
            i += 1;
        }
    }

    function registerAnimation(element, animationData){
        if(!element){
            return null;
        }
        var i=0;
        while(i<len){
            if(registeredAnimations[i].elem == element && registeredAnimations[i].elem !== null ){
                return registeredAnimations[i].animation;
            }
            i+=1;
        }
        var animItem = new AnimationItem();
        setupAnimation(animItem, element);
        animItem.setData(element, animationData);
        return animItem;
    }

    function addPlayingCount(){
        playingAnimationsNum += 1;
        activate();
    }

    function subtractPlayingCount(){
        playingAnimationsNum -= 1;
        if(playingAnimationsNum === 0){
            idled = true;
        }
    }

    function setupAnimation(animItem, element){
        animItem.addEventListener('destroy',removeElement);
        animItem.addEventListener('_active',addPlayingCount);
        animItem.addEventListener('_idle',subtractPlayingCount);
        registeredAnimations.push({elem: element,animation:animItem});
        len += 1;
    }

    function loadAnimation(params){
        var animItem = new AnimationItem();
        setupAnimation(animItem, null);
        animItem.setParams(params);
        return animItem;
    }


    function setSpeed(val,animation){
        var i;
        for(i=0;i<len;i+=1){
            registeredAnimations[i].animation.setSpeed(val, animation);
        }
    }

    function setDirection(val, animation){
        var i;
        for(i=0;i<len;i+=1){
            registeredAnimations[i].animation.setDirection(val, animation);
        }
    }

    function play(animation){
        var i;
        for(i=0;i<len;i+=1){
            registeredAnimations[i].animation.play(animation);
        }
    }

    function moveFrame (value, animation) {
        initTime = Date.now();
        var i;
        for(i=0;i<len;i+=1){
            registeredAnimations[i].animation.moveFrame(value,animation);
        }
    }

    function resume(nowTime) {

        var elapsedTime = nowTime - initTime;
        var i;
        for(i=0;i<len;i+=1){
            registeredAnimations[i].animation.advanceTime(elapsedTime);
        }
        initTime = nowTime;
        if(!idled) {
            requestAnimationFrame(resume);
        }
    }

    function first(nowTime){
        initTime = nowTime;
        requestAnimationFrame(resume);
    }

    function pause(animation) {
        var i;
        for(i=0;i<len;i+=1){
            registeredAnimations[i].animation.pause(animation);
        }
    }

    function goToAndStop(value,isFrame,animation) {
        var i;
        for(i=0;i<len;i+=1){
            registeredAnimations[i].animation.goToAndStop(value,isFrame,animation);
        }
    }

    function stop(animation) {
        var i;
        for(i=0;i<len;i+=1){
            registeredAnimations[i].animation.stop(animation);
        }
    }

    function togglePause(animation) {
        var i;
        for(i=0;i<len;i+=1){
            registeredAnimations[i].animation.togglePause(animation);
        }
    }

    function destroy(animation) {
        var i;
        for(i=(len-1);i>=0;i-=1){
            registeredAnimations[i].animation.destroy(animation);
        }
    }

    function searchAnimations(animationData, standalone, renderer){
        var animElements = document.getElementsByClassName('bodymovin');
        var i, len = animElements.length;
        for(i=0;i<len;i+=1){
            if(renderer){
                animElements[i].setAttribute('data-bm-type',renderer);
            }
            registerAnimation(animElements[i], animationData);
        }
        if(standalone && len === 0){
            if(!renderer){
                renderer = 'svg';
            }
            var body = document.getElementsByTagName('body')[0];
            body.innerHTML = '';
            var div = document.createElement('div');
            div.style.width = '100%';
            div.style.height = '100%';
            div.setAttribute('data-bm-type',renderer);
            body.appendChild(div);
            registerAnimation(div, animationData);
        }
    }

    function resize(){
        var i;
        for(i=0;i<len;i+=1){
            registeredAnimations[i].animation.resize();
        }
    }

    function start(){
        requestAnimationFrame(first);
    }

    function activate(){
        if(idled){
            idled = false;
            requestAnimationFrame(first);
        }
    }

    //start();

    setTimeout(start,0);

    moduleOb.registerAnimation = registerAnimation;
    moduleOb.loadAnimation = loadAnimation;
    moduleOb.setSpeed = setSpeed;
    moduleOb.setDirection = setDirection;
    moduleOb.play = play;
    moduleOb.moveFrame = moveFrame;
    moduleOb.pause = pause;
    moduleOb.stop = stop;
    moduleOb.togglePause = togglePause;
    moduleOb.searchAnimations = searchAnimations;
    moduleOb.resize = resize;
    moduleOb.start = start;
    moduleOb.goToAndStop = goToAndStop;
    moduleOb.destroy = destroy;
    return moduleOb;
}());
var AnimationItem = function () {
    this._cbs = [];
    this.name = '';
    this.path = '';
    this.isLoaded = false;
    this.currentFrame = 0;
    this.currentRawFrame = 0;
    this.totalFrames = 0;
    this.frameRate = 0;
    this.frameMult = 0;
    this.playSpeed = 1;
    this.playDirection = 1;
    this.pendingElements = 0;
    this.playCount = 0;
    this.prerenderFramesFlag = true;
    this.animationData = {};
    this.layers = [];
    this.assets = [];
    this.isPaused = true;
    this.autoplay = false;
    this.loop = true;
    this.renderer = null;
    this.animationID = randomString(10);
    this.scaleMode = 'fit';
    this.assetsPath = '';
    this.timeCompleted = 0;
    this.segmentPos = 0;
    this.subframeEnabled = subframeEnabled;
    this.segments = [];
    this.pendingSegment = false;
    this._idle = true;
    this.projectInterface = ProjectInterface();
};

AnimationItem.prototype.setParams = function(params) {
    var self = this;
    if(params.context){
        this.context = params.context;
    }
    if(params.wrapper || params.container){
        this.wrapper = params.wrapper || params.container;
    }
    var animType = params.animType ? params.animType : params.renderer ? params.renderer : 'svg';
    switch(animType){
        case 'canvas':
            this.renderer = new CanvasRenderer(this, params.rendererSettings);
            break;
        case 'svg':
            this.renderer = new SVGRenderer(this, params.rendererSettings);
            break;
        case 'hybrid':
        case 'html':
        default:
            this.renderer = new HybridRenderer(this, params.rendererSettings);
            break;
    }
    this.renderer.setProjectInterface(this.projectInterface);
    this.animType = animType;

    if(params.loop === '' || params.loop === null){
    }else if(params.loop === false){
        this.loop = false;
    }else if(params.loop === true){
        this.loop = true;
    }else{
        this.loop = parseInt(params.loop);
    }
    this.autoplay = 'autoplay' in params ? params.autoplay : true;
    this.name = params.name ? params.name :  '';
    this.prerenderFramesFlag = 'prerender' in params ? params.prerender : true;
    this.autoloadSegments = params.hasOwnProperty('autoloadSegments') ? params.autoloadSegments :  true;
    if(params.animationData){
        self.configAnimation(params.animationData);
    }else if(params.path){
        if(params.path.substr(-4) != 'json'){
            if (params.path.substr(-1, 1) != '/') {
                params.path += '/';
            }
            params.path += 'data.json';
        }

        var xhr = new XMLHttpRequest();
        if(params.path.lastIndexOf('\\') != -1){
            this.path = params.path.substr(0,params.path.lastIndexOf('\\')+1);
        }else{
            this.path = params.path.substr(0,params.path.lastIndexOf('/')+1);
        }
        this.assetsPath = params.assetsPath;
        this.fileName = params.path.substr(params.path.lastIndexOf('/')+1);
        this.fileName = this.fileName.substr(0,this.fileName.lastIndexOf('.json'));
        xhr.open('GET', params.path, true);
        xhr.send();
        xhr.onreadystatechange = function () {
            if (xhr.readyState == 4) {
                if(xhr.status == 200){
                    self.configAnimation(JSON.parse(xhr.responseText));
                }else{
                    try{
                        var response = JSON.parse(xhr.responseText);
                        self.configAnimation(response);
                    }catch(err){
                    }
                }
            }
        };
    }
};

AnimationItem.prototype.setData = function (wrapper, animationData) {
    var params = {
        wrapper: wrapper,
        animationData: animationData ? (typeof animationData  === "object") ? animationData : JSON.parse(animationData) : null
    };
    var wrapperAttributes = wrapper.attributes;

    params.path = wrapperAttributes.getNamedItem('data-animation-path') ? wrapperAttributes.getNamedItem('data-animation-path').value : wrapperAttributes.getNamedItem('data-bm-path') ? wrapperAttributes.getNamedItem('data-bm-path').value :  wrapperAttributes.getNamedItem('bm-path') ? wrapperAttributes.getNamedItem('bm-path').value : '';
    params.animType = wrapperAttributes.getNamedItem('data-anim-type') ? wrapperAttributes.getNamedItem('data-anim-type').value : wrapperAttributes.getNamedItem('data-bm-type') ? wrapperAttributes.getNamedItem('data-bm-type').value : wrapperAttributes.getNamedItem('bm-type') ? wrapperAttributes.getNamedItem('bm-type').value :  wrapperAttributes.getNamedItem('data-bm-renderer') ? wrapperAttributes.getNamedItem('data-bm-renderer').value : wrapperAttributes.getNamedItem('bm-renderer') ? wrapperAttributes.getNamedItem('bm-renderer').value : 'canvas';

    var loop = wrapperAttributes.getNamedItem('data-anim-loop') ? wrapperAttributes.getNamedItem('data-anim-loop').value :  wrapperAttributes.getNamedItem('data-bm-loop') ? wrapperAttributes.getNamedItem('data-bm-loop').value :  wrapperAttributes.getNamedItem('bm-loop') ? wrapperAttributes.getNamedItem('bm-loop').value : '';
    if(loop === ''){
    }else if(loop === 'false'){
        params.loop = false;
    }else if(loop === 'true'){
        params.loop = true;
    }else{
        params.loop = parseInt(loop);
    }
    var autoplay = wrapperAttributes.getNamedItem('data-anim-autoplay') ? wrapperAttributes.getNamedItem('data-anim-autoplay').value :  wrapperAttributes.getNamedItem('data-bm-autoplay') ? wrapperAttributes.getNamedItem('data-bm-autoplay').value :  wrapperAttributes.getNamedItem('bm-autoplay') ? wrapperAttributes.getNamedItem('bm-autoplay').value : true;
    params.autoplay = autoplay !== "false";

    params.name = wrapperAttributes.getNamedItem('data-name') ? wrapperAttributes.getNamedItem('data-name').value :  wrapperAttributes.getNamedItem('data-bm-name') ? wrapperAttributes.getNamedItem('data-bm-name').value : wrapperAttributes.getNamedItem('bm-name') ? wrapperAttributes.getNamedItem('bm-name').value :  '';
    var prerender = wrapperAttributes.getNamedItem('data-anim-prerender') ? wrapperAttributes.getNamedItem('data-anim-prerender').value :  wrapperAttributes.getNamedItem('data-bm-prerender') ? wrapperAttributes.getNamedItem('data-bm-prerender').value :  wrapperAttributes.getNamedItem('bm-prerender') ? wrapperAttributes.getNamedItem('bm-prerender').value : '';

    if(prerender === 'false'){
        params.prerender = false;
    }
    console.log('animElements:', params)
    this.setParams(params);
};

AnimationItem.prototype.includeLayers = function(data) {
    if(data.op > this.animationData.op){
        this.animationData.op = data.op;
        this.totalFrames = Math.floor(data.op - this.animationData.ip);
        this.animationData.tf = this.totalFrames;
    }
    var layers = this.animationData.layers;
    var i, len = layers.length;
    var newLayers = data.layers;
    var j, jLen = newLayers.length;
    for(j=0;j<jLen;j+=1){
        i = 0;
        while(i<len){
            if(layers[i].id == newLayers[j].id){
                layers[i] = newLayers[j];
                break;
            }
            i += 1;
        }
    }
    if(data.chars || data.fonts){
        this.renderer.globalData.fontManager.addChars(data.chars);
        this.renderer.globalData.fontManager.addFonts(data.fonts, this.renderer.globalData.defs);
    }
    if(data.assets){
        len = data.assets.length;
        for(i = 0; i < len; i += 1){
            this.animationData.assets.push(data.assets[i]);
        }
    }
    //this.totalFrames = 50;
    //this.animationData.tf = 50;
    this.animationData.__complete = false;
    dataManager.completeData(this.animationData,this.renderer.globalData.fontManager);
    this.renderer.includeLayers(data.layers);
    if(expressionsPlugin){
        expressionsPlugin.initExpressions(this);
    }
    this.renderer.renderFrame(null);
    this.loadNextSegment();
};

AnimationItem.prototype.loadNextSegment = function() {
    var segments = this.animationData.segments;
    if(!segments || segments.length === 0 || !this.autoloadSegments){
        this.trigger('data_ready');
        this.timeCompleted = this.animationData.tf;
        return;
    }
    var segment = segments.shift();
    this.timeCompleted = segment.time * this.frameRate;
    var xhr = new XMLHttpRequest();
    var self = this;
    var segmentPath = this.path+this.fileName+'_' + this.segmentPos + '.json';
    this.segmentPos += 1;
    xhr.open('GET', segmentPath, true);
    xhr.send();
    xhr.onreadystatechange = function () {
        if (xhr.readyState == 4) {
            if(xhr.status == 200){
                self.includeLayers(JSON.parse(xhr.responseText));
            }else{
                try{
                    var response = JSON.parse(xhr.responseText);
                    self.includeLayers(response);
                }catch(err){
                }
            }
        }
    };
};

AnimationItem.prototype.loadSegments = function() {
    var segments = this.animationData.segments;
    if(!segments) {
        this.timeCompleted = this.animationData.tf;
    }
    this.loadNextSegment();
};

AnimationItem.prototype.configAnimation = function (animData) {
    if(this.renderer && this.renderer.destroyed){
        return;
    }
    //console.log(JSON.parse(JSON.stringify(animData)));
    //animData.w = Math.round(animData.w/blitter);
    //animData.h = Math.round(animData.h/blitter);
    this.animationData = animData;
    this.totalFrames = Math.floor(this.animationData.op - this.animationData.ip);
    this.animationData.tf = this.totalFrames;
    this.renderer.configAnimation(animData);
    if(!animData.assets){
        animData.assets = [];
    }
    if(animData.comps) {
        animData.assets = animData.assets.concat(animData.comps);
        animData.comps = null;
    }
    this.renderer.searchExtraCompositions(animData.assets);

    this.layers = this.animationData.layers;
    this.assets = this.animationData.assets;
    this.frameRate = this.animationData.fr;
    this.firstFrame = Math.round(this.animationData.ip);
    this.frameMult = this.animationData.fr / 1000;
    this.trigger('config_ready');
    this.imagePreloader = new ImagePreloader();
    this.imagePreloader.setAssetsPath(this.assetsPath);
    this.imagePreloader.setPath(this.path);
    this.imagePreloader.loadAssets(animData.assets);
    this.loadSegments();
    this.updaFrameModifier();
    if(this.renderer.globalData.fontManager){
        this.waitForFontsLoaded();
    }else{
        dataManager.completeData(this.animationData,this.renderer.globalData.fontManager);
        this.checkLoaded();
    }
};

AnimationItem.prototype.waitForFontsLoaded = (function(){
    function checkFontsLoaded(){
        if(this.renderer.globalData.fontManager.loaded){
            dataManager.completeData(this.animationData,this.renderer.globalData.fontManager);
            //this.renderer.buildItems(this.animationData.layers);
            this.checkLoaded();
        }else{
            setTimeout(checkFontsLoaded.bind(this),20);
        }
    }

    return function(){
        checkFontsLoaded.bind(this)();
    }
}());

AnimationItem.prototype.addPendingElement = function () {
    this.pendingElements += 1;
}

AnimationItem.prototype.elementLoaded = function () {
    this.pendingElements--;
    this.checkLoaded();
};

AnimationItem.prototype.checkLoaded = function () {
    if (this.pendingElements === 0) {
        if(expressionsPlugin){
            expressionsPlugin.initExpressions(this);
        }
        this.renderer.initItems();
        setTimeout(function(){
            this.trigger('DOMLoaded');
        }.bind(this),0);
        this.isLoaded = true;
        this.gotoFrame();
        if(this.autoplay){
            this.play();
        }
    }
};

AnimationItem.prototype.resize = function () {
    this.renderer.updateContainerSize();
};

AnimationItem.prototype.setSubframe = function(flag){
    this.subframeEnabled = flag ? true : false;
}

AnimationItem.prototype.gotoFrame = function () {
    if(this.subframeEnabled){
        this.currentFrame = this.currentRawFrame;
    }else{
        this.currentFrame = Math.floor(this.currentRawFrame);
    }

    if(this.timeCompleted !== this.totalFrames && this.currentFrame > this.timeCompleted){
        this.currentFrame = this.timeCompleted;
    }
    this.trigger('enterFrame');
    this.renderFrame();
};

AnimationItem.prototype.renderFrame = function () {
    if(this.isLoaded === false){
        return;
    }
    //console.log('this.currentFrame:',this.currentFrame + this.firstFrame);
    this.renderer.renderFrame(this.currentFrame + this.firstFrame);
};

AnimationItem.prototype.play = function (name) {
    if(name && this.name != name){
        return;
    }
    if(this.isPaused === true){
        this.isPaused = false;
        if(this._idle){
            this._idle = false;
            this.trigger('_active');
        }
    }
};

AnimationItem.prototype.pause = function (name) {
    if(name && this.name != name){
        return;
    }
    if(this.isPaused === false){
        this.isPaused = true;
        if(!this.pendingSegment){
            this._idle = true;
            this.trigger('_idle');
        }
    }
};

AnimationItem.prototype.togglePause = function (name) {
    if(name && this.name != name){
        return;
    }
    if(this.isPaused === true){
        this.play();
    }else{
        this.pause();
    }
};

AnimationItem.prototype.stop = function (name) {
    if(name && this.name != name){
        return;
    }
    this.pause();
    this.currentFrame = this.currentRawFrame = 0;
    this.playCount = 0;
    this.gotoFrame();
};

AnimationItem.prototype.goToAndStop = function (value, isFrame, name) {
    if(name && this.name != name){
        return;
    }
    if(isFrame){
        this.setCurrentRawFrameValue(value);
    }else{
        this.setCurrentRawFrameValue(value * this.frameModifier);
    }
    this.pause();
};

AnimationItem.prototype.goToAndPlay = function (value, isFrame, name) {
    this.goToAndStop(value, isFrame, name);
    this.play();
};

AnimationItem.prototype.advanceTime = function (value) {
    if(this.pendingSegment){
        this.pendingSegment = false;
        this.adjustSegment(this.segments.shift());
        if(this.isPaused){
            this.play();
        }
        return;
    }
    if (this.isPaused === true || this.isLoaded === false) {
        return;
    }
    this.setCurrentRawFrameValue(this.currentRawFrame + value * this.frameModifier);
};

AnimationItem.prototype.updateAnimation = function (perc) {
    this.setCurrentRawFrameValue(this.totalFrames * perc);
};

AnimationItem.prototype.moveFrame = function (value, name) {
    if(name && this.name != name){
        return;
    }
    this.setCurrentRawFrameValue(this.currentRawFrame+value);
};

AnimationItem.prototype.adjustSegment = function(arr){
    this.playCount = 0;
    if(arr[1] < arr[0]){
        if(this.frameModifier > 0){
            if(this.playSpeed < 0){
                this.setSpeed(-this.playSpeed);
            } else {
                this.setDirection(-1);
            }
        }
        this.totalFrames = arr[0] - arr[1];
        this.firstFrame = arr[1];
        this.setCurrentRawFrameValue(this.totalFrames - 0.01);
    } else if(arr[1] > arr[0]){
        if(this.frameModifier < 0){
            if(this.playSpeed < 0){
                this.setSpeed(-this.playSpeed);
            } else {
                this.setDirection(1);
            }
        }
        this.totalFrames = arr[1] - arr[0];
        this.firstFrame = arr[0];
        this.setCurrentRawFrameValue(0);
    }
    this.trigger('segmentStart');
};
AnimationItem.prototype.setSegment = function (init,end) {
    var pendingFrame = -1;
    if(this.isPaused) {
        if (this.currentRawFrame + this.firstFrame < init) {
            pendingFrame = init;
        } else if (this.currentRawFrame + this.firstFrame > end) {
            pendingFrame = end - init - 0.01;
        }
    }

    this.firstFrame = init;
    this.totalFrames = end - init;
    if(pendingFrame !== -1) {
        this.goToAndStop(pendingFrame,true);
    }
}

AnimationItem.prototype.playSegments = function (arr,forceFlag) {
    if(typeof arr[0] === 'object'){
        var i, len = arr.length;
        for(i=0;i<len;i+=1){
            this.segments.push(arr[i]);
        }
    }else{
        this.segments.push(arr);
    }
    if(forceFlag){
        this.adjustSegment(this.segments.shift());
    }
    if(this.isPaused){
        this.play();
    }
};

AnimationItem.prototype.resetSegments = function (forceFlag) {
    this.segments.length = 0;
    this.segments.push([this.animationData.ip*this.frameRate,Math.floor(this.animationData.op - this.animationData.ip+this.animationData.ip*this.frameRate)]);
    if(forceFlag){
        this.adjustSegment(this.segments.shift());
    }
};
AnimationItem.prototype.checkSegments = function(){
    if(this.segments.length){
        this.pendingSegment = true;
    }
}

AnimationItem.prototype.remove = function (name) {
    if(name && this.name != name){
        return;
    }
    this.renderer.destroy();
};

AnimationItem.prototype.destroy = function (name) {
    if((name && this.name != name) || (this.renderer && this.renderer.destroyed)){
        return;
    }
    this.renderer.destroy();
    this.trigger('destroy');
    this._cbs = null;
    this.onEnterFrame = this.onLoopComplete = this.onComplete = this.onSegmentStart = this.onDestroy = null;
};

AnimationItem.prototype.setCurrentRawFrameValue = function(value){
    this.currentRawFrame = value;
    //console.log(this.totalFrames);
    if (this.currentRawFrame >= this.totalFrames) {
        this.checkSegments();
        if(this.loop === false){
            this.currentRawFrame = this.totalFrames - 0.01;
            this.gotoFrame();
            this.pause();
            this.trigger('complete');
            return;
        }else{
            this.trigger('loopComplete');
            this.playCount += 1;
            if((this.loop !== true && this.playCount == this.loop) || this.pendingSegment){
                this.currentRawFrame = this.totalFrames - 0.01;
                this.gotoFrame();
                this.pause();
                this.trigger('complete');
                return;
            } else {
                this.currentRawFrame = this.currentRawFrame % this.totalFrames;
            }
        }
    } else if (this.currentRawFrame < 0) {
        this.checkSegments();
        this.playCount -= 1;
        if(this.playCount < 0){
            this.playCount = 0;
        }
        if(this.loop === false  || this.pendingSegment){
            this.currentRawFrame = 0;
            this.gotoFrame();
            this.pause();
            this.trigger('complete');
            return;
        }else{
            this.trigger('loopComplete');
            this.currentRawFrame = (this.totalFrames + this.currentRawFrame) % this.totalFrames;
            this.gotoFrame();
            return;
        }
    }

    this.gotoFrame();
};

AnimationItem.prototype.setSpeed = function (val) {
    this.playSpeed = val;
    this.updaFrameModifier();
};

AnimationItem.prototype.setDirection = function (val) {
    this.playDirection = val < 0 ? -1 : 1;
    this.updaFrameModifier();
};

AnimationItem.prototype.updaFrameModifier = function () {
    this.frameModifier = this.frameMult * this.playSpeed * this.playDirection;
};

AnimationItem.prototype.getPath = function () {
    return this.path;
};

AnimationItem.prototype.getAssetsPath = function (assetData) {
    var path = '';
    if(this.assetsPath){
        var imagePath = assetData.p;
        if(imagePath.indexOf('images/') !== -1){
            imagePath = imagePath.split('/')[1];
        }
        path = this.assetsPath + imagePath;
    } else {
        path = this.path;
        path += assetData.u ? assetData.u : '';
        path += assetData.p;
    }
    return path;
};

AnimationItem.prototype.getAssetData = function (id) {
    var i = 0, len = this.assets.length;
    while (i < len) {
        if(id == this.assets[i].id){
            return this.assets[i];
        }
        i += 1;
    }
};

AnimationItem.prototype.hide = function () {
    this.renderer.hide();
};

AnimationItem.prototype.show = function () {
    this.renderer.show();
};

AnimationItem.prototype.getAssets = function () {
    return this.assets;
};

AnimationItem.prototype.trigger = function(name){
    if(this._cbs && this._cbs[name]){
        switch(name){
            case 'enterFrame':
                this.triggerEvent(name,new BMEnterFrameEvent(name,this.currentFrame,this.totalFrames,this.frameMult));
                break;
            case 'loopComplete':
                this.triggerEvent(name,new BMCompleteLoopEvent(name,this.loop,this.playCount,this.frameMult));
                break;
            case 'complete':
                this.triggerEvent(name,new BMCompleteEvent(name,this.frameMult));
                break;
            case 'segmentStart':
                this.triggerEvent(name,new BMSegmentStartEvent(name,this.firstFrame,this.totalFrames));
                break;
            case 'destroy':
                this.triggerEvent(name,new BMDestroyEvent(name,this));
                break;
            default:
                this.triggerEvent(name);
        }
    }
    if(name === 'enterFrame' && this.onEnterFrame){
        this.onEnterFrame.call(this,new BMEnterFrameEvent(name,this.currentFrame,this.totalFrames,this.frameMult));
    }
    if(name === 'loopComplete' && this.onLoopComplete){
        this.onLoopComplete.call(this,new BMCompleteLoopEvent(name,this.loop,this.playCount,this.frameMult));
    }
    if(name === 'complete' && this.onComplete){
        this.onComplete.call(this,new BMCompleteEvent(name,this.frameMult));
    }
    if(name === 'segmentStart' && this.onSegmentStart){
        this.onSegmentStart.call(this,new BMSegmentStartEvent(name,this.firstFrame,this.totalFrames));
    }
    if(name === 'destroy' && this.onDestroy){
        this.onDestroy.call(this,new BMDestroyEvent(name,this));
    }
};

AnimationItem.prototype.addEventListener = _addEventListener;
AnimationItem.prototype.removeEventListener = _removeEventListener;
AnimationItem.prototype.triggerEvent = _triggerEvent;

function CanvasRenderer(animationItem, config){
    this.animationItem = animationItem;
    this.renderConfig = {
        clearCanvas: (config && config.clearCanvas !== undefined) ? config.clearCanvas : true,
        context: (config && config.context) || null,
        progressiveLoad: (config && config.progressiveLoad) || false,
        preserveAspectRatio: (config && config.preserveAspectRatio) || 'xMidYMid meet'
    };
    this.renderConfig.dpr = (config && config.dpr) || 1;
    if (this.animationItem.wrapper) {
        this.renderConfig.dpr = (config && config.dpr) || window.devicePixelRatio || 1;
    }
    this.renderedFrame = -1;
    this.globalData = {
        frameNum: -1
    };
    this.contextData = {
        saved : Array.apply(null,{length:15}),
        savedOp: Array.apply(null,{length:15}),
        cArrPos : 0,
        cTr : new Matrix(),
        cO : 1
    };
    var i, len = 15;
    for(i=0;i<len;i+=1){
        this.contextData.saved[i] = Array.apply(null,{length:16});
    }
    this.elements = [];
    this.pendingElements = [];
    this.transformMat = new Matrix();
    this.completeLayers = false;
}
extendPrototype(BaseRenderer,CanvasRenderer);

CanvasRenderer.prototype.createBase = function (data) {
    return new CVBaseElement(data, this, this.globalData);
};

CanvasRenderer.prototype.createShape = function (data) {
    return new CVShapeElement(data, this, this.globalData);
};

CanvasRenderer.prototype.createText = function (data) {
    return new CVTextElement(data, this, this.globalData);
};

CanvasRenderer.prototype.createImage = function (data) {
    return new CVImageElement(data, this, this.globalData);
};

CanvasRenderer.prototype.createComp = function (data) {
    return new CVCompElement(data, this, this.globalData);
};

CanvasRenderer.prototype.createSolid = function (data) {
    return new CVSolidElement(data, this, this.globalData);
};

CanvasRenderer.prototype.ctxTransform = function(props){
    if(props[0] === 1 && props[1] === 0 && props[4] === 0 && props[5] === 1 && props[12] === 0 && props[13] === 0){
        return;
    }
    if(!this.renderConfig.clearCanvas){
        this.canvasContext.transform(props[0],props[1],props[4],props[5],props[12],props[13]);
        return;
    }
    this.transformMat.cloneFromProps(props);
    this.transformMat.transform(this.contextData.cTr.props[0],this.contextData.cTr.props[1],this.contextData.cTr.props[2],this.contextData.cTr.props[3],this.contextData.cTr.props[4],this.contextData.cTr.props[5],this.contextData.cTr.props[6],this.contextData.cTr.props[7],this.contextData.cTr.props[8],this.contextData.cTr.props[9],this.contextData.cTr.props[10],this.contextData.cTr.props[11],this.contextData.cTr.props[12],this.contextData.cTr.props[13],this.contextData.cTr.props[14],this.contextData.cTr.props[15])
    //this.contextData.cTr.transform(props[0],props[1],props[2],props[3],props[4],props[5],props[6],props[7],props[8],props[9],props[10],props[11],props[12],props[13],props[14],props[15]);
    this.contextData.cTr.cloneFromProps(this.transformMat.props);
    var trProps = this.contextData.cTr.props;
    this.canvasContext.setTransform(trProps[0],trProps[1],trProps[4],trProps[5],trProps[12],trProps[13]);
};

CanvasRenderer.prototype.ctxOpacity = function(op){
    if(op === 1){
        return;
    }
    if(!this.renderConfig.clearCanvas){
        this.canvasContext.globalAlpha *= op < 0 ? 0 : op;
        return;
    }
    this.contextData.cO *= op < 0 ? 0 : op;
    this.canvasContext.globalAlpha = this.contextData.cO;
};

CanvasRenderer.prototype.reset = function(){
    if(!this.renderConfig.clearCanvas){
        this.canvasContext.restore();
        return;
    }
    this.contextData.cArrPos = 0;
    this.contextData.cTr.reset();
    this.contextData.cO = 1;
};

CanvasRenderer.prototype.save = function(actionFlag){
    if(!this.renderConfig.clearCanvas){
        this.canvasContext.save();
        return;
    }
    if(actionFlag){
        this.canvasContext.save();
    }
    var props = this.contextData.cTr.props;
    if(this.contextData.saved[this.contextData.cArrPos] === null || this.contextData.saved[this.contextData.cArrPos] === undefined){
        this.contextData.saved[this.contextData.cArrPos] = new Array(16);
    }
    var i,arr = this.contextData.saved[this.contextData.cArrPos];
    for(i=0;i<16;i+=1){
        arr[i] = props[i];
    }
    this.contextData.savedOp[this.contextData.cArrPos] = this.contextData.cO;
    this.contextData.cArrPos += 1;
};

CanvasRenderer.prototype.restore = function(actionFlag){
    if(!this.renderConfig.clearCanvas){
        this.canvasContext.restore();
        return;
    }
    if(actionFlag){
        this.canvasContext.restore();
    }
    this.contextData.cArrPos -= 1;
    var popped = this.contextData.saved[this.contextData.cArrPos];
    var i,arr = this.contextData.cTr.props;
    for(i=0;i<16;i+=1){
        arr[i] = popped[i];
    }
    this.canvasContext.setTransform(popped[0],popped[1],popped[4],popped[5],popped[12],popped[13]);
    popped = this.contextData.savedOp[this.contextData.cArrPos];
    this.contextData.cO = popped;
    this.canvasContext.globalAlpha = popped;
};

CanvasRenderer.prototype.configAnimation = function(animData){
    if(this.animationItem.wrapper){
        this.animationItem.container = document.createElement('canvas');
        this.animationItem.container.style.width = '100%';
        this.animationItem.container.style.height = '100%';
        //this.animationItem.container.style.transform = 'translate3d(0,0,0)';
        //this.animationItem.container.style.webkitTransform = 'translate3d(0,0,0)';
        this.animationItem.container.style.transformOrigin = this.animationItem.container.style.mozTransformOrigin = this.animationItem.container.style.webkitTransformOrigin = this.animationItem.container.style['-webkit-transform'] = "0px 0px 0px";
        this.animationItem.wrapper.appendChild(this.animationItem.container);
        this.canvasContext = this.animationItem.container.getContext('2d');
    }else{
        this.canvasContext = this.renderConfig.context;
    }
    this.data = animData;
    this.globalData.canvasContext = this.canvasContext;
    this.globalData.renderer = this;
    this.globalData.isDashed = false;
    this.globalData.totalFrames = Math.floor(animData.tf);
    this.globalData.compWidth = animData.w;
    this.globalData.compHeight = animData.h;
    this.globalData.frameRate = animData.fr;
    this.globalData.frameId = 0;
    this.globalData.compSize = {
        w: animData.w,
        h: animData.h
    };
    this.globalData.progressiveLoad = this.renderConfig.progressiveLoad;
    this.layers = animData.layers;
    this.transformCanvas = {};
    this.transformCanvas.w = animData.w;
    this.transformCanvas.h = animData.h;
    this.globalData.fontManager = new FontManager();
    this.globalData.fontManager.addChars(animData.chars);
    this.globalData.fontManager.addFonts(animData.fonts,document.body);
    this.globalData.getAssetData = this.animationItem.getAssetData.bind(this.animationItem);
    this.globalData.getAssetsPath = this.animationItem.getAssetsPath.bind(this.animationItem);
    this.globalData.elementLoaded = this.animationItem.elementLoaded.bind(this.animationItem);
    this.globalData.addPendingElement = this.animationItem.addPendingElement.bind(this.animationItem);
    this.globalData.transformCanvas = this.transformCanvas;
    this.elements = Array.apply(null,{length:animData.layers.length});

    this.updateContainerSize();
};

CanvasRenderer.prototype.updateContainerSize = function () {
    var elementWidth,elementHeight;
    if(this.animationItem.wrapper && this.animationItem.container){
        elementWidth = this.animationItem.wrapper.offsetWidth;
        elementHeight = this.animationItem.wrapper.offsetHeight;
        this.animationItem.container.setAttribute('width',elementWidth * this.renderConfig.dpr );
        this.animationItem.container.setAttribute('height',elementHeight * this.renderConfig.dpr);
    }else{
        elementWidth = this.canvasContext.canvas.width * this.renderConfig.dpr;
        elementHeight = this.canvasContext.canvas.height * this.renderConfig.dpr;
    }
    var elementRel,animationRel;
    if(this.renderConfig.preserveAspectRatio.indexOf('meet') !== -1 || this.renderConfig.preserveAspectRatio.indexOf('slice') !== -1){
        var par = this.renderConfig.preserveAspectRatio.split(' ');
        var fillType = par[1] || 'meet';
        var pos = par[0] || 'xMidYMid';
        var xPos = pos.substr(0,4);
        var yPos = pos.substr(4);
        elementRel = elementWidth/elementHeight;
        animationRel = this.transformCanvas.w/this.transformCanvas.h;
        if(animationRel>elementRel && fillType === 'meet' || animationRel<elementRel && fillType === 'slice'){
            this.transformCanvas.sx = elementWidth/(this.transformCanvas.w/this.renderConfig.dpr);
            this.transformCanvas.sy = elementWidth/(this.transformCanvas.w/this.renderConfig.dpr);
        }else{
            this.transformCanvas.sx = elementHeight/(this.transformCanvas.h / this.renderConfig.dpr);
            this.transformCanvas.sy = elementHeight/(this.transformCanvas.h / this.renderConfig.dpr);
        }

        if(xPos === 'xMid' && ((animationRel<elementRel && fillType==='meet') || (animationRel>elementRel && fillType === 'slice'))){
            this.transformCanvas.tx = (elementWidth-this.transformCanvas.w*(elementHeight/this.transformCanvas.h))/2*this.renderConfig.dpr;
        } else if(xPos === 'xMax' && ((animationRel<elementRel && fillType==='meet') || (animationRel>elementRel && fillType === 'slice'))){
            this.transformCanvas.tx = (elementWidth-this.transformCanvas.w*(elementHeight/this.transformCanvas.h))*this.renderConfig.dpr;
        } else {
            this.transformCanvas.tx = 0;
        }
        if(yPos === 'YMid' && ((animationRel>elementRel && fillType==='meet') || (animationRel<elementRel && fillType === 'slice'))){
            this.transformCanvas.ty = ((elementHeight-this.transformCanvas.h*(elementWidth/this.transformCanvas.w))/2)*this.renderConfig.dpr;
        } else if(yPos === 'YMax' && ((animationRel>elementRel && fillType==='meet') || (animationRel<elementRel && fillType === 'slice'))){
            this.transformCanvas.ty = ((elementHeight-this.transformCanvas.h*(elementWidth/this.transformCanvas.w)))*this.renderConfig.dpr;
        } else {
            this.transformCanvas.ty = 0;
        }

    }else if(this.renderConfig.preserveAspectRatio == 'none'){
        this.transformCanvas.sx = elementWidth/(this.transformCanvas.w/this.renderConfig.dpr);
        this.transformCanvas.sy = elementHeight/(this.transformCanvas.h/this.renderConfig.dpr);
        this.transformCanvas.tx = 0;
        this.transformCanvas.ty = 0;
    }else{
        this.transformCanvas.sx = this.renderConfig.dpr;
        this.transformCanvas.sy = this.renderConfig.dpr;
        this.transformCanvas.tx = 0;
        this.transformCanvas.ty = 0;
    }
    this.transformCanvas.props = [this.transformCanvas.sx,0,0,0,0,this.transformCanvas.sy,0,0,0,0,1,0,this.transformCanvas.tx,this.transformCanvas.ty,0,1];
    var i, len = this.elements.length;
    for(i=0;i<len;i+=1){
        if(this.elements[i] && this.elements[i].data.ty === 0){
            this.elements[i].resize(this.globalData.transformCanvas);
        }
    }
};

CanvasRenderer.prototype.destroy = function () {
    if(this.renderConfig.clearCanvas) {
        this.animationItem.wrapper.innerHTML = '';
    }
    var i, len = this.layers ? this.layers.length : 0;
    for (i = len - 1; i >= 0; i-=1) {
        this.elements[i].destroy();
    }
    this.elements.length = 0;
    this.globalData.canvasContext = null;
    this.animationItem.container = null;
    this.destroyed = true;
};

CanvasRenderer.prototype.renderFrame = function(num){
    if((this.renderedFrame == num && this.renderConfig.clearCanvas === true) || this.destroyed || num === null){
        return;
    }
    this.renderedFrame = num;
    this.globalData.frameNum = num - this.animationItem.firstFrame;
    this.globalData.frameId += 1;
    this.globalData.projectInterface.currentFrame = num;
    if(this.renderConfig.clearCanvas === true){
        this.reset();
        this.canvasContext.save();
        //this.canvasContext.canvas.width = this.canvasContext.canvas.width;
        this.canvasContext.clearRect(this.transformCanvas.tx, this.transformCanvas.ty, this.transformCanvas.w*this.transformCanvas.sx, this.transformCanvas.h*this.transformCanvas.sy);
    }else{
        this.save();
    }
    this.ctxTransform(this.transformCanvas.props);
    this.canvasContext.beginPath();
    this.canvasContext.rect(0,0,this.transformCanvas.w,this.transformCanvas.h);
    this.canvasContext.closePath();
    this.canvasContext.clip();

    //console.log('--------');
    //console.log('NEW: ',num);
    var i, len = this.layers.length;
    if(!this.completeLayers){
        this.checkLayers(num);
    }

    for (i = 0; i < len; i++) {
        if(this.completeLayers || this.elements[i]){
            this.elements[i].prepareFrame(num - this.layers[i].st);
        }
    }
    for (i = len - 1; i >= 0; i-=1) {
        if(this.completeLayers || this.elements[i]){
            this.elements[i].renderFrame();
        }
    }
    if(this.renderConfig.clearCanvas !== true){
        this.restore();
    } else {
        this.canvasContext.restore();
    }
};

CanvasRenderer.prototype.buildItem = function(pos){
    var elements = this.elements;
    if(elements[pos] || this.layers[pos].ty == 99){
        return;
    }
    var element = this.createItem(this.layers[pos], this,this.globalData);
    elements[pos] = element;
    element.initExpressions();
    if(this.layers[pos].ty === 0){
        element.resize(this.globalData.transformCanvas);
    }
};

CanvasRenderer.prototype.checkPendingElements  = function(){
    while(this.pendingElements.length){
        var element = this.pendingElements.pop();
        element.checkParenting();
    }
};

CanvasRenderer.prototype.hide = function(){
    this.animationItem.container.style.display = 'none';
};

CanvasRenderer.prototype.show = function(){
    this.animationItem.container.style.display = 'block';
};

CanvasRenderer.prototype.searchExtraCompositions = function(assets){
    var i, len = assets.length;
    var floatingContainer = document.createElementNS(svgNS,'g');
    for(i=0;i<len;i+=1){
        if(assets[i].xt){
            var comp = this.createComp(assets[i],this.globalData.comp,this.globalData);
            comp.initExpressions();
            //comp.compInterface = CompExpressionInterface(comp);
            //Expressions.addLayersInterface(comp.elements, this.globalData.projectInterface);
            this.globalData.projectInterface.registerComposition(comp);
        }
    }
};
function HybridRenderer(animationItem){
    this.animationItem = animationItem;
    this.layers = null;
    this.renderedFrame = -1;
    this.globalData = {
        frameNum: -1
    };
    this.pendingElements = [];
    this.elements = [];
    this.threeDElements = [];
    this.destroyed = false;
    this.camera = null;
    this.supports3d = true;

}

extendPrototype(BaseRenderer,HybridRenderer);

HybridRenderer.prototype.buildItem = SVGRenderer.prototype.buildItem;

HybridRenderer.prototype.checkPendingElements  = function(){
    while(this.pendingElements.length){
        var element = this.pendingElements.pop();
        element.checkParenting();
    }
};

HybridRenderer.prototype.appendElementInPos = function(element, pos){
    var newElement = element.getBaseElement();
    if(!newElement){
        return;
    }
    var layer = this.layers[pos];
    if(!layer.ddd || !this.supports3d){
        var i = 0;
        var nextElement;
        while(i<pos){
            if(this.elements[i] && this.elements[i]!== true && this.elements[i].getBaseElement){
                nextElement = this.elements[i].getBaseElement();
            }
            i += 1;
        }
        if(nextElement){
            if(!layer.ddd || !this.supports3d){
                this.layerElement.insertBefore(newElement, nextElement);
            }
        } else {
            if(!layer.ddd || !this.supports3d){
                this.layerElement.appendChild(newElement);
            }
        }
    } else {
        this.addTo3dContainer(newElement,pos);
    }
};


HybridRenderer.prototype.createBase = function (data) {
    return new SVGBaseElement(data, this.layerElement,this.globalData,this);
};

HybridRenderer.prototype.createShape = function (data) {
    if(!this.supports3d){
        return new IShapeElement(data, this.layerElement,this.globalData,this);
    }
    return new HShapeElement(data, this.layerElement,this.globalData,this);
};

HybridRenderer.prototype.createText = function (data) {
    if(!this.supports3d){
        return new SVGTextElement(data, this.layerElement,this.globalData,this);
    }
    return new HTextElement(data, this.layerElement,this.globalData,this);
};

HybridRenderer.prototype.createCamera = function (data) {
    this.camera = new HCameraElement(data, this.layerElement,this.globalData,this);
    return this.camera;
};

HybridRenderer.prototype.createImage = function (data) {
    if(!this.supports3d){
        return new IImageElement(data, this.layerElement,this.globalData,this);
    }
    return new HImageElement(data, this.layerElement,this.globalData,this);
};

HybridRenderer.prototype.createComp = function (data) {
    if(!this.supports3d){
        return new ICompElement(data, this.layerElement,this.globalData,this);
    }
    return new HCompElement(data, this.layerElement,this.globalData,this);

};

HybridRenderer.prototype.createSolid = function (data) {
    if(!this.supports3d){
        return new ISolidElement(data, this.layerElement,this.globalData,this);
    }
    return new HSolidElement(data, this.layerElement,this.globalData,this);
};

HybridRenderer.prototype.getThreeDContainer = function(pos){
    var perspectiveElem = document.createElement('div');
    styleDiv(perspectiveElem);
    perspectiveElem.style.width = this.globalData.compSize.w+'px';
    perspectiveElem.style.height = this.globalData.compSize.h+'px';
    perspectiveElem.style.transformOrigin = perspectiveElem.style.mozTransformOrigin = perspectiveElem.style.webkitTransformOrigin = "50% 50%";
    var container = document.createElement('div');
    styleDiv(container);
    container.style.transform = container.style.webkitTransform = 'matrix3d(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)';
    perspectiveElem.appendChild(container);
    this.resizerElem.appendChild(perspectiveElem);
    var threeDContainerData = {
        container:container,
        perspectiveElem:perspectiveElem,
        startPos: pos,
        endPos: pos
    };
    this.threeDElements.push(threeDContainerData);
    return threeDContainerData;
};

HybridRenderer.prototype.build3dContainers = function(){
    var i, len = this.layers.length;
    var lastThreeDContainerData;
    for(i=0;i<len;i+=1){
        if(this.layers[i].ddd){
            if(!lastThreeDContainerData){
                lastThreeDContainerData = this.getThreeDContainer(i);
            }
            lastThreeDContainerData.endPos = Math.max(lastThreeDContainerData.endPos,i);
        } else {
            lastThreeDContainerData = null;
        }
    }
};

HybridRenderer.prototype.addTo3dContainer = function(elem,pos){
    var i = 0, len = this.threeDElements.length;
    while(i<len){
        if(pos <= this.threeDElements[i].endPos){
            var j = this.threeDElements[i].startPos;
            var nextElement;
            while(j<pos){
                if(this.elements[j] && this.elements[j].getBaseElement){
                    nextElement = this.elements[j].getBaseElement();
                }
                j += 1;
            }
            if(nextElement){
                this.threeDElements[i].container.insertBefore(elem, nextElement);
            } else {
                this.threeDElements[i].container.appendChild(elem);
            }
            break;
        }
        i += 1;
    }
};

HybridRenderer.prototype.configAnimation = function(animData){
    var resizerElem = document.createElement('div');
    var wrapper = this.animationItem.wrapper;
    resizerElem.style.width = animData.w+'px';
    resizerElem.style.height = animData.h+'px';
    this.resizerElem = resizerElem;
    styleDiv(resizerElem);
    resizerElem.style.transformStyle = resizerElem.style.webkitTransformStyle = resizerElem.style.mozTransformStyle = "flat";
    wrapper.appendChild(resizerElem);

    resizerElem.style.overflow = 'hidden';
    var svg = document.createElementNS(svgNS,'svg');
    svg.setAttribute('width','1');
    svg.setAttribute('height','1');
    styleDiv(svg);
    this.resizerElem.appendChild(svg);
    var defs = document.createElementNS(svgNS,'defs');
    svg.appendChild(defs);
    this.globalData.defs = defs;
    this.data = animData;
    //Mask animation
    this.globalData.getAssetData = this.animationItem.getAssetData.bind(this.animationItem);
    this.globalData.getAssetsPath = this.animationItem.getAssetsPath.bind(this.animationItem);
    this.globalData.elementLoaded = this.animationItem.elementLoaded.bind(this.animationItem);
    this.globalData.frameId = 0;
    this.globalData.compSize = {
        w: animData.w,
        h: animData.h
    };
    this.globalData.frameRate = animData.fr;
    this.layers = animData.layers;
    this.globalData.fontManager = new FontManager();
    this.globalData.fontManager.addChars(animData.chars);
    this.globalData.fontManager.addFonts(animData.fonts,svg);
    this.layerElement = this.resizerElem;
    this.build3dContainers();
    this.updateContainerSize();
};

HybridRenderer.prototype.destroy = function () {
    this.animationItem.wrapper.innerHTML = '';
    this.animationItem.container = null;
    this.globalData.defs = null;
    var i, len = this.layers ? this.layers.length : 0;
    for (i = 0; i < len; i++) {
        this.elements[i].destroy();
    }
    this.elements.length = 0;
    this.destroyed = true;
    this.animationItem = null;
};

HybridRenderer.prototype.updateContainerSize = function () {
    var elementWidth = this.animationItem.wrapper.offsetWidth;
    var elementHeight = this.animationItem.wrapper.offsetHeight;
    var elementRel = elementWidth/elementHeight;
    var animationRel = this.globalData.compSize.w/this.globalData.compSize.h;
    var sx,sy,tx,ty;
    if(animationRel>elementRel){
        sx = elementWidth/(this.globalData.compSize.w);
        sy = elementWidth/(this.globalData.compSize.w);
        tx = 0;
        ty = ((elementHeight-this.globalData.compSize.h*(elementWidth/this.globalData.compSize.w))/2);
    }else{
        sx = elementHeight/(this.globalData.compSize.h);
        sy = elementHeight/(this.globalData.compSize.h);
        tx = (elementWidth-this.globalData.compSize.w*(elementHeight/this.globalData.compSize.h))/2;
        ty = 0;
    }
    this.resizerElem.style.transform = this.resizerElem.style.webkitTransform = 'matrix3d(' + sx + ',0,0,0,0,'+sy+',0,0,0,0,1,0,'+tx+','+ty+',0,1)';
};

HybridRenderer.prototype.renderFrame = SVGRenderer.prototype.renderFrame;

HybridRenderer.prototype.hide = function(){
    this.resizerElem.style.display = 'none';
};

HybridRenderer.prototype.show = function(){
    this.resizerElem.style.display = 'block';
};

HybridRenderer.prototype.initItems = function(){
    this.buildAllItems();
    if(this.camera){
        this.camera.setup();
    } else {
        var cWidth = this.globalData.compSize.w;
        var cHeight = this.globalData.compSize.h;
        var i, len = this.threeDElements.length;
        for(i=0;i<len;i+=1){
            this.threeDElements[i].perspectiveElem.style.perspective = this.threeDElements[i].perspectiveElem.style.webkitPerspective = Math.sqrt(Math.pow(cWidth,2) + Math.pow(cHeight,2)) + 'px';
        }
    }
};

HybridRenderer.prototype.searchExtraCompositions = function(assets){
    var i, len = assets.length;
    var floatingContainer = document.createElement('div');
    for(i=0;i<len;i+=1){
        if(assets[i].xt){
            var comp = this.createComp(assets[i],floatingContainer,this.globalData.comp,null);
            comp.initExpressions();
            this.globalData.projectInterface.registerComposition(comp);
        }
    }
};
function CVBaseElement(data, comp,globalData){
    this.globalData = globalData;
    this.data = data;
    this.comp = comp;
    this.canvasContext = globalData.canvasContext;
    this.init();
}

createElement(BaseElement, CVBaseElement);

CVBaseElement.prototype.createElements = function(){
    this.checkParenting();
};

CVBaseElement.prototype.checkBlendMode = function(globalData){
    if(globalData.blendMode !== this.data.bm) {
        globalData.blendMode = this.data.bm;

        var blendModeValue = '';
        switch (this.data.bm) {
            case 0:
                blendModeValue = 'normal';
                break;
            case 1:
                blendModeValue = 'multiply';
                break;
            case 2:
                blendModeValue = 'screen';
                break;
            case 3:
                blendModeValue = 'overlay';
                break;
            case 4:
                blendModeValue = 'darken';
                break;
            case 5:
                blendModeValue = 'lighten';
                break;
            case 6:
                blendModeValue = 'color-dodge';
                break;
            case 7:
                blendModeValue = 'color-burn';
                break;
            case 8:
                blendModeValue = 'hard-light';
                break;
            case 9:
                blendModeValue = 'soft-light';
                break;
            case 10:
                blendModeValue = 'difference';
                break;
            case 11:
                blendModeValue = 'exclusion';
                break;
            case 12:
                blendModeValue = 'hue';
                break;
            case 13:
                blendModeValue = 'saturation';
                break;
            case 14:
                blendModeValue = 'color';
                break;
            case 15:
                blendModeValue = 'luminosity';
                break;
        }
        globalData.canvasContext.globalCompositeOperation = blendModeValue;
    }
};


CVBaseElement.prototype.renderFrame = function(parentTransform){
    if(this.data.ty === 3){
        return false;
    }
        this.checkBlendMode(this.data.ty === 0?this.parentGlobalData:this.globalData);

    if(!this.isVisible){
        return this.isVisible;
    }
    this.finalTransform.opMdf = this.finalTransform.op.mdf;
    this.finalTransform.matMdf = this.finalTransform.mProp.mdf;
    this.finalTransform.opacity = this.finalTransform.op.v;

    var mat;
    var finalMat = this.finalTransform.mat;

    if(this.hierarchy){
        var i, len = this.hierarchy.length;
        mat = this.finalTransform.mProp.v.props;
        finalMat.cloneFromProps(mat);
        for(i=0;i<len;i+=1){
            this.finalTransform.matMdf = this.hierarchy[i].finalTransform.mProp.mdf ? true : this.finalTransform.matMdf;
            mat = this.hierarchy[i].finalTransform.mProp.v.props;
            finalMat.transform(mat[0],mat[1],mat[2],mat[3],mat[4],mat[5],mat[6],mat[7],mat[8],mat[9],mat[10],mat[11],mat[12],mat[13],mat[14],mat[15]);
        }
    }else{
        if(!parentTransform){
            finalMat.cloneFromProps(this.finalTransform.mProp.v.props);
        }else{
            mat = this.finalTransform.mProp.v.props;
            finalMat.cloneFromProps(mat);
        }
    }

    if(parentTransform){
        mat = parentTransform.mat.props;
        finalMat.transform(mat[0],mat[1],mat[2],mat[3],mat[4],mat[5],mat[6],mat[7],mat[8],mat[9],mat[10],mat[11],mat[12],mat[13],mat[14],mat[15]);
        this.finalTransform.opacity *= parentTransform.opacity;
        this.finalTransform.opMdf = parentTransform.opMdf ? true : this.finalTransform.opMdf;
        this.finalTransform.matMdf = parentTransform.matMdf ? true : this.finalTransform.matMdf
    }

    if(this.data.hasMask){
        this.globalData.renderer.save(true);
        this.maskManager.renderFrame(this.data.ty === 0?null:finalMat);
    }
    if(this.data.hd){
        this.isVisible = false;
    }
    return this.isVisible;

};

CVBaseElement.prototype.addMasks = function(data){
    this.maskManager = new CVMaskElement(data,this,this.globalData);
};


CVBaseElement.prototype.destroy = function(){
    this.canvasContext = null;
    this.data = null;
    this.globalData = null;
    if(this.maskManager) {
        this.maskManager.destroy();
    }
};

CVBaseElement.prototype.mHelper = new Matrix();

function CVCompElement(data, comp,globalData){
    this._parent.constructor.call(this,data, comp,globalData);
    var compGlobalData = {};
    for(var s in globalData){
        if(globalData.hasOwnProperty(s)){
            compGlobalData[s] = globalData[s];
        }
    }
    compGlobalData.renderer = this;
    compGlobalData.compHeight = this.data.h;
    compGlobalData.compWidth = this.data.w;
    this.renderConfig = {
        clearCanvas: true
    };
    this.contextData = {
        saved : Array.apply(null,{length:15}),
        savedOp: Array.apply(null,{length:15}),
        cArrPos : 0,
        cTr : new Matrix(),
        cO : 1
    };
    this.completeLayers = false;
    var i, len = 15;
    for(i=0;i<len;i+=1){
        this.contextData.saved[i] = Array.apply(null,{length:16});
    }
    this.transformMat = new Matrix();
    this.parentGlobalData = this.globalData;
    var cv = document.createElement('canvas');
    //document.body.appendChild(cv);
    compGlobalData.canvasContext = cv.getContext('2d');
    this.canvasContext = compGlobalData.canvasContext;
    cv.width = this.data.w;
    cv.height = this.data.h;
    this.canvas = cv;
    this.globalData = compGlobalData;
    this.layers = data.layers;
    this.pendingElements = [];
    this.elements = Array.apply(null,{length:this.layers.length});
    if(this.data.tm){
        this.tm = PropertyFactory.getProp(this,this.data.tm,0,globalData.frameRate,this.dynamicProperties);
    }
    if(this.data.xt || !globalData.progressiveLoad){
        this.buildAllItems();
    }
}
createElement(CVBaseElement, CVCompElement);

CVCompElement.prototype.ctxTransform = CanvasRenderer.prototype.ctxTransform;
CVCompElement.prototype.ctxOpacity = CanvasRenderer.prototype.ctxOpacity;
CVCompElement.prototype.save = CanvasRenderer.prototype.save;
CVCompElement.prototype.restore = CanvasRenderer.prototype.restore;
CVCompElement.prototype.reset =  function(){
    this.contextData.cArrPos = 0;
    this.contextData.cTr.reset();
    this.contextData.cO = 1;
};
CVCompElement.prototype.resize = function(transformCanvas){
    var maxScale = Math.max(transformCanvas.sx,transformCanvas.sy);
    this.canvas.width = this.data.w*maxScale;
    this.canvas.height = this.data.h*maxScale;
    this.transformCanvas = {
        sc:maxScale,
        w:this.data.w*maxScale,
        h:this.data.h*maxScale,
        props:[maxScale,0,0,0,0,maxScale,0,0,0,0,1,0,0,0,0,1]
    }
    var i,len = this.elements.length;
    for( i = 0; i < len; i+=1 ){
        if(this.elements[i] && this.elements[i].data.ty === 0){
            this.elements[i].resize(transformCanvas);
        }
    }
};

CVCompElement.prototype.prepareFrame = function(num){
    this.globalData.frameId = this.parentGlobalData.frameId;
    this.globalData.mdf = false;
    this._parent.prepareFrame.call(this,num);
    if(this.isVisible===false && !this.data.xt){
        return;
    }
    var timeRemapped = num;
    if(this.tm){
        timeRemapped = this.tm.v;
        if(timeRemapped === this.data.op){
            timeRemapped = this.data.op - 1;
        }
    }
    this.renderedFrame = timeRemapped/this.data.sr;
    var i,len = this.elements.length;

    if(!this.completeLayers){
        this.checkLayers(num);
    }

    for( i = 0; i < len; i+=1 ){
        if(this.completeLayers || this.elements[i]){
            this.elements[i].prepareFrame(timeRemapped/this.data.sr - this.layers[i].st);
            if(this.elements[i].data.ty === 0 && this.elements[i].globalData.mdf){
                this.globalData.mdf = true;
            }
        }
    }
    if(this.globalData.mdf && !this.data.xt){
        this.canvasContext.clearRect(0, 0, this.data.w, this.data.h);
        this.ctxTransform(this.transformCanvas.props);
    }
};

CVCompElement.prototype.renderFrame = function(parentMatrix){
    if(this._parent.renderFrame.call(this,parentMatrix)===false){
        return;
    }
    if(this.globalData.mdf){
        var i,len = this.layers.length;
        for( i = len - 1; i >= 0; i -= 1 ){
            if(this.completeLayers || this.elements[i]){
                this.elements[i].renderFrame();
            }
        }
    }
    if(this.data.hasMask){
        this.globalData.renderer.restore(true);
    }
    if(this.firstFrame){
        this.firstFrame = false;
    }
    this.parentGlobalData.renderer.save();
    this.parentGlobalData.renderer.ctxTransform(this.finalTransform.mat.props);
    this.parentGlobalData.renderer.ctxOpacity(this.finalTransform.opacity);
    this.parentGlobalData.renderer.canvasContext.drawImage(this.canvas,0,0,this.data.w,this.data.h);
    this.parentGlobalData.renderer.restore();

    if(this.globalData.mdf){
        this.reset();
    }
};

CVCompElement.prototype.setElements = function(elems){
    this.elements = elems;
};

CVCompElement.prototype.getElements = function(){
    return this.elements;
};

CVCompElement.prototype.destroy = function(){
    var i,len = this.layers.length;
    for( i = len - 1; i >= 0; i -= 1 ){
        this.elements[i].destroy();
    }
    this.layers = null;
    this.elements = null;
    this._parent.destroy.call(this._parent);
};
CVCompElement.prototype.checkLayers = CanvasRenderer.prototype.checkLayers;
CVCompElement.prototype.buildItem = CanvasRenderer.prototype.buildItem;
CVCompElement.prototype.checkPendingElements = CanvasRenderer.prototype.checkPendingElements;
CVCompElement.prototype.addPendingElement = CanvasRenderer.prototype.addPendingElement;
CVCompElement.prototype.buildAllItems = CanvasRenderer.prototype.buildAllItems;
CVCompElement.prototype.createItem = CanvasRenderer.prototype.createItem;
CVCompElement.prototype.createImage = CanvasRenderer.prototype.createImage;
CVCompElement.prototype.createComp = CanvasRenderer.prototype.createComp;
CVCompElement.prototype.createSolid = CanvasRenderer.prototype.createSolid;
CVCompElement.prototype.createShape = CanvasRenderer.prototype.createShape;
CVCompElement.prototype.createText = CanvasRenderer.prototype.createText;
CVCompElement.prototype.createBase = CanvasRenderer.prototype.createBase;
CVCompElement.prototype.buildElementParenting = CanvasRenderer.prototype.buildElementParenting;
function CVImageElement(data, comp,globalData){
    this.assetData = globalData.getAssetData(data.refId);
    this._parent.constructor.call(this,data, comp,globalData);
    this.globalData.addPendingElement();
}
createElement(CVBaseElement, CVImageElement);

CVImageElement.prototype.createElements = function(){
    var imageLoaded = function(){
        this.globalData.elementLoaded();
        if(this.assetData.w !== this.img.width || this.assetData.h !== this.img.height){
            var canvas = document.createElement('canvas');
            canvas.width = this.assetData.w;
            canvas.height = this.assetData.h;
            var ctx = canvas.getContext('2d');

            var imgW = this.img.width;
            var imgH = this.img.height;
            var imgRel = imgW / imgH;
            var canvasRel = this.assetData.w/this.assetData.h;
            var widthCrop, heightCrop;
            if(imgRel>canvasRel){
                heightCrop = imgH;
                widthCrop = heightCrop*canvasRel;
            } else {
                widthCrop = imgW;
                heightCrop = widthCrop/canvasRel;
            }
            ctx.drawImage(this.img,(imgW-widthCrop)/2,(imgH-heightCrop)/2,widthCrop,heightCrop,0,0,this.assetData.w,this.assetData.h);
            this.img = canvas;
        }
    }.bind(this);
    var imageFailed = function(){
        this.failed = true;
        this.globalData.elementLoaded();
    }.bind(this);

    this.img = new Image();
    this.img.addEventListener('load', imageLoaded, false);
    this.img.addEventListener('error', imageFailed, false);
    var assetPath = this.globalData.getAssetsPath(this.assetData);
    this.img.src = assetPath;

    this._parent.createElements.call(this);

};

CVImageElement.prototype.renderFrame = function(parentMatrix){
    if(this.failed){
        return;
    }
    if(this._parent.renderFrame.call(this,parentMatrix)===false){
        return;
    }
    var ctx = this.canvasContext;
    this.globalData.renderer.save();
    var finalMat = this.finalTransform.mat.props;
    this.globalData.renderer.ctxTransform(finalMat);
    this.globalData.renderer.ctxOpacity(this.finalTransform.opacity);
    ctx.drawImage(this.img,0,0);
    this.globalData.renderer.restore(this.data.hasMask);
    if(this.firstFrame){
        this.firstFrame = false;
    }
};

CVImageElement.prototype.destroy = function(){
    this.img = null;
    this._parent.destroy.call(this._parent);
};

function CVMaskElement(data,element){
    this.data = data;
    this.element = element;
    this.dynamicProperties = [];
    this.masksProperties = this.data.masksProperties;
    this.viewData = new Array(this.masksProperties.length);
    var i, len = this.masksProperties.length;
    for (i = 0; i < len; i++) {
        this.viewData[i] = ShapePropertyFactory.getShapeProp(this.element,this.masksProperties[i],3,this.dynamicProperties,null);
    }
}

CVMaskElement.prototype.getMaskProperty = function(pos){
    return this.viewData[pos];
};

CVMaskElement.prototype.prepareFrame = function(num){
    var i, len = this.dynamicProperties.length;
    for(i=0;i<len;i+=1){
        this.dynamicProperties[i].getValue(num);
        if(this.dynamicProperties[i].mdf){
            this.element.globalData.mdf = true;
        }
    }
};

CVMaskElement.prototype.renderFrame = function (transform) {
    var ctx = this.element.canvasContext;
    var i, len = this.data.masksProperties.length;
    var pt,pt2,pt3,data, hasMasks = false;
    for (i = 0; i < len; i++) {
        if(this.masksProperties[i].mode === 'n'){
            continue;
        }
        if(hasMasks === false){
            ctx.beginPath();
            hasMasks = true;
        }
        if (this.masksProperties[i].inv) {
            ctx.moveTo(0, 0);
            ctx.lineTo(this.element.globalData.compWidth, 0);
            ctx.lineTo(this.element.globalData.compWidth, this.element.globalData.compHeight);
            ctx.lineTo(0, this.element.globalData.compHeight);
            ctx.lineTo(0, 0);
        }
        data = this.viewData[i].v;
        pt = transform ? transform.applyToPointArray(data.v[0][0],data.v[0][1],0):data.v[0];
        ctx.moveTo(pt[0], pt[1]);
        var j, jLen = data._length;
        for (j = 1; j < jLen; j++) {
            pt = transform ? transform.applyToPointArray(data.o[j - 1][0],data.o[j - 1][1],0) : data.o[j - 1];
            pt2 = transform ? transform.applyToPointArray(data.i[j][0],data.i[j][1],0) : data.i[j];
            pt3 = transform ? transform.applyToPointArray(data.v[j][0],data.v[j][1],0) : data.v[j];
            ctx.bezierCurveTo(pt[0], pt[1], pt2[0], pt2[1], pt3[0], pt3[1]);
        }
        pt = transform ? transform.applyToPointArray(data.o[j - 1][0],data.o[j - 1][1],0) : data.o[j - 1];
        pt2 = transform ? transform.applyToPointArray(data.i[0][0],data.i[0][1],0) : data.i[0];
        pt3 = transform ? transform.applyToPointArray(data.v[0][0],data.v[0][1],0) : data.v[0];
        ctx.bezierCurveTo(pt[0], pt[1], pt2[0], pt2[1], pt3[0], pt3[1]);
    }
    if(hasMasks){
        ctx.clip();
    }
};

CVMaskElement.prototype.getMask = function(nm){
    var i = 0, len = this.masksProperties.length;
    while(i<len){
        if(this.masksProperties[i].nm === nm){
            return {
                maskPath: this.viewData[i].pv
            }
        }
        i += 1;
    }
};

CVMaskElement.prototype.destroy = function(){
    this.element = null;
};
function CVShapeElement(data, comp,globalData){
    this.shapes = [];
    this.shapesData = data.shapes;
    this.stylesList = [];
    this.itemsData = [];
    this.prevViewData = [];
    this.shapeModifiers = [];
    this.processedElements = [];
    this._parent.constructor.call(this,data, comp,globalData);
}
createElement(CVBaseElement, CVShapeElement);

CVShapeElement.prototype.transformHelper = {opacity:1,mat:new Matrix(),matMdf:false,opMdf:false};

CVShapeElement.prototype.dashResetter = [];

CVShapeElement.prototype.createElements = function(){

    this._parent.createElements.call(this);
    this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,this.dynamicProperties, true);
};

CVShapeElement.prototype.createStyleElement = function(data, dynamicProperties){
    var styleElem = {
        data: data,
        type: data.ty,
        elements: []
    };
    var elementData = {};
    if(data.ty == 'fl' || data.ty == 'st'){
        elementData.c = PropertyFactory.getProp(this,data.c,1,255,dynamicProperties);
        if(!elementData.c.k){
            styleElem.co = 'rgb('+bm_floor(elementData.c.v[0])+','+bm_floor(elementData.c.v[1])+','+bm_floor(elementData.c.v[2])+')';
        }
    }
    elementData.o = PropertyFactory.getProp(this,data.o,0,0.01,dynamicProperties);
    if(data.ty == 'st') {
        styleElem.lc = this.lcEnum[data.lc] || 'round';
        styleElem.lj = this.ljEnum[data.lj] || 'round';
        if(data.lj == 1) {
            styleElem.ml = data.ml;
        }
        elementData.w = PropertyFactory.getProp(this,data.w,0,null,dynamicProperties);
        if(!elementData.w.k){
            styleElem.wi = elementData.w.v;
        }
        if(data.d){
            var d = PropertyFactory.getDashProp(this,data.d,'canvas',dynamicProperties);
            elementData.d = d;
            if(!elementData.d.k){
                styleElem.da = elementData.d.dasharray;
                styleElem.do = elementData.d.dashoffset;
            }
        }

    } else {

        styleElem.r = data.r === 2 ? 'evenodd' : 'nonzero';
    }
    this.stylesList.push(styleElem);
    elementData.style = styleElem;
    return elementData;
}

CVShapeElement.prototype.createGroupElement = function(data) {
    var elementData = {
        it: [],
        prevViewData: []
    };
    return elementData;
}

CVShapeElement.prototype.createTransformElement = function(data, dynamicProperties) {
    var elementData = {
        transform : {
            mat: new Matrix(),
            opacity: 1,
            matMdf:false,
            opMdf:false,
            op: PropertyFactory.getProp(this,data.o,0,0.01,dynamicProperties),
            mProps: PropertyFactory.getProp(this,data,2,null,dynamicProperties)
        },
        elements: []
    };
    return elementData;
}

CVShapeElement.prototype.createShapeElement = function(data, dynamicProperties) {
    var elementData = {
        nodes:[],
        trNodes:[],
        tr:[0,0,0,0,0,0]
    };
    var ty = 4;
    if(data.ty == 'rc'){
        ty = 5;
    }else if(data.ty == 'el'){
        ty = 6;
    }else if(data.ty == 'sr'){
        ty = 7;
    }
    elementData.sh = ShapePropertyFactory.getShapeProp(this,data,ty,dynamicProperties);
    this.shapes.push(elementData.sh);
    this.addShapeToModifiers(elementData);
    jLen = this.stylesList.length;
    var hasStrokes = false, hasFills = false;
    for(j=0;j<jLen;j+=1){
        if(!this.stylesList[j].closed){
            this.stylesList[j].elements.push(elementData);
            if(this.stylesList[j].type === 'st'){
                hasStrokes = true;
            }else{
                hasFills = true;
            }
        }
    }
    elementData.st = hasStrokes;
    elementData.fl = hasFills;
    return elementData;
}

CVShapeElement.prototype.reloadShapes = function(){
    this.firstFrame = true;
    var i, len = this.itemsData.length;
    for(i=0;i<len;i+=1){
        this.prevViewData[i] = this.itemsData[i];
    }
    this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,this.dynamicProperties, true);
    var i, len = this.dynamicProperties.length;
    for(i=0;i<len;i+=1){
        this.dynamicProperties[i].getValue();
    }
    this.renderModifiers();
}

CVShapeElement.prototype.searchShapes = function(arr,itemsData, prevViewData,dynamicProperties, render){
    var i, len = arr.length - 1;
    var j, jLen;
    var ownArrays = [], ownModifiers = [], processedPos;
    for(i=len;i>=0;i-=1){
        processedPos = this.searchProcessedElement(arr[i]);
        if(!processedPos){
            arr[i]._render = render;
        } else {
            itemsData[i] = prevViewData[processedPos - 1];
        }
        if(arr[i].ty == 'fl' || arr[i].ty == 'st'){
            if(!processedPos){
                itemsData[i] = this.createStyleElement(arr[i], dynamicProperties);
            } else {
                itemsData[i].style.closed = false;
            }
            
            ownArrays.push(itemsData[i].style);
        }else if(arr[i].ty == 'gr'){
            if(!processedPos){
                itemsData[i] = this.createGroupElement(arr[i]);
            } else {
                jLen = itemsData[i].it.length;
                for(j=0;j<jLen;j+=1){
                    itemsData[i].prevViewData[j] = itemsData[i].it[j];
                }
            }
            this.searchShapes(arr[i].it,itemsData[i].it,itemsData[i].prevViewData,dynamicProperties, render);
        }else if(arr[i].ty == 'tr'){
            if(!processedPos){
                itemsData[i] = this.createTransformElement(arr[i], dynamicProperties);
            }
        }else if(arr[i].ty == 'sh' || arr[i].ty == 'rc' || arr[i].ty == 'el' || arr[i].ty == 'sr'){
            if(!processedPos){
                itemsData[i] = this.createShapeElement(arr[i], dynamicProperties);
            }
            
        }else if(arr[i].ty == 'tm' || arr[i].ty == 'rd'){
            if(!processedPos){
                var modifier = ShapeModifiers.getModifier(arr[i].ty);
                modifier.init(this,arr[i],dynamicProperties);
                itemsData[i] = modifier;
                this.shapeModifiers.push(modifier);
            } else {
                modifier = itemsData[i];
                modifier.closed = false;
            }
            ownModifiers.push(modifier);
        } else if(arr[i].ty == 'rp'){
            if(!processedPos){
                modifier = ShapeModifiers.getModifier(arr[i].ty);
                itemsData[i] = modifier;
                modifier.init(this,arr,i,itemsData,dynamicProperties);
                this.shapeModifiers.push(modifier);
                render = false;
            }else{
                modifier = itemsData[i];
                modifier.closed = true;
            }
            ownModifiers.push(modifier);
        }
        this.addProcessedElement(arr[i], i + 1);
    }
    len = ownArrays.length;
    for(i=0;i<len;i+=1){
        ownArrays[i].closed = true;
    }
    len = ownModifiers.length;
    for(i=0;i<len;i+=1){
        ownModifiers[i].closed = true;
    }
};

CVShapeElement.prototype.addShapeToModifiers = IShapeElement.prototype.addShapeToModifiers;
CVShapeElement.prototype.renderModifiers = IShapeElement.prototype.renderModifiers;
CVShapeElement.prototype.lcEnum = IShapeElement.prototype.lcEnum;
CVShapeElement.prototype.ljEnum = IShapeElement.prototype.ljEnum;
CVShapeElement.prototype.searchProcessedElement = IShapeElement.prototype.searchProcessedElement;
CVShapeElement.prototype.addProcessedElement = IShapeElement.prototype.addProcessedElement;

CVShapeElement.prototype.renderFrame = function(parentMatrix){
    if(this._parent.renderFrame.call(this, parentMatrix)===false){
        return;
    }
    this.transformHelper.mat.reset();
    this.transformHelper.opacity = this.finalTransform.opacity;
    this.transformHelper.matMdf = false;
    this.transformHelper.opMdf = this.finalTransform.opMdf;
    this.renderModifiers();
    this.renderShape(this.transformHelper,null,null,true);
    if(this.data.hasMask){
        this.globalData.renderer.restore(true);
    }
};

CVShapeElement.prototype.renderShape = function(parentTransform,items,data,isMain){
    var i, len;
    if(!items){
        items = this.shapesData;
        len = this.stylesList.length;
        for(i=0;i<len;i+=1){
            this.stylesList[i].d = '';
            this.stylesList[i].mdf = false;
        }
    }
    if(!data){
        data = this.itemsData;
    }
    ///
    ///
    len = items.length - 1;
    var groupTransform,groupMatrix;
    groupTransform = parentTransform;
    for(i=len;i>=0;i-=1){
        if(items[i].ty == 'tr'){
            groupTransform = data[i].transform;
            var mtArr = data[i].transform.mProps.v.props;
            groupTransform.matMdf = groupTransform.mProps.mdf;
            groupTransform.opMdf = groupTransform.op.mdf;
            groupMatrix = groupTransform.mat;
            groupMatrix.cloneFromProps(mtArr);
            if(parentTransform){
                var props = parentTransform.mat.props;
                groupTransform.opacity = parentTransform.opacity;
                groupTransform.opacity *= data[i].transform.op.v;
                groupTransform.matMdf = parentTransform.matMdf ? true : groupTransform.matMdf;
                groupTransform.opMdf = parentTransform.opMdf ? true : groupTransform.opMdf;
                groupMatrix.transform(props[0],props[1],props[2],props[3],props[4],props[5],props[6],props[7],props[8],props[9],props[10],props[11],props[12],props[13],props[14],props[15]);
            }else{
                groupTransform.opacity = groupTransform.op.o;
            }
        }else if(items[i].ty == 'sh' || items[i].ty == 'el' || items[i].ty == 'rc' || items[i].ty == 'sr'){
            this.renderPath(items[i],data[i],groupTransform);
        }else if(items[i].ty == 'fl'){
            this.renderFill(items[i],data[i],groupTransform);
        }else if(items[i].ty == 'st'){
            this.renderStroke(items[i],data[i],groupTransform);
        }else if(items[i].ty == 'gr'){
            this.renderShape(groupTransform,items[i].it,data[i].it);
        }else if(items[i].ty == 'tm'){
            //
        }
    }
    if(!isMain){
        return;
    }
    len = this.stylesList.length;
    var j, jLen, k, kLen,elems,nodes, renderer = this.globalData.renderer, ctx = this.globalData.canvasContext, type;
    renderer.save();
    renderer.ctxTransform(this.finalTransform.mat.props);
    for(i=0;i<len;i+=1){
        type = this.stylesList[i].type;
        if((type === 'st' && this.stylesList[i].wi === 0) || !this.stylesList[i].data._render){
            continue;
        }
        renderer.save();
        elems = this.stylesList[i].elements;
        if(type === 'st'){
            ctx.strokeStyle = this.stylesList[i].co;
            ctx.lineWidth = this.stylesList[i].wi;
            ctx.lineCap = this.stylesList[i].lc;
            ctx.lineJoin = this.stylesList[i].lj;
            ctx.miterLimit = this.stylesList[i].ml || 0;
        }else{
            ctx.fillStyle = this.stylesList[i].co;
        }
        renderer.ctxOpacity(this.stylesList[i].coOp);
        if(type !== 'st'){
            ctx.beginPath();
        }
        jLen = elems.length;
        for(j=0;j<jLen;j+=1){
            if(type === 'st'){
                ctx.beginPath();
                if(this.stylesList[i].da){
                    ctx.setLineDash(this.stylesList[i].da);
                    ctx.lineDashOffset = this.stylesList[i].do;
                    this.globalData.isDashed = true;
                }else if(this.globalData.isDashed){
                    ctx.setLineDash(this.dashResetter);
                    this.globalData.isDashed = false;
                }
            }
            nodes = elems[j].trNodes;
            kLen = nodes.length;

            for(k=0;k<kLen;k+=1){
                if(nodes[k].t == 'm'){
                    ctx.moveTo(nodes[k].p[0],nodes[k].p[1]);
                }else if(nodes[k].t == 'c'){
                    ctx.bezierCurveTo(nodes[k].p1[0],nodes[k].p1[1],nodes[k].p2[0],nodes[k].p2[1],nodes[k].p3[0],nodes[k].p3[1]);
                }else{
                    ctx.closePath();
                }
            }
            if(type === 'st'){
                ctx.stroke();
            }
        }
        if(type !== 'st'){
            ctx.fill(this.stylesList[i].r);
        }
        renderer.restore();
    }
    renderer.restore();
    if(this.firstFrame){
        this.firstFrame = false;
    }
};
CVShapeElement.prototype.renderPath = function(pathData,itemData,groupTransform){
    var len, i, j,jLen;
    var redraw = groupTransform.matMdf || itemData.sh.mdf || this.firstFrame;
    if(redraw) {
        var paths = itemData.sh.paths;
        jLen = paths._length;
        var pathStringTransformed = itemData.trNodes;
        pathStringTransformed.length = 0;
        for(j=0;j<jLen;j+=1){
            var pathNodes = paths.shapes[j];
            if(pathNodes && pathNodes.v){
                len = pathNodes._length;
                for (i = 1; i < len; i += 1) {
                    if (i == 1) {
                        pathStringTransformed.push({
                            t: 'm',
                            p: groupTransform.mat.applyToPointArray(pathNodes.v[0][0], pathNodes.v[0][1], 0)
                        });
                    }
                    pathStringTransformed.push({
                        t: 'c',
                        p1: groupTransform.mat.applyToPointArray(pathNodes.o[i - 1][0], pathNodes.o[i - 1][1], 0),
                        p2: groupTransform.mat.applyToPointArray(pathNodes.i[i][0], pathNodes.i[i][1], 0),
                        p3: groupTransform.mat.applyToPointArray(pathNodes.v[i][0], pathNodes.v[i][1], 0)
                    });
                }
                if (len == 1) {
                    pathStringTransformed.push({
                        t: 'm',
                        p: groupTransform.mat.applyToPointArray(pathNodes.v[0][0], pathNodes.v[0][1], 0)
                    });
                }
                if (pathNodes.c && len) {
                    pathStringTransformed.push({
                        t: 'c',
                        p1: groupTransform.mat.applyToPointArray(pathNodes.o[i - 1][0], pathNodes.o[i - 1][1], 0),
                        p2: groupTransform.mat.applyToPointArray(pathNodes.i[0][0], pathNodes.i[0][1], 0),
                        p3: groupTransform.mat.applyToPointArray(pathNodes.v[0][0], pathNodes.v[0][1], 0)
                    });
                    pathStringTransformed.push({
                        t: 'z'
                    });
                }
                itemData.lStr = pathStringTransformed;
            }

        }

        if (itemData.st) {
            for (i = 0; i < 16; i += 1) {
                itemData.tr[i] = groupTransform.mat.props[i];
            }
        }
        itemData.trNodes = pathStringTransformed;

    }
};



CVShapeElement.prototype.renderFill = function(styleData,itemData, groupTransform){
    var styleElem = itemData.style;

    if(itemData.c.mdf || this.firstFrame){
        styleElem.co = 'rgb('+bm_floor(itemData.c.v[0])+','+bm_floor(itemData.c.v[1])+','+bm_floor(itemData.c.v[2])+')';
    }
    if(itemData.o.mdf || groupTransform.opMdf || this.firstFrame){
        styleElem.coOp = itemData.o.v*groupTransform.opacity;
    }
};

CVShapeElement.prototype.renderStroke = function(styleData,itemData, groupTransform){
    var styleElem = itemData.style;
    //TODO fix dashes
    var d = itemData.d;
    var dasharray,dashoffset;
    if(d && (d.mdf  || this.firstFrame)){
        styleElem.da = d.dasharray;
        styleElem.do = d.dashoffset;
    }
    if(itemData.c.mdf || this.firstFrame){
        styleElem.co = 'rgb('+bm_floor(itemData.c.v[0])+','+bm_floor(itemData.c.v[1])+','+bm_floor(itemData.c.v[2])+')';
    }
    if(itemData.o.mdf || groupTransform.opMdf || this.firstFrame){
        styleElem.coOp = itemData.o.v*groupTransform.opacity;
    }
    if(itemData.w.mdf || this.firstFrame){
        styleElem.wi = itemData.w.v;
    }
};


CVShapeElement.prototype.destroy = function(){
    this.shapesData = null;
    this.globalData = null;
    this.canvasContext = null;
    this.stylesList.length = 0;
    this.itemData.length = 0;
    this._parent.destroy.call(this._parent);
};


function CVSolidElement(data, comp,globalData){
    this._parent.constructor.call(this,data, comp,globalData);
}
createElement(CVBaseElement, CVSolidElement);

CVSolidElement.prototype.renderFrame = function(parentMatrix){
    if(this._parent.renderFrame.call(this, parentMatrix)===false){
        return;
    }
    var ctx = this.canvasContext;
    this.globalData.renderer.save();
    this.globalData.renderer.ctxTransform(this.finalTransform.mat.props);
    this.globalData.renderer.ctxOpacity(this.finalTransform.opacity);
    ctx.fillStyle=this.data.sc;
    ctx.fillRect(0,0,this.data.sw,this.data.sh);
    this.globalData.renderer.restore(this.data.hasMask);
    if(this.firstFrame){
        this.firstFrame = false;
    }
};
function CVTextElement(data, comp, globalData){
    this.textSpans = [];
    this.yOffset = 0;
    this.fillColorAnim = false;
    this.strokeColorAnim = false;
    this.strokeWidthAnim = false;
    this.stroke = false;
    this.fill = false;
    this.justifyOffset = 0;
    this.currentRender = null;
    this.renderType = 'canvas';
    this.values = {
        fill: 'rgba(0,0,0,0)',
        stroke: 'rgba(0,0,0,0)',
        sWidth: 0,
        fValue: ''
    }
    this._parent.constructor.call(this,data,comp, globalData);
}
createElement(CVBaseElement, CVTextElement);

CVTextElement.prototype.init = ITextElement.prototype.init;
CVTextElement.prototype.getMeasures = ITextElement.prototype.getMeasures;
CVTextElement.prototype.getMult = ITextElement.prototype.getMult;
CVTextElement.prototype.prepareFrame = ITextElement.prototype.prepareFrame;

CVTextElement.prototype.tHelper = document.createElement('canvas').getContext('2d');

CVTextElement.prototype.createElements = function(){

    this._parent.createElements.call(this);
    //console.log('this.data: ',this.data);

};

CVTextElement.prototype.buildNewText = function(){
    var documentData = this.currentTextDocumentData;
    this.renderedLetters = Array.apply(null,{length:this.currentTextDocumentData.l ? this.currentTextDocumentData.l.length : 0});

    var hasFill = false;
    if(documentData.fc) {
        hasFill = true;
        this.values.fill = 'rgb(' + Math.round(documentData.fc[0]*255) + ',' + Math.round(documentData.fc[1]*255) + ',' + Math.round(documentData.fc[2]*255) + ')';
    }else{
        this.values.fill = 'rgba(0,0,0,0)';
    }
    this.fill = hasFill;
    var hasStroke = false;
    if(documentData.sc){
        hasStroke = true;
        this.values.stroke = 'rgb(' + Math.round(documentData.sc[0]*255) + ',' + Math.round(documentData.sc[1]*255) + ',' + Math.round(documentData.sc[2]*255) + ')';
        this.values.sWidth = documentData.sw;
    }
    var fontData = this.globalData.fontManager.getFontByName(documentData.f);
    var i, len;
    var letters = documentData.l;
    var matrixHelper = this.mHelper;
    this.stroke = hasStroke;
    this.values.fValue = documentData.s + 'px '+ this.globalData.fontManager.getFontByName(documentData.f).fFamily;
    len = documentData.t.length;
    this.tHelper.font = this.values.fValue;
    var charData, shapeData, k, kLen, shapes, j, jLen, pathNodes, commands, pathArr, singleShape = this.data.singleShape;
    if (singleShape) {
        var xPos = 0, yPos = 0, lineWidths = documentData.lineWidths, boxWidth = documentData.boxWidth, firstLine = true;
    }
    var cnt = 0;
    for (i = 0;i < len ;i += 1) {
        charData = this.globalData.fontManager.getCharData(documentData.t.charAt(i), fontData.fStyle, this.globalData.fontManager.getFontByName(documentData.f).fFamily);
        var shapeData;
        if(charData){
            shapeData = charData.data;
        } else {
            shapeData = null;
        }
        matrixHelper.reset();
        if(singleShape && letters[i].n) {
            xPos = 0;
            yPos += documentData.yOffset;
            yPos += firstLine ? 1 : 0;
            firstLine = false;
        }

        if(shapeData && shapeData.shapes){
            shapes = shapeData.shapes[0].it;
            jLen = shapes.length;
            matrixHelper.scale(documentData.s/100,documentData.s/100);
            if(singleShape){
                if(documentData.ps){
                    matrixHelper.translate(documentData.ps[0],documentData.ps[1] + documentData.ascent,0);
                }
                matrixHelper.translate(0,-documentData.ls,0);
                switch(documentData.j){
                    case 1:
                        matrixHelper.translate(documentData.justifyOffset + (boxWidth - lineWidths[letters[i].line]),0,0);
                        break;
                    case 2:
                        matrixHelper.translate(documentData.justifyOffset + (boxWidth - lineWidths[letters[i].line])/2,0,0);
                        break;
                }
                matrixHelper.translate(xPos,yPos,0);
            }
            commands = new Array(jLen);
            for(j=0;j<jLen;j+=1){
                kLen = shapes[j].ks.k.i.length;
                pathNodes = shapes[j].ks.k;
                pathArr = [];
                for(k=1;k<kLen;k+=1){
                    if(k==1){
                        pathArr.push(matrixHelper.applyToX(pathNodes.v[0][0],pathNodes.v[0][1],0),matrixHelper.applyToY(pathNodes.v[0][0],pathNodes.v[0][1],0));
                    }
                    pathArr.push(matrixHelper.applyToX(pathNodes.o[k-1][0],pathNodes.o[k-1][1],0),matrixHelper.applyToY(pathNodes.o[k-1][0],pathNodes.o[k-1][1],0),matrixHelper.applyToX(pathNodes.i[k][0],pathNodes.i[k][1],0),matrixHelper.applyToY(pathNodes.i[k][0],pathNodes.i[k][1],0),matrixHelper.applyToX(pathNodes.v[k][0],pathNodes.v[k][1],0),matrixHelper.applyToY(pathNodes.v[k][0],pathNodes.v[k][1],0));
                }
                pathArr.push(matrixHelper.applyToX(pathNodes.o[k-1][0],pathNodes.o[k-1][1],0),matrixHelper.applyToY(pathNodes.o[k-1][0],pathNodes.o[k-1][1],0),matrixHelper.applyToX(pathNodes.i[0][0],pathNodes.i[0][1],0),matrixHelper.applyToY(pathNodes.i[0][0],pathNodes.i[0][1],0),matrixHelper.applyToX(pathNodes.v[0][0],pathNodes.v[0][1],0),matrixHelper.applyToY(pathNodes.v[0][0],pathNodes.v[0][1],0));
                commands[j] = pathArr;
            }
        }else{
            commands = [];
        }
        if(singleShape){
            xPos += letters[i].l;
        }
        if(this.textSpans[cnt]){
            this.textSpans[cnt].elem = commands;
        } else {
            this.textSpans[cnt] = {elem: commands};
        }
        cnt +=1;
    }
}

CVTextElement.prototype.renderFrame = function(parentMatrix){
    if(this._parent.renderFrame.call(this, parentMatrix)===false){
        return;
    }
    var ctx = this.canvasContext;
    var finalMat = this.finalTransform.mat.props;
    this.globalData.renderer.save();
    this.globalData.renderer.ctxTransform(finalMat);
    this.globalData.renderer.ctxOpacity(this.finalTransform.opacity);
    ctx.font = this.values.fValue;
    ctx.lineCap = 'butt';
    ctx.lineJoin = 'miter';
    ctx.miterLimit = 4;

    if(!this.data.singleShape){
        this.getMeasures();
    }

    var  i,len, j, jLen, k, kLen;
    var renderedLetters = this.renderedLetters;

    var letters = this.currentTextDocumentData.l;

    len = letters.length;
    var renderedLetter;
    var lastFill = null, lastStroke = null, lastStrokeW = null, commands, pathArr;
    for(i=0;i<len;i+=1){
        if(letters[i].n){
            continue;
        }
        renderedLetter = renderedLetters[i];
        if(renderedLetter){
            this.globalData.renderer.save();
            this.globalData.renderer.ctxTransform(renderedLetter.props);
            this.globalData.renderer.ctxOpacity(renderedLetter.o);
        }
        if(this.fill){
            if(renderedLetter && renderedLetter.fc){
                if(lastFill !== renderedLetter.fc){
                    lastFill = renderedLetter.fc;
                    ctx.fillStyle = renderedLetter.fc;
                }
            }else if(lastFill !== this.values.fill){
                lastFill = this.values.fill;
                ctx.fillStyle = this.values.fill;
            }
            commands = this.textSpans[i].elem;
            jLen = commands.length;
            this.globalData.canvasContext.beginPath();
            for(j=0;j<jLen;j+=1) {
                pathArr = commands[j];
                kLen = pathArr.length;
                this.globalData.canvasContext.moveTo(pathArr[0], pathArr[1]);
                for (k = 2; k < kLen; k += 6) {
                    this.globalData.canvasContext.bezierCurveTo(pathArr[k], pathArr[k + 1], pathArr[k + 2], pathArr[k + 3], pathArr[k + 4], pathArr[k + 5]);
                }
            }
            this.globalData.canvasContext.closePath();
            this.globalData.canvasContext.fill();
            ///ctx.fillText(this.textSpans[i].val,0,0);
        }
        if(this.stroke){
            if(renderedLetter && renderedLetter.sw){
                if(lastStrokeW !== renderedLetter.sw){
                    lastStrokeW = renderedLetter.sw;
                    ctx.lineWidth = renderedLetter.sw;
                }
            }else if(lastStrokeW !== this.values.sWidth){
                lastStrokeW = this.values.sWidth;
                ctx.lineWidth = this.values.sWidth;
            }
            if(renderedLetter && renderedLetter.sc){
                if(lastStroke !== renderedLetter.sc){
                    lastStroke = renderedLetter.sc;
                    ctx.strokeStyle = renderedLetter.sc;
                }
            }else if(lastStroke !== this.values.stroke){
                lastStroke = this.values.stroke;
                ctx.strokeStyle = this.values.stroke;
            }
            commands = this.textSpans[i].elem;
            jLen = commands.length;
            this.globalData.canvasContext.beginPath();
            for(j=0;j<jLen;j+=1) {
                pathArr = commands[j];
                kLen = pathArr.length;
                this.globalData.canvasContext.moveTo(pathArr[0], pathArr[1]);
                for (k = 2; k < kLen; k += 6) {
                    this.globalData.canvasContext.bezierCurveTo(pathArr[k], pathArr[k + 1], pathArr[k + 2], pathArr[k + 3], pathArr[k + 4], pathArr[k + 5]);
                }
            }
            this.globalData.canvasContext.closePath();
            this.globalData.canvasContext.stroke();
            ///ctx.strokeText(letters[i].val,0,0);
        }
        if(renderedLetter) {
            this.globalData.renderer.restore();
        }
    }
    /*if(this.data.hasMask){
     this.globalData.renderer.restore(true);
     }*/
    this.globalData.renderer.restore(this.data.hasMask);
    if(this.firstFrame){
        this.firstFrame = false;
    }
};
function HBaseElement(data,parentContainer,globalData,comp, placeholder){
    this.globalData = globalData;
    this.comp = comp;
    this.data = data;
    this.matteElement = null;
    this.parentContainer = parentContainer;
    this.layerId = placeholder ? placeholder.layerId : 'ly_'+randomString(10);
    this.placeholder = placeholder;
    this.init();
};

createElement(BaseElement, HBaseElement);
HBaseElement.prototype.checkBlendMode = function(){

};
HBaseElement.prototype.setBlendMode = BaseElement.prototype.setBlendMode;

/*HBaseElement.prototype.appendNodeToParent = function(node) {
    if(this.data.hd){
        return;
    }
    if(this.placeholder){
        var g = this.placeholder.phElement;
        g.parentNode.insertBefore(node, g);
        //g.parentNode.removeChild(g);
    }else{
        this.parentContainer.appendChild(node);
    }
};*/


HBaseElement.prototype.getBaseElement = function(){
    return this.baseElement;
};

HBaseElement.prototype.createElements = function(){
    if(this.data.hasMask){
        this.layerElement = document.createElementNS(svgNS,'svg');
        styleDiv(this.layerElement);
        //this.appendNodeToParent(this.layerElement);
        this.baseElement = this.layerElement;
        this.maskedElement = this.layerElement;
    }else{
        this.layerElement = this.parentContainer;
    }
    this.transformedElement = this.layerElement;
    if(this.data.ln && (this.data.ty === 4 || this.data.ty === 0)){
        if(this.layerElement === this.parentContainer){
            this.layerElement = document.createElementNS(svgNS,'g');
            //this.appendNodeToParent(this.layerElement);
            this.baseElement = this.layerElement;
        }
        this.layerElement.setAttribute('id',this.data.ln);
    }
    this.setBlendMode();
    if(this.layerElement !== this.parentContainer){
        this.placeholder = null;
    }
    this.checkParenting();
};

HBaseElement.prototype.renderFrame = function(parentTransform){
    if(this.data.ty === 3){
        return false;
    }

    if(this.currentFrameNum === this.lastNum || !this.isVisible){
        return this.isVisible;
    }
    this.lastNum = this.currentFrameNum;

    this.finalTransform.opMdf = this.finalTransform.op.mdf;
    this.finalTransform.matMdf = this.finalTransform.mProp.mdf;
    this.finalTransform.opacity = this.finalTransform.op.v;
    if(this.firstFrame){
        this.finalTransform.opMdf = true;
        this.finalTransform.matMdf = true;
    }

    var mat;
    var finalMat = this.finalTransform.mat;

    if(this.hierarchy){
        var i, len = this.hierarchy.length;

        mat = this.finalTransform.mProp.v.props;
        finalMat.cloneFromProps(mat);
        for(i=0;i<len;i+=1){
            this.finalTransform.matMdf = this.hierarchy[i].finalTransform.mProp.mdf ? true : this.finalTransform.matMdf;
            mat = this.hierarchy[i].finalTransform.mProp.v.props;
            finalMat.transform(mat[0],mat[1],mat[2],mat[3],mat[4],mat[5],mat[6],mat[7],mat[8],mat[9],mat[10],mat[11],mat[12],mat[13],mat[14],mat[15]);
        }
    }else{
        if(this.isVisible && this.finalTransform.matMdf){
            if(!parentTransform){
                finalMat.cloneFromProps(this.finalTransform.mProp.v.props);
            }else{
                mat = this.finalTransform.mProp.v.props;
                finalMat.cloneFromProps(mat);
            }
        }
    }
    if(this.data.hasMask){
        this.maskManager.renderFrame(finalMat);
    }

    if(parentTransform){
        mat = parentTransform.mat.props;
        finalMat.cloneFromProps(mat);
        this.finalTransform.opacity *= parentTransform.opacity;
        this.finalTransform.opMdf = parentTransform.opMdf ? true : this.finalTransform.opMdf;
        this.finalTransform.matMdf = parentTransform.matMdf ? true : this.finalTransform.matMdf
    }

    if(this.finalTransform.matMdf){
        this.transformedElement.style.transform = this.transformedElement.style.webkitTransform = finalMat.toCSS();
        this.finalMat = finalMat;
    }
    if(this.finalTransform.opMdf){
        this.transformedElement.style.opacity = this.finalTransform.opacity;
    }
    return this.isVisible;
};

HBaseElement.prototype.destroy = function(){
    this.layerElement = null;
    this.transformedElement = null;
    this.parentContainer = null;
    if(this.matteElement) {
        this.matteElement = null;
    }
    if(this.maskManager) {
        this.maskManager.destroy();
        this.maskManager = null;
    }
};

HBaseElement.prototype.getDomElement = function(){
    return this.layerElement;
};
HBaseElement.prototype.addMasks = function(data){
    this.maskManager = new MaskElement(data,this,this.globalData);
};

HBaseElement.prototype.hide = function(){
};

HBaseElement.prototype.setMatte = function(){

}

HBaseElement.prototype.buildElementParenting = HybridRenderer.prototype.buildElementParenting;
function HSolidElement(data,parentContainer,globalData,comp, placeholder){
    this._parent.constructor.call(this,data,parentContainer,globalData,comp, placeholder);
}
createElement(HBaseElement, HSolidElement);

HSolidElement.prototype.createElements = function(){
    var parent = document.createElement('div');
    styleDiv(parent);
    var cont = document.createElementNS(svgNS,'svg');
    styleDiv(cont);
    cont.setAttribute('width',this.data.sw);
    cont.setAttribute('height',this.data.sh);
    parent.appendChild(cont);
    this.layerElement = parent;
    this.transformedElement = parent;
    //this.appendNodeToParent(parent);
    this.baseElement = parent;
    this.innerElem = parent;
    if(this.data.ln){
        this.innerElem.setAttribute('id',this.data.ln);
    }
    if(this.data.bm !== 0){
        this.setBlendMode();
    }
    var rect = document.createElementNS(svgNS,'rect');
    rect.setAttribute('width',this.data.sw);
    rect.setAttribute('height',this.data.sh);
    rect.setAttribute('fill',this.data.sc);
    cont.appendChild(rect);
    if(this.data.hasMask){
        this.maskedElement = rect;
    }
    this.checkParenting();
};



HSolidElement.prototype.hide = SVGBaseElement.prototype.hide;
HSolidElement.prototype.show = SVGBaseElement.prototype.show;
HSolidElement.prototype.renderFrame = IImageElement.prototype.renderFrame;
HSolidElement.prototype.destroy = IImageElement.prototype.destroy;
function HCompElement(data,parentContainer,globalData,comp, placeholder){
    this._parent.constructor.call(this,data,parentContainer,globalData,comp, placeholder);
    this.layers = data.layers;
    this.supports3d = true;
    this.completeLayers = false;
    this.pendingElements = [];
    this.elements = Array.apply(null,{length:this.layers.length});
    if(this.data.tm){
        this.tm = PropertyFactory.getProp(this,this.data.tm,0,globalData.frameRate,this.dynamicProperties);
    }
    if(this.data.hasMask) {
        this.supports3d = false;
    }
    if(this.data.xt){
        this.layerElement = document.createElement('div');
    }
    this.buildAllItems();

}
createElement(HBaseElement, HCompElement);

HCompElement.prototype.createElements = function(){
    var divElement = document.createElement('div');
    styleDiv(divElement);
    if(this.data.ln){
        divElement.setAttribute('id',this.data.ln);
    }
    divElement.style.clip = 'rect(0px, '+this.data.w+'px, '+this.data.h+'px, 0px)';
    if(this.data.hasMask){
        var compSvg = document.createElementNS(svgNS,'svg');
        styleDiv(compSvg);
        compSvg.setAttribute('width',this.data.w);
        compSvg.setAttribute('height',this.data.h);
        var g = document.createElementNS(svgNS,'g');
        compSvg.appendChild(g);
        divElement.appendChild(compSvg);
        this.maskedElement = g;
        this.baseElement = divElement;
        this.layerElement = g;
        this.transformedElement = divElement;
    }else{
        this.layerElement = divElement;
        this.baseElement = this.layerElement;
        this.transformedElement = divElement;
    }
    //this.appendNodeToParent(this.layerElement);
    this.checkParenting();
};

HCompElement.prototype.hide = ICompElement.prototype.hide;
HCompElement.prototype.prepareFrame = ICompElement.prototype.prepareFrame;
HCompElement.prototype.setElements = ICompElement.prototype.setElements;
HCompElement.prototype.getElements = ICompElement.prototype.getElements;
HCompElement.prototype.destroy = ICompElement.prototype.destroy;

HCompElement.prototype.renderFrame = function(parentMatrix){
    var renderParent = this._parent.renderFrame.call(this,parentMatrix);
    var i,len = this.layers.length;
    if(renderParent===false){
        this.hide();
        return;
    }

    this.hidden = false;

    for( i = 0; i < len; i+=1 ){
        if(this.completeLayers || this.elements[i]){
            this.elements[i].renderFrame();
        }
    }
    if(this.firstFrame){
        this.firstFrame = false;
    }
};

HCompElement.prototype.checkLayers = BaseRenderer.prototype.checkLayers;
HCompElement.prototype.buildItem = HybridRenderer.prototype.buildItem;
HCompElement.prototype.checkPendingElements = HybridRenderer.prototype.checkPendingElements;
HCompElement.prototype.addPendingElement = HybridRenderer.prototype.addPendingElement;
HCompElement.prototype.buildAllItems = BaseRenderer.prototype.buildAllItems;
HCompElement.prototype.createItem = HybridRenderer.prototype.createItem;
HCompElement.prototype.buildElementParenting = HybridRenderer.prototype.buildElementParenting;
HCompElement.prototype.createImage = HybridRenderer.prototype.createImage;
HCompElement.prototype.createComp = HybridRenderer.prototype.createComp;
HCompElement.prototype.createSolid = HybridRenderer.prototype.createSolid;
HCompElement.prototype.createShape = HybridRenderer.prototype.createShape;
HCompElement.prototype.createText = HybridRenderer.prototype.createText;
HCompElement.prototype.createBase = HybridRenderer.prototype.createBase;
HCompElement.prototype.appendElementInPos = HybridRenderer.prototype.appendElementInPos;
function HShapeElement(data,parentContainer,globalData,comp, placeholder){
    this.shapes = [];
    this.shapesData = data.shapes;
    this.stylesList = [];
    this.itemsData = [];
    this.prevViewData = [];
    this.shapeModifiers = [];
    this.processedElements = [];
    this._parent.constructor.call(this,data,parentContainer,globalData,comp, placeholder);
    this.currentBBox = {
        x:999999,
        y: -999999,
        h: 0,
        w: 0
    };
}
createElement(HBaseElement, HShapeElement);
var parent = HShapeElement.prototype._parent;
extendPrototype(IShapeElement, HShapeElement);
HShapeElement.prototype._parent = parent;
HShapeElement.prototype._renderShapeFrame = HShapeElement.prototype.renderFrame;

HShapeElement.prototype.createElements = function(){
    var parent = document.createElement('div');
    styleDiv(parent);
    var cont = document.createElementNS(svgNS,'svg');
    styleDiv(cont);
    var size = this.comp.data ? this.comp.data : this.globalData.compSize;
    cont.setAttribute('width',size.w);
    cont.setAttribute('height',size.h);
    if(this.data.hasMask){
        var g = document.createElementNS(svgNS,'g');
        parent.appendChild(cont);
        cont.appendChild(g);
        this.maskedElement = g;
        this.layerElement = g;
        this.shapesContainer = g;
    }else{
        parent.appendChild(cont);
        this.layerElement = cont;
        this.shapesContainer = document.createElementNS(svgNS,'g');
        this.layerElement.appendChild(this.shapesContainer);
    }
    if(!this.data.hd){
        //this.parentContainer.appendChild(parent);
        this.baseElement = parent;
    }
    this.innerElem = parent;
    if(this.data.ln){
        this.innerElem.setAttribute('id',this.data.ln);
    }

    this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,this.layerElement,this.dynamicProperties,0, [], true);
    this.buildExpressionInterface();
    this.layerElement = parent;
    this.transformedElement = parent;
    this.shapeCont = cont;
    if(this.data.bm !== 0){
        this.setBlendMode();
    }
    this.checkParenting();
};

HShapeElement.prototype.renderFrame = function(parentMatrix){
    var firstFrame = this.firstFrame;
    this._renderShapeFrame();

    if(this.isVisible && (this.elemMdf || firstFrame)){
        var boundingBox = this.shapeCont.getBBox();
        var changed = false;
        if(this.currentBBox.w !== boundingBox.width){
            this.currentBBox.w = boundingBox.width;
            this.shapeCont.setAttribute('width',boundingBox.width);
            changed = true;
        }
        if(this.currentBBox.h !== boundingBox.height){
            this.currentBBox.h = boundingBox.height;
            this.shapeCont.setAttribute('height',boundingBox.height);
            changed = true;
        }
        if(changed  || this.currentBBox.x !== boundingBox.x  || this.currentBBox.y !== boundingBox.y){
            this.currentBBox.w = boundingBox.width;
            this.currentBBox.h = boundingBox.height;
            this.currentBBox.x = boundingBox.x;
            this.currentBBox.y = boundingBox.y;

            this.shapeCont.setAttribute('viewBox',this.currentBBox.x+' '+this.currentBBox.y+' '+this.currentBBox.w+' '+this.currentBBox.h);
            this.shapeCont.style.transform = this.shapeCont.style.webkitTransform = 'translate(' + this.currentBBox.x + 'px,' + this.currentBBox.y + 'px)';
        }
    }

};
function HTextElement(data,parentContainer,globalData,comp, placeholder){
    this.textSpans = [];
    this.textPaths = [];
    this.currentBBox = {
        x:999999,
        y: -999999,
        h: 0,
        w: 0
    }
    this.renderType = 'svg';
    this.isMasked = false;
    this._parent.constructor.call(this,data,parentContainer,globalData,comp, placeholder);

}
createElement(HBaseElement, HTextElement);

HTextElement.prototype.init = ITextElement.prototype.init;
HTextElement.prototype.getMeasures = ITextElement.prototype.getMeasures;
HTextElement.prototype.createPathShape = ITextElement.prototype.createPathShape;
HTextElement.prototype.prepareFrame = ITextElement.prototype.prepareFrame;
HTextElement.prototype.buildShapeString = ITextElement.prototype.buildShapeString;

HTextElement.prototype.createElements = function(){
    this.isMasked = this.checkMasks();
    var parent = document.createElement('div');
    styleDiv(parent);
    this.layerElement = parent;
    this.transformedElement = parent;
    if(this.isMasked){
        this.renderType = 'svg';
        var cont = document.createElementNS(svgNS,'svg');
        styleDiv(cont);
        this.cont = cont;
        this.compW = this.comp.data.w;
        this.compH = this.comp.data.h;
        cont.setAttribute('width',this.compW);
        cont.setAttribute('height',this.compH);
        var g = document.createElementNS(svgNS,'g');
        cont.appendChild(g);
        parent.appendChild(cont);
        this.maskedElement = g;
        this.innerElem = g;
    } else {
        this.renderType = 'html';
        this.innerElem = parent;
    }
    this.baseElement = parent;

    this.checkParenting();

};

HTextElement.prototype.buildNewText = function(){
    var documentData = this.currentTextDocumentData;
    this.renderedLetters = Array.apply(null,{length:this.currentTextDocumentData.l ? this.currentTextDocumentData.l.length : 0});
    if(documentData.fc) {
        this.innerElem.style.color = this.innerElem.style.fill = 'rgb(' + Math.round(documentData.fc[0]*255) + ',' + Math.round(documentData.fc[1]*255) + ',' + Math.round(documentData.fc[2]*255) + ')';
        ////this.innerElem.setAttribute('fill', 'rgb(' + documentData.fc[0] + ',' + documentData.fc[1] + ',' + documentData.fc[2] + ')');
    }else{
        this.innerElem.style.color = this.innerElem.style.fill = 'rgba(0,0,0,0)';
        ////this.innerElem.setAttribute('fill', 'rgba(0,0,0,0)');
    }
    if(documentData.sc){
        ////this.innerElem.setAttribute('stroke', 'rgb(' + documentData.sc[0] + ',' + documentData.sc[1] + ',' + documentData.sc[2] + ')');
        this.innerElem.style.stroke = 'rgb(' + Math.round(documentData.sc[0]*255) + ',' + Math.round(documentData.sc[1]*255) + ',' + Math.round(documentData.sc[2]*255) + ')';
        ////this.innerElem.setAttribute('stroke-width', documentData.sw);
        this.innerElem.style.strokeWidth = documentData.sw+'px';
    }
    ////this.innerElem.setAttribute('font-size', documentData.s);
    var fontData = this.globalData.fontManager.getFontByName(documentData.f);
    if(!this.globalData.fontManager.chars){
        this.innerElem.style.fontSize = documentData.s+'px';
        this.innerElem.style.lineHeight = documentData.s+'px';
        if(fontData.fClass){
            this.innerElem.className = fontData.fClass;
        } else {
            ////this.innerElem.setAttribute('font-family', fontData.fFamily);
            this.innerElem.style.fontFamily = fontData.fFamily;
            var fWeight = documentData.fWeight, fStyle = documentData.fStyle;
            ////this.innerElem.setAttribute('font-style', fStyle);
            this.innerElem.style.fontStyle = fStyle;
            ////this.innerElem.setAttribute('font-weight', fWeight);
            this.innerElem.style.fontWeight = fWeight;
        }
    }
    var i, len;

    var letters = documentData.l;
    len = letters.length;
    var tSpan,tParent,tCont;
    var matrixHelper = this.mHelper;
    var shapes, shapeStr = '';
    var cnt = 0;
    for (i = 0;i < len ;i += 1) {
        if(this.globalData.fontManager.chars){
            if(!this.textPaths[cnt]){
                tSpan = document.createElementNS(svgNS,'path');
                tSpan.setAttribute('stroke-linecap', 'butt');
                tSpan.setAttribute('stroke-linejoin','round');
                tSpan.setAttribute('stroke-miterlimit','4');
            } else {
                tSpan = this.textPaths[cnt];
            }
            if(!this.isMasked){
                if(this.textSpans[cnt]){
                    tParent = this.textSpans[cnt];
                    tCont = tParent.children[0];
                } else {

                    tParent = document.createElement('div');
                    tCont = document.createElementNS(svgNS,'svg');
                    tCont.appendChild(tSpan);
                    styleDiv(tParent);
                }
            }
        }else{
            if(!this.isMasked){
                if(this.textSpans[cnt]){
                    tParent = this.textSpans[cnt];
                    tSpan = this.textPaths[cnt];
                } else {
                    tParent = document.createElement('span');
                    styleDiv(tParent);
                    tSpan = document.createElement('span');
                    styleDiv(tSpan);
                    tParent.appendChild(tSpan);
                }
            } else {
                tSpan = this.textPaths[cnt] ? this.textPaths[cnt] : document.createElementNS(svgNS,'text');
            }
        }
        //tSpan.setAttribute('visibility', 'hidden');
        if(this.globalData.fontManager.chars){
            var charData = this.globalData.fontManager.getCharData(documentData.t.charAt(i), fontData.fStyle, this.globalData.fontManager.getFontByName(documentData.f).fFamily);
            var shapeData;
            if(charData){
                shapeData = charData.data;
            } else {
                shapeData = null;
            }
            matrixHelper.reset();
            if(shapeData && shapeData.shapes){
                shapes = shapeData.shapes[0].it;
                matrixHelper.scale(documentData.s/100,documentData.s/100);
                shapeStr = this.createPathShape(matrixHelper,shapes);
                tSpan.setAttribute('d',shapeStr);
            }
            if(!this.isMasked){
                this.innerElem.appendChild(tParent);
                if(shapeData && shapeData.shapes){
                    document.body.appendChild(tCont);

                    var boundingBox = tCont.getBBox();
                    tCont.setAttribute('width',boundingBox.width);
                    tCont.setAttribute('height',boundingBox.height);
                    tCont.setAttribute('viewBox',boundingBox.x+' '+ boundingBox.y+' '+ boundingBox.width+' '+ boundingBox.height);
                    tCont.style.transform = tCont.style.webkitTransform = 'translate(' + boundingBox.x + 'px,' + boundingBox.y + 'px)';

                    letters[i].yOffset = boundingBox.y;
                    tParent.appendChild(tCont);

                } else{
                    tCont.setAttribute('width',1);
                    tCont.setAttribute('height',1);
                }
            }else{
                this.innerElem.appendChild(tSpan);
            }
        }else{
            tSpan.textContent = letters[i].val;
            tSpan.setAttributeNS("http://www.w3.org/XML/1998/namespace", "xml:space","preserve");
            if(!this.isMasked){
                this.innerElem.appendChild(tParent);
                //
                tSpan.style.transform = tSpan.style.webkitTransform = 'translate3d(0,'+ -documentData.s/1.2+'px,0)';
            } else {
                this.innerElem.appendChild(tSpan);
            }
        }
        //
        if(!this.isMasked){
            this.textSpans[cnt] = tParent;
        }else{
            this.textSpans[cnt] = tSpan;
        }
        this.textSpans[cnt].style.display = 'block';
        this.textPaths[cnt] = tSpan;
        cnt += 1;
    }
    while(cnt < this.textSpans.length){
        this.textSpans[cnt].style.display = 'none';
        cnt += 1;
    }
}

HTextElement.prototype.hide = SVGTextElement.prototype.hide;

HTextElement.prototype.renderFrame = function(parentMatrix){

    var renderParent = this._parent.renderFrame.call(this,parentMatrix);
    if(renderParent===false){
        this.hide();
        return;
    }
    if(this.hidden){
        this.hidden = false;
        this.innerElem.style.display = 'block';
        this.layerElement.style.display = 'block';
    }

    if(this.data.singleShape){
        if(!this.firstFrame && !this.lettersChangedFlag){
            return;
        } else {
            // Todo Benchmark if using this is better than getBBox
             if(this.isMasked && this.finalTransform.matMdf){
                 this.cont.setAttribute('viewBox',-this.finalTransform.mProp.p.v[0]+' '+ -this.finalTransform.mProp.p.v[1]+' '+this.compW+' '+this.compH);
                this.cont.style.transform = this.cont.style.webkitTransform = 'translate(' + -this.finalTransform.mProp.p.v[0] + 'px,' + -this.finalTransform.mProp.p.v[1] + 'px)';
             }
        }
    }

    this.getMeasures();
    if(!this.lettersChangedFlag){
        return;
    }
    var  i,len;
    var renderedLetters = this.renderedLetters;

    var letters = this.currentTextDocumentData.l;

    len = letters.length;
    var renderedLetter;
    for(i=0;i<len;i+=1){
        if(letters[i].n){
            continue;
        }
        renderedLetter = renderedLetters[i];
        if(!this.isMasked){
            this.textSpans[i].style.transform = this.textSpans[i].style.webkitTransform = renderedLetter.m;
        }else{
            this.textSpans[i].setAttribute('transform',renderedLetter.m);
        }
        ////this.textSpans[i].setAttribute('opacity',renderedLetter.o);
        this.textSpans[i].style.opacity = renderedLetter.o;
        if(renderedLetter.sw){
            this.textPaths[i].setAttribute('stroke-width',renderedLetter.sw);
        }
        if(renderedLetter.sc){
            this.textPaths[i].setAttribute('stroke',renderedLetter.sc);
        }
        if(renderedLetter.fc){
            this.textPaths[i].setAttribute('fill',renderedLetter.fc);
            this.textPaths[i].style.color = renderedLetter.fc;
        }
    }
    if(this.isVisible && (this.elemMdf || this.firstFrame)){
        if(this.innerElem.getBBox){
            var boundingBox = this.innerElem.getBBox();

            if(this.currentBBox.w !== boundingBox.width){
                this.currentBBox.w = boundingBox.width;
                this.cont.setAttribute('width',boundingBox.width);
            }
            if(this.currentBBox.h !== boundingBox.height){
                this.currentBBox.h = boundingBox.height;
                this.cont.setAttribute('height',boundingBox.height);
            }
            if(this.currentBBox.w !== boundingBox.width || this.currentBBox.h !== boundingBox.height  || this.currentBBox.x !== boundingBox.x  || this.currentBBox.y !== boundingBox.y){
                this.currentBBox.w = boundingBox.width;
                this.currentBBox.h = boundingBox.height;
                this.currentBBox.x = boundingBox.x;
                this.currentBBox.y = boundingBox.y;

                this.cont.setAttribute('viewBox',this.currentBBox.x+' '+this.currentBBox.y+' '+this.currentBBox.w+' '+this.currentBBox.h);
                this.cont.style.transform = this.cont.style.webkitTransform = 'translate(' + this.currentBBox.x + 'px,' + this.currentBBox.y + 'px)';
            }
        }
    }
    if(this.firstFrame){
        this.firstFrame = false;
    }
}


HTextElement.prototype.destroy = SVGTextElement.prototype.destroy;
function HImageElement(data,parentContainer,globalData,comp, placeholder){
    this.assetData = globalData.getAssetData(data.refId);
    this._parent.constructor.call(this,data,parentContainer,globalData,comp, placeholder);
}
createElement(HBaseElement, HImageElement);

HImageElement.prototype.createElements = function(){

    var assetPath = this.globalData.getAssetsPath(this.assetData);
    var img = new Image();

    if(this.data.hasMask){
        var parent = document.createElement('div');
        styleDiv(parent);
        var cont = document.createElementNS(svgNS,'svg');
        styleDiv(cont);
        cont.setAttribute('width',this.assetData.w);
        cont.setAttribute('height',this.assetData.h);
        parent.appendChild(cont);
        this.imageElem = document.createElementNS(svgNS,'image');
        this.imageElem.setAttribute('width',this.assetData.w+"px");
        this.imageElem.setAttribute('height',this.assetData.h+"px");
        this.imageElem.setAttributeNS('http://www.w3.org/1999/xlink','href',assetPath);
        cont.appendChild(this.imageElem);
        this.layerElement = parent;
        this.transformedElement = parent;
        this.baseElement = parent;
        this.innerElem = parent;
        this.maskedElement = this.imageElem;
    } else {
        styleDiv(img);
        this.layerElement = img;
        this.baseElement = img;
        this.innerElem = img;
        this.transformedElement = img;
    }
    img.src = assetPath;
    if(this.data.ln){
        this.innerElem.setAttribute('id',this.data.ln);
    }
    this.checkParenting();
};

HImageElement.prototype.hide = HSolidElement.prototype.hide;
HImageElement.prototype.renderFrame = HSolidElement.prototype.renderFrame;
HImageElement.prototype.destroy = HSolidElement.prototype.destroy;
function HCameraElement(data,parentContainer,globalData,comp, placeholder){
    this._parent.constructor.call(this,data,parentContainer,globalData,comp, placeholder);
    this.pe = PropertyFactory.getProp(this,data.pe,0,0,this.dynamicProperties);
    if(data.ks.p.s){
        this.px = PropertyFactory.getProp(this,data.ks.p.x,1,0,this.dynamicProperties);
        this.py = PropertyFactory.getProp(this,data.ks.p.y,1,0,this.dynamicProperties);
        this.pz = PropertyFactory.getProp(this,data.ks.p.z,1,0,this.dynamicProperties);
    }else{
        this.p = PropertyFactory.getProp(this,data.ks.p,1,0,this.dynamicProperties);
    }
    if(data.ks.a){
        this.a = PropertyFactory.getProp(this,data.ks.a,1,0,this.dynamicProperties);
    }
    if(data.ks.or.k.length && data.ks.or.k[0].to){
        var i,len = data.ks.or.k.length;
        for(i=0;i<len;i+=1){
            data.ks.or.k[i].to = null;
            data.ks.or.k[i].ti = null;
        }
    }
    this.or = PropertyFactory.getProp(this,data.ks.or,1,degToRads,this.dynamicProperties);
    this.or.sh = true;
    this.rx = PropertyFactory.getProp(this,data.ks.rx,0,degToRads,this.dynamicProperties);
    this.ry = PropertyFactory.getProp(this,data.ks.ry,0,degToRads,this.dynamicProperties);
    this.rz = PropertyFactory.getProp(this,data.ks.rz,0,degToRads,this.dynamicProperties);
    this.mat = new Matrix();
}
createElement(HBaseElement, HCameraElement);

HCameraElement.prototype.setup = function() {
    var i, len = this.comp.threeDElements.length, comp;
    for(i=0;i<len;i+=1){
        //[perspectiveElem,container]
        comp = this.comp.threeDElements[i];
        comp.perspectiveElem.style.perspective = comp.perspectiveElem.style.webkitPerspective = this.pe.v+'px';
        comp.container.style.transformOrigin = comp.container.style.mozTransformOrigin = comp.container.style.webkitTransformOrigin = "0px 0px 0px";
        comp.perspectiveElem.style.transform = comp.perspectiveElem.style.webkitTransform = 'matrix3d(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)';
    }
};

HCameraElement.prototype.createElements = function(){
};

HCameraElement.prototype.hide = function(){
};

HCameraElement.prototype.renderFrame = function(){
    var mdf = this.firstFrame;
    var i, len;
    if(this.hierarchy){
        len = this.hierarchy.length;
        for(i=0;i<len;i+=1){
            mdf = this.hierarchy[i].finalTransform.mProp.mdf ? true : mdf;
        }
    }
    if(mdf || (this.p && this.p.mdf) || (this.px && (this.px.mdf || this.py.mdf || this.pz.mdf)) || this.rx.mdf || this.ry.mdf || this.rz.mdf || this.or.mdf || (this.a && this.a.mdf)) {
        this.mat.reset();

        if(this.p){
            this.mat.translate(-this.p.v[0],-this.p.v[1],this.p.v[2]);
        }else{
            this.mat.translate(-this.px.v,-this.py.v,this.pz.v);
        }
        if(this.a){
            var diffVector = [this.p.v[0]-this.a.v[0],this.p.v[1]-this.a.v[1],this.p.v[2]-this.a.v[2]];
            var mag = Math.sqrt(Math.pow(diffVector[0],2)+Math.pow(diffVector[1],2)+Math.pow(diffVector[2],2));
            //var lookDir = getNormalizedPoint(getDiffVector(this.a.v,this.p.v));
            var lookDir = [diffVector[0]/mag,diffVector[1]/mag,diffVector[2]/mag];
            var lookLengthOnXZ = Math.sqrt( lookDir[2]*lookDir[2] + lookDir[0]*lookDir[0] );
            var m_rotationX = (Math.atan2( lookDir[1], lookLengthOnXZ ));
            var m_rotationY = (Math.atan2( lookDir[0], -lookDir[2]));
            this.mat.rotateY(m_rotationY).rotateX(-m_rotationX);

        }
        this.mat.rotateX(-this.rx.v).rotateY(-this.ry.v).rotateZ(this.rz.v);
        this.mat.rotateX(-this.or.v[0]).rotateY(-this.or.v[1]).rotateZ(this.or.v[2]);
        this.mat.translate(this.globalData.compSize.w/2,this.globalData.compSize.h/2,0);
        this.mat.translate(0,0,this.pe.v);
        if(this.hierarchy){
            var mat;
            len = this.hierarchy.length;
            for(i=0;i<len;i+=1){
                mat = this.hierarchy[i].finalTransform.mProp.iv.props;
                this.mat.transform(mat[0],mat[1],mat[2],mat[3],mat[4],mat[5],mat[6],mat[7],mat[8],mat[9],mat[10],mat[11],-mat[12],-mat[13],mat[14],mat[15]);
            }
        }
        len = this.comp.threeDElements.length;
        var comp;
        for(i=0;i<len;i+=1){
            comp = this.comp.threeDElements[i];
            comp.container.style.transform = comp.container.style.webkitTransform = this.mat.toCSS();
        }
    }
    this.firstFrame = false;
};

HCameraElement.prototype.destroy = function(){
};
var Expressions = (function(){
    var ob = {};
    ob.initExpressions = initExpressions;


    function initExpressions(animation){
        animation.renderer.compInterface = CompExpressionInterface(animation.renderer);
        animation.renderer.globalData.projectInterface.registerComposition(animation.renderer);
    }
   return ob;
}());

expressionsPlugin = Expressions;

(function addPropertyDecorator() {

    function getStaticValueAtTime() {
        return this.pv;
    }

    function getValueAtTime(frameNum, offsetTime) {
        frameNum *= this.elem.globalData.frameRate;
        var i = 0,len = this.keyframes.length- 1,dir= 1,flag = true;
        var keyData, nextKeyData;
        offsetTime = offsetTime === undefined ? this.offsetTime : 0;
        //console.log(this.offsetTime);
        var retVal = typeof this.pv === 'object' ? [this.pv.length] : 0;

        while(flag){
            keyData = this.keyframes[i];
            nextKeyData = this.keyframes[i+1];
            if(i == len-1 && frameNum >= nextKeyData.t - offsetTime){
                if(keyData.h){
                    keyData = nextKeyData;
                }
                break;
            }
            if((nextKeyData.t - offsetTime) > frameNum){
                break;
            }
            if(i < len - 1){
                i += dir;
            }else{
                flag = false;
            }
        }

        var k, kLen,perc,jLen, j = 0, fnc;
        if (keyData.to) {

            if (!keyData.bezierData) {
                bez.buildBezierData(keyData);
            }
            var bezierData = keyData.bezierData;
            if (frameNum >= nextKeyData.t-offsetTime || frameNum < keyData.t-offsetTime) {
                var ind = frameNum >= nextKeyData.t-offsetTime ? bezierData.points.length - 1 : 0;
                kLen = bezierData.points[ind].point.length;
                for(k = 0; k < kLen; k += 1){
                    retVal[k] = bezierData.points[ind].point[k];
                }
            } else {
                if (keyData.__fnct) {
                    fnc = keyData.__fnct;
                } else {
                    //fnc = bez.getEasingCurve(keyData.o.x,keyData.o.y,keyData.i.x,keyData.i.y,keyData.n);
                    fnc = BezierFactory.getBezierEasing(keyData.o.x, keyData.o.y, keyData.i.x, keyData.i.y, keyData.n).get;
                    keyData.__fnct = fnc;
                }
                perc = fnc((frameNum - (keyData.t - offsetTime)) / ((nextKeyData.t - offsetTime) - (keyData.t - offsetTime)));
                var distanceInLine = bezierData.segmentLength * perc;

                var segmentPerc;
                var addedLength = 0;
                dir = 1;
                flag = true;
                jLen = bezierData.points.length;
                while(flag) {
                    addedLength += bezierData.points[j].partialLength*dir;
                    if (distanceInLine === 0 || perc === 0 || j == bezierData.points.length - 1) {
                        kLen = bezierData.points[j].point.length;
                        for (k = 0; k < kLen; k += 1) {
                            retVal[k] = bezierData.points[j].point[k];
                        }
                        break;
                    } else if (distanceInLine >= addedLength && distanceInLine < addedLength + bezierData.points[j+1].partialLength){
                        segmentPerc = (distanceInLine - addedLength) / (bezierData.points[j + 1].partialLength);
                        kLen = bezierData.points[j].point.length;
                        for (k = 0; k < kLen; k += 1) {
                            retVal[k] = bezierData.points[j].point[k] + (bezierData.points[j+1].point[k] - bezierData.points[j].point[k]) * segmentPerc;
                        }
                        break;
                    }
                    if (j < jLen - 1 && dir == 1 || j > 0 && dir == -1) {
                        j += dir;
                    } else {
                        flag = false;
                    }
                }
            }
        } else {
            var outX,outY,inX,inY, isArray = false, keyValue;
            len = keyData.s.length;
            for(i=0;i<len;i+=1){
                if(keyData.h !== 1){
                    if(keyData.o.x instanceof Array){
                        isArray = true;
                        if(!keyData.__fnct){
                            keyData.__fnct = [];
                        }
                        if(!keyData.__fnct[i]){
                            outX = keyData.o.x[i] || keyData.o.x[0];
                            outY = keyData.o.y[i] || keyData.o.y[0];
                            inX = keyData.i.x[i] || keyData.i.x[0];
                            inY = keyData.i.y[i] || keyData.i.y[0];
                        }
                    }else{
                        isArray = false;
                        if(!keyData.__fnct) {
                            outX = keyData.o.x;
                            outY = keyData.o.y;
                            inX = keyData.i.x;
                            inY = keyData.i.y;
                        }
                    }
                    if(isArray){
                        if(keyData.__fnct[i]){
                            fnc = keyData.__fnct[i];
                        }else{
                            //fnc = bez.getEasingCurve(outX,outY,inX,inY);
                            fnc = BezierFactory.getBezierEasing(outX,outY,inX,inY).get;
                            keyData.__fnct[i] = fnc;
                        }
                    }else{
                        if(keyData.__fnct){
                            fnc = keyData.__fnct;
                        }else{
                            //fnc = bez.getEasingCurve(outX,outY,inX,inY);
                            fnc = BezierFactory.getBezierEasing(outX,outY,inX,inY).get;
                            keyData.__fnct = fnc;
                        }
                    }
                    if(frameNum >= nextKeyData.t-offsetTime){
                        perc = 1;
                    }else if(frameNum < keyData.t-offsetTime){
                        perc = 0;
                    }else{
                        perc = fnc((frameNum-(keyData.t-offsetTime))/((nextKeyData.t-offsetTime)-(keyData.t-offsetTime)));
                    }
                }
                if(this.sh && keyData.h !== 1){
                    var initP = keyData.s[i];
                    var endP = keyData.e[i];
                    if(initP-endP < -180){
                        initP += 360;
                    } else if(initP-endP > 180){
                        initP -= 360;
                    }
                    keyValue = initP+(endP-initP)*perc;
                } else {
                    keyValue = keyData.h === 1 ? keyData.s[i] : keyData.s[i]+(keyData.e[i]-keyData.s[i])*perc;
                }
                if(len === 1){
                    retVal = keyValue;
                }else{
                    retVal[i] = keyValue;
                }
            }
        }
        return retVal;
    }

    function getVelocityAtTime(frameNum) {
        if(this.vel !== undefined){
            return this.vel;
        }
        var delta = -0.01;
        //frameNum += this.elem.data.st;
        var v1 = this.getValueAtTime(frameNum, 0);
        var v2 = this.getValueAtTime(frameNum + delta, 0);
        var velocity;
        if(v1.length){
            velocity = Array.apply(null,{length:v1.length});
            var i;
            for(i=0;i<v1.length;i+=1){
                //removing frameRate
                //if needed, don't add it here
                //velocity[i] = this.elem.globalData.frameRate*((v2[i] - v1[i])/delta);
                velocity[i] = (v2[i] - v1[i])/delta;
            }
        } else {
            velocity = (v2 - v1)/delta;
        }
        return velocity;
    };

    function setGroupProperty(propertyGroup){
        this.propertyGroup = propertyGroup;
    }

    function searchExpressions(elem,data,prop){
        if(data.x){
            prop.k = true;
            prop.x = true;
            if(prop.getValue) {
                prop.getPreValue = prop.getValue;
            }
            prop.getValue = ExpressionManager.initiateExpression.bind(prop)(elem,data,prop);
        }
    }

    function getTransformValueAtTime(time) {
        console.log('time:', time)
    }

    function getTransformStaticValueAtTime(time) {

    }

    var TextExpressionSelectorProp = (function(){

        function getValueProxy(index,total){
            this.textIndex = index+1;
            this.textTotal = total;
            this.getValue();
            return this.v;
        }

        return function TextExpressionSelectorProp(elem,data){
            this.pv = 1;
            this.comp = elem.comp;
            this.elem = elem;
            this.mult = .01;
            this.type = 'textSelector';
            this.textTotal = data.totalChars;
            this.selectorValue = 100;
            this.lastValue = [1,1,1];
            searchExpressions.bind(this)(elem,data,this);
            this.getMult = getValueProxy;
            this.getVelocityAtTime = getVelocityAtTime;
            if(this.kf){
                this.getValueAtTime = getValueAtTime.bind(this);
            } else {
                this.getValueAtTime = getStaticValueAtTime.bind(this);
            }
            this.setGroupProperty = setGroupProperty;
        }
    }());


    var propertyGetProp = PropertyFactory.getProp;
    PropertyFactory.getProp = function(elem,data,type, mult, arr){
        var prop = propertyGetProp(elem,data,type, mult, arr);
        prop.getVelocityAtTime = getVelocityAtTime;
        if(type === 2) {
            if(prop.dynamicProperties.length) {
                prop.getValueAtTime = getTransformValueAtTime.bind(prop);
            } else {
                prop.getValueAtTime = getTransformStaticValueAtTime.bind(prop);
            }
        } else {
            if(prop.kf){
                prop.getValueAtTime = getValueAtTime.bind(prop);
            } else {
                prop.getValueAtTime = getStaticValueAtTime.bind(prop);
            }
        }
        prop.setGroupProperty = setGroupProperty;
        var isAdded = prop.k;
        if(data.ix !== undefined){
            Object.defineProperty(prop,'propertyIndex',{
                get: function(){
                    return data.ix;
                }
            })
        }
        searchExpressions(elem,data,prop);
        if(!isAdded && prop.x){
            arr.push(prop);
        }

        return prop;
    }

    var propertyGetShapeProp = ShapePropertyFactory.getShapeProp;
    ShapePropertyFactory.getShapeProp = function(elem,data,type, arr, trims){
        var prop = propertyGetShapeProp(elem,data,type, arr, trims);
        prop.setGroupProperty = setGroupProperty;
        if(prop.kf){
            prop.getValueAtTime = getValueAtTime;
        } else {
            prop.getValueAtTime = getStaticValueAtTime;
        }
        var isAdded = prop.k;
        if(data.ix !== undefined){
            Object.defineProperty(prop,'propertyIndex',{
                get: function(){
                    return data.ix;
                }
            })
        }
        if(type === 3){
            searchExpressions(elem,data.pt,prop);
        } else if(type === 4){
            searchExpressions(elem,data.ks,prop);
        }
        if(!isAdded && prop.x){
            arr.push(prop);
        }
        return prop;
    }

    var propertyGetTextProp = PropertyFactory.getTextSelectorProp;
    PropertyFactory.getTextSelectorProp = function(elem, data,arr){
        if(data.t === 1){
            return new TextExpressionSelectorProp(elem, data,arr);
        } else {
            return propertyGetTextProp(elem,data,arr);
        }
    }
}());
var ExpressionManager = (function(){
    var ob = {};
    var Math = BMMath;
    var window = null;
    var document = null;

    function duplicatePropertyValue(value, mult){
        mult = mult || 1;

        if(typeof value === 'number'  || value instanceof Number){
            return value*mult;
        }else if(value.i){
            return JSON.parse(JSON.stringify(value));
        }else{
            var arr = Array.apply(null,{length:value.length});
            var i, len = value.length;
            for(i=0;i<len;i+=1){
                arr[i]=value[i]*mult;
            }
            return arr;
        }
    }

    function shapesEqual(shape1, shape2) {
        if(shape1._length !== shape2._length || shape1.c !== shape2.c){
            return false;
        }
        var i, len = shape1._length;
        for(i = 0; i < len; i += 1) {
            if(shape1.v[i][0] !== shape2.v[i][0] || shape1.v[i][1] !== shape2.v[i][1]
                || shape1.o[i][0] !== shape2.o[i][0] || shape1.o[i][1] !== shape2.o[i][1]
                || shape1.i[i][0] !== shape2.i[i][0] || shape1.i[i][1] !== shape2.i[i][1]){
                return false;
            }
        }
        return true;
    }

    function $bm_neg(a){
        var tOfA = typeof a;
        if(tOfA === 'number' || tOfA === 'boolean'  || a instanceof Number ){
            return -a;
        }
        if(a.constructor === Array){
            var i, lenA = a.length;
            var retArr = [];
            for(i=0;i<lenA;i+=1){
                retArr[i] = -a[i];
            }
            return retArr;
        }
    }

    function sum(a,b) {
        var tOfA = typeof a;
        var tOfB = typeof b;
        if(tOfA === 'string' || tOfB === 'string'){
            return a + b;
        }
        if((tOfA === 'number' || tOfA === 'boolean' || tOfA === 'string' || a instanceof Number) && (tOfB === 'number' || tOfB === 'boolean' || tOfB === 'string'  || b instanceof Number)) {
            return a + b;
        }
        if(a.constructor === Array && (tOfB === 'number' || tOfB === 'boolean' || tOfB === 'string' || b instanceof Number )){
            a[0] = a[0] + b;
            return a;
        }
        if((tOfA === 'number' || tOfA === 'boolean' || tOfA === 'string' || a instanceof Number ) && b.constructor === Array){
            b[0] = a + b[0];
            return b;
        }
        if(a.constructor === Array && b.constructor === Array){
            
            var i = 0, lenA = a.length, lenB = b.length;
            var retArr = [];
            while(i<lenA || i < lenB){
                if((typeof a[i] === 'number' || a[i] instanceof Number) && (typeof b[i] === 'number' || b[i] instanceof Number)){
                    retArr[i] = a[i] + b[i];
                }else{
                    retArr[i] = b[i] == undefined ? a[i] : a[i] || b[i];
                }
                i += 1;
            }
            return retArr;
        }
        return 0;
    }
    var add = sum;

    function sub(a,b) {
        var tOfA = typeof a;
        var tOfB = typeof b;
        if((tOfA === 'number' || tOfA === 'boolean' || tOfA === 'string' || a instanceof Number ) && (tOfB === 'number' || tOfB === 'boolean' || tOfB === 'string' || b instanceof Number )) {
            return a - b;
        }
        if( a.constructor === Array && (tOfB === 'number' || tOfB === 'boolean' || tOfB === 'string' || b instanceof Number )){
            a[0] = a[0] - b;
            return a;
        }
        if((tOfA === 'number' || tOfA === 'boolean' || tOfA === 'string' || a instanceof Number ) &&  b.constructor === Array){
            b[0] = a - b[0];
            return b;
        }
        if(a.constructor === Array && b.constructor === Array){
            var i = 0, lenA = a.length, lenB = b.length;
            var retArr = [];
            while(i<lenA || i < lenB){
                if((typeof a[i] === 'number' || a[i] instanceof Number) && typeof (typeof b[i] === 'number' || b[i] instanceof Number)){
                    retArr[i] = a[i] - b[i];
                }else{
                    retArr[i] = b[i] == undefined ? a[i] : a[i] || b[i];
                }
                i += 1;
            }
            return retArr;
        }
        return 0;
    }

    function mul(a,b) {
        var tOfA = typeof a;
        var tOfB = typeof b;
        var arr;
        if((tOfA === 'number' || tOfA === 'boolean' || tOfA === 'string' || a instanceof Number ) && (tOfB === 'number' || tOfB === 'boolean' || tOfB === 'string' || b instanceof Number )) {
            return a * b;
        }

        var i, len;
        if(a.constructor === Array && (tOfB === 'number' || tOfB === 'boolean' || tOfB === 'string' || b instanceof Number )){
            len = a.length;
            arr = Array.apply(null,{length:len});
            for(i=0;i<len;i+=1){
                arr[i] = a[i] * b;
            }
            return arr;
        }
        if((tOfA === 'number' || tOfA === 'boolean' || tOfA === 'string' || a instanceof Number ) && b.constructor === Array){
            len = b.length;
            arr = Array.apply(null,{length:len});
            for(i=0;i<len;i+=1){
                arr[i] = a * b[i];
            }
            return arr;
        }
        return 0;
    }

    function div(a,b) {
        var tOfA = typeof a;
        var tOfB = typeof b;
        var arr;
        if((tOfA === 'number' || tOfA === 'boolean' || tOfA === 'string' || a instanceof Number ) && (tOfB === 'number' || tOfB === 'boolean' || tOfB === 'string' || b instanceof Number )) {
            return a / b;
        }
        var i, len;
        if(a.constructor === Array && (tOfB === 'number' || tOfB === 'boolean' || tOfB === 'string' || b instanceof Number  )){
            len = a.length;
            arr = Array.apply(null,{length:len});
            for(i=0;i<len;i+=1){
                arr[i] = a[i] / b;
            }
            return arr;
        }
        if((tOfA === 'number' || tOfA === 'boolean' || tOfA === 'string' || a instanceof Number ) && b.constructor === Array){
            len = b.length;
            arr = Array.apply(null,{length:len});
            for(i=0;i<len;i+=1){
                arr[i] = a / b[i];
            }
            return arr;
        }
        return 0;
    }

    function clamp(num, min, max) {
        if(min > max){
            var mm = max;
            max = min;
            min = mm;
        }
        return Math.min(Math.max(num, min), max);
    }

    function radiansToDegrees(val) {
        return val/degToRads;
    }
    var radians_to_degrees = radiansToDegrees;

    function degreesToRadians(val) {
        return val*degToRads;
    }
    var degrees_to_radians = radiansToDegrees;

    var helperLengthArray = [0,0,0,0,0,0];

    function length(arr1,arr2){
        if(typeof arr1 === "number"){
            arr2 = arr2 || 0;
            return Math.abs(arr1 - arr2);
        }
        if(!arr2){
            arr2 = helperLengthArray;
        }
        var i,len = Math.min(arr1.length,arr2.length);
        var addedLength = 0;
        for(i=0;i<len;i+=1){
            addedLength += Math.pow(arr2[i]-arr1[i],2);
        }
        return Math.sqrt(addedLength);
    }

    function normalize(vec){
        return div(vec, length(vec));
    }

    function rgbToHsl(val){
        var r = val[0]; var g = val[1]; var b = val[2];
        var max = Math.max(r, g, b), min = Math.min(r, g, b);
        var h, s, l = (max + min) / 2;

        if(max == min){
            h = s = 0; // achromatic
        }else{
            var d = max - min;
            s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
            switch(max){
                case r: h = (g - b) / d + (g < b ? 6 : 0); break;
                case g: h = (b - r) / d + 2; break;
                case b: h = (r - g) / d + 4; break;
            }
            h /= 6;
        }

        return [h, s, l,val[3]];
    }
    function hslToRgb(val){
        var h = val[0];
        var s = val[1];
        var l = val[2];

        var r, g, b;

        if(s == 0){
            r = g = b = l; // achromatic
        }else{
            function hue2rgb(p, q, t){
                if(t < 0) t += 1;
                if(t > 1) t -= 1;
                if(t < 1/6) return p + (q - p) * 6 * t;
                if(t < 1/2) return q;
                if(t < 2/3) return p + (q - p) * (2/3 - t) * 6;
                return p;
            }

            var q = l < 0.5 ? l * (1 + s) : l + s - l * s;
            var p = 2 * l - q;
            r = hue2rgb(p, q, h + 1/3);
            g = hue2rgb(p, q, h);
            b = hue2rgb(p, q, h - 1/3);
        }

        return [r, g , b, val[3]];
    }

    function linear(t, tMin, tMax, value1, value2){
        if(value1 === undefined || value2 === undefined){
            return linear(t,0,1,tMin,tMax);
        }
        if(t <= tMin) {
            return value1;
        }else if(t >= tMax){
            return value2;
        }
        var perc = tMax === tMin ? 0 : (t-tMin)/(tMax-tMin);
        if(!value1.length){
            return value1 + (value2-value1)*perc;
        }
        var i, len = value1.length;
        var arr = Array.apply( null, { length: len } );
        for(i=0;i<len;i+=1){
            arr[i] = value1[i] + (value2[i]-value1[i])*perc;
        }
        return arr;
    }
    function random(min,max){
        if(max === undefined){
            if(min === undefined){
                min = 0;
                max = 1;
            } else {
                max = min;
                min = undefined;
            }
        }
        if(max.length){
            var i, len = max.length;
            if(!min){
                min = Array.apply(null,{length:len});
            }
            var arr = Array.apply(null,{length:len});
            var rnd = BMMath.random();
            for(i=0;i<len;i+=1){
                arr[i] = min[i] + rnd*(max[i]-min[i])
            }
            return arr;
        }
        if(min === undefined){
            min = 0;
        }
        var rndm = BMMath.random();
        return min + rndm*(max-min);
    }

    function initiateExpression(elem,data,property){
        var val = data.x;
        var needsVelocity = /velocity(?![\w\d])/.test(val);
        var _needsRandom = val.indexOf('random') !== -1;
        var elemType = elem.data.ty;
        var transform,content,effect;
        var thisComp = elem.comp;
        var thisProperty = property;
        elem.comp.frameDuration = 1/elem.comp.globalData.frameRate;
        var inPoint = elem.data.ip/elem.comp.globalData.frameRate;
        var outPoint = elem.data.op/elem.comp.globalData.frameRate;
        var width = elem.data.sw ? elem.data.sw : 0;
        var height = elem.data.sh ? elem.data.sh : 0;
        var toWorld,fromWorld,anchorPoint,thisLayer,thisComp;
        var fn = new Function();
        //var fnStr = 'var fn = function(){'+val+';this.v = $bm_rt;}';
        //eval(fnStr);

        var fn = eval('[function(){' + val+';this.v = $bm_rt;}' + ']')[0];
        var bindedFn = fn.bind(this);
        var numKeys = property.kf ? data.k.length : 0;

        var wiggle = function wiggle(freq,amp){
            var i,j, len = this.pv.length ? this.pv.length : 1;
            var addedAmps = Array.apply(null,{len:len});
            for(j=0;j<len;j+=1){
                addedAmps[j] = 0;
            }
            freq = 5;
            var iterations = Math.floor(time*freq);
            i = 0;
            j = 0;
            while(i<iterations){
                //var rnd = BMMath.random();
                for(j=0;j<len;j+=1){
                    addedAmps[j] += -amp + amp*2*BMMath.random();
                    //addedAmps[j] += -amp + amp*2*rnd;
                }
                i += 1;
            }
            //var rnd2 = BMMath.random();
            var periods = time*freq;
            var perc = periods - Math.floor(periods);
            var arr = Array.apply({length:len});
            if(len>1){
                for(j=0;j<len;j+=1){
                    arr[j] = this.pv[j] + addedAmps[j] + (-amp + amp*2*BMMath.random())*perc;
                    //arr[j] = this.pv[j] + addedAmps[j] + (-amp + amp*2*rnd)*perc;
                    //arr[i] = this.pv[i] + addedAmp + amp1*perc + amp2*(1-perc);
                }
                return arr;
            } else {
                return this.pv + addedAmps[0] + (-amp + amp*2*BMMath.random())*perc;
            }
        }.bind(this);

        var loopIn = function loopIn(type,duration, durationFlag) {
            if(!this.k){
                return this.pv;
            }
            var currentFrame = time*elem.comp.globalData.frameRate;
            var keyframes = this.keyframes;
            var firstKeyFrame = keyframes[0].t;
            if(currentFrame>=firstKeyFrame){
                return this.pv;
            }else{
                var cycleDuration, lastKeyFrame;
                if(!durationFlag){
                    if(!duration || duration > keyframes.length - 1){
                        duration = keyframes.length - 1;
                    }
                    lastKeyFrame = keyframes[duration].t;
                    cycleDuration = lastKeyFrame - firstKeyFrame;
                } else {
                    if(!duration){
                        cycleDuration = Math.max(0,this.elem.data.op - firstKeyFrame);
                    } else {
                        cycleDuration = Math.abs(elem.comp.globalData.frameRate*duration);
                    }
                    lastKeyFrame = firstKeyFrame + cycleDuration;
                }
                var i, len, ret;
                if(type === 'pingpong') {
                    var iterations = Math.floor((firstKeyFrame - currentFrame)/cycleDuration);
                    if(iterations % 2 === 0){
                        return this.getValueAtTime(((firstKeyFrame - currentFrame)%cycleDuration +  firstKeyFrame) / this.comp.globalData.frameRate, 0);
                    }
                } else if(type === 'offset'){
                    var initV = this.getValueAtTime(firstKeyFrame / this.comp.globalData.frameRate, 0);
                    var endV = this.getValueAtTime(lastKeyFrame / this.comp.globalData.frameRate, 0);
                    var current = this.getValueAtTime((cycleDuration - (firstKeyFrame - currentFrame)%cycleDuration +  firstKeyFrame) / this.comp.globalData.frameRate, 0);
                    var repeats = Math.floor((firstKeyFrame - currentFrame)/cycleDuration)+1;
                    if(this.pv.length){
                        ret = new Array(initV.length);
                        len = ret.length;
                        for(i=0;i<len;i+=1){
                            ret[i] = current[i]-(endV[i]-initV[i])*repeats;
                        }
                        return ret;
                    }
                    return current-(endV-initV)*repeats;
                } else if(type === 'continue'){
                    var firstValue = this.getValueAtTime(firstKeyFrame / this.comp.globalData.frameRate, 0);
                    var nextFirstValue = this.getValueAtTime((firstKeyFrame + 0.001) / this.comp.globalData.frameRate, 0);
                    if(this.pv.length){
                        ret = new Array(firstValue.length);
                        len = ret.length;
                        for(i=0;i<len;i+=1){
                            ret[i] = firstValue[i] + (firstValue[i]-nextFirstValue[i])*(firstKeyFrame - currentFrame)/0.001;
                        }
                        return ret;
                    }
                    return firstValue + (firstValue-nextFirstValue)*(firstKeyFrame - currentFrame)/0.001;
                }
                return this.getValueAtTime((cycleDuration - (firstKeyFrame - currentFrame) % cycleDuration +  firstKeyFrame) / this.comp.globalData.frameRate, 0);
            }
        }.bind(this);

        var loopInDuration = function loopInDuration(type,duration){
            return loopIn(type,duration,true);
        }.bind(this);

        var loopOut = function loopOut(type,duration,durationFlag){
            if(!this.k || !this.keyframes){
                return this.pv;
            }
            var currentFrame = time*elem.comp.globalData.frameRate;
            var keyframes = this.keyframes;
            var lastKeyFrame = keyframes[keyframes.length - 1].t;
            if(currentFrame<=lastKeyFrame){
                return this.pv;
            }else{
                var cycleDuration, firstKeyFrame;
                if(!durationFlag){
                    if(!duration || duration > keyframes.length - 1){
                        duration = keyframes.length - 1;
                    }
                    firstKeyFrame = keyframes[keyframes.length - 1 - duration].t;
                    cycleDuration = lastKeyFrame - firstKeyFrame;
                } else {
                    if(!duration){
                        cycleDuration = Math.max(0,lastKeyFrame - this.elem.data.ip);
                    } else {
                        cycleDuration = Math.abs(lastKeyFrame - elem.comp.globalData.frameRate*duration);
                    }
                    firstKeyFrame = lastKeyFrame - cycleDuration;
                }
                var i, len, ret;
                if(type === 'pingpong') {
                    var iterations = Math.floor((currentFrame - firstKeyFrame)/cycleDuration);
                    if(iterations % 2 !== 0){
                        return this.getValueAtTime((cycleDuration - (currentFrame - firstKeyFrame) % cycleDuration +  firstKeyFrame) / this.comp.globalData.frameRate, 0);
                    }
                } else if(type === 'offset'){
                    var initV = this.getValueAtTime(firstKeyFrame / this.comp.globalData.frameRate, 0);
                    var endV = this.getValueAtTime(lastKeyFrame / this.comp.globalData.frameRate, 0);
                    var current = this.getValueAtTime(((currentFrame - firstKeyFrame) % cycleDuration +  firstKeyFrame) / this.comp.globalData.frameRate, 0);
                    var repeats = Math.floor((currentFrame - firstKeyFrame)/cycleDuration);
                    if(this.pv.length){
                        ret = new Array(initV.length);
                        len = ret.length;
                        for(i=0;i<len;i+=1){
                            ret[i] = (endV[i]-initV[i])*repeats + current[i];
                        }
                        return ret;
                    }
                    return (endV-initV)*repeats + current;
                } else if(type === 'continue'){
                    var lastValue = this.getValueAtTime(lastKeyFrame / this.comp.globalData.frameRate, 0);
                    var nextLastValue = this.getValueAtTime((lastKeyFrame - 0.001) / this.comp.globalData.frameRate, 0);
                    if(this.pv.length){
                        ret = new Array(lastValue.length);
                        len = ret.length;
                        for(i=0;i<len;i+=1){
                            ret[i] = lastValue[i] + (lastValue[i]-nextLastValue[i])*((currentFrame - lastKeyFrame)/ this.comp.globalData.frameRate)/0.0005;
                        }
                        return ret;
                    }
                    return lastValue + (lastValue-nextLastValue)*(((currentFrame - lastKeyFrame))/0.001);
                }
                return this.getValueAtTime(((currentFrame - firstKeyFrame) % cycleDuration +  firstKeyFrame) / this.comp.globalData.frameRate, 0);
            }
        }.bind(this);
        var loop_out = loopOut;

        var loopOutDuration = function loopOutDuration(type,duration){
            return loopOut(type,duration,true);
        }.bind(this);

        var valueAtTime = function valueAtTime(t) {
            return this.getValueAtTime(t, 0);
        }.bind(this);

        var velocityAtTime = function velocityAtTime(t) {
            return this.getVelocityAtTime(t);
        }.bind(this);

        var comp = elem.comp.globalData.projectInterface.bind(elem.comp.globalData.projectInterface);

        function lookAt(elem1,elem2){
            var fVec = [elem2[0]-elem1[0],elem2[1]-elem1[1],elem2[2]-elem1[2]];
            var pitch = Math.atan2(fVec[0],Math.sqrt(fVec[1]*fVec[1]+fVec[2]*fVec[2]))/degToRads;
            var yaw = -Math.atan2(fVec[1],fVec[2])/degToRads;
            return [yaw,pitch,0];
        };

        function easeOut(t, val1, val2){
            return -(val2-val1) * t*(t-2) + val1;
        };

        function nearestKey(time){
            var i, len = data.k.length,index,keyTime;
            if(!data.k.length || typeof(data.k[0]) === 'number'){
                index = 0;
                keyTime = 0;
            } else {
                index = -1;
                time *= elem.comp.globalData.frameRate;
                if (time < data.k[0].t) {
                    index = 1;
                    keyTime = data.k[0].t;
                } else {
                    for(i=0;i<len-1;i+=1){
                        if(time === data.k[i].t){
                            index = i + 1;
                            keyTime = data.k[i].t;
                            break;
                        }else if(time>data.k[i].t && time<data.k[i+1].t){
                            if(time-data.k[i].t > data.k[i+1].t - time){
                                index = i + 2;
                                keyTime = data.k[i+1].t;
                            } else {
                                index = i + 1;
                                keyTime = data.k[i].t;
                            }
                            break;
                        }
                    }
                    if(index === -1){
                        index = i + 1;
                        keyTime = data.k[i].t;
                    }
                }
                
            }
            var ob = {};
            ob.index = index;
            ob.time = keyTime/elem.comp.globalData.frameRate;
            return ob;
        };

        function key(ind){
            if(!data.k.length || typeof(data.k[0]) === 'number'){
                return {time:0};
            }
            ind -= 1;
            var ob = {
                time: data.k[ind].t/elem.comp.globalData.frameRate
            };
            var arr;
            if(ind === data.k.length - 1 && !data.k[ind].h){
                arr = data.k[ind-1].e;
            }else{
                arr = data.k[ind].s;
            }
            var i, len = arr.length;
            for(i=0;i<len;i+=1){
                ob[i] = arr[i];
            }
            return ob;
        };

        function framesToTime(frames,fps){
            if(!fps){
                fps = elem.comp.globalData.frameRate;
            }
            return frames/fps;
        };

        function timeToFrames(t,fps){
            if(!t){
                t = time;
            }
            if(!fps){
                fps = elem.comp.globalData.frameRate;
            }
            return t*fps;
        };

        function seedRandom(seed){
            BMMath.seedrandom(randSeed + seed);
        };

        var time,velocity, value,textIndex,textTotal,selectorValue;
        var index = elem.data.ind;
        var hasParent = !!(elem.hierarchy && elem.hierarchy.length);
        var parent;
        var randSeed = Math.floor(Math.random()*1000000);
        function execute(){
            if(_needsRandom){
                seedRandom(randSeed);
            }
            if(this.frameExpressionId === elem.globalData.frameId && this.type !== 'textSelector'){
                return;
            }
            if(this.lock){
                this.v = duplicatePropertyValue(this.pv,this.mult);
                return true;
            }
            if(this.type === 'textSelector'){
                textIndex = this.textIndex;
                textTotal = this.textTotal;
                selectorValue = this.selectorValue;
            }
            if(!thisLayer){
                thisLayer = elem.layerInterface;
                thisComp = elem.comp.compInterface;
                toWorld = thisLayer.toWorld.bind(thisLayer);
                fromWorld = thisLayer.fromWorld.bind(thisLayer);
            }
            if(!transform){
                transform = elem.layerInterface("ADBE Transform Group");
                anchorPoint = transform.anchorPoint;
            }
            
            if(elemType === 4 && !content){
                content = thisLayer("ADBE Root Vectors Group");
            }
            if(!effect){
                effect = thisLayer(4);
            }
            hasParent = !!(elem.hierarchy && elem.hierarchy.length);
            if(hasParent && !parent){
                parent = elem.hierarchy[0].layerInterface;
            }
            this.lock = true;
            if(this.getPreValue){
                this.getPreValue();
            }
            value = this.pv;
            time = this.comp.renderedFrame/this.comp.globalData.frameRate;
            if(needsVelocity){
                velocity = velocityAtTime(time);
            }
            bindedFn();
            this.frameExpressionId = elem.globalData.frameId;
            var i,len;
            if(this.mult){
                if(typeof this.v === 'number' || this.v instanceof Number || typeof this.v === 'string'){
                    this.v *= this.mult;
                }else if(this.v.length === 1){
                    this.v = this.v[0] * this.mult;
                }else{
                    len = this.v.length;
                    if(value === this.v){
                        this.v = len === 2 ? [value[0],value[1]] : [value[0],value[1],value[2]];
                    }
                    for(i = 0; i < len; i += 1){
                        this.v[i] *= this.mult;
                    }
                }
            }

            if(this.v.length === 1){
                this.v = this.v[0];
            }
            if(typeof this.v === 'number' || this.v instanceof Number || typeof this.v === 'string'){
                if(this.lastValue !== this.v){
                    this.lastValue = this.v;
                    this.mdf = true;
                }
            }else if(this.v._length){
                if(!shapesEqual(this.v,this.localShapeCollection.shapes[0])){
                    this.mdf = true;
                    this.localShapeCollection.releaseShapes();
                    this.localShapeCollection.addShape(shape_pool.clone(this.v));
                }
            }else{
                len = this.v.length;
                for(i = 0; i < len; i += 1){
                    if(this.v[i] !== this.lastValue[i]){
                        this.lastValue[i] = this.v[i];
                        this.mdf = true;
                    }
                }
            }
            this.lock = false;
        }
        return execute;
    };

    ob.initiateExpression = initiateExpression;
    return ob;
}());
var ShapeExpressionInterface = (function(){
    var ob = {
        createShapeInterface:createShapeInterface,
        createGroupInterface:createGroupInterface,
        createTrimInterface:createTrimInterface,
        createStrokeInterface:createStrokeInterface,
        createTransformInterface:createTransformInterface,
        createEllipseInterface:createEllipseInterface,
        createStarInterface:createStarInterface,
        createRectInterface:createRectInterface,
        createRoundedInterface:createRoundedInterface,
        createRepatearInterface:createRepatearInterface,
        createPathInterface:createPathInterface,
        createFillInterface:createFillInterface
    };
    function createShapeInterface(shapes,view,propertyGroup){
        return shapeInterfaceFactory(shapes,view,propertyGroup);
    }
    function createGroupInterface(shapes,view,propertyGroup){
        return groupInterfaceFactory(shapes,view,propertyGroup);
    }
    function createFillInterface(shape,view,propertyGroup){
        return fillInterfaceFactory(shape,view,propertyGroup);
    }
    function createStrokeInterface(shape,view,propertyGroup){
        return strokeInterfaceFactory(shape,view,propertyGroup);
    }
    function createTrimInterface(shape,view,propertyGroup){
        return trimInterfaceFactory(shape,view,propertyGroup);
    }
    function createTransformInterface(shape,view,propertyGroup){
        return transformInterfaceFactory(shape,view,propertyGroup);
    }
    function createEllipseInterface(shape,view,propertyGroup){
        return ellipseInterfaceFactory(shape,view,propertyGroup);
    }
    function createStarInterface(shape,view,propertyGroup){
        return starInterfaceFactory(shape,view,propertyGroup);
    }
    function createRectInterface(shape,view,propertyGroup){
        return rectInterfaceFactory(shape,view,propertyGroup);
    }
    function createRoundedInterface(shape,view,propertyGroup){
        return roundedInterfaceFactory(shape,view,propertyGroup);
    }
    function createRepatearInterface(shape,view,propertyGroup){
        return repeaterInterfaceFactory(shape,view,propertyGroup);
    }
    function createPathInterface(shape,view,propertyGroup){
        return pathInterfaceFactory(shape,view,propertyGroup);
    }

    function iterateElements(shapes,view, propertyGroup){
        var arr = [];
        var i, len = shapes ? shapes.length : 0;
        for(i=0;i<len;i+=1){
            if(shapes[i].ty == 'gr'){
                arr.push(ShapeExpressionInterface.createGroupInterface(shapes[i],view[i],propertyGroup));
            }else if(shapes[i].ty == 'fl'){
                arr.push(ShapeExpressionInterface.createFillInterface(shapes[i],view[i],propertyGroup));
            }else if(shapes[i].ty == 'st'){
                arr.push(ShapeExpressionInterface.createStrokeInterface(shapes[i],view[i],propertyGroup));
            }else if(shapes[i].ty == 'tm'){
                arr.push(ShapeExpressionInterface.createTrimInterface(shapes[i],view[i],propertyGroup));
            }else if(shapes[i].ty == 'tr'){
                //arr.push(ShapeExpressionInterface.createTransformInterface(shapes[i],view[i],propertyGroup));
            }else if(shapes[i].ty == 'el'){
                arr.push(ShapeExpressionInterface.createEllipseInterface(shapes[i],view[i],propertyGroup));
            }else if(shapes[i].ty == 'sr'){
                arr.push(ShapeExpressionInterface.createStarInterface(shapes[i],view[i],propertyGroup));
            } else if(shapes[i].ty == 'sh'){
                arr.push(ShapeExpressionInterface.createPathInterface(shapes[i],view[i],propertyGroup));
            } else if(shapes[i].ty == 'rc'){
                arr.push(ShapeExpressionInterface.createRectInterface(shapes[i],view[i],propertyGroup));
            } else if(shapes[i].ty == 'rd'){
                arr.push(ShapeExpressionInterface.createRoundedInterface(shapes[i],view[i],propertyGroup));
            } else if(shapes[i].ty == 'rp'){
                arr.push(ShapeExpressionInterface.createRepatearInterface(shapes[i],view[i],propertyGroup));
            } else{
                //console.log(shapes[i].ty);
            }
        }
        return arr;
    }

    var shapeInterfaceFactory = (function(){
        return function(shapes,view,propertyGroup){
            var interfaces;
            function _interfaceFunction(value){
                if(typeof value === 'number'){
                    return interfaces[value-1];
                } else {
                    var i = 0, len = interfaces.length;
                    while(i<len){
                        if(interfaces[i]._name === value){
                            return interfaces[i];
                        }
                        i+=1;
                    }
                }
            }
            _interfaceFunction.propertyGroup = propertyGroup;
            interfaces = iterateElements(shapes, view, _interfaceFunction);
            return _interfaceFunction;
        }
    }());

    var contentsInterfaceFactory = (function(){
       return function(shape,view, propertyGroup){
           var interfaces;
           var interfaceFunction = function _interfaceFunction(value){
               var i = 0, len = interfaces.length;
                while(i<len){
                    if(interfaces[i]._name === value || interfaces[i].mn === value || interfaces[i].propertyIndex === value || interfaces[i].ix === value || interfaces[i].ind === value){
                       return interfaces[i];
                    }
                    i+=1;
                }
                if(typeof value === 'number'){
                   return interfaces[value-1];
                }
           };
           interfaceFunction.propertyGroup = function(val){
               if(val === 1){
                   return interfaceFunction;
               } else{
                   return propertyGroup(val-1);
               }
           };
           interfaces = iterateElements(shape.it, view.it, interfaceFunction.propertyGroup);
           interfaceFunction.numProperties = interfaces.length;
           interfaceFunction.propertyIndex = shape.cix;

           return interfaceFunction;
       }
    }());

    var groupInterfaceFactory = (function(){
        return function(shape,view, propertyGroup){
            var interfaceFunction = function _interfaceFunction(value){
                switch(value){
                    case 'ADBE Vectors Group':
                    case 'Contents':
                    case 2:
                        return interfaceFunction.content;
                    case 'ADBE Vector Transform Group':
                    case 3:
                    default:
                        return interfaceFunction.transform;
                }
                /*if(value === 'ADBE Vector Transform Group'){
                    return interfaceFunction.transform;
                    var i = 0, len = interfaces.length;
                    while(i<len){
                        if(interfaces[i].ty === 'tr'){
                            return interfaces[i];
                        }
                        i+=1;
                    }
                    return null;
                }
                if(typeof value === 'number'){
                    return interfaces[value-1];
                } else {
                    var i = 0, len = interfaces.length;
                    while(i<len){
                        if(interfaces[i]._name === value){
                            return interfaces[i];
                        }
                        i+=1;
                    }
                }*/
            }
            interfaceFunction.propertyGroup = function(val){
                if(val === 1){
                    return interfaceFunction;
                } else{
                    return propertyGroup(val-1);
                }
            };
            var content = contentsInterfaceFactory(shape,view,interfaceFunction.propertyGroup);
            var transformInterface = ShapeExpressionInterface.createTransformInterface(shape.it[shape.it.length - 1],view.it[view.it.length - 1],interfaceFunction.propertyGroup);
            interfaceFunction.content = content;
            interfaceFunction.transform = transformInterface;
            Object.defineProperty(interfaceFunction, '_name', {
                get: function(){
                    return shape.nm;
                }
            });
            //interfaceFunction.content = interfaceFunction;
            interfaceFunction.numProperties = shape.np;
            interfaceFunction.propertyIndex = shape.ix;
            interfaceFunction.nm = shape.nm;
            interfaceFunction.mn = shape.mn;
            return interfaceFunction;
        }
    }());

    var fillInterfaceFactory = (function(){
        return function(shape,view,propertyGroup){

            function interfaceFunction(val){
                if(val === 'Color' || val === 'color'){
                    return interfaceFunction.color;
                } else if(val === 'Opacity' || val === 'opacity'){
                    return interfaceFunction.opacity;
                }
            }
            Object.defineProperty(interfaceFunction, 'color', {
                get: function(){
                    return ExpressionValue(view.c, 1 / view.c.mult, 'color');
                }
            });
            Object.defineProperty(interfaceFunction, 'opacity', {
                get: function(){
                    return ExpressionValue(view.o, 100);
                }
            });
            Object.defineProperty(interfaceFunction, '_name', { value: shape.nm });
            Object.defineProperty(interfaceFunction, 'mn', { value: shape.mn });

            view.c.setGroupProperty(propertyGroup);
            view.o.setGroupProperty(propertyGroup);
            return interfaceFunction;
        }
    }());

    var strokeInterfaceFactory = (function(){
        return function(shape,view,propertyGroup){
            function _propertyGroup(val){
                if(val === 1){
                    return ob;
                } else{
                    return propertyGroup(val-1);
                }
            };
            function _dashPropertyGroup(val){
                if(val === 1){
                    return dashOb;
                } else{
                    return _propertyGroup(val-1);
                }
            };
            function addPropertyToDashOb(i) {
                Object.defineProperty(dashOb, shape.d[i].nm, {
                    get: function(){
                        return ExpressionValue(view.d.dataProps[i].p)
                    }
                });
            }
            var i, len = shape.d ? shape.d.length : 0;
            var dashOb = {}
            for (i = 0; i < len; i += 1) {
                addPropertyToDashOb(i);
                view.d.dataProps[i].p.setGroupProperty(_dashPropertyGroup);
            }

            function interfaceFunction(val){
                if(val === 'Color' || val === 'color'){
                    return interfaceFunction.color;
                } else if(val === 'Opacity' || val === 'opacity'){
                    return interfaceFunction.opacity;
                } else if(val === 'Stroke Width' || val === 'stroke width'){
                    return interfaceFunction.strokeWidth;
                }
            }
            Object.defineProperty(interfaceFunction, 'color', {
                get: function(){
                    return ExpressionValue(view.c, 1 / view.c.mult, 'color');
                }
            });
            Object.defineProperty(interfaceFunction, 'opacity', {
                get: function(){
                    return ExpressionValue(view.o, 100);
                }
            });
            Object.defineProperty(interfaceFunction, 'strokeWidth', {
                get: function(){
                    return ExpressionValue(view.w);
                }
            });
            Object.defineProperty(interfaceFunction, 'dash', {
                get: function(){
                    return dashOb;
                }
            });
            Object.defineProperty(interfaceFunction, '_name', { value: shape.nm });
            Object.defineProperty(interfaceFunction, 'mn', { value: shape.mn });

            view.c.setGroupProperty(_propertyGroup);
            view.o.setGroupProperty(_propertyGroup);
            view.w.setGroupProperty(_propertyGroup);
            return interfaceFunction;
        }
    }());

    var trimInterfaceFactory = (function(){
        return function(shape,view,propertyGroup){
            function _propertyGroup(val){
                if(val == 1){
                    return interfaceFunction;
                } else {
                    return propertyGroup(--val);
                }
            }
            interfaceFunction.propertyIndex = shape.ix;

            view.s.setGroupProperty(_propertyGroup);
            view.e.setGroupProperty(_propertyGroup);
            view.o.setGroupProperty(_propertyGroup);

            function interfaceFunction(val){
                if(val === shape.e.ix || val === 'End' || val === 'end'){
                    return interfaceFunction.end;
                }
                if(val === shape.s.ix){
                    return interfaceFunction.start;
                }
                if(val === shape.o.ix){
                    return interfaceFunction.offset;
                }
            }
            interfaceFunction.propertyIndex = shape.ix;
            Object.defineProperty(interfaceFunction, 'start', {
                get: function(){
                    return ExpressionValue(view.s, 1 / view.s.mult);
                }
            });
            Object.defineProperty(interfaceFunction, 'end', {
                get: function(){
                    return ExpressionValue(view.e, 1 / view.e.mult);
                }
            });
            Object.defineProperty(interfaceFunction, 'offset', {
                get: function(){
                    return ExpressionValue(view.o);
                }
            });
            Object.defineProperty(interfaceFunction, '_name', {
                get: function(){
                    return shape.nm;
                }
            });
            interfaceFunction.mn = shape.mn;
            return interfaceFunction;
        }
    }());

    var transformInterfaceFactory = (function(){
        return function(shape,view,propertyGroup){
            function _propertyGroup(val){
                if(val == 1){
                    return interfaceFunction;
                } else {
                    return propertyGroup(--val);
                }
            }
            view.transform.mProps.o.setGroupProperty(_propertyGroup);
            view.transform.mProps.p.setGroupProperty(_propertyGroup);
            view.transform.mProps.a.setGroupProperty(_propertyGroup);
            view.transform.mProps.s.setGroupProperty(_propertyGroup);
            view.transform.mProps.r.setGroupProperty(_propertyGroup);
            if(view.transform.mProps.sk){
                view.transform.mProps.sk.setGroupProperty(_propertyGroup);
                view.transform.mProps.sa.setGroupProperty(_propertyGroup);
            }
            view.transform.op.setGroupProperty(_propertyGroup);

            function interfaceFunction(value){
                if(shape.a.ix === value){
                    return interfaceFunction.anchorPoint;
                }
                if(shape.o.ix === value){
                    return interfaceFunction.opacity;
                }
                if(shape.p.ix === value){
                    return interfaceFunction.position;
                }
                if(shape.r.ix === value){
                    return interfaceFunction.rotation;
                }
                if(shape.s.ix === value){
                    return interfaceFunction.scale;
                }
                if(shape.sk && shape.sk.ix === value){
                    return interfaceFunction.skew;
                }
                if(shape.sa && shape.sa.ix === value){
                    return interfaceFunction.skewAxis;
                }
                if(value === 'Opacity') {
                    return interfaceFunction.opacity;
                }
                if(value === 'Position') {
                    return interfaceFunction.position;
                }
                if(value === 'Anchor Point') {
                    return interfaceFunction.anchorPoint;
                }
                if(value === 'Scale') {
                    return interfaceFunction.scale;
                }
                if(value === 'Rotation' || value === 'ADBE Vector Rotation') {
                    return interfaceFunction.rotation;
                }
                if(value === 'Skew') {
                    return interfaceFunction.skew;
                }
                if(value === 'Skew Axis') {
                    return interfaceFunction.skewAxis;
                }

            }
            Object.defineProperty(interfaceFunction, 'opacity', {
                get: function(){
                    return ExpressionValue(view.transform.mProps.o, 1/view.transform.mProps.o.mult);
                }
            });
            Object.defineProperty(interfaceFunction, 'position', {
                get: function(){
                    return ExpressionValue(view.transform.mProps.p);
                }
            });
            Object.defineProperty(interfaceFunction, 'anchorPoint', {
                get: function(){
                    return ExpressionValue(view.transform.mProps.a);
                }
            });
            var scaleArray = [];
            Object.defineProperty(interfaceFunction, 'scale', {
                get: function(){
                    return ExpressionValue(view.transform.mProps.s, 1 / view.transform.mProps.s.mult);
                }
            });
            Object.defineProperty(interfaceFunction, 'rotation', {
                get: function(){
                    return ExpressionValue(view.transform.mProps.r, 1 / view.transform.mProps.r.mult);
                }
            });
            Object.defineProperty(interfaceFunction, 'skew', {
                get: function(){
                    return ExpressionValue(view.transform.mProps.sk);
                }
            });
            Object.defineProperty(interfaceFunction, 'skewAxis', {
                get: function(){
                    return ExpressionValue(view.transform.mProps.sa);
                }
            });
            Object.defineProperty(interfaceFunction, '_name', {
                get: function(){
                    return shape.nm;
                }
            });
            interfaceFunction.ty = 'tr';
            interfaceFunction.mn = shape.mn;
            return interfaceFunction;
        }
    }());

    var ellipseInterfaceFactory = (function(){
        return function(shape,view,propertyGroup){
            function _propertyGroup(val){
                if(val == 1){
                    return interfaceFunction;
                } else {
                    return propertyGroup(--val);
                }
            }
            interfaceFunction.propertyIndex = shape.ix;
            var prop = view.sh.ty === 'tm' ? view.sh.prop : view.sh;
            prop.s.setGroupProperty(_propertyGroup);
            prop.p.setGroupProperty(_propertyGroup);
            function interfaceFunction(value){
                if(shape.p.ix === value){
                    return interfaceFunction.position;
                }
                if(shape.s.ix === value){
                    return interfaceFunction.size;
                }
            }
            Object.defineProperty(interfaceFunction, 'size', {
                get: function(){
                    return ExpressionValue(prop.s);
                }
            });
            Object.defineProperty(interfaceFunction, 'position', {
                get: function(){
                    return ExpressionValue(prop.p);
                }
            });
            Object.defineProperty(interfaceFunction, '_name', {
                get: function(){
                    return shape.nm;
                }
            });
            interfaceFunction.mn = shape.mn;
            return interfaceFunction;
        }
    }());

    var starInterfaceFactory = (function(){
        return function(shape,view,propertyGroup){
            function _propertyGroup(val){
                if(val == 1){
                    return interfaceFunction;
                } else {
                    return propertyGroup(--val);
                }
            }
            var prop = view.sh.ty === 'tm' ? view.sh.prop : view.sh;
            interfaceFunction.propertyIndex = shape.ix;
            prop.or.setGroupProperty(_propertyGroup);
            prop.os.setGroupProperty(_propertyGroup);
            prop.pt.setGroupProperty(_propertyGroup);
            prop.p.setGroupProperty(_propertyGroup);
            prop.r.setGroupProperty(_propertyGroup);
            if(shape.ir){
                prop.ir.setGroupProperty(_propertyGroup);
                prop.is.setGroupProperty(_propertyGroup);
            }

            function interfaceFunction(value){
                if(shape.p.ix === value){
                    return interfaceFunction.position;
                }
                if(shape.r.ix === value){
                    return interfaceFunction.rotation;
                }
                if(shape.pt.ix === value){
                    return interfaceFunction.points;
                }
                if(shape.or.ix === value || 'ADBE Vector Star Outer Radius' === value){
                    return interfaceFunction.outerRadius;
                }
                if(shape.os.ix === value){
                    return interfaceFunction.outerRoundness;
                }
                if(shape.ir && (shape.ir.ix === value || 'ADBE Vector Star Inner Radius' === value)){
                    return interfaceFunction.innerRadius;
                }
                if(shape.is && shape.is.ix === value){
                    return interfaceFunction.innerRoundness;
                }

            }
            Object.defineProperty(interfaceFunction, 'position', {
                get: function(){
                    return ExpressionValue(prop.p);
                }
            });
            Object.defineProperty(interfaceFunction, 'rotation', {
                get: function(){
                    return ExpressionValue(prop.r, 1 / prop.r.mult);
                }
            });
            Object.defineProperty(interfaceFunction, 'points', {
                get: function(){
                    return ExpressionValue(prop.pt);
                }
            });
            Object.defineProperty(interfaceFunction, 'outerRadius', {
                get: function(){
                    return ExpressionValue(prop.or);
                }
            });
            Object.defineProperty(interfaceFunction, 'outerRoundness', {
                get: function(){
                    return ExpressionValue(prop.os);
                }
            });
            Object.defineProperty(interfaceFunction, 'innerRadius', {
                get: function(){
                    if(!prop.ir){
                        return 0;
                    }
                    return ExpressionValue(prop.ir);
                }
            });
            Object.defineProperty(interfaceFunction, 'innerRoundness', {
                get: function(){
                    if(!prop.is){
                        return 0;
                    }
                    return ExpressionValue(prop.is, 1 / prop.is.mult);
                }
            });
            Object.defineProperty(interfaceFunction, '_name', {
                get: function(){
                    return shape.nm;
                }
            });
            interfaceFunction.mn = shape.mn;
            return interfaceFunction;
        }
    }());

    var rectInterfaceFactory = (function(){
        return function(shape,view,propertyGroup){
            function _propertyGroup(val){
                if(val == 1){
                    return interfaceFunction;
                } else {
                    return propertyGroup(--val);
                }
            }
            var prop = view.sh.ty === 'tm' ? view.sh.prop : view.sh;
            interfaceFunction.propertyIndex = shape.ix;
            prop.p.setGroupProperty(_propertyGroup);
            prop.s.setGroupProperty(_propertyGroup);
            prop.r.setGroupProperty(_propertyGroup);

            function interfaceFunction(value){
                if(shape.p.ix === value){
                    return interfaceFunction.position;
                }
                if(shape.r.ix === value){
                    return interfaceFunction.rotation;
                }
                if(shape.s.ix === value || value === 'Size'){
                    return interfaceFunction.size;
                }

            }
            Object.defineProperty(interfaceFunction, 'position', {
                get: function(){
                    return ExpressionValue(prop.p);
                }
            });
            Object.defineProperty(interfaceFunction, 'roundness', {
                get: function(){
                    return ExpressionValue(prop.r);
                }
            });
            Object.defineProperty(interfaceFunction, 'size', {
                get: function(){
                    return ExpressionValue(prop.s);
                }
            });

            Object.defineProperty(interfaceFunction, '_name', {
                get: function(){
                    return shape.nm;
                }
            });
            interfaceFunction.mn = shape.mn;
            return interfaceFunction;
        }
    }());

    var roundedInterfaceFactory = (function(){
        return function(shape,view,propertyGroup){
            function _propertyGroup(val){
                if(val == 1){
                    return interfaceFunction;
                } else {
                    return propertyGroup(--val);
                }
            }
            var prop = view;
            interfaceFunction.propertyIndex = shape.ix;
            prop.rd.setGroupProperty(_propertyGroup);

            function interfaceFunction(value){
                if(shape.r.ix === value || 'Round Corners 1' === value){
                    return interfaceFunction.radius;
                }

            }
            Object.defineProperty(interfaceFunction, 'radius', {
                get: function(){
                    return ExpressionValue(prop.rd);
                }
            });

            Object.defineProperty(interfaceFunction, '_name', {
                get: function(){
                    return shape.nm;
                }
            });
            interfaceFunction.mn = shape.mn;
            return interfaceFunction;
        }
    }());

    var repeaterInterfaceFactory = (function(){
        return function(shape,view,propertyGroup){
            function _propertyGroup(val){
                if(val == 1){
                    return interfaceFunction;
                } else {
                    return propertyGroup(--val);
                }
            }
            var prop = view;
            interfaceFunction.propertyIndex = shape.ix;
            prop.c.setGroupProperty(_propertyGroup);
            prop.o.setGroupProperty(_propertyGroup);

            function interfaceFunction(value){
                if(shape.c.ix === value || 'Copies' === value){
                    return interfaceFunction.copies;
                } else if(shape.o.ix === value || 'Offset' === value){
                    return interfaceFunction.offset;
                }

            }
            Object.defineProperty(interfaceFunction, 'copies', {
                get: function(){
                    return ExpressionValue(prop.c);
                }
            });

            Object.defineProperty(interfaceFunction, 'offset', {
                get: function(){
                    return ExpressionValue(prop.o);
                }
            });

            Object.defineProperty(interfaceFunction, '_name', {
                get: function(){
                    return shape.nm;
                }
            });
            interfaceFunction.mn = shape.mn;
            return interfaceFunction;
        }
    }());

    var pathInterfaceFactory = (function(){
        return function(shape,view,propertyGroup){
            var prop = view.sh.ty === 'tm' ? view.sh.prop : view.sh;
            function _propertyGroup(val){
                if(val == 1){
                    return interfaceFunction;
                } else {
                    return propertyGroup(--val);
                }
            }
            prop.setGroupProperty(_propertyGroup);

            function interfaceFunction(val){
                if(val === 'Shape' || val === 'shape' || val === 'Path' || val === 'path'){
                    return interfaceFunction.path;
                }
            }
            Object.defineProperty(interfaceFunction, 'path', {
                get: function(){
                    if(prop.k){
                        prop.getValue();
                    }
                    return prop.v;
                    //return shape_pool.clone(prop.v);
                }
            });
            Object.defineProperty(interfaceFunction, 'shape', {
                get: function(){
                    if(prop.k){
                        prop.getValue();
                    }
                    return prop.v;
                    //return shape_pool.clone(prop.v);
                }
            });
            Object.defineProperty(interfaceFunction, '_name', { value: shape.nm });
            Object.defineProperty(interfaceFunction, 'ix', { value: shape.ix });
            Object.defineProperty(interfaceFunction, 'mn', { value: shape.mn });
            return interfaceFunction;
        }
    }());


    return ob;
}())

var TextExpressionInterface = (function(){
	return function(elem){
        function _thisLayerFunction(){
        }
        Object.defineProperty(_thisLayerFunction, "sourceText", {
            get: function(){
            	if(!elem.currentTextDocumentData.t) {
            		return ''
            	}
                return elem.currentTextDocumentData.t;
            }
        });
        return _thisLayerFunction;
    }
}())
var LayerExpressionInterface = (function (){
    function toWorld(arr, time){
        var toWorldMat = new Matrix();
        toWorldMat.reset();
        var transformMat;
        if(time) {
            //Todo implement value at time on transform properties
            //transformMat = this._elem.finalTransform.mProp.getValueAtTime(time);
            transformMat = this._elem.finalTransform.mProp;
        } else {
            transformMat = this._elem.finalTransform.mProp;
        }
        transformMat.applyToMatrix(toWorldMat);
        if(this._elem.hierarchy && this._elem.hierarchy.length){
            var i, len = this._elem.hierarchy.length;
            for(i=0;i<len;i+=1){
                this._elem.hierarchy[i].finalTransform.mProp.applyToMatrix(toWorldMat);
            }
            return toWorldMat.applyToPointArray(arr[0],arr[1],arr[2]||0);
        }
        return toWorldMat.applyToPointArray(arr[0],arr[1],arr[2]||0);
    }
    function fromWorld(arr, time){
        var toWorldMat = new Matrix();
        toWorldMat.reset();
        var transformMat;
        if(time) {
            //Todo implement value at time on transform properties
            //transformMat = this._elem.finalTransform.mProp.getValueAtTime(time);
            transformMat = this._elem.finalTransform.mProp;
        } else {
            transformMat = this._elem.finalTransform.mProp;
        }
        transformMat.applyToMatrix(toWorldMat);
        if(this._elem.hierarchy && this._elem.hierarchy.length){
            var i, len = this._elem.hierarchy.length;
            for(i=0;i<len;i+=1){
                this._elem.hierarchy[i].finalTransform.mProp.applyToMatrix(toWorldMat);
            }
            return toWorldMat.inversePoint(arr);
        }
        return toWorldMat.inversePoint(arr);
    }
    function fromComp(arr){
        var toWorldMat = new Matrix();
        toWorldMat.reset();
        this._elem.finalTransform.mProp.applyToMatrix(toWorldMat);
        if(this._elem.hierarchy && this._elem.hierarchy.length){
            var i, len = this._elem.hierarchy.length;
            for(i=0;i<len;i+=1){
                this._elem.hierarchy[i].finalTransform.mProp.applyToMatrix(toWorldMat);
            }
            return toWorldMat.inversePoint(arr);
        }
        return toWorldMat.inversePoint(arr);
    }


    return function(elem){

        var transformInterface = TransformExpressionInterface(elem.transform);

        function _registerMaskInterface(maskManager){
            _thisLayerFunction.mask = maskManager.getMask.bind(maskManager);
        }
        function _registerEffectsInterface(effects){
            _thisLayerFunction.effect = effects;
        }

        function _thisLayerFunction(name){
            switch(name){
                case "ADBE Root Vectors Group":
                case "Contents":
                case 2:
                    return _thisLayerFunction.shapeInterface;
                case 1:
                case 6:
                case "Transform":
                case "transform":
                case "ADBE Transform Group":
                    return transformInterface;
                case 4:
                case "ADBE Effect Parade":
                    return _thisLayerFunction.effect;
            }
        }
        _thisLayerFunction.toWorld = toWorld;
        _thisLayerFunction.fromWorld = fromWorld;
        _thisLayerFunction.toComp = toWorld;
        _thisLayerFunction.fromComp = fromComp;
        _thisLayerFunction._elem = elem;
        Object.defineProperty(_thisLayerFunction, 'hasParent', {
            get: function(){
                return !!elem.hierarchy;
            }
        });
        Object.defineProperty(_thisLayerFunction, 'parent', {
            get: function(){
                return elem.hierarchy[0].layerInterface;
            }
        });
        Object.defineProperty(_thisLayerFunction, "rotation", {
            get: function(){
                return transformInterface.rotation;
            }
        });
        Object.defineProperty(_thisLayerFunction, "scale", {
            get: function () {
                return transformInterface.scale;
            }
        });

        Object.defineProperty(_thisLayerFunction, "position", {
            get: function () {
                return transformInterface.position;
            }
        });

        Object.defineProperty(_thisLayerFunction, "anchorPoint", {
            get: function () {
                return transformInterface.anchorPoint;
            }
        });

        Object.defineProperty(_thisLayerFunction, "transform", {
            get: function () {
                return transformInterface;
            }
        });

        Object.defineProperty(_thisLayerFunction, "width", {
            get: function () {
                if(elem.data.ty === 0) {
                    return elem.data.w
                }
                return 100;
            }
        });

        Object.defineProperty(_thisLayerFunction, "height", {
            get: function () {
                if(elem.data.ty === 0) {
                    return elem.data.h
                }
                return 100;
            }
        });

        Object.defineProperty(_thisLayerFunction, "source", {
            get: function () {
                return elem.data.refId;
            }
        });

        Object.defineProperty(_thisLayerFunction, "_name", { value:elem.data.nm });
        Object.defineProperty(_thisLayerFunction, "content", {
            get: function(){
                return _thisLayerFunction.shapeInterface;
            }
        });

        Object.defineProperty(_thisLayerFunction, "active", {
            get: function(){
                return elem.isVisible;
            }
        });

        Object.defineProperty(_thisLayerFunction, "text", {
            get: function(){
                return _thisLayerFunction.textInterface;
            }
        });

        _thisLayerFunction.registerMaskInterface = _registerMaskInterface;
        _thisLayerFunction.registerEffectsInterface = _registerEffectsInterface;
        return _thisLayerFunction;
    }
}());

var CompExpressionInterface = (function (){
    return function(comp){
        function _thisLayerFunction(name){
            var i=0, len = comp.layers.length;
            while(i<len){
                if(comp.layers[i].nm === name || comp.layers[i].ind === name){
                    return comp.elements[i].layerInterface;
                }
                i += 1;
            }
            return {active:false}
        }
        Object.defineProperty(_thisLayerFunction, "_name", { value:comp.data.nm });
        _thisLayerFunction.layer = _thisLayerFunction;
        _thisLayerFunction.pixelAspect = 1;
        _thisLayerFunction.height = comp.globalData.compSize.h;
        _thisLayerFunction.width = comp.globalData.compSize.w;
        _thisLayerFunction.pixelAspect = 1;
        _thisLayerFunction.frameDuration = 1/comp.globalData.frameRate;
        return _thisLayerFunction;
    }
}());
var TransformExpressionInterface = (function (){
    return function(transform){
        function _thisFunction(name){
            switch(name){
                case "scale":
                case "Scale":
                case "ADBE Scale":
                case 6:
                    return _thisFunction.scale;
                case "rotation":
                case "Rotation":
                case "ADBE Rotation":
                case "ADBE Rotate Z":
                case 10:
                    return _thisFunction.rotation;
                case "position":
                case "Position":
                case "ADBE Position":
                case 2:
                    return transform.position;
                case "anchorPoint":
                case "AnchorPoint":
                case "Anchor Point":
                case "ADBE AnchorPoint":
                case 1:
                    return _thisFunction.anchorPoint;
                case "opacity":
                case "Opacity":
                case 11:
                    return _thisFunction.opacity;
            }
        }

        Object.defineProperty(_thisFunction, "rotation", {
            get: function(){
                return transform.rotation;
            }
        });
        Object.defineProperty(_thisFunction, "scale", {
            get: function () {
                return transform.scale;
            }
        });

        Object.defineProperty(_thisFunction, "position", {
            get: function () {
                return transform.position;
            }
        });

        Object.defineProperty(_thisFunction, "xPosition", {
            get: function () {
                return transform.xPosition;
            }
        });

        Object.defineProperty(_thisFunction, "yPosition", {
            get: function () {
                return transform.yPosition;
            }
        });

        Object.defineProperty(_thisFunction, "anchorPoint", {
            get: function () {
                return transform.anchorPoint;
            }
        });

        Object.defineProperty(_thisFunction, "opacity", {
            get: function () {
                return transform.opacity;
            }
        });

        Object.defineProperty(_thisFunction, "skew", {
            get: function () {
                return transform.skew;
            }
        });

        Object.defineProperty(_thisFunction, "skewAxis", {
            get: function () {
                return transform.skewAxis;
            }
        });

        return _thisFunction;
    }
}());
var ProjectInterface = (function (){

    function registerComposition(comp){
        this.compositions.push(comp);
    }

    return function(){
        function _thisProjectFunction(name){
            var i = 0, len = this.compositions.length;
            while(i<len){
                if(this.compositions[i].data && this.compositions[i].data.nm === name){
                    if(this.compositions[i].prepareFrame) {
                        this.compositions[i].prepareFrame(this.currentFrame);
                    }
                    return this.compositions[i].compInterface;
                }
                i+=1;
            }
        }

        _thisProjectFunction.compositions = [];
        _thisProjectFunction.currentFrame = 0;

        _thisProjectFunction.registerComposition = registerComposition;



        return _thisProjectFunction;
    }
}());
var EffectsExpressionInterface = (function (){
    var ob = {
        createEffectsInterface: createEffectsInterface
    };

    function createEffectsInterface(elem, propertyGroup){
        if(elem.effects){

            var effectElements = [];
            var effectsData = elem.data.ef;
            var i, len = elem.effects.effectElements.length;
            for(i=0;i<len;i+=1){
                effectElements.push(createGroupInterface(effectsData[i],elem.effects.effectElements[i],propertyGroup,elem));
            }

            return function(name){
                var effects = elem.data.ef, i = 0, len = effects.length;
                while(i<len) {
                    if(name === effects[i].nm || name === effects[i].mn || name === effects[i].ix){
                        return effectElements[i];
                    }
                    i += 1;
                }
            }
        }
    }

    function createGroupInterface(data,elements, propertyGroup, elem){
        var effectElements = [];
        var i, len = data.ef.length;
        for(i=0;i<len;i+=1){
            if(data.ef[i].ty === 5){
                effectElements.push(createGroupInterface(data.ef[i],elements.effectElements[i],propertyGroup, elem));
            } else {
                effectElements.push(createValueInterface(elements.effectElements[i],data.ef[i].ty, elem));
            }
        }
        var groupInterface = function(name){
            var effects = data.ef, i = 0, len = effects.length;
            while(i<len) {
                if(name === effects[i].nm || name === effects[i].mn || name === effects[i].ix){
                    if(effects[i].ty === 5){
                        return effectElements[i];
                    } else {
                        return effectElements[i]();
                    }
                }
                i += 1;
            }
            return effectElements[0]();
        }
        if(data.mn === 'ADBE Color Control'){
            Object.defineProperty(groupInterface, 'color', {
                get: function(){
                    return effectElements[0]();
                }
            });
        }
        groupInterface.active = data.en !== 0;
        return groupInterface
    }

    function createValueInterface(element, type, elem){
        return function(){
            if(type === 10){
                return elem.comp.compInterface(element.p.v);
            }
            return ExpressionValue(element.p);
        }
    }

    return ob;

}());
var ExpressionValue = (function() {
	return function(elementProp, mult, type) {
        var expressionValue, arrayValue;

		if (elementProp.k) {
            elementProp.getValue();
        }
        var i, len, arrValue;
        if (type) {
        	if(type === 'color') {
        		len = 4;
		        expressionValue = Array.apply(null, {length: len});
		        arrValue = Array.apply(null, {length: len});
		        for (i = 0; i < len; i += 1) {
		            expressionValue[i] = arrValue[i] = (mult && i < 3) ? elementProp.v[i] * mult : 1;
		        }
	        	expressionValue.value = arrValue;
        	}
        } else if (typeof elementProp.v === 'number' || elementProp.v instanceof Number){
            expressionValue = mult ? new Number(elementProp.v * mult) : new Number(elementProp.v);
            expressionValue.value = mult ? elementProp.v * mult : elementProp.v;
        } else {
        	len = elementProp.v.length;
	        expressionValue = Array.apply(null, {length: len});
	        arrValue = Array.apply(null, {length: len});
	        for (i = 0; i < len; i += 1) {
	            expressionValue[i] = arrValue[i] = mult ? elementProp.v[i] * mult : elementProp.v[i];
	        }
	        expressionValue.value = arrValue;
        }
        
        expressionValue.numKeys = elementProp.keyframes ? elementProp.keyframes.length : 0;
        expressionValue.key = function(pos) {
            if (!expressionValue.numKeys) {
                return 0;
            } else {
                return elementProp.keyframes[pos-1].t;
            }
        };
        expressionValue.valueAtTime = elementProp.getValueAtTime;
        expressionValue.propertyGroup = elementProp.propertyGroup;
        return expressionValue;
	}
}())
function SliderEffect(data,elem, dynamicProperties){
    this.p = PropertyFactory.getProp(elem,data.v,0,0,dynamicProperties);
}
function AngleEffect(data,elem, dynamicProperties){
    this.p = PropertyFactory.getProp(elem,data.v,0,0,dynamicProperties);
}
function ColorEffect(data,elem, dynamicProperties){
    this.p = PropertyFactory.getProp(elem,data.v,1,0,dynamicProperties);
}
function PointEffect(data,elem, dynamicProperties){
    this.p = PropertyFactory.getProp(elem,data.v,1,0,dynamicProperties);
}
function LayerIndexEffect(data,elem, dynamicProperties){
    this.p = PropertyFactory.getProp(elem,data.v,0,0,dynamicProperties);
}
function MaskIndexEffect(data,elem, dynamicProperties){
    this.p = PropertyFactory.getProp(elem,data.v,0,0,dynamicProperties);
}
function CheckboxEffect(data,elem, dynamicProperties){
    this.p = PropertyFactory.getProp(elem,data.v,0,0,dynamicProperties);
}
function NoValueEffect(){
    this.p = {};
}
function EffectsManager(data,element,dynamicProperties){
    var effects = data.ef;
    this.effectElements = [];
    var i,len = effects.length;
    var effectItem;
    for(i=0;i<len;i++) {
        effectItem = new GroupEffect(effects[i],element,dynamicProperties);
        this.effectElements.push(effectItem);
    }
}

function GroupEffect(data,element,dynamicProperties){
    this.dynamicProperties = [];
    this.init(data,element,this.dynamicProperties);
    if(this.dynamicProperties.length){
        dynamicProperties.push(this);
    }
}

GroupEffect.prototype.getValue = function(){
    this.mdf = false;
    var i, len = this.dynamicProperties.length;
    for(i=0;i<len;i+=1){
        this.dynamicProperties[i].getValue();
        this.mdf = this.dynamicProperties[i].mdf ? true : this.mdf;
    }
};

GroupEffect.prototype.init = function(data,element,dynamicProperties){
    this.data = data;
    this.mdf = false;
    this.effectElements = [];
    var i, len = this.data.ef.length;
    var eff, effects = this.data.ef;
    for(i=0;i<len;i+=1){
        switch(effects[i].ty){
            case 0:
                eff = new SliderEffect(effects[i],element,dynamicProperties);
                this.effectElements.push(eff);
                break;
            case 1:
                eff = new AngleEffect(effects[i],element,dynamicProperties);
                this.effectElements.push(eff);
                break;
            case 2:
                eff = new ColorEffect(effects[i],element,dynamicProperties);
                this.effectElements.push(eff);
                break;
            case 3:
                eff = new PointEffect(effects[i],element,dynamicProperties);
                this.effectElements.push(eff);
                break;
            case 4:
            case 7:
                eff = new CheckboxEffect(effects[i],element,dynamicProperties);
                this.effectElements.push(eff);
                break;
            case 10:
                eff = new LayerIndexEffect(effects[i],element,dynamicProperties);
                this.effectElements.push(eff);
                break;
            case 11:
                eff = new MaskIndexEffect(effects[i],element,dynamicProperties);
                this.effectElements.push(eff);
                break;
            case 5:
                eff = new EffectsManager(effects[i],element,dynamicProperties);
                this.effectElements.push(eff);
                break;
            case 6:
                eff = new NoValueEffect(effects[i],element,dynamicProperties);
                this.effectElements.push(eff);
                break;
        }
    }
};var bodymovinjs = {}; function play(animation){ animationManager.play(animation); } function pause(animation){ animationManager.pause(animation); } function togglePause(animation){ animationManager.togglePause(animation); } function setSpeed(value,animation){ animationManager.setSpeed(value, animation); } function setDirection(value,animation){ animationManager.setDirection(value, animation); } function stop(animation){ animationManager.stop(animation); } function moveFrame(value){ animationManager.moveFrame(value); } function searchAnimations(){ if(standalone === true){ animationManager.searchAnimations(animationData,standalone, renderer); }else{ animationManager.searchAnimations(); } } function registerAnimation(elem){ return animationManager.registerAnimation(elem); } function resize(){ animationManager.resize(); } function start(){ animationManager.start(); } function goToAndStop(val,isFrame, animation){ animationManager.goToAndStop(val,isFrame, animation); } function setSubframeRendering(flag){ subframeEnabled = flag; } function loadAnimation(params){ if(standalone === true){ params.animationData = JSON.parse(animationData); } return animationManager.loadAnimation(params); } function destroy(animation){ return animationManager.destroy(animation); } function setQuality(value){ if(typeof value === 'string'){ switch(value){ case 'high': defaultCurveSegments = 200; break; case 'medium': defaultCurveSegments = 50; break; case 'low': defaultCurveSegments = 10; break; } }else if(!isNaN(value) && value > 1){ defaultCurveSegments = value; } if(defaultCurveSegments >= 50){ roundValues(false); }else{ roundValues(true); } } function inBrowser() { return typeof navigator !== 'undefined'; } function installPlugin(type,plugin){ if(type==='expressions'){ expressionsPlugin = plugin; } } function getFactory(name){ switch(name){ case "propertyFactory": return PropertyFactory;case "shapePropertyFactory": return ShapePropertyFactory; case "matrix": return Matrix; } } bodymovinjs.play = play; bodymovinjs.pause = pause; bodymovinjs.togglePause = togglePause; bodymovinjs.setSpeed = setSpeed; bodymovinjs.setDirection = setDirection; bodymovinjs.stop = stop; bodymovinjs.moveFrame = moveFrame; bodymovinjs.searchAnimations = searchAnimations; bodymovinjs.registerAnimation = registerAnimation; bodymovinjs.loadAnimation = loadAnimation; bodymovinjs.setSubframeRendering = setSubframeRendering; bodymovinjs.resize = resize; bodymovinjs.start = start; bodymovinjs.goToAndStop = goToAndStop; bodymovinjs.destroy = destroy; bodymovinjs.setQuality = setQuality; bodymovinjs.inBrowser = inBrowser; bodymovinjs.installPlugin = installPlugin; bodymovinjs.__getFactory = getFactory; bodymovinjs.version = '4.9.0'; function checkReady(){ if (document.readyState === "complete") { clearInterval(readyStateCheckInterval); searchAnimations(); } } function getQueryVariable(variable) { var vars = queryString.split('&'); for (var i = 0; i < vars.length; i++) { var pair = vars[i].split('='); if (decodeURIComponent(pair[0]) == variable) { return decodeURIComponent(pair[1]); } } } var standalone = '__[STANDALONE]__'; var animationData = '__[ANIMATIONDATA]__'; var renderer = ''; if(standalone) { var scripts = document.getElementsByTagName('script'); var index = scripts.length - 1; var myScript = scripts[index] || { src: '' }; var queryString = myScript.src.replace(/^[^\?]+\??/,''); renderer = getQueryVariable('renderer'); } var readyStateCheckInterval = setInterval(checkReady, 100); return bodymovinjs; }));  

/***/ })
/******/ ]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAgY2Y3ODA3ZTQ3MDVhODFkMDJjNGEiLCJ3ZWJwYWNrOi8vLy4vc3JjL2FwcC5qcyIsIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMvYm9keW1vdmluL2J1aWxkL3BsYXllci9ib2R5bW92aW4uanMiXSwibmFtZXMiOlsiYW5pbWF0aW9uIiwiYm9keW1vdmluIiwibG9hZEFuaW1hdGlvbiIsImNvbnRhaW5lciIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJyZW5kZXJlciIsImxvb3AiLCJhdXRvcGxheSIsInBhdGgiLCJhbmltYXRpb24yIiwiYW5pbWF0aW9uMyIsImFuaW1hdGlvbjQiXSwibWFwcGluZ3MiOiI7QUFBQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBSztBQUNMO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsbUNBQTJCLDBCQUEwQixFQUFFO0FBQ3ZELHlDQUFpQyxlQUFlO0FBQ2hEO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLDhEQUFzRCwrREFBK0Q7O0FBRXJIO0FBQ0E7O0FBRUE7QUFDQTs7Ozs7Ozs7Ozs7QUM3REE7O0FBRUEsSUFBSUEsWUFBWSxpREFBQUMsQ0FBVUMsYUFBVixDQUF3QjtBQUN0Q0MsYUFBV0MsU0FBU0MsY0FBVCxDQUF3QixJQUF4QixDQUQyQjtBQUV0Q0MsWUFBVSxLQUY0QjtBQUd0Q0MsUUFBTSxJQUhnQztBQUl0Q0MsWUFBVSxJQUo0QjtBQUt0Q0MsUUFBTTtBQUxnQyxDQUF4QixDQUFoQjtBQU9BLElBQUlDLGFBQWEsaURBQUFULENBQVVDLGFBQVYsQ0FBd0I7QUFDdkNDLGFBQVdDLFNBQVNDLGNBQVQsQ0FBd0IsS0FBeEIsQ0FENEI7QUFFdkNDLFlBQVUsS0FGNkI7QUFHdkNDLFFBQU0sSUFIaUM7QUFJdkNDLFlBQVUsSUFKNkI7QUFLdkNDLFFBQU07QUFMaUMsQ0FBeEIsQ0FBakI7QUFPQSxJQUFJRSxhQUFhLGlEQUFBVixDQUFVQyxhQUFWLENBQXdCO0FBQ3ZDQyxhQUFXQyxTQUFTQyxjQUFULENBQXdCLEtBQXhCLENBRDRCO0FBRXZDQyxZQUFVLEtBRjZCO0FBR3ZDQyxRQUFNLElBSGlDO0FBSXZDQyxZQUFVLElBSjZCO0FBS3ZDQyxRQUFNO0FBTGlDLENBQXhCLENBQWpCO0FBT0EsSUFBSUcsYUFBYSxpREFBQVgsQ0FBVUMsYUFBVixDQUF3QjtBQUN2Q0MsYUFBV0MsU0FBU0MsY0FBVCxDQUF3QixLQUF4QixDQUQ0QjtBQUV2Q0MsWUFBVSxLQUY2QjtBQUd2Q0MsUUFBTSxJQUhpQztBQUl2Q0MsWUFBVSxJQUo2QjtBQUt2Q0MsUUFBTTtBQUxpQyxDQUF4QixDQUFqQixDOzs7Ozs7QUN2QkEsK0dBQTZDLFFBQVEsMkJBQTJCLFdBQWlEO0FBQUE7QUFBQTtBQUFBO0FBQUEscUdBQWtCLEVBQUUsd0RBQXdELDRCQUE0QixFQUFFLE9BQU8sNEJBQTRCLEVBQUUsRUFBRSxxQkFBcUI7QUFDdlM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLE1BQU07QUFDbEI7QUFDQTtBQUNBLENBQUM7O0FBRUQsNEJBQTRCOztBQUU1QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVDQUF1QyxrQkFBa0I7QUFDekQ7QUFDQSxnQkFBZ0IsTUFBTTtBQUN0QjtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEVBQUU7QUFDRjs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLHVCQUF1QixTQUFTO0FBQ2hDO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixPQUFPO0FBQzNCO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9DQUFvQztBQUNwQyxvQ0FBb0M7QUFDcEMsb0NBQW9DO0FBQ3BDLG9DQUFvQztBQUNwQyxvQ0FBb0M7QUFDcEMsb0NBQW9DO0FBQ3BDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0Esd0JBQXdCO0FBQ3hCLGlEQUFpRCxZQUFZO0FBQzdELG9DQUFvQyxZQUFZO0FBQ2hELG9DQUFvQyxZQUFZO0FBQ2hEOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVksTUFBTTtBQUNsQjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQzs7QUFFRDtBQUNBO0FBQ0Esa0NBQWtDLEVBQUUsVUFBVSxFQUFFLFVBQVUsRUFBRTtBQUM1RDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7O0FBRUQ7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsWUFBWSxNQUFNO0FBQ2xCO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsa0JBQWtCLFNBQVM7QUFDM0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVyx5QkFBeUI7QUFDcEMsVUFBVSxPQUFPO0FBQ2pCLFVBQVUsT0FBTztBQUNqQixVQUFVLE9BQU87QUFDakIsVUFBVSxPQUFPO0FBQ2pCLFVBQVUsT0FBTztBQUNqQixVQUFVLE9BQU87QUFDakIsVUFBVSw4QkFBOEI7QUFDeEM7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsZ0JBQWdCLEtBQUs7QUFDckI7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxnQkFBZ0IsS0FBSztBQUNyQjtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsZ0JBQWdCLE1BQU07QUFDdEI7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsZ0c7QUFDQSxnRztBQUNBLHVCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsQ0FBQzs7QUFFRDs7O0FBR0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUJBQW1COztBQUVuQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1Q0FBdUMsZ0JBQWdCLGlCQUFpQjs7QUFFeEU7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0JBQXNCO0FBQ3RCLHNDQUFzQztBQUN0QyxvQ0FBb0M7QUFDcEMsMkJBQTJCO0FBQzNCLDhCQUE4QjtBQUM5QjtBQUNBLG1DQUFtQztBQUNuQyx1QkFBdUI7QUFDdkIsdUJBQXVCO0FBQ3ZCLHlCQUF5QjtBQUN6QjtBQUNBLCtCQUErQjtBQUMvQjs7QUFFQSxpQ0FBaUMsc0JBQXNCO0FBQ3ZELGlDQUFpQyxnQ0FBZ0M7QUFDakU7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsOEJBQThCLG1CQUFtQjtBQUNqRDtBQUNBLHlDQUF5QyxxQkFBcUIsRUFBRTtBQUNoRTs7QUFFQTtBQUNBO0FBQ0EsK0JBQStCLHNCQUFzQixhQUFhOztBQUVsRTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0Esc0JBQXNCLGtCQUFrQjs7QUFFeEM7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQkFBbUIsV0FBVztBQUM5QjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUIsNENBQTRDLEVBQUU7QUFDbkU7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2QkFBNkIsZ0RBQWdEO0FBQzdFO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQSwyQkFBMkIsb0NBQW9DO0FBQy9ELDJCQUEyQiw4QkFBOEI7QUFDekQsMkJBQTJCLGtCQUFrQjs7QUFFN0M7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBOztBQUVBO0FBQ0EsdUJBQXVCLHVCQUF1QjtBQUM5QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFEQUFxRDtBQUNyRDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCLHNCQUFzQjtBQUNqRDtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUEsa0JBQWtCLG9FQUFvRTtBQUN0RjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQSxDQUFDOzs7QUFHRDs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCLHFEQUFxRDtBQUN2RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixnQkFBZ0I7QUFDcEM7QUFDQTtBQUNBLHdCQUF3QixNQUFNO0FBQzlCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLGdCQUFnQjtBQUNwQztBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsTUFBTTtBQUM5QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQixNQUFNO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsTUFBTTtBQUN0QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QixPQUFPO0FBQy9CO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQSxnQ0FBZ0MsT0FBTztBQUN2QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixLQUFLO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBLDRCQUE0QixPQUFPO0FBQ25DO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7O0FBRUE7QUFDQTtBQUNBLGdCQUFnQixNQUFNO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxvQkFBb0IsTUFBTTtBQUMxQjtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0QkFBNEIsTUFBTTtBQUNsQztBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBCQUEwQixTQUFTO0FBQ25DO0FBQ0E7QUFDQTs7QUFFQSxrQ0FBa0MsVUFBVTtBQUM1QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxLQUFLOztBQUVMO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLE1BQU07QUFDMUI7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0EsZ0NBQWdDLE9BQU87QUFDdkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0Esb0JBQW9CLE1BQU07QUFDMUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNEJBQTRCLE1BQU07QUFDbEM7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBOzs7O0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsS0FBSztBQUM3QjtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQSxnQ0FBZ0MsT0FBTztBQUN2QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0IsTUFBTTtBQUMxQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRCQUE0QixPQUFPO0FBQ25DO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQSxvQ0FBb0MsT0FBTztBQUMzQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRCQUE0QixNQUFNO0FBQ2xDO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7O0FBRUw7QUFDQTtBQUNBLGdCQUFnQixNQUFNO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0IsS0FBSztBQUN6QjtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQSw0QkFBNEIsT0FBTztBQUNuQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBLGFBQWE7O0FBRWI7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0EsU0FBUztBQUNUO0FBQ0Esb0JBQW9CLE1BQU07QUFDMUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQixNQUFNO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QixPQUFPO0FBQy9CO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQSxnQ0FBZ0MsT0FBTztBQUN2QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0EsYUFBYTtBQUNiO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxLQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQixPQUFPO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0Esb0JBQW9CLE1BQU07QUFDMUI7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsTUFBTTtBQUM5QjtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVCQUF1QixTQUFTO0FBQ2hDO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsOEJBQThCLDhGQUE4RjtBQUM1SDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixPQUFPO0FBQzNCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsTUFBTTtBQUM5QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsOEJBQThCLFNBQVM7QUFDdkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQjtBQUNoQjs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQixNQUFNO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCO0FBQ3hCO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QixxQkFBcUIsR0FBRztBQUN4QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Qsa0NBQWtDLG9CQUFvQjs7QUFFdEQ7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGdCQUFnQixPQUFPO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLDJDQUEyQyx5Q0FBeUMsb0JBQW9CLG1DQUFtQztBQUMzSTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLE1BQU07QUFDdEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBLENBQUM7QUFDRDs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsOEJBQThCLFVBQVU7QUFDeEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0NBQW9DLE9BQU87QUFDM0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0Esb0NBQW9DLE9BQU87QUFDM0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0Esd0JBQXdCLE1BQU07QUFDOUI7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQ0FBaUM7QUFDakM7QUFDQTtBQUNBLDZCQUE2QjtBQUM3QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlDQUFpQztBQUNqQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0NBQW9DLHFCQUFxQjtBQUN6RCxxQ0FBcUMscUJBQXFCO0FBQzFELDRDQUE0QyxxQkFBcUI7QUFDakUscUNBQXFDLHFCQUFxQjtBQUMxRCx3Q0FBd0MsV0FBVztBQUNuRDtBQUNBLGtCQUFrQixNQUFNO0FBQ3hCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQixRQUFRO0FBQ3hCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9DQUFvQywwQkFBMEI7QUFDOUQscUNBQXFDLDBCQUEwQjtBQUMvRCw0Q0FBNEMsMEJBQTBCO0FBQ3RFLDZDQUE2QywwQkFBMEI7QUFDdkU7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNCQUFzQixTQUFTO0FBQy9CO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBLHNCQUFzQixTQUFTO0FBQy9CO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLDBCQUEwQjtBQUMxQjtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0EscURBQXFELHFCQUFxQjtBQUMxRSxzREFBc0Qsc0JBQXNCO0FBQzVFLHNEQUFzRCxzQkFBc0I7QUFDNUUsd0RBQXdELHdCQUF3QjtBQUNoRix3REFBd0QsbUJBQW1CO0FBQzNFLHFEQUFxRCxxQkFBcUI7QUFDMUUsa0RBQWtELGtCQUFrQjtBQUNwRSxvREFBb0Qsb0JBQW9CO0FBQ3hFLGlEQUFpRCxpQkFBaUI7QUFDbEUscURBQXFELHFCQUFxQjtBQUMxRTtBQUNBLEtBQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBLFNBQVM7QUFDVDtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLE1BQU07QUFDOUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0NBQXdDLE1BQU07QUFDOUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUNBQXVDLGdCQUFnQjtBQUN2RDtBQUNBLHVDQUF1QyxlQUFlO0FBQ3REO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsS0FBSzs7Ozs7QUFLTDs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLE1BQU07QUFDOUI7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhOztBQUViO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLE1BQU07QUFDMUI7QUFDQTtBQUNBLHFDQUFxQztBQUNyQztBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBOztBQUVBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsTUFBTTtBQUM5QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBOztBQUVBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBLDhEQUE4RDtBQUM5RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsK0RBQStEO0FBQy9EO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkRBQTZELElBQUk7QUFDakU7QUFDQTtBQUNBLGFBQWE7QUFDYiwwQkFBMEI7QUFDMUI7QUFDQSw2REFBNkQsSUFBSTtBQUNqRSwrREFBK0QsSUFBSTtBQUNuRSwrREFBK0QsSUFBSTtBQUNuRTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNEJBQTRCLHVCQUF1QjtBQUNuRCw0QkFBNEIsdUJBQXVCO0FBQ25ELDRCQUE0Qix1QkFBdUI7QUFDbkQ7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLDBDQUEwQyx1QkFBdUI7QUFDakUsMENBQTBDLHVCQUF1QjtBQUNqRSwwQ0FBMEMsdUJBQXVCO0FBQ2pFO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLE9BQU87QUFDM0Isd0JBQXdCLE9BQU87QUFDL0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsb0JBQW9CLE1BQU07QUFDMUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxxQ0FBcUMsU0FBUztBQUM5QyxxQ0FBcUMsU0FBUztBQUM5QyxxQ0FBcUMsU0FBUztBQUM5QztBQUNBLGNBQWM7QUFDZDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsS0FBSzs7QUFFTDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUNBQXFDO0FBQ3JDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLFNBQVM7QUFDN0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0dBQWdHO0FBQ2hHO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFDQUFxQztBQUNyQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLFNBQVM7QUFDN0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0Esd0NBQXdDO0FBQ3hDO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLG9CQUFvQixNQUFNO0FBQzFCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFjO0FBQ2Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxLQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsb0JBQW9CLE1BQU07QUFDMUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLEtBQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBLFNBQVM7QUFDVDtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLENBQUM7O0FBRUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBCQUEwQiwwRkFBMEY7QUFDcEg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLFlBQVksTUFBTTtBQUNsQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVksUUFBUTtBQUNwQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVk7QUFDWjs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1QsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVCxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSxjQUFjLFNBQVM7QUFDdkI7QUFDQTs7QUFFQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsZ0JBQWdCLE1BQU07QUFDdEI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQSxnQkFBZ0IsTUFBTTtBQUN0QjtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBLDRCQUE0QixPQUFPO0FBQ25DO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QixRQUFRO0FBQ2hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQixVQUFVO0FBQ3JDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekIscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkJBQTZCO0FBQzdCO0FBQ0E7QUFDQTtBQUNBLHlCO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxnQkFBZ0IsTUFBTTtBQUN0QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsY0FBYyxTQUFTO0FBQ3ZCO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0NBQXdDO0FBQ3hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVksTUFBTTtBQUNsQjtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsT0FBTztBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7OztBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLFlBQVksTUFBTTtBQUNsQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLE1BQU07QUFDbEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdEQUFnRDtBQUNoRDtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0Q0FBNEM7QUFDNUM7O0FBRUE7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRDQUE0QztBQUM1QztBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSw2Q0FBNkM7QUFDN0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGdCQUFnQixNQUFNO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsT0FBTztBQUMvQjtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsWUFBWSxNQUFNO0FBQ2xCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGNBQWMsU0FBUztBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxjQUFjLFVBQVU7QUFDeEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtCQUErQixLQUFLLHVCQUF1Qix1QkFBdUIscUJBQXFCLE1BQU0sdUJBQXVCLE1BQU0sbUJBQW1CLE1BQU0sMkJBQTJCLE9BQU8sbUJBQW1CLE9BQU8sbUJBQW1CLFdBQVc7O0FBRTdQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCLCtCQUErQjtBQUNqRDtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLE9BQU87QUFDL0I7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLE9BQU87QUFDL0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUNBQWlDLHVCQUF1QjtBQUN4RDs7QUFFQTtBQUNBO0FBQ0EscURBQXFELHVCQUF1QjtBQUM1RTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxXQUFXLGtCQUFrQjtBQUM3QjtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLG1CQUFtQjtBQUNuQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsQ0FBQztBQUNEOztBQUVBO0FBQ0Esc0NBQXNDLGtCQUFrQjtBQUN4RDs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwQkFBMEI7QUFDMUIsc0JBQXNCLFlBQVk7QUFDbEM7O0FBRUE7QUFDQTtBQUNBLDhCQUE4QixrQkFBa0I7O0FBRWhEOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSw4QkFBOEIsa0JBQWtCOztBQUVoRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVksU0FBUztBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBLFlBQVksU0FBUztBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFHQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLDhCQUE4QixrQkFBa0I7O0FBRWhEOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLFlBQVksU0FBUztBQUNyQjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFHQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQixRQUFRO0FBQzdCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxZQUFZLE1BQU07QUFDbEI7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLE1BQU07QUFDbEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0NBQXNDLDhCQUE4QjtBQUNwRTs7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGVBQWUsU0FBUztBQUN4QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBLDhCQUE4QjtBQUM5QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQixRQUFRO0FBQzdCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCLFFBQVE7QUFDN0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsWUFBWSxNQUFNO0FBQ2xCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxlQUFlLFNBQVM7O0FBRXhCO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBOzs7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0IsT0FBTztBQUMzQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0EsWUFBWSxNQUFNO0FBQ2xCO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLFlBQVksTUFBTTtBQUNsQjs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxlQUFlLFNBQVM7QUFDeEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLE1BQU07QUFDbEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVksTUFBTTtBQUNsQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLE1BQU07QUFDbEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGdCQUFnQjtBQUNoQixLQUFLO0FBQ0wsZ0JBQWdCO0FBQ2hCO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0NBQXNDO0FBQ3RDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBLFNBQVM7QUFDVDtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFHQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLE1BQU07QUFDMUI7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLE9BQU87QUFDbkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QixPQUFPO0FBQy9CO0FBQ0E7QUFDQTtBQUNBLHFFQUFxRTtBQUNyRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLFlBQVksT0FBTztBQUNuQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsWUFBWSxNQUFNO0FBQ2xCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSxNQUFNO0FBQ2xCO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFjLEtBQUs7QUFDbkI7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQSx3QkFBd0IsT0FBTztBQUMvQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBOztBQUVBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSxNQUFNO0FBQ2xCO0FBQ0E7QUFDQTtBQUNBLFlBQVksTUFBTTtBQUNsQjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLFlBQVksTUFBTTtBQUNsQjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVksTUFBTTtBQUNsQjtBQUNBOzs7QUFHQTs7QUFFQSxnQkFBZ0IsS0FBSztBQUNyQjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLE1BQU07QUFDbEI7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsZUFBZSxTQUFTO0FBQ3hCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLEtBQUs7QUFDekI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLGNBQWMsS0FBSztBQUNuQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0EsU0FBUztBQUNUO0FBQ0EsU0FBUztBQUNUO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxjQUFjLFlBQVk7QUFDMUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLE9BQU87QUFDbkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRCQUE0QixPQUFPO0FBQ25DO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0EsNEJBQTRCLE9BQU87QUFDbkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsTUFBTTtBQUN0QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsTUFBTTtBQUN0QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRDQUE0Qyx5QkFBeUI7QUFDckU7QUFDQSxnQkFBZ0IsTUFBTTtBQUN0QjtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVksT0FBTztBQUNuQjtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsT0FBTztBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0I7QUFDeEI7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVCQUF1QixTQUFTO0FBQ2hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5Q0FBeUMsV0FBVzs7QUFFcEQ7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxlQUFlLFNBQVM7QUFDeEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCLFVBQVU7QUFDckM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQ0FBaUM7QUFDakM7QUFDQTtBQUNBO0FBQ0EsNkJBQTZCO0FBQzdCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLG9CQUFvQixPQUFPO0FBQzNCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLE9BQU87QUFDM0I7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixPQUFPO0FBQzNCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixPQUFPO0FBQzNCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRCQUE0QixJQUFJO0FBQ2hDO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0NBQWdDLElBQUk7QUFDcEM7QUFDQTtBQUNBLDZCQUE2QjtBQUM3QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLG9CQUFvQixPQUFPO0FBQzNCOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7O0FBRWI7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBOzs7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0EsNkNBQTZDLGtGQUFrRjtBQUMvSDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxlQUFlLFNBQVM7QUFDeEI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxZQUFZLE1BQU07QUFDbEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLG9EO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVSxNQUFNO0FBQ2hCO0FBQ0E7QUFDQSx5QkFBeUIsV0FBVztBQUNwQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLE1BQU07QUFDbEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsUUFBUTtBQUNoQztBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlDQUFpQyxnQkFBZ0I7QUFDakQ7QUFDQTtBQUNBLGdEO0FBQ0EsNkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSxNQUFNO0FBQ2xCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLFlBQVksTUFBTTtBQUNsQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvREFBb0QsMEJBQTBCO0FBQzlFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1CQUFtQixTQUFTO0FBQzVCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxlQUFlLFNBQVM7QUFDeEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxlQUFlLFNBQVM7QUFDeEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLGVBQWUsU0FBUztBQUN4QjtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQ0FBbUMsaUNBQWlDO0FBQ3BFO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFHQTtBQUNBO0FBQ0EsZ0JBQWdCLE1BQU07QUFDdEI7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxnQkFBZ0IsTUFBTTtBQUN0QjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGdCQUFnQixNQUFNO0FBQ3RCO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsTUFBTTtBQUN0QjtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLGdCQUFnQixNQUFNO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxnQkFBZ0IsTUFBTTtBQUN0QjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGdCQUFnQixNQUFNO0FBQ3RCO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsZ0JBQWdCLE1BQU07QUFDdEI7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxnQkFBZ0IsTUFBTTtBQUN0QjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLHNCQUFzQixLQUFLO0FBQzNCO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsTUFBTTtBQUN0QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsZ0JBQWdCLE1BQU07QUFDdEI7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxLQUFLO0FBQ0w7QUFDQSxLQUFLO0FBQ0w7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0EsS0FBSztBQUNMO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSxPQUFPO0FBQ25CO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtCQUFrQixTQUFTO0FBQzNCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLENBQUM7O0FBRUQ7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsTUFBTTtBQUN0QjtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtDQUFrQyxVQUFVO0FBQzVDLG1DQUFtQyxVQUFVO0FBQzdDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLE1BQU07QUFDbEIsc0RBQXNELFVBQVU7QUFDaEU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSxLQUFLO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVksS0FBSztBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNDQUFzQyw4QkFBOEI7O0FBRXBFO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0EsU0FBUztBQUNUO0FBQ0E7O0FBRUEsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSxNQUFNO0FBQ2xCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQixRQUFRO0FBQzdCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxlQUFlLFNBQVM7QUFDeEI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUIsUUFBUTtBQUM3QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLE1BQU07QUFDbEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsWUFBWSxNQUFNO0FBQ2xCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGVBQWUsU0FBUztBQUN4QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQixNQUFNO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLFlBQVksTUFBTTtBQUNsQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLE1BQU07QUFDdEI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQ0FBa0MsVUFBVTtBQUM1QyxtQ0FBbUMsVUFBVTtBQUM3QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLE1BQU07QUFDbEIsc0RBQXNELFVBQVU7QUFDaEU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQ0FBc0MsMEJBQTBCO0FBQ2hFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGVBQWUsU0FBUztBQUN4QjtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQSxlQUFlLFNBQVM7QUFDeEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QixRQUFRO0FBQ2pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLHFCQUFxQixRQUFRO0FBQzdCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGVBQWUsU0FBUztBQUN4QjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxZQUFZLE1BQU07QUFDbEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZUFBZSxTQUFTO0FBQ3hCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1CQUFtQixVQUFVO0FBQzdCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLDRDQUE0Qzs7QUFFNUM7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsS0FBSzs7QUFFTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVksT0FBTztBQUNuQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLFlBQVksTUFBTTtBQUNsQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVksTUFBTTtBQUNsQjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGNBQWMsS0FBSztBQUNuQjtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBOztBQUVBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQSx3QkFBd0IsT0FBTztBQUMvQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBOztBQUVBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSxNQUFNO0FBQ2xCO0FBQ0E7QUFDQTtBQUNBLFlBQVksTUFBTTtBQUNsQjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQixNQUFNO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGNBQWMsS0FBSztBQUNuQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLE1BQU07QUFDbEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLE9BQU87QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxvQkFBb0IsT0FBTztBQUMzQjtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLE9BQU87QUFDdkI7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCLFNBQVM7QUFDcEM7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQSx1QkFBdUIsUUFBUTtBQUMvQjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOzs7O0FBSUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSw2Q0FBNkMsa0ZBQWtGOztBQUUvSDtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGVBQWUsU0FBUztBQUN4QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixPQUFPO0FBQzNCO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QixPQUFPO0FBQy9CO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1QsbUNBQW1DO0FBQ25DO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLFlBQVksTUFBTTtBQUNsQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLE9BQU87QUFDM0I7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCLFVBQVU7QUFDckM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0IsT0FBTztBQUMzQjtBQUNBO0FBQ0E7QUFDQSwyQkFBMkIsVUFBVTtBQUNyQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLEVBQUU7OztBQUdGO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsZ0JBQWdCLE1BQU07QUFDdEI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNDQUFzQywwQkFBMEI7QUFDaEU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBLGVBQWUsU0FBUztBQUN4QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLDZDQUE2QyxrRkFBa0Y7QUFDL0g7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGVBQWUsU0FBUztBQUN4QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCOztBQUVqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUEsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxZQUFZLE1BQU07QUFDbEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsTUFBTTtBQUN0QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLFlBQVksTUFBTTtBQUNsQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQixNQUFNO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0IsTUFBTTtBQUMxQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsTUFBTTtBQUN0QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7O0FBRUQ7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwQkFBMEIsVUFBVTtBQUNwQztBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1DQUFtQyxVQUFVO0FBQzdDO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0EsbUNBQW1DLFVBQVU7QUFDN0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxvQkFBb0IsTUFBTTtBQUMxQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlDQUF5QyxpQkFBaUI7QUFDMUQ7QUFDQSxvQkFBb0IsWUFBWTtBQUNoQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLOzs7QUFHTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxTQUFTO0FBQ1Qsd0NBQXdDLG9CQUFvQjtBQUM1RDtBQUNBLG9CQUFvQixNQUFNO0FBQzFCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtCQUFrQixTQUFTO0FBQzNCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixPQUFPO0FBQzNCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxvQ0FBb0MsV0FBVztBQUMvQyxvQkFBb0IsTUFBTTtBQUMxQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQ0FBb0MsV0FBVztBQUMvQyxvQkFBb0IsTUFBTTtBQUMxQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQ0FBb0MsV0FBVztBQUMvQyxvQkFBb0IsTUFBTTtBQUMxQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQ0FBb0MsV0FBVztBQUMvQyxvQkFBb0IsTUFBTTtBQUMxQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQixNQUFNO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLHVCQUF1QixnQkFBZ0I7QUFDdkM7QUFDQTs7QUFFQTtBQUNBLHNCQUFzQjtBQUN0QixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0EsMERBQTBEO0FBQzFELDRDQUE0QztBQUM1Qyw0Q0FBNEM7QUFDNUM7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBLDBCQUEwQjtBQUMxQixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQ0FBc0MsY0FBYztBQUNwRCxnQkFBZ0IsTUFBTTtBQUN0QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3Q0FBd0MsV0FBVztBQUNuRDtBQUNBLHdDQUF3QyxXQUFXO0FBQ25EO0FBQ0Esb0JBQW9CLE1BQU07QUFDMUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkNBQTJDLFFBQVEsaUJBQWlCO0FBQ3BFOztBQUVBLG1DQUFtQyxVQUFVLGlCQUFpQjtBQUM5RDtBQUNBOztBQUVBO0FBQ0E7QUFDQSw4Q0FBOEMsUUFBUTtBQUN0RCxvQkFBb0IsTUFBTTtBQUMxQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLE1BQU07QUFDOUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1DQUFtQyxXQUFXO0FBQzlDO0FBQ0Esd0JBQXdCLE1BQU07QUFDOUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdDQUFnQyxNQUFNO0FBQ3RDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdDQUFnQyxNQUFNO0FBQ3RDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0NBQWdDLE1BQU07QUFDdEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0NBQWdDLE1BQU07QUFDdEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDs7QUFFQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0EsU0FBUzs7QUFFVDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQiw0QkFBNEIsUUFBUTtBQUNwQztBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7QUFDQSw2QkFBNkI7QUFDN0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLHdCQUF3QjtBQUN4QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixNQUFNO0FBQzFCO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsOEJBQThCLFNBQVM7QUFDdkM7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0EsMEJBQTBCLFNBQVM7QUFDbkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLE1BQU07QUFDdEI7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBLGFBQWE7QUFDYjtBQUNBLGFBQWE7QUFDYjtBQUNBLGFBQWE7QUFDYjtBQUNBLGFBQWE7QUFDYjtBQUNBLGFBQWE7QUFDYjtBQUNBLGFBQWE7QUFDYjtBQUNBLGFBQWE7QUFDYjtBQUNBLGFBQWE7QUFDYjtBQUNBLGFBQWE7QUFDYjtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCO0FBQ2hCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLOztBQUVMO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLCtEQUErRCxrQkFBa0I7QUFDakYsNERBQTRELGtCQUFrQjs7QUFFOUU7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCLFNBQVM7QUFDaEM7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYiwrREFBK0Qsa0JBQWtCO0FBQ2pGLDREQUE0RCxrQkFBa0I7O0FBRTlFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLEtBQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxLQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTs7QUFFYjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxLQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhOztBQUViO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLEtBQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTs7QUFFYjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7O0FBRWI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYiwrREFBK0Qsa0JBQWtCO0FBQ2pGLDREQUE0RCxrQkFBa0I7QUFDOUUsNERBQTRELGtCQUFrQjtBQUM5RTtBQUNBO0FBQ0EsS0FBSzs7O0FBR0w7QUFDQSxDQUFDOztBQUVEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixNQUFNO0FBQzFCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixNQUFNO0FBQzFCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixNQUFNO0FBQzFCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBR0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVULDREQUE0RCxxQkFBcUI7QUFDakY7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDOztBQUVEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CO0FBQ3BCO0FBQ0EsNERBQTRELHFCQUFxQjtBQUNqRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0EsQ0FBQztBQUNEOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBOzs7O0FBSUE7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixNQUFNO0FBQzFCO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsTUFBTTtBQUN0QjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsK0NBQStDLFlBQVk7QUFDM0Qsd0NBQXdDLFlBQVk7QUFDcEQscUJBQXFCLFNBQVM7QUFDOUI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBLDhDQUE4QyxZQUFZO0FBQzFELHVDQUF1QyxZQUFZO0FBQ25ELG9CQUFvQixTQUFTO0FBQzdCO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLE1BQU07QUFDbEI7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsWUFBWSxNQUFNO0FBQ2xCO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVksTUFBTTtBQUNsQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEVBQUUscUJBQXFCLDBCQUEwQixrQ0FBa0MsRUFBRSwyQkFBMkIsbUNBQW1DLEVBQUUsaUNBQWlDLHlDQUF5QyxFQUFFLG9DQUFvQyw2Q0FBNkMsRUFBRSx3Q0FBd0MsaURBQWlELEVBQUUsMEJBQTBCLGtDQUFrQyxFQUFFLDJCQUEyQixtQ0FBbUMsRUFBRSw2QkFBNkIseUJBQXlCLHVFQUF1RSxFQUFFLEtBQUsscUNBQXFDLEVBQUUsRUFBRSxrQ0FBa0MsaURBQWlELEVBQUUsbUJBQW1CLDJCQUEyQixFQUFFLGtCQUFrQiwwQkFBMEIsRUFBRSw4Q0FBOEMsc0RBQXNELEVBQUUscUNBQXFDLHdCQUF3QixFQUFFLGdDQUFnQyx5QkFBeUIsa0RBQWtELEVBQUUsK0NBQStDLEVBQUUsNkJBQTZCLDRDQUE0QyxFQUFFLDRCQUE0QiwrQkFBK0IsZUFBZSx5Q0FBeUMsT0FBTywwQ0FBMEMsT0FBTyx1Q0FBdUMsT0FBTyxFQUFFLEVBQUUsb0NBQW9DLDhCQUE4QixFQUFFLGdDQUFnQyxvQkFBb0IsRUFBRSxLQUFLLG1CQUFtQixFQUFFLEVBQUUsdUJBQXVCLHlDQUF5QyxFQUFFLHFDQUFxQywwQkFBMEIsNEJBQTRCLEVBQUUsRUFBRSwyQkFBMkIsY0FBYyxnREFBZ0QseURBQXlELDhCQUE4QixFQUFFLEVBQUUseUJBQXlCLDJCQUEyQix1Q0FBdUMsaUNBQWlDLHlDQUF5Qyx5QkFBeUIsbUNBQW1DLGlEQUFpRCxtREFBbUQsMkNBQTJDLHlEQUF5RCw2QkFBNkIsMkJBQTJCLHVDQUF1QywrQkFBK0IscUNBQXFDLG1DQUFtQywyQ0FBMkMsdUNBQXVDLCtCQUErQix1QkFBdUIsMENBQTBDLHdDQUF3QyxvQkFBb0IsRUFBRSxFQUFFLHNDQUFzQyxtQ0FBbUMsZ0JBQWdCLGlCQUFpQixPQUFPLCtCQUErQiwrQ0FBK0Msb0NBQW9DLEVBQUUsRUFBRSxFQUFFLHFDQUFxQywyQ0FBMkMsbUJBQW1CLGlCQUFpQix1REFBdUQsZ0NBQWdDLG1DQUFtQyxXQUFXLHlEQUF5RCx5Q0FBeUMsRUFBRSw0REFBNEQsb0JBQW9CLEVBQUUsRyIsImZpbGUiOiJhcHAuanMiLCJzb3VyY2VzQ29udGVudCI6WyIgXHQvLyBUaGUgbW9kdWxlIGNhY2hlXG4gXHR2YXIgaW5zdGFsbGVkTW9kdWxlcyA9IHt9O1xuXG4gXHQvLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuIFx0ZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXG4gXHRcdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuIFx0XHRpZihpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSkge1xuIFx0XHRcdHJldHVybiBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXS5leHBvcnRzO1xuIFx0XHR9XG4gXHRcdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG4gXHRcdHZhciBtb2R1bGUgPSBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSA9IHtcbiBcdFx0XHRpOiBtb2R1bGVJZCxcbiBcdFx0XHRsOiBmYWxzZSxcbiBcdFx0XHRleHBvcnRzOiB7fVxuIFx0XHR9O1xuXG4gXHRcdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuIFx0XHRtb2R1bGVzW21vZHVsZUlkXS5jYWxsKG1vZHVsZS5leHBvcnRzLCBtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblxuIFx0XHQvLyBGbGFnIHRoZSBtb2R1bGUgYXMgbG9hZGVkXG4gXHRcdG1vZHVsZS5sID0gdHJ1ZTtcblxuIFx0XHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuIFx0XHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG4gXHR9XG5cblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGVzIG9iamVjdCAoX193ZWJwYWNrX21vZHVsZXNfXylcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubSA9IG1vZHVsZXM7XG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlIGNhY2hlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmMgPSBpbnN0YWxsZWRNb2R1bGVzO1xuXG4gXHQvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9uIGZvciBoYXJtb255IGV4cG9ydHNcbiBcdF9fd2VicGFja19yZXF1aXJlX18uZCA9IGZ1bmN0aW9uKGV4cG9ydHMsIG5hbWUsIGdldHRlcikge1xuIFx0XHRpZighX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIG5hbWUpKSB7XG4gXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIG5hbWUsIHtcbiBcdFx0XHRcdGNvbmZpZ3VyYWJsZTogZmFsc2UsXG4gXHRcdFx0XHRlbnVtZXJhYmxlOiB0cnVlLFxuIFx0XHRcdFx0Z2V0OiBnZXR0ZXJcbiBcdFx0XHR9KTtcbiBcdFx0fVxuIFx0fTtcblxuIFx0Ly8gZ2V0RGVmYXVsdEV4cG9ydCBmdW5jdGlvbiBmb3IgY29tcGF0aWJpbGl0eSB3aXRoIG5vbi1oYXJtb255IG1vZHVsZXNcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubiA9IGZ1bmN0aW9uKG1vZHVsZSkge1xuIFx0XHR2YXIgZ2V0dGVyID0gbW9kdWxlICYmIG1vZHVsZS5fX2VzTW9kdWxlID9cbiBcdFx0XHRmdW5jdGlvbiBnZXREZWZhdWx0KCkgeyByZXR1cm4gbW9kdWxlWydkZWZhdWx0J107IH0gOlxuIFx0XHRcdGZ1bmN0aW9uIGdldE1vZHVsZUV4cG9ydHMoKSB7IHJldHVybiBtb2R1bGU7IH07XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18uZChnZXR0ZXIsICdhJywgZ2V0dGVyKTtcbiBcdFx0cmV0dXJuIGdldHRlcjtcbiBcdH07XG5cbiBcdC8vIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbFxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5vID0gZnVuY3Rpb24ob2JqZWN0LCBwcm9wZXJ0eSkgeyByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwgcHJvcGVydHkpOyB9O1xuXG4gXHQvLyBfX3dlYnBhY2tfcHVibGljX3BhdGhfX1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5wID0gXCJcIjtcblxuIFx0Ly8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4gXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXyhfX3dlYnBhY2tfcmVxdWlyZV9fLnMgPSAwKTtcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyB3ZWJwYWNrL2Jvb3RzdHJhcCBjZjc4MDdlNDcwNWE4MWQwMmM0YSIsImltcG9ydCBib2R5bW92aW4gZnJvbSAnYm9keW1vdmluJ1xuXG52YXIgYW5pbWF0aW9uID0gYm9keW1vdmluLmxvYWRBbmltYXRpb24oe1xuICBjb250YWluZXI6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdibScpLFxuICByZW5kZXJlcjogJ3N2ZycsXG4gIGxvb3A6IHRydWUsXG4gIGF1dG9wbGF5OiB0cnVlLFxuICBwYXRoOiAnL3Jlc291cmNlcy9taWxkX3dhdmUuanNvbidcbn0pXG52YXIgYW5pbWF0aW9uMiA9IGJvZHltb3Zpbi5sb2FkQW5pbWF0aW9uKHtcbiAgY29udGFpbmVyOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYm0yJyksXG4gIHJlbmRlcmVyOiAnc3ZnJyxcbiAgbG9vcDogdHJ1ZSxcbiAgYXV0b3BsYXk6IHRydWUsXG4gIHBhdGg6ICcvcmVzb3VyY2VzL2NoZWNrX21hcmsuanNvbidcbn0pXG52YXIgYW5pbWF0aW9uMyA9IGJvZHltb3Zpbi5sb2FkQW5pbWF0aW9uKHtcbiAgY29udGFpbmVyOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYm0zJyksXG4gIHJlbmRlcmVyOiAnc3ZnJyxcbiAgbG9vcDogdHJ1ZSxcbiAgYXV0b3BsYXk6IHRydWUsXG4gIHBhdGg6ICcvcmVzb3VyY2VzL2NoYW5naW5nLmpzb24nXG59KVxudmFyIGFuaW1hdGlvbjQgPSBib2R5bW92aW4ubG9hZEFuaW1hdGlvbih7XG4gIGNvbnRhaW5lcjogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JtNCcpLFxuICByZW5kZXJlcjogJ3N2ZycsXG4gIGxvb3A6IHRydWUsXG4gIGF1dG9wbGF5OiB0cnVlLFxuICBwYXRoOiAnL3Jlc291cmNlcy9qdW1wX2xvYWRlci5qc29uJ1xufSlcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyAuL3NyYy9hcHAuanMiLCJ2YXIgd2luZG93PSh0eXBlb2Ygd2luZG93ID09PSBcInVuZGVmaW5lZFwiKT97fTp3aW5kb3c7KGZ1bmN0aW9uIChyb290LCBmYWN0b3J5KSB7IGlmKHR5cGVvZiBkZWZpbmUgPT09IFwiZnVuY3Rpb25cIiAmJiBkZWZpbmUuYW1kKSB7IGRlZmluZSggZmFjdG9yeSk7IH0gZWxzZSBpZih0eXBlb2YgbW9kdWxlID09PSBcIm9iamVjdFwiICYmIG1vZHVsZS5leHBvcnRzKSB7IG1vZHVsZS5leHBvcnRzID0gZmFjdG9yeSgpOyB9IGVsc2UgeyByb290LmJvZHltb3ZpbiA9IGZhY3RvcnkoKTsgfSB9KHdpbmRvdywgZnVuY3Rpb24oKSB7dmFyIHN2Z05TID0gXCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z1wiO1xudmFyIHN1YmZyYW1lRW5hYmxlZCA9IGZhbHNlO1xyXG52YXIgZXhwcmVzc2lvbnNQbHVnaW47XHJcbnZhciBpc1NhZmFyaSA9IC9eKCg/IWNocm9tZXxhbmRyb2lkKS4pKnNhZmFyaS9pLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCk7XHJcbnZhciBjYWNoZWRDb2xvcnMgPSB7fTtcclxudmFyIGJtX3JvdW5kZXIgPSBNYXRoLnJvdW5kO1xyXG52YXIgYm1fcm5kO1xyXG52YXIgYm1fcG93ID0gTWF0aC5wb3c7XHJcbnZhciBibV9zcXJ0ID0gTWF0aC5zcXJ0O1xyXG52YXIgYm1fYWJzID0gTWF0aC5hYnM7XHJcbnZhciBibV9mbG9vciA9IE1hdGguZmxvb3I7XHJcbnZhciBibV9tYXggPSBNYXRoLm1heDtcclxudmFyIGJtX21pbiA9IE1hdGgubWluO1xyXG52YXIgYmxpdHRlciA9IDEwO1xyXG5cclxudmFyIEJNTWF0aCA9IHt9O1xyXG4oZnVuY3Rpb24oKXtcclxuICAgIHZhciBwcm9wZXJ0eU5hbWVzID0gT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMoTWF0aCk7XHJcbiAgICB2YXIgaSwgbGVuID0gcHJvcGVydHlOYW1lcy5sZW5ndGg7XHJcbiAgICBmb3IoaT0wO2k8bGVuO2krPTEpe1xyXG4gICAgICAgIEJNTWF0aFtwcm9wZXJ0eU5hbWVzW2ldXSA9IE1hdGhbcHJvcGVydHlOYW1lc1tpXV07XHJcbiAgICB9XHJcbn0oKSk7XHJcblxyXG5mdW5jdGlvbiBQcm9qZWN0SW50ZXJmYWNlKCl7cmV0dXJuIHt9fTtcclxuXHJcbkJNTWF0aC5yYW5kb20gPSBNYXRoLnJhbmRvbTtcclxuQk1NYXRoLmFicyA9IGZ1bmN0aW9uKHZhbCl7XHJcbiAgICB2YXIgdE9mVmFsID0gdHlwZW9mIHZhbDtcclxuICAgIGlmKHRPZlZhbCA9PT0gJ29iamVjdCcgJiYgdmFsLmxlbmd0aCl7XHJcbiAgICAgICAgdmFyIGFic0FyciA9IEFycmF5LmFwcGx5KG51bGwse2xlbmd0aDp2YWwubGVuZ3RofSk7XHJcbiAgICAgICAgdmFyIGksIGxlbiA9IHZhbC5sZW5ndGg7XHJcbiAgICAgICAgZm9yKGk9MDtpPGxlbjtpKz0xKXtcclxuICAgICAgICAgICAgYWJzQXJyW2ldID0gTWF0aC5hYnModmFsW2ldKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGFic0FycjtcclxuICAgIH1cclxuICAgIHJldHVybiBNYXRoLmFicyh2YWwpO1xyXG5cclxufVxyXG52YXIgZGVmYXVsdEN1cnZlU2VnbWVudHMgPSAxNTA7XHJcbnZhciBkZWdUb1JhZHMgPSBNYXRoLlBJLzE4MDtcclxudmFyIHJvdW5kQ29ybmVyID0gMC41NTE5O1xyXG5cclxuZnVuY3Rpb24gcm91bmRWYWx1ZXMoZmxhZyl7XHJcbiAgICBpZihmbGFnKXtcclxuICAgICAgICBibV9ybmQgPSBNYXRoLnJvdW5kO1xyXG4gICAgfWVsc2V7XHJcbiAgICAgICAgYm1fcm5kID0gZnVuY3Rpb24odmFsKXtcclxuICAgICAgICAgICAgcmV0dXJuIHZhbDtcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG59XHJcbnJvdW5kVmFsdWVzKGZhbHNlKTtcclxuXHJcbmZ1bmN0aW9uIHJvdW5kVG8yRGVjaW1hbHModmFsKXtcclxuICAgIHJldHVybiBNYXRoLnJvdW5kKHZhbCoxMDAwMCkvMTAwMDA7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHJvdW5kVG8zRGVjaW1hbHModmFsKXtcclxuICAgIHJldHVybiBNYXRoLnJvdW5kKHZhbCoxMDApLzEwMDtcclxufVxyXG5cclxuZnVuY3Rpb24gc3R5bGVEaXYoZWxlbWVudCl7XHJcbiAgICBlbGVtZW50LnN0eWxlLnBvc2l0aW9uID0gJ2Fic29sdXRlJztcclxuICAgIGVsZW1lbnQuc3R5bGUudG9wID0gMDtcclxuICAgIGVsZW1lbnQuc3R5bGUubGVmdCA9IDA7XHJcbiAgICBlbGVtZW50LnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snO1xyXG4gICAgZWxlbWVudC5zdHlsZS50cmFuc2Zvcm1PcmlnaW4gPSBlbGVtZW50LnN0eWxlLndlYmtpdFRyYW5zZm9ybU9yaWdpbiA9ICcwIDAnO1xyXG4gICAgZWxlbWVudC5zdHlsZS5iYWNrZmFjZVZpc2liaWxpdHkgID0gZWxlbWVudC5zdHlsZS53ZWJraXRCYWNrZmFjZVZpc2liaWxpdHkgPSAndmlzaWJsZSc7XHJcbiAgICBlbGVtZW50LnN0eWxlLnRyYW5zZm9ybVN0eWxlID0gZWxlbWVudC5zdHlsZS53ZWJraXRUcmFuc2Zvcm1TdHlsZSA9IGVsZW1lbnQuc3R5bGUubW96VHJhbnNmb3JtU3R5bGUgPSBcInByZXNlcnZlLTNkXCI7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHN0eWxlVW5zZWxlY3RhYmxlRGl2KGVsZW1lbnQpe1xyXG4gICAgZWxlbWVudC5zdHlsZS51c2VyU2VsZWN0ID0gJ25vbmUnO1xyXG4gICAgZWxlbWVudC5zdHlsZS5Nb3pVc2VyU2VsZWN0ID0gJ25vbmUnO1xyXG4gICAgZWxlbWVudC5zdHlsZS53ZWJraXRVc2VyU2VsZWN0ID0gJ25vbmUnO1xyXG4gICAgZWxlbWVudC5zdHlsZS5vVXNlclNlbGVjdCA9ICdub25lJztcclxuXHJcbn1cclxuXHJcbmZ1bmN0aW9uIEJNRW50ZXJGcmFtZUV2ZW50KG4sYyx0LGQpe1xyXG4gICAgdGhpcy50eXBlID0gbjtcclxuICAgIHRoaXMuY3VycmVudFRpbWUgPSBjO1xyXG4gICAgdGhpcy50b3RhbFRpbWUgPSB0O1xyXG4gICAgdGhpcy5kaXJlY3Rpb24gPSBkIDwgMCA/IC0xOjE7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIEJNQ29tcGxldGVFdmVudChuLGQpe1xyXG4gICAgdGhpcy50eXBlID0gbjtcclxuICAgIHRoaXMuZGlyZWN0aW9uID0gZCA8IDAgPyAtMToxO1xyXG59XHJcblxyXG5mdW5jdGlvbiBCTUNvbXBsZXRlTG9vcEV2ZW50KG4sYyx0LGQpe1xyXG4gICAgdGhpcy50eXBlID0gbjtcclxuICAgIHRoaXMuY3VycmVudExvb3AgPSBjO1xyXG4gICAgdGhpcy50b3RhbExvb3BzID0gdDtcclxuICAgIHRoaXMuZGlyZWN0aW9uID0gZCA8IDAgPyAtMToxO1xyXG59XHJcblxyXG5mdW5jdGlvbiBCTVNlZ21lbnRTdGFydEV2ZW50KG4sZix0KXtcclxuICAgIHRoaXMudHlwZSA9IG47XHJcbiAgICB0aGlzLmZpcnN0RnJhbWUgPSBmO1xyXG4gICAgdGhpcy50b3RhbEZyYW1lcyA9IHQ7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIEJNRGVzdHJveUV2ZW50KG4sdCl7XHJcbiAgICB0aGlzLnR5cGUgPSBuO1xyXG4gICAgdGhpcy50YXJnZXQgPSB0O1xyXG59XHJcblxyXG5mdW5jdGlvbiBfYWRkRXZlbnRMaXN0ZW5lcihldmVudE5hbWUsIGNhbGxiYWNrKXtcclxuXHJcbiAgICBpZiAoIXRoaXMuX2Nic1tldmVudE5hbWVdKXtcclxuICAgICAgICB0aGlzLl9jYnNbZXZlbnROYW1lXSA9IFtdO1xyXG4gICAgfVxyXG4gICAgdGhpcy5fY2JzW2V2ZW50TmFtZV0ucHVzaChjYWxsYmFjayk7XHJcblxyXG5cdHJldHVybiBmdW5jdGlvbigpIHtcclxuXHRcdHRoaXMucmVtb3ZlRXZlbnRMaXN0ZW5lcihldmVudE5hbWUsIGNhbGxiYWNrKTtcclxuXHR9LmJpbmQodGhpcyk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIF9yZW1vdmVFdmVudExpc3RlbmVyKGV2ZW50TmFtZSxjYWxsYmFjayl7XHJcblxyXG4gICAgaWYgKCFjYWxsYmFjayl7XHJcbiAgICAgICAgdGhpcy5fY2JzW2V2ZW50TmFtZV0gPSBudWxsO1xyXG4gICAgfWVsc2UgaWYodGhpcy5fY2JzW2V2ZW50TmFtZV0pe1xyXG4gICAgICAgIHZhciBpID0gMCwgbGVuID0gdGhpcy5fY2JzW2V2ZW50TmFtZV0ubGVuZ3RoO1xyXG4gICAgICAgIHdoaWxlKGk8bGVuKXtcclxuICAgICAgICAgICAgaWYodGhpcy5fY2JzW2V2ZW50TmFtZV1baV0gPT09IGNhbGxiYWNrKXtcclxuICAgICAgICAgICAgICAgIHRoaXMuX2Nic1tldmVudE5hbWVdLnNwbGljZShpLDEpO1xyXG4gICAgICAgICAgICAgICAgaSAtPTE7XHJcbiAgICAgICAgICAgICAgICBsZW4gLT0gMTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpICs9IDE7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmKCF0aGlzLl9jYnNbZXZlbnROYW1lXS5sZW5ndGgpe1xyXG4gICAgICAgICAgICB0aGlzLl9jYnNbZXZlbnROYW1lXSA9IG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxufVxyXG5cclxuZnVuY3Rpb24gX3RyaWdnZXJFdmVudChldmVudE5hbWUsIGFyZ3Mpe1xyXG4gICAgaWYgKHRoaXMuX2Nic1tldmVudE5hbWVdKSB7XHJcbiAgICAgICAgdmFyIGxlbiA9IHRoaXMuX2Nic1tldmVudE5hbWVdLmxlbmd0aDtcclxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbjsgaSsrKXtcclxuICAgICAgICAgICAgdGhpcy5fY2JzW2V2ZW50TmFtZV1baV0oYXJncyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiByYW5kb21TdHJpbmcobGVuZ3RoLCBjaGFycyl7XHJcbiAgICBpZihjaGFycyA9PT0gdW5kZWZpbmVkKXtcclxuICAgICAgICBjaGFycyA9ICdhYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ekFCQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaMTIzNDU2Nzg5MCc7XHJcbiAgICB9XHJcbiAgICB2YXIgaTtcclxuICAgIHZhciByZXN1bHQgPSAnJztcclxuICAgIGZvciAoaSA9IGxlbmd0aDsgaSA+IDA7IC0taSkgcmVzdWx0ICs9IGNoYXJzW01hdGgucm91bmQoTWF0aC5yYW5kb20oKSAqIChjaGFycy5sZW5ndGggLSAxKSldO1xyXG4gICAgcmV0dXJuIHJlc3VsdDtcclxufVxyXG5cclxuZnVuY3Rpb24gSFNWdG9SR0IoaCwgcywgdikge1xyXG4gICAgdmFyIHIsIGcsIGIsIGksIGYsIHAsIHEsIHQ7XHJcbiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMSkge1xyXG4gICAgICAgIHMgPSBoLnMsIHYgPSBoLnYsIGggPSBoLmg7XHJcbiAgICB9XHJcbiAgICBpID0gTWF0aC5mbG9vcihoICogNik7XHJcbiAgICBmID0gaCAqIDYgLSBpO1xyXG4gICAgcCA9IHYgKiAoMSAtIHMpO1xyXG4gICAgcSA9IHYgKiAoMSAtIGYgKiBzKTtcclxuICAgIHQgPSB2ICogKDEgLSAoMSAtIGYpICogcyk7XHJcbiAgICBzd2l0Y2ggKGkgJSA2KSB7XHJcbiAgICAgICAgY2FzZSAwOiByID0gdiwgZyA9IHQsIGIgPSBwOyBicmVhaztcclxuICAgICAgICBjYXNlIDE6IHIgPSBxLCBnID0gdiwgYiA9IHA7IGJyZWFrO1xyXG4gICAgICAgIGNhc2UgMjogciA9IHAsIGcgPSB2LCBiID0gdDsgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAzOiByID0gcCwgZyA9IHEsIGIgPSB2OyBicmVhaztcclxuICAgICAgICBjYXNlIDQ6IHIgPSB0LCBnID0gcCwgYiA9IHY7IGJyZWFrO1xyXG4gICAgICAgIGNhc2UgNTogciA9IHYsIGcgPSBwLCBiID0gcTsgYnJlYWs7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gWyByLFxyXG4gICAgICAgIGcsXHJcbiAgICAgICAgIGIgXTtcclxufVxyXG5cclxuZnVuY3Rpb24gUkdCdG9IU1YociwgZywgYikge1xyXG4gICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDEpIHtcclxuICAgICAgICBnID0gci5nLCBiID0gci5iLCByID0gci5yO1xyXG4gICAgfVxyXG4gICAgdmFyIG1heCA9IE1hdGgubWF4KHIsIGcsIGIpLCBtaW4gPSBNYXRoLm1pbihyLCBnLCBiKSxcclxuICAgICAgICBkID0gbWF4IC0gbWluLFxyXG4gICAgICAgIGgsXHJcbiAgICAgICAgcyA9IChtYXggPT09IDAgPyAwIDogZCAvIG1heCksXHJcbiAgICAgICAgdiA9IG1heCAvIDI1NTtcclxuXHJcbiAgICBzd2l0Y2ggKG1heCkge1xyXG4gICAgICAgIGNhc2UgbWluOiBoID0gMDsgYnJlYWs7XHJcbiAgICAgICAgY2FzZSByOiBoID0gKGcgLSBiKSArIGQgKiAoZyA8IGIgPyA2OiAwKTsgaCAvPSA2ICogZDsgYnJlYWs7XHJcbiAgICAgICAgY2FzZSBnOiBoID0gKGIgLSByKSArIGQgKiAyOyBoIC89IDYgKiBkOyBicmVhaztcclxuICAgICAgICBjYXNlIGI6IGggPSAociAtIGcpICsgZCAqIDQ7IGggLz0gNiAqIGQ7IGJyZWFrO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBbXHJcbiAgICAgICAgIGgsXHJcbiAgICAgICAgIHMsXHJcbiAgICAgICAgIHZcclxuICAgIF07XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGFkZFNhdHVyYXRpb25Ub1JHQihjb2xvcixvZmZzZXQpe1xyXG4gICAgdmFyIGhzdiA9IFJHQnRvSFNWKGNvbG9yWzBdKjI1NSxjb2xvclsxXSoyNTUsY29sb3JbMl0qMjU1KTtcclxuICAgIGhzdlsxXSArPSBvZmZzZXQ7XHJcbiAgICBpZiAoaHN2WzFdID4gMSkge1xyXG4gICAgICAgIGhzdlsxXSA9IDE7XHJcbiAgICB9XHJcbiAgICBlbHNlIGlmIChoc3ZbMV0gPD0gMCkge1xyXG4gICAgICAgIGhzdlsxXSA9IDA7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gSFNWdG9SR0IoaHN2WzBdLGhzdlsxXSxoc3ZbMl0pO1xyXG59XHJcblxyXG5mdW5jdGlvbiBhZGRCcmlnaHRuZXNzVG9SR0IoY29sb3Isb2Zmc2V0KXtcclxuICAgIHZhciBoc3YgPSBSR0J0b0hTVihjb2xvclswXSoyNTUsY29sb3JbMV0qMjU1LGNvbG9yWzJdKjI1NSk7XHJcbiAgICBoc3ZbMl0gKz0gb2Zmc2V0O1xyXG4gICAgaWYgKGhzdlsyXSA+IDEpIHtcclxuICAgICAgICBoc3ZbMl0gPSAxO1xyXG4gICAgfVxyXG4gICAgZWxzZSBpZiAoaHN2WzJdIDwgMCkge1xyXG4gICAgICAgIGhzdlsyXSA9IDA7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gSFNWdG9SR0IoaHN2WzBdLGhzdlsxXSxoc3ZbMl0pO1xyXG59XHJcblxyXG5mdW5jdGlvbiBhZGRIdWVUb1JHQihjb2xvcixvZmZzZXQpIHtcclxuICAgIHZhciBoc3YgPSBSR0J0b0hTVihjb2xvclswXSoyNTUsY29sb3JbMV0qMjU1LGNvbG9yWzJdKjI1NSk7XHJcbiAgICBoc3ZbMF0gKz0gb2Zmc2V0LzM2MDtcclxuICAgIGlmIChoc3ZbMF0gPiAxKSB7XHJcbiAgICAgICAgaHN2WzBdIC09IDE7XHJcbiAgICB9XHJcbiAgICBlbHNlIGlmIChoc3ZbMF0gPCAwKSB7XHJcbiAgICAgICAgaHN2WzBdICs9IDE7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gSFNWdG9SR0IoaHN2WzBdLGhzdlsxXSxoc3ZbMl0pO1xyXG59XHJcblxyXG5mdW5jdGlvbiBjb21wb25lbnRUb0hleChjKSB7XHJcbiAgICB2YXIgaGV4ID0gYy50b1N0cmluZygxNik7XHJcbiAgICByZXR1cm4gaGV4Lmxlbmd0aCA9PSAxID8gJzAnICsgaGV4IDogaGV4O1xyXG59XHJcblxyXG52YXIgcmdiVG9IZXggPSAoZnVuY3Rpb24oKXtcclxuICAgIHZhciBjb2xvck1hcCA9IFtdO1xyXG4gICAgdmFyIGk7XHJcbiAgICB2YXIgaGV4O1xyXG4gICAgZm9yKGk9MDtpPDI1NjtpKz0xKXtcclxuICAgICAgICBoZXggPSBpLnRvU3RyaW5nKDE2KTtcclxuICAgICAgICBjb2xvck1hcFtpXSA9IGhleC5sZW5ndGggPT0gMSA/ICcwJyArIGhleCA6IGhleDtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gZnVuY3Rpb24ociwgZywgYikge1xyXG4gICAgICAgIGlmKHI8MCl7XHJcbiAgICAgICAgICAgIHIgPSAwO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZihnPDApe1xyXG4gICAgICAgICAgICBnID0gMDtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYoYjwwKXtcclxuICAgICAgICAgICAgYiA9IDA7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiAnIycgKyBjb2xvck1hcFtyXSArIGNvbG9yTWFwW2ddICsgY29sb3JNYXBbYl07XHJcbiAgICB9O1xyXG59KCkpO1xyXG5cclxuZnVuY3Rpb24gZmlsbFRvUmdiYShoZXgsYWxwaGEpe1xyXG4gICAgaWYoIWNhY2hlZENvbG9yc1toZXhdKXtcclxuICAgICAgICB2YXIgcmVzdWx0ID0gL14jPyhbYS1mXFxkXXsyfSkoW2EtZlxcZF17Mn0pKFthLWZcXGRdezJ9KSQvaS5leGVjKGhleCk7XHJcbiAgICAgICAgY2FjaGVkQ29sb3JzW2hleF0gPSBwYXJzZUludChyZXN1bHRbMV0sIDE2KSsnLCcrcGFyc2VJbnQocmVzdWx0WzJdLCAxNikrJywnK3BhcnNlSW50KHJlc3VsdFszXSwgMTYpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuICdyZ2JhKCcrY2FjaGVkQ29sb3JzW2hleF0rJywnK2FscGhhKycpJztcclxufVxyXG5cclxudmFyIGZpbGxDb2xvclRvU3RyaW5nID0gKGZ1bmN0aW9uKCl7XHJcblxyXG4gICAgdmFyIGNvbG9yTWFwID0gW107XHJcbiAgICByZXR1cm4gZnVuY3Rpb24oY29sb3JBcnIsYWxwaGEpe1xyXG4gICAgICAgIGlmKGFscGhhICE9PSB1bmRlZmluZWQpe1xyXG4gICAgICAgICAgICBjb2xvckFyclszXSA9IGFscGhhO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZighY29sb3JNYXBbY29sb3JBcnJbMF1dKXtcclxuICAgICAgICAgICAgY29sb3JNYXBbY29sb3JBcnJbMF1dID0ge307XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmKCFjb2xvck1hcFtjb2xvckFyclswXV1bY29sb3JBcnJbMV1dKXtcclxuICAgICAgICAgICAgY29sb3JNYXBbY29sb3JBcnJbMF1dW2NvbG9yQXJyWzFdXSA9IHt9O1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZighY29sb3JNYXBbY29sb3JBcnJbMF1dW2NvbG9yQXJyWzFdXVtjb2xvckFyclsyXV0pe1xyXG4gICAgICAgICAgICBjb2xvck1hcFtjb2xvckFyclswXV1bY29sb3JBcnJbMV1dW2NvbG9yQXJyWzJdXSA9IHt9O1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZighY29sb3JNYXBbY29sb3JBcnJbMF1dW2NvbG9yQXJyWzFdXVtjb2xvckFyclsyXV1bY29sb3JBcnJbM11dKXtcclxuICAgICAgICAgICAgY29sb3JNYXBbY29sb3JBcnJbMF1dW2NvbG9yQXJyWzFdXVtjb2xvckFyclsyXV1bY29sb3JBcnJbM11dID0gJ3JnYmEoJyArIGNvbG9yQXJyLmpvaW4oJywnKSsnKSc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBjb2xvck1hcFtjb2xvckFyclswXV1bY29sb3JBcnJbMV1dW2NvbG9yQXJyWzJdXVtjb2xvckFyclszXV07XHJcbiAgICB9O1xyXG59KCkpO1xyXG5cclxuZnVuY3Rpb24gUmVuZGVyZWRGcmFtZSh0cixvKSB7XHJcbiAgICB0aGlzLnRyID0gdHI7XHJcbiAgICB0aGlzLm8gPSBvO1xyXG59XHJcblxyXG5mdW5jdGlvbiBMZXR0ZXJQcm9wcyhvLHN3LHNjLGZjLG0scCl7XHJcbiAgICB0aGlzLm8gPSBvO1xyXG4gICAgdGhpcy5zdyA9IHN3O1xyXG4gICAgdGhpcy5zYyA9IHNjO1xyXG4gICAgdGhpcy5mYyA9IGZjO1xyXG4gICAgdGhpcy5tID0gbTtcclxuICAgIHRoaXMucHJvcHMgPSBwO1xyXG59XHJcblxyXG5mdW5jdGlvbiBpdGVyYXRlRHluYW1pY1Byb3BlcnRpZXMobnVtKXtcclxuICAgIHZhciBpLCBsZW4gPSB0aGlzLmR5bmFtaWNQcm9wZXJ0aWVzO1xyXG4gICAgZm9yKGk9MDtpPGxlbjtpKz0xKXtcclxuICAgICAgICB0aGlzLmR5bmFtaWNQcm9wZXJ0aWVzW2ldLmdldFZhbHVlKG51bSk7XHJcbiAgICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHJldmVyc2VQYXRoKHBhdGhzKXtcclxuICAgIHZhciBuZXdJID0gW10sIG5ld08gPSBbXSwgbmV3ViA9IFtdO1xyXG4gICAgdmFyIGksIGxlbiwgbmV3UGF0aHMgPSB7fTtcclxuICAgIHZhciBpbml0ID0gMDtcclxuICAgIGlmIChwYXRocy5jKSB7XHJcbiAgICAgICAgbmV3SVswXSA9IHBhdGhzLm9bMF07XHJcbiAgICAgICAgbmV3T1swXSA9IHBhdGhzLmlbMF07XHJcbiAgICAgICAgbmV3VlswXSA9IHBhdGhzLnZbMF07XHJcbiAgICAgICAgaW5pdCA9IDE7XHJcbiAgICB9XHJcbiAgICBsZW4gPSBwYXRocy5pLmxlbmd0aDtcclxuICAgIHZhciBjbnQgPSBsZW4gLSAxO1xyXG5cclxuICAgIGZvciAoaSA9IGluaXQ7IGkgPCBsZW47IGkgKz0gMSkge1xyXG4gICAgICAgIG5ld0kucHVzaChwYXRocy5vW2NudF0pO1xyXG4gICAgICAgIG5ld08ucHVzaChwYXRocy5pW2NudF0pO1xyXG4gICAgICAgIG5ld1YucHVzaChwYXRocy52W2NudF0pO1xyXG4gICAgICAgIGNudCAtPSAxO1xyXG4gICAgfVxyXG5cclxuICAgIG5ld1BhdGhzLmkgPSBuZXdJO1xyXG4gICAgbmV3UGF0aHMubyA9IG5ld087XHJcbiAgICBuZXdQYXRocy52ID0gbmV3VjtcclxuXHJcbiAgICByZXR1cm4gbmV3UGF0aHM7XHJcbn1cbi8qIVxyXG4gVHJhbnNmb3JtYXRpb24gTWF0cml4IHYyLjBcclxuIChjKSBFcGlzdGVtZXggMjAxNC0yMDE1XHJcbiB3d3cuZXBpc3RlbWV4LmNvbVxyXG4gQnkgS2VuIEZ5cnN0ZW5iZXJnXHJcbiBDb250cmlidXRpb25zIGJ5IGxlZW9uaXlhLlxyXG4gTGljZW5zZTogTUlULCBoZWFkZXIgcmVxdWlyZWQuXHJcbiAqL1xyXG5cclxuLyoqXHJcbiAqIDJEIHRyYW5zZm9ybWF0aW9uIG1hdHJpeCBvYmplY3QgaW5pdGlhbGl6ZWQgd2l0aCBpZGVudGl0eSBtYXRyaXguXHJcbiAqXHJcbiAqIFRoZSBtYXRyaXggY2FuIHN5bmNocm9uaXplIGEgY2FudmFzIGNvbnRleHQgYnkgc3VwcGx5aW5nIHRoZSBjb250ZXh0XHJcbiAqIGFzIGFuIGFyZ3VtZW50LCBvciBsYXRlciBhcHBseSBjdXJyZW50IGFic29sdXRlIHRyYW5zZm9ybSB0byBhblxyXG4gKiBleGlzdGluZyBjb250ZXh0LlxyXG4gKlxyXG4gKiBBbGwgdmFsdWVzIGFyZSBoYW5kbGVkIGFzIGZsb2F0aW5nIHBvaW50IHZhbHVlcy5cclxuICpcclxuICogQHBhcmFtIHtDYW52YXNSZW5kZXJpbmdDb250ZXh0MkR9IFtjb250ZXh0XSAtIE9wdGlvbmFsIGNvbnRleHQgdG8gc3luYyB3aXRoIE1hdHJpeFxyXG4gKiBAcHJvcCB7bnVtYmVyfSBhIC0gc2NhbGUgeFxyXG4gKiBAcHJvcCB7bnVtYmVyfSBiIC0gc2hlYXIgeVxyXG4gKiBAcHJvcCB7bnVtYmVyfSBjIC0gc2hlYXIgeFxyXG4gKiBAcHJvcCB7bnVtYmVyfSBkIC0gc2NhbGUgeVxyXG4gKiBAcHJvcCB7bnVtYmVyfSBlIC0gdHJhbnNsYXRlIHhcclxuICogQHByb3Age251bWJlcn0gZiAtIHRyYW5zbGF0ZSB5XHJcbiAqIEBwcm9wIHtDYW52YXNSZW5kZXJpbmdDb250ZXh0MkR8bnVsbH0gW2NvbnRleHQ9bnVsbF0gLSBzZXQgb3IgZ2V0IGN1cnJlbnQgY2FudmFzIGNvbnRleHRcclxuICogQGNvbnN0cnVjdG9yXHJcbiAqL1xyXG5cclxudmFyIE1hdHJpeCA9IChmdW5jdGlvbigpe1xyXG5cclxuICAgIGZ1bmN0aW9uIHJlc2V0KCl7XHJcbiAgICAgICAgdGhpcy5wcm9wc1swXSA9IDE7XHJcbiAgICAgICAgdGhpcy5wcm9wc1sxXSA9IDA7XHJcbiAgICAgICAgdGhpcy5wcm9wc1syXSA9IDA7XHJcbiAgICAgICAgdGhpcy5wcm9wc1szXSA9IDA7XHJcbiAgICAgICAgdGhpcy5wcm9wc1s0XSA9IDA7XHJcbiAgICAgICAgdGhpcy5wcm9wc1s1XSA9IDE7XHJcbiAgICAgICAgdGhpcy5wcm9wc1s2XSA9IDA7XHJcbiAgICAgICAgdGhpcy5wcm9wc1s3XSA9IDA7XHJcbiAgICAgICAgdGhpcy5wcm9wc1s4XSA9IDA7XHJcbiAgICAgICAgdGhpcy5wcm9wc1s5XSA9IDA7XHJcbiAgICAgICAgdGhpcy5wcm9wc1sxMF0gPSAxO1xyXG4gICAgICAgIHRoaXMucHJvcHNbMTFdID0gMDtcclxuICAgICAgICB0aGlzLnByb3BzWzEyXSA9IDA7XHJcbiAgICAgICAgdGhpcy5wcm9wc1sxM10gPSAwO1xyXG4gICAgICAgIHRoaXMucHJvcHNbMTRdID0gMDtcclxuICAgICAgICB0aGlzLnByb3BzWzE1XSA9IDE7XHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gcm90YXRlKGFuZ2xlKSB7XHJcbiAgICAgICAgaWYoYW5nbGUgPT09IDApe1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcztcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIG1Db3MgPSBNYXRoLmNvcyhhbmdsZSk7XHJcbiAgICAgICAgdmFyIG1TaW4gPSBNYXRoLnNpbihhbmdsZSk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3QobUNvcywgLW1TaW4sICAwLCAwXHJcbiAgICAgICAgICAgICwgbVNpbiwgIG1Db3MsIDAsIDBcclxuICAgICAgICAgICAgLCAwLCAgMCwgIDEsIDBcclxuICAgICAgICAgICAgLCAwLCAwLCAwLCAxKTtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiByb3RhdGVYKGFuZ2xlKXtcclxuICAgICAgICBpZihhbmdsZSA9PT0gMCl7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgbUNvcyA9IE1hdGguY29zKGFuZ2xlKTtcclxuICAgICAgICB2YXIgbVNpbiA9IE1hdGguc2luKGFuZ2xlKTtcclxuICAgICAgICByZXR1cm4gdGhpcy5fdCgxLCAwLCAwLCAwXHJcbiAgICAgICAgICAgICwgMCwgbUNvcywgLW1TaW4sIDBcclxuICAgICAgICAgICAgLCAwLCBtU2luLCAgbUNvcywgMFxyXG4gICAgICAgICAgICAsIDAsIDAsIDAsIDEpO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIHJvdGF0ZVkoYW5nbGUpe1xyXG4gICAgICAgIGlmKGFuZ2xlID09PSAwKXtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBtQ29zID0gTWF0aC5jb3MoYW5nbGUpO1xyXG4gICAgICAgIHZhciBtU2luID0gTWF0aC5zaW4oYW5nbGUpO1xyXG4gICAgICAgIHJldHVybiB0aGlzLl90KG1Db3MsICAwLCAgbVNpbiwgMFxyXG4gICAgICAgICAgICAsIDAsIDEsIDAsIDBcclxuICAgICAgICAgICAgLCAtbVNpbiwgIDAsICBtQ29zLCAwXHJcbiAgICAgICAgICAgICwgMCwgMCwgMCwgMSk7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gcm90YXRlWihhbmdsZSl7XHJcbiAgICAgICAgaWYoYW5nbGUgPT09IDApe1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcztcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIG1Db3MgPSBNYXRoLmNvcyhhbmdsZSk7XHJcbiAgICAgICAgdmFyIG1TaW4gPSBNYXRoLnNpbihhbmdsZSk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3QobUNvcywgLW1TaW4sICAwLCAwXHJcbiAgICAgICAgICAgICwgbVNpbiwgIG1Db3MsIDAsIDBcclxuICAgICAgICAgICAgLCAwLCAgMCwgIDEsIDBcclxuICAgICAgICAgICAgLCAwLCAwLCAwLCAxKTtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBzaGVhcihzeCxzeSl7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3QoMSwgc3ksIHN4LCAxLCAwLCAwKTtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBza2V3KGF4LCBheSl7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuc2hlYXIoTWF0aC50YW4oYXgpLCBNYXRoLnRhbihheSkpO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIHNrZXdGcm9tQXhpcyhheCwgYW5nbGUpe1xyXG4gICAgICAgIHZhciBtQ29zID0gTWF0aC5jb3MoYW5nbGUpO1xyXG4gICAgICAgIHZhciBtU2luID0gTWF0aC5zaW4oYW5nbGUpO1xyXG4gICAgICAgIHJldHVybiB0aGlzLl90KG1Db3MsIG1TaW4sICAwLCAwXHJcbiAgICAgICAgICAgICwgLW1TaW4sICBtQ29zLCAwLCAwXHJcbiAgICAgICAgICAgICwgMCwgIDAsICAxLCAwXHJcbiAgICAgICAgICAgICwgMCwgMCwgMCwgMSlcclxuICAgICAgICAgICAgLl90KDEsIDAsICAwLCAwXHJcbiAgICAgICAgICAgICwgTWF0aC50YW4oYXgpLCAgMSwgMCwgMFxyXG4gICAgICAgICAgICAsIDAsICAwLCAgMSwgMFxyXG4gICAgICAgICAgICAsIDAsIDAsIDAsIDEpXHJcbiAgICAgICAgICAgIC5fdChtQ29zLCAtbVNpbiwgIDAsIDBcclxuICAgICAgICAgICAgLCBtU2luLCAgbUNvcywgMCwgMFxyXG4gICAgICAgICAgICAsIDAsICAwLCAgMSwgMFxyXG4gICAgICAgICAgICAsIDAsIDAsIDAsIDEpO1xyXG4gICAgICAgIC8vcmV0dXJuIHRoaXMuX3QobUNvcywgbVNpbiwgLW1TaW4sIG1Db3MsIDAsIDApLl90KDEsIDAsIE1hdGgudGFuKGF4KSwgMSwgMCwgMCkuX3QobUNvcywgLW1TaW4sIG1TaW4sIG1Db3MsIDAsIDApO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIHNjYWxlKHN4LCBzeSwgc3opIHtcclxuICAgICAgICBzeiA9IGlzTmFOKHN6KSA/IDEgOiBzejtcclxuICAgICAgICBpZihzeCA9PSAxICYmIHN5ID09IDEgJiYgc3ogPT0gMSl7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdGhpcy5fdChzeCwgMCwgMCwgMCwgMCwgc3ksIDAsIDAsIDAsIDAsIHN6LCAwLCAwLCAwLCAwLCAxKTtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBzZXRUcmFuc2Zvcm0oYSwgYiwgYywgZCwgZSwgZiwgZywgaCwgaSwgaiwgaywgbCwgbSwgbiwgbywgcCkge1xyXG4gICAgICAgIHRoaXMucHJvcHNbMF0gPSBhO1xyXG4gICAgICAgIHRoaXMucHJvcHNbMV0gPSBiO1xyXG4gICAgICAgIHRoaXMucHJvcHNbMl0gPSBjO1xyXG4gICAgICAgIHRoaXMucHJvcHNbM10gPSBkO1xyXG4gICAgICAgIHRoaXMucHJvcHNbNF0gPSBlO1xyXG4gICAgICAgIHRoaXMucHJvcHNbNV0gPSBmO1xyXG4gICAgICAgIHRoaXMucHJvcHNbNl0gPSBnO1xyXG4gICAgICAgIHRoaXMucHJvcHNbN10gPSBoO1xyXG4gICAgICAgIHRoaXMucHJvcHNbOF0gPSBpO1xyXG4gICAgICAgIHRoaXMucHJvcHNbOV0gPSBqO1xyXG4gICAgICAgIHRoaXMucHJvcHNbMTBdID0gaztcclxuICAgICAgICB0aGlzLnByb3BzWzExXSA9IGw7XHJcbiAgICAgICAgdGhpcy5wcm9wc1sxMl0gPSBtO1xyXG4gICAgICAgIHRoaXMucHJvcHNbMTNdID0gbjtcclxuICAgICAgICB0aGlzLnByb3BzWzE0XSA9IG87XHJcbiAgICAgICAgdGhpcy5wcm9wc1sxNV0gPSBwO1xyXG4gICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIHRyYW5zbGF0ZSh0eCwgdHksIHR6KSB7XHJcbiAgICAgICAgdHogPSB0eiB8fCAwO1xyXG4gICAgICAgIGlmKHR4ICE9PSAwIHx8IHR5ICE9PSAwIHx8IHR6ICE9PSAwKXtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3QoMSwwLDAsMCwwLDEsMCwwLDAsMCwxLDAsdHgsdHksdHosMSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIHRyYW5zZm9ybShhMiwgYjIsIGMyLCBkMiwgZTIsIGYyLCBnMiwgaDIsIGkyLCBqMiwgazIsIGwyLCBtMiwgbjIsIG8yLCBwMikge1xyXG5cclxuICAgICAgICBpZihhMiA9PT0gMSAmJiBiMiA9PT0gMCAmJiBjMiA9PT0gMCAmJiBkMiA9PT0gMCAmJiBlMiA9PT0gMCAmJiBmMiA9PT0gMSAmJiBnMiA9PT0gMCAmJiBoMiA9PT0gMCAmJiBpMiA9PT0gMCAmJiBqMiA9PT0gMCAmJiBrMiA9PT0gMSAmJiBsMiA9PT0gMCl7XHJcbiAgICAgICAgICAgIGlmKG0yICE9PSAwIHx8IG4yICE9PSAwIHx8IG8yICE9PSAwKXtcclxuXHJcbiAgICAgICAgICAgICAgICB0aGlzLnByb3BzWzEyXSA9IHRoaXMucHJvcHNbMTJdICogYTIgKyB0aGlzLnByb3BzWzEzXSAqIGUyICsgdGhpcy5wcm9wc1sxNF0gKiBpMiArIHRoaXMucHJvcHNbMTVdICogbTIgO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5wcm9wc1sxM10gPSB0aGlzLnByb3BzWzEyXSAqIGIyICsgdGhpcy5wcm9wc1sxM10gKiBmMiArIHRoaXMucHJvcHNbMTRdICogajIgKyB0aGlzLnByb3BzWzE1XSAqIG4yIDtcclxuICAgICAgICAgICAgICAgIHRoaXMucHJvcHNbMTRdID0gdGhpcy5wcm9wc1sxMl0gKiBjMiArIHRoaXMucHJvcHNbMTNdICogZzIgKyB0aGlzLnByb3BzWzE0XSAqIGsyICsgdGhpcy5wcm9wc1sxNV0gKiBvMiA7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnByb3BzWzE1XSA9IHRoaXMucHJvcHNbMTJdICogZDIgKyB0aGlzLnByb3BzWzEzXSAqIGgyICsgdGhpcy5wcm9wc1sxNF0gKiBsMiArIHRoaXMucHJvcHNbMTVdICogcDIgO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuX2lkZW50aXR5Q2FsY3VsYXRlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZhciBhMSA9IHRoaXMucHJvcHNbMF07XHJcbiAgICAgICAgdmFyIGIxID0gdGhpcy5wcm9wc1sxXTtcclxuICAgICAgICB2YXIgYzEgPSB0aGlzLnByb3BzWzJdO1xyXG4gICAgICAgIHZhciBkMSA9IHRoaXMucHJvcHNbM107XHJcbiAgICAgICAgdmFyIGUxID0gdGhpcy5wcm9wc1s0XTtcclxuICAgICAgICB2YXIgZjEgPSB0aGlzLnByb3BzWzVdO1xyXG4gICAgICAgIHZhciBnMSA9IHRoaXMucHJvcHNbNl07XHJcbiAgICAgICAgdmFyIGgxID0gdGhpcy5wcm9wc1s3XTtcclxuICAgICAgICB2YXIgaTEgPSB0aGlzLnByb3BzWzhdO1xyXG4gICAgICAgIHZhciBqMSA9IHRoaXMucHJvcHNbOV07XHJcbiAgICAgICAgdmFyIGsxID0gdGhpcy5wcm9wc1sxMF07XHJcbiAgICAgICAgdmFyIGwxID0gdGhpcy5wcm9wc1sxMV07XHJcbiAgICAgICAgdmFyIG0xID0gdGhpcy5wcm9wc1sxMl07XHJcbiAgICAgICAgdmFyIG4xID0gdGhpcy5wcm9wc1sxM107XHJcbiAgICAgICAgdmFyIG8xID0gdGhpcy5wcm9wc1sxNF07XHJcbiAgICAgICAgdmFyIHAxID0gdGhpcy5wcm9wc1sxNV07XHJcblxyXG4gICAgICAgIC8qIG1hdHJpeCBvcmRlciAoY2FudmFzIGNvbXBhdGlibGUpOlxyXG4gICAgICAgICAqIGFjZVxyXG4gICAgICAgICAqIGJkZlxyXG4gICAgICAgICAqIDAwMVxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIHRoaXMucHJvcHNbMF0gPSBhMSAqIGEyICsgYjEgKiBlMiArIGMxICogaTIgKyBkMSAqIG0yO1xyXG4gICAgICAgIHRoaXMucHJvcHNbMV0gPSBhMSAqIGIyICsgYjEgKiBmMiArIGMxICogajIgKyBkMSAqIG4yIDtcclxuICAgICAgICB0aGlzLnByb3BzWzJdID0gYTEgKiBjMiArIGIxICogZzIgKyBjMSAqIGsyICsgZDEgKiBvMiA7XHJcbiAgICAgICAgdGhpcy5wcm9wc1szXSA9IGExICogZDIgKyBiMSAqIGgyICsgYzEgKiBsMiArIGQxICogcDIgO1xyXG5cclxuICAgICAgICB0aGlzLnByb3BzWzRdID0gZTEgKiBhMiArIGYxICogZTIgKyBnMSAqIGkyICsgaDEgKiBtMiA7XHJcbiAgICAgICAgdGhpcy5wcm9wc1s1XSA9IGUxICogYjIgKyBmMSAqIGYyICsgZzEgKiBqMiArIGgxICogbjIgO1xyXG4gICAgICAgIHRoaXMucHJvcHNbNl0gPSBlMSAqIGMyICsgZjEgKiBnMiArIGcxICogazIgKyBoMSAqIG8yIDtcclxuICAgICAgICB0aGlzLnByb3BzWzddID0gZTEgKiBkMiArIGYxICogaDIgKyBnMSAqIGwyICsgaDEgKiBwMiA7XHJcblxyXG4gICAgICAgIHRoaXMucHJvcHNbOF0gPSBpMSAqIGEyICsgajEgKiBlMiArIGsxICogaTIgKyBsMSAqIG0yIDtcclxuICAgICAgICB0aGlzLnByb3BzWzldID0gaTEgKiBiMiArIGoxICogZjIgKyBrMSAqIGoyICsgbDEgKiBuMiA7XHJcbiAgICAgICAgdGhpcy5wcm9wc1sxMF0gPSBpMSAqIGMyICsgajEgKiBnMiArIGsxICogazIgKyBsMSAqIG8yIDtcclxuICAgICAgICB0aGlzLnByb3BzWzExXSA9IGkxICogZDIgKyBqMSAqIGgyICsgazEgKiBsMiArIGwxICogcDIgO1xyXG5cclxuICAgICAgICB0aGlzLnByb3BzWzEyXSA9IG0xICogYTIgKyBuMSAqIGUyICsgbzEgKiBpMiArIHAxICogbTIgO1xyXG4gICAgICAgIHRoaXMucHJvcHNbMTNdID0gbTEgKiBiMiArIG4xICogZjIgKyBvMSAqIGoyICsgcDEgKiBuMiA7XHJcbiAgICAgICAgdGhpcy5wcm9wc1sxNF0gPSBtMSAqIGMyICsgbjEgKiBnMiArIG8xICogazIgKyBwMSAqIG8yIDtcclxuICAgICAgICB0aGlzLnByb3BzWzE1XSA9IG0xICogZDIgKyBuMSAqIGgyICsgbzEgKiBsMiArIHAxICogcDIgO1xyXG5cclxuICAgICAgICB0aGlzLl9pZGVudGl0eUNhbGN1bGF0ZWQgPSBmYWxzZTtcclxuICAgICAgICByZXR1cm4gdGhpcztcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBpc0lkZW50aXR5KCkge1xyXG4gICAgICAgIGlmKCF0aGlzLl9pZGVudGl0eUNhbGN1bGF0ZWQpe1xyXG4gICAgICAgICAgICB0aGlzLl9pZGVudGl0eSA9ICEodGhpcy5wcm9wc1swXSAhPT0gMSB8fCB0aGlzLnByb3BzWzFdICE9PSAwIHx8IHRoaXMucHJvcHNbMl0gIT09IDAgfHwgdGhpcy5wcm9wc1szXSAhPT0gMFxyXG4gICAgICAgICAgICAgICAgfHwgdGhpcy5wcm9wc1s0XSAhPT0gMCB8fCB0aGlzLnByb3BzWzVdICE9PSAxIHx8IHRoaXMucHJvcHNbNl0gIT09IDAgfHwgdGhpcy5wcm9wc1s3XSAhPT0gMFxyXG4gICAgICAgICAgICAgICAgfHwgdGhpcy5wcm9wc1s4XSAhPT0gMCB8fCB0aGlzLnByb3BzWzldICE9PSAwIHx8IHRoaXMucHJvcHNbMTBdICE9PSAxIHx8IHRoaXMucHJvcHNbMTFdICE9PSAwXHJcbiAgICAgICAgICAgICAgICB8fCB0aGlzLnByb3BzWzEyXSAhPT0gMCB8fCB0aGlzLnByb3BzWzEzXSAhPT0gMCB8fCB0aGlzLnByb3BzWzE0XSAhPT0gMCB8fCB0aGlzLnByb3BzWzE1XSAhPT0gMSk7XHJcbiAgICAgICAgICAgIHRoaXMuX2lkZW50aXR5Q2FsY3VsYXRlZCA9IHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0aGlzLl9pZGVudGl0eTtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBjbG9uZShtYXRyKXtcclxuICAgICAgICB2YXIgaTtcclxuICAgICAgICBmb3IoaT0wO2k8MTY7aSs9MSl7XHJcbiAgICAgICAgICAgIG1hdHIucHJvcHNbaV0gPSB0aGlzLnByb3BzW2ldO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBjbG9uZUZyb21Qcm9wcyhwcm9wcyl7XHJcbiAgICAgICAgdmFyIGk7XHJcbiAgICAgICAgZm9yKGk9MDtpPDE2O2krPTEpe1xyXG4gICAgICAgICAgICB0aGlzLnByb3BzW2ldID0gcHJvcHNbaV07XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIGFwcGx5VG9Qb2ludCh4LCB5LCB6KSB7XHJcblxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHg6IHggKiB0aGlzLnByb3BzWzBdICsgeSAqIHRoaXMucHJvcHNbNF0gKyB6ICogdGhpcy5wcm9wc1s4XSArIHRoaXMucHJvcHNbMTJdLFxyXG4gICAgICAgICAgICB5OiB4ICogdGhpcy5wcm9wc1sxXSArIHkgKiB0aGlzLnByb3BzWzVdICsgeiAqIHRoaXMucHJvcHNbOV0gKyB0aGlzLnByb3BzWzEzXSxcclxuICAgICAgICAgICAgejogeCAqIHRoaXMucHJvcHNbMl0gKyB5ICogdGhpcy5wcm9wc1s2XSArIHogKiB0aGlzLnByb3BzWzEwXSArIHRoaXMucHJvcHNbMTRdXHJcbiAgICAgICAgfTtcclxuICAgICAgICAvKnJldHVybiB7XHJcbiAgICAgICAgIHg6IHggKiBtZS5hICsgeSAqIG1lLmMgKyBtZS5lLFxyXG4gICAgICAgICB5OiB4ICogbWUuYiArIHkgKiBtZS5kICsgbWUuZlxyXG4gICAgICAgICB9OyovXHJcbiAgICB9XHJcbiAgICBmdW5jdGlvbiBhcHBseVRvWCh4LCB5LCB6KSB7XHJcbiAgICAgICAgcmV0dXJuIHggKiB0aGlzLnByb3BzWzBdICsgeSAqIHRoaXMucHJvcHNbNF0gKyB6ICogdGhpcy5wcm9wc1s4XSArIHRoaXMucHJvcHNbMTJdO1xyXG4gICAgfVxyXG4gICAgZnVuY3Rpb24gYXBwbHlUb1koeCwgeSwgeikge1xyXG4gICAgICAgIHJldHVybiB4ICogdGhpcy5wcm9wc1sxXSArIHkgKiB0aGlzLnByb3BzWzVdICsgeiAqIHRoaXMucHJvcHNbOV0gKyB0aGlzLnByb3BzWzEzXTtcclxuICAgIH1cclxuICAgIGZ1bmN0aW9uIGFwcGx5VG9aKHgsIHksIHopIHtcclxuICAgICAgICByZXR1cm4geCAqIHRoaXMucHJvcHNbMl0gKyB5ICogdGhpcy5wcm9wc1s2XSArIHogKiB0aGlzLnByb3BzWzEwXSArIHRoaXMucHJvcHNbMTRdO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIGludmVyc2VQb2ludChwdCkge1xyXG4gICAgICAgIHZhciBkZXRlcm1pbmFudCA9IHRoaXMucHJvcHNbMF0gKiB0aGlzLnByb3BzWzVdIC0gdGhpcy5wcm9wc1sxXSAqIHRoaXMucHJvcHNbNF07XHJcbiAgICAgICAgdmFyIGEgPSB0aGlzLnByb3BzWzVdL2RldGVybWluYW50O1xyXG4gICAgICAgIHZhciBiID0gLSB0aGlzLnByb3BzWzFdL2RldGVybWluYW50O1xyXG4gICAgICAgIHZhciBjID0gLSB0aGlzLnByb3BzWzRdL2RldGVybWluYW50O1xyXG4gICAgICAgIHZhciBkID0gdGhpcy5wcm9wc1swXS9kZXRlcm1pbmFudDtcclxuICAgICAgICB2YXIgZSA9ICh0aGlzLnByb3BzWzRdICogdGhpcy5wcm9wc1sxM10gLSB0aGlzLnByb3BzWzVdICogdGhpcy5wcm9wc1sxMl0pL2RldGVybWluYW50O1xyXG4gICAgICAgIHZhciBmID0gLSAodGhpcy5wcm9wc1swXSAqIHRoaXMucHJvcHNbMTNdIC0gdGhpcy5wcm9wc1sxXSAqIHRoaXMucHJvcHNbMTJdKS9kZXRlcm1pbmFudDtcclxuICAgICAgICByZXR1cm4gW3B0WzBdICogYSArIHB0WzFdICogYyArIGUsIHB0WzBdICogYiArIHB0WzFdICogZCArIGYsIDBdO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIGludmVyc2VQb2ludHMocHRzKXtcclxuICAgICAgICB2YXIgaSwgbGVuID0gcHRzLmxlbmd0aCwgcmV0UHRzID0gW107XHJcbiAgICAgICAgZm9yKGk9MDtpPGxlbjtpKz0xKXtcclxuICAgICAgICAgICAgcmV0UHRzW2ldID0gaW52ZXJzZVBvaW50KHB0c1tpXSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiByZXRQdHM7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gYXBwbHlUb1BvaW50QXJyYXkoeCx5LHosZGltZW5zaW9ucyl7XHJcbiAgICAgICAgaWYoZGltZW5zaW9ucyAmJiBkaW1lbnNpb25zID09PSAyKSB7XHJcbiAgICAgICAgICAgIHZhciBhcnIgPSBwb2ludF9wb29sLm5ld1BvaW50KCk7XHJcbiAgICAgICAgICAgIGFyclswXSA9IHggKiB0aGlzLnByb3BzWzBdICsgeSAqIHRoaXMucHJvcHNbNF0gKyB6ICogdGhpcy5wcm9wc1s4XSArIHRoaXMucHJvcHNbMTJdOyBcclxuICAgICAgICAgICAgYXJyWzFdID0geCAqIHRoaXMucHJvcHNbMV0gKyB5ICogdGhpcy5wcm9wc1s1XSArIHogKiB0aGlzLnByb3BzWzldICsgdGhpcy5wcm9wc1sxM107IFxyXG4gICAgICAgICAgICByZXR1cm4gYXJyOyAgICBcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIFt4ICogdGhpcy5wcm9wc1swXSArIHkgKiB0aGlzLnByb3BzWzRdICsgeiAqIHRoaXMucHJvcHNbOF0gKyB0aGlzLnByb3BzWzEyXSx4ICogdGhpcy5wcm9wc1sxXSArIHkgKiB0aGlzLnByb3BzWzVdICsgeiAqIHRoaXMucHJvcHNbOV0gKyB0aGlzLnByb3BzWzEzXSx4ICogdGhpcy5wcm9wc1syXSArIHkgKiB0aGlzLnByb3BzWzZdICsgeiAqIHRoaXMucHJvcHNbMTBdICsgdGhpcy5wcm9wc1sxNF1dO1xyXG4gICAgfVxyXG4gICAgZnVuY3Rpb24gYXBwbHlUb1BvaW50U3RyaW5naWZpZWQoeCwgeSkge1xyXG4gICAgICAgIGlmKHRoaXMuaXNJZGVudGl0eSgpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB4ICsgJywnICsgeTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIChibV9ybmQoeCAqIHRoaXMucHJvcHNbMF0gKyB5ICogdGhpcy5wcm9wc1s0XSArIHRoaXMucHJvcHNbMTJdKSkrJywnKyhibV9ybmQoeCAqIHRoaXMucHJvcHNbMV0gKyB5ICogdGhpcy5wcm9wc1s1XSArIHRoaXMucHJvcHNbMTNdKSk7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gdG9BcnJheSgpIHtcclxuICAgICAgICByZXR1cm4gW3RoaXMucHJvcHNbMF0sdGhpcy5wcm9wc1sxXSx0aGlzLnByb3BzWzJdLHRoaXMucHJvcHNbM10sdGhpcy5wcm9wc1s0XSx0aGlzLnByb3BzWzVdLHRoaXMucHJvcHNbNl0sdGhpcy5wcm9wc1s3XSx0aGlzLnByb3BzWzhdLHRoaXMucHJvcHNbOV0sdGhpcy5wcm9wc1sxMF0sdGhpcy5wcm9wc1sxMV0sdGhpcy5wcm9wc1sxMl0sdGhpcy5wcm9wc1sxM10sdGhpcy5wcm9wc1sxNF0sdGhpcy5wcm9wc1sxNV1dO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIHRvQ1NTKCkge1xyXG4gICAgICAgIGlmKGlzU2FmYXJpKXtcclxuICAgICAgICAgICAgcmV0dXJuIFwibWF0cml4M2QoXCIgKyByb3VuZFRvMkRlY2ltYWxzKHRoaXMucHJvcHNbMF0pICsgJywnICsgcm91bmRUbzJEZWNpbWFscyh0aGlzLnByb3BzWzFdKSArICcsJyArIHJvdW5kVG8yRGVjaW1hbHModGhpcy5wcm9wc1syXSkgKyAnLCcgKyByb3VuZFRvMkRlY2ltYWxzKHRoaXMucHJvcHNbM10pICsgJywnICsgcm91bmRUbzJEZWNpbWFscyh0aGlzLnByb3BzWzRdKSArICcsJyArIHJvdW5kVG8yRGVjaW1hbHModGhpcy5wcm9wc1s1XSkgKyAnLCcgKyByb3VuZFRvMkRlY2ltYWxzKHRoaXMucHJvcHNbNl0pICsgJywnICsgcm91bmRUbzJEZWNpbWFscyh0aGlzLnByb3BzWzddKSArICcsJyArIHJvdW5kVG8yRGVjaW1hbHModGhpcy5wcm9wc1s4XSkgKyAnLCcgKyByb3VuZFRvMkRlY2ltYWxzKHRoaXMucHJvcHNbOV0pICsgJywnICsgcm91bmRUbzJEZWNpbWFscyh0aGlzLnByb3BzWzEwXSkgKyAnLCcgKyByb3VuZFRvMkRlY2ltYWxzKHRoaXMucHJvcHNbMTFdKSArICcsJyArIHJvdW5kVG8yRGVjaW1hbHModGhpcy5wcm9wc1sxMl0pICsgJywnICsgcm91bmRUbzJEZWNpbWFscyh0aGlzLnByb3BzWzEzXSkgKyAnLCcgKyByb3VuZFRvMkRlY2ltYWxzKHRoaXMucHJvcHNbMTRdKSArICcsJyArIHJvdW5kVG8yRGVjaW1hbHModGhpcy5wcm9wc1sxNV0pICsgJyknO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuY3NzUGFydHNbMV0gPSB0aGlzLnByb3BzLmpvaW4oJywnKTtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuY3NzUGFydHMuam9pbignJyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIHRvMmRDU1MoKSB7XHJcbiAgICAgICAgcmV0dXJuIFwibWF0cml4KFwiICsgdGhpcy5wcm9wc1swXSArICcsJyArIHRoaXMucHJvcHNbMV0gKyAnLCcgKyB0aGlzLnByb3BzWzRdICsgJywnICsgdGhpcy5wcm9wc1s1XSArICcsJyArIHRoaXMucHJvcHNbMTJdICsgJywnICsgdGhpcy5wcm9wc1sxM10gKyBcIilcIjtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiB0b1N0cmluZygpIHtcclxuICAgICAgICByZXR1cm4gXCJcIiArIHRoaXMudG9BcnJheSgpO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBmdW5jdGlvbigpe1xyXG4gICAgICAgIHRoaXMucmVzZXQgPSByZXNldDtcclxuICAgICAgICB0aGlzLnJvdGF0ZSA9IHJvdGF0ZTtcclxuICAgICAgICB0aGlzLnJvdGF0ZVggPSByb3RhdGVYO1xyXG4gICAgICAgIHRoaXMucm90YXRlWSA9IHJvdGF0ZVk7XHJcbiAgICAgICAgdGhpcy5yb3RhdGVaID0gcm90YXRlWjtcclxuICAgICAgICB0aGlzLnNrZXcgPSBza2V3O1xyXG4gICAgICAgIHRoaXMuc2tld0Zyb21BeGlzID0gc2tld0Zyb21BeGlzO1xyXG4gICAgICAgIHRoaXMuc2hlYXIgPSBzaGVhcjtcclxuICAgICAgICB0aGlzLnNjYWxlID0gc2NhbGU7XHJcbiAgICAgICAgdGhpcy5zZXRUcmFuc2Zvcm0gPSBzZXRUcmFuc2Zvcm07XHJcbiAgICAgICAgdGhpcy50cmFuc2xhdGUgPSB0cmFuc2xhdGU7XHJcbiAgICAgICAgdGhpcy50cmFuc2Zvcm0gPSB0cmFuc2Zvcm07XHJcbiAgICAgICAgdGhpcy5hcHBseVRvUG9pbnQgPSBhcHBseVRvUG9pbnQ7XHJcbiAgICAgICAgdGhpcy5hcHBseVRvWCA9IGFwcGx5VG9YO1xyXG4gICAgICAgIHRoaXMuYXBwbHlUb1kgPSBhcHBseVRvWTtcclxuICAgICAgICB0aGlzLmFwcGx5VG9aID0gYXBwbHlUb1o7XHJcbiAgICAgICAgdGhpcy5hcHBseVRvUG9pbnRBcnJheSA9IGFwcGx5VG9Qb2ludEFycmF5O1xyXG4gICAgICAgIHRoaXMuYXBwbHlUb1BvaW50U3RyaW5naWZpZWQgPSBhcHBseVRvUG9pbnRTdHJpbmdpZmllZDtcclxuICAgICAgICB0aGlzLnRvQXJyYXkgPSB0b0FycmF5O1xyXG4gICAgICAgIHRoaXMudG9DU1MgPSB0b0NTUztcclxuICAgICAgICB0aGlzLnRvMmRDU1MgPSB0bzJkQ1NTO1xyXG4gICAgICAgIHRoaXMudG9TdHJpbmcgPSB0b1N0cmluZztcclxuICAgICAgICB0aGlzLmNsb25lID0gY2xvbmU7XHJcbiAgICAgICAgdGhpcy5jbG9uZUZyb21Qcm9wcyA9IGNsb25lRnJvbVByb3BzO1xyXG4gICAgICAgIHRoaXMuaW52ZXJzZVBvaW50cyA9IGludmVyc2VQb2ludHM7XHJcbiAgICAgICAgdGhpcy5pbnZlcnNlUG9pbnQgPSBpbnZlcnNlUG9pbnQ7XHJcbiAgICAgICAgdGhpcy5fdCA9IHRoaXMudHJhbnNmb3JtO1xyXG4gICAgICAgIHRoaXMuaXNJZGVudGl0eSA9IGlzSWRlbnRpdHk7XHJcbiAgICAgICAgdGhpcy5faWRlbnRpdHkgPSB0cnVlO1xyXG4gICAgICAgIHRoaXMuX2lkZW50aXR5Q2FsY3VsYXRlZCA9IGZhbHNlO1xyXG5cclxuICAgICAgICB0aGlzLnByb3BzID0gWzEsMCwwLDAsMCwxLDAsMCwwLDAsMSwwLDAsMCwwLDFdO1xyXG5cclxuICAgICAgICB0aGlzLmNzc1BhcnRzID0gWydtYXRyaXgzZCgnLCcnLCcpJ107XHJcbiAgICB9XHJcbn0oKSk7XHJcblxyXG5mdW5jdGlvbiBNYXRyaXgoKSB7XHJcblxyXG5cclxufVxyXG5cbi8qXHJcbiBDb3B5cmlnaHQgMjAxNCBEYXZpZCBCYXUuXHJcblxyXG4gUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nXHJcbiBhIGNvcHkgb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGVcclxuIFwiU29mdHdhcmVcIiksIHRvIGRlYWwgaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rpb24sIGluY2x1ZGluZ1xyXG4gd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHMgdG8gdXNlLCBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLFxyXG4gZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGwgY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvXHJcbiBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpcyBmdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3QgdG9cclxuIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczpcclxuXHJcbiBUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZVxyXG4gaW5jbHVkZWQgaW4gYWxsIGNvcGllcyBvciBzdWJzdGFudGlhbCBwb3J0aW9ucyBvZiB0aGUgU29mdHdhcmUuXHJcblxyXG4gVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEIFwiQVMgSVNcIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCxcclxuIEVYUFJFU1MgT1IgSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRlxyXG4gTUVSQ0hBTlRBQklMSVRZLCBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULlxyXG4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFIEFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTllcclxuIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSIExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsXHJcbiBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLCBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRVxyXG4gU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTiBUSEUgU09GVFdBUkUuXHJcblxyXG4gKi9cclxuXHJcbihmdW5jdGlvbiAocG9vbCwgbWF0aCkge1xyXG4vL1xyXG4vLyBUaGUgZm9sbG93aW5nIGNvbnN0YW50cyBhcmUgcmVsYXRlZCB0byBJRUVFIDc1NCBsaW1pdHMuXHJcbi8vXHJcbiAgICB2YXIgZ2xvYmFsID0gdGhpcyxcclxuICAgICAgICB3aWR0aCA9IDI1NiwgICAgICAgIC8vIGVhY2ggUkM0IG91dHB1dCBpcyAwIDw9IHggPCAyNTZcclxuICAgICAgICBjaHVua3MgPSA2LCAgICAgICAgIC8vIGF0IGxlYXN0IHNpeCBSQzQgb3V0cHV0cyBmb3IgZWFjaCBkb3VibGVcclxuICAgICAgICBkaWdpdHMgPSA1MiwgICAgICAgIC8vIHRoZXJlIGFyZSA1MiBzaWduaWZpY2FudCBkaWdpdHMgaW4gYSBkb3VibGVcclxuICAgICAgICBybmduYW1lID0gJ3JhbmRvbScsIC8vIHJuZ25hbWU6IG5hbWUgZm9yIE1hdGgucmFuZG9tIGFuZCBNYXRoLnNlZWRyYW5kb21cclxuICAgICAgICBzdGFydGRlbm9tID0gbWF0aC5wb3cod2lkdGgsIGNodW5rcyksXHJcbiAgICAgICAgc2lnbmlmaWNhbmNlID0gbWF0aC5wb3coMiwgZGlnaXRzKSxcclxuICAgICAgICBvdmVyZmxvdyA9IHNpZ25pZmljYW5jZSAqIDIsXHJcbiAgICAgICAgbWFzayA9IHdpZHRoIC0gMSxcclxuICAgICAgICBub2RlY3J5cHRvOyAgICAgICAgIC8vIG5vZGUuanMgY3J5cHRvIG1vZHVsZSwgaW5pdGlhbGl6ZWQgYXQgdGhlIGJvdHRvbS5cclxuXHJcbi8vXHJcbi8vIHNlZWRyYW5kb20oKVxyXG4vLyBUaGlzIGlzIHRoZSBzZWVkcmFuZG9tIGZ1bmN0aW9uIGRlc2NyaWJlZCBhYm92ZS5cclxuLy9cclxuICAgIGZ1bmN0aW9uIHNlZWRyYW5kb20oc2VlZCwgb3B0aW9ucywgY2FsbGJhY2spIHtcclxuICAgICAgICB2YXIga2V5ID0gW107XHJcbiAgICAgICAgb3B0aW9ucyA9IChvcHRpb25zID09IHRydWUpID8geyBlbnRyb3B5OiB0cnVlIH0gOiAob3B0aW9ucyB8fCB7fSk7XHJcblxyXG4gICAgICAgIC8vIEZsYXR0ZW4gdGhlIHNlZWQgc3RyaW5nIG9yIGJ1aWxkIG9uZSBmcm9tIGxvY2FsIGVudHJvcHkgaWYgbmVlZGVkLlxyXG4gICAgICAgIHZhciBzaG9ydHNlZWQgPSBtaXhrZXkoZmxhdHRlbihcclxuICAgICAgICAgICAgb3B0aW9ucy5lbnRyb3B5ID8gW3NlZWQsIHRvc3RyaW5nKHBvb2wpXSA6XHJcbiAgICAgICAgICAgICAgICAoc2VlZCA9PSBudWxsKSA/IGF1dG9zZWVkKCkgOiBzZWVkLCAzKSwga2V5KTtcclxuXHJcbiAgICAgICAgLy8gVXNlIHRoZSBzZWVkIHRvIGluaXRpYWxpemUgYW4gQVJDNCBnZW5lcmF0b3IuXHJcbiAgICAgICAgdmFyIGFyYzQgPSBuZXcgQVJDNChrZXkpO1xyXG5cclxuICAgICAgICAvLyBUaGlzIGZ1bmN0aW9uIHJldHVybnMgYSByYW5kb20gZG91YmxlIGluIFswLCAxKSB0aGF0IGNvbnRhaW5zXHJcbiAgICAgICAgLy8gcmFuZG9tbmVzcyBpbiBldmVyeSBiaXQgb2YgdGhlIG1hbnRpc3NhIG9mIHRoZSBJRUVFIDc1NCB2YWx1ZS5cclxuICAgICAgICB2YXIgcHJuZyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICB2YXIgbiA9IGFyYzQuZyhjaHVua3MpLCAgICAgICAgICAgICAvLyBTdGFydCB3aXRoIGEgbnVtZXJhdG9yIG4gPCAyIF4gNDhcclxuICAgICAgICAgICAgICAgIGQgPSBzdGFydGRlbm9tLCAgICAgICAgICAgICAgICAgLy8gICBhbmQgZGVub21pbmF0b3IgZCA9IDIgXiA0OC5cclxuICAgICAgICAgICAgICAgIHggPSAwOyAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gICBhbmQgbm8gJ2V4dHJhIGxhc3QgYnl0ZScuXHJcbiAgICAgICAgICAgIHdoaWxlIChuIDwgc2lnbmlmaWNhbmNlKSB7ICAgICAgICAgIC8vIEZpbGwgdXAgYWxsIHNpZ25pZmljYW50IGRpZ2l0cyBieVxyXG4gICAgICAgICAgICAgICAgbiA9IChuICsgeCkgKiB3aWR0aDsgICAgICAgICAgICAgIC8vICAgc2hpZnRpbmcgbnVtZXJhdG9yIGFuZFxyXG4gICAgICAgICAgICAgICAgZCAqPSB3aWR0aDsgICAgICAgICAgICAgICAgICAgICAgIC8vICAgZGVub21pbmF0b3IgYW5kIGdlbmVyYXRpbmcgYVxyXG4gICAgICAgICAgICAgICAgeCA9IGFyYzQuZygxKTsgICAgICAgICAgICAgICAgICAgIC8vICAgbmV3IGxlYXN0LXNpZ25pZmljYW50LWJ5dGUuXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgd2hpbGUgKG4gPj0gb3ZlcmZsb3cpIHsgICAgICAgICAgICAgLy8gVG8gYXZvaWQgcm91bmRpbmcgdXAsIGJlZm9yZSBhZGRpbmdcclxuICAgICAgICAgICAgICAgIG4gLz0gMjsgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgIGxhc3QgYnl0ZSwgc2hpZnQgZXZlcnl0aGluZ1xyXG4gICAgICAgICAgICAgICAgZCAvPSAyOyAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgcmlnaHQgdXNpbmcgaW50ZWdlciBtYXRoIHVudGlsXHJcbiAgICAgICAgICAgICAgICB4ID4+Pj0gMTsgICAgICAgICAgICAgICAgICAgICAgICAgLy8gICB3ZSBoYXZlIGV4YWN0bHkgdGhlIGRlc2lyZWQgYml0cy5cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gKG4gKyB4KSAvIGQ7ICAgICAgICAgICAgICAgICAvLyBGb3JtIHRoZSBudW1iZXIgd2l0aGluIFswLCAxKS5cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBwcm5nLmludDMyID0gZnVuY3Rpb24oKSB7IHJldHVybiBhcmM0LmcoNCkgfCAwOyB9XHJcbiAgICAgICAgcHJuZy5xdWljayA9IGZ1bmN0aW9uKCkgeyByZXR1cm4gYXJjNC5nKDQpIC8gMHgxMDAwMDAwMDA7IH1cclxuICAgICAgICBwcm5nLmRvdWJsZSA9IHBybmc7XHJcblxyXG4gICAgICAgIC8vIE1peCB0aGUgcmFuZG9tbmVzcyBpbnRvIGFjY3VtdWxhdGVkIGVudHJvcHkuXHJcbiAgICAgICAgbWl4a2V5KHRvc3RyaW5nKGFyYzQuUyksIHBvb2wpO1xyXG5cclxuICAgICAgICAvLyBDYWxsaW5nIGNvbnZlbnRpb246IHdoYXQgdG8gcmV0dXJuIGFzIGEgZnVuY3Rpb24gb2YgcHJuZywgc2VlZCwgaXNfbWF0aC5cclxuICAgICAgICByZXR1cm4gKG9wdGlvbnMucGFzcyB8fCBjYWxsYmFjayB8fFxyXG4gICAgICAgIGZ1bmN0aW9uKHBybmcsIHNlZWQsIGlzX21hdGhfY2FsbCwgc3RhdGUpIHtcclxuICAgICAgICAgICAgaWYgKHN0YXRlKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBMb2FkIHRoZSBhcmM0IHN0YXRlIGZyb20gdGhlIGdpdmVuIHN0YXRlIGlmIGl0IGhhcyBhbiBTIGFycmF5LlxyXG4gICAgICAgICAgICAgICAgaWYgKHN0YXRlLlMpIHsgY29weShzdGF0ZSwgYXJjNCk7IH1cclxuICAgICAgICAgICAgICAgIC8vIE9ubHkgcHJvdmlkZSB0aGUgLnN0YXRlIG1ldGhvZCBpZiByZXF1ZXN0ZWQgdmlhIG9wdGlvbnMuc3RhdGUuXHJcbiAgICAgICAgICAgICAgICBwcm5nLnN0YXRlID0gZnVuY3Rpb24oKSB7IHJldHVybiBjb3B5KGFyYzQsIHt9KTsgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBJZiBjYWxsZWQgYXMgYSBtZXRob2Qgb2YgTWF0aCAoTWF0aC5zZWVkcmFuZG9tKCkpLCBtdXRhdGVcclxuICAgICAgICAgICAgLy8gTWF0aC5yYW5kb20gYmVjYXVzZSB0aGF0IGlzIGhvdyBzZWVkcmFuZG9tLmpzIGhhcyB3b3JrZWQgc2luY2UgdjEuMC5cclxuICAgICAgICAgICAgaWYgKGlzX21hdGhfY2FsbCkgeyBtYXRoW3JuZ25hbWVdID0gcHJuZzsgcmV0dXJuIHNlZWQ7IH1cclxuXHJcbiAgICAgICAgICAgIC8vIE90aGVyd2lzZSwgaXQgaXMgYSBuZXdlciBjYWxsaW5nIGNvbnZlbnRpb24sIHNvIHJldHVybiB0aGVcclxuICAgICAgICAgICAgLy8gcHJuZyBkaXJlY3RseS5cclxuICAgICAgICAgICAgZWxzZSByZXR1cm4gcHJuZztcclxuICAgICAgICB9KShcclxuICAgICAgICAgICAgcHJuZyxcclxuICAgICAgICAgICAgc2hvcnRzZWVkLFxyXG4gICAgICAgICAgICAnZ2xvYmFsJyBpbiBvcHRpb25zID8gb3B0aW9ucy5nbG9iYWwgOiAodGhpcyA9PSBtYXRoKSxcclxuICAgICAgICAgICAgb3B0aW9ucy5zdGF0ZSk7XHJcbiAgICB9XHJcbiAgICBtYXRoWydzZWVkJyArIHJuZ25hbWVdID0gc2VlZHJhbmRvbTtcclxuXHJcbi8vXHJcbi8vIEFSQzRcclxuLy9cclxuLy8gQW4gQVJDNCBpbXBsZW1lbnRhdGlvbi4gIFRoZSBjb25zdHJ1Y3RvciB0YWtlcyBhIGtleSBpbiB0aGUgZm9ybSBvZlxyXG4vLyBhbiBhcnJheSBvZiBhdCBtb3N0ICh3aWR0aCkgaW50ZWdlcnMgdGhhdCBzaG91bGQgYmUgMCA8PSB4IDwgKHdpZHRoKS5cclxuLy9cclxuLy8gVGhlIGcoY291bnQpIG1ldGhvZCByZXR1cm5zIGEgcHNldWRvcmFuZG9tIGludGVnZXIgdGhhdCBjb25jYXRlbmF0ZXNcclxuLy8gdGhlIG5leHQgKGNvdW50KSBvdXRwdXRzIGZyb20gQVJDNC4gIEl0cyByZXR1cm4gdmFsdWUgaXMgYSBudW1iZXIgeFxyXG4vLyB0aGF0IGlzIGluIHRoZSByYW5nZSAwIDw9IHggPCAod2lkdGggXiBjb3VudCkuXHJcbi8vXHJcbiAgICBmdW5jdGlvbiBBUkM0KGtleSkge1xyXG4gICAgICAgIHZhciB0LCBrZXlsZW4gPSBrZXkubGVuZ3RoLFxyXG4gICAgICAgICAgICBtZSA9IHRoaXMsIGkgPSAwLCBqID0gbWUuaSA9IG1lLmogPSAwLCBzID0gbWUuUyA9IFtdO1xyXG5cclxuICAgICAgICAvLyBUaGUgZW1wdHkga2V5IFtdIGlzIHRyZWF0ZWQgYXMgWzBdLlxyXG4gICAgICAgIGlmICgha2V5bGVuKSB7IGtleSA9IFtrZXlsZW4rK107IH1cclxuXHJcbiAgICAgICAgLy8gU2V0IHVwIFMgdXNpbmcgdGhlIHN0YW5kYXJkIGtleSBzY2hlZHVsaW5nIGFsZ29yaXRobS5cclxuICAgICAgICB3aGlsZSAoaSA8IHdpZHRoKSB7XHJcbiAgICAgICAgICAgIHNbaV0gPSBpKys7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZvciAoaSA9IDA7IGkgPCB3aWR0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIHNbaV0gPSBzW2ogPSBtYXNrICYgKGogKyBrZXlbaSAlIGtleWxlbl0gKyAodCA9IHNbaV0pKV07XHJcbiAgICAgICAgICAgIHNbal0gPSB0O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gVGhlIFwiZ1wiIG1ldGhvZCByZXR1cm5zIHRoZSBuZXh0IChjb3VudCkgb3V0cHV0cyBhcyBvbmUgbnVtYmVyLlxyXG4gICAgICAgIChtZS5nID0gZnVuY3Rpb24oY291bnQpIHtcclxuICAgICAgICAgICAgLy8gVXNpbmcgaW5zdGFuY2UgbWVtYmVycyBpbnN0ZWFkIG9mIGNsb3N1cmUgc3RhdGUgbmVhcmx5IGRvdWJsZXMgc3BlZWQuXHJcbiAgICAgICAgICAgIHZhciB0LCByID0gMCxcclxuICAgICAgICAgICAgICAgIGkgPSBtZS5pLCBqID0gbWUuaiwgcyA9IG1lLlM7XHJcbiAgICAgICAgICAgIHdoaWxlIChjb3VudC0tKSB7XHJcbiAgICAgICAgICAgICAgICB0ID0gc1tpID0gbWFzayAmIChpICsgMSldO1xyXG4gICAgICAgICAgICAgICAgciA9IHIgKiB3aWR0aCArIHNbbWFzayAmICgoc1tpXSA9IHNbaiA9IG1hc2sgJiAoaiArIHQpXSkgKyAoc1tqXSA9IHQpKV07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgbWUuaSA9IGk7IG1lLmogPSBqO1xyXG4gICAgICAgICAgICByZXR1cm4gcjtcclxuICAgICAgICAgICAgLy8gRm9yIHJvYnVzdCB1bnByZWRpY3RhYmlsaXR5LCB0aGUgZnVuY3Rpb24gY2FsbCBiZWxvdyBhdXRvbWF0aWNhbGx5XHJcbiAgICAgICAgICAgIC8vIGRpc2NhcmRzIGFuIGluaXRpYWwgYmF0Y2ggb2YgdmFsdWVzLiAgVGhpcyBpcyBjYWxsZWQgUkM0LWRyb3BbMjU2XS5cclxuICAgICAgICAgICAgLy8gU2VlIGh0dHA6Ly9nb29nbGUuY29tL3NlYXJjaD9xPXJzYStmbHVocmVyK3Jlc3BvbnNlJmJ0bklcclxuICAgICAgICB9KSh3aWR0aCk7XHJcbiAgICB9XHJcblxyXG4vL1xyXG4vLyBjb3B5KClcclxuLy8gQ29waWVzIGludGVybmFsIHN0YXRlIG9mIEFSQzQgdG8gb3IgZnJvbSBhIHBsYWluIG9iamVjdC5cclxuLy9cclxuICAgIGZ1bmN0aW9uIGNvcHkoZiwgdCkge1xyXG4gICAgICAgIHQuaSA9IGYuaTtcclxuICAgICAgICB0LmogPSBmLmo7XHJcbiAgICAgICAgdC5TID0gZi5TLnNsaWNlKCk7XHJcbiAgICAgICAgcmV0dXJuIHQ7XHJcbiAgICB9O1xyXG5cclxuLy9cclxuLy8gZmxhdHRlbigpXHJcbi8vIENvbnZlcnRzIGFuIG9iamVjdCB0cmVlIHRvIG5lc3RlZCBhcnJheXMgb2Ygc3RyaW5ncy5cclxuLy9cclxuICAgIGZ1bmN0aW9uIGZsYXR0ZW4ob2JqLCBkZXB0aCkge1xyXG4gICAgICAgIHZhciByZXN1bHQgPSBbXSwgdHlwID0gKHR5cGVvZiBvYmopLCBwcm9wO1xyXG4gICAgICAgIGlmIChkZXB0aCAmJiB0eXAgPT0gJ29iamVjdCcpIHtcclxuICAgICAgICAgICAgZm9yIChwcm9wIGluIG9iaikge1xyXG4gICAgICAgICAgICAgICAgdHJ5IHsgcmVzdWx0LnB1c2goZmxhdHRlbihvYmpbcHJvcF0sIGRlcHRoIC0gMSkpOyB9IGNhdGNoIChlKSB7fVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiAocmVzdWx0Lmxlbmd0aCA/IHJlc3VsdCA6IHR5cCA9PSAnc3RyaW5nJyA/IG9iaiA6IG9iaiArICdcXDAnKTtcclxuICAgIH1cclxuXHJcbi8vXHJcbi8vIG1peGtleSgpXHJcbi8vIE1peGVzIGEgc3RyaW5nIHNlZWQgaW50byBhIGtleSB0aGF0IGlzIGFuIGFycmF5IG9mIGludGVnZXJzLCBhbmRcclxuLy8gcmV0dXJucyBhIHNob3J0ZW5lZCBzdHJpbmcgc2VlZCB0aGF0IGlzIGVxdWl2YWxlbnQgdG8gdGhlIHJlc3VsdCBrZXkuXHJcbi8vXHJcbiAgICBmdW5jdGlvbiBtaXhrZXkoc2VlZCwga2V5KSB7XHJcbiAgICAgICAgdmFyIHN0cmluZ3NlZWQgPSBzZWVkICsgJycsIHNtZWFyLCBqID0gMDtcclxuICAgICAgICB3aGlsZSAoaiA8IHN0cmluZ3NlZWQubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIGtleVttYXNrICYgal0gPVxyXG4gICAgICAgICAgICAgICAgbWFzayAmICgoc21lYXIgXj0ga2V5W21hc2sgJiBqXSAqIDE5KSArIHN0cmluZ3NlZWQuY2hhckNvZGVBdChqKyspKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRvc3RyaW5nKGtleSk7XHJcbiAgICB9XHJcblxyXG4vL1xyXG4vLyBhdXRvc2VlZCgpXHJcbi8vIFJldHVybnMgYW4gb2JqZWN0IGZvciBhdXRvc2VlZGluZywgdXNpbmcgd2luZG93LmNyeXB0byBhbmQgTm9kZSBjcnlwdG9cclxuLy8gbW9kdWxlIGlmIGF2YWlsYWJsZS5cclxuLy9cclxuICAgIGZ1bmN0aW9uIGF1dG9zZWVkKCkge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGlmIChub2RlY3J5cHRvKSB7IHJldHVybiB0b3N0cmluZyhub2RlY3J5cHRvLnJhbmRvbUJ5dGVzKHdpZHRoKSk7IH1cclxuICAgICAgICAgICAgdmFyIG91dCA9IG5ldyBVaW50OEFycmF5KHdpZHRoKTtcclxuICAgICAgICAgICAgKGdsb2JhbC5jcnlwdG8gfHwgZ2xvYmFsLm1zQ3J5cHRvKS5nZXRSYW5kb21WYWx1ZXMob3V0KTtcclxuICAgICAgICAgICAgcmV0dXJuIHRvc3RyaW5nKG91dCk7XHJcbiAgICAgICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgICB2YXIgYnJvd3NlciA9IGdsb2JhbC5uYXZpZ2F0b3IsXHJcbiAgICAgICAgICAgICAgICBwbHVnaW5zID0gYnJvd3NlciAmJiBicm93c2VyLnBsdWdpbnM7XHJcbiAgICAgICAgICAgIHJldHVybiBbK25ldyBEYXRlLCBnbG9iYWwsIHBsdWdpbnMsIGdsb2JhbC5zY3JlZW4sIHRvc3RyaW5nKHBvb2wpXTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4vL1xyXG4vLyB0b3N0cmluZygpXHJcbi8vIENvbnZlcnRzIGFuIGFycmF5IG9mIGNoYXJjb2RlcyB0byBhIHN0cmluZ1xyXG4vL1xyXG4gICAgZnVuY3Rpb24gdG9zdHJpbmcoYSkge1xyXG4gICAgICAgIHJldHVybiBTdHJpbmcuZnJvbUNoYXJDb2RlLmFwcGx5KDAsIGEpO1xyXG4gICAgfVxyXG5cclxuLy9cclxuLy8gV2hlbiBzZWVkcmFuZG9tLmpzIGlzIGxvYWRlZCwgd2UgaW1tZWRpYXRlbHkgbWl4IGEgZmV3IGJpdHNcclxuLy8gZnJvbSB0aGUgYnVpbHQtaW4gUk5HIGludG8gdGhlIGVudHJvcHkgcG9vbC4gIEJlY2F1c2Ugd2UgZG9cclxuLy8gbm90IHdhbnQgdG8gaW50ZXJmZXJlIHdpdGggZGV0ZXJtaW5pc3RpYyBQUk5HIHN0YXRlIGxhdGVyLFxyXG4vLyBzZWVkcmFuZG9tIHdpbGwgbm90IGNhbGwgbWF0aC5yYW5kb20gb24gaXRzIG93biBhZ2FpbiBhZnRlclxyXG4vLyBpbml0aWFsaXphdGlvbi5cclxuLy9cclxuICAgIG1peGtleShtYXRoLnJhbmRvbSgpLCBwb29sKTtcclxuXHJcbi8vXHJcbi8vIE5vZGVqcyBhbmQgQU1EIHN1cHBvcnQ6IGV4cG9ydCB0aGUgaW1wbGVtZW50YXRpb24gYXMgYSBtb2R1bGUgdXNpbmdcclxuLy8gZWl0aGVyIGNvbnZlbnRpb24uXHJcbi8vXHJcblxyXG4vLyBFbmQgYW5vbnltb3VzIHNjb3BlLCBhbmQgcGFzcyBpbml0aWFsIHZhbHVlcy5cclxufSkoXHJcbiAgICBbXSwgICAgIC8vIHBvb2w6IGVudHJvcHkgcG9vbCBzdGFydHMgZW1wdHlcclxuICAgIEJNTWF0aCAgICAvLyBtYXRoOiBwYWNrYWdlIGNvbnRhaW5pbmcgcmFuZG9tLCBwb3csIGFuZCBzZWVkcmFuZG9tXHJcbik7XG52YXIgQmV6aWVyRmFjdG9yeSA9IChmdW5jdGlvbigpe1xyXG4gICAgLyoqXHJcbiAgICAgKiBCZXppZXJFYXNpbmcgLSB1c2UgYmV6aWVyIGN1cnZlIGZvciB0cmFuc2l0aW9uIGVhc2luZyBmdW5jdGlvblxyXG4gICAgICogYnkgR2HDq3RhbiBSZW5hdWRlYXUgMjAxNCAtIDIwMTUg4oCTIE1JVCBMaWNlbnNlXHJcbiAgICAgKlxyXG4gICAgICogQ3JlZGl0czogaXMgYmFzZWQgb24gRmlyZWZveCdzIG5zU01JTEtleVNwbGluZS5jcHBcclxuICAgICAqIFVzYWdlOlxyXG4gICAgICogdmFyIHNwbGluZSA9IEJlemllckVhc2luZyhbIDAuMjUsIDAuMSwgMC4yNSwgMS4wIF0pXHJcbiAgICAgKiBzcGxpbmUuZ2V0KHgpID0+IHJldHVybnMgdGhlIGVhc2luZyB2YWx1ZSB8IHggbXVzdCBiZSBpbiBbMCwgMV0gcmFuZ2VcclxuICAgICAqXHJcbiAgICAgKi9cclxuXHJcbiAgICAgICAgdmFyIG9iID0ge307XHJcbiAgICBvYi5nZXRCZXppZXJFYXNpbmcgPSBnZXRCZXppZXJFYXNpbmc7XHJcbiAgICB2YXIgYmV6aWVycyA9IHt9O1xyXG5cclxuICAgIGZ1bmN0aW9uIGdldEJlemllckVhc2luZyhhLGIsYyxkLG5tKXtcclxuICAgICAgICB2YXIgc3RyID0gbm0gfHwgKCdiZXpfJyArIGErJ18nK2IrJ18nK2MrJ18nK2QpLnJlcGxhY2UoL1xcLi9nLCAncCcpO1xyXG4gICAgICAgIGlmKGJlemllcnNbc3RyXSl7XHJcbiAgICAgICAgICAgIHJldHVybiBiZXppZXJzW3N0cl07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBiZXpFYXNpbmcgPSBuZXcgQmV6aWVyRWFzaW5nKFthLGIsYyxkXSk7XHJcbiAgICAgICAgYmV6aWVyc1tzdHJdID0gYmV6RWFzaW5nO1xyXG4gICAgICAgIHJldHVybiBiZXpFYXNpbmc7XHJcbiAgICB9XHJcblxyXG4vLyBUaGVzZSB2YWx1ZXMgYXJlIGVzdGFibGlzaGVkIGJ5IGVtcGlyaWNpc20gd2l0aCB0ZXN0cyAodHJhZGVvZmY6IHBlcmZvcm1hbmNlIFZTIHByZWNpc2lvbilcclxuICAgIHZhciBORVdUT05fSVRFUkFUSU9OUyA9IDQ7XHJcbiAgICB2YXIgTkVXVE9OX01JTl9TTE9QRSA9IDAuMDAxO1xyXG4gICAgdmFyIFNVQkRJVklTSU9OX1BSRUNJU0lPTiA9IDAuMDAwMDAwMTtcclxuICAgIHZhciBTVUJESVZJU0lPTl9NQVhfSVRFUkFUSU9OUyA9IDEwO1xyXG5cclxuICAgIHZhciBrU3BsaW5lVGFibGVTaXplID0gMTE7XHJcbiAgICB2YXIga1NhbXBsZVN0ZXBTaXplID0gMS4wIC8gKGtTcGxpbmVUYWJsZVNpemUgLSAxLjApO1xyXG5cclxuICAgIHZhciBmbG9hdDMyQXJyYXlTdXBwb3J0ZWQgPSB0eXBlb2YgRmxvYXQzMkFycmF5ID09PSBcImZ1bmN0aW9uXCI7XHJcblxyXG4gICAgZnVuY3Rpb24gQSAoYUExLCBhQTIpIHsgcmV0dXJuIDEuMCAtIDMuMCAqIGFBMiArIDMuMCAqIGFBMTsgfVxyXG4gICAgZnVuY3Rpb24gQiAoYUExLCBhQTIpIHsgcmV0dXJuIDMuMCAqIGFBMiAtIDYuMCAqIGFBMTsgfVxyXG4gICAgZnVuY3Rpb24gQyAoYUExKSAgICAgIHsgcmV0dXJuIDMuMCAqIGFBMTsgfVxyXG5cclxuLy8gUmV0dXJucyB4KHQpIGdpdmVuIHQsIHgxLCBhbmQgeDIsIG9yIHkodCkgZ2l2ZW4gdCwgeTEsIGFuZCB5Mi5cclxuICAgIGZ1bmN0aW9uIGNhbGNCZXppZXIgKGFULCBhQTEsIGFBMikge1xyXG4gICAgICAgIHJldHVybiAoKEEoYUExLCBhQTIpKmFUICsgQihhQTEsIGFBMikpKmFUICsgQyhhQTEpKSphVDtcclxuICAgIH1cclxuXHJcbi8vIFJldHVybnMgZHgvZHQgZ2l2ZW4gdCwgeDEsIGFuZCB4Miwgb3IgZHkvZHQgZ2l2ZW4gdCwgeTEsIGFuZCB5Mi5cclxuICAgIGZ1bmN0aW9uIGdldFNsb3BlIChhVCwgYUExLCBhQTIpIHtcclxuICAgICAgICByZXR1cm4gMy4wICogQShhQTEsIGFBMikqYVQqYVQgKyAyLjAgKiBCKGFBMSwgYUEyKSAqIGFUICsgQyhhQTEpO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIGJpbmFyeVN1YmRpdmlkZSAoYVgsIGFBLCBhQiwgbVgxLCBtWDIpIHtcclxuICAgICAgICB2YXIgY3VycmVudFgsIGN1cnJlbnRULCBpID0gMDtcclxuICAgICAgICBkbyB7XHJcbiAgICAgICAgICAgIGN1cnJlbnRUID0gYUEgKyAoYUIgLSBhQSkgLyAyLjA7XHJcbiAgICAgICAgICAgIGN1cnJlbnRYID0gY2FsY0JlemllcihjdXJyZW50VCwgbVgxLCBtWDIpIC0gYVg7XHJcbiAgICAgICAgICAgIGlmIChjdXJyZW50WCA+IDAuMCkge1xyXG4gICAgICAgICAgICAgICAgYUIgPSBjdXJyZW50VDtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGFBID0gY3VycmVudFQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IHdoaWxlIChNYXRoLmFicyhjdXJyZW50WCkgPiBTVUJESVZJU0lPTl9QUkVDSVNJT04gJiYgKytpIDwgU1VCRElWSVNJT05fTUFYX0lURVJBVElPTlMpO1xyXG4gICAgICAgIHJldHVybiBjdXJyZW50VDtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBuZXd0b25SYXBoc29uSXRlcmF0ZSAoYVgsIGFHdWVzc1QsIG1YMSwgbVgyKSB7XHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBORVdUT05fSVRFUkFUSU9OUzsgKytpKSB7XHJcbiAgICAgICAgICAgIHZhciBjdXJyZW50U2xvcGUgPSBnZXRTbG9wZShhR3Vlc3NULCBtWDEsIG1YMik7XHJcbiAgICAgICAgICAgIGlmIChjdXJyZW50U2xvcGUgPT09IDAuMCkgcmV0dXJuIGFHdWVzc1Q7XHJcbiAgICAgICAgICAgIHZhciBjdXJyZW50WCA9IGNhbGNCZXppZXIoYUd1ZXNzVCwgbVgxLCBtWDIpIC0gYVg7XHJcbiAgICAgICAgICAgIGFHdWVzc1QgLT0gY3VycmVudFggLyBjdXJyZW50U2xvcGU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBhR3Vlc3NUO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogcG9pbnRzIGlzIGFuIGFycmF5IG9mIFsgbVgxLCBtWTEsIG1YMiwgbVkyIF1cclxuICAgICAqL1xyXG4gICAgZnVuY3Rpb24gQmV6aWVyRWFzaW5nIChwb2ludHMpIHtcclxuICAgICAgICB0aGlzLl9wID0gcG9pbnRzO1xyXG4gICAgICAgIHRoaXMuX21TYW1wbGVWYWx1ZXMgPSBmbG9hdDMyQXJyYXlTdXBwb3J0ZWQgPyBuZXcgRmxvYXQzMkFycmF5KGtTcGxpbmVUYWJsZVNpemUpIDogbmV3IEFycmF5KGtTcGxpbmVUYWJsZVNpemUpO1xyXG4gICAgICAgIHRoaXMuX3ByZWNvbXB1dGVkID0gZmFsc2U7XHJcblxyXG4gICAgICAgIHRoaXMuZ2V0ID0gdGhpcy5nZXQuYmluZCh0aGlzKTtcclxuICAgIH1cclxuXHJcbiAgICBCZXppZXJFYXNpbmcucHJvdG90eXBlID0ge1xyXG5cclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICh4KSB7XHJcbiAgICAgICAgICAgIHZhciBtWDEgPSB0aGlzLl9wWzBdLFxyXG4gICAgICAgICAgICAgICAgbVkxID0gdGhpcy5fcFsxXSxcclxuICAgICAgICAgICAgICAgIG1YMiA9IHRoaXMuX3BbMl0sXHJcbiAgICAgICAgICAgICAgICBtWTIgPSB0aGlzLl9wWzNdO1xyXG4gICAgICAgICAgICBpZiAoIXRoaXMuX3ByZWNvbXB1dGVkKSB0aGlzLl9wcmVjb21wdXRlKCk7XHJcbiAgICAgICAgICAgIGlmIChtWDEgPT09IG1ZMSAmJiBtWDIgPT09IG1ZMikgcmV0dXJuIHg7IC8vIGxpbmVhclxyXG4gICAgICAgICAgICAvLyBCZWNhdXNlIEphdmFTY3JpcHQgbnVtYmVyIGFyZSBpbXByZWNpc2UsIHdlIHNob3VsZCBndWFyYW50ZWUgdGhlIGV4dHJlbWVzIGFyZSByaWdodC5cclxuICAgICAgICAgICAgaWYgKHggPT09IDApIHJldHVybiAwO1xyXG4gICAgICAgICAgICBpZiAoeCA9PT0gMSkgcmV0dXJuIDE7XHJcbiAgICAgICAgICAgIHJldHVybiBjYWxjQmV6aWVyKHRoaXMuX2dldFRGb3JYKHgpLCBtWTEsIG1ZMik7XHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgLy8gUHJpdmF0ZSBwYXJ0XHJcblxyXG4gICAgICAgIF9wcmVjb21wdXRlOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZhciBtWDEgPSB0aGlzLl9wWzBdLFxyXG4gICAgICAgICAgICAgICAgbVkxID0gdGhpcy5fcFsxXSxcclxuICAgICAgICAgICAgICAgIG1YMiA9IHRoaXMuX3BbMl0sXHJcbiAgICAgICAgICAgICAgICBtWTIgPSB0aGlzLl9wWzNdO1xyXG4gICAgICAgICAgICB0aGlzLl9wcmVjb21wdXRlZCA9IHRydWU7XHJcbiAgICAgICAgICAgIGlmIChtWDEgIT09IG1ZMSB8fCBtWDIgIT09IG1ZMilcclxuICAgICAgICAgICAgICAgIHRoaXMuX2NhbGNTYW1wbGVWYWx1ZXMoKTtcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICBfY2FsY1NhbXBsZVZhbHVlczogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2YXIgbVgxID0gdGhpcy5fcFswXSxcclxuICAgICAgICAgICAgICAgIG1YMiA9IHRoaXMuX3BbMl07XHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwga1NwbGluZVRhYmxlU2l6ZTsgKytpKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9tU2FtcGxlVmFsdWVzW2ldID0gY2FsY0JlemllcihpICoga1NhbXBsZVN0ZXBTaXplLCBtWDEsIG1YMik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBnZXRURm9yWCBjaG9zZSB0aGUgZmFzdGVzdCBoZXVyaXN0aWMgdG8gZGV0ZXJtaW5lIHRoZSBwZXJjZW50YWdlIHZhbHVlIHByZWNpc2VseSBmcm9tIGEgZ2l2ZW4gWCBwcm9qZWN0aW9uLlxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIF9nZXRURm9yWDogZnVuY3Rpb24gKGFYKSB7XHJcbiAgICAgICAgICAgIHZhciBtWDEgPSB0aGlzLl9wWzBdLFxyXG4gICAgICAgICAgICAgICAgbVgyID0gdGhpcy5fcFsyXSxcclxuICAgICAgICAgICAgICAgIG1TYW1wbGVWYWx1ZXMgPSB0aGlzLl9tU2FtcGxlVmFsdWVzO1xyXG5cclxuICAgICAgICAgICAgdmFyIGludGVydmFsU3RhcnQgPSAwLjA7XHJcbiAgICAgICAgICAgIHZhciBjdXJyZW50U2FtcGxlID0gMTtcclxuICAgICAgICAgICAgdmFyIGxhc3RTYW1wbGUgPSBrU3BsaW5lVGFibGVTaXplIC0gMTtcclxuXHJcbiAgICAgICAgICAgIGZvciAoOyBjdXJyZW50U2FtcGxlICE9PSBsYXN0U2FtcGxlICYmIG1TYW1wbGVWYWx1ZXNbY3VycmVudFNhbXBsZV0gPD0gYVg7ICsrY3VycmVudFNhbXBsZSkge1xyXG4gICAgICAgICAgICAgICAgaW50ZXJ2YWxTdGFydCArPSBrU2FtcGxlU3RlcFNpemU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLS1jdXJyZW50U2FtcGxlO1xyXG5cclxuICAgICAgICAgICAgLy8gSW50ZXJwb2xhdGUgdG8gcHJvdmlkZSBhbiBpbml0aWFsIGd1ZXNzIGZvciB0XHJcbiAgICAgICAgICAgIHZhciBkaXN0ID0gKGFYIC0gbVNhbXBsZVZhbHVlc1tjdXJyZW50U2FtcGxlXSkgLyAobVNhbXBsZVZhbHVlc1tjdXJyZW50U2FtcGxlKzFdIC0gbVNhbXBsZVZhbHVlc1tjdXJyZW50U2FtcGxlXSk7XHJcbiAgICAgICAgICAgIHZhciBndWVzc0ZvclQgPSBpbnRlcnZhbFN0YXJ0ICsgZGlzdCAqIGtTYW1wbGVTdGVwU2l6ZTtcclxuXHJcbiAgICAgICAgICAgIHZhciBpbml0aWFsU2xvcGUgPSBnZXRTbG9wZShndWVzc0ZvclQsIG1YMSwgbVgyKTtcclxuICAgICAgICAgICAgaWYgKGluaXRpYWxTbG9wZSA+PSBORVdUT05fTUlOX1NMT1BFKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3dG9uUmFwaHNvbkl0ZXJhdGUoYVgsIGd1ZXNzRm9yVCwgbVgxLCBtWDIpO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKGluaXRpYWxTbG9wZSA9PT0gMC4wKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZ3Vlc3NGb3JUO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGJpbmFyeVN1YmRpdmlkZShhWCwgaW50ZXJ2YWxTdGFydCwgaW50ZXJ2YWxTdGFydCArIGtTYW1wbGVTdGVwU2l6ZSwgbVgxLCBtWDIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICByZXR1cm4gb2I7XHJcblxyXG59KCkpXHJcblxyXG5cbmZ1bmN0aW9uIG1hdHJpeE1hbmFnZXJGdW5jdGlvbigpe1xyXG5cclxuICAgIHZhciBtYXQgPSBuZXcgTWF0cml4KCk7XHJcblxyXG4gICAgdmFyIHJldHVybk1hdHJpeDJEID0gZnVuY3Rpb24oclgsIHNjYWxlWCwgc2NhbGVZLCB0WCwgdFkpe1xyXG4gICAgICAgIHJldHVybiBtYXQucmVzZXQoKS50cmFuc2xhdGUodFgsdFkpLnJvdGF0ZShyWCkuc2NhbGUoc2NhbGVYLHNjYWxlWSkudG9DU1MoKTtcclxuICAgIH07XHJcblxyXG4gICAgdmFyIGdldE1hdHJpeCA9IGZ1bmN0aW9uKGFuaW1EYXRhKXtcclxuICAgICAgICByZXR1cm4gcmV0dXJuTWF0cml4MkQoYW5pbURhdGEudHIuclsyXSxhbmltRGF0YS50ci5zWzBdLGFuaW1EYXRhLnRyLnNbMV0sYW5pbURhdGEudHIucFswXSxhbmltRGF0YS50ci5wWzFdKTtcclxuICAgIH07XHJcblxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICBnZXRNYXRyaXggOiBnZXRNYXRyaXhcclxuICAgIH07XHJcblxyXG59XHJcbnZhciBNYXRyaXhNYW5hZ2VyID0gbWF0cml4TWFuYWdlckZ1bmN0aW9uO1xuKGZ1bmN0aW9uICgpIHtcclxuICAgIHZhciBsYXN0VGltZSA9IDA7XHJcbiAgICB2YXIgdmVuZG9ycyA9IFsnbXMnLCAnbW96JywgJ3dlYmtpdCcsICdvJ107XHJcbiAgICBmb3IodmFyIHggPSAwOyB4IDwgdmVuZG9ycy5sZW5ndGggJiYgIXdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWU7ICsreCkge1xyXG4gICAgICAgIHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUgPSB3aW5kb3dbdmVuZG9yc1t4XSArICdSZXF1ZXN0QW5pbWF0aW9uRnJhbWUnXTtcclxuICAgICAgICB3aW5kb3cuY2FuY2VsQW5pbWF0aW9uRnJhbWUgPSB3aW5kb3dbdmVuZG9yc1t4XSArICdDYW5jZWxBbmltYXRpb25GcmFtZSddIHx8IHdpbmRvd1t2ZW5kb3JzW3hdICsgJ0NhbmNlbFJlcXVlc3RBbmltYXRpb25GcmFtZSddO1xyXG4gICAgfVxyXG4gICAgaWYoIXdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUpXHJcbiAgICAgICAgd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZSA9IGZ1bmN0aW9uIChjYWxsYmFjaywgZWxlbWVudCkge1xyXG4gICAgICAgICAgICB2YXIgY3VyclRpbWUgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcclxuICAgICAgICAgICAgdmFyIHRpbWVUb0NhbGwgPSBNYXRoLm1heCgwLCAxNiAtIChjdXJyVGltZSAtIGxhc3RUaW1lKSk7XHJcbiAgICAgICAgICAgIHZhciBpZCA9IHdpbmRvdy5zZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhjdXJyVGltZSArIHRpbWVUb0NhbGwpO1xyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIHRpbWVUb0NhbGwpO1xyXG4gICAgICAgICAgICBsYXN0VGltZSA9IGN1cnJUaW1lICsgdGltZVRvQ2FsbDtcclxuICAgICAgICAgICAgcmV0dXJuIGlkO1xyXG4gICAgICAgIH07XHJcbiAgICBpZighd2luZG93LmNhbmNlbEFuaW1hdGlvbkZyYW1lKVxyXG4gICAgICAgIHdpbmRvdy5jYW5jZWxBbmltYXRpb25GcmFtZSA9IGZ1bmN0aW9uIChpZCkge1xyXG4gICAgICAgICAgICBjbGVhclRpbWVvdXQoaWQpO1xyXG4gICAgICAgIH07XHJcbn0oKSk7XG5mdW5jdGlvbiBjcmVhdGVFbGVtZW50KHBhcmVudCxjaGlsZCxwYXJhbXMpe1xyXG4gICAgaWYoY2hpbGQpe1xyXG4gICAgICAgIGNoaWxkLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUocGFyZW50LnByb3RvdHlwZSk7XHJcbiAgICAgICAgY2hpbGQucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gY2hpbGQ7XHJcbiAgICAgICAgY2hpbGQucHJvdG90eXBlLl9wYXJlbnQgPSBwYXJlbnQucHJvdG90eXBlO1xyXG4gICAgfWVsc2V7XHJcbiAgICAgICAgdmFyIGluc3RhbmNlID0gT2JqZWN0LmNyZWF0ZShwYXJlbnQucHJvdG90eXBlLHBhcmFtcyk7XHJcbiAgICAgICAgdmFyIGdldFR5cGUgPSB7fTtcclxuICAgICAgICBpZihpbnN0YW5jZSAmJiBnZXRUeXBlLnRvU3RyaW5nLmNhbGwoaW5zdGFuY2UuaW5pdCkgPT09ICdbb2JqZWN0IEZ1bmN0aW9uXScpe1xyXG4gICAgICAgICAgICBpbnN0YW5jZS5pbml0KCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBpbnN0YW5jZTtcclxuICAgIH1cclxufVxyXG5cclxuZnVuY3Rpb24gZXh0ZW5kUHJvdG90eXBlKHNvdXJjZSxkZXN0aW5hdGlvbil7XHJcbiAgICBmb3IgKHZhciBhdHRyIGluIHNvdXJjZS5wcm90b3R5cGUpIHtcclxuICAgICAgICBpZiAoc291cmNlLnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eShhdHRyKSkgZGVzdGluYXRpb24ucHJvdG90eXBlW2F0dHJdID0gc291cmNlLnByb3RvdHlwZVthdHRyXTtcclxuICAgIH1cclxufVxuZnVuY3Rpb24gYmV6RnVuY3Rpb24oKXtcclxuXHJcbiAgICB2YXIgZWFzaW5nRnVuY3Rpb25zID0gW107XHJcbiAgICB2YXIgbWF0aCA9IE1hdGg7XHJcblxyXG4gICAgZnVuY3Rpb24gcG9pbnRPbkxpbmUyRCh4MSx5MSwgeDIseTIsIHgzLHkzKXtcclxuICAgICAgICB2YXIgZGV0MSA9ICh4MSp5MikgKyAoeTEqeDMpICsgKHgyKnkzKSAtICh4Myp5MikgLSAoeTMqeDEpIC0gKHgyKnkxKTtcclxuICAgICAgICByZXR1cm4gZGV0MSA+IC0wLjAwMDEgJiYgZGV0MSA8IDAuMDAwMTtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBwb2ludE9uTGluZTNEKHgxLHkxLHoxLCB4Mix5Mix6MiwgeDMseTMsejMpe1xyXG4gICAgICAgIGlmKHoxID09PSAwICYmIHoyID09PSAwICYmIHozID09PSAwKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBwb2ludE9uTGluZTJEKHgxLHkxLCB4Mix5MiwgeDMseTMpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgZGlzdDEgPSBNYXRoLnNxcnQoTWF0aC5wb3coeDIgLSB4MSwgMikgKyBNYXRoLnBvdyh5MiAtIHkxLCAyKSArIE1hdGgucG93KHoyIC0gejEsIDIpKTtcclxuICAgICAgICB2YXIgZGlzdDIgPSBNYXRoLnNxcnQoTWF0aC5wb3coeDMgLSB4MSwgMikgKyBNYXRoLnBvdyh5MyAtIHkxLCAyKSArIE1hdGgucG93KHozIC0gejEsIDIpKTtcclxuICAgICAgICB2YXIgZGlzdDMgPSBNYXRoLnNxcnQoTWF0aC5wb3coeDMgLSB4MiwgMikgKyBNYXRoLnBvdyh5MyAtIHkyLCAyKSArIE1hdGgucG93KHozIC0gejIsIDIpKTtcclxuICAgICAgICB2YXIgZGlmZkRpc3Q7XHJcbiAgICAgICAgaWYoZGlzdDEgPiBkaXN0Mil7XHJcbiAgICAgICAgICAgIGlmKGRpc3QxID4gZGlzdDMpe1xyXG4gICAgICAgICAgICAgICAgZGlmZkRpc3QgPSBkaXN0MSAtIGRpc3QyIC0gZGlzdDM7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBkaWZmRGlzdCA9IGRpc3QzIC0gZGlzdDIgLSBkaXN0MTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSBpZihkaXN0MyA+IGRpc3QyKXtcclxuICAgICAgICAgICAgZGlmZkRpc3QgPSBkaXN0MyAtIGRpc3QyIC0gZGlzdDE7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgZGlmZkRpc3QgPSBkaXN0MiAtIGRpc3QxIC0gZGlzdDM7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBkaWZmRGlzdCA+IC0wLjAwMDEgJiYgZGlmZkRpc3QgPCAwLjAwMDE7XHJcbiAgICB9XHJcblxyXG4gICAgLypmdW5jdGlvbiBnZXRFYXNpbmdDdXJ2ZShhYSxiYixjYyxkZCxlbmNvZGVkRnVuY05hbWUpIHtcclxuICAgICAgICBpZighZW5jb2RlZEZ1bmNOYW1lKXtcclxuICAgICAgICAgICAgZW5jb2RlZEZ1bmNOYW1lID0gKCdiZXpfJyArIGFhKydfJytiYisnXycrY2MrJ18nK2RkKS5yZXBsYWNlKC9cXC4vZywgJ3AnKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYoZWFzaW5nRnVuY3Rpb25zW2VuY29kZWRGdW5jTmFtZV0pe1xyXG4gICAgICAgICAgICByZXR1cm4gZWFzaW5nRnVuY3Rpb25zW2VuY29kZWRGdW5jTmFtZV07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBBMCwgQjAsIEMwO1xyXG4gICAgICAgIHZhciBBMSwgQjEsIEMxO1xyXG4gICAgICAgIGVhc2luZ0Z1bmN0aW9uc1tlbmNvZGVkRnVuY05hbWVdID0gZnVuY3Rpb24odHQpIHtcclxuICAgICAgICAgICAgdmFyIHggPSB0dDtcclxuICAgICAgICAgICAgdmFyIGkgPSAwLCB6O1xyXG4gICAgICAgICAgICB3aGlsZSAoKytpIDwgMjApIHtcclxuICAgICAgICAgICAgICAgIEMwID0gMyAqIGFhO1xyXG4gICAgICAgICAgICAgICAgQjAgPSAzICogKGNjIC0gYWEpIC0gQzA7XHJcbiAgICAgICAgICAgICAgICBBMCA9IDEgLSBDMCAtIEIwO1xyXG4gICAgICAgICAgICAgICAgeiA9ICh4ICogKEMwICsgeCAqIChCMCArIHggKiBBMCkpKSAtIHR0O1xyXG4gICAgICAgICAgICAgICAgaWYgKGJtX2Ficyh6KSA8IDFlLTMpIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgeCAtPSB6IC8gKEMwICsgeCAqICgyICogQjAgKyAzICogQTAgKiB4KSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgQzEgPSAzICogYmI7XHJcbiAgICAgICAgICAgIEIxID0gMyAqIChkZCAtIGJiKSAtIEMxO1xyXG4gICAgICAgICAgICBBMSA9IDEgLSBDMSAtIEIxO1xyXG4gICAgICAgICAgICB2YXIgcG9seUIgPSB4ICogKEMxICsgeCAqIChCMSArIHggKiBBMSkpO1xyXG4gICAgICAgICAgICAvL3JldHVybiBjICogcG9seUIgKyBiO1xyXG4gICAgICAgICAgICByZXR1cm4gcG9seUI7XHJcbiAgICAgICAgfTtcclxuICAgICAgICByZXR1cm4gZWFzaW5nRnVuY3Rpb25zW2VuY29kZWRGdW5jTmFtZV07XHJcbiAgICB9Ki9cclxuICAgIHZhciBnZXRCZXppZXJMZW5ndGggPSAoZnVuY3Rpb24oKXtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gU2VnbWVudChsLHApe1xyXG4gICAgICAgICAgICB0aGlzLmwgPSBsO1xyXG4gICAgICAgICAgICB0aGlzLnAgPSBwO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKHB0MSxwdDIscHQzLHB0NCl7XHJcbiAgICAgICAgICAgIHZhciBjdXJ2ZVNlZ21lbnRzID0gZGVmYXVsdEN1cnZlU2VnbWVudHM7XHJcbiAgICAgICAgICAgIHZhciBrO1xyXG4gICAgICAgICAgICB2YXIgaSwgbGVuO1xyXG4gICAgICAgICAgICB2YXIgcHRDb29yZCxwZXJjLGFkZGVkTGVuZ3RoID0gMDtcclxuICAgICAgICAgICAgdmFyIHB0RGlzdGFuY2U7XHJcbiAgICAgICAgICAgIHZhciBwb2ludCA9IFtdLGxhc3RQb2ludCA9IFtdO1xyXG4gICAgICAgICAgICB2YXIgbGVuZ3RoRGF0YSA9IHtcclxuICAgICAgICAgICAgICAgIGFkZGVkTGVuZ3RoOiAwLFxyXG4gICAgICAgICAgICAgICAgc2VnbWVudHM6IFtdXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIGxlbiA9IHB0My5sZW5ndGg7XHJcbiAgICAgICAgICAgIGZvcihrPTA7azxjdXJ2ZVNlZ21lbnRzO2srPTEpe1xyXG4gICAgICAgICAgICAgICAgcGVyYyA9IGsvKGN1cnZlU2VnbWVudHMtMSk7XHJcbiAgICAgICAgICAgICAgICBwdERpc3RhbmNlID0gMDtcclxuICAgICAgICAgICAgICAgIGZvcihpPTA7aTxsZW47aSs9MSl7XHJcbiAgICAgICAgICAgICAgICAgICAgcHRDb29yZCA9IGJtX3BvdygxLXBlcmMsMykqcHQxW2ldKzMqYm1fcG93KDEtcGVyYywyKSpwZXJjKnB0M1tpXSszKigxLXBlcmMpKmJtX3BvdyhwZXJjLDIpKnB0NFtpXStibV9wb3cocGVyYywzKSpwdDJbaV07XHJcbiAgICAgICAgICAgICAgICAgICAgcG9pbnRbaV0gPSBwdENvb3JkO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmKGxhc3RQb2ludFtpXSAhPT0gbnVsbCl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHB0RGlzdGFuY2UgKz0gYm1fcG93KHBvaW50W2ldIC0gbGFzdFBvaW50W2ldLDIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBsYXN0UG9pbnRbaV0gPSBwb2ludFtpXTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmKHB0RGlzdGFuY2Upe1xyXG4gICAgICAgICAgICAgICAgICAgIHB0RGlzdGFuY2UgPSBibV9zcXJ0KHB0RGlzdGFuY2UpO1xyXG4gICAgICAgICAgICAgICAgICAgIGFkZGVkTGVuZ3RoICs9IHB0RGlzdGFuY2U7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBsZW5ndGhEYXRhLnNlZ21lbnRzLnB1c2gobmV3IFNlZ21lbnQoYWRkZWRMZW5ndGgscGVyYykpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGxlbmd0aERhdGEuYWRkZWRMZW5ndGggPSBhZGRlZExlbmd0aDtcclxuICAgICAgICAgICAgcmV0dXJuIGxlbmd0aERhdGE7XHJcbiAgICAgICAgfTtcclxuICAgIH0oKSk7XHJcblxyXG4gICAgZnVuY3Rpb24gQmV6aWVyRGF0YShsZW5ndGgpe1xyXG4gICAgICAgIHRoaXMuc2VnbWVudExlbmd0aCA9IDA7XHJcbiAgICAgICAgdGhpcy5wb2ludHMgPSBuZXcgQXJyYXkobGVuZ3RoKTtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBQb2ludERhdGEocGFydGlhbCxwb2ludCl7XHJcbiAgICAgICAgdGhpcy5wYXJ0aWFsTGVuZ3RoID0gcGFydGlhbDtcclxuICAgICAgICB0aGlzLnBvaW50ID0gcG9pbnQ7XHJcbiAgICB9XHJcblxyXG4gICAgdmFyIGJ1aWxkQmV6aWVyRGF0YSA9IChmdW5jdGlvbigpe1xyXG5cclxuICAgICAgICB2YXIgc3RvcmVkRGF0YSA9IHt9O1xyXG5cclxuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGtleURhdGEpe1xyXG4gICAgICAgICAgICB2YXIgcHQxID0ga2V5RGF0YS5zO1xyXG4gICAgICAgICAgICB2YXIgcHQyID0ga2V5RGF0YS5lO1xyXG4gICAgICAgICAgICB2YXIgcHQzID0ga2V5RGF0YS50bztcclxuICAgICAgICAgICAgdmFyIHB0NCA9IGtleURhdGEudGk7XHJcbiAgICAgICAgICAgIHZhciBiZXppZXJOYW1lID0gKHB0MS5qb2luKCdfJykrJ18nK3B0Mi5qb2luKCdfJykrJ18nK3B0My5qb2luKCdfJykrJ18nK3B0NC5qb2luKCdfJykpLnJlcGxhY2UoL1xcLi9nLCAncCcpO1xyXG4gICAgICAgICAgICBpZihzdG9yZWREYXRhW2Jlemllck5hbWVdKXtcclxuICAgICAgICAgICAgICAgIGtleURhdGEuYmV6aWVyRGF0YSA9IHN0b3JlZERhdGFbYmV6aWVyTmFtZV07XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB2YXIgY3VydmVTZWdtZW50cyA9IGRlZmF1bHRDdXJ2ZVNlZ21lbnRzO1xyXG4gICAgICAgIHZhciBrLCBpLCBsZW47XHJcbiAgICAgICAgICAgIHZhciBwdENvb3JkLHBlcmMsYWRkZWRMZW5ndGggPSAwO1xyXG4gICAgICAgICAgICB2YXIgcHREaXN0YW5jZTtcclxuICAgICAgICAgICAgdmFyIHBvaW50LGxhc3RQb2ludCA9IG51bGw7XHJcbiAgICAgICAgICAgIGlmKHB0MS5sZW5ndGggPT09IDIgJiYgKHB0MVswXSAhPSBwdDJbMF0gfHwgcHQxWzFdICE9IHB0MlsxXSkgJiYgcG9pbnRPbkxpbmUyRChwdDFbMF0scHQxWzFdLHB0MlswXSxwdDJbMV0scHQxWzBdK3B0M1swXSxwdDFbMV0rcHQzWzFdKSAmJiBwb2ludE9uTGluZTJEKHB0MVswXSxwdDFbMV0scHQyWzBdLHB0MlsxXSxwdDJbMF0rcHQ0WzBdLHB0MlsxXStwdDRbMV0pKXtcclxuICAgICAgICAgICAgICAgIGN1cnZlU2VnbWVudHMgPSAyO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZhciBiZXppZXJEYXRhID0gbmV3IEJlemllckRhdGEoY3VydmVTZWdtZW50cyk7XHJcbiAgICAgICAgICAgIGxlbiA9IHB0My5sZW5ndGg7XHJcbiAgICAgICAgICAgIGZvcihrPTA7azxjdXJ2ZVNlZ21lbnRzO2srPTEpe1xyXG4gICAgICAgICAgICBwb2ludCA9IG5ldyBBcnJheShsZW4pO1xyXG4gICAgICAgICAgICAgICAgcGVyYyA9IGsvKGN1cnZlU2VnbWVudHMtMSk7XHJcbiAgICAgICAgICAgICAgICBwdERpc3RhbmNlID0gMDtcclxuICAgICAgICAgICAgICAgIGZvcihpPTA7aTxsZW47aSs9MSl7XHJcbiAgICAgICAgICAgICAgICBwdENvb3JkID0gYm1fcG93KDEtcGVyYywzKSpwdDFbaV0rMypibV9wb3coMS1wZXJjLDIpKnBlcmMqKHB0MVtpXSArIHB0M1tpXSkrMyooMS1wZXJjKSpibV9wb3cocGVyYywyKSoocHQyW2ldICsgcHQ0W2ldKStibV9wb3cocGVyYywzKSpwdDJbaV07XHJcbiAgICAgICAgICAgICAgICBwb2ludFtpXSA9IHB0Q29vcmQ7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYobGFzdFBvaW50ICE9PSBudWxsKXtcclxuICAgICAgICAgICAgICAgICAgICBwdERpc3RhbmNlICs9IGJtX3Bvdyhwb2ludFtpXSAtIGxhc3RQb2ludFtpXSwyKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHB0RGlzdGFuY2UgPSBibV9zcXJ0KHB0RGlzdGFuY2UpO1xyXG4gICAgICAgICAgICAgICAgYWRkZWRMZW5ndGggKz0gcHREaXN0YW5jZTtcclxuICAgICAgICAgICAgICAgIGJlemllckRhdGEucG9pbnRzW2tdID0gbmV3IFBvaW50RGF0YShwdERpc3RhbmNlLHBvaW50KTtcclxuICAgICAgICAgICAgICAgIGxhc3RQb2ludCA9IHBvaW50O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGJlemllckRhdGEuc2VnbWVudExlbmd0aCA9IGFkZGVkTGVuZ3RoO1xyXG4gICAgICAgICAgICBrZXlEYXRhLmJlemllckRhdGEgPSBiZXppZXJEYXRhO1xyXG4gICAgICAgICAgICBzdG9yZWREYXRhW2Jlemllck5hbWVdID0gYmV6aWVyRGF0YTtcclxuXHJcbiAgICAgICAgfVxyXG4gICAgfSgpKTtcclxuXHJcbiAgICBmdW5jdGlvbiBnZXREaXN0YW5jZVBlcmMocGVyYyxiZXppZXJEYXRhKXtcclxuICAgICAgICB2YXIgc2VnbWVudHMgPSBiZXppZXJEYXRhLnNlZ21lbnRzO1xyXG4gICAgICAgIHZhciBsZW4gPSBzZWdtZW50cy5sZW5ndGg7XHJcbiAgICAgICAgdmFyIGluaXRQb3MgPSBibV9mbG9vcigobGVuLTEpKnBlcmMpO1xyXG4gICAgICAgIHZhciBsZW5ndGhQb3MgPSBwZXJjKmJlemllckRhdGEuYWRkZWRMZW5ndGg7XHJcbiAgICAgICAgdmFyIGxQZXJjID0gMDtcclxuICAgICAgICBpZihsZW5ndGhQb3MgPT0gc2VnbWVudHNbaW5pdFBvc10ubCl7XHJcbiAgICAgICAgICAgIHJldHVybiBzZWdtZW50c1tpbml0UG9zXS5wO1xyXG4gICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICB2YXIgZGlyID0gc2VnbWVudHNbaW5pdFBvc10ubCA+IGxlbmd0aFBvcyA/IC0xIDogMTtcclxuICAgICAgICAgICAgdmFyIGZsYWcgPSB0cnVlO1xyXG4gICAgICAgICAgICB3aGlsZShmbGFnKXtcclxuICAgICAgICAgICAgICAgIGlmKHNlZ21lbnRzW2luaXRQb3NdLmwgPD0gbGVuZ3RoUG9zICYmIHNlZ21lbnRzW2luaXRQb3MrMV0ubCA+IGxlbmd0aFBvcyl7XHJcbiAgICAgICAgICAgICAgICAgICAgbFBlcmMgPSAobGVuZ3RoUG9zIC0gc2VnbWVudHNbaW5pdFBvc10ubCkvKHNlZ21lbnRzW2luaXRQb3MrMV0ubC1zZWdtZW50c1tpbml0UG9zXS5sKTtcclxuICAgICAgICAgICAgICAgICAgICBmbGFnID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgICAgICBpbml0UG9zICs9IGRpcjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmKGluaXRQb3MgPCAwIHx8IGluaXRQb3MgPj0gbGVuIC0gMSl7XHJcbiAgICAgICAgICAgICAgICAgICAgZmxhZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBzZWdtZW50c1tpbml0UG9zXS5wICsgKHNlZ21lbnRzW2luaXRQb3MrMV0ucCAtIHNlZ21lbnRzW2luaXRQb3NdLnApKmxQZXJjO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBTZWdtZW50UG9pbnRzKCl7XHJcbiAgICAgICAgdGhpcy5wdDEgPSBuZXcgQXJyYXkoMik7XHJcbiAgICAgICAgdGhpcy5wdDIgPSBuZXcgQXJyYXkoMik7XHJcbiAgICAgICAgdGhpcy5wdDMgPSBuZXcgQXJyYXkoMik7XHJcbiAgICAgICAgdGhpcy5wdDQgPSBuZXcgQXJyYXkoMik7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gZ2V0TmV3U2VnbWVudChwdDEscHQyLHB0MyxwdDQsc3RhcnRQZXJjLGVuZFBlcmMsIGJlemllckRhdGEpe1xyXG5cclxuICAgICAgICB2YXIgcHRzID0gbmV3IFNlZ21lbnRQb2ludHMoKTtcclxuICAgICAgICBzdGFydFBlcmMgPSBzdGFydFBlcmMgPCAwID8gMCA6IHN0YXJ0UGVyYyA+IDEgPyAxIDogc3RhcnRQZXJjO1xyXG4gICAgICAgIHZhciB0MCA9IGdldERpc3RhbmNlUGVyYyhzdGFydFBlcmMsYmV6aWVyRGF0YSk7XHJcbiAgICAgICAgZW5kUGVyYyA9IGVuZFBlcmMgPiAxID8gMSA6IGVuZFBlcmM7XHJcbiAgICAgICAgdmFyIHQxID0gZ2V0RGlzdGFuY2VQZXJjKGVuZFBlcmMsYmV6aWVyRGF0YSk7XHJcbiAgICAgICAgdmFyIGksIGxlbiA9IHB0MS5sZW5ndGg7XHJcbiAgICAgICAgdmFyIHUwID0gMSAtIHQwO1xyXG4gICAgICAgIHZhciB1MSA9IDEgLSB0MTtcclxuICAgICAgICAvL01hdGgucm91bmQobnVtICogMTAwKSAvIDEwMFxyXG4gICAgICAgIGZvcihpPTA7aTxsZW47aSs9MSl7XHJcbiAgICAgICAgICAgIHB0cy5wdDFbaV0gPSAgTWF0aC5yb3VuZCgodTAqdTAqdTAqIHB0MVtpXSArICh0MCp1MCp1MCArIHUwKnQwKnUwICsgdTAqdTAqdDApICogcHQzW2ldICsgKHQwKnQwKnUwICsgdTAqdDAqdDAgKyB0MCp1MCp0MCkqIHB0NFtpXSArIHQwKnQwKnQwKiBwdDJbaV0pKiAxMDAwKSAvIDEwMDA7XHJcbiAgICAgICAgICAgIHB0cy5wdDNbaV0gPSBNYXRoLnJvdW5kKCh1MCp1MCp1MSpwdDFbaV0gKyAodDAqdTAqdTEgKyB1MCp0MCp1MSArIHUwKnUwKnQxKSogcHQzW2ldICsgKHQwKnQwKnUxICsgdTAqdDAqdDEgKyB0MCp1MCp0MSkqIHB0NFtpXSArIHQwKnQwKnQxKiBwdDJbaV0pKiAxMDAwKSAvIDEwMDA7XHJcbiAgICAgICAgICAgIHB0cy5wdDRbaV0gPSBNYXRoLnJvdW5kKCh1MCp1MSp1MSogcHQxW2ldICsgKHQwKnUxKnUxICsgdTAqdDEqdTEgKyB1MCp1MSp0MSkqIHB0M1tpXSArICh0MCp0MSp1MSArIHUwKnQxKnQxICsgdDAqdTEqdDEpKiBwdDRbaV0gKyB0MCp0MSp0MSogcHQyW2ldKSogMTAwMCkgLyAxMDAwO1xyXG4gICAgICAgICAgICBwdHMucHQyW2ldID0gTWF0aC5yb3VuZCgodTEqdTEqdTEqIHB0MVtpXSArICh0MSp1MSp1MSArIHUxKnQxKnUxICsgdTEqdTEqdDEpKiBwdDNbaV0gKyAodDEqdDEqdTEgKyB1MSp0MSp0MSArIHQxKnUxKnQxKSpwdDRbaV0gKyB0MSp0MSp0MSogcHQyW2ldKSogMTAwMCkgLyAxMDAwO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcHRzO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgLy9nZXRFYXNpbmdDdXJ2ZSA6IGdldEVhc2luZ0N1cnZlLFxyXG4gICAgICAgIGdldEJlemllckxlbmd0aCA6IGdldEJlemllckxlbmd0aCxcclxuICAgICAgICBnZXROZXdTZWdtZW50IDogZ2V0TmV3U2VnbWVudCxcclxuICAgICAgICBidWlsZEJlemllckRhdGEgOiBidWlsZEJlemllckRhdGEsXHJcbiAgICAgICAgcG9pbnRPbkxpbmUyRCA6IHBvaW50T25MaW5lMkQsXHJcbiAgICAgICAgcG9pbnRPbkxpbmUzRCA6IHBvaW50T25MaW5lM0RcclxuICAgIH07XHJcbn1cclxuXHJcbnZhciBiZXogPSBiZXpGdW5jdGlvbigpO1xuZnVuY3Rpb24gZGF0YUZ1bmN0aW9uTWFuYWdlcigpe1xyXG5cclxuICAgIC8vdmFyIHRDYW52YXNIZWxwZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKS5nZXRDb250ZXh0KCcyZCcpO1xyXG5cclxuICAgIGZ1bmN0aW9uIGNvbXBsZXRlTGF5ZXJzKGxheWVycywgY29tcHMsIGZvbnRNYW5hZ2VyKXtcclxuICAgICAgICB2YXIgbGF5ZXJEYXRhO1xyXG4gICAgICAgIHZhciBhbmltQXJyYXksIGxhc3RGcmFtZTtcclxuICAgICAgICB2YXIgaSwgbGVuID0gbGF5ZXJzLmxlbmd0aDtcclxuICAgICAgICB2YXIgaiwgakxlbiwgaywga0xlbjtcclxuICAgICAgICBmb3IoaT0wO2k8bGVuO2krPTEpe1xyXG4gICAgICAgICAgICBsYXllckRhdGEgPSBsYXllcnNbaV07XHJcbiAgICAgICAgICAgIGlmKCEoJ2tzJyBpbiBsYXllckRhdGEpIHx8IGxheWVyRGF0YS5jb21wbGV0ZWQpe1xyXG4gICAgICAgICAgICAgICAgY29udGludWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgbGF5ZXJEYXRhLmNvbXBsZXRlZCA9IHRydWU7XHJcbiAgICAgICAgICAgIGlmKGxheWVyRGF0YS50dCl7XHJcbiAgICAgICAgICAgICAgICBsYXllcnNbaS0xXS50ZCA9IGxheWVyRGF0YS50dDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBhbmltQXJyYXkgPSBbXTtcclxuICAgICAgICAgICAgbGFzdEZyYW1lID0gLTE7XHJcbiAgICAgICAgICAgIGlmKGxheWVyRGF0YS5oYXNNYXNrKXtcclxuICAgICAgICAgICAgICAgIHZhciBtYXNrUHJvcHMgPSBsYXllckRhdGEubWFza3NQcm9wZXJ0aWVzO1xyXG4gICAgICAgICAgICAgICAgakxlbiA9IG1hc2tQcm9wcy5sZW5ndGg7XHJcbiAgICAgICAgICAgICAgICBmb3Ioaj0wO2o8akxlbjtqKz0xKXtcclxuICAgICAgICAgICAgICAgICAgICBpZihtYXNrUHJvcHNbal0ucHQuay5pKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29udmVydFBhdGhzVG9BYnNvbHV0ZVZhbHVlcyhtYXNrUHJvcHNbal0ucHQuayk7XHJcbiAgICAgICAgICAgICAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGtMZW4gPSBtYXNrUHJvcHNbal0ucHQuay5sZW5ndGg7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvcihrPTA7azxrTGVuO2srPTEpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYobWFza1Byb3BzW2pdLnB0Lmtba10ucyl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udmVydFBhdGhzVG9BYnNvbHV0ZVZhbHVlcyhtYXNrUHJvcHNbal0ucHQua1trXS5zWzBdKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKG1hc2tQcm9wc1tqXS5wdC5rW2tdLmUpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnZlcnRQYXRoc1RvQWJzb2x1dGVWYWx1ZXMobWFza1Byb3BzW2pdLnB0Lmtba10uZVswXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYobGF5ZXJEYXRhLnR5PT09MCl7XHJcbiAgICAgICAgICAgICAgICBsYXllckRhdGEubGF5ZXJzID0gZmluZENvbXBMYXllcnMobGF5ZXJEYXRhLnJlZklkLCBjb21wcyk7XHJcbiAgICAgICAgICAgICAgICBjb21wbGV0ZUxheWVycyhsYXllckRhdGEubGF5ZXJzLGNvbXBzLCBmb250TWFuYWdlcik7XHJcbiAgICAgICAgICAgIH1lbHNlIGlmKGxheWVyRGF0YS50eSA9PT0gNCl7XHJcbiAgICAgICAgICAgICAgICBjb21wbGV0ZVNoYXBlcyhsYXllckRhdGEuc2hhcGVzKTtcclxuICAgICAgICAgICAgfWVsc2UgaWYobGF5ZXJEYXRhLnR5ID09IDUpe1xyXG4gICAgICAgICAgICAgICAgY29tcGxldGVUZXh0KGxheWVyRGF0YSwgZm9udE1hbmFnZXIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIGZpbmRDb21wTGF5ZXJzKGlkLGNvbXBzKXtcclxuICAgICAgICB2YXIgaSA9IDAsIGxlbiA9IGNvbXBzLmxlbmd0aDtcclxuICAgICAgICB3aGlsZShpPGxlbil7XHJcbiAgICAgICAgICAgIGlmKGNvbXBzW2ldLmlkID09PSBpZCl7XHJcbiAgICAgICAgICAgICAgICBpZighY29tcHNbaV0ubGF5ZXJzLl9fdXNlZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbXBzW2ldLmxheWVycy5fX3VzZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBjb21wc1tpXS5sYXllcnM7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShjb21wc1tpXS5sYXllcnMpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpICs9IDE7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIGNvbXBsZXRlU2hhcGVzKGFycil7XHJcbiAgICAgICAgdmFyIGksIGxlbiA9IGFyci5sZW5ndGg7XHJcbiAgICAgICAgdmFyIGosIGpMZW47XHJcbiAgICAgICAgdmFyIGhhc1BhdGhzID0gZmFsc2U7XHJcbiAgICAgICAgZm9yKGk9bGVuLTE7aT49MDtpLT0xKXtcclxuICAgICAgICAgICAgaWYoYXJyW2ldLnR5ID09ICdzaCcpe1xyXG4gICAgICAgICAgICAgICAgaWYoYXJyW2ldLmtzLmsuaSl7XHJcbiAgICAgICAgICAgICAgICAgICAgY29udmVydFBhdGhzVG9BYnNvbHV0ZVZhbHVlcyhhcnJbaV0ua3Muayk7XHJcbiAgICAgICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgICAgICBqTGVuID0gYXJyW2ldLmtzLmsubGVuZ3RoO1xyXG4gICAgICAgICAgICAgICAgICAgIGZvcihqPTA7ajxqTGVuO2orPTEpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZihhcnJbaV0ua3Mua1tqXS5zKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnZlcnRQYXRoc1RvQWJzb2x1dGVWYWx1ZXMoYXJyW2ldLmtzLmtbal0uc1swXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYoYXJyW2ldLmtzLmtbal0uZSl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb252ZXJ0UGF0aHNUb0Fic29sdXRlVmFsdWVzKGFycltpXS5rcy5rW2pdLmVbMF0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaGFzUGF0aHMgPSB0cnVlO1xyXG4gICAgICAgICAgICB9ZWxzZSBpZihhcnJbaV0udHkgPT0gJ2dyJyl7XHJcbiAgICAgICAgICAgICAgICBjb21wbGV0ZVNoYXBlcyhhcnJbaV0uaXQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8qaWYoaGFzUGF0aHMpe1xyXG4gICAgICAgICAgICAvL214OiBkaXN0YW5jZVxyXG4gICAgICAgICAgICAvL3NzOiBzZW5zaXRpdml0eVxyXG4gICAgICAgICAgICAvL2RjOiBkZWNheVxyXG4gICAgICAgICAgICBhcnIuc3BsaWNlKGFyci5sZW5ndGgtMSwwLHtcclxuICAgICAgICAgICAgICAgIFwidHlcIjogXCJtc1wiLFxyXG4gICAgICAgICAgICAgICAgXCJteFwiOjIwLFxyXG4gICAgICAgICAgICAgICAgXCJzc1wiOjEwLFxyXG4gICAgICAgICAgICAgICAgIFwiZGNcIjowLjAwMSxcclxuICAgICAgICAgICAgICAgIFwibWF4RGlzdFwiOjIwMFxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9Ki9cclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBjb252ZXJ0UGF0aHNUb0Fic29sdXRlVmFsdWVzKHBhdGgpe1xyXG4gICAgICAgIHZhciBpLCBsZW4gPSBwYXRoLmkubGVuZ3RoO1xyXG4gICAgICAgIGZvcihpPTA7aTxsZW47aSs9MSl7XHJcbiAgICAgICAgICAgIHBhdGguaVtpXVswXSArPSBwYXRoLnZbaV1bMF07XHJcbiAgICAgICAgICAgIHBhdGguaVtpXVsxXSArPSBwYXRoLnZbaV1bMV07XHJcbiAgICAgICAgICAgIHBhdGgub1tpXVswXSArPSBwYXRoLnZbaV1bMF07XHJcbiAgICAgICAgICAgIHBhdGgub1tpXVsxXSArPSBwYXRoLnZbaV1bMV07XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIGNoZWNrVmVyc2lvbihtaW5pbXVtLGFuaW1WZXJzaW9uU3RyaW5nKXtcclxuICAgICAgICB2YXIgYW5pbVZlcnNpb24gPSBhbmltVmVyc2lvblN0cmluZyA/IGFuaW1WZXJzaW9uU3RyaW5nLnNwbGl0KCcuJykgOiBbMTAwLDEwMCwxMDBdO1xyXG4gICAgICAgIGlmKG1pbmltdW1bMF0+YW5pbVZlcnNpb25bMF0pe1xyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9IGVsc2UgaWYoYW5pbVZlcnNpb25bMF0gPiBtaW5pbXVtWzBdKXtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZihtaW5pbXVtWzFdPmFuaW1WZXJzaW9uWzFdKXtcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfSBlbHNlIGlmKGFuaW1WZXJzaW9uWzFdID4gbWluaW11bVsxXSl7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYobWluaW11bVsyXT5hbmltVmVyc2lvblsyXSl7XHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH0gZWxzZSBpZihhbmltVmVyc2lvblsyXSA+IG1pbmltdW1bMl0pe1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHZhciBjaGVja1RleHQgPSAoZnVuY3Rpb24oKXtcclxuICAgICAgICB2YXIgbWluaW11bVZlcnNpb24gPSBbNCw0LDE0XTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gdXBkYXRlVGV4dExheWVyKHRleHRMYXllcil7XHJcbiAgICAgICAgICAgIHZhciBkb2N1bWVudERhdGEgPSB0ZXh0TGF5ZXIudC5kO1xyXG4gICAgICAgICAgICB0ZXh0TGF5ZXIudC5kID0ge1xyXG4gICAgICAgICAgICAgICAgazogW1xyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgczpkb2N1bWVudERhdGEsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHQ6MFxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIF1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gaXRlcmF0ZUxheWVycyhsYXllcnMpe1xyXG4gICAgICAgICAgICB2YXIgaSwgbGVuID0gbGF5ZXJzLmxlbmd0aDtcclxuICAgICAgICAgICAgZm9yKGk9MDtpPGxlbjtpKz0xKXtcclxuICAgICAgICAgICAgICAgIGlmKGxheWVyc1tpXS50eSA9PT0gNSl7XHJcbiAgICAgICAgICAgICAgICAgICAgdXBkYXRlVGV4dExheWVyKGxheWVyc1tpXSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAoYW5pbWF0aW9uRGF0YSl7XHJcbiAgICAgICAgICAgIGlmKGNoZWNrVmVyc2lvbihtaW5pbXVtVmVyc2lvbixhbmltYXRpb25EYXRhLnYpKXtcclxuICAgICAgICAgICAgICAgIGl0ZXJhdGVMYXllcnMoYW5pbWF0aW9uRGF0YS5sYXllcnMpO1xyXG4gICAgICAgICAgICAgICAgaWYoYW5pbWF0aW9uRGF0YS5hc3NldHMpe1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBpLCBsZW4gPSBhbmltYXRpb25EYXRhLmFzc2V0cy5sZW5ndGg7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yKGk9MDtpPGxlbjtpKz0xKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYoYW5pbWF0aW9uRGF0YS5hc3NldHNbaV0ubGF5ZXJzKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZXJhdGVMYXllcnMoYW5pbWF0aW9uRGF0YS5hc3NldHNbaV0ubGF5ZXJzKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9KCkpXHJcblxyXG4gICAgdmFyIGNoZWNrQ2hhcnMgPSAoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgdmFyIG1pbmltdW1WZXJzaW9uID0gWzQsNyw5OV07XHJcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChhbmltYXRpb25EYXRhKXtcclxuICAgICAgICAgICAgaWYoYW5pbWF0aW9uRGF0YS5jaGFycyAmJiAhY2hlY2tWZXJzaW9uKG1pbmltdW1WZXJzaW9uLGFuaW1hdGlvbkRhdGEudikpe1xyXG4gICAgICAgICAgICAgICAgdmFyIGksIGxlbiA9IGFuaW1hdGlvbkRhdGEuY2hhcnMubGVuZ3RoLCBqLCBqTGVuLCBrLCBrTGVuO1xyXG4gICAgICAgICAgICAgICAgdmFyIHBhdGhEYXRhLCBwYXRocztcclxuICAgICAgICAgICAgICAgIGZvcihpID0gMDsgaSA8IGxlbjsgaSArPSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYoYW5pbWF0aW9uRGF0YS5jaGFyc1tpXS5kYXRhICYmIGFuaW1hdGlvbkRhdGEuY2hhcnNbaV0uZGF0YS5zaGFwZXMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcGF0aHMgPSBhbmltYXRpb25EYXRhLmNoYXJzW2ldLmRhdGEuc2hhcGVzWzBdLml0O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBqTGVuID0gcGF0aHMubGVuZ3RoO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yKGogPSAwOyBqIDwgakxlbjsgaiArPSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXRoRGF0YSA9IHBhdGhzW2pdLmtzLms7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb252ZXJ0UGF0aHNUb0Fic29sdXRlVmFsdWVzKHBhdGhzW2pdLmtzLmspO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgIH0oKSlcclxuXHJcbiAgICB2YXIgY2hlY2tDb2xvcnMgPSAoZnVuY3Rpb24oKXtcclxuICAgICAgICB2YXIgbWluaW11bVZlcnNpb24gPSBbNCwxLDldO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBpdGVyYXRlU2hhcGVzKHNoYXBlcyl7XHJcbiAgICAgICAgICAgIHZhciBpLCBsZW4gPSBzaGFwZXMubGVuZ3RoO1xyXG4gICAgICAgICAgICB2YXIgaiwgakxlbjtcclxuICAgICAgICAgICAgZm9yKGk9MDtpPGxlbjtpKz0xKXtcclxuICAgICAgICAgICAgICAgIGlmKHNoYXBlc1tpXS50eSA9PT0gJ2dyJyl7XHJcbiAgICAgICAgICAgICAgICAgICAgaXRlcmF0ZVNoYXBlcyhzaGFwZXNbaV0uaXQpO1xyXG4gICAgICAgICAgICAgICAgfWVsc2UgaWYoc2hhcGVzW2ldLnR5ID09PSAnZmwnIHx8IHNoYXBlc1tpXS50eSA9PT0gJ3N0Jyl7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYoc2hhcGVzW2ldLmMuayAmJiBzaGFwZXNbaV0uYy5rWzBdLmkpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBqTGVuID0gc2hhcGVzW2ldLmMuay5sZW5ndGg7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvcihqPTA7ajxqTGVuO2orPTEpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoc2hhcGVzW2ldLmMua1tqXS5zKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaGFwZXNbaV0uYy5rW2pdLnNbMF0gLz0gMjU1O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNoYXBlc1tpXS5jLmtbal0uc1sxXSAvPSAyNTU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hhcGVzW2ldLmMua1tqXS5zWzJdIC89IDI1NTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaGFwZXNbaV0uYy5rW2pdLnNbM10gLz0gMjU1O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoc2hhcGVzW2ldLmMua1tqXS5lKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaGFwZXNbaV0uYy5rW2pdLmVbMF0gLz0gMjU1O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNoYXBlc1tpXS5jLmtbal0uZVsxXSAvPSAyNTU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hhcGVzW2ldLmMua1tqXS5lWzJdIC89IDI1NTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaGFwZXNbaV0uYy5rW2pdLmVbM10gLz0gMjU1O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2hhcGVzW2ldLmMua1swXSAvPSAyNTU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNoYXBlc1tpXS5jLmtbMV0gLz0gMjU1O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzaGFwZXNbaV0uYy5rWzJdIC89IDI1NTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2hhcGVzW2ldLmMua1szXSAvPSAyNTU7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBpdGVyYXRlTGF5ZXJzKGxheWVycyl7XHJcbiAgICAgICAgICAgIHZhciBpLCBsZW4gPSBsYXllcnMubGVuZ3RoO1xyXG4gICAgICAgICAgICBmb3IoaT0wO2k8bGVuO2krPTEpe1xyXG4gICAgICAgICAgICAgICAgaWYobGF5ZXJzW2ldLnR5ID09PSA0KXtcclxuICAgICAgICAgICAgICAgICAgICBpdGVyYXRlU2hhcGVzKGxheWVyc1tpXS5zaGFwZXMpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGFuaW1hdGlvbkRhdGEpe1xyXG4gICAgICAgICAgICBpZihjaGVja1ZlcnNpb24obWluaW11bVZlcnNpb24sYW5pbWF0aW9uRGF0YS52KSl7XHJcbiAgICAgICAgICAgICAgICBpdGVyYXRlTGF5ZXJzKGFuaW1hdGlvbkRhdGEubGF5ZXJzKTtcclxuICAgICAgICAgICAgICAgIGlmKGFuaW1hdGlvbkRhdGEuYXNzZXRzKXtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgaSwgbGVuID0gYW5pbWF0aW9uRGF0YS5hc3NldHMubGVuZ3RoO1xyXG4gICAgICAgICAgICAgICAgICAgIGZvcihpPTA7aTxsZW47aSs9MSl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGFuaW1hdGlvbkRhdGEuYXNzZXRzW2ldLmxheWVycyl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVyYXRlTGF5ZXJzKGFuaW1hdGlvbkRhdGEuYXNzZXRzW2ldLmxheWVycyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfSgpKTtcclxuXHJcbiAgICB2YXIgY2hlY2tTaGFwZXMgPSAoZnVuY3Rpb24oKXtcclxuICAgICAgICB2YXIgbWluaW11bVZlcnNpb24gPSBbNCw0LDE4XTtcclxuXHJcblxyXG5cclxuICAgICAgICBmdW5jdGlvbiBjb21wbGV0ZVNoYXBlcyhhcnIpe1xyXG4gICAgICAgICAgICB2YXIgaSwgbGVuID0gYXJyLmxlbmd0aDtcclxuICAgICAgICAgICAgdmFyIGosIGpMZW47XHJcbiAgICAgICAgICAgIHZhciBoYXNQYXRocyA9IGZhbHNlO1xyXG4gICAgICAgICAgICBmb3IoaT1sZW4tMTtpPj0wO2ktPTEpe1xyXG4gICAgICAgICAgICAgICAgaWYoYXJyW2ldLnR5ID09ICdzaCcpe1xyXG4gICAgICAgICAgICAgICAgICAgIGlmKGFycltpXS5rcy5rLmkpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhcnJbaV0ua3Muay5jID0gYXJyW2ldLmNsb3NlZDtcclxuICAgICAgICAgICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgakxlbiA9IGFycltpXS5rcy5rLmxlbmd0aDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yKGo9MDtqPGpMZW47ais9MSl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihhcnJbaV0ua3Mua1tqXS5zKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcnJbaV0ua3Mua1tqXS5zWzBdLmMgPSBhcnJbaV0uY2xvc2VkO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoYXJyW2ldLmtzLmtbal0uZSl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJyW2ldLmtzLmtbal0uZVswXS5jID0gYXJyW2ldLmNsb3NlZDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBoYXNQYXRocyA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB9ZWxzZSBpZihhcnJbaV0udHkgPT0gJ2dyJyl7XHJcbiAgICAgICAgICAgICAgICAgICAgY29tcGxldGVTaGFwZXMoYXJyW2ldLml0KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gaXRlcmF0ZUxheWVycyhsYXllcnMpe1xyXG4gICAgICAgICAgICB2YXIgbGF5ZXJEYXRhO1xyXG4gICAgICAgICAgICB2YXIgaSwgbGVuID0gbGF5ZXJzLmxlbmd0aDtcclxuICAgICAgICAgICAgdmFyIGosIGpMZW4sIGssIGtMZW47XHJcbiAgICAgICAgICAgIGZvcihpPTA7aTxsZW47aSs9MSl7XHJcbiAgICAgICAgICAgICAgICBsYXllckRhdGEgPSBsYXllcnNbaV07XHJcbiAgICAgICAgICAgICAgICBpZihsYXllckRhdGEuaGFzTWFzayl7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIG1hc2tQcm9wcyA9IGxheWVyRGF0YS5tYXNrc1Byb3BlcnRpZXM7XHJcbiAgICAgICAgICAgICAgICAgICAgakxlbiA9IG1hc2tQcm9wcy5sZW5ndGg7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yKGo9MDtqPGpMZW47ais9MSl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKG1hc2tQcm9wc1tqXS5wdC5rLmkpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFza1Byb3BzW2pdLnB0LmsuYyA9IG1hc2tQcm9wc1tqXS5jbDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBrTGVuID0gbWFza1Byb3BzW2pdLnB0LmsubGVuZ3RoO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yKGs9MDtrPGtMZW47ays9MSl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYobWFza1Byb3BzW2pdLnB0Lmtba10ucyl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hc2tQcm9wc1tqXS5wdC5rW2tdLnNbMF0uYyA9IG1hc2tQcm9wc1tqXS5jbDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYobWFza1Byb3BzW2pdLnB0Lmtba10uZSl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hc2tQcm9wc1tqXS5wdC5rW2tdLmVbMF0uYyA9IG1hc2tQcm9wc1tqXS5jbDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZihsYXllckRhdGEudHkgPT09IDQpe1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlU2hhcGVzKGxheWVyRGF0YS5zaGFwZXMpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGFuaW1hdGlvbkRhdGEpe1xyXG4gICAgICAgICAgICBpZihjaGVja1ZlcnNpb24obWluaW11bVZlcnNpb24sYW5pbWF0aW9uRGF0YS52KSl7XHJcbiAgICAgICAgICAgICAgICBpdGVyYXRlTGF5ZXJzKGFuaW1hdGlvbkRhdGEubGF5ZXJzKTtcclxuICAgICAgICAgICAgICAgIGlmKGFuaW1hdGlvbkRhdGEuYXNzZXRzKXtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgaSwgbGVuID0gYW5pbWF0aW9uRGF0YS5hc3NldHMubGVuZ3RoO1xyXG4gICAgICAgICAgICAgICAgICAgIGZvcihpPTA7aTxsZW47aSs9MSl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGFuaW1hdGlvbkRhdGEuYXNzZXRzW2ldLmxheWVycyl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVyYXRlTGF5ZXJzKGFuaW1hdGlvbkRhdGEuYXNzZXRzW2ldLmxheWVycyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfSgpKTtcclxuXHJcbiAgICAvKmZ1bmN0aW9uIGJsaXRQYXRocyhwYXRoKXtcclxuICAgICAgICB2YXIgaSwgbGVuID0gcGF0aC5pLmxlbmd0aDtcclxuICAgICAgICBmb3IoaT0wO2k8bGVuO2krPTEpe1xyXG4gICAgICAgICAgICBwYXRoLmlbaV1bMF0gLz0gYmxpdHRlcjtcclxuICAgICAgICAgICAgcGF0aC5pW2ldWzFdIC89IGJsaXR0ZXI7XHJcbiAgICAgICAgICAgIHBhdGgub1tpXVswXSAvPSBibGl0dGVyO1xyXG4gICAgICAgICAgICBwYXRoLm9baV1bMV0gLz0gYmxpdHRlcjtcclxuICAgICAgICAgICAgcGF0aC52W2ldWzBdIC89IGJsaXR0ZXI7XHJcbiAgICAgICAgICAgIHBhdGgudltpXVsxXSAvPSBibGl0dGVyO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBibGl0U2hhcGVzKGFycil7XHJcbiAgICAgICAgdmFyIGksIGxlbiA9IGFyci5sZW5ndGg7XHJcbiAgICAgICAgdmFyIGosIGpMZW47XHJcbiAgICAgICAgdmFyIGhhc1BhdGhzID0gZmFsc2U7XHJcbiAgICAgICAgZm9yKGk9bGVuLTE7aT49MDtpLT0xKXtcclxuICAgICAgICAgICAgaWYoYXJyW2ldLnR5ID09ICdzaCcpe1xyXG4gICAgICAgICAgICAgICAgaWYoYXJyW2ldLmtzLmsuaSl7XHJcbiAgICAgICAgICAgICAgICAgICAgYmxpdFBhdGhzKGFycltpXS5rcy5rKTtcclxuICAgICAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgICAgIGpMZW4gPSBhcnJbaV0ua3Muay5sZW5ndGg7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yKGo9MDtqPGpMZW47ais9MSl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGFycltpXS5rcy5rW2pdLnMpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYmxpdFBhdGhzKGFycltpXS5rcy5rW2pdLnNbMF0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGFycltpXS5rcy5rW2pdLmUpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYmxpdFBhdGhzKGFycltpXS5rcy5rW2pdLmVbMF0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaGFzUGF0aHMgPSB0cnVlO1xyXG4gICAgICAgICAgICB9ZWxzZSBpZihhcnJbaV0udHkgPT0gJ2dyJyl7XHJcbiAgICAgICAgICAgICAgICBibGl0U2hhcGVzKGFycltpXS5pdCk7XHJcbiAgICAgICAgICAgIH1lbHNlIGlmKGFycltpXS50eSA9PSAncmMnKXtcclxuICAgICAgICAgICAgICAgIGJsaXRQcm9wZXJ0eShhcnJbaV0ucCk7XHJcbiAgICAgICAgICAgICAgICBibGl0UHJvcGVydHkoYXJyW2ldLnMpO1xyXG4gICAgICAgICAgICB9ZWxzZSBpZihhcnJbaV0udHkgPT0gJ3N0Jyl7XHJcbiAgICAgICAgICAgICAgICBibGl0UHJvcGVydHkoYXJyW2ldLncpO1xyXG4gICAgICAgICAgICB9ZWxzZSBpZihhcnJbaV0udHkgPT0gJ3RyJyl7XHJcbiAgICAgICAgICAgICAgICBibGl0UHJvcGVydHkoYXJyW2ldLnApO1xyXG4gICAgICAgICAgICAgICAgYmxpdFByb3BlcnR5KGFycltpXS5zayk7XHJcbiAgICAgICAgICAgICAgICBibGl0UHJvcGVydHkoYXJyW2ldLmEpO1xyXG4gICAgICAgICAgICB9ZWxzZSBpZihhcnJbaV0udHkgPT0gJ2VsJyl7XHJcbiAgICAgICAgICAgICAgICBibGl0UHJvcGVydHkoYXJyW2ldLnApO1xyXG4gICAgICAgICAgICAgICAgYmxpdFByb3BlcnR5KGFycltpXS5zKTtcclxuICAgICAgICAgICAgfWVsc2UgaWYoYXJyW2ldLnR5ID09ICdyZCcpe1xyXG4gICAgICAgICAgICAgICAgYmxpdFByb3BlcnR5KGFycltpXS5yKTtcclxuICAgICAgICAgICAgfWVsc2V7XHJcblxyXG4gICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhhcnJbaV0udHkgKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBibGl0VGV4dChkYXRhLCBmb250TWFuYWdlcil7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIGJsaXRWYWx1ZSh2YWwpe1xyXG4gICAgICAgIGlmKHR5cGVvZih2YWwpID09PSAnbnVtYmVyJyl7XHJcbiAgICAgICAgICAgIHZhbCAvPSBibGl0dGVyO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHZhciBpID0gdmFsLmxlbmd0aC0xO1xyXG4gICAgICAgICAgICB3aGlsZShpPj0wKXtcclxuICAgICAgICAgICAgICAgIHZhbFtpXSAvPSBibGl0dGVyO1xyXG4gICAgICAgICAgICAgICAgaS09MTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdmFsO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIGJsaXRQcm9wZXJ0eShkYXRhKXtcclxuICAgICAgICBpZighZGF0YS5rLmxlbmd0aCl7XHJcbiAgICAgICAgICAgIGRhdGEuayA9IGJsaXRWYWx1ZShkYXRhLmspO1xyXG4gICAgICAgIH1lbHNlIGlmKHR5cGVvZihkYXRhLmtbMF0pID09PSAnbnVtYmVyJyl7XHJcbiAgICAgICAgICAgIGRhdGEuayA9IGJsaXRWYWx1ZShkYXRhLmspO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHZhciBpLCBsZW4gPSBkYXRhLmsubGVuZ3RoO1xyXG4gICAgICAgICAgICBmb3IoaT0wO2k8bGVuO2krPTEpe1xyXG4gICAgICAgICAgICAgICAgaWYoZGF0YS5rW2ldLnMpe1xyXG4gICAgICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coJ3ByZSBTOiAnLCBkYXRhLmtbaV0ucyk7XHJcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5rW2ldLnMgPSBibGl0VmFsdWUoZGF0YS5rW2ldLnMpO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coJ3Bvc3QgUzogJywgZGF0YS5rW2ldLnMpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYoZGF0YS5rW2ldLmUpe1xyXG4gICAgICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coJ3ByZSBFOiAnLCBkYXRhLmtbaV0uZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5rW2ldLmUgPSBibGl0VmFsdWUoZGF0YS5rW2ldLmUpO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coJ3Bvc3QgRTogJywgZGF0YS5rW2ldLmUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIGJsaXRMYXllcnMobGF5ZXJzLGNvbXBzLCBmb250TWFuYWdlcil7XHJcbiAgICAgICAgdmFyIGxheWVyRGF0YTtcclxuICAgICAgICB2YXIgYW5pbUFycmF5LCBsYXN0RnJhbWU7XHJcbiAgICAgICAgdmFyIGksIGxlbiA9IGxheWVycy5sZW5ndGg7XHJcbiAgICAgICAgdmFyIGosIGpMZW4sIGssIGtMZW47XHJcbiAgICAgICAgZm9yKGk9MDtpPGxlbjtpKz0xKXtcclxuICAgICAgICAgICAgbGF5ZXJEYXRhID0gbGF5ZXJzW2ldO1xyXG4gICAgICAgICAgICBpZighKCdrcycgaW4gbGF5ZXJEYXRhKSl7XHJcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBibGl0UHJvcGVydHkobGF5ZXJEYXRhLmtzLmEpO1xyXG4gICAgICAgICAgICBibGl0UHJvcGVydHkobGF5ZXJEYXRhLmtzLnApO1xyXG4gICAgICAgICAgICBsYXllckRhdGEuY29tcGxldGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgaWYobGF5ZXJEYXRhLnR0KXtcclxuICAgICAgICAgICAgICAgIGxheWVyc1tpLTFdLnRkID0gbGF5ZXJEYXRhLnR0O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGFuaW1BcnJheSA9IFtdO1xyXG4gICAgICAgICAgICBsYXN0RnJhbWUgPSAtMTtcclxuICAgICAgICAgICAgaWYobGF5ZXJEYXRhLmhhc01hc2spe1xyXG4gICAgICAgICAgICAgICAgdmFyIG1hc2tQcm9wcyA9IGxheWVyRGF0YS5tYXNrc1Byb3BlcnRpZXM7XHJcbiAgICAgICAgICAgICAgICBqTGVuID0gbWFza1Byb3BzLmxlbmd0aDtcclxuICAgICAgICAgICAgICAgIGZvcihqPTA7ajxqTGVuO2orPTEpe1xyXG4gICAgICAgICAgICAgICAgICAgIGlmKG1hc2tQcm9wc1tqXS5wdC5rLmkpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBibGl0UGF0aHMobWFza1Byb3BzW2pdLnB0LmspO1xyXG4gICAgICAgICAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBrTGVuID0gbWFza1Byb3BzW2pdLnB0LmsubGVuZ3RoO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3Ioaz0wO2s8a0xlbjtrKz0xKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKG1hc2tQcm9wc1tqXS5wdC5rW2tdLnMpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJsaXRQYXRocyhtYXNrUHJvcHNbal0ucHQua1trXS5zWzBdKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKG1hc2tQcm9wc1tqXS5wdC5rW2tdLmUpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJsaXRQYXRocyhtYXNrUHJvcHNbal0ucHQua1trXS5lWzBdKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZihsYXllckRhdGEudHk9PT0wKXtcclxuICAgICAgICAgICAgICAgIGxheWVyRGF0YS53ID0gTWF0aC5yb3VuZChsYXllckRhdGEudy9ibGl0dGVyKTtcclxuICAgICAgICAgICAgICAgIGxheWVyRGF0YS5oID0gTWF0aC5yb3VuZChsYXllckRhdGEuaC9ibGl0dGVyKTtcclxuICAgICAgICAgICAgICAgIGJsaXRMYXllcnMobGF5ZXJEYXRhLmxheWVycyxjb21wcywgZm9udE1hbmFnZXIpO1xyXG4gICAgICAgICAgICB9ZWxzZSBpZihsYXllckRhdGEudHkgPT09IDQpe1xyXG4gICAgICAgICAgICAgICAgYmxpdFNoYXBlcyhsYXllckRhdGEuc2hhcGVzKTtcclxuICAgICAgICAgICAgfWVsc2UgaWYobGF5ZXJEYXRhLnR5ID09IDUpe1xyXG4gICAgICAgICAgICAgICAgYmxpdFRleHQobGF5ZXJEYXRhLCBmb250TWFuYWdlcik7XHJcbiAgICAgICAgICAgIH1lbHNlIGlmKGxheWVyRGF0YS50eSA9PSAxKXtcclxuICAgICAgICAgICAgICAgIGxheWVyRGF0YS5zaCAvPSBibGl0dGVyO1xyXG4gICAgICAgICAgICAgICAgbGF5ZXJEYXRhLnN3IC89IGJsaXR0ZXI7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gYmxpdEFuaW1hdGlvbihhbmltYXRpb25EYXRhLGNvbXBzLCBmb250TWFuYWdlcil7XHJcbiAgICAgICAgYmxpdExheWVycyhhbmltYXRpb25EYXRhLmxheWVycyxjb21wcywgZm9udE1hbmFnZXIpO1xyXG4gICAgfSovXHJcblxyXG4gICAgZnVuY3Rpb24gY29tcGxldGVEYXRhKGFuaW1hdGlvbkRhdGEsIGZvbnRNYW5hZ2VyKXtcclxuICAgICAgICBpZihhbmltYXRpb25EYXRhLl9fY29tcGxldGUpe1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNoZWNrQ29sb3JzKGFuaW1hdGlvbkRhdGEpO1xyXG4gICAgICAgIGNoZWNrVGV4dChhbmltYXRpb25EYXRhKTtcclxuICAgICAgICBjaGVja0NoYXJzKGFuaW1hdGlvbkRhdGEpO1xyXG4gICAgICAgIGNoZWNrU2hhcGVzKGFuaW1hdGlvbkRhdGEpO1xyXG4gICAgICAgIGNvbXBsZXRlTGF5ZXJzKGFuaW1hdGlvbkRhdGEubGF5ZXJzLCBhbmltYXRpb25EYXRhLmFzc2V0cywgZm9udE1hbmFnZXIpO1xyXG4gICAgICAgIGFuaW1hdGlvbkRhdGEuX19jb21wbGV0ZSA9IHRydWU7XHJcbiAgICAgICAgLy9ibGl0QW5pbWF0aW9uKGFuaW1hdGlvbkRhdGEsIGFuaW1hdGlvbkRhdGEuYXNzZXRzLCBmb250TWFuYWdlcik7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gY29tcGxldGVUZXh0KGRhdGEsIGZvbnRNYW5hZ2VyKXtcclxuICAgICAgICB2YXIgbGV0dGVycztcclxuICAgICAgICB2YXIga2V5cyA9IGRhdGEudC5kLms7XHJcbiAgICAgICAgdmFyIGssIGtMZW4gPSBrZXlzLmxlbmd0aDtcclxuICAgICAgICBmb3Ioaz0wO2s8a0xlbjtrKz0xKXtcclxuICAgICAgICAgICAgdmFyIGRvY3VtZW50RGF0YSA9IGRhdGEudC5kLmtba10ucztcclxuICAgICAgICAgICAgbGV0dGVycyA9IFtdO1xyXG4gICAgICAgICAgICB2YXIgaSwgbGVuO1xyXG4gICAgICAgICAgICB2YXIgbmV3TGluZUZsYWcsIGluZGV4ID0gMCwgdmFsO1xyXG4gICAgICAgICAgICB2YXIgYW5jaG9yR3JvdXBpbmcgPSBkYXRhLnQubS5nO1xyXG4gICAgICAgICAgICB2YXIgY3VycmVudFNpemUgPSAwLCBjdXJyZW50UG9zID0gMCwgY3VycmVudExpbmUgPSAwLCBsaW5lV2lkdGhzID0gW107XHJcbiAgICAgICAgICAgIHZhciBsaW5lV2lkdGggPSAwO1xyXG4gICAgICAgICAgICB2YXIgbWF4TGluZVdpZHRoID0gMDtcclxuICAgICAgICAgICAgdmFyIGosIGpMZW47XHJcbiAgICAgICAgICAgIHZhciBmb250RGF0YSA9IGZvbnRNYW5hZ2VyLmdldEZvbnRCeU5hbWUoZG9jdW1lbnREYXRhLmYpO1xyXG4gICAgICAgICAgICB2YXIgY2hhckRhdGEsIGNMZW5ndGggPSAwO1xyXG4gICAgICAgICAgICB2YXIgc3R5bGVzID0gZm9udERhdGEuZlN0eWxlLnNwbGl0KCcgJyk7XHJcblxyXG4gICAgICAgICAgICB2YXIgZldlaWdodCA9ICdub3JtYWwnLCBmU3R5bGUgPSAnbm9ybWFsJztcclxuICAgICAgICAgICAgbGVuID0gc3R5bGVzLmxlbmd0aDtcclxuICAgICAgICAgICAgZm9yKGk9MDtpPGxlbjtpKz0xKXtcclxuICAgICAgICAgICAgICAgIGlmIChzdHlsZXNbaV0udG9Mb3dlckNhc2UoKSA9PT0gJ2l0YWxpYycpIHtcclxuICAgICAgICAgICAgICAgICAgICBmU3R5bGUgPSAnaXRhbGljJztcclxuICAgICAgICAgICAgICAgIH1lbHNlIGlmIChzdHlsZXNbaV0udG9Mb3dlckNhc2UoKSA9PT0gJ2JvbGQnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZldlaWdodCA9ICc3MDAnO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChzdHlsZXNbaV0udG9Mb3dlckNhc2UoKSA9PT0gJ2JsYWNrJykge1xyXG4gICAgICAgICAgICAgICAgICAgIGZXZWlnaHQgPSAnOTAwJztcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoc3R5bGVzW2ldLnRvTG93ZXJDYXNlKCkgPT09ICdtZWRpdW0nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZldlaWdodCA9ICc1MDAnO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChzdHlsZXNbaV0udG9Mb3dlckNhc2UoKSA9PT0gJ3JlZ3VsYXInIHx8IHN0eWxlc1tpXS50b0xvd2VyQ2FzZSgpID09PSAnbm9ybWFsJykge1xyXG4gICAgICAgICAgICAgICAgICAgIGZXZWlnaHQgPSAnNDAwJztcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoc3R5bGVzW2ldLnRvTG93ZXJDYXNlKCkgPT09ICdsaWdodCcgfHwgc3R5bGVzW2ldLnRvTG93ZXJDYXNlKCkgPT09ICd0aGluJykge1xyXG4gICAgICAgICAgICAgICAgICAgIGZXZWlnaHQgPSAnMjAwJztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBkb2N1bWVudERhdGEuZldlaWdodCA9IGZXZWlnaHQ7XHJcbiAgICAgICAgICAgIGRvY3VtZW50RGF0YS5mU3R5bGUgPSBmU3R5bGU7XHJcbiAgICAgICAgICAgIGxlbiA9IGRvY3VtZW50RGF0YS50Lmxlbmd0aDtcclxuICAgICAgICAgICAgaWYoZG9jdW1lbnREYXRhLnN6KXtcclxuICAgICAgICAgICAgICAgIHZhciBib3hXaWR0aCA9IGRvY3VtZW50RGF0YS5zelswXTtcclxuICAgICAgICAgICAgICAgIHZhciBsYXN0U3BhY2VJbmRleCA9IC0xO1xyXG4gICAgICAgICAgICAgICAgZm9yKGk9MDtpPGxlbjtpKz0xKXtcclxuICAgICAgICAgICAgICAgICAgICBuZXdMaW5lRmxhZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmKGRvY3VtZW50RGF0YS50LmNoYXJBdChpKSA9PT0gJyAnKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGFzdFNwYWNlSW5kZXggPSBpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1lbHNlIGlmKGRvY3VtZW50RGF0YS50LmNoYXJDb2RlQXQoaSkgPT09IDEzKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGluZVdpZHRoID0gMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbmV3TGluZUZsYWcgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZihmb250TWFuYWdlci5jaGFycyl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNoYXJEYXRhID0gZm9udE1hbmFnZXIuZ2V0Q2hhckRhdGEoZG9jdW1lbnREYXRhLnQuY2hhckF0KGkpLCBmb250RGF0YS5mU3R5bGUsIGZvbnREYXRhLmZGYW1pbHkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjTGVuZ3RoID0gbmV3TGluZUZsYWcgPyAwIDogY2hhckRhdGEudypkb2N1bWVudERhdGEucy8xMDA7XHJcbiAgICAgICAgICAgICAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vdENhbnZhc0hlbHBlci5mb250ID0gZG9jdW1lbnREYXRhLnMgKyAncHggJysgZm9udERhdGEuZkZhbWlseTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY0xlbmd0aCA9IGZvbnRNYW5hZ2VyLm1lYXN1cmVUZXh0KGRvY3VtZW50RGF0YS50LmNoYXJBdChpKSwgZG9jdW1lbnREYXRhLmYsIGRvY3VtZW50RGF0YS5zKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYobGluZVdpZHRoICsgY0xlbmd0aCA+IGJveFdpZHRoKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYobGFzdFNwYWNlSW5kZXggPT09IC0xKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vaSAtPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnREYXRhLnQgPSBkb2N1bWVudERhdGEudC5zdWJzdHIoMCxpKSArIFwiXFxyXCIgKyBkb2N1bWVudERhdGEudC5zdWJzdHIoaSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZW4gKz0gMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGkgPSBsYXN0U3BhY2VJbmRleDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50RGF0YS50ID0gZG9jdW1lbnREYXRhLnQuc3Vic3RyKDAsaSkgKyBcIlxcclwiICsgZG9jdW1lbnREYXRhLnQuc3Vic3RyKGkrMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgbGFzdFNwYWNlSW5kZXggPSAtMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGluZVdpZHRoID0gMDtcclxuICAgICAgICAgICAgICAgICAgICB9ZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxpbmVXaWR0aCArPSBjTGVuZ3RoO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGxlbiA9IGRvY3VtZW50RGF0YS50Lmxlbmd0aDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBsaW5lV2lkdGggPSAwO1xyXG4gICAgICAgICAgICBjTGVuZ3RoID0gMDtcclxuICAgICAgICAgICAgZm9yIChpID0gMDtpIDwgbGVuIDtpICs9IDEpIHtcclxuICAgICAgICAgICAgICAgIG5ld0xpbmVGbGFnID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBpZihkb2N1bWVudERhdGEudC5jaGFyQXQoaSkgPT09ICcgJyl7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFsID0gJ1xcdTAwQTAnO1xyXG4gICAgICAgICAgICAgICAgfWVsc2UgaWYoZG9jdW1lbnREYXRhLnQuY2hhckNvZGVBdChpKSA9PT0gMTMpe1xyXG4gICAgICAgICAgICAgICAgICAgIGxpbmVXaWR0aHMucHVzaChsaW5lV2lkdGgpO1xyXG4gICAgICAgICAgICAgICAgICAgIG1heExpbmVXaWR0aCA9IGxpbmVXaWR0aCA+IG1heExpbmVXaWR0aCA/IGxpbmVXaWR0aCA6IG1heExpbmVXaWR0aDtcclxuICAgICAgICAgICAgICAgICAgICBsaW5lV2lkdGggPSAwO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhbCA9ICcnO1xyXG4gICAgICAgICAgICAgICAgICAgIG5ld0xpbmVGbGFnID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICBjdXJyZW50TGluZSArPSAxO1xyXG4gICAgICAgICAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFsID0gZG9jdW1lbnREYXRhLnQuY2hhckF0KGkpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYoZm9udE1hbmFnZXIuY2hhcnMpe1xyXG4gICAgICAgICAgICAgICAgICAgIGNoYXJEYXRhID0gZm9udE1hbmFnZXIuZ2V0Q2hhckRhdGEoZG9jdW1lbnREYXRhLnQuY2hhckF0KGkpLCBmb250RGF0YS5mU3R5bGUsIGZvbnRNYW5hZ2VyLmdldEZvbnRCeU5hbWUoZG9jdW1lbnREYXRhLmYpLmZGYW1pbHkpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNMZW5ndGggPSBuZXdMaW5lRmxhZyA/IDAgOiBjaGFyRGF0YS53KmRvY3VtZW50RGF0YS5zLzEwMDtcclxuICAgICAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgICAgIC8vdmFyIGNoYXJXaWR0aCA9IGZvbnRNYW5hZ2VyLm1lYXN1cmVUZXh0KHZhbCwgZG9jdW1lbnREYXRhLmYsIGRvY3VtZW50RGF0YS5zKTtcclxuICAgICAgICAgICAgICAgICAgICAvL3RDYW52YXNIZWxwZXIuZm9udCA9IGRvY3VtZW50RGF0YS5zICsgJ3B4ICcrIGZvbnRNYW5hZ2VyLmdldEZvbnRCeU5hbWUoZG9jdW1lbnREYXRhLmYpLmZGYW1pbHk7XHJcbiAgICAgICAgICAgICAgICAgICAgY0xlbmd0aCA9IGZvbnRNYW5hZ2VyLm1lYXN1cmVUZXh0KHZhbCwgZG9jdW1lbnREYXRhLmYsIGRvY3VtZW50RGF0YS5zKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAvL1xyXG4gICAgICAgICAgICAgICAgbGluZVdpZHRoICs9IGNMZW5ndGg7XHJcbiAgICAgICAgICAgICAgICBsZXR0ZXJzLnB1c2goe2w6Y0xlbmd0aCxhbjpjTGVuZ3RoLGFkZDpjdXJyZW50U2l6ZSxuOm5ld0xpbmVGbGFnLCBhbkluZGV4ZXM6W10sIHZhbDogdmFsLCBsaW5lOiBjdXJyZW50TGluZX0pO1xyXG4gICAgICAgICAgICAgICAgaWYoYW5jaG9yR3JvdXBpbmcgPT0gMil7XHJcbiAgICAgICAgICAgICAgICAgICAgY3VycmVudFNpemUgKz0gY0xlbmd0aDtcclxuICAgICAgICAgICAgICAgICAgICBpZih2YWwgPT0gJycgfHwgdmFsID09ICdcXHUwMEEwJyB8fCBpID09IGxlbiAtIDEpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZih2YWwgPT0gJycgfHwgdmFsID09ICdcXHUwMEEwJyl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50U2l6ZSAtPSBjTGVuZ3RoO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlKGN1cnJlbnRQb3M8PWkpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0dGVyc1tjdXJyZW50UG9zXS5hbiA9IGN1cnJlbnRTaXplO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0dGVyc1tjdXJyZW50UG9zXS5pbmQgPSBpbmRleDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldHRlcnNbY3VycmVudFBvc10uZXh0cmEgPSBjTGVuZ3RoO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudFBvcyArPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGluZGV4ICs9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRTaXplID0gMDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9ZWxzZSBpZihhbmNob3JHcm91cGluZyA9PSAzKXtcclxuICAgICAgICAgICAgICAgICAgICBjdXJyZW50U2l6ZSArPSBjTGVuZ3RoO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmKHZhbCA9PSAnJyB8fCBpID09IGxlbiAtIDEpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZih2YWwgPT0gJycpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudFNpemUgLT0gY0xlbmd0aDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB3aGlsZShjdXJyZW50UG9zPD1pKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldHRlcnNbY3VycmVudFBvc10uYW4gPSBjdXJyZW50U2l6ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldHRlcnNbY3VycmVudFBvc10uaW5kID0gaW5kZXg7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXR0ZXJzW2N1cnJlbnRQb3NdLmV4dHJhID0gY0xlbmd0aDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRQb3MgKz0gMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50U2l6ZSA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGluZGV4ICs9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0dGVyc1tpbmRleF0uaW5kID0gaW5kZXg7XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0dGVyc1tpbmRleF0uZXh0cmEgPSAwO1xyXG4gICAgICAgICAgICAgICAgICAgIGluZGV4ICs9IDE7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZG9jdW1lbnREYXRhLmwgPSBsZXR0ZXJzO1xyXG4gICAgICAgICAgICBtYXhMaW5lV2lkdGggPSBsaW5lV2lkdGggPiBtYXhMaW5lV2lkdGggPyBsaW5lV2lkdGggOiBtYXhMaW5lV2lkdGg7XHJcbiAgICAgICAgICAgIGxpbmVXaWR0aHMucHVzaChsaW5lV2lkdGgpO1xyXG4gICAgICAgICAgICBpZihkb2N1bWVudERhdGEuc3ope1xyXG4gICAgICAgICAgICAgICAgZG9jdW1lbnREYXRhLmJveFdpZHRoID0gZG9jdW1lbnREYXRhLnN6WzBdO1xyXG4gICAgICAgICAgICAgICAgZG9jdW1lbnREYXRhLmp1c3RpZnlPZmZzZXQgPSAwO1xyXG4gICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgIGRvY3VtZW50RGF0YS5ib3hXaWR0aCA9IG1heExpbmVXaWR0aDtcclxuICAgICAgICAgICAgICAgIHN3aXRjaChkb2N1bWVudERhdGEuail7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAxOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudERhdGEuanVzdGlmeU9mZnNldCA9IC0gZG9jdW1lbnREYXRhLmJveFdpZHRoO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIDI6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50RGF0YS5qdXN0aWZ5T2Zmc2V0ID0gLSBkb2N1bWVudERhdGEuYm94V2lkdGgvMjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnREYXRhLmp1c3RpZnlPZmZzZXQgPSAwO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGRvY3VtZW50RGF0YS5saW5lV2lkdGhzID0gbGluZVdpZHRocztcclxuXHJcbiAgICAgICAgICAgIHZhciBhbmltYXRvcnMgPSBkYXRhLnQuYTtcclxuICAgICAgICAgICAgakxlbiA9IGFuaW1hdG9ycy5sZW5ndGg7XHJcbiAgICAgICAgICAgIHZhciBiYXNlZCwgaW5kLCBpbmRleGVzID0gW107XHJcbiAgICAgICAgICAgIGZvcihqPTA7ajxqTGVuO2orPTEpe1xyXG4gICAgICAgICAgICAgICAgaWYoYW5pbWF0b3JzW2pdLmEuc2Mpe1xyXG4gICAgICAgICAgICAgICAgICAgIGRvY3VtZW50RGF0YS5zdHJva2VDb2xvckFuaW0gPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYoYW5pbWF0b3JzW2pdLmEuc3cpe1xyXG4gICAgICAgICAgICAgICAgICAgIGRvY3VtZW50RGF0YS5zdHJva2VXaWR0aEFuaW0gPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYoYW5pbWF0b3JzW2pdLmEuZmMgfHwgYW5pbWF0b3JzW2pdLmEuZmggfHwgYW5pbWF0b3JzW2pdLmEuZnMgfHwgYW5pbWF0b3JzW2pdLmEuZmIpe1xyXG4gICAgICAgICAgICAgICAgICAgIGRvY3VtZW50RGF0YS5maWxsQ29sb3JBbmltID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGluZCA9IDA7XHJcbiAgICAgICAgICAgICAgICBiYXNlZCA9IGFuaW1hdG9yc1tqXS5zLmI7XHJcbiAgICAgICAgICAgICAgICBmb3IoaT0wO2k8bGVuO2krPTEpe1xyXG4gICAgICAgICAgICAgICAgICAgIGxldHRlcnNbaV0uYW5JbmRleGVzW2pdID0gaW5kO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmKChiYXNlZCA9PSAxICYmIGxldHRlcnNbaV0udmFsICE9ICcnKSB8fCAoYmFzZWQgPT0gMiAmJiBsZXR0ZXJzW2ldLnZhbCAhPSAnJyAmJiBsZXR0ZXJzW2ldLnZhbCAhPSAnXFx1MDBBMCcpIHx8IChiYXNlZCA9PSAzICYmIChsZXR0ZXJzW2ldLm4gfHwgbGV0dGVyc1tpXS52YWwgPT0gJ1xcdTAwQTAnIHx8IGkgPT0gbGVuIC0gMSkpIHx8IChiYXNlZCA9PSA0ICYmIChsZXR0ZXJzW2ldLm4gfHwgaSA9PSBsZW4gLSAxKSkpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZihhbmltYXRvcnNbal0ucy5ybiA9PT0gMSl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmRleGVzLnB1c2goaW5kKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpbmQgKz0gMTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBkYXRhLnQuYVtqXS5zLnRvdGFsQ2hhcnMgPSBpbmQ7XHJcbiAgICAgICAgICAgICAgICB2YXIgY3VycmVudEluZCA9IC0xLCBuZXdJbmQ7XHJcbiAgICAgICAgICAgICAgICBpZihhbmltYXRvcnNbal0ucy5ybiA9PT0gMSl7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yKGkgPSAwOyBpIDwgbGVuOyBpICs9IDEpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZihjdXJyZW50SW5kICE9IGxldHRlcnNbaV0uYW5JbmRleGVzW2pdKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRJbmQgPSBsZXR0ZXJzW2ldLmFuSW5kZXhlc1tqXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ld0luZCA9IGluZGV4ZXMuc3BsaWNlKE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSppbmRleGVzLmxlbmd0aCksMSlbMF07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgbGV0dGVyc1tpXS5hbkluZGV4ZXNbal0gPSBuZXdJbmQ7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmKGpMZW4gPT09IDAgJiYgISgnbScgaW4gZGF0YS50LnApKXtcclxuICAgICAgICAgICAgICAgIGRhdGEuc2luZ2xlU2hhcGUgPSB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGRvY3VtZW50RGF0YS55T2Zmc2V0ID0gZG9jdW1lbnREYXRhLmxoIHx8IGRvY3VtZW50RGF0YS5zKjEuMjtcclxuICAgICAgICAgICAgZG9jdW1lbnREYXRhLmxzID0gZG9jdW1lbnREYXRhLmxzIHx8IDA7XHJcbiAgICAgICAgICAgIGRvY3VtZW50RGF0YS5hc2NlbnQgPSBmb250RGF0YS5hc2NlbnQqZG9jdW1lbnREYXRhLnMvMTAwO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICB9XHJcblxyXG4gICAgdmFyIG1vZHVsZU9iID0ge307XHJcbiAgICBtb2R1bGVPYi5jb21wbGV0ZURhdGEgPSBjb21wbGV0ZURhdGE7XHJcblxyXG4gICAgcmV0dXJuIG1vZHVsZU9iO1xyXG59XHJcblxyXG52YXIgZGF0YU1hbmFnZXIgPSBkYXRhRnVuY3Rpb25NYW5hZ2VyKCk7XG52YXIgRm9udE1hbmFnZXIgPSAoZnVuY3Rpb24oKXtcclxuXHJcbiAgICB2YXIgbWF4V2FpdGluZ1RpbWUgPSA1MDAwO1xyXG5cclxuICAgIGZ1bmN0aW9uIHNldFVwTm9kZShmb250LCBmYW1pbHkpe1xyXG4gICAgICAgIHZhciBwYXJlbnROb2RlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpO1xyXG4gICAgICAgIHBhcmVudE5vZGUuc3R5bGUuZm9udEZhbWlseSAgICA9IGZhbWlseTtcclxuICAgICAgICB2YXIgbm9kZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTtcclxuICAgICAgICAvLyBDaGFyYWN0ZXJzIHRoYXQgdmFyeSBzaWduaWZpY2FudGx5IGFtb25nIGRpZmZlcmVudCBmb250c1xyXG4gICAgICAgIG5vZGUuaW5uZXJIVE1MID0gJ2dpSXRUMVdReUAhLS8jJztcclxuICAgICAgICAvLyBWaXNpYmxlIC0gc28gd2UgY2FuIG1lYXN1cmUgaXQgLSBidXQgbm90IG9uIHRoZSBzY3JlZW5cclxuICAgICAgICBwYXJlbnROb2RlLnN0eWxlLnBvc2l0aW9uICAgICAgPSAnYWJzb2x1dGUnO1xyXG4gICAgICAgIHBhcmVudE5vZGUuc3R5bGUubGVmdCAgICAgICAgICA9ICctMTAwMDBweCc7XHJcbiAgICAgICAgcGFyZW50Tm9kZS5zdHlsZS50b3AgICAgICAgICAgID0gJy0xMDAwMHB4JztcclxuICAgICAgICAvLyBMYXJnZSBmb250IHNpemUgbWFrZXMgZXZlbiBzdWJ0bGUgY2hhbmdlcyBvYnZpb3VzXHJcbiAgICAgICAgcGFyZW50Tm9kZS5zdHlsZS5mb250U2l6ZSAgICAgID0gJzMwMHB4JztcclxuICAgICAgICAvLyBSZXNldCBhbnkgZm9udCBwcm9wZXJ0aWVzXHJcbiAgICAgICAgcGFyZW50Tm9kZS5zdHlsZS5mb250VmFyaWFudCAgID0gJ25vcm1hbCc7XHJcbiAgICAgICAgcGFyZW50Tm9kZS5zdHlsZS5mb250U3R5bGUgICAgID0gJ25vcm1hbCc7XHJcbiAgICAgICAgcGFyZW50Tm9kZS5zdHlsZS5mb250V2VpZ2h0ICAgID0gJ25vcm1hbCc7XHJcbiAgICAgICAgcGFyZW50Tm9kZS5zdHlsZS5sZXR0ZXJTcGFjaW5nID0gJzAnO1xyXG4gICAgICAgIHBhcmVudE5vZGUuYXBwZW5kQ2hpbGQobm9kZSk7XHJcbiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChwYXJlbnROb2RlKTtcclxuXHJcbiAgICAgICAgLy8gUmVtZW1iZXIgd2lkdGggd2l0aCBubyBhcHBsaWVkIHdlYiBmb250XHJcbiAgICAgICAgdmFyIHdpZHRoID0gbm9kZS5vZmZzZXRXaWR0aDtcclxuICAgICAgICBub2RlLnN0eWxlLmZvbnRGYW1pbHkgPSBmb250ICsgJywgJytmYW1pbHk7XHJcbiAgICAgICAgcmV0dXJuIHtub2RlOm5vZGUsIHc6d2lkdGgsIHBhcmVudDpwYXJlbnROb2RlfTtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBjaGVja0xvYWRlZEZvbnRzKCkge1xyXG4gICAgICAgIHZhciBpLCBsZW4gPSB0aGlzLmZvbnRzLmxlbmd0aDtcclxuICAgICAgICB2YXIgbm9kZSwgdztcclxuICAgICAgICB2YXIgbG9hZGVkQ291bnQgPSBsZW47XHJcbiAgICAgICAgZm9yKGk9MDtpPGxlbjsgaSs9IDEpe1xyXG4gICAgICAgICAgICBpZih0aGlzLmZvbnRzW2ldLmxvYWRlZCl7XHJcbiAgICAgICAgICAgICAgICBsb2FkZWRDb3VudCAtPSAxO1xyXG4gICAgICAgICAgICAgICAgY29udGludWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYodGhpcy5mb250c1tpXS5mT3JpZ2luID09PSAndCcgfHwgdGhpcy5mb250c1tpXS5vcmlnaW4gPT09IDIpe1xyXG4gICAgICAgICAgICAgICAgaWYod2luZG93LlR5cGVraXQgJiYgd2luZG93LlR5cGVraXQubG9hZCAmJiB0aGlzLnR5cGVraXRMb2FkZWQgPT09IDApe1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudHlwZWtpdExvYWRlZCA9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgdHJ5e3dpbmRvdy5UeXBla2l0LmxvYWQoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhc3luYzogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgYWN0aXZlOiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudHlwZWtpdExvYWRlZCA9IDI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0uYmluZCh0aGlzKVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO31jYXRjaChlKXt9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZih0aGlzLnR5cGVraXRMb2FkZWQgPT09IDIpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmZvbnRzW2ldLmxvYWRlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZih0aGlzLmZvbnRzW2ldLmZPcmlnaW4gPT09ICduJyB8fCB0aGlzLmZvbnRzW2ldLm9yaWdpbiA9PT0gMCl7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmZvbnRzW2ldLmxvYWRlZCA9IHRydWU7XHJcbiAgICAgICAgICAgIH0gZWxzZXtcclxuICAgICAgICAgICAgICAgIG5vZGUgPSB0aGlzLmZvbnRzW2ldLm1vbm9DYXNlLm5vZGU7XHJcbiAgICAgICAgICAgICAgICB3ID0gdGhpcy5mb250c1tpXS5tb25vQ2FzZS53O1xyXG4gICAgICAgICAgICAgICAgaWYobm9kZS5vZmZzZXRXaWR0aCAhPT0gdyl7XHJcbiAgICAgICAgICAgICAgICAgICAgbG9hZGVkQ291bnQgLT0gMTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmZvbnRzW2ldLmxvYWRlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgICAgICBub2RlID0gdGhpcy5mb250c1tpXS5zYW5zQ2FzZS5ub2RlO1xyXG4gICAgICAgICAgICAgICAgICAgIHcgPSB0aGlzLmZvbnRzW2ldLnNhbnNDYXNlLnc7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYobm9kZS5vZmZzZXRXaWR0aCAhPT0gdyl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvYWRlZENvdW50IC09IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZm9udHNbaV0ubG9hZGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZih0aGlzLmZvbnRzW2ldLmxvYWRlZCl7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5mb250c1tpXS5zYW5zQ2FzZS5wYXJlbnQucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0aGlzLmZvbnRzW2ldLnNhbnNDYXNlLnBhcmVudCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5mb250c1tpXS5tb25vQ2FzZS5wYXJlbnQucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0aGlzLmZvbnRzW2ldLm1vbm9DYXNlLnBhcmVudCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmKGxvYWRlZENvdW50ICE9PSAwICYmIERhdGUubm93KCkgLSB0aGlzLmluaXRUaW1lIDwgbWF4V2FpdGluZ1RpbWUpe1xyXG4gICAgICAgICAgICBzZXRUaW1lb3V0KGNoZWNrTG9hZGVkRm9udHMuYmluZCh0aGlzKSwyMCk7XHJcbiAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKXt0aGlzLmxvYWRlZCA9IHRydWU7fS5iaW5kKHRoaXMpLDApO1xyXG5cclxuICAgICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIGZ1bmN0aW9uIGNyZWF0ZUhlbHBlcihkZWYsIGZvbnREYXRhKXtcclxuICAgICAgICB2YXIgdEhlbHBlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhzdmdOUywndGV4dCcpO1xyXG4gICAgICAgIHRIZWxwZXIuc3R5bGUuZm9udFNpemUgPSAnMTAwcHgnO1xyXG4gICAgICAgIHRIZWxwZXIuc3R5bGUuZm9udEZhbWlseSA9IGZvbnREYXRhLmZGYW1pbHk7XHJcbiAgICAgICAgdEhlbHBlci50ZXh0Q29udGVudCA9ICcxJztcclxuICAgICAgICBpZihmb250RGF0YS5mQ2xhc3Mpe1xyXG4gICAgICAgICAgICB0SGVscGVyLnN0eWxlLmZvbnRGYW1pbHkgPSAnaW5oZXJpdCc7XHJcbiAgICAgICAgICAgIHRIZWxwZXIuY2xhc3NOYW1lID0gZm9udERhdGEuZkNsYXNzO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRIZWxwZXIuc3R5bGUuZm9udEZhbWlseSA9IGZvbnREYXRhLmZGYW1pbHk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGRlZi5hcHBlbmRDaGlsZCh0SGVscGVyKTtcclxuICAgICAgICB2YXIgdENhbnZhc0hlbHBlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpLmdldENvbnRleHQoJzJkJyk7XHJcbiAgICAgICAgdENhbnZhc0hlbHBlci5mb250ID0gJzEwMHB4ICcrIGZvbnREYXRhLmZGYW1pbHk7XHJcbiAgICAgICAgcmV0dXJuIHRDYW52YXNIZWxwZXI7XHJcbiAgICAgICAgcmV0dXJuIHRIZWxwZXI7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gYWRkRm9udHMoZm9udERhdGEsIGRlZnMpe1xyXG4gICAgICAgIGlmKCFmb250RGF0YSl7XHJcbiAgICAgICAgICAgIHRoaXMubG9hZGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZih0aGlzLmNoYXJzKXtcclxuICAgICAgICAgICAgdGhpcy5sb2FkZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICB0aGlzLmZvbnRzID0gZm9udERhdGEubGlzdDtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdmFyIGZvbnRBcnIgPSBmb250RGF0YS5saXN0O1xyXG4gICAgICAgIHZhciBpLCBsZW4gPSBmb250QXJyLmxlbmd0aDtcclxuICAgICAgICBmb3IoaT0wOyBpPGxlbjsgaSs9IDEpe1xyXG4gICAgICAgICAgICBmb250QXJyW2ldLmxvYWRlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICBmb250QXJyW2ldLm1vbm9DYXNlID0gc2V0VXBOb2RlKGZvbnRBcnJbaV0uZkZhbWlseSwnbW9ub3NwYWNlJyk7XHJcbiAgICAgICAgICAgIGZvbnRBcnJbaV0uc2Fuc0Nhc2UgPSBzZXRVcE5vZGUoZm9udEFycltpXS5mRmFtaWx5LCdzYW5zLXNlcmlmJyk7XHJcbiAgICAgICAgICAgIGlmKCFmb250QXJyW2ldLmZQYXRoKSB7XHJcbiAgICAgICAgICAgICAgICBmb250QXJyW2ldLmxvYWRlZCA9IHRydWU7XHJcbiAgICAgICAgICAgIH1lbHNlIGlmKGZvbnRBcnJbaV0uZk9yaWdpbiA9PT0gJ3AnIHx8IGZvbnRBcnJbaV0ub3JpZ2luID09PSAzKXtcclxuICAgICAgICAgICAgICAgIHZhciBzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3R5bGUnKTtcclxuICAgICAgICAgICAgICAgIHMudHlwZSA9IFwidGV4dC9jc3NcIjtcclxuICAgICAgICAgICAgICAgIHMuaW5uZXJIVE1MID0gXCJAZm9udC1mYWNlIHtcIiArIFwiZm9udC1mYW1pbHk6IFwiK2ZvbnRBcnJbaV0uZkZhbWlseStcIjsgZm9udC1zdHlsZTogbm9ybWFsOyBzcmM6IHVybCgnXCIrZm9udEFycltpXS5mUGF0aCtcIicpO31cIjtcclxuICAgICAgICAgICAgICAgIGRlZnMuYXBwZW5kQ2hpbGQocyk7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZihmb250QXJyW2ldLmZPcmlnaW4gPT09ICdnJyB8fCBmb250QXJyW2ldLm9yaWdpbiA9PT0gMSl7XHJcbiAgICAgICAgICAgICAgICAvLzxsaW5rIGhyZWY9J2h0dHBzOi8vZm9udHMuZ29vZ2xlYXBpcy5jb20vY3NzP2ZhbWlseT1Nb250c2VycmF0JyByZWw9J3N0eWxlc2hlZXQnIHR5cGU9J3RleHQvY3NzJz5cclxuICAgICAgICAgICAgICAgIHZhciBsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGluaycpO1xyXG4gICAgICAgICAgICAgICAgbC50eXBlID0gXCJ0ZXh0L2Nzc1wiO1xyXG4gICAgICAgICAgICAgICAgbC5yZWwgPSBcInN0eWxlc2hlZXRcIjtcclxuICAgICAgICAgICAgICAgIGwuaHJlZiA9IGZvbnRBcnJbaV0uZlBhdGg7XHJcbiAgICAgICAgICAgICAgICBkZWZzLmFwcGVuZENoaWxkKGwpO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYoZm9udEFycltpXS5mT3JpZ2luID09PSAndCcgfHwgZm9udEFycltpXS5vcmlnaW4gPT09IDIpe1xyXG4gICAgICAgICAgICAgICAgLy88bGluayBocmVmPSdodHRwczovL2ZvbnRzLmdvb2dsZWFwaXMuY29tL2Nzcz9mYW1pbHk9TW9udHNlcnJhdCcgcmVsPSdzdHlsZXNoZWV0JyB0eXBlPSd0ZXh0L2Nzcyc+XHJcbiAgICAgICAgICAgICAgICB2YXIgc2MgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTtcclxuICAgICAgICAgICAgICAgIHNjLnNldEF0dHJpYnV0ZSgnc3JjJyxmb250QXJyW2ldLmZQYXRoKTtcclxuICAgICAgICAgICAgICAgIGRlZnMuYXBwZW5kQ2hpbGQoc2MpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGZvbnRBcnJbaV0uaGVscGVyID0gY3JlYXRlSGVscGVyKGRlZnMsZm9udEFycltpXSk7XHJcbiAgICAgICAgICAgIHRoaXMuZm9udHMucHVzaChmb250QXJyW2ldKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY2hlY2tMb2FkZWRGb250cy5iaW5kKHRoaXMpKCk7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gYWRkQ2hhcnMoY2hhcnMpe1xyXG4gICAgICAgIGlmKCFjaGFycyl7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYoIXRoaXMuY2hhcnMpe1xyXG4gICAgICAgICAgICB0aGlzLmNoYXJzID0gW107XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBpLCBsZW4gPSBjaGFycy5sZW5ndGg7XHJcbiAgICAgICAgdmFyIGosIGpMZW4gPSB0aGlzLmNoYXJzLmxlbmd0aCwgZm91bmQ7XHJcbiAgICAgICAgZm9yKGk9MDtpPGxlbjtpKz0xKXtcclxuICAgICAgICAgICAgaiA9IDA7XHJcbiAgICAgICAgICAgIGZvdW5kID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHdoaWxlKGo8akxlbil7XHJcbiAgICAgICAgICAgICAgICBpZih0aGlzLmNoYXJzW2pdLnN0eWxlID09PSBjaGFyc1tpXS5zdHlsZSAmJiB0aGlzLmNoYXJzW2pdLmZGYW1pbHkgPT09IGNoYXJzW2ldLmZGYW1pbHkgJiYgdGhpcy5jaGFyc1tqXS5jaCA9PT0gY2hhcnNbaV0uY2gpe1xyXG4gICAgICAgICAgICAgICAgICAgIGZvdW5kID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGogKz0gMTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZighZm91bmQpe1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jaGFycy5wdXNoKGNoYXJzW2ldKTtcclxuICAgICAgICAgICAgICAgIGpMZW4gKz0gMTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBnZXRDaGFyRGF0YShjaGFyLCBzdHlsZSwgZm9udCl7XHJcbiAgICAgICAgdmFyIGkgPSAwLCBsZW4gPSB0aGlzLmNoYXJzLmxlbmd0aDtcclxuICAgICAgICB3aGlsZSggaSA8IGxlbikge1xyXG4gICAgICAgICAgICBpZih0aGlzLmNoYXJzW2ldLmNoID09PSBjaGFyICYmIHRoaXMuY2hhcnNbaV0uc3R5bGUgPT09IHN0eWxlICYmIHRoaXMuY2hhcnNbaV0uZkZhbWlseSA9PT0gZm9udCl7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5jaGFyc1tpXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpKz0gMTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gbWVhc3VyZVRleHQoY2hhciwgZm9udE5hbWUsIHNpemUpe1xyXG4gICAgICAgIHZhciBmb250RGF0YSA9IHRoaXMuZ2V0Rm9udEJ5TmFtZShmb250TmFtZSk7XHJcbiAgICAgICAgdmFyIHRIZWxwZXIgPSBmb250RGF0YS5oZWxwZXI7XHJcbiAgICAgICAgLy90SGVscGVyLnRleHRDb250ZW50ID0gY2hhcjtcclxuICAgICAgICByZXR1cm4gdEhlbHBlci5tZWFzdXJlVGV4dChjaGFyKS53aWR0aCpzaXplLzEwMDtcclxuICAgICAgICAvL3JldHVybiB0SGVscGVyLmdldENvbXB1dGVkVGV4dExlbmd0aCgpKnNpemUvMTAwO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIGdldEZvbnRCeU5hbWUobmFtZSl7XHJcbiAgICAgICAgdmFyIGkgPSAwLCBsZW4gPSB0aGlzLmZvbnRzLmxlbmd0aDtcclxuICAgICAgICB3aGlsZShpPGxlbil7XHJcbiAgICAgICAgICAgIGlmKHRoaXMuZm9udHNbaV0uZk5hbWUgPT09IG5hbWUpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmZvbnRzW2ldO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGkgKz0gMTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuICdzYW5zLXNlcmlmJztcclxuICAgIH1cclxuXHJcbiAgICB2YXIgRm9udCA9IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgdGhpcy5mb250cyA9IFtdO1xyXG4gICAgICAgIHRoaXMuY2hhcnMgPSBudWxsO1xyXG4gICAgICAgIHRoaXMudHlwZWtpdExvYWRlZCA9IDA7XHJcbiAgICAgICAgdGhpcy5sb2FkZWQgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLmluaXRUaW1lID0gRGF0ZS5ub3coKTtcclxuICAgIH07XHJcbiAgICBGb250LnByb3RvdHlwZS5hZGRDaGFycyA9IGFkZENoYXJzO1xyXG4gICAgRm9udC5wcm90b3R5cGUuYWRkRm9udHMgPSBhZGRGb250cztcclxuICAgIEZvbnQucHJvdG90eXBlLmdldENoYXJEYXRhID0gZ2V0Q2hhckRhdGE7XHJcbiAgICBGb250LnByb3RvdHlwZS5nZXRGb250QnlOYW1lID0gZ2V0Rm9udEJ5TmFtZTtcclxuICAgIEZvbnQucHJvdG90eXBlLm1lYXN1cmVUZXh0ID0gbWVhc3VyZVRleHQ7XHJcblxyXG4gICAgcmV0dXJuIEZvbnQ7XHJcblxyXG59KCkpO1xudmFyIFByb3BlcnR5RmFjdG9yeSA9IChmdW5jdGlvbigpe1xyXG5cclxuICAgIHZhciBpbml0RnJhbWUgPSAtOTk5OTk5O1xyXG5cclxuICAgIGZ1bmN0aW9uIGdldFZhbHVlKCl7XHJcbiAgICAgICAgaWYodGhpcy5lbGVtLmdsb2JhbERhdGEuZnJhbWVJZCA9PT0gdGhpcy5mcmFtZUlkKXtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLm1kZiA9IGZhbHNlO1xyXG4gICAgICAgIHZhciBmcmFtZU51bSA9IHRoaXMuY29tcC5yZW5kZXJlZEZyYW1lIC0gdGhpcy5vZmZzZXRUaW1lO1xyXG4gICAgICAgIGlmKCEoZnJhbWVOdW0gPT09IHRoaXMubGFzdEZyYW1lIHx8ICh0aGlzLmxhc3RGcmFtZSAhPT0gaW5pdEZyYW1lICYmICgodGhpcy5sYXN0RnJhbWUgPj0gdGhpcy5rZXlmcmFtZXNbdGhpcy5rZXlmcmFtZXMubGVuZ3RoLSAxXS50LXRoaXMub2Zmc2V0VGltZSAmJiBmcmFtZU51bSA+PSB0aGlzLmtleWZyYW1lc1t0aGlzLmtleWZyYW1lcy5sZW5ndGgtIDFdLnQtdGhpcy5vZmZzZXRUaW1lKSB8fCAodGhpcy5sYXN0RnJhbWUgPCB0aGlzLmtleWZyYW1lc1swXS50LXRoaXMub2Zmc2V0VGltZSAmJiBmcmFtZU51bSA8IHRoaXMua2V5ZnJhbWVzWzBdLnQtdGhpcy5vZmZzZXRUaW1lKSkpKSl7XHJcbiAgICAgICAgICAgIHZhciBpID0gdGhpcy5sYXN0RnJhbWUgPCBmcmFtZU51bSA/IHRoaXMuX2xhc3RJbmRleCA6IDA7XHJcbiAgICAgICAgICAgIHZhciBsZW4gPSB0aGlzLmtleWZyYW1lcy5sZW5ndGgtIDEsZmxhZyA9IHRydWU7XHJcbiAgICAgICAgICAgIHZhciBrZXlEYXRhLCBuZXh0S2V5RGF0YTtcclxuXHJcbiAgICAgICAgICAgIHdoaWxlKGZsYWcpe1xyXG4gICAgICAgICAgICAgICAga2V5RGF0YSA9IHRoaXMua2V5ZnJhbWVzW2ldO1xyXG4gICAgICAgICAgICAgICAgbmV4dEtleURhdGEgPSB0aGlzLmtleWZyYW1lc1tpKzFdO1xyXG4gICAgICAgICAgICAgICAgaWYoaSA9PSBsZW4tMSAmJiBmcmFtZU51bSA+PSBuZXh0S2V5RGF0YS50IC0gdGhpcy5vZmZzZXRUaW1lKXtcclxuICAgICAgICAgICAgICAgICAgICBpZihrZXlEYXRhLmgpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBrZXlEYXRhID0gbmV4dEtleURhdGE7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYoKG5leHRLZXlEYXRhLnQgLSB0aGlzLm9mZnNldFRpbWUpID4gZnJhbWVOdW0pe1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYoaSA8IGxlbiAtIDEpe1xyXG4gICAgICAgICAgICAgICAgICAgIGkgKz0gMTtcclxuICAgICAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgICAgIGZsYWcgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdGhpcy5fbGFzdEluZGV4ID0gaTtcclxuXHJcbiAgICAgICAgICAgIHZhciBrLCBrTGVuLHBlcmMsakxlbiwgaiwgZm5jO1xyXG4gICAgICAgICAgICBpZihrZXlEYXRhLnRvKXtcclxuXHJcbiAgICAgICAgICAgICAgICBpZigha2V5RGF0YS5iZXppZXJEYXRhKXtcclxuICAgICAgICAgICAgICAgICAgICBiZXouYnVpbGRCZXppZXJEYXRhKGtleURhdGEpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgdmFyIGJlemllckRhdGEgPSBrZXlEYXRhLmJlemllckRhdGE7XHJcbiAgICAgICAgICAgICAgICBpZihmcmFtZU51bSA+PSBuZXh0S2V5RGF0YS50LXRoaXMub2Zmc2V0VGltZSB8fCBmcmFtZU51bSA8IGtleURhdGEudC10aGlzLm9mZnNldFRpbWUpe1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBpbmQgPSBmcmFtZU51bSA+PSBuZXh0S2V5RGF0YS50LXRoaXMub2Zmc2V0VGltZSA/IGJlemllckRhdGEucG9pbnRzLmxlbmd0aCAtIDEgOiAwO1xyXG4gICAgICAgICAgICAgICAgICAgIGtMZW4gPSBiZXppZXJEYXRhLnBvaW50c1tpbmRdLnBvaW50Lmxlbmd0aDtcclxuICAgICAgICAgICAgICAgICAgICBmb3IoayA9IDA7IGsgPCBrTGVuOyBrICs9IDEpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnB2W2tdID0gYmV6aWVyRGF0YS5wb2ludHNbaW5kXS5wb2ludFtrXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy52W2tdID0gdGhpcy5tdWx0ID8gdGhpcy5wdltrXSp0aGlzLm11bHQgOiB0aGlzLnB2W2tdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZih0aGlzLmxhc3RQVmFsdWVba10gIT09IHRoaXMucHZba10pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubWRmID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubGFzdFBWYWx1ZVtrXSA9IHRoaXMucHZba107XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fbGFzdEJlemllckRhdGEgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYoa2V5RGF0YS5fX2ZuY3Qpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmbmMgPSBrZXlEYXRhLl9fZm5jdDtcclxuICAgICAgICAgICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm5jID0gQmV6aWVyRmFjdG9yeS5nZXRCZXppZXJFYXNpbmcoa2V5RGF0YS5vLngsa2V5RGF0YS5vLnksa2V5RGF0YS5pLngsa2V5RGF0YS5pLnksa2V5RGF0YS5uKS5nZXQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGtleURhdGEuX19mbmN0ID0gZm5jO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBwZXJjID0gZm5jKChmcmFtZU51bS0oa2V5RGF0YS50LXRoaXMub2Zmc2V0VGltZSkpLygobmV4dEtleURhdGEudC10aGlzLm9mZnNldFRpbWUpLShrZXlEYXRhLnQtdGhpcy5vZmZzZXRUaW1lKSkpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBkaXN0YW5jZUluTGluZSA9IGJlemllckRhdGEuc2VnbWVudExlbmd0aCpwZXJjO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB2YXIgc2VnbWVudFBlcmM7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGFkZGVkTGVuZ3RoID0gICh0aGlzLmxhc3RGcmFtZSA8IGZyYW1lTnVtICYmIHRoaXMuX2xhc3RCZXppZXJEYXRhID09PSBiZXppZXJEYXRhKSA/IHRoaXMuX2xhc3RBZGRlZExlbmd0aCA6IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgaiA9ICAodGhpcy5sYXN0RnJhbWUgPCBmcmFtZU51bSAmJiB0aGlzLl9sYXN0QmV6aWVyRGF0YSA9PT0gYmV6aWVyRGF0YSkgPyB0aGlzLl9sYXN0UG9pbnQgOiAwO1xyXG4gICAgICAgICAgICAgICAgICAgIGZsYWcgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIGpMZW4gPSBiZXppZXJEYXRhLnBvaW50cy5sZW5ndGg7XHJcbiAgICAgICAgICAgICAgICAgICAgd2hpbGUoZmxhZyl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFkZGVkTGVuZ3RoICs9YmV6aWVyRGF0YS5wb2ludHNbal0ucGFydGlhbExlbmd0aDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYoZGlzdGFuY2VJbkxpbmUgPT09IDAgfHwgcGVyYyA9PT0gMCB8fCBqID09IGJlemllckRhdGEucG9pbnRzLmxlbmd0aCAtIDEpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAga0xlbiA9IGJlemllckRhdGEucG9pbnRzW2pdLnBvaW50Lmxlbmd0aDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcihrPTA7azxrTGVuO2srPTEpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucHZba10gPSBiZXppZXJEYXRhLnBvaW50c1tqXS5wb2ludFtrXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnZba10gPSB0aGlzLm11bHQgPyB0aGlzLnB2W2tdKnRoaXMubXVsdCA6IHRoaXMucHZba107XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYodGhpcy5sYXN0UFZhbHVlW2tdICE9PSB0aGlzLnB2W2tdKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubWRmID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sYXN0UFZhbHVlW2tdID0gdGhpcy5wdltrXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgfWVsc2UgaWYoZGlzdGFuY2VJbkxpbmUgPj0gYWRkZWRMZW5ndGggJiYgZGlzdGFuY2VJbkxpbmUgPCBhZGRlZExlbmd0aCArIGJlemllckRhdGEucG9pbnRzW2orMV0ucGFydGlhbExlbmd0aCl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWdtZW50UGVyYyA9IChkaXN0YW5jZUluTGluZS1hZGRlZExlbmd0aCkvKGJlemllckRhdGEucG9pbnRzW2orMV0ucGFydGlhbExlbmd0aCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBrTGVuID0gYmV6aWVyRGF0YS5wb2ludHNbal0ucG9pbnQubGVuZ3RoO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yKGs9MDtrPGtMZW47ays9MSl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wdltrXSA9IGJlemllckRhdGEucG9pbnRzW2pdLnBvaW50W2tdICsgKGJlemllckRhdGEucG9pbnRzW2orMV0ucG9pbnRba10gLSBiZXppZXJEYXRhLnBvaW50c1tqXS5wb2ludFtrXSkqc2VnbWVudFBlcmM7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy52W2tdID0gdGhpcy5tdWx0ID8gdGhpcy5wdltrXSAqIHRoaXMubXVsdCA6IHRoaXMucHZba107XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYodGhpcy5sYXN0UFZhbHVlW2tdICE9PSB0aGlzLnB2W2tdKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubWRmID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sYXN0UFZhbHVlW2tdID0gdGhpcy5wdltrXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZihqIDwgakxlbiAtIDEpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaiArPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZsYWcgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9sYXN0UG9pbnQgPSBqO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2xhc3RBZGRlZExlbmd0aCA9IGFkZGVkTGVuZ3RoIC0gYmV6aWVyRGF0YS5wb2ludHNbal0ucGFydGlhbExlbmd0aDtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9sYXN0QmV6aWVyRGF0YSA9IGJlemllckRhdGE7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgdmFyIG91dFgsb3V0WSxpblgsaW5ZLCBrZXlWYWx1ZTtcclxuICAgICAgICAgICAgICAgIGxlbiA9IGtleURhdGEucy5sZW5ndGg7XHJcbiAgICAgICAgICAgICAgICBmb3IoaT0wO2k8bGVuO2krPTEpe1xyXG4gICAgICAgICAgICAgICAgICAgIGlmKGtleURhdGEuaCAhPT0gMSl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGZyYW1lTnVtID49IG5leHRLZXlEYXRhLnQtdGhpcy5vZmZzZXRUaW1lKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBlcmMgPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9ZWxzZSBpZihmcmFtZU51bSA8IGtleURhdGEudC10aGlzLm9mZnNldFRpbWUpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGVyYyA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoa2V5RGF0YS5vLnggaW5zdGFuY2VvZiBBcnJheSl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoIWtleURhdGEuX19mbmN0KXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAga2V5RGF0YS5fX2ZuY3QgPSBbXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFrZXlEYXRhLl9fZm5jdFtpXSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvdXRYID0ga2V5RGF0YS5vLnhbaV0gfHwga2V5RGF0YS5vLnhbMF07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG91dFkgPSBrZXlEYXRhLm8ueVtpXSB8fCBrZXlEYXRhLm8ueVswXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5YID0ga2V5RGF0YS5pLnhbaV0gfHwga2V5RGF0YS5pLnhbMF07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluWSA9IGtleURhdGEuaS55W2ldIHx8IGtleURhdGEuaS55WzBdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmbmMgPSBCZXppZXJGYWN0b3J5LmdldEJlemllckVhc2luZyhvdXRYLG91dFksaW5YLGluWSkuZ2V0O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBrZXlEYXRhLl9fZm5jdFtpXSA9IGZuYztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmbmMgPSBrZXlEYXRhLl9fZm5jdFtpXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgha2V5RGF0YS5fX2ZuY3QpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3V0WCA9IGtleURhdGEuby54O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvdXRZID0ga2V5RGF0YS5vLnk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluWCA9IGtleURhdGEuaS54O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpblkgPSBrZXlEYXRhLmkueTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm5jID0gQmV6aWVyRmFjdG9yeS5nZXRCZXppZXJFYXNpbmcob3V0WCxvdXRZLGluWCxpblkpLmdldDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAga2V5RGF0YS5fX2ZuY3QgPSBmbmM7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNle1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmbmMgPSBrZXlEYXRhLl9fZm5jdDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwZXJjID0gZm5jKChmcmFtZU51bS0oa2V5RGF0YS50LXRoaXMub2Zmc2V0VGltZSkpLygobmV4dEtleURhdGEudC10aGlzLm9mZnNldFRpbWUpLShrZXlEYXRhLnQtdGhpcy5vZmZzZXRUaW1lKSkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmKHRoaXMuc2ggJiYga2V5RGF0YS5oICE9PSAxKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGluaXRQID0ga2V5RGF0YS5zW2ldO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZW5kUCA9IGtleURhdGEuZVtpXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYoaW5pdFAtZW5kUCA8IC0xODApe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5pdFAgKz0gMzYwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYoaW5pdFAtZW5kUCA+IDE4MCl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbml0UCAtPSAzNjA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAga2V5VmFsdWUgPSBpbml0UCsoZW5kUC1pbml0UCkqcGVyYztcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBrZXlWYWx1ZSA9IGtleURhdGEuaCA9PT0gMSA/IGtleURhdGEuc1tpXSA6IGtleURhdGEuc1tpXSsoa2V5RGF0YS5lW2ldLWtleURhdGEuc1tpXSkqcGVyYztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYobGVuID09PSAxKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy52ID0gdGhpcy5tdWx0ID8ga2V5VmFsdWUqdGhpcy5tdWx0IDoga2V5VmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucHYgPSBrZXlWYWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYodGhpcy5sYXN0UFZhbHVlICE9IHRoaXMucHYpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tZGYgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sYXN0UFZhbHVlID0gdGhpcy5wdjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnZbaV0gPSB0aGlzLm11bHQgPyBrZXlWYWx1ZSp0aGlzLm11bHQgOiBrZXlWYWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wdltpXSA9IGtleVZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZih0aGlzLmxhc3RQVmFsdWVbaV0gIT09IHRoaXMucHZbaV0pe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tZGYgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sYXN0UFZhbHVlW2ldID0gdGhpcy5wdltpXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmxhc3RGcmFtZSA9IGZyYW1lTnVtO1xyXG4gICAgICAgIHRoaXMuZnJhbWVJZCA9IHRoaXMuZWxlbS5nbG9iYWxEYXRhLmZyYW1lSWQ7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gZ2V0Tm9WYWx1ZSgpe31cclxuXHJcbiAgICBmdW5jdGlvbiBWYWx1ZVByb3BlcnR5KGVsZW0sZGF0YSwgbXVsdCl7XHJcbiAgICAgICAgdGhpcy5tdWx0ID0gbXVsdDtcclxuICAgICAgICB0aGlzLnYgPSBtdWx0ID8gZGF0YS5rICogbXVsdCA6IGRhdGEuaztcclxuICAgICAgICB0aGlzLnB2ID0gZGF0YS5rO1xyXG4gICAgICAgIHRoaXMubWRmID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5jb21wID0gZWxlbS5jb21wO1xyXG4gICAgICAgIHRoaXMuayA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMua2YgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLnZlbCA9IDA7XHJcbiAgICAgICAgdGhpcy5nZXRWYWx1ZSA9IGdldE5vVmFsdWU7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gTXVsdGlEaW1lbnNpb25hbFByb3BlcnR5KGVsZW0sZGF0YSwgbXVsdCl7XHJcbiAgICAgICAgdGhpcy5tdWx0ID0gbXVsdDtcclxuICAgICAgICB0aGlzLmRhdGEgPSBkYXRhO1xyXG4gICAgICAgIHRoaXMubWRmID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5jb21wID0gZWxlbS5jb21wO1xyXG4gICAgICAgIHRoaXMuayA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMua2YgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLmZyYW1lSWQgPSAtMTtcclxuICAgICAgICB0aGlzLnYgPSBBcnJheS5hcHBseShudWxsLCB7bGVuZ3RoOmRhdGEuay5sZW5ndGh9KTtcclxuICAgICAgICB0aGlzLnB2ID0gQXJyYXkuYXBwbHkobnVsbCwge2xlbmd0aDpkYXRhLmsubGVuZ3RofSk7XHJcbiAgICAgICAgdGhpcy5sYXN0VmFsdWUgPSBBcnJheS5hcHBseShudWxsLCB7bGVuZ3RoOmRhdGEuay5sZW5ndGh9KTtcclxuICAgICAgICB2YXIgYXJyID0gQXJyYXkuYXBwbHkobnVsbCwge2xlbmd0aDpkYXRhLmsubGVuZ3RofSk7XHJcbiAgICAgICAgdGhpcy52ZWwgPSBhcnIubWFwKGZ1bmN0aW9uICgpIHsgcmV0dXJuIDAgfSk7XHJcbiAgICAgICAgdmFyIGksIGxlbiA9IGRhdGEuay5sZW5ndGg7XHJcbiAgICAgICAgZm9yKGkgPSAwO2k8bGVuO2krPTEpe1xyXG4gICAgICAgICAgICB0aGlzLnZbaV0gPSBtdWx0ID8gZGF0YS5rW2ldICogbXVsdCA6IGRhdGEua1tpXTtcclxuICAgICAgICAgICAgdGhpcy5wdltpXSA9IGRhdGEua1tpXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5nZXRWYWx1ZSA9IGdldE5vVmFsdWU7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gS2V5ZnJhbWVkVmFsdWVQcm9wZXJ0eShlbGVtLCBkYXRhLCBtdWx0KXtcclxuICAgICAgICB0aGlzLmtleWZyYW1lcyA9IGRhdGEuaztcclxuICAgICAgICB0aGlzLm9mZnNldFRpbWUgPSBlbGVtLmRhdGEuc3Q7XHJcbiAgICAgICAgdGhpcy5sYXN0VmFsdWUgPSAtOTk5OTk7XHJcbiAgICAgICAgdGhpcy5sYXN0UFZhbHVlID0gLTk5OTk5O1xyXG4gICAgICAgIHRoaXMuZnJhbWVJZCA9IC0xO1xyXG4gICAgICAgIHRoaXMuX2xhc3RJbmRleCA9IDA7XHJcbiAgICAgICAgdGhpcy5rID0gdHJ1ZTtcclxuICAgICAgICB0aGlzLmtmID0gdHJ1ZTtcclxuICAgICAgICB0aGlzLmRhdGEgPSBkYXRhO1xyXG4gICAgICAgIHRoaXMubXVsdCA9IG11bHQ7XHJcbiAgICAgICAgdGhpcy5lbGVtID0gZWxlbTtcclxuICAgICAgICB0aGlzLmNvbXAgPSBlbGVtLmNvbXA7XHJcbiAgICAgICAgdGhpcy5sYXN0RnJhbWUgPSBpbml0RnJhbWU7XHJcbiAgICAgICAgdGhpcy52ID0gbXVsdCA/IGRhdGEua1swXS5zWzBdKm11bHQgOiBkYXRhLmtbMF0uc1swXTtcclxuICAgICAgICB0aGlzLnB2ID0gZGF0YS5rWzBdLnNbMF07XHJcbiAgICAgICAgdGhpcy5nZXRWYWx1ZSA9IGdldFZhbHVlO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIEtleWZyYW1lZE11bHRpZGltZW5zaW9uYWxQcm9wZXJ0eShlbGVtLCBkYXRhLCBtdWx0KXtcclxuICAgICAgICB2YXIgaSwgbGVuID0gZGF0YS5rLmxlbmd0aDtcclxuICAgICAgICB2YXIgcywgZSx0byx0aTtcclxuICAgICAgICBmb3IoaT0wO2k8bGVuLTE7aSs9MSl7XHJcbiAgICAgICAgICAgIGlmKGRhdGEua1tpXS50byAmJiBkYXRhLmtbaV0ucyAmJiBkYXRhLmtbaV0uZSApe1xyXG4gICAgICAgICAgICAgICAgcyA9IGRhdGEua1tpXS5zO1xyXG4gICAgICAgICAgICAgICAgZSA9IGRhdGEua1tpXS5lO1xyXG4gICAgICAgICAgICAgICAgdG8gPSBkYXRhLmtbaV0udG87XHJcbiAgICAgICAgICAgICAgICB0aSA9IGRhdGEua1tpXS50aTtcclxuICAgICAgICAgICAgICAgIGlmKChzLmxlbmd0aCA9PT0gMiAmJiAhKHNbMF0gPT09IGVbMF0gJiYgc1sxXSA9PT0gZVsxXSkgJiYgYmV6LnBvaW50T25MaW5lMkQoc1swXSxzWzFdLGVbMF0sZVsxXSxzWzBdICsgdG9bMF0sc1sxXSArIHRvWzFdKSAmJiBiZXoucG9pbnRPbkxpbmUyRChzWzBdLHNbMV0sZVswXSxlWzFdLGVbMF0gKyB0aVswXSxlWzFdICsgdGlbMV0pKSB8fCAocy5sZW5ndGggPT09IDMgJiYgIShzWzBdID09PSBlWzBdICYmIHNbMV0gPT09IGVbMV0gJiYgc1syXSA9PT0gZVsyXSkgJiYgYmV6LnBvaW50T25MaW5lM0Qoc1swXSxzWzFdLHNbMl0sZVswXSxlWzFdLGVbMl0sc1swXSArIHRvWzBdLHNbMV0gKyB0b1sxXSxzWzJdICsgdG9bMl0pICYmIGJlei5wb2ludE9uTGluZTNEKHNbMF0sc1sxXSxzWzJdLGVbMF0sZVsxXSxlWzJdLGVbMF0gKyB0aVswXSxlWzFdICsgdGlbMV0sZVsyXSArIHRpWzJdKSkpe1xyXG4gICAgICAgICAgICAgICAgICAgIGRhdGEua1tpXS50byA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5rW2ldLnRpID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmtleWZyYW1lcyA9IGRhdGEuaztcclxuICAgICAgICB0aGlzLm9mZnNldFRpbWUgPSBlbGVtLmRhdGEuc3Q7XHJcbiAgICAgICAgdGhpcy5rID0gdHJ1ZTtcclxuICAgICAgICB0aGlzLmtmID0gdHJ1ZTtcclxuICAgICAgICB0aGlzLm11bHQgPSBtdWx0O1xyXG4gICAgICAgIHRoaXMuZWxlbSA9IGVsZW07XHJcbiAgICAgICAgdGhpcy5jb21wID0gZWxlbS5jb21wO1xyXG4gICAgICAgIHRoaXMuZ2V0VmFsdWUgPSBnZXRWYWx1ZTtcclxuICAgICAgICB0aGlzLmZyYW1lSWQgPSAtMTtcclxuICAgICAgICB0aGlzLl9sYXN0SW5kZXggPSAwO1xyXG4gICAgICAgIHRoaXMudiA9IEFycmF5LmFwcGx5KG51bGwsIHtsZW5ndGg6ZGF0YS5rWzBdLnMubGVuZ3RofSk7XHJcbiAgICAgICAgdGhpcy5wdiA9IEFycmF5LmFwcGx5KG51bGwsIHtsZW5ndGg6ZGF0YS5rWzBdLnMubGVuZ3RofSk7XHJcbiAgICAgICAgdGhpcy5sYXN0VmFsdWUgPSBBcnJheS5hcHBseShudWxsLCB7bGVuZ3RoOmRhdGEua1swXS5zLmxlbmd0aH0pO1xyXG4gICAgICAgIHRoaXMubGFzdFBWYWx1ZSA9IEFycmF5LmFwcGx5KG51bGwsIHtsZW5ndGg6ZGF0YS5rWzBdLnMubGVuZ3RofSk7XHJcbiAgICAgICAgdGhpcy5sYXN0RnJhbWUgPSBpbml0RnJhbWU7XHJcbiAgICB9XHJcblxyXG4gICAgdmFyIFRyYW5zZm9ybVByb3BlcnR5ID0gKGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIGZ1bmN0aW9uIHBvc2l0aW9uR2V0dGVyKCkge1xyXG4gICAgICAgICAgICBpZih0aGlzLnApIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBFeHByZXNzaW9uVmFsdWUodGhpcy5wKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBbdGhpcy5weC52LCB0aGlzLnB5LnYsIHRoaXMucHogPyB0aGlzLnB6LnYgOiAwXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBmdW5jdGlvbiB4UG9zaXRpb25HZXR0ZXIoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBFeHByZXNzaW9uVmFsdWUodGhpcy5weCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZ1bmN0aW9uIHlQb3NpdGlvbkdldHRlcigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIEV4cHJlc3Npb25WYWx1ZSh0aGlzLnB5KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZnVuY3Rpb24gelBvc2l0aW9uR2V0dGVyKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gRXhwcmVzc2lvblZhbHVlKHRoaXMucHopO1xyXG4gICAgICAgIH1cclxuICAgICAgICBmdW5jdGlvbiBhbmNob3JHZXR0ZXIoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBFeHByZXNzaW9uVmFsdWUodGhpcy5hKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZnVuY3Rpb24gb3JpZW50YXRpb25HZXR0ZXIoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBFeHByZXNzaW9uVmFsdWUodGhpcy5vcik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZ1bmN0aW9uIHJvdGF0aW9uR2V0dGVyKCkge1xyXG4gICAgICAgICAgICBpZih0aGlzLnIpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBFeHByZXNzaW9uVmFsdWUodGhpcy5yLCAxL2RlZ1RvUmFkcyk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gRXhwcmVzc2lvblZhbHVlKHRoaXMucnosIDEvZGVnVG9SYWRzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBmdW5jdGlvbiBzY2FsZUdldHRlcigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIEV4cHJlc3Npb25WYWx1ZSh0aGlzLnMsIDEwMCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZ1bmN0aW9uIG9wYWNpdHlHZXR0ZXIoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBFeHByZXNzaW9uVmFsdWUodGhpcy5vLCAxMDApO1xyXG4gICAgICAgIH1cclxuICAgICAgICBmdW5jdGlvbiBza2V3R2V0dGVyKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gRXhwcmVzc2lvblZhbHVlKHRoaXMuc2spO1xyXG4gICAgICAgIH1cclxuICAgICAgICBmdW5jdGlvbiBza2V3QXhpc0dldHRlcigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIEV4cHJlc3Npb25WYWx1ZSh0aGlzLnNhKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZnVuY3Rpb24gYXBwbHlUb01hdHJpeChtYXQpIHtcclxuICAgICAgICAgICAgdmFyIGksIGxlbiA9IHRoaXMuZHluYW1pY1Byb3BlcnRpZXMubGVuZ3RoO1xyXG4gICAgICAgICAgICBmb3IoaSA9IDA7IGkgPCBsZW47IGkgKz0gMSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5keW5hbWljUHJvcGVydGllc1tpXS5nZXRWYWx1ZSgpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuZHluYW1pY1Byb3BlcnRpZXNbaV0ubWRmKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5tZGYgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmEpIHtcclxuICAgICAgICAgICAgICAgIG1hdC50cmFuc2xhdGUoLXRoaXMuYS52WzBdLCAtdGhpcy5hLnZbMV0sIHRoaXMuYS52WzJdKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAodGhpcy5zKSB7XHJcbiAgICAgICAgICAgICAgICBtYXQuc2NhbGUodGhpcy5zLnZbMF0sIHRoaXMucy52WzFdLCB0aGlzLnMudlsyXSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHRoaXMucikge1xyXG4gICAgICAgICAgICAgICAgbWF0LnJvdGF0ZSgtdGhpcy5yLnYpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgbWF0LnJvdGF0ZVooLXRoaXMucnoudikucm90YXRlWSh0aGlzLnJ5LnYpLnJvdGF0ZVgodGhpcy5yeC52KS5yb3RhdGVaKC10aGlzLm9yLnZbMl0pLnJvdGF0ZVkodGhpcy5vci52WzFdKS5yb3RhdGVYKHRoaXMub3IudlswXSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHRoaXMuZGF0YS5wLnMpIHtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmRhdGEucC56KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbWF0LnRyYW5zbGF0ZSh0aGlzLnB4LnYsIHRoaXMucHkudiwgLXRoaXMucHoudik7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIG1hdC50cmFuc2xhdGUodGhpcy5weC52LCB0aGlzLnB5LnYsIDApO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgbWF0LnRyYW5zbGF0ZSh0aGlzLnAudlswXSwgdGhpcy5wLnZbMV0sIC10aGlzLnAudlsyXSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgZnVuY3Rpb24gcHJvY2Vzc0tleXMoKXtcclxuICAgICAgICAgICAgaWYgKHRoaXMuZWxlbS5nbG9iYWxEYXRhLmZyYW1lSWQgPT09IHRoaXMuZnJhbWVJZCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB0aGlzLm1kZiA9IGZhbHNlO1xyXG4gICAgICAgICAgICB2YXIgaSwgbGVuID0gdGhpcy5keW5hbWljUHJvcGVydGllcy5sZW5ndGg7XHJcblxyXG4gICAgICAgICAgICBmb3IoaSA9IDA7IGkgPCBsZW47IGkgKz0gMSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5keW5hbWljUHJvcGVydGllc1tpXS5nZXRWYWx1ZSgpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuZHluYW1pY1Byb3BlcnRpZXNbaV0ubWRmKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5tZGYgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICh0aGlzLm1kZikge1xyXG4gICAgICAgICAgICAgICAgdGhpcy52LnJlc2V0KCk7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5hKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy52LnRyYW5zbGF0ZSgtdGhpcy5hLnZbMF0sIC10aGlzLmEudlsxXSwgdGhpcy5hLnZbMl0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYodGhpcy5zKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy52LnNjYWxlKHRoaXMucy52WzBdLCB0aGlzLnMudlsxXSwgdGhpcy5zLnZbMl0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuc2spIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnYuc2tld0Zyb21BeGlzKC10aGlzLnNrLnYsIHRoaXMuc2Eudik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5yKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy52LnJvdGF0ZSgtdGhpcy5yLnYpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnYucm90YXRlWigtdGhpcy5yei52KS5yb3RhdGVZKHRoaXMucnkudikucm90YXRlWCh0aGlzLnJ4LnYpLnJvdGF0ZVooLXRoaXMub3IudlsyXSkucm90YXRlWSh0aGlzLm9yLnZbMV0pLnJvdGF0ZVgodGhpcy5vci52WzBdKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmF1dG9PcmllbnRlZCAmJiB0aGlzLnAua2V5ZnJhbWVzICYmIHRoaXMucC5nZXRWYWx1ZUF0VGltZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB2MSx2MjtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5wLmxhc3RGcmFtZSt0aGlzLnAub2Zmc2V0VGltZSA8PSB0aGlzLnAua2V5ZnJhbWVzWzBdLnQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdjEgPSB0aGlzLnAuZ2V0VmFsdWVBdFRpbWUoKHRoaXMucC5rZXlmcmFtZXNbMF0udCArIDAuMDEpIC8gdGhpcy5lbGVtLmdsb2JhbERhdGEuZnJhbWVSYXRlLDApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2MiA9IHRoaXMucC5nZXRWYWx1ZUF0VGltZSh0aGlzLnAua2V5ZnJhbWVzWzBdLnQgLyB0aGlzLmVsZW0uZ2xvYmFsRGF0YS5mcmFtZVJhdGUsIDApO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZih0aGlzLnAubGFzdEZyYW1lK3RoaXMucC5vZmZzZXRUaW1lID49IHRoaXMucC5rZXlmcmFtZXNbdGhpcy5wLmtleWZyYW1lcy5sZW5ndGggLSAxXS50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHYxID0gdGhpcy5wLmdldFZhbHVlQXRUaW1lKCh0aGlzLnAua2V5ZnJhbWVzW3RoaXMucC5rZXlmcmFtZXMubGVuZ3RoIC0gMV0udCAvIHRoaXMuZWxlbS5nbG9iYWxEYXRhLmZyYW1lUmF0ZSksIDApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2MiA9IHRoaXMucC5nZXRWYWx1ZUF0VGltZSgodGhpcy5wLmtleWZyYW1lc1t0aGlzLnAua2V5ZnJhbWVzLmxlbmd0aCAtIDFdLnQgLSAwLjAxKSAvIHRoaXMuZWxlbS5nbG9iYWxEYXRhLmZyYW1lUmF0ZSwgMCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdjEgPSB0aGlzLnAucHY7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHYyID0gdGhpcy5wLmdldFZhbHVlQXRUaW1lKCh0aGlzLnAubGFzdEZyYW1lK3RoaXMucC5vZmZzZXRUaW1lIC0gMC4wMSkgLyB0aGlzLmVsZW0uZ2xvYmFsRGF0YS5mcmFtZVJhdGUsIHRoaXMucC5vZmZzZXRUaW1lKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy52LnJvdGF0ZSgtTWF0aC5hdGFuMih2MVsxXSAtIHYyWzFdLCB2MVswXSAtIHYyWzBdKSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZih0aGlzLmRhdGEucC5zKXtcclxuICAgICAgICAgICAgICAgICAgICBpZih0aGlzLmRhdGEucC56KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudi50cmFuc2xhdGUodGhpcy5weC52LCB0aGlzLnB5LnYsIC10aGlzLnB6LnYpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudi50cmFuc2xhdGUodGhpcy5weC52LCB0aGlzLnB5LnYsIDApO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudi50cmFuc2xhdGUodGhpcy5wLnZbMF0sdGhpcy5wLnZbMV0sLXRoaXMucC52WzJdKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvL2NvbnNvbGUubG9nKHRoaXMudi50bzJkQ1NTKCkpXHJcbiAgICAgICAgICAgIHRoaXMuZnJhbWVJZCA9IHRoaXMuZWxlbS5nbG9iYWxEYXRhLmZyYW1lSWQ7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBzZXRJbnZlcnRlZCgpe1xyXG4gICAgICAgICAgICB0aGlzLmludmVydGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgdGhpcy5pdiA9IG5ldyBNYXRyaXgoKTtcclxuICAgICAgICAgICAgaWYoIXRoaXMuayl7XHJcbiAgICAgICAgICAgICAgICBpZih0aGlzLmRhdGEucC5zKXtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLml2LnRyYW5zbGF0ZSh0aGlzLnB4LnYsdGhpcy5weS52LC10aGlzLnB6LnYpO1xyXG4gICAgICAgICAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pdi50cmFuc2xhdGUodGhpcy5wLnZbMF0sdGhpcy5wLnZbMV0sLXRoaXMucC52WzJdKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmKHRoaXMucil7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pdi5yb3RhdGUoLXRoaXMuci52KTtcclxuICAgICAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaXYucm90YXRlWCgtdGhpcy5yeC52KS5yb3RhdGVZKC10aGlzLnJ5LnYpLnJvdGF0ZVoodGhpcy5yei52KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmKHRoaXMucyl7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pdi5zY2FsZSh0aGlzLnMudlswXSx0aGlzLnMudlsxXSwxKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmKHRoaXMuYSl7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pdi50cmFuc2xhdGUoLXRoaXMuYS52WzBdLC10aGlzLmEudlsxXSx0aGlzLmEudlsyXSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGF1dG9PcmllbnQoKXtcclxuICAgICAgICAgICAgLy9cclxuICAgICAgICAgICAgLy92YXIgcHJldlAgPSB0aGlzLmdldFZhbHVlQXRUaW1lKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gZnVuY3Rpb24gVHJhbnNmb3JtUHJvcGVydHkoZWxlbSxkYXRhLGFycil7XHJcbiAgICAgICAgICAgIHRoaXMuZWxlbSA9IGVsZW07XHJcbiAgICAgICAgICAgIHRoaXMuZnJhbWVJZCA9IC0xO1xyXG4gICAgICAgICAgICB0aGlzLnR5cGUgPSAndHJhbnNmb3JtJztcclxuICAgICAgICAgICAgdGhpcy5keW5hbWljUHJvcGVydGllcyA9IFtdO1xyXG4gICAgICAgICAgICB0aGlzLm1kZiA9IGZhbHNlO1xyXG4gICAgICAgICAgICB0aGlzLmRhdGEgPSBkYXRhO1xyXG4gICAgICAgICAgICB0aGlzLmdldFZhbHVlID0gcHJvY2Vzc0tleXM7XHJcbiAgICAgICAgICAgIHRoaXMuYXBwbHlUb01hdHJpeCA9IGFwcGx5VG9NYXRyaXg7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0SW52ZXJ0ZWQgPSBzZXRJbnZlcnRlZDtcclxuICAgICAgICAgICAgdGhpcy5hdXRvT3JpZW50ID0gYXV0b09yaWVudDtcclxuICAgICAgICAgICAgdGhpcy52ID0gbmV3IE1hdHJpeCgpO1xyXG4gICAgICAgICAgICBpZihkYXRhLnAucyl7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnB4ID0gUHJvcGVydHlGYWN0b3J5LmdldFByb3AoZWxlbSxkYXRhLnAueCwwLDAsdGhpcy5keW5hbWljUHJvcGVydGllcyk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnB5ID0gUHJvcGVydHlGYWN0b3J5LmdldFByb3AoZWxlbSxkYXRhLnAueSwwLDAsdGhpcy5keW5hbWljUHJvcGVydGllcyk7XHJcbiAgICAgICAgICAgICAgICBpZihkYXRhLnAueil7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5weiA9IFByb3BlcnR5RmFjdG9yeS5nZXRQcm9wKGVsZW0sZGF0YS5wLnosMCwwLHRoaXMuZHluYW1pY1Byb3BlcnRpZXMpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgIHRoaXMucCA9IFByb3BlcnR5RmFjdG9yeS5nZXRQcm9wKGVsZW0sZGF0YS5wLDEsMCx0aGlzLmR5bmFtaWNQcm9wZXJ0aWVzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZihkYXRhLnIpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuciA9IFByb3BlcnR5RmFjdG9yeS5nZXRQcm9wKGVsZW0sIGRhdGEuciwgMCwgZGVnVG9SYWRzLCB0aGlzLmR5bmFtaWNQcm9wZXJ0aWVzKTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmKGRhdGEucngpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMucnggPSBQcm9wZXJ0eUZhY3RvcnkuZ2V0UHJvcChlbGVtLCBkYXRhLnJ4LCAwLCBkZWdUb1JhZHMsIHRoaXMuZHluYW1pY1Byb3BlcnRpZXMpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5yeSA9IFByb3BlcnR5RmFjdG9yeS5nZXRQcm9wKGVsZW0sIGRhdGEucnksIDAsIGRlZ1RvUmFkcywgdGhpcy5keW5hbWljUHJvcGVydGllcyk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJ6ID0gUHJvcGVydHlGYWN0b3J5LmdldFByb3AoZWxlbSwgZGF0YS5yeiwgMCwgZGVnVG9SYWRzLCB0aGlzLmR5bmFtaWNQcm9wZXJ0aWVzKTtcclxuICAgICAgICAgICAgICAgIHRoaXMub3IgPSBQcm9wZXJ0eUZhY3RvcnkuZ2V0UHJvcChlbGVtLCBkYXRhLm9yLCAxLCBkZWdUb1JhZHMsIHRoaXMuZHluYW1pY1Byb3BlcnRpZXMpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmKGRhdGEuc2spe1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zayA9IFByb3BlcnR5RmFjdG9yeS5nZXRQcm9wKGVsZW0sIGRhdGEuc2ssIDAsIGRlZ1RvUmFkcywgdGhpcy5keW5hbWljUHJvcGVydGllcyk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNhID0gUHJvcGVydHlGYWN0b3J5LmdldFByb3AoZWxlbSwgZGF0YS5zYSwgMCwgZGVnVG9SYWRzLCB0aGlzLmR5bmFtaWNQcm9wZXJ0aWVzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZihkYXRhLmEpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuYSA9IFByb3BlcnR5RmFjdG9yeS5nZXRQcm9wKGVsZW0sZGF0YS5hLDEsMCx0aGlzLmR5bmFtaWNQcm9wZXJ0aWVzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZihkYXRhLnMpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMucyA9IFByb3BlcnR5RmFjdG9yeS5nZXRQcm9wKGVsZW0sZGF0YS5zLDEsMC4wMSx0aGlzLmR5bmFtaWNQcm9wZXJ0aWVzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZihkYXRhLm8pe1xyXG4gICAgICAgICAgICAgICAgdGhpcy5vID0gUHJvcGVydHlGYWN0b3J5LmdldFByb3AoZWxlbSxkYXRhLm8sMCwwLjAxLGFycik7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLm8gPSB7bWRmOmZhbHNlLHY6MX07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYodGhpcy5keW5hbWljUHJvcGVydGllcy5sZW5ndGgpe1xyXG4gICAgICAgICAgICAgICAgYXJyLnB1c2godGhpcyk7XHJcbiAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgaWYodGhpcy5hKXtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnYudHJhbnNsYXRlKC10aGlzLmEudlswXSwtdGhpcy5hLnZbMV0sdGhpcy5hLnZbMl0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYodGhpcy5zKXtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnYuc2NhbGUodGhpcy5zLnZbMF0sdGhpcy5zLnZbMV0sdGhpcy5zLnZbMl0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYodGhpcy5zayl7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy52LnNrZXdGcm9tQXhpcygtdGhpcy5zay52LHRoaXMuc2Eudik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZih0aGlzLnIpe1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudi5yb3RhdGUoLXRoaXMuci52KTtcclxuICAgICAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudi5yb3RhdGVaKC10aGlzLnJ6LnYpLnJvdGF0ZVkodGhpcy5yeS52KS5yb3RhdGVYKHRoaXMucngudikucm90YXRlWigtdGhpcy5vci52WzJdKS5yb3RhdGVZKHRoaXMub3IudlsxXSkucm90YXRlWCh0aGlzLm9yLnZbMF0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYodGhpcy5kYXRhLnAucyl7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYoZGF0YS5wLnopIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy52LnRyYW5zbGF0ZSh0aGlzLnB4LnYsIHRoaXMucHkudiwgLXRoaXMucHoudik7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy52LnRyYW5zbGF0ZSh0aGlzLnB4LnYsIHRoaXMucHkudiwgMCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy52LnRyYW5zbGF0ZSh0aGlzLnAudlswXSx0aGlzLnAudlsxXSwtdGhpcy5wLnZbMl0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcInBvc2l0aW9uXCIsIHsgZ2V0OiBwb3NpdGlvbkdldHRlcn0pO1xyXG4gICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgXCJ4UG9zaXRpb25cIiwgeyBnZXQ6IHhQb3NpdGlvbkdldHRlcn0pO1xyXG4gICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgXCJ5UG9zaXRpb25cIiwgeyBnZXQ6IHlQb3NpdGlvbkdldHRlcn0pO1xyXG4gICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgXCJvcmllbnRhdGlvblwiLCB7IGdldDogb3JpZW50YXRpb25HZXR0ZXJ9KTtcclxuICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIFwiYW5jaG9yUG9pbnRcIiwgeyBnZXQ6IGFuY2hvckdldHRlcn0pO1xyXG4gICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgXCJyb3RhdGlvblwiLCB7IGdldDogcm90YXRpb25HZXR0ZXJ9KTtcclxuICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIFwic2NhbGVcIiwgeyBnZXQ6IHNjYWxlR2V0dGVyfSk7XHJcbiAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcIm9wYWNpdHlcIiwgeyBnZXQ6IG9wYWNpdHlHZXR0ZXJ9KTtcclxuICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIFwic2tld1wiLCB7IGdldDogc2tld0dldHRlcn0pO1xyXG4gICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgXCJza2V3QXhpc1wiLCB7IGdldDogc2tld0F4aXNHZXR0ZXJ9KTtcclxuICAgICAgICB9XHJcbiAgICB9KCkpO1xyXG5cclxuICAgIGZ1bmN0aW9uIGdldFByb3AoZWxlbSxkYXRhLHR5cGUsIG11bHQsIGFycikge1xyXG4gICAgICAgIHZhciBwO1xyXG4gICAgICAgIGlmKHR5cGUgPT09IDIpe1xyXG4gICAgICAgICAgICBwID0gbmV3IFRyYW5zZm9ybVByb3BlcnR5KGVsZW0sIGRhdGEsIGFycik7XHJcbiAgICAgICAgfSBlbHNlIGlmKGRhdGEuYSA9PT0gMCl7XHJcbiAgICAgICAgICAgIGlmKHR5cGUgPT09IDApIHtcclxuICAgICAgICAgICAgICAgIHAgPSBuZXcgVmFsdWVQcm9wZXJ0eShlbGVtLGRhdGEsbXVsdCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBwID0gbmV3IE11bHRpRGltZW5zaW9uYWxQcm9wZXJ0eShlbGVtLGRhdGEsIG11bHQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIGlmKGRhdGEuYSA9PT0gMSl7XHJcbiAgICAgICAgICAgIGlmKHR5cGUgPT09IDApIHtcclxuICAgICAgICAgICAgICAgIHAgPSBuZXcgS2V5ZnJhbWVkVmFsdWVQcm9wZXJ0eShlbGVtLGRhdGEsbXVsdCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBwID0gbmV3IEtleWZyYW1lZE11bHRpZGltZW5zaW9uYWxQcm9wZXJ0eShlbGVtLGRhdGEsIG11bHQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIGlmKCFkYXRhLmsubGVuZ3RoKXtcclxuICAgICAgICAgICAgcCA9IG5ldyBWYWx1ZVByb3BlcnR5KGVsZW0sZGF0YSwgbXVsdCk7XHJcbiAgICAgICAgfWVsc2UgaWYodHlwZW9mKGRhdGEua1swXSkgPT09ICdudW1iZXInKXtcclxuICAgICAgICAgICAgcCA9IG5ldyBNdWx0aURpbWVuc2lvbmFsUHJvcGVydHkoZWxlbSxkYXRhLCBtdWx0KTtcclxuICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgc3dpdGNoKHR5cGUpe1xyXG4gICAgICAgICAgICAgICAgY2FzZSAwOlxyXG4gICAgICAgICAgICAgICAgICAgIHAgPSBuZXcgS2V5ZnJhbWVkVmFsdWVQcm9wZXJ0eShlbGVtLGRhdGEsbXVsdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlIDE6XHJcbiAgICAgICAgICAgICAgICAgICAgcCA9IG5ldyBLZXlmcmFtZWRNdWx0aWRpbWVuc2lvbmFsUHJvcGVydHkoZWxlbSxkYXRhLG11bHQpO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmKHAuayl7XHJcbiAgICAgICAgICAgIGFyci5wdXNoKHApO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcDtcclxuICAgIH1cclxuXHJcbiAgICB2YXIgZ2V0R3JhZGllbnRQcm9wID0gKGZ1bmN0aW9uKCl7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldFZhbHVlKGZvcmNlUmVuZGVyKXtcclxuICAgICAgICAgICAgdGhpcy5wcm9wLmdldFZhbHVlKCk7XHJcbiAgICAgICAgICAgIHRoaXMuY21kZiA9IGZhbHNlO1xyXG4gICAgICAgICAgICB0aGlzLm9tZGYgPSBmYWxzZTtcclxuICAgICAgICAgICAgaWYodGhpcy5wcm9wLm1kZiB8fCBmb3JjZVJlbmRlcil7XHJcbiAgICAgICAgICAgICAgICB2YXIgaSwgbGVuID0gdGhpcy5kYXRhLnAqNDtcclxuICAgICAgICAgICAgICAgIHZhciBtdWx0LCB2YWw7XHJcbiAgICAgICAgICAgICAgICBmb3IoaT0wO2k8bGVuO2krPTEpe1xyXG4gICAgICAgICAgICAgICAgICAgIG11bHQgPSBpJTQgPT09IDAgPyAxMDAgOiAyNTU7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFsID0gTWF0aC5yb3VuZCh0aGlzLnByb3AudltpXSptdWx0KTtcclxuICAgICAgICAgICAgICAgICAgICBpZih0aGlzLmNbaV0gIT09IHZhbCl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY1tpXSA9IHZhbDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jbWRmID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZih0aGlzLm8ubGVuZ3RoKXtcclxuICAgICAgICAgICAgICAgICAgICBsZW4gPSB0aGlzLnByb3Audi5sZW5ndGg7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yKGk9dGhpcy5kYXRhLnAqNDtpPGxlbjtpKz0xKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbXVsdCA9IGklMiA9PT0gMCA/IDEwMCA6IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbCA9IGklMiA9PT0gMCA/ICBNYXRoLnJvdW5kKHRoaXMucHJvcC52W2ldKjEwMCk6dGhpcy5wcm9wLnZbaV07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKHRoaXMub1tpLXRoaXMuZGF0YS5wKjRdICE9PSB2YWwpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5vW2ktdGhpcy5kYXRhLnAqNF0gPSB2YWw7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm9tZGYgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ3JhZGllbnRQcm9wKGVsZW0sZGF0YSxhcnIpe1xyXG4gICAgICAgICAgICB0aGlzLnByb3AgPSBnZXRQcm9wKGVsZW0sZGF0YS5rLDEsbnVsbCxbXSk7XHJcbiAgICAgICAgICAgIHRoaXMuZGF0YSA9IGRhdGE7XHJcbiAgICAgICAgICAgIHRoaXMuayA9IHRoaXMucHJvcC5rO1xyXG4gICAgICAgICAgICB0aGlzLmMgPSBBcnJheS5hcHBseShudWxsLHtsZW5ndGg6ZGF0YS5wKjR9KTtcclxuICAgICAgICAgICAgdmFyIGNMZW5ndGggPSBkYXRhLmsua1swXS5zID8gKGRhdGEuay5rWzBdLnMubGVuZ3RoIC0gZGF0YS5wKjQpIDogZGF0YS5rLmsubGVuZ3RoIC0gZGF0YS5wKjQ7XHJcbiAgICAgICAgICAgIHRoaXMubyA9IEFycmF5LmFwcGx5KG51bGwse2xlbmd0aDpjTGVuZ3RofSk7XHJcbiAgICAgICAgICAgIHRoaXMuY21kZiA9IGZhbHNlO1xyXG4gICAgICAgICAgICB0aGlzLm9tZGYgPSBmYWxzZTtcclxuICAgICAgICAgICAgdGhpcy5nZXRWYWx1ZSA9IGdldFZhbHVlO1xyXG4gICAgICAgICAgICBpZih0aGlzLnByb3Auayl7XHJcbiAgICAgICAgICAgICAgICBhcnIucHVzaCh0aGlzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLmdldFZhbHVlKHRydWUpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIGdldEdyYWRpZW50UHJvcChlbGVtLGRhdGEsYXJyKXtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBncmFkaWVudFByb3AoZWxlbSxkYXRhLGFycik7XHJcbiAgICAgICAgfVxyXG4gICAgfSgpKTtcclxuXHJcblxyXG5cclxuXHJcbiAgICB2YXIgRGFzaFByb3BlcnR5ID0gKGZ1bmN0aW9uKCl7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHByb2Nlc3NLZXlzKGZvcmNlUmVuZGVyKXtcclxuICAgICAgICAgICAgdmFyIGkgPSAwLCBsZW4gPSB0aGlzLmRhdGFQcm9wcy5sZW5ndGg7XHJcblxyXG4gICAgICAgICAgICBpZih0aGlzLmVsZW0uZ2xvYmFsRGF0YS5mcmFtZUlkID09PSB0aGlzLmZyYW1lSWQgJiYgIWZvcmNlUmVuZGVyKXtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLm1kZiA9IGZhbHNlO1xyXG4gICAgICAgICAgICB0aGlzLmZyYW1lSWQgPSB0aGlzLmVsZW0uZ2xvYmFsRGF0YS5mcmFtZUlkO1xyXG4gICAgICAgICAgICB3aGlsZShpPGxlbil7XHJcbiAgICAgICAgICAgICAgICBpZih0aGlzLmRhdGFQcm9wc1tpXS5wLm1kZil7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5tZGYgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaSs9MTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZih0aGlzLm1kZiB8fCBmb3JjZVJlbmRlcil7XHJcbiAgICAgICAgICAgICAgICBpZih0aGlzLnJlbmRlcmVyID09PSAnc3ZnJykge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGFzaGFycmF5ID0gJyc7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBmb3IoaT0wO2k8bGVuO2krPTEpe1xyXG4gICAgICAgICAgICAgICAgICAgIGlmKHRoaXMuZGF0YVByb3BzW2ldLm4gIT0gJ28nKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYodGhpcy5yZW5kZXJlciA9PT0gJ3N2ZycpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGFzaGFycmF5ICs9ICcgJyArIHRoaXMuZGF0YVByb3BzW2ldLnAudjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRhc2hhcnJheVtpXSA9IHRoaXMuZGF0YVByb3BzW2ldLnAudjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRhc2hvZmZzZXQgPSB0aGlzLmRhdGFQcm9wc1tpXS5wLnY7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gZnVuY3Rpb24oZWxlbSwgZGF0YSxyZW5kZXJlciwgZHluYW1pY1Byb3BlcnRpZXMpe1xyXG4gICAgICAgICAgICB0aGlzLmVsZW0gPSBlbGVtO1xyXG4gICAgICAgICAgICB0aGlzLmZyYW1lSWQgPSAtMTtcclxuICAgICAgICAgICAgdGhpcy5kYXRhUHJvcHMgPSBuZXcgQXJyYXkoZGF0YS5sZW5ndGgpO1xyXG4gICAgICAgICAgICB0aGlzLnJlbmRlcmVyID0gcmVuZGVyZXI7XHJcbiAgICAgICAgICAgIHRoaXMubWRmID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHRoaXMuayA9IGZhbHNlO1xyXG4gICAgICAgICAgICBpZih0aGlzLnJlbmRlcmVyID09PSAnc3ZnJyl7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRhc2hhcnJheSA9ICcnO1xyXG4gICAgICAgICAgICB9ZWxzZXtcclxuXHJcbiAgICAgICAgICAgICAgICB0aGlzLmRhc2hhcnJheSA9IG5ldyBBcnJheShkYXRhLmxlbmd0aCAtIDEpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuZGFzaG9mZnNldCA9IDA7XHJcbiAgICAgICAgICAgIHZhciBpLCBsZW4gPSBkYXRhLmxlbmd0aCwgcHJvcDtcclxuICAgICAgICAgICAgZm9yKGk9MDtpPGxlbjtpKz0xKXtcclxuICAgICAgICAgICAgICAgIHByb3AgPSBQcm9wZXJ0eUZhY3RvcnkuZ2V0UHJvcChlbGVtLGRhdGFbaV0udiwwLCAwLCBkeW5hbWljUHJvcGVydGllcyk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmsgPSBwcm9wLmsgPyB0cnVlIDogdGhpcy5rO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kYXRhUHJvcHNbaV0gPSB7bjpkYXRhW2ldLm4scDpwcm9wfTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLmdldFZhbHVlID0gcHJvY2Vzc0tleXM7XHJcbiAgICAgICAgICAgIGlmKHRoaXMuayl7XHJcbiAgICAgICAgICAgICAgICBkeW5hbWljUHJvcGVydGllcy5wdXNoKHRoaXMpO1xyXG4gICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgIHRoaXMuZ2V0VmFsdWUodHJ1ZSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgfVxyXG4gICAgfSgpKTtcclxuXHJcbiAgICBmdW5jdGlvbiBnZXREYXNoUHJvcChlbGVtLCBkYXRhLHJlbmRlcmVyLCBkeW5hbWljUHJvcGVydGllcykge1xyXG4gICAgICAgIHJldHVybiBuZXcgRGFzaFByb3BlcnR5KGVsZW0sIGRhdGEscmVuZGVyZXIsIGR5bmFtaWNQcm9wZXJ0aWVzKTtcclxuICAgIH07XHJcblxyXG4gICAgdmFyIFRleHRTZWxlY3RvclByb3AgPSAoZnVuY3Rpb24oKXtcclxuICAgICAgICB2YXIgbWF4ID0gTWF0aC5tYXg7XHJcbiAgICAgICAgdmFyIG1pbiA9IE1hdGgubWluO1xyXG4gICAgICAgIHZhciBmbG9vciA9IE1hdGguZmxvb3I7XHJcbiAgICAgICAgZnVuY3Rpb24gdXBkYXRlUmFuZ2UoKXtcclxuICAgICAgICAgICAgaWYodGhpcy5keW5hbWljUHJvcGVydGllcy5sZW5ndGgpe1xyXG4gICAgICAgICAgICAgICAgdmFyIGksIGxlbiA9IHRoaXMuZHluYW1pY1Byb3BlcnRpZXMubGVuZ3RoO1xyXG4gICAgICAgICAgICAgICAgZm9yKGk9MDtpPGxlbjtpKz0xKXtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmR5bmFtaWNQcm9wZXJ0aWVzW2ldLmdldFZhbHVlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYodGhpcy5keW5hbWljUHJvcGVydGllc1tpXS5tZGYpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1kZiA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZhciB0b3RhbENoYXJzID0gdGhpcy5kYXRhLnRvdGFsQ2hhcnM7XHJcbiAgICAgICAgICAgIHZhciBkaXZpc29yID0gdGhpcy5kYXRhLnIgPT09IDIgPyAxIDogMTAwL3RvdGFsQ2hhcnM7XHJcbiAgICAgICAgICAgIHZhciBvID0gdGhpcy5vLnYvZGl2aXNvcjtcclxuICAgICAgICAgICAgdmFyIHMgPSB0aGlzLnMudi9kaXZpc29yICsgbztcclxuICAgICAgICAgICAgdmFyIGUgPSAodGhpcy5lLnYvZGl2aXNvcikgKyBvO1xyXG4gICAgICAgICAgICBpZihzPmUpe1xyXG4gICAgICAgICAgICAgICAgdmFyIF9zID0gcztcclxuICAgICAgICAgICAgICAgIHMgPSBlO1xyXG4gICAgICAgICAgICAgICAgZSA9IF9zO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuZmluYWxTID0gcztcclxuICAgICAgICAgICAgdGhpcy5maW5hbEUgPSBlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0TXVsdChpbmQpe1xyXG4gICAgICAgICAgICAvL3ZhciBlYXNlciA9IGJlei5nZXRFYXNpbmdDdXJ2ZSh0aGlzLm5lLnYvMTAwLDAsMS10aGlzLnhlLnYvMTAwLDEpO1xyXG4gICAgICAgICAgICB2YXIgZWFzZXIgPSBCZXppZXJGYWN0b3J5LmdldEJlemllckVhc2luZyh0aGlzLm5lLnYvMTAwLDAsMS10aGlzLnhlLnYvMTAwLDEpLmdldDtcclxuICAgICAgICAgICAgdmFyIG11bHQgPSAwO1xyXG4gICAgICAgICAgICB2YXIgcyA9IHRoaXMuZmluYWxTO1xyXG4gICAgICAgICAgICB2YXIgZSA9IHRoaXMuZmluYWxFO1xyXG4gICAgICAgICAgICB2YXIgdHlwZSA9IHRoaXMuZGF0YS5zaDtcclxuICAgICAgICAgICAgaWYodHlwZSA9PSAyKXtcclxuICAgICAgICAgICAgICAgIGlmKGUgPT09IHMpe1xyXG4gICAgICAgICAgICAgICAgICAgIG11bHQgPSBpbmQgPj0gZSA/IDEgOiAwO1xyXG4gICAgICAgICAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgICAgICAgICAgbXVsdCA9IG1heCgwLG1pbigwLjUvKGUtcykgKyAoaW5kLXMpLyhlLXMpLDEpKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIG11bHQgPSBlYXNlcihtdWx0KTtcclxuICAgICAgICAgICAgfWVsc2UgaWYodHlwZSA9PSAzKXtcclxuICAgICAgICAgICAgICAgIGlmKGUgPT09IHMpe1xyXG4gICAgICAgICAgICAgICAgICAgIG11bHQgPSBpbmQgPj0gZSA/IDAgOiAxO1xyXG4gICAgICAgICAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgICAgICAgICAgbXVsdCA9IDEgLSBtYXgoMCxtaW4oMC41LyhlLXMpICsgKGluZC1zKS8oZS1zKSwxKSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgbXVsdCA9IGVhc2VyKG11bHQpO1xyXG4gICAgICAgICAgICB9ZWxzZSBpZih0eXBlID09IDQpe1xyXG4gICAgICAgICAgICAgICAgaWYoZSA9PT0gcyl7XHJcbiAgICAgICAgICAgICAgICAgICAgbXVsdCA9IDA7XHJcbiAgICAgICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgICAgICBtdWx0ID0gbWF4KDAsbWluKDAuNS8oZS1zKSArIChpbmQtcykvKGUtcyksMSkpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmKG11bHQ8LjUpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBtdWx0ICo9IDI7XHJcbiAgICAgICAgICAgICAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG11bHQgPSAxIC0gMioobXVsdC0wLjUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIG11bHQgPSBlYXNlcihtdWx0KTtcclxuICAgICAgICAgICAgfWVsc2UgaWYodHlwZSA9PSA1KXtcclxuICAgICAgICAgICAgICAgIGlmKGUgPT09IHMpe1xyXG4gICAgICAgICAgICAgICAgICAgIG11bHQgPSAwO1xyXG4gICAgICAgICAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRvdCA9IGUgLSBzO1xyXG4gICAgICAgICAgICAgICAgICAgIC8qaW5kICs9IDAuNTtcclxuICAgICAgICAgICAgICAgICAgICBtdWx0ID0gLTQvKHRvdCp0b3QpKihpbmQqaW5kKSsoNC90b3QpKmluZDsqL1xyXG4gICAgICAgICAgICAgICAgICAgIGluZCA9IG1pbihtYXgoMCxpbmQrMC41LXMpLGUtcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHggPSAtdG90LzIraW5kO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBhID0gdG90LzI7XHJcbiAgICAgICAgICAgICAgICAgICAgbXVsdCA9IE1hdGguc3FydCgxIC0gKHgqeCkvKGEqYSkpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgbXVsdCA9IGVhc2VyKG11bHQpO1xyXG4gICAgICAgICAgICB9ZWxzZSBpZih0eXBlID09IDYpe1xyXG4gICAgICAgICAgICAgICAgaWYoZSA9PT0gcyl7XHJcbiAgICAgICAgICAgICAgICAgICAgbXVsdCA9IDA7XHJcbiAgICAgICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgICAgICBpbmQgPSBtaW4obWF4KDAsaW5kKzAuNS1zKSxlLXMpO1xyXG4gICAgICAgICAgICAgICAgICAgIG11bHQgPSAoMSsoTWF0aC5jb3MoKE1hdGguUEkrTWF0aC5QSSoyKihpbmQpLyhlLXMpKSkpKS8yO1xyXG4gICAgICAgICAgICAgICAgICAgIC8qXHJcbiAgICAgICAgICAgICAgICAgICAgIGluZCA9IE1hdGgubWluKE1hdGgubWF4KHMsaW5kKSxlLTEpO1xyXG4gICAgICAgICAgICAgICAgICAgICBtdWx0ID0gKDErKE1hdGguY29zKChNYXRoLlBJK01hdGguUEkqMiooaW5kLXMpLyhlLTEtcykpKSkpLzI7XHJcbiAgICAgICAgICAgICAgICAgICAgIG11bHQgPSBNYXRoLm1heChtdWx0LCgxLyhlLTEtcykpLyhlLTEtcykpOyovXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBtdWx0ID0gZWFzZXIobXVsdCk7XHJcbiAgICAgICAgICAgIH1lbHNlIHtcclxuICAgICAgICAgICAgICAgIGlmKGluZCA+PSBmbG9vcihzKSl7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYoaW5kLXMgPCAwKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbXVsdCA9IDEgLSAocyAtIGluZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG11bHQgPSBtYXgoMCxtaW4oZS1pbmQsMSkpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIG11bHQgPSBlYXNlcihtdWx0KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gbXVsdCp0aGlzLmEudjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBmdW5jdGlvbiBUZXh0U2VsZWN0b3JQcm9wKGVsZW0sZGF0YSwgYXJyKXtcclxuICAgICAgICAgICAgdGhpcy5tZGYgPSBmYWxzZTtcclxuICAgICAgICAgICAgdGhpcy5rID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHRoaXMuZGF0YSA9IGRhdGE7XHJcbiAgICAgICAgICAgIHRoaXMuZHluYW1pY1Byb3BlcnRpZXMgPSBbXTtcclxuICAgICAgICAgICAgdGhpcy5nZXRWYWx1ZSA9IHVwZGF0ZVJhbmdlO1xyXG4gICAgICAgICAgICB0aGlzLmdldE11bHQgPSBnZXRNdWx0O1xyXG4gICAgICAgICAgICB0aGlzLmNvbXAgPSBlbGVtLmNvbXA7XHJcbiAgICAgICAgICAgIHRoaXMuZmluYWxTID0gMDtcclxuICAgICAgICAgICAgdGhpcy5maW5hbEUgPSAwO1xyXG4gICAgICAgICAgICB0aGlzLnMgPSBQcm9wZXJ0eUZhY3RvcnkuZ2V0UHJvcChlbGVtLGRhdGEucyB8fCB7azowfSwwLDAsdGhpcy5keW5hbWljUHJvcGVydGllcyk7XHJcbiAgICAgICAgICAgIGlmKCdlJyBpbiBkYXRhKXtcclxuICAgICAgICAgICAgICAgIHRoaXMuZSA9IFByb3BlcnR5RmFjdG9yeS5nZXRQcm9wKGVsZW0sZGF0YS5lLDAsMCx0aGlzLmR5bmFtaWNQcm9wZXJ0aWVzKTtcclxuICAgICAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmUgPSB7djpkYXRhLnIgPT09IDIgPyBkYXRhLnRvdGFsQ2hhcnMgOiAxMDB9O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMubyA9IFByb3BlcnR5RmFjdG9yeS5nZXRQcm9wKGVsZW0sZGF0YS5vIHx8IHtrOjB9LDAsMCx0aGlzLmR5bmFtaWNQcm9wZXJ0aWVzKTtcclxuICAgICAgICAgICAgdGhpcy54ZSA9IFByb3BlcnR5RmFjdG9yeS5nZXRQcm9wKGVsZW0sZGF0YS54ZSB8fCB7azowfSwwLDAsdGhpcy5keW5hbWljUHJvcGVydGllcyk7XHJcbiAgICAgICAgICAgIHRoaXMubmUgPSBQcm9wZXJ0eUZhY3RvcnkuZ2V0UHJvcChlbGVtLGRhdGEubmUgfHwge2s6MH0sMCwwLHRoaXMuZHluYW1pY1Byb3BlcnRpZXMpO1xyXG4gICAgICAgICAgICB0aGlzLmEgPSBQcm9wZXJ0eUZhY3RvcnkuZ2V0UHJvcChlbGVtLGRhdGEuYSwwLDAuMDEsdGhpcy5keW5hbWljUHJvcGVydGllcyk7XHJcbiAgICAgICAgICAgIGlmKHRoaXMuZHluYW1pY1Byb3BlcnRpZXMubGVuZ3RoKXtcclxuICAgICAgICAgICAgICAgIGFyci5wdXNoKHRoaXMpO1xyXG4gICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgIHRoaXMuZ2V0VmFsdWUoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH0oKSk7XHJcblxyXG4gICAgZnVuY3Rpb24gZ2V0VGV4dFNlbGVjdG9yUHJvcChlbGVtLCBkYXRhLGFycikge1xyXG4gICAgICAgIHJldHVybiBuZXcgVGV4dFNlbGVjdG9yUHJvcChlbGVtLCBkYXRhLCBhcnIpO1xyXG4gICAgfTtcclxuXHJcbiAgICB2YXIgb2IgPSB7fTtcclxuICAgIG9iLmdldFByb3AgPSBnZXRQcm9wO1xyXG4gICAgb2IuZ2V0RGFzaFByb3AgPSBnZXREYXNoUHJvcDtcclxuICAgIG9iLmdldFRleHRTZWxlY3RvclByb3AgPSBnZXRUZXh0U2VsZWN0b3JQcm9wO1xyXG4gICAgb2IuZ2V0R3JhZGllbnRQcm9wID0gZ2V0R3JhZGllbnRQcm9wO1xyXG4gICAgcmV0dXJuIG9iO1xyXG59KCkpO1xuZnVuY3Rpb24gU2hhcGVQYXRoKCl7XHJcblx0dGhpcy5jID0gZmFsc2U7XHJcblx0dGhpcy5fbGVuZ3RoID0gMDtcclxuXHR0aGlzLl9tYXhMZW5ndGggPSA4O1xyXG5cdHRoaXMudiA9IEFycmF5LmFwcGx5KG51bGwse2xlbmd0aDp0aGlzLl9tYXhMZW5ndGh9KTtcclxuXHR0aGlzLm8gPSBBcnJheS5hcHBseShudWxsLHtsZW5ndGg6dGhpcy5fbWF4TGVuZ3RofSk7XHJcblx0dGhpcy5pID0gQXJyYXkuYXBwbHkobnVsbCx7bGVuZ3RoOnRoaXMuX21heExlbmd0aH0pO1xyXG59O1xyXG5cclxuU2hhcGVQYXRoLnByb3RvdHlwZS5zZXRQYXRoRGF0YSA9IGZ1bmN0aW9uKGNsb3NlZCwgbGVuKSB7XHJcblx0dGhpcy5jID0gY2xvc2VkO1xyXG5cdHdoaWxlKGxlbiA+IHRoaXMuX21heExlbmd0aCl7XHJcblx0XHR0aGlzLmRvdWJsZUFycmF5TGVuZ3RoKCk7XHJcblx0fVxyXG5cdHZhciBpID0gMDtcclxuXHR3aGlsZShpIDwgbGVuKXtcclxuXHRcdHRoaXMudltpXSA9IHBvaW50X3Bvb2wubmV3UG9pbnQoKTtcclxuXHRcdHRoaXMub1tpXSA9IHBvaW50X3Bvb2wubmV3UG9pbnQoKTtcclxuXHRcdHRoaXMuaVtpXSA9IHBvaW50X3Bvb2wubmV3UG9pbnQoKTtcclxuXHRcdGkgKz0gMTtcclxuXHR9XHJcblx0dGhpcy5fbGVuZ3RoID0gbGVuO1xyXG59O1xyXG5cclxuU2hhcGVQYXRoLnByb3RvdHlwZS5kb3VibGVBcnJheUxlbmd0aCA9IGZ1bmN0aW9uKCkge1xyXG5cdHRoaXMudiA9IHRoaXMudi5jb25jYXQoQXJyYXkuYXBwbHkobnVsbCx7bGVuZ3RoOnRoaXMuX21heExlbmd0aH0pKVxyXG5cdHRoaXMuaSA9IHRoaXMuaS5jb25jYXQoQXJyYXkuYXBwbHkobnVsbCx7bGVuZ3RoOnRoaXMuX21heExlbmd0aH0pKVxyXG5cdHRoaXMubyA9IHRoaXMuby5jb25jYXQoQXJyYXkuYXBwbHkobnVsbCx7bGVuZ3RoOnRoaXMuX21heExlbmd0aH0pKVxyXG5cdHRoaXMuX21heExlbmd0aCAqPSAyO1xyXG59O1xyXG5cclxuU2hhcGVQYXRoLnByb3RvdHlwZS5zZXRYWUF0ID0gZnVuY3Rpb24oeCwgeSwgdHlwZSwgcG9zLCByZXBsYWNlKSB7XHJcblx0dmFyIGFycjtcclxuXHR0aGlzLl9sZW5ndGggPSBNYXRoLm1heCh0aGlzLl9sZW5ndGgsIHBvcyArIDEpO1xyXG5cdGlmKHRoaXMuX2xlbmd0aCA+PSB0aGlzLl9tYXhMZW5ndGgpIHtcclxuXHRcdHRoaXMuZG91YmxlQXJyYXlMZW5ndGgoKTtcclxuXHR9XHJcblx0c3dpdGNoKHR5cGUpe1xyXG5cdFx0Y2FzZSAndic6XHJcblx0XHRcdGFyciA9IHRoaXMudjtcclxuXHRcdFx0YnJlYWs7XHJcblx0XHRjYXNlICdpJzpcclxuXHRcdFx0YXJyID0gdGhpcy5pO1xyXG5cdFx0XHRicmVhaztcclxuXHRcdGNhc2UgJ28nOlxyXG5cdFx0XHRhcnIgPSB0aGlzLm87XHJcblx0XHRcdGJyZWFrO1xyXG5cdH1cclxuXHRpZighYXJyW3Bvc10gfHwgKGFycltwb3NdICYmICFyZXBsYWNlKSl7XHJcblx0XHRhcnJbcG9zXSA9IHBvaW50X3Bvb2wubmV3UG9pbnQoKTtcclxuXHR9XHJcblx0YXJyW3Bvc11bMF0gPSB4O1xyXG5cdGFycltwb3NdWzFdID0geTtcclxufTtcclxuXHJcblNoYXBlUGF0aC5wcm90b3R5cGUuc2V0VHJpcGxlQXQgPSBmdW5jdGlvbih2WCx2WSxvWCxvWSxpWCxpWSxwb3MsIHJlcGxhY2UpIHtcclxuXHR0aGlzLnNldFhZQXQodlgsdlksJ3YnLHBvcywgcmVwbGFjZSk7XHJcblx0dGhpcy5zZXRYWUF0KG9YLG9ZLCdvJyxwb3MsIHJlcGxhY2UpO1xyXG5cdHRoaXMuc2V0WFlBdChpWCxpWSwnaScscG9zLCByZXBsYWNlKTtcclxufTtcbnZhciBTaGFwZVByb3BlcnR5RmFjdG9yeSA9IChmdW5jdGlvbigpe1xyXG5cclxuICAgIHZhciBpbml0RnJhbWUgPSAtOTk5OTk5O1xyXG5cclxuICAgIGZ1bmN0aW9uIGludGVycG9sYXRlU2hhcGUoKSB7XHJcbiAgICAgICAgaWYodGhpcy5lbGVtLmdsb2JhbERhdGEuZnJhbWVJZCA9PT0gdGhpcy5mcmFtZUlkKXtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLm1kZiA9IGZhbHNlO1xyXG4gICAgICAgIHZhciBmcmFtZU51bSA9IHRoaXMuY29tcC5yZW5kZXJlZEZyYW1lIC0gdGhpcy5vZmZzZXRUaW1lO1xyXG4gICAgICAgIGlmKCEoKHRoaXMubGFzdEZyYW1lICE9PSBpbml0RnJhbWUgJiYgKCh0aGlzLmxhc3RGcmFtZSA8IHRoaXMua2V5ZnJhbWVzWzBdLnQtdGhpcy5vZmZzZXRUaW1lICYmIGZyYW1lTnVtIDwgdGhpcy5rZXlmcmFtZXNbMF0udC10aGlzLm9mZnNldFRpbWUpIHx8ICh0aGlzLmxhc3RGcmFtZSA+IHRoaXMua2V5ZnJhbWVzW3RoaXMua2V5ZnJhbWVzLmxlbmd0aCAtIDFdLnQtdGhpcy5vZmZzZXRUaW1lICYmIGZyYW1lTnVtID4gdGhpcy5rZXlmcmFtZXNbdGhpcy5rZXlmcmFtZXMubGVuZ3RoIC0gMV0udC10aGlzLm9mZnNldFRpbWUpKSkpKXtcclxuICAgICAgICAgICAgdmFyIGtleVByb3BTLGtleVByb3BFLGlzSG9sZDtcclxuICAgICAgICAgICAgaWYoZnJhbWVOdW0gPCB0aGlzLmtleWZyYW1lc1swXS50LXRoaXMub2Zmc2V0VGltZSl7XHJcbiAgICAgICAgICAgICAgICBrZXlQcm9wUyA9IHRoaXMua2V5ZnJhbWVzWzBdLnNbMF07XHJcbiAgICAgICAgICAgICAgICBpc0hvbGQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fbGFzdEluZGV4ID0gMDtcclxuICAgICAgICAgICAgfWVsc2UgaWYoZnJhbWVOdW0gPj0gdGhpcy5rZXlmcmFtZXNbdGhpcy5rZXlmcmFtZXMubGVuZ3RoIC0gMV0udC10aGlzLm9mZnNldFRpbWUpe1xyXG4gICAgICAgICAgICAgICAgaWYodGhpcy5rZXlmcmFtZXNbdGhpcy5rZXlmcmFtZXMubGVuZ3RoIC0gMl0uaCA9PT0gMSl7XHJcbiAgICAgICAgICAgICAgICAgICAga2V5UHJvcFMgPSB0aGlzLmtleWZyYW1lc1t0aGlzLmtleWZyYW1lcy5sZW5ndGggLSAxXS5zWzBdO1xyXG4gICAgICAgICAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgICAgICAgICAga2V5UHJvcFMgPSB0aGlzLmtleWZyYW1lc1t0aGlzLmtleWZyYW1lcy5sZW5ndGggLSAyXS5lWzBdO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaXNIb2xkID0gdHJ1ZTtcclxuICAgICAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgICAgICB2YXIgaSA9IHRoaXMubGFzdEZyYW1lIDwgaW5pdEZyYW1lID8gdGhpcy5fbGFzdEluZGV4IDogMDtcclxuICAgICAgICAgICAgICAgIHZhciBsZW4gPSB0aGlzLmtleWZyYW1lcy5sZW5ndGgtIDEsZmxhZyA9IHRydWUsa2V5RGF0YSxuZXh0S2V5RGF0YSwgaiwgakxlbiwgaywga0xlbjtcclxuICAgICAgICAgICAgICAgIHdoaWxlKGZsYWcpe1xyXG4gICAgICAgICAgICAgICAgICAgIGtleURhdGEgPSB0aGlzLmtleWZyYW1lc1tpXTtcclxuICAgICAgICAgICAgICAgICAgICBuZXh0S2V5RGF0YSA9IHRoaXMua2V5ZnJhbWVzW2krMV07XHJcbiAgICAgICAgICAgICAgICAgICAgaWYoKG5leHRLZXlEYXRhLnQgLSB0aGlzLm9mZnNldFRpbWUpID4gZnJhbWVOdW0pe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYoaSA8IGxlbiAtIDEpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpICs9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZsYWcgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpc0hvbGQgPSBrZXlEYXRhLmggPT09IDE7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9sYXN0SW5kZXggPSBpO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciBwZXJjO1xyXG4gICAgICAgICAgICAgICAgaWYoIWlzSG9sZCl7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYoZnJhbWVOdW0gPj0gbmV4dEtleURhdGEudC10aGlzLm9mZnNldFRpbWUpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwZXJjID0gMTtcclxuICAgICAgICAgICAgICAgICAgICB9ZWxzZSBpZihmcmFtZU51bSA8IGtleURhdGEudC10aGlzLm9mZnNldFRpbWUpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwZXJjID0gMDtcclxuICAgICAgICAgICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGZuYztcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYoa2V5RGF0YS5fX2ZuY3Qpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm5jID0ga2V5RGF0YS5fX2ZuY3Q7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm5jID0gQmV6aWVyRmFjdG9yeS5nZXRCZXppZXJFYXNpbmcoa2V5RGF0YS5vLngsa2V5RGF0YS5vLnksa2V5RGF0YS5pLngsa2V5RGF0YS5pLnkpLmdldDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtleURhdGEuX19mbmN0ID0gZm5jO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBlcmMgPSBmbmMoKGZyYW1lTnVtLShrZXlEYXRhLnQtdGhpcy5vZmZzZXRUaW1lKSkvKChuZXh0S2V5RGF0YS50LXRoaXMub2Zmc2V0VGltZSktKGtleURhdGEudC10aGlzLm9mZnNldFRpbWUpKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGtleVByb3BFID0ga2V5RGF0YS5lWzBdO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAga2V5UHJvcFMgPSBrZXlEYXRhLnNbMF07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgakxlbiA9IHRoaXMudi5fbGVuZ3RoO1xyXG4gICAgICAgICAgICBrTGVuID0ga2V5UHJvcFMuaVswXS5sZW5ndGg7XHJcbiAgICAgICAgICAgIHZhciBoYXNNb2RpZmllZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICB2YXIgdmVydGV4VmFsdWU7XHJcbiAgICAgICAgICAgIGZvcihqPTA7ajxqTGVuO2orPTEpe1xyXG4gICAgICAgICAgICAgICAgZm9yKGs9MDtrPGtMZW47ays9MSl7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYoaXNIb2xkKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmVydGV4VmFsdWUgPSBrZXlQcm9wUy5pW2pdW2tdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZih0aGlzLnYuaVtqXVtrXSAhPT0gdmVydGV4VmFsdWUpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy52Lmlbal1ba10gPSB2ZXJ0ZXhWYWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucHYuaVtqXVtrXSA9IHZlcnRleFZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaGFzTW9kaWZpZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZlcnRleFZhbHVlID0ga2V5UHJvcFMub1tqXVtrXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYodGhpcy52Lm9bal1ba10gIT09IHZlcnRleFZhbHVlKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudi5vW2pdW2tdID0gdmVydGV4VmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnB2Lm9bal1ba10gPSB2ZXJ0ZXhWYWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhc01vZGlmaWVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2ZXJ0ZXhWYWx1ZSA9IGtleVByb3BTLnZbal1ba107XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKHRoaXMudi52W2pdW2tdICE9PSB2ZXJ0ZXhWYWx1ZSl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnYudltqXVtrXSA9IHZlcnRleFZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wdi52W2pdW2tdID0gdmVydGV4VmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoYXNNb2RpZmllZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmVydGV4VmFsdWUgPSBrZXlQcm9wUy5pW2pdW2tdKyhrZXlQcm9wRS5pW2pdW2tdLWtleVByb3BTLmlbal1ba10pKnBlcmM7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKHRoaXMudi5pW2pdW2tdICE9PSB2ZXJ0ZXhWYWx1ZSl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnYuaVtqXVtrXSA9IHZlcnRleFZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wdi5pW2pdW2tdID0gdmVydGV4VmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoYXNNb2RpZmllZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgdmVydGV4VmFsdWUgPSBrZXlQcm9wUy5vW2pdW2tdKyhrZXlQcm9wRS5vW2pdW2tdLWtleVByb3BTLm9bal1ba10pKnBlcmM7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKHRoaXMudi5vW2pdW2tdICE9PSB2ZXJ0ZXhWYWx1ZSl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnYub1tqXVtrXSA9IHZlcnRleFZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wdi5vW2pdW2tdID0gdmVydGV4VmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoYXNNb2RpZmllZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgdmVydGV4VmFsdWUgPSBrZXlQcm9wUy52W2pdW2tdKyhrZXlQcm9wRS52W2pdW2tdLWtleVByb3BTLnZbal1ba10pKnBlcmM7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKHRoaXMudi52W2pdW2tdICE9PSB2ZXJ0ZXhWYWx1ZSl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnYudltqXVtrXSA9IHZlcnRleFZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wdi52W2pdW2tdID0gdmVydGV4VmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoYXNNb2RpZmllZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5tZGYgPSBoYXNNb2RpZmllZDtcclxuICAgICAgICAgICAgdGhpcy52LmMgPSBrZXlQcm9wUy5jO1xyXG4gICAgICAgICAgICB0aGlzLnBhdGhzID0gdGhpcy5sb2NhbFNoYXBlQ29sbGVjdGlvbjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMubGFzdEZyYW1lID0gZnJhbWVOdW07XHJcbiAgICAgICAgdGhpcy5mcmFtZUlkID0gdGhpcy5lbGVtLmdsb2JhbERhdGEuZnJhbWVJZDtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBnZXRTaGFwZVZhbHVlKCl7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMudjtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiByZXNldFNoYXBlKCl7XHJcbiAgICAgICAgdGhpcy5wYXRocyA9IHRoaXMubG9jYWxTaGFwZUNvbGxlY3Rpb247XHJcbiAgICAgICAgaWYoIXRoaXMuayl7XHJcbiAgICAgICAgICAgIHRoaXMubWRmID0gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIFNoYXBlUHJvcGVydHkoZWxlbSwgZGF0YSwgdHlwZSl7XHJcbiAgICAgICAgdGhpcy5jb21wID0gZWxlbS5jb21wO1xyXG4gICAgICAgIHRoaXMuayA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMubWRmID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy52ID0gc2hhcGVfcG9vbC5uZXdTaGFwZSgpO1xyXG4gICAgICAgIHZhciBwYXRoRGF0YSA9IHR5cGUgPT09IDMgPyBkYXRhLnB0LmsgOiBkYXRhLmtzLms7XHJcbiAgICAgICAgdGhpcy52LnYgPSBwYXRoRGF0YS52O1xyXG4gICAgICAgIHRoaXMudi5pID0gcGF0aERhdGEuaTtcclxuICAgICAgICB0aGlzLnYubyA9IHBhdGhEYXRhLm87XHJcbiAgICAgICAgdGhpcy52LmMgPSBwYXRoRGF0YS5jO1xyXG4gICAgICAgIHRoaXMudi5fbGVuZ3RoID0gdGhpcy52LnYubGVuZ3RoO1xyXG4gICAgICAgIHRoaXMuZ2V0VmFsdWUgPSBnZXRTaGFwZVZhbHVlO1xyXG4gICAgICAgIHRoaXMucHYgPSBzaGFwZV9wb29sLmNsb25lKHRoaXMudik7XHJcbiAgICAgICAgdGhpcy5sb2NhbFNoYXBlQ29sbGVjdGlvbiA9IHNoYXBlQ29sbGVjdGlvbl9wb29sLm5ld1NoYXBlQ29sbGVjdGlvbigpO1xyXG4gICAgICAgIHRoaXMucGF0aHMgPSB0aGlzLmxvY2FsU2hhcGVDb2xsZWN0aW9uO1xyXG4gICAgICAgIHRoaXMucGF0aHMuYWRkU2hhcGUodGhpcy52KTtcclxuICAgICAgICB0aGlzLnJlc2V0ID0gcmVzZXRTaGFwZTtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBLZXlmcmFtZWRTaGFwZVByb3BlcnR5KGVsZW0sZGF0YSx0eXBlKXtcclxuICAgICAgICB0aGlzLmNvbXAgPSBlbGVtLmNvbXA7XHJcbiAgICAgICAgdGhpcy5lbGVtID0gZWxlbTtcclxuICAgICAgICB0aGlzLm9mZnNldFRpbWUgPSBlbGVtLmRhdGEuc3Q7XHJcbiAgICAgICAgdGhpcy5fbGFzdEluZGV4ID0gMDtcclxuICAgICAgICB0aGlzLmdldFZhbHVlID0gaW50ZXJwb2xhdGVTaGFwZTtcclxuICAgICAgICB0aGlzLmtleWZyYW1lcyA9IHR5cGUgPT09IDMgPyBkYXRhLnB0LmsgOiBkYXRhLmtzLms7XHJcbiAgICAgICAgdGhpcy5rID0gdHJ1ZTtcclxuICAgICAgICB0aGlzLmtmID0gdHJ1ZTtcclxuICAgICAgICB2YXIgaSwgbGVuID0gdGhpcy5rZXlmcmFtZXNbMF0uc1swXS5pLmxlbmd0aDtcclxuICAgICAgICB2YXIgakxlbiA9IHRoaXMua2V5ZnJhbWVzWzBdLnNbMF0uaVswXS5sZW5ndGg7XHJcbiAgICAgICAgdGhpcy52ID0gc2hhcGVfcG9vbC5uZXdTaGFwZSgpO1xyXG4gICAgICAgIHRoaXMudi5zZXRQYXRoRGF0YSh0aGlzLmtleWZyYW1lc1swXS5zWzBdLmMsIGxlbik7XHJcbiAgICAgICAgdGhpcy5wdiA9IHNoYXBlX3Bvb2wuY2xvbmUodGhpcy52KTtcclxuICAgICAgICB0aGlzLmxvY2FsU2hhcGVDb2xsZWN0aW9uID0gc2hhcGVDb2xsZWN0aW9uX3Bvb2wubmV3U2hhcGVDb2xsZWN0aW9uKCk7XHJcbiAgICAgICAgdGhpcy5wYXRocyA9IHRoaXMubG9jYWxTaGFwZUNvbGxlY3Rpb247XHJcbiAgICAgICAgdGhpcy5wYXRocy5hZGRTaGFwZSh0aGlzLnYpO1xyXG4gICAgICAgIHRoaXMubGFzdEZyYW1lID0gaW5pdEZyYW1lO1xyXG4gICAgICAgIHRoaXMucmVzZXQgPSByZXNldFNoYXBlO1xyXG4gICAgfVxyXG5cclxuICAgIHZhciBFbGxTaGFwZVByb3BlcnR5ID0gKGZ1bmN0aW9uKCl7XHJcblxyXG4gICAgICAgIHZhciBjUG9pbnQgPSByb3VuZENvcm5lcjtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gY29udmVydEVsbFRvUGF0aCgpe1xyXG4gICAgICAgICAgICB2YXIgcDAgPSB0aGlzLnAudlswXSwgcDEgPSB0aGlzLnAudlsxXSwgczAgPSB0aGlzLnMudlswXS8yLCBzMSA9IHRoaXMucy52WzFdLzI7XHJcbiAgICAgICAgICAgIGlmKHRoaXMuZCAhPT0gMyl7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnYudlswXVswXSA9IHAwO1xyXG4gICAgICAgICAgICAgICAgdGhpcy52LnZbMF1bMV0gPSBwMS1zMTtcclxuICAgICAgICAgICAgICAgIHRoaXMudi52WzFdWzBdID0gcDAgKyBzMDtcclxuICAgICAgICAgICAgICAgIHRoaXMudi52WzFdWzFdID0gcDE7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnYudlsyXVswXSA9IHAwO1xyXG4gICAgICAgICAgICAgICAgdGhpcy52LnZbMl1bMV0gPSBwMStzMTtcclxuICAgICAgICAgICAgICAgIHRoaXMudi52WzNdWzBdID0gcDAgLSBzMDtcclxuICAgICAgICAgICAgICAgIHRoaXMudi52WzNdWzFdID0gcDE7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnYuaVswXVswXSA9IHAwIC0gczAqY1BvaW50O1xyXG4gICAgICAgICAgICAgICAgdGhpcy52LmlbMF1bMV0gPSBwMSAtIHMxO1xyXG4gICAgICAgICAgICAgICAgdGhpcy52LmlbMV1bMF0gPSBwMCArIHMwO1xyXG4gICAgICAgICAgICAgICAgdGhpcy52LmlbMV1bMV0gPSBwMSAtIHMxKmNQb2ludDtcclxuICAgICAgICAgICAgICAgIHRoaXMudi5pWzJdWzBdID0gcDAgKyBzMCpjUG9pbnQ7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnYuaVsyXVsxXSA9IHAxICsgczE7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnYuaVszXVswXSA9IHAwIC0gczA7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnYuaVszXVsxXSA9IHAxICsgczEqY1BvaW50O1xyXG4gICAgICAgICAgICAgICAgdGhpcy52Lm9bMF1bMF0gPSBwMCArIHMwKmNQb2ludDtcclxuICAgICAgICAgICAgICAgIHRoaXMudi5vWzBdWzFdID0gcDEgLSBzMTtcclxuICAgICAgICAgICAgICAgIHRoaXMudi5vWzFdWzBdID0gcDAgKyBzMDtcclxuICAgICAgICAgICAgICAgIHRoaXMudi5vWzFdWzFdID0gcDEgKyBzMSpjUG9pbnQ7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnYub1syXVswXSA9IHAwIC0gczAqY1BvaW50O1xyXG4gICAgICAgICAgICAgICAgdGhpcy52Lm9bMl1bMV0gPSBwMSArIHMxO1xyXG4gICAgICAgICAgICAgICAgdGhpcy52Lm9bM11bMF0gPSBwMCAtIHMwO1xyXG4gICAgICAgICAgICAgICAgdGhpcy52Lm9bM11bMV0gPSBwMSAtIHMxKmNQb2ludDtcclxuICAgICAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnYudlswXVswXSA9IHAwO1xyXG4gICAgICAgICAgICAgICAgdGhpcy52LnZbMF1bMV0gPSBwMS1zMTtcclxuICAgICAgICAgICAgICAgIHRoaXMudi52WzFdWzBdID0gcDAgLSBzMDtcclxuICAgICAgICAgICAgICAgIHRoaXMudi52WzFdWzFdID0gcDE7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnYudlsyXVswXSA9IHAwO1xyXG4gICAgICAgICAgICAgICAgdGhpcy52LnZbMl1bMV0gPSBwMStzMTtcclxuICAgICAgICAgICAgICAgIHRoaXMudi52WzNdWzBdID0gcDAgKyBzMDtcclxuICAgICAgICAgICAgICAgIHRoaXMudi52WzNdWzFdID0gcDE7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnYuaVswXVswXSA9IHAwICsgczAqY1BvaW50O1xyXG4gICAgICAgICAgICAgICAgdGhpcy52LmlbMF1bMV0gPSBwMSAtIHMxO1xyXG4gICAgICAgICAgICAgICAgdGhpcy52LmlbMV1bMF0gPSBwMCAtIHMwO1xyXG4gICAgICAgICAgICAgICAgdGhpcy52LmlbMV1bMV0gPSBwMSAtIHMxKmNQb2ludDtcclxuICAgICAgICAgICAgICAgIHRoaXMudi5pWzJdWzBdID0gcDAgLSBzMCpjUG9pbnQ7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnYuaVsyXVsxXSA9IHAxICsgczE7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnYuaVszXVswXSA9IHAwICsgczA7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnYuaVszXVsxXSA9IHAxICsgczEqY1BvaW50O1xyXG4gICAgICAgICAgICAgICAgdGhpcy52Lm9bMF1bMF0gPSBwMCAtIHMwKmNQb2ludDtcclxuICAgICAgICAgICAgICAgIHRoaXMudi5vWzBdWzFdID0gcDEgLSBzMTtcclxuICAgICAgICAgICAgICAgIHRoaXMudi5vWzFdWzBdID0gcDAgLSBzMDtcclxuICAgICAgICAgICAgICAgIHRoaXMudi5vWzFdWzFdID0gcDEgKyBzMSpjUG9pbnQ7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnYub1syXVswXSA9IHAwICsgczAqY1BvaW50O1xyXG4gICAgICAgICAgICAgICAgdGhpcy52Lm9bMl1bMV0gPSBwMSArIHMxO1xyXG4gICAgICAgICAgICAgICAgdGhpcy52Lm9bM11bMF0gPSBwMCArIHMwO1xyXG4gICAgICAgICAgICAgICAgdGhpcy52Lm9bM11bMV0gPSBwMSAtIHMxKmNQb2ludDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gcHJvY2Vzc0tleXMoZnJhbWVOdW0pe1xyXG4gICAgICAgICAgICB2YXIgaSwgbGVuID0gdGhpcy5keW5hbWljUHJvcGVydGllcy5sZW5ndGg7XHJcbiAgICAgICAgICAgIGlmKHRoaXMuZWxlbS5nbG9iYWxEYXRhLmZyYW1lSWQgPT09IHRoaXMuZnJhbWVJZCl7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5tZGYgPSBmYWxzZTtcclxuICAgICAgICAgICAgdGhpcy5mcmFtZUlkID0gdGhpcy5lbGVtLmdsb2JhbERhdGEuZnJhbWVJZDtcclxuXHJcbiAgICAgICAgICAgIGZvcihpPTA7aTxsZW47aSs9MSl7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmR5bmFtaWNQcm9wZXJ0aWVzW2ldLmdldFZhbHVlKGZyYW1lTnVtKTtcclxuICAgICAgICAgICAgICAgIGlmKHRoaXMuZHluYW1pY1Byb3BlcnRpZXNbaV0ubWRmKXtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLm1kZiA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYodGhpcy5tZGYpe1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jb252ZXJ0RWxsVG9QYXRoKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBmdW5jdGlvbiBFbGxTaGFwZVByb3BlcnR5KGVsZW0sZGF0YSkge1xyXG4gICAgICAgICAgICAvKnRoaXMudiA9IHtcclxuICAgICAgICAgICAgICAgIHY6IEFycmF5LmFwcGx5KG51bGwse2xlbmd0aDo0fSksXHJcbiAgICAgICAgICAgICAgICBpOiBBcnJheS5hcHBseShudWxsLHtsZW5ndGg6NH0pLFxyXG4gICAgICAgICAgICAgICAgbzogQXJyYXkuYXBwbHkobnVsbCx7bGVuZ3RoOjR9KSxcclxuICAgICAgICAgICAgICAgIGM6IHRydWVcclxuICAgICAgICAgICAgfTsqL1xyXG4gICAgICAgICAgICB0aGlzLnYgPSBzaGFwZV9wb29sLm5ld1NoYXBlKCk7XHJcbiAgICAgICAgICAgIHRoaXMudi5zZXRQYXRoRGF0YSh0cnVlLCA0KTtcclxuICAgICAgICAgICAgdGhpcy5sb2NhbFNoYXBlQ29sbGVjdGlvbiA9IHNoYXBlQ29sbGVjdGlvbl9wb29sLm5ld1NoYXBlQ29sbGVjdGlvbigpO1xyXG4gICAgICAgICAgICB0aGlzLnBhdGhzID0gdGhpcy5sb2NhbFNoYXBlQ29sbGVjdGlvbjtcclxuICAgICAgICAgICAgdGhpcy5sb2NhbFNoYXBlQ29sbGVjdGlvbi5hZGRTaGFwZSh0aGlzLnYpO1xyXG4gICAgICAgICAgICB0aGlzLmQgPSBkYXRhLmQ7XHJcbiAgICAgICAgICAgIHRoaXMuZHluYW1pY1Byb3BlcnRpZXMgPSBbXTtcclxuICAgICAgICAgICAgdGhpcy5lbGVtID0gZWxlbTtcclxuICAgICAgICAgICAgdGhpcy5jb21wID0gZWxlbS5jb21wO1xyXG4gICAgICAgICAgICB0aGlzLmZyYW1lSWQgPSAtMTtcclxuICAgICAgICAgICAgdGhpcy5tZGYgPSBmYWxzZTtcclxuICAgICAgICAgICAgdGhpcy5nZXRWYWx1ZSA9IHByb2Nlc3NLZXlzO1xyXG4gICAgICAgICAgICB0aGlzLmNvbnZlcnRFbGxUb1BhdGggPSBjb252ZXJ0RWxsVG9QYXRoO1xyXG4gICAgICAgICAgICB0aGlzLnJlc2V0ID0gcmVzZXRTaGFwZTtcclxuICAgICAgICAgICAgdGhpcy5wID0gUHJvcGVydHlGYWN0b3J5LmdldFByb3AoZWxlbSxkYXRhLnAsMSwwLHRoaXMuZHluYW1pY1Byb3BlcnRpZXMpO1xyXG4gICAgICAgICAgICB0aGlzLnMgPSBQcm9wZXJ0eUZhY3RvcnkuZ2V0UHJvcChlbGVtLGRhdGEucywxLDAsdGhpcy5keW5hbWljUHJvcGVydGllcyk7XHJcbiAgICAgICAgICAgIGlmKHRoaXMuZHluYW1pY1Byb3BlcnRpZXMubGVuZ3RoKXtcclxuICAgICAgICAgICAgICAgIHRoaXMuayA9IHRydWU7XHJcbiAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jb252ZXJ0RWxsVG9QYXRoKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9KCkpO1xyXG5cclxuICAgIHZhciBTdGFyU2hhcGVQcm9wZXJ0eSA9IChmdW5jdGlvbigpIHtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gY29udmVydFBvbHlnb25Ub1BhdGgoKXtcclxuICAgICAgICAgICAgdmFyIG51bVB0cyA9IE1hdGguZmxvb3IodGhpcy5wdC52KTtcclxuICAgICAgICAgICAgdmFyIGFuZ2xlID0gTWF0aC5QSSoyL251bVB0cztcclxuICAgICAgICAgICAgLyp0aGlzLnYudi5sZW5ndGggPSBudW1QdHM7XHJcbiAgICAgICAgICAgIHRoaXMudi5pLmxlbmd0aCA9IG51bVB0cztcclxuICAgICAgICAgICAgdGhpcy52Lm8ubGVuZ3RoID0gbnVtUHRzOyovXHJcbiAgICAgICAgICAgIHZhciByYWQgPSB0aGlzLm9yLnY7XHJcbiAgICAgICAgICAgIHZhciByb3VuZG5lc3MgPSB0aGlzLm9zLnY7XHJcbiAgICAgICAgICAgIHZhciBwZXJpbVNlZ21lbnQgPSAyKk1hdGguUEkqcmFkLyhudW1QdHMqNCk7XHJcbiAgICAgICAgICAgIHZhciBpLCBjdXJyZW50QW5nID0gLU1hdGguUEkvIDI7XHJcbiAgICAgICAgICAgIHZhciBkaXIgPSB0aGlzLmRhdGEuZCA9PT0gMyA/IC0xIDogMTtcclxuICAgICAgICAgICAgY3VycmVudEFuZyArPSB0aGlzLnIudjtcclxuICAgICAgICAgICAgdGhpcy52Ll9sZW5ndGggPSAwO1xyXG4gICAgICAgICAgICBmb3IoaT0wO2k8bnVtUHRzO2krPTEpe1xyXG4gICAgICAgICAgICAgICAgdmFyIHggPSByYWQgKiBNYXRoLmNvcyhjdXJyZW50QW5nKTtcclxuICAgICAgICAgICAgICAgIHZhciB5ID0gcmFkICogTWF0aC5zaW4oY3VycmVudEFuZyk7XHJcbiAgICAgICAgICAgICAgICB2YXIgb3ggPSB4ID09PSAwICYmIHkgPT09IDAgPyAwIDogeS9NYXRoLnNxcnQoeCp4ICsgeSp5KTtcclxuICAgICAgICAgICAgICAgIHZhciBveSA9IHggPT09IDAgJiYgeSA9PT0gMCA/IDAgOiAteC9NYXRoLnNxcnQoeCp4ICsgeSp5KTtcclxuICAgICAgICAgICAgICAgIHggKz0gICsgdGhpcy5wLnZbMF07XHJcbiAgICAgICAgICAgICAgICB5ICs9ICArIHRoaXMucC52WzFdO1xyXG4gICAgICAgICAgICAgICAgdGhpcy52LnNldFRyaXBsZUF0KHgseSx4LW94KnBlcmltU2VnbWVudCpyb3VuZG5lc3MqZGlyLHktb3kqcGVyaW1TZWdtZW50KnJvdW5kbmVzcypkaXIseCtveCpwZXJpbVNlZ21lbnQqcm91bmRuZXNzKmRpcix5K295KnBlcmltU2VnbWVudCpyb3VuZG5lc3MqZGlyLCBpLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgIC8qdGhpcy52LnZbaV0gPSBbeCx5XTtcclxuICAgICAgICAgICAgICAgIHRoaXMudi5pW2ldID0gW3grb3gqcGVyaW1TZWdtZW50KnJvdW5kbmVzcypkaXIseStveSpwZXJpbVNlZ21lbnQqcm91bmRuZXNzKmRpcl07XHJcbiAgICAgICAgICAgICAgICB0aGlzLnYub1tpXSA9IFt4LW94KnBlcmltU2VnbWVudCpyb3VuZG5lc3MqZGlyLHktb3kqcGVyaW1TZWdtZW50KnJvdW5kbmVzcypkaXJdOyovXHJcbiAgICAgICAgICAgICAgICBjdXJyZW50QW5nICs9IGFuZ2xlKmRpcjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLnBhdGhzLmxlbmd0aCA9IDA7XHJcbiAgICAgICAgICAgIHRoaXMucGF0aHNbMF0gPSB0aGlzLnY7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBjb252ZXJ0U3RhclRvUGF0aCgpIHtcclxuICAgICAgICAgICAgdmFyIG51bVB0cyA9IE1hdGguZmxvb3IodGhpcy5wdC52KSoyO1xyXG4gICAgICAgICAgICB2YXIgYW5nbGUgPSBNYXRoLlBJKjIvbnVtUHRzO1xyXG4gICAgICAgICAgICAvKnRoaXMudi52Lmxlbmd0aCA9IG51bVB0cztcclxuICAgICAgICAgICAgdGhpcy52LmkubGVuZ3RoID0gbnVtUHRzO1xyXG4gICAgICAgICAgICB0aGlzLnYuby5sZW5ndGggPSBudW1QdHM7Ki9cclxuICAgICAgICAgICAgdmFyIGxvbmdGbGFnID0gdHJ1ZTtcclxuICAgICAgICAgICAgdmFyIGxvbmdSYWQgPSB0aGlzLm9yLnY7XHJcbiAgICAgICAgICAgIHZhciBzaG9ydFJhZCA9IHRoaXMuaXIudjtcclxuICAgICAgICAgICAgdmFyIGxvbmdSb3VuZCA9IHRoaXMub3MudjtcclxuICAgICAgICAgICAgdmFyIHNob3J0Um91bmQgPSB0aGlzLmlzLnY7XHJcbiAgICAgICAgICAgIHZhciBsb25nUGVyaW1TZWdtZW50ID0gMipNYXRoLlBJKmxvbmdSYWQvKG51bVB0cyoyKTtcclxuICAgICAgICAgICAgdmFyIHNob3J0UGVyaW1TZWdtZW50ID0gMipNYXRoLlBJKnNob3J0UmFkLyhudW1QdHMqMik7XHJcbiAgICAgICAgICAgIHZhciBpLCByYWQscm91bmRuZXNzLHBlcmltU2VnbWVudCwgY3VycmVudEFuZyA9IC1NYXRoLlBJLyAyO1xyXG4gICAgICAgICAgICBjdXJyZW50QW5nICs9IHRoaXMuci52O1xyXG4gICAgICAgICAgICB2YXIgZGlyID0gdGhpcy5kYXRhLmQgPT09IDMgPyAtMSA6IDE7XHJcbiAgICAgICAgICAgIHRoaXMudi5fbGVuZ3RoID0gMDtcclxuICAgICAgICAgICAgZm9yKGk9MDtpPG51bVB0cztpKz0xKXtcclxuICAgICAgICAgICAgICAgIHJhZCA9IGxvbmdGbGFnID8gbG9uZ1JhZCA6IHNob3J0UmFkO1xyXG4gICAgICAgICAgICAgICAgcm91bmRuZXNzID0gbG9uZ0ZsYWcgPyBsb25nUm91bmQgOiBzaG9ydFJvdW5kO1xyXG4gICAgICAgICAgICAgICAgcGVyaW1TZWdtZW50ID0gbG9uZ0ZsYWcgPyBsb25nUGVyaW1TZWdtZW50IDogc2hvcnRQZXJpbVNlZ21lbnQ7XHJcbiAgICAgICAgICAgICAgICB2YXIgeCA9IHJhZCAqIE1hdGguY29zKGN1cnJlbnRBbmcpO1xyXG4gICAgICAgICAgICAgICAgdmFyIHkgPSByYWQgKiBNYXRoLnNpbihjdXJyZW50QW5nKTtcclxuICAgICAgICAgICAgICAgIHZhciBveCA9IHggPT09IDAgJiYgeSA9PT0gMCA/IDAgOiB5L01hdGguc3FydCh4KnggKyB5KnkpO1xyXG4gICAgICAgICAgICAgICAgdmFyIG95ID0geCA9PT0gMCAmJiB5ID09PSAwID8gMCA6IC14L01hdGguc3FydCh4KnggKyB5KnkpO1xyXG4gICAgICAgICAgICAgICAgeCArPSAgKyB0aGlzLnAudlswXTtcclxuICAgICAgICAgICAgICAgIHkgKz0gICsgdGhpcy5wLnZbMV07XHJcbiAgICAgICAgICAgICAgICB0aGlzLnYuc2V0VHJpcGxlQXQoeCx5LHgtb3gqcGVyaW1TZWdtZW50KnJvdW5kbmVzcypkaXIseS1veSpwZXJpbVNlZ21lbnQqcm91bmRuZXNzKmRpcix4K294KnBlcmltU2VnbWVudCpyb3VuZG5lc3MqZGlyLHkrb3kqcGVyaW1TZWdtZW50KnJvdW5kbmVzcypkaXIsIGksIHRydWUpO1xyXG5cclxuICAgICAgICAgICAgICAgIC8qdGhpcy52LnZbaV0gPSBbeCx5XTtcclxuICAgICAgICAgICAgICAgIHRoaXMudi5pW2ldID0gW3grb3gqcGVyaW1TZWdtZW50KnJvdW5kbmVzcypkaXIseStveSpwZXJpbVNlZ21lbnQqcm91bmRuZXNzKmRpcl07XHJcbiAgICAgICAgICAgICAgICB0aGlzLnYub1tpXSA9IFt4LW94KnBlcmltU2VnbWVudCpyb3VuZG5lc3MqZGlyLHktb3kqcGVyaW1TZWdtZW50KnJvdW5kbmVzcypkaXJdO1xyXG4gICAgICAgICAgICAgICAgdGhpcy52Ll9sZW5ndGggPSBudW1QdHM7Ki9cclxuICAgICAgICAgICAgICAgIGxvbmdGbGFnID0gIWxvbmdGbGFnO1xyXG4gICAgICAgICAgICAgICAgY3VycmVudEFuZyArPSBhbmdsZSpkaXI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHByb2Nlc3NLZXlzKCkge1xyXG4gICAgICAgICAgICBpZih0aGlzLmVsZW0uZ2xvYmFsRGF0YS5mcmFtZUlkID09PSB0aGlzLmZyYW1lSWQpe1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMubWRmID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHRoaXMuZnJhbWVJZCA9IHRoaXMuZWxlbS5nbG9iYWxEYXRhLmZyYW1lSWQ7XHJcbiAgICAgICAgICAgIHZhciBpLCBsZW4gPSB0aGlzLmR5bmFtaWNQcm9wZXJ0aWVzLmxlbmd0aDtcclxuXHJcbiAgICAgICAgICAgIGZvcihpPTA7aTxsZW47aSs9MSl7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmR5bmFtaWNQcm9wZXJ0aWVzW2ldLmdldFZhbHVlKCk7XHJcbiAgICAgICAgICAgICAgICBpZih0aGlzLmR5bmFtaWNQcm9wZXJ0aWVzW2ldLm1kZil7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5tZGYgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmKHRoaXMubWRmKXtcclxuICAgICAgICAgICAgICAgIHRoaXMuY29udmVydFRvUGF0aCgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gZnVuY3Rpb24gU3RhclNoYXBlUHJvcGVydHkoZWxlbSxkYXRhKSB7XHJcbiAgICAgICAgICAgIC8qdGhpcy52ID0ge1xyXG4gICAgICAgICAgICAgICAgdjogW10sXHJcbiAgICAgICAgICAgICAgICBpOiBbXSxcclxuICAgICAgICAgICAgICAgIG86IFtdLFxyXG4gICAgICAgICAgICAgICAgYzogdHJ1ZVxyXG4gICAgICAgICAgICB9OyovXHJcbiAgICAgICAgICAgIHRoaXMudiA9IHNoYXBlX3Bvb2wubmV3U2hhcGUoKTtcclxuICAgICAgICAgICAgdGhpcy52LnNldFBhdGhEYXRhKHRydWUsIDApO1xyXG4gICAgICAgICAgICB0aGlzLmVsZW0gPSBlbGVtO1xyXG4gICAgICAgICAgICB0aGlzLmNvbXAgPSBlbGVtLmNvbXA7XHJcbiAgICAgICAgICAgIHRoaXMuZGF0YSA9IGRhdGE7XHJcbiAgICAgICAgICAgIHRoaXMuZnJhbWVJZCA9IC0xO1xyXG4gICAgICAgICAgICB0aGlzLmQgPSBkYXRhLmQ7XHJcbiAgICAgICAgICAgIHRoaXMuZHluYW1pY1Byb3BlcnRpZXMgPSBbXTtcclxuICAgICAgICAgICAgdGhpcy5tZGYgPSBmYWxzZTtcclxuICAgICAgICAgICAgdGhpcy5nZXRWYWx1ZSA9IHByb2Nlc3NLZXlzO1xyXG4gICAgICAgICAgICB0aGlzLnJlc2V0ID0gcmVzZXRTaGFwZTtcclxuICAgICAgICAgICAgaWYoZGF0YS5zeSA9PT0gMSl7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmlyID0gUHJvcGVydHlGYWN0b3J5LmdldFByb3AoZWxlbSxkYXRhLmlyLDAsMCx0aGlzLmR5bmFtaWNQcm9wZXJ0aWVzKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuaXMgPSBQcm9wZXJ0eUZhY3RvcnkuZ2V0UHJvcChlbGVtLGRhdGEuaXMsMCwwLjAxLHRoaXMuZHluYW1pY1Byb3BlcnRpZXMpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jb252ZXJ0VG9QYXRoID0gY29udmVydFN0YXJUb1BhdGg7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNvbnZlcnRUb1BhdGggPSBjb252ZXJ0UG9seWdvblRvUGF0aDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLnB0ID0gUHJvcGVydHlGYWN0b3J5LmdldFByb3AoZWxlbSxkYXRhLnB0LDAsMCx0aGlzLmR5bmFtaWNQcm9wZXJ0aWVzKTtcclxuICAgICAgICAgICAgdGhpcy5wID0gUHJvcGVydHlGYWN0b3J5LmdldFByb3AoZWxlbSxkYXRhLnAsMSwwLHRoaXMuZHluYW1pY1Byb3BlcnRpZXMpO1xyXG4gICAgICAgICAgICB0aGlzLnIgPSBQcm9wZXJ0eUZhY3RvcnkuZ2V0UHJvcChlbGVtLGRhdGEuciwwLGRlZ1RvUmFkcyx0aGlzLmR5bmFtaWNQcm9wZXJ0aWVzKTtcclxuICAgICAgICAgICAgdGhpcy5vciA9IFByb3BlcnR5RmFjdG9yeS5nZXRQcm9wKGVsZW0sZGF0YS5vciwwLDAsdGhpcy5keW5hbWljUHJvcGVydGllcyk7XHJcbiAgICAgICAgICAgIHRoaXMub3MgPSBQcm9wZXJ0eUZhY3RvcnkuZ2V0UHJvcChlbGVtLGRhdGEub3MsMCwwLjAxLHRoaXMuZHluYW1pY1Byb3BlcnRpZXMpO1xyXG4gICAgICAgICAgICB0aGlzLmxvY2FsU2hhcGVDb2xsZWN0aW9uID0gc2hhcGVDb2xsZWN0aW9uX3Bvb2wubmV3U2hhcGVDb2xsZWN0aW9uKCk7XHJcbiAgICAgICAgICAgIHRoaXMubG9jYWxTaGFwZUNvbGxlY3Rpb24uYWRkU2hhcGUodGhpcy52KTtcclxuICAgICAgICAgICAgdGhpcy5wYXRocyA9IHRoaXMubG9jYWxTaGFwZUNvbGxlY3Rpb247XHJcbiAgICAgICAgICAgIGlmKHRoaXMuZHluYW1pY1Byb3BlcnRpZXMubGVuZ3RoKXtcclxuICAgICAgICAgICAgICAgIHRoaXMuayA9IHRydWU7XHJcbiAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jb252ZXJ0VG9QYXRoKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9KCkpO1xyXG5cclxuICAgIHZhciBSZWN0U2hhcGVQcm9wZXJ0eSA9IChmdW5jdGlvbigpIHtcclxuICAgICAgICBmdW5jdGlvbiBwcm9jZXNzS2V5cyhmcmFtZU51bSl7XHJcbiAgICAgICAgICAgIGlmKHRoaXMuZWxlbS5nbG9iYWxEYXRhLmZyYW1lSWQgPT09IHRoaXMuZnJhbWVJZCl7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5tZGYgPSBmYWxzZTtcclxuICAgICAgICAgICAgdGhpcy5mcmFtZUlkID0gdGhpcy5lbGVtLmdsb2JhbERhdGEuZnJhbWVJZDtcclxuICAgICAgICAgICAgdmFyIGksIGxlbiA9IHRoaXMuZHluYW1pY1Byb3BlcnRpZXMubGVuZ3RoO1xyXG5cclxuICAgICAgICAgICAgZm9yKGk9MDtpPGxlbjtpKz0xKXtcclxuICAgICAgICAgICAgICAgIHRoaXMuZHluYW1pY1Byb3BlcnRpZXNbaV0uZ2V0VmFsdWUoZnJhbWVOdW0pO1xyXG4gICAgICAgICAgICAgICAgaWYodGhpcy5keW5hbWljUHJvcGVydGllc1tpXS5tZGYpe1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMubWRmID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZih0aGlzLm1kZil7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNvbnZlcnRSZWN0VG9QYXRoKCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBjb252ZXJ0UmVjdFRvUGF0aCgpe1xyXG4gICAgICAgICAgICB2YXIgcDAgPSB0aGlzLnAudlswXSwgcDEgPSB0aGlzLnAudlsxXSwgdjAgPSB0aGlzLnMudlswXS8yLCB2MSA9IHRoaXMucy52WzFdLzI7XHJcbiAgICAgICAgICAgIHZhciByb3VuZCA9IGJtX21pbih2MCx2MSx0aGlzLnIudik7XHJcbiAgICAgICAgICAgIHZhciBjUG9pbnQgPSByb3VuZCooMS1yb3VuZENvcm5lcik7XHJcbiAgICAgICAgICAgIHRoaXMudi5fbGVuZ3RoID0gMDtcclxuXHJcbiAgICAgICAgICAgIGlmKHRoaXMuZCA9PT0gMiB8fCB0aGlzLmQgPT09IDEpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMudi5zZXRUcmlwbGVBdChwMCt2MCwgcDEtdjErcm91bmQscDArdjAsIHAxLXYxK3JvdW5kLHAwK3YwLHAxLXYxK2NQb2ludCwwLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgIHRoaXMudi5zZXRUcmlwbGVBdChwMCt2MCwgcDErdjEtcm91bmQscDArdjAsIHAxK3YxLWNQb2ludCxwMCt2MCwgcDErdjEtcm91bmQsMSwgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICBpZihyb3VuZCE9PSAwKXtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnYuc2V0VHJpcGxlQXQocDArdjAtcm91bmQsIHAxK3YxLHAwK3YwLXJvdW5kLHAxK3YxLHAwK3YwLWNQb2ludCxwMSt2MSwyLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnYuc2V0VHJpcGxlQXQocDAtdjArcm91bmQscDErdjEscDAtdjArY1BvaW50LHAxK3YxLHAwLXYwK3JvdW5kLHAxK3YxLDMsIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudi5zZXRUcmlwbGVBdChwMC12MCxwMSt2MS1yb3VuZCxwMC12MCxwMSt2MS1yb3VuZCxwMC12MCxwMSt2MS1jUG9pbnQsNCwgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy52LnNldFRyaXBsZUF0KHAwLXYwLHAxLXYxK3JvdW5kLHAwLXYwLHAxLXYxK2NQb2ludCxwMC12MCxwMS12MStyb3VuZCw1LCB0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnYuc2V0VHJpcGxlQXQocDAtdjArcm91bmQscDEtdjEscDAtdjArcm91bmQscDEtdjEscDAtdjArY1BvaW50LHAxLXYxLDYsIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudi5zZXRUcmlwbGVBdChwMCt2MC1yb3VuZCxwMS12MSxwMCt2MC1jUG9pbnQscDEtdjEscDArdjAtcm91bmQscDEtdjEsNywgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudi5zZXRUcmlwbGVBdChwMC12MCxwMSt2MSxwMC12MCtjUG9pbnQscDErdjEscDAtdjAscDErdjEsMik7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy52LnNldFRyaXBsZUF0KHAwLXYwLHAxLXYxLHAwLXYwLHAxLXYxK2NQb2ludCxwMC12MCxwMS12MSwzKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnYuc2V0VHJpcGxlQXQocDArdjAscDEtdjErcm91bmQscDArdjAscDEtdjErY1BvaW50LHAwK3YwLHAxLXYxK3JvdW5kLDAsIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgaWYocm91bmQhPT0gMCl7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy52LnNldFRyaXBsZUF0KHAwK3YwLXJvdW5kLHAxLXYxLHAwK3YwLXJvdW5kLHAxLXYxLHAwK3YwLWNQb2ludCxwMS12MSwxLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnYuc2V0VHJpcGxlQXQocDAtdjArcm91bmQscDEtdjEscDAtdjArY1BvaW50LHAxLXYxLHAwLXYwK3JvdW5kLHAxLXYxLDIsIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudi5zZXRUcmlwbGVBdChwMC12MCxwMS12MStyb3VuZCxwMC12MCxwMS12MStyb3VuZCxwMC12MCxwMS12MStjUG9pbnQsMywgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy52LnNldFRyaXBsZUF0KHAwLXYwLHAxK3YxLXJvdW5kLHAwLXYwLHAxK3YxLWNQb2ludCxwMC12MCxwMSt2MS1yb3VuZCw0LCB0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnYuc2V0VHJpcGxlQXQocDAtdjArcm91bmQscDErdjEscDAtdjArcm91bmQscDErdjEscDAtdjArY1BvaW50LHAxK3YxLDUsIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudi5zZXRUcmlwbGVBdChwMCt2MC1yb3VuZCxwMSt2MSxwMCt2MC1jUG9pbnQscDErdjEscDArdjAtcm91bmQscDErdjEsNiwgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy52LnNldFRyaXBsZUF0KHAwK3YwLHAxK3YxLXJvdW5kLHAwK3YwLHAxK3YxLXJvdW5kLHAwK3YwLHAxK3YxLWNQb2ludCw3LCB0cnVlKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy52LnNldFRyaXBsZUF0KHAwLXYwLHAxLXYxLHAwLXYwK2NQb2ludCxwMS12MSxwMC12MCxwMS12MSwxLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnYuc2V0VHJpcGxlQXQocDAtdjAscDErdjEscDAtdjAscDErdjEtY1BvaW50LHAwLXYwLHAxK3YxLDIsIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudi5zZXRUcmlwbGVBdChwMCt2MCxwMSt2MSxwMCt2MC1jUG9pbnQscDErdjEscDArdjAscDErdjEsMywgdHJ1ZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gZnVuY3Rpb24gUmVjdFNoYXBlUHJvcGVydHkoZWxlbSxkYXRhKSB7XHJcbiAgICAgICAgICAgIHRoaXMudiA9IHNoYXBlX3Bvb2wubmV3U2hhcGUoKTtcclxuICAgICAgICAgICAgdGhpcy52LmMgPSB0cnVlO1xyXG4gICAgICAgICAgICB0aGlzLmxvY2FsU2hhcGVDb2xsZWN0aW9uID0gc2hhcGVDb2xsZWN0aW9uX3Bvb2wubmV3U2hhcGVDb2xsZWN0aW9uKCk7XHJcbiAgICAgICAgICAgIHRoaXMubG9jYWxTaGFwZUNvbGxlY3Rpb24uYWRkU2hhcGUodGhpcy52KTtcclxuICAgICAgICAgICAgdGhpcy5wYXRocyA9IHRoaXMubG9jYWxTaGFwZUNvbGxlY3Rpb247XHJcbiAgICAgICAgICAgIHRoaXMuZWxlbSA9IGVsZW07XHJcbiAgICAgICAgICAgIHRoaXMuY29tcCA9IGVsZW0uY29tcDtcclxuICAgICAgICAgICAgdGhpcy5mcmFtZUlkID0gLTE7XHJcbiAgICAgICAgICAgIHRoaXMuZCA9IGRhdGEuZDtcclxuICAgICAgICAgICAgdGhpcy5keW5hbWljUHJvcGVydGllcyA9IFtdO1xyXG4gICAgICAgICAgICB0aGlzLm1kZiA9IGZhbHNlO1xyXG4gICAgICAgICAgICB0aGlzLmdldFZhbHVlID0gcHJvY2Vzc0tleXM7XHJcbiAgICAgICAgICAgIHRoaXMuY29udmVydFJlY3RUb1BhdGggPSBjb252ZXJ0UmVjdFRvUGF0aDtcclxuICAgICAgICAgICAgdGhpcy5yZXNldCA9IHJlc2V0U2hhcGU7XHJcbiAgICAgICAgICAgIHRoaXMucCA9IFByb3BlcnR5RmFjdG9yeS5nZXRQcm9wKGVsZW0sZGF0YS5wLDEsMCx0aGlzLmR5bmFtaWNQcm9wZXJ0aWVzKTtcclxuICAgICAgICAgICAgdGhpcy5zID0gUHJvcGVydHlGYWN0b3J5LmdldFByb3AoZWxlbSxkYXRhLnMsMSwwLHRoaXMuZHluYW1pY1Byb3BlcnRpZXMpO1xyXG4gICAgICAgICAgICB0aGlzLnIgPSBQcm9wZXJ0eUZhY3RvcnkuZ2V0UHJvcChlbGVtLGRhdGEuciwwLDAsdGhpcy5keW5hbWljUHJvcGVydGllcyk7XHJcbiAgICAgICAgICAgIGlmKHRoaXMuZHluYW1pY1Byb3BlcnRpZXMubGVuZ3RoKXtcclxuICAgICAgICAgICAgICAgIHRoaXMuayA9IHRydWU7XHJcbiAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jb252ZXJ0UmVjdFRvUGF0aCgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfSgpKTtcclxuXHJcbiAgICBmdW5jdGlvbiBnZXRTaGFwZVByb3AoZWxlbSxkYXRhLHR5cGUsIGFycil7XHJcbiAgICAgICAgdmFyIHByb3A7XHJcbiAgICAgICAgaWYodHlwZSA9PT0gMyB8fCB0eXBlID09PSA0KXtcclxuICAgICAgICAgICAgdmFyIGRhdGFQcm9wID0gdHlwZSA9PT0gMyA/IGRhdGEucHQgOiBkYXRhLmtzO1xyXG4gICAgICAgICAgICB2YXIga2V5cyA9IGRhdGFQcm9wLms7XHJcbiAgICAgICAgICAgIGlmKGRhdGFQcm9wLmEgPT09IDEgfHwga2V5cy5sZW5ndGgpe1xyXG4gICAgICAgICAgICAgICAgcHJvcCA9IG5ldyBLZXlmcmFtZWRTaGFwZVByb3BlcnR5KGVsZW0sIGRhdGEsIHR5cGUpO1xyXG4gICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgIHByb3AgPSBuZXcgU2hhcGVQcm9wZXJ0eShlbGVtLCBkYXRhLCB0eXBlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1lbHNlIGlmKHR5cGUgPT09IDUpe1xyXG4gICAgICAgICAgICBwcm9wID0gbmV3IFJlY3RTaGFwZVByb3BlcnR5KGVsZW0sIGRhdGEpO1xyXG4gICAgICAgIH1lbHNlIGlmKHR5cGUgPT09IDYpe1xyXG4gICAgICAgICAgICBwcm9wID0gbmV3IEVsbFNoYXBlUHJvcGVydHkoZWxlbSwgZGF0YSk7XHJcbiAgICAgICAgfWVsc2UgaWYodHlwZSA9PT0gNyl7XHJcbiAgICAgICAgICAgIHByb3AgPSBuZXcgU3RhclNoYXBlUHJvcGVydHkoZWxlbSwgZGF0YSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmKHByb3Auayl7XHJcbiAgICAgICAgICAgIGFyci5wdXNoKHByb3ApO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcHJvcDtcclxuICAgIH1cclxuXHJcbiAgICB2YXIgb2IgPSB7fTtcclxuICAgIG9iLmdldFNoYXBlUHJvcCA9IGdldFNoYXBlUHJvcDtcclxuICAgIHJldHVybiBvYjtcclxufSgpKTtcbnZhciBTaGFwZU1vZGlmaWVycyA9IChmdW5jdGlvbigpe1xyXG4gICAgdmFyIG9iID0ge307XHJcbiAgICB2YXIgbW9kaWZpZXJzID0ge307XHJcbiAgICBvYi5yZWdpc3Rlck1vZGlmaWVyID0gcmVnaXN0ZXJNb2RpZmllcjtcclxuICAgIG9iLmdldE1vZGlmaWVyID0gZ2V0TW9kaWZpZXI7XHJcblxyXG4gICAgZnVuY3Rpb24gcmVnaXN0ZXJNb2RpZmllcihubSxmYWN0b3J5KXtcclxuICAgICAgICBpZighbW9kaWZpZXJzW25tXSl7XHJcbiAgICAgICAgICAgIG1vZGlmaWVyc1tubV0gPSBmYWN0b3J5O1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBnZXRNb2RpZmllcihubSxlbGVtLCBkYXRhLCBkeW5hbWljUHJvcGVydGllcyl7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBtb2RpZmllcnNbbm1dKGVsZW0sIGRhdGEsIGR5bmFtaWNQcm9wZXJ0aWVzKTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gb2I7XHJcbn0oKSk7XHJcblxyXG5mdW5jdGlvbiBTaGFwZU1vZGlmaWVyKCl7fVxyXG5TaGFwZU1vZGlmaWVyLnByb3RvdHlwZS5pbml0TW9kaWZpZXJQcm9wZXJ0aWVzID0gZnVuY3Rpb24oKXt9O1xyXG5TaGFwZU1vZGlmaWVyLnByb3RvdHlwZS5hZGRTaGFwZVRvTW9kaWZpZXIgPSBmdW5jdGlvbigpe307XHJcblNoYXBlTW9kaWZpZXIucHJvdG90eXBlLmFkZFNoYXBlID0gZnVuY3Rpb24oZGF0YSl7XHJcbiAgICBpZighdGhpcy5jbG9zZWQpe1xyXG4gICAgICAgIHRoaXMuc2hhcGVzLnB1c2goe3NoYXBlOmRhdGEuc2gsIGRhdGE6IGRhdGEsIGxvY2FsU2hhcGVDb2xsZWN0aW9uOnNoYXBlQ29sbGVjdGlvbl9wb29sLm5ld1NoYXBlQ29sbGVjdGlvbigpfSk7XHJcbiAgICAgICAgdGhpcy5hZGRTaGFwZVRvTW9kaWZpZXIoZGF0YS5zaCk7XHJcbiAgICB9XHJcbn1cclxuU2hhcGVNb2RpZmllci5wcm90b3R5cGUuaW5pdCA9IGZ1bmN0aW9uKGVsZW0sZGF0YSxkeW5hbWljUHJvcGVydGllcyl7XHJcbiAgICB0aGlzLmVsZW0gPSBlbGVtO1xyXG4gICAgdGhpcy5mcmFtZUlkID0gLTE7XHJcbiAgICB0aGlzLnNoYXBlcyA9IFtdO1xyXG4gICAgdGhpcy5keW5hbWljUHJvcGVydGllcyA9IFtdO1xyXG4gICAgdGhpcy5tZGYgPSBmYWxzZTtcclxuICAgIHRoaXMuY2xvc2VkID0gZmFsc2U7XHJcbiAgICB0aGlzLmsgPSBmYWxzZTtcclxuICAgIHRoaXMuY29tcCA9IGVsZW0uY29tcDtcclxuICAgIHRoaXMuaW5pdE1vZGlmaWVyUHJvcGVydGllcyhlbGVtLGRhdGEpO1xyXG4gICAgaWYodGhpcy5keW5hbWljUHJvcGVydGllcy5sZW5ndGgpe1xyXG4gICAgICAgIHRoaXMuayA9IHRydWU7XHJcbiAgICAgICAgZHluYW1pY1Byb3BlcnRpZXMucHVzaCh0aGlzKTtcclxuICAgIH1lbHNle1xyXG4gICAgICAgIHRoaXMuZ2V0VmFsdWUodHJ1ZSk7XHJcbiAgICB9XHJcbn1cbmZ1bmN0aW9uIFRyaW1Nb2RpZmllcigpe307XHJcbmV4dGVuZFByb3RvdHlwZShTaGFwZU1vZGlmaWVyLFRyaW1Nb2RpZmllcik7XHJcblRyaW1Nb2RpZmllci5wcm90b3R5cGUucHJvY2Vzc0tleXMgPSBmdW5jdGlvbihmb3JjZVJlbmRlcil7XHJcbiAgICBpZih0aGlzLmVsZW0uZ2xvYmFsRGF0YS5mcmFtZUlkID09PSB0aGlzLmZyYW1lSWQgJiYgIWZvcmNlUmVuZGVyKXtcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICB0aGlzLm1kZiA9IGZvcmNlUmVuZGVyID8gdHJ1ZSA6IGZhbHNlO1xyXG4gICAgdGhpcy5mcmFtZUlkID0gdGhpcy5lbGVtLmdsb2JhbERhdGEuZnJhbWVJZDtcclxuICAgIHZhciBpLCBsZW4gPSB0aGlzLmR5bmFtaWNQcm9wZXJ0aWVzLmxlbmd0aDtcclxuXHJcbiAgICBmb3IoaT0wO2k8bGVuO2krPTEpe1xyXG4gICAgICAgIHRoaXMuZHluYW1pY1Byb3BlcnRpZXNbaV0uZ2V0VmFsdWUoKTtcclxuICAgICAgICBpZih0aGlzLmR5bmFtaWNQcm9wZXJ0aWVzW2ldLm1kZil7XHJcbiAgICAgICAgICAgIHRoaXMubWRmID0gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBpZih0aGlzLm1kZiB8fCBmb3JjZVJlbmRlcil7XHJcbiAgICAgICAgdmFyIG8gPSAodGhpcy5vLnYlMzYwKS8zNjA7XHJcbiAgICAgICAgaWYobyA8IDApe1xyXG4gICAgICAgICAgICBvICs9IDE7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBzID0gdGhpcy5zLnYgKyBvO1xyXG4gICAgICAgIHZhciBlID0gdGhpcy5lLnYgKyBvO1xyXG4gICAgICAgIGlmKHMgPT0gZSl7XHJcblxyXG4gICAgICAgIH1cclxuICAgICAgICBpZihzPmUpe1xyXG4gICAgICAgICAgICB2YXIgX3MgPSBzO1xyXG4gICAgICAgICAgICBzID0gZTtcclxuICAgICAgICAgICAgZSA9IF9zO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnNWYWx1ZSA9IHM7XHJcbiAgICAgICAgdGhpcy5lVmFsdWUgPSBlO1xyXG4gICAgICAgIHRoaXMub1ZhbHVlID0gbztcclxuICAgIH1cclxufVxyXG5UcmltTW9kaWZpZXIucHJvdG90eXBlLmluaXRNb2RpZmllclByb3BlcnRpZXMgPSBmdW5jdGlvbihlbGVtLGRhdGEpe1xyXG4gICAgdGhpcy5zVmFsdWUgPSAwO1xyXG4gICAgdGhpcy5lVmFsdWUgPSAwO1xyXG4gICAgdGhpcy5vVmFsdWUgPSAwO1xyXG4gICAgdGhpcy5nZXRWYWx1ZSA9IHRoaXMucHJvY2Vzc0tleXM7XHJcbiAgICB0aGlzLnMgPSBQcm9wZXJ0eUZhY3RvcnkuZ2V0UHJvcChlbGVtLGRhdGEucywwLDAuMDEsdGhpcy5keW5hbWljUHJvcGVydGllcyk7XHJcbiAgICB0aGlzLmUgPSBQcm9wZXJ0eUZhY3RvcnkuZ2V0UHJvcChlbGVtLGRhdGEuZSwwLDAuMDEsdGhpcy5keW5hbWljUHJvcGVydGllcyk7XHJcbiAgICB0aGlzLm8gPSBQcm9wZXJ0eUZhY3RvcnkuZ2V0UHJvcChlbGVtLGRhdGEubywwLDAsdGhpcy5keW5hbWljUHJvcGVydGllcyk7XHJcbiAgICB0aGlzLm0gPSBkYXRhLm07XHJcbiAgICBpZighdGhpcy5keW5hbWljUHJvcGVydGllcy5sZW5ndGgpe1xyXG4gICAgICAgIHRoaXMuZ2V0VmFsdWUodHJ1ZSk7XHJcbiAgICB9XHJcbn07XHJcblxyXG5UcmltTW9kaWZpZXIucHJvdG90eXBlLmdldFNlZ21lbnRzTGVuZ3RoID0gZnVuY3Rpb24oc2hhcGVEYXRhKXtcclxuICAgIHZhciBjbG9zZWQgPSBzaGFwZURhdGEuYztcclxuICAgIHZhciBwYXRoViA9IHNoYXBlRGF0YS52O1xyXG4gICAgdmFyIHBhdGhPID0gc2hhcGVEYXRhLm87XHJcbiAgICB2YXIgcGF0aEkgPSBzaGFwZURhdGEuaTtcclxuICAgIHZhciBpLCBsZW4gPSBzaGFwZURhdGEuX2xlbmd0aDtcclxuICAgIHZhciBsZW5ndGhzID0gW107XHJcbiAgICB2YXIgdG90YWxMZW5ndGggPSAwO1xyXG4gICAgZm9yKGk9MDtpPGxlbi0xO2krPTEpe1xyXG4gICAgICAgIGxlbmd0aHNbaV0gPSBiZXouZ2V0QmV6aWVyTGVuZ3RoKHBhdGhWW2ldLHBhdGhWW2krMV0scGF0aE9baV0scGF0aElbaSsxXSk7XHJcbiAgICAgICAgdG90YWxMZW5ndGggKz0gbGVuZ3Roc1tpXS5hZGRlZExlbmd0aDtcclxuICAgIH1cclxuICAgIGlmKGNsb3NlZCl7XHJcbiAgICAgICAgbGVuZ3Roc1tpXSA9IGJlei5nZXRCZXppZXJMZW5ndGgocGF0aFZbaV0scGF0aFZbMF0scGF0aE9baV0scGF0aElbMF0pO1xyXG4gICAgICAgIHRvdGFsTGVuZ3RoICs9IGxlbmd0aHNbaV0uYWRkZWRMZW5ndGg7XHJcbiAgICB9XHJcbiAgICByZXR1cm4ge2xlbmd0aHM6bGVuZ3Rocyx0b3RhbExlbmd0aDp0b3RhbExlbmd0aH07XHJcbn1cclxuXHJcblRyaW1Nb2RpZmllci5wcm90b3R5cGUuY2FsY3VsYXRlU2hhcGVFZGdlcyA9IGZ1bmN0aW9uKHMsIGUsIHNoYXBlTGVuZ3RoLCBhZGRlZExlbmd0aCwgdG90YWxNb2RpZmllckxlbmd0aCkge1xyXG4gICAgdmFyIHNlZ21lbnRzID0gW11cclxuICAgIGlmKGUgPD0gMSl7XHJcbiAgICAgICAgc2VnbWVudHMucHVzaCh7XHJcbiAgICAgICAgICAgIHM6IHMsXHJcbiAgICAgICAgICAgIGU6IGVcclxuICAgICAgICB9KVxyXG4gICAgfWVsc2UgaWYocyA+PSAxKXtcclxuICAgICAgICBzZWdtZW50cy5wdXNoKHtcclxuICAgICAgICAgICAgczogcyAtIDEsXHJcbiAgICAgICAgICAgIGU6IGUgLSAxXHJcbiAgICAgICAgfSlcclxuICAgIH1lbHNle1xyXG4gICAgICAgIHNlZ21lbnRzLnB1c2goe1xyXG4gICAgICAgICAgICBzOiBzLFxyXG4gICAgICAgICAgICBlOiAxXHJcbiAgICAgICAgfSlcclxuICAgICAgICBzZWdtZW50cy5wdXNoKHtcclxuICAgICAgICAgICAgczogMCxcclxuICAgICAgICAgICAgZTogZSAtIDFcclxuICAgICAgICB9KVxyXG4gICAgfVxyXG4gICAgdmFyIHNoYXBlU2VnbWVudHMgPSBbXTtcclxuICAgIHZhciBpLCBsZW4gPSBzZWdtZW50cy5sZW5ndGgsIHNlZ21lbnRPYjtcclxuICAgIGZvcihpID0gMDsgaSA8IGxlbjsgaSArPSAxKSB7XHJcbiAgICAgICAgc2VnbWVudE9iID0gc2VnbWVudHNbaV07XHJcbiAgICAgICAgaWYgKHNlZ21lbnRPYi5lICogdG90YWxNb2RpZmllckxlbmd0aCA8IGFkZGVkTGVuZ3RoIHx8IHNlZ21lbnRPYi5zICogdG90YWxNb2RpZmllckxlbmd0aCA+IGFkZGVkTGVuZ3RoICsgc2hhcGVMZW5ndGgpIHtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdmFyIHNoYXBlUywgc2hhcGVFO1xyXG4gICAgICAgICAgICBpZihzZWdtZW50T2IucyAqIHRvdGFsTW9kaWZpZXJMZW5ndGggPD0gYWRkZWRMZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIHNoYXBlUyA9IDA7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBzaGFwZVMgPSAoc2VnbWVudE9iLnMgKiB0b3RhbE1vZGlmaWVyTGVuZ3RoIC0gYWRkZWRMZW5ndGgpIC8gc2hhcGVMZW5ndGg7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYoc2VnbWVudE9iLmUgKiB0b3RhbE1vZGlmaWVyTGVuZ3RoID49IGFkZGVkTGVuZ3RoICsgc2hhcGVMZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIHNoYXBlRSA9IDE7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBzaGFwZUUgPSAoKHNlZ21lbnRPYi5lICogdG90YWxNb2RpZmllckxlbmd0aCAtIGFkZGVkTGVuZ3RoKSAvIHNoYXBlTGVuZ3RoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBzaGFwZVNlZ21lbnRzLnB1c2goW3NoYXBlUywgc2hhcGVFXSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgaWYoIXNoYXBlU2VnbWVudHMubGVuZ3RoKXtcclxuICAgICAgICBzaGFwZVNlZ21lbnRzLnB1c2goWzAsMF0pO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHNoYXBlU2VnbWVudHM7XHJcbn1cclxuXHJcblRyaW1Nb2RpZmllci5wcm90b3R5cGUucHJvY2Vzc1NoYXBlcyA9IGZ1bmN0aW9uKGZpcnN0RnJhbWUpe1xyXG4gICAgdmFyIHNoYXBlUGF0aHM7XHJcbiAgICB2YXIgaSwgbGVuID0gdGhpcy5zaGFwZXMubGVuZ3RoO1xyXG4gICAgdmFyIGosIGpMZW47XHJcbiAgICB2YXIgcyA9IHRoaXMuc1ZhbHVlO1xyXG4gICAgdmFyIGUgPSB0aGlzLmVWYWx1ZTtcclxuICAgIHZhciBwYXRoc0RhdGEscGF0aERhdGEsIHRvdGFsU2hhcGVMZW5ndGgsIHRvdGFsTW9kaWZpZXJMZW5ndGggPSAwO1xyXG5cclxuICAgIGlmKGUgPT09IHMpe1xyXG4gICAgICAgIGZvcihpPTA7aTxsZW47aSs9MSl7XHJcbiAgICAgICAgICAgIHRoaXMuc2hhcGVzW2ldLmxvY2FsU2hhcGVDb2xsZWN0aW9uLnJlbGVhc2VTaGFwZXMoKTtcclxuICAgICAgICAgICAgdGhpcy5zaGFwZXNbaV0uc2hhcGUubWRmID0gdHJ1ZTtcclxuICAgICAgICAgICAgdGhpcy5zaGFwZXNbaV0uc2hhcGUucGF0aHMgPSB0aGlzLnNoYXBlc1tpXS5sb2NhbFNoYXBlQ29sbGVjdGlvbjtcclxuICAgICAgICB9XHJcbiAgICB9IGVsc2UgaWYoISgoZSA9PT0gMSAmJiBzID09PSAwKSB8fCAoZT09PTAgJiYgcyA9PT0gMSkpKXtcclxuICAgICAgICB2YXIgc2VnbWVudHMgPSBbXSwgc2hhcGVEYXRhLCBsb2NhbFNoYXBlQ29sbGVjdGlvbjtcclxuICAgICAgICBmb3IoaT0wO2k8bGVuO2krPTEpe1xyXG4gICAgICAgICAgICBzaGFwZURhdGEgPSB0aGlzLnNoYXBlc1tpXTtcclxuICAgICAgICAgICAgaWYoIXNoYXBlRGF0YS5zaGFwZS5tZGYgJiYgIXRoaXMubWRmICYmICFmaXJzdEZyYW1lICYmIHRoaXMubSAhPT0gMil7XHJcbiAgICAgICAgICAgICAgICBzaGFwZURhdGEuc2hhcGUucGF0aHMgPSBzaGFwZURhdGEubG9jYWxTaGFwZUNvbGxlY3Rpb247XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBzaGFwZVBhdGhzID0gc2hhcGVEYXRhLnNoYXBlLnBhdGhzO1xyXG4gICAgICAgICAgICAgICAgakxlbiA9IHNoYXBlUGF0aHMuX2xlbmd0aDtcclxuICAgICAgICAgICAgICAgIHRvdGFsU2hhcGVMZW5ndGggPSAwO1xyXG4gICAgICAgICAgICAgICAgaWYoIXNoYXBlRGF0YS5zaGFwZS5tZGYgJiYgc2hhcGVEYXRhLnBhdGhzRGF0YSl7XHJcbiAgICAgICAgICAgICAgICAgICAgdG90YWxTaGFwZUxlbmd0aCA9IHNoYXBlRGF0YS50b3RhbFNoYXBlTGVuZ3RoO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBwYXRoc0RhdGEgPSBbXTtcclxuICAgICAgICAgICAgICAgICAgICBmb3Ioaj0wO2o8akxlbjtqKz0xKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcGF0aERhdGEgPSB0aGlzLmdldFNlZ21lbnRzTGVuZ3RoKHNoYXBlUGF0aHMuc2hhcGVzW2pdKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcGF0aHNEYXRhLnB1c2gocGF0aERhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0b3RhbFNoYXBlTGVuZ3RoICs9IHBhdGhEYXRhLnRvdGFsTGVuZ3RoO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBzaGFwZURhdGEudG90YWxTaGFwZUxlbmd0aCA9IHRvdGFsU2hhcGVMZW5ndGg7XHJcbiAgICAgICAgICAgICAgICAgICAgc2hhcGVEYXRhLnBhdGhzRGF0YSA9IHBhdGhzRGF0YTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICB0b3RhbE1vZGlmaWVyTGVuZ3RoICs9IHRvdGFsU2hhcGVMZW5ndGg7XHJcbiAgICAgICAgICAgICAgICBzaGFwZURhdGEuc2hhcGUubWRmID0gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgc2hhcGVTID0gcywgc2hhcGVFID0gZSwgYWRkZWRMZW5ndGggPSAwO1xyXG4gICAgICAgIHZhciBqLCBqTGVuO1xyXG4gICAgICAgIGZvcihpID0gbGVuIC0gMTsgaSA+PSAwOyBpIC09IDEpe1xyXG4gICAgICAgICAgICBzaGFwZURhdGEgPSB0aGlzLnNoYXBlc1tpXTtcclxuICAgICAgICAgICAgaWYgKHNoYXBlRGF0YS5zaGFwZS5tZGYpIHtcclxuICAgICAgICAgICAgICAgIGxvY2FsU2hhcGVDb2xsZWN0aW9uID0gc2hhcGVEYXRhLmxvY2FsU2hhcGVDb2xsZWN0aW9uO1xyXG4gICAgICAgICAgICAgICAgbG9jYWxTaGFwZUNvbGxlY3Rpb24ucmVsZWFzZVNoYXBlcygpO1xyXG4gICAgICAgICAgICAgICAgaWYodGhpcy5tID09PSAyICYmIGxlbiA+IDEpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgZWRnZXMgPSB0aGlzLmNhbGN1bGF0ZVNoYXBlRWRnZXMocywgZSwgc2hhcGVEYXRhLnRvdGFsU2hhcGVMZW5ndGgsIGFkZGVkTGVuZ3RoLCB0b3RhbE1vZGlmaWVyTGVuZ3RoKTtcclxuICAgICAgICAgICAgICAgICAgICBhZGRlZExlbmd0aCArPSBzaGFwZURhdGEudG90YWxTaGFwZUxlbmd0aDtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZWRnZXMgPSBbW3NoYXBlUywgc2hhcGVFXV1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGpMZW4gPSBlZGdlcy5sZW5ndGg7XHJcbiAgICAgICAgICAgICAgICBmb3IgKGogPSAwOyBqIDwgakxlbjsgaiArPSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2hhcGVTID0gZWRnZXNbal1bMF07XHJcbiAgICAgICAgICAgICAgICAgICAgc2hhcGVFID0gZWRnZXNbal1bMV07XHJcbiAgICAgICAgICAgICAgICAgICAgc2VnbWVudHMubGVuZ3RoID0gMDtcclxuICAgICAgICAgICAgICAgICAgICBpZihzaGFwZUUgPD0gMSl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlZ21lbnRzLnB1c2goe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgczpzaGFwZURhdGEudG90YWxTaGFwZUxlbmd0aCAqIHNoYXBlUyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGU6c2hhcGVEYXRhLnRvdGFsU2hhcGVMZW5ndGggKiBzaGFwZUVcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICB9ZWxzZSBpZihzaGFwZVMgPj0gMSl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlZ21lbnRzLnB1c2goe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgczpzaGFwZURhdGEudG90YWxTaGFwZUxlbmd0aCAqIChzaGFwZVMgLSAxKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGU6c2hhcGVEYXRhLnRvdGFsU2hhcGVMZW5ndGggKiAoc2hhcGVFIC0gMSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2VnbWVudHMucHVzaCh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzOnNoYXBlRGF0YS50b3RhbFNoYXBlTGVuZ3RoICogc2hhcGVTLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZTpzaGFwZURhdGEudG90YWxTaGFwZUxlbmd0aFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZWdtZW50cy5wdXNoKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHM6MCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGU6c2hhcGVEYXRhLnRvdGFsU2hhcGVMZW5ndGgqKHNoYXBlRSAtIDEpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBuZXdTaGFwZXNEYXRhID0gdGhpcy5hZGRTaGFwZXMoc2hhcGVEYXRhLHNlZ21lbnRzWzBdKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoc2VnbWVudHNbMF0ucyAhPT0gc2VnbWVudHNbMF0uZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgbGFzdFBvcztcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYoc2VnbWVudHMubGVuZ3RoID4gMSl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihzaGFwZURhdGEuc2hhcGUudi5jKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbGFzdFNoYXBlID0gbmV3U2hhcGVzRGF0YS5wb3AoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFkZFBhdGhzKG5ld1NoYXBlc0RhdGEsIGxvY2FsU2hhcGVDb2xsZWN0aW9uKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXdTaGFwZXNEYXRhID0gdGhpcy5hZGRTaGFwZXMoc2hhcGVEYXRhLHNlZ21lbnRzWzFdLCBsYXN0U2hhcGUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFkZFBhdGhzKG5ld1NoYXBlc0RhdGEsIGxvY2FsU2hhcGVDb2xsZWN0aW9uKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXdTaGFwZXNEYXRhID0gdGhpcy5hZGRTaGFwZXMoc2hhcGVEYXRhLHNlZ21lbnRzWzFdKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hZGRQYXRocyhuZXdTaGFwZXNEYXRhLCBsb2NhbFNoYXBlQ29sbGVjdGlvbik7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgc2hhcGVEYXRhLnNoYXBlLnBhdGhzID0gbG9jYWxTaGFwZUNvbGxlY3Rpb247XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9IGVsc2UgaWYodGhpcy5tZGYpe1xyXG4gICAgICAgIGZvcihpPTA7aTxsZW47aSs9MSl7XHJcbiAgICAgICAgICAgIHRoaXMuc2hhcGVzW2ldLnNoYXBlLm1kZiA9IHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgaWYoIXRoaXMuZHluYW1pY1Byb3BlcnRpZXMubGVuZ3RoKXtcclxuICAgICAgICB0aGlzLm1kZiA9IGZhbHNlO1xyXG4gICAgfVxyXG59XHJcblxyXG5UcmltTW9kaWZpZXIucHJvdG90eXBlLmFkZFBhdGhzID0gZnVuY3Rpb24obmV3UGF0aHMsIGxvY2FsU2hhcGVDb2xsZWN0aW9uKSB7XHJcbiAgICB2YXIgaSwgbGVuID0gbmV3UGF0aHMubGVuZ3RoO1xyXG4gICAgZm9yKGkgPSAwOyBpIDwgbGVuOyBpICs9IDEpIHtcclxuICAgICAgICBsb2NhbFNoYXBlQ29sbGVjdGlvbi5hZGRTaGFwZShuZXdQYXRoc1tpXSlcclxuICAgIH1cclxufVxyXG5cclxuVHJpbU1vZGlmaWVyLnByb3RvdHlwZS5hZGRTZWdtZW50ID0gZnVuY3Rpb24ocHQxLHB0MixwdDMscHQ0LHNoYXBlUGF0aCxwb3MsIG5ld1NoYXBlKSB7XHJcbiAgICAvKmNvbnNvbGUubG9nKHB0MSwgJ3ZlcnRleDogdiwgYXQ6ICcsIHBvcyk7XHJcbiAgICBjb25zb2xlLmxvZyhwdDIsICd2ZXJ0ZXg6IG8sIGF0OiAnLCBwb3MpO1xyXG4gICAgY29uc29sZS5sb2cocHQzLCAndmVydGV4OiBpLCBhdDogJywgcG9zICsgMSk7XHJcbiAgICBjb25zb2xlLmxvZyhwdDQsICd2ZXJ0ZXg6IHYsIGF0OiAnLCBwb3MgKyAxKTtcclxuICAgIGNvbnNvbGUubG9nKCduZXdTaGFwZTogJywgbmV3U2hhcGUpOyovXHJcbiAgICBzaGFwZVBhdGguc2V0WFlBdChwdDJbMF0scHQyWzFdLCdvJyxwb3MpO1xyXG4gICAgc2hhcGVQYXRoLnNldFhZQXQocHQzWzBdLHB0M1sxXSwnaScscG9zICsgMSk7XHJcbiAgICBpZihuZXdTaGFwZSl7XHJcbiAgICAgICAgc2hhcGVQYXRoLnNldFhZQXQocHQxWzBdLHB0MVsxXSwndicscG9zKTtcclxuICAgIH1cclxuICAgIHNoYXBlUGF0aC5zZXRYWUF0KHB0NFswXSxwdDRbMV0sJ3YnLHBvcyArIDEpO1xyXG59XHJcblxyXG5UcmltTW9kaWZpZXIucHJvdG90eXBlLmFkZFNoYXBlcyA9IGZ1bmN0aW9uKHNoYXBlRGF0YSwgc2hhcGVTZWdtZW50LCBzaGFwZVBhdGgpe1xyXG4gICAgdmFyIHBhdGhzRGF0YSA9IHNoYXBlRGF0YS5wYXRoc0RhdGE7XHJcbiAgICB2YXIgc2hhcGVQYXRocyA9IHNoYXBlRGF0YS5zaGFwZS5wYXRocy5zaGFwZXM7XHJcbiAgICB2YXIgaSwgbGVuID0gc2hhcGVEYXRhLnNoYXBlLnBhdGhzLl9sZW5ndGgsIGosIGpMZW47XHJcbiAgICB2YXIgYWRkZWRMZW5ndGggPSAwO1xyXG4gICAgdmFyIGN1cnJlbnRMZW5ndGhEYXRhLHNlZ21lbnRDb3VudDtcclxuICAgIHZhciBsZW5ndGhzO1xyXG4gICAgdmFyIHNlZ21lbnQ7XHJcbiAgICB2YXIgc2hhcGVzID0gW107XHJcbiAgICB2YXIgaW5pdFBvcztcclxuICAgIHZhciBuZXdTaGFwZSA9IHRydWU7XHJcbiAgICBpZighc2hhcGVQYXRoKXtcclxuICAgICAgICBzaGFwZVBhdGggPSBzaGFwZV9wb29sLm5ld1NoYXBlKCk7XHJcbiAgICAgICAgc2VnbWVudENvdW50ID0gMDtcclxuICAgICAgICBpbml0UG9zID0gMDtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgc2VnbWVudENvdW50ID0gc2hhcGVQYXRoLl9sZW5ndGg7XHJcbiAgICAgICAgaW5pdFBvcyA9IHNoYXBlUGF0aC5fbGVuZ3RoO1xyXG4gICAgfVxyXG4gICAgc2hhcGVzLnB1c2goc2hhcGVQYXRoKTtcclxuICAgIGZvcihpPTA7aTxsZW47aSs9MSl7XHJcbiAgICAgICAgbGVuZ3RocyA9IHBhdGhzRGF0YVtpXS5sZW5ndGhzO1xyXG4gICAgICAgIHNoYXBlUGF0aC5jID0gc2hhcGVQYXRoc1tpXS5jO1xyXG4gICAgICAgIGpMZW4gPSBzaGFwZVBhdGhzW2ldLmMgPyBsZW5ndGhzLmxlbmd0aCA6IGxlbmd0aHMubGVuZ3RoICsgMTtcclxuICAgICAgICBmb3Ioaj0xO2o8akxlbjtqKz0xKXtcclxuICAgICAgICAgICAgY3VycmVudExlbmd0aERhdGEgPSBsZW5ndGhzW2otMV07XHJcbiAgICAgICAgICAgIGlmKGFkZGVkTGVuZ3RoICsgY3VycmVudExlbmd0aERhdGEuYWRkZWRMZW5ndGggPCBzaGFwZVNlZ21lbnQucyl7XHJcbiAgICAgICAgICAgICAgICBhZGRlZExlbmd0aCArPSBjdXJyZW50TGVuZ3RoRGF0YS5hZGRlZExlbmd0aDtcclxuICAgICAgICAgICAgICAgIHNoYXBlUGF0aC5jID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZihhZGRlZExlbmd0aCA+IHNoYXBlU2VnbWVudC5lKXtcclxuICAgICAgICAgICAgICAgIHNoYXBlUGF0aC5jID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGlmKHNoYXBlU2VnbWVudC5zIDw9IGFkZGVkTGVuZ3RoICYmIHNoYXBlU2VnbWVudC5lID49IGFkZGVkTGVuZ3RoICsgY3VycmVudExlbmd0aERhdGEuYWRkZWRMZW5ndGgpe1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYWRkU2VnbWVudChzaGFwZVBhdGhzW2ldLnZbai0xXSxzaGFwZVBhdGhzW2ldLm9bai0xXSxzaGFwZVBhdGhzW2ldLmlbal0sc2hhcGVQYXRoc1tpXS52W2pdLHNoYXBlUGF0aCxzZWdtZW50Q291bnQsbmV3U2hhcGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIG5ld1NoYXBlID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHNlZ21lbnQgPSBiZXouZ2V0TmV3U2VnbWVudChzaGFwZVBhdGhzW2ldLnZbai0xXSxzaGFwZVBhdGhzW2ldLnZbal0sc2hhcGVQYXRoc1tpXS5vW2otMV0sc2hhcGVQYXRoc1tpXS5pW2pdLCAoc2hhcGVTZWdtZW50LnMgLSBhZGRlZExlbmd0aCkvY3VycmVudExlbmd0aERhdGEuYWRkZWRMZW5ndGgsKHNoYXBlU2VnbWVudC5lIC0gYWRkZWRMZW5ndGgpL2N1cnJlbnRMZW5ndGhEYXRhLmFkZGVkTGVuZ3RoLCBsZW5ndGhzW2otMV0pO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYWRkU2VnbWVudChzZWdtZW50LnB0MSxzZWdtZW50LnB0MyxzZWdtZW50LnB0NCxzZWdtZW50LnB0MixzaGFwZVBhdGgsc2VnbWVudENvdW50LG5ld1NoYXBlKTtcclxuICAgICAgICAgICAgICAgICAgICBuZXdTaGFwZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIHNoYXBlUGF0aC5jID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBhZGRlZExlbmd0aCArPSBjdXJyZW50TGVuZ3RoRGF0YS5hZGRlZExlbmd0aDtcclxuICAgICAgICAgICAgICAgIHNlZ21lbnRDb3VudCArPSAxO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmKHNoYXBlUGF0aHNbaV0uYyl7XHJcbiAgICAgICAgICAgIGN1cnJlbnRMZW5ndGhEYXRhID0gbGVuZ3Roc1tqLTFdO1xyXG4gICAgICAgICAgICBpZihhZGRlZExlbmd0aCA8PSBzaGFwZVNlZ21lbnQuZSl7XHJcbiAgICAgICAgICAgICAgICB2YXIgc2VnbWVudExlbmd0aCA9IGxlbmd0aHNbai0xXS5hZGRlZExlbmd0aDtcclxuICAgICAgICAgICAgICAgIGlmKHNoYXBlU2VnbWVudC5zIDw9IGFkZGVkTGVuZ3RoICYmIHNoYXBlU2VnbWVudC5lID49IGFkZGVkTGVuZ3RoICsgc2VnbWVudExlbmd0aCl7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hZGRTZWdtZW50KHNoYXBlUGF0aHNbaV0udltqLTFdLHNoYXBlUGF0aHNbaV0ub1tqLTFdLHNoYXBlUGF0aHNbaV0uaVswXSxzaGFwZVBhdGhzW2ldLnZbMF0sc2hhcGVQYXRoLHNlZ21lbnRDb3VudCxuZXdTaGFwZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgbmV3U2hhcGUgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgICAgIHNlZ21lbnQgPSBiZXouZ2V0TmV3U2VnbWVudChzaGFwZVBhdGhzW2ldLnZbai0xXSxzaGFwZVBhdGhzW2ldLnZbMF0sc2hhcGVQYXRoc1tpXS5vW2otMV0sc2hhcGVQYXRoc1tpXS5pWzBdLCAoc2hhcGVTZWdtZW50LnMgLSBhZGRlZExlbmd0aCkvc2VnbWVudExlbmd0aCwoc2hhcGVTZWdtZW50LmUgLSBhZGRlZExlbmd0aCkvc2VnbWVudExlbmd0aCwgbGVuZ3Roc1tqLTFdKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmFkZFNlZ21lbnQoc2VnbWVudC5wdDEsc2VnbWVudC5wdDMsc2VnbWVudC5wdDQsc2VnbWVudC5wdDIsc2hhcGVQYXRoLHNlZ21lbnRDb3VudCxuZXdTaGFwZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgbmV3U2hhcGUgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICBzaGFwZVBhdGguYyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgc2hhcGVQYXRoLmMgPSBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBhZGRlZExlbmd0aCArPSBjdXJyZW50TGVuZ3RoRGF0YS5hZGRlZExlbmd0aDtcclxuICAgICAgICAgICAgc2VnbWVudENvdW50ICs9IDE7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmKHNoYXBlUGF0aC5fbGVuZ3RoKXtcclxuICAgICAgICAgICAgc2hhcGVQYXRoLnNldFhZQXQoc2hhcGVQYXRoLnZbaW5pdFBvc11bMF0sc2hhcGVQYXRoLnZbaW5pdFBvc11bMV0sJ2knLGluaXRQb3MpO1xyXG4gICAgICAgICAgICBzaGFwZVBhdGguc2V0WFlBdChzaGFwZVBhdGgudltzaGFwZVBhdGguX2xlbmd0aCAtIDFdWzBdLHNoYXBlUGF0aC52W3NoYXBlUGF0aC5fbGVuZ3RoIC0gMV1bMV0sJ28nLHNoYXBlUGF0aC5fbGVuZ3RoIC0gMSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmKGFkZGVkTGVuZ3RoID4gc2hhcGVTZWdtZW50LmUpe1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYoaTxsZW4tMSl7XHJcbiAgICAgICAgICAgIHNoYXBlUGF0aCA9IHNoYXBlX3Bvb2wubmV3U2hhcGUoKTtcclxuICAgICAgICAgICAgbmV3U2hhcGUgPSB0cnVlO1xyXG4gICAgICAgICAgICBzaGFwZXMucHVzaChzaGFwZVBhdGgpO1xyXG4gICAgICAgICAgICBzZWdtZW50Q291bnQgPSAwO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiBzaGFwZXM7XHJcblxyXG59XHJcblxyXG5cclxuU2hhcGVNb2RpZmllcnMucmVnaXN0ZXJNb2RpZmllcigndG0nLFRyaW1Nb2RpZmllcik7XG5mdW5jdGlvbiBSb3VuZENvcm5lcnNNb2RpZmllcigpe307XHJcbmV4dGVuZFByb3RvdHlwZShTaGFwZU1vZGlmaWVyLFJvdW5kQ29ybmVyc01vZGlmaWVyKTtcclxuUm91bmRDb3JuZXJzTW9kaWZpZXIucHJvdG90eXBlLnByb2Nlc3NLZXlzID0gZnVuY3Rpb24oZm9yY2VSZW5kZXIpe1xyXG4gICAgaWYodGhpcy5lbGVtLmdsb2JhbERhdGEuZnJhbWVJZCA9PT0gdGhpcy5mcmFtZUlkICYmICFmb3JjZVJlbmRlcil7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgdGhpcy5tZGYgPSBmb3JjZVJlbmRlciA/IHRydWUgOiBmYWxzZTtcclxuICAgIHRoaXMuZnJhbWVJZCA9IHRoaXMuZWxlbS5nbG9iYWxEYXRhLmZyYW1lSWQ7XHJcbiAgICB2YXIgaSwgbGVuID0gdGhpcy5keW5hbWljUHJvcGVydGllcy5sZW5ndGg7XHJcblxyXG4gICAgZm9yKGk9MDtpPGxlbjtpKz0xKXtcclxuICAgICAgICB0aGlzLmR5bmFtaWNQcm9wZXJ0aWVzW2ldLmdldFZhbHVlKCk7XHJcbiAgICAgICAgaWYodGhpcy5keW5hbWljUHJvcGVydGllc1tpXS5tZGYpe1xyXG4gICAgICAgICAgICB0aGlzLm1kZiA9IHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcblJvdW5kQ29ybmVyc01vZGlmaWVyLnByb3RvdHlwZS5pbml0TW9kaWZpZXJQcm9wZXJ0aWVzID0gZnVuY3Rpb24oZWxlbSxkYXRhKXtcclxuICAgIHRoaXMuZ2V0VmFsdWUgPSB0aGlzLnByb2Nlc3NLZXlzO1xyXG4gICAgdGhpcy5yZCA9IFByb3BlcnR5RmFjdG9yeS5nZXRQcm9wKGVsZW0sZGF0YS5yLDAsbnVsbCx0aGlzLmR5bmFtaWNQcm9wZXJ0aWVzKTtcclxuICAgIGlmKCF0aGlzLmR5bmFtaWNQcm9wZXJ0aWVzLmxlbmd0aCl7XHJcbiAgICAgICAgdGhpcy5nZXRWYWx1ZSh0cnVlKTtcclxuICAgIH1cclxufTtcclxuXHJcblJvdW5kQ29ybmVyc01vZGlmaWVyLnByb3RvdHlwZS5wcm9jZXNzUGF0aCA9IGZ1bmN0aW9uKHBhdGgsIHJvdW5kKXtcclxuICAgIHZhciBjbG9uZWRfcGF0aCA9IHNoYXBlX3Bvb2wubmV3U2hhcGUoKTtcclxuICAgIGNsb25lZF9wYXRoLmMgPSBwYXRoLmM7XHJcbiAgICB2YXIgaSwgbGVuID0gcGF0aC5fbGVuZ3RoO1xyXG4gICAgdmFyIGN1cnJlbnRWLGN1cnJlbnRJLGN1cnJlbnRPLGNsb3NlclYsIG5ld1YsbmV3TyxuZXdJLGRpc3RhbmNlLG5ld1Bvc1BlcmMsaW5kZXggPSAwO1xyXG4gICAgdmFyIHZYLHZZLG9YLG9ZLGlYLGlZO1xyXG4gICAgZm9yKGk9MDtpPGxlbjtpKz0xKXtcclxuICAgICAgICBjdXJyZW50ViA9IHBhdGgudltpXTtcclxuICAgICAgICBjdXJyZW50TyA9IHBhdGgub1tpXTtcclxuICAgICAgICBjdXJyZW50SSA9IHBhdGguaVtpXTtcclxuICAgICAgICBpZihjdXJyZW50VlswXT09PWN1cnJlbnRPWzBdICYmIGN1cnJlbnRWWzFdPT09Y3VycmVudE9bMV0gJiYgY3VycmVudFZbMF09PT1jdXJyZW50SVswXSAmJiBjdXJyZW50VlsxXT09PWN1cnJlbnRJWzFdKXtcclxuICAgICAgICAgICAgaWYoKGk9PT0wIHx8IGkgPT09IGxlbiAtIDEpICYmICFwYXRoLmMpe1xyXG4gICAgICAgICAgICAgICAgY2xvbmVkX3BhdGguc2V0VHJpcGxlQXQoY3VycmVudFZbMF0sY3VycmVudFZbMV0sY3VycmVudE9bMF0sY3VycmVudE9bMV0sY3VycmVudElbMF0sY3VycmVudElbMV0saW5kZXgpO1xyXG4gICAgICAgICAgICAgICAgLypjbG9uZWRfcGF0aC52W2luZGV4XSA9IGN1cnJlbnRWO1xyXG4gICAgICAgICAgICAgICAgY2xvbmVkX3BhdGgub1tpbmRleF0gPSBjdXJyZW50TztcclxuICAgICAgICAgICAgICAgIGNsb25lZF9wYXRoLmlbaW5kZXhdID0gY3VycmVudEk7Ki9cclxuICAgICAgICAgICAgICAgIGluZGV4ICs9IDE7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBpZihpPT09MCl7XHJcbiAgICAgICAgICAgICAgICAgICAgY2xvc2VyViA9IHBhdGgudltsZW4tMV07XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGNsb3NlclYgPSBwYXRoLnZbaS0xXTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGRpc3RhbmNlID0gTWF0aC5zcXJ0KE1hdGgucG93KGN1cnJlbnRWWzBdLWNsb3NlclZbMF0sMikrTWF0aC5wb3coY3VycmVudFZbMV0tY2xvc2VyVlsxXSwyKSk7XHJcbiAgICAgICAgICAgICAgICBuZXdQb3NQZXJjID0gZGlzdGFuY2UgPyBNYXRoLm1pbihkaXN0YW5jZS8yLHJvdW5kKS9kaXN0YW5jZSA6IDA7XHJcbiAgICAgICAgICAgICAgICB2WCA9IGlYID0gY3VycmVudFZbMF0rKGNsb3NlclZbMF0tY3VycmVudFZbMF0pKm5ld1Bvc1BlcmM7XHJcbiAgICAgICAgICAgICAgICB2WSA9IGlZID0gY3VycmVudFZbMV0tKGN1cnJlbnRWWzFdLWNsb3NlclZbMV0pKm5ld1Bvc1BlcmM7XHJcbiAgICAgICAgICAgICAgICBvWCA9IHZYLSh2WC1jdXJyZW50VlswXSkqcm91bmRDb3JuZXI7XHJcbiAgICAgICAgICAgICAgICBvWSA9IHZZLSh2WS1jdXJyZW50VlsxXSkqcm91bmRDb3JuZXI7XHJcbiAgICAgICAgICAgICAgICBjbG9uZWRfcGF0aC5zZXRUcmlwbGVBdCh2WCx2WSxvWCxvWSxpWCxpWSxpbmRleCk7XHJcbiAgICAgICAgICAgICAgICAvKm5ld1YgPSBbY3VycmVudFZbMF0rKGNsb3NlclZbMF0tY3VycmVudFZbMF0pKm5ld1Bvc1BlcmMsY3VycmVudFZbMV0tKGN1cnJlbnRWWzFdLWNsb3NlclZbMV0pKm5ld1Bvc1BlcmNdO1xyXG4gICAgICAgICAgICAgICAgbmV3SSA9IG5ld1Y7XHJcbiAgICAgICAgICAgICAgICBuZXdPID0gW25ld1ZbMF0tKG5ld1ZbMF0tY3VycmVudFZbMF0pKnJvdW5kQ29ybmVyLG5ld1ZbMV0tKG5ld1ZbMV0tY3VycmVudFZbMV0pKnJvdW5kQ29ybmVyXTtcclxuICAgICAgICAgICAgICAgIGNsb25lZF9wYXRoLnZbaW5kZXhdID0gbmV3VjtcclxuICAgICAgICAgICAgICAgIGNsb25lZF9wYXRoLmlbaW5kZXhdID0gbmV3STtcclxuICAgICAgICAgICAgICAgIGNsb25lZF9wYXRoLm9baW5kZXhdID0gbmV3TzsqL1xyXG4gICAgICAgICAgICAgICAgaW5kZXggKz0gMTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZihpID09PSBsZW4gLSAxKXtcclxuICAgICAgICAgICAgICAgICAgICBjbG9zZXJWID0gcGF0aC52WzBdO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBjbG9zZXJWID0gcGF0aC52W2krMV07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBkaXN0YW5jZSA9IE1hdGguc3FydChNYXRoLnBvdyhjdXJyZW50VlswXS1jbG9zZXJWWzBdLDIpK01hdGgucG93KGN1cnJlbnRWWzFdLWNsb3NlclZbMV0sMikpO1xyXG4gICAgICAgICAgICAgICAgbmV3UG9zUGVyYyA9IGRpc3RhbmNlID8gTWF0aC5taW4oZGlzdGFuY2UvMixyb3VuZCkvZGlzdGFuY2UgOiAwO1xyXG4gICAgICAgICAgICAgICAgdlggPSBvWCA9IGN1cnJlbnRWWzBdKyhjbG9zZXJWWzBdLWN1cnJlbnRWWzBdKSpuZXdQb3NQZXJjO1xyXG4gICAgICAgICAgICAgICAgdlkgPSBvWSA9IGN1cnJlbnRWWzFdKyhjbG9zZXJWWzFdLWN1cnJlbnRWWzFdKSpuZXdQb3NQZXJjO1xyXG4gICAgICAgICAgICAgICAgaVggPSB2WC0odlgtY3VycmVudFZbMF0pKnJvdW5kQ29ybmVyO1xyXG4gICAgICAgICAgICAgICAgaVkgPSB2WS0odlktY3VycmVudFZbMV0pKnJvdW5kQ29ybmVyO1xyXG4gICAgICAgICAgICAgICAgY2xvbmVkX3BhdGguc2V0VHJpcGxlQXQodlgsdlksb1gsb1ksaVgsaVksaW5kZXgpO1xyXG5cclxuICAgICAgICAgICAgICAgIC8qbmV3ViA9IFtjdXJyZW50VlswXSsoY2xvc2VyVlswXS1jdXJyZW50VlswXSkqbmV3UG9zUGVyYyxjdXJyZW50VlsxXSsoY2xvc2VyVlsxXS1jdXJyZW50VlsxXSkqbmV3UG9zUGVyY107XHJcbiAgICAgICAgICAgICAgICBuZXdJID0gW25ld1ZbMF0tKG5ld1ZbMF0tY3VycmVudFZbMF0pKnJvdW5kQ29ybmVyLG5ld1ZbMV0tKG5ld1ZbMV0tY3VycmVudFZbMV0pKnJvdW5kQ29ybmVyXTtcclxuICAgICAgICAgICAgICAgIG5ld08gPSBuZXdWO1xyXG4gICAgICAgICAgICAgICAgY2xvbmVkX3BhdGgudltpbmRleF0gPSBuZXdWO1xyXG4gICAgICAgICAgICAgICAgY2xvbmVkX3BhdGguaVtpbmRleF0gPSBuZXdJO1xyXG4gICAgICAgICAgICAgICAgY2xvbmVkX3BhdGgub1tpbmRleF0gPSBuZXdPOyovXHJcbiAgICAgICAgICAgICAgICBpbmRleCArPSAxO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgLypjbG9uZWRfcGF0aC52W2luZGV4XSA9IHBhdGgudltpXTtcclxuICAgICAgICAgICAgY2xvbmVkX3BhdGgub1tpbmRleF0gPSBwYXRoLm9baV07XHJcbiAgICAgICAgICAgIGNsb25lZF9wYXRoLmlbaW5kZXhdID0gcGF0aC5pW2ldOyovXHJcbiAgICAgICAgICAgIGNsb25lZF9wYXRoLnNldFRyaXBsZUF0KHBhdGgudltpXVswXSxwYXRoLnZbaV1bMV0scGF0aC5vW2ldWzBdLHBhdGgub1tpXVsxXSxwYXRoLmlbaV1bMF0scGF0aC5pW2ldWzFdLGluZGV4KTtcclxuICAgICAgICAgICAgaW5kZXggKz0gMTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gY2xvbmVkX3BhdGg7XHJcbn1cclxuXHJcblJvdW5kQ29ybmVyc01vZGlmaWVyLnByb3RvdHlwZS5wcm9jZXNzU2hhcGVzID0gZnVuY3Rpb24oZmlyc3RGcmFtZSl7XHJcbiAgICB2YXIgc2hhcGVQYXRocztcclxuICAgIHZhciBpLCBsZW4gPSB0aGlzLnNoYXBlcy5sZW5ndGg7XHJcbiAgICB2YXIgaiwgakxlbjtcclxuICAgIHZhciByZCA9IHRoaXMucmQudjtcclxuXHJcbiAgICBpZihyZCAhPT0gMCl7XHJcbiAgICAgICAgdmFyIHNoYXBlRGF0YSwgbmV3UGF0aHMsIGxvY2FsU2hhcGVDb2xsZWN0aW9uO1xyXG4gICAgICAgIGZvcihpPTA7aTxsZW47aSs9MSl7XHJcbiAgICAgICAgICAgIHNoYXBlRGF0YSA9IHRoaXMuc2hhcGVzW2ldO1xyXG4gICAgICAgICAgICBuZXdQYXRocyA9IHNoYXBlRGF0YS5zaGFwZS5wYXRocztcclxuICAgICAgICAgICAgbG9jYWxTaGFwZUNvbGxlY3Rpb24gPSBzaGFwZURhdGEubG9jYWxTaGFwZUNvbGxlY3Rpb247XHJcbiAgICAgICAgICAgIGlmKCEoIXNoYXBlRGF0YS5zaGFwZS5tZGYgJiYgIXRoaXMubWRmICYmICFmaXJzdEZyYW1lKSl7XHJcbiAgICAgICAgICAgICAgICBsb2NhbFNoYXBlQ29sbGVjdGlvbi5yZWxlYXNlU2hhcGVzKCk7XHJcbiAgICAgICAgICAgICAgICBzaGFwZURhdGEuc2hhcGUubWRmID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIHNoYXBlUGF0aHMgPSBzaGFwZURhdGEuc2hhcGUucGF0aHMuc2hhcGVzO1xyXG4gICAgICAgICAgICAgICAgakxlbiA9IHNoYXBlRGF0YS5zaGFwZS5wYXRocy5fbGVuZ3RoO1xyXG4gICAgICAgICAgICAgICAgZm9yKGo9MDtqPGpMZW47ais9MSl7XHJcbiAgICAgICAgICAgICAgICAgICAgbG9jYWxTaGFwZUNvbGxlY3Rpb24uYWRkU2hhcGUodGhpcy5wcm9jZXNzUGF0aChzaGFwZVBhdGhzW2pdLHJkKSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgc2hhcGVEYXRhLnNoYXBlLnBhdGhzID0gc2hhcGVEYXRhLmxvY2FsU2hhcGVDb2xsZWN0aW9uO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICB9XHJcbiAgICBpZighdGhpcy5keW5hbWljUHJvcGVydGllcy5sZW5ndGgpe1xyXG4gICAgICAgIHRoaXMubWRmID0gZmFsc2U7XHJcbiAgICB9XHJcbn1cclxuXHJcblxyXG5TaGFwZU1vZGlmaWVycy5yZWdpc3Rlck1vZGlmaWVyKCdyZCcsUm91bmRDb3JuZXJzTW9kaWZpZXIpO1xuZnVuY3Rpb24gUmVwZWF0ZXJNb2RpZmllcigpe307XHJcblJlcGVhdGVyTW9kaWZpZXIucHJvdG90eXBlLnByb2Nlc3NLZXlzID0gZnVuY3Rpb24oZm9yY2VSZW5kZXIpe1xyXG4gICAgaWYodGhpcy5lbGVtLmdsb2JhbERhdGEuZnJhbWVJZCA9PT0gdGhpcy5mcmFtZUlkICYmICFmb3JjZVJlbmRlcil7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgdGhpcy5tZGYgPSBmb3JjZVJlbmRlciA/IHRydWUgOiBmYWxzZTtcclxuICAgIHZhciBpLCBsZW4gPSB0aGlzLmR5bmFtaWNQcm9wZXJ0aWVzLmxlbmd0aDtcclxuXHJcbiAgICBmb3IoaT0wO2k8bGVuO2krPTEpe1xyXG4gICAgICAgIHRoaXMuZHluYW1pY1Byb3BlcnRpZXNbaV0uZ2V0VmFsdWUoKTtcclxuICAgICAgICBpZih0aGlzLmR5bmFtaWNQcm9wZXJ0aWVzW2ldLm1kZil7XHJcbiAgICAgICAgICAgIHRoaXMubWRmID0gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn07XHJcblxyXG5SZXBlYXRlck1vZGlmaWVyLnByb3RvdHlwZS5pbml0TW9kaWZpZXJQcm9wZXJ0aWVzID0gZnVuY3Rpb24oZWxlbSxkYXRhKXtcclxuICAgIHRoaXMuZ2V0VmFsdWUgPSB0aGlzLnByb2Nlc3NLZXlzO1xyXG4gICAgdGhpcy5jID0gUHJvcGVydHlGYWN0b3J5LmdldFByb3AoZWxlbSxkYXRhLmMsMCxudWxsLHRoaXMuZHluYW1pY1Byb3BlcnRpZXMpO1xyXG4gICAgdGhpcy5vID0gUHJvcGVydHlGYWN0b3J5LmdldFByb3AoZWxlbSxkYXRhLm8sMCxudWxsLHRoaXMuZHluYW1pY1Byb3BlcnRpZXMpO1xyXG4gICAgdGhpcy50ciA9IFByb3BlcnR5RmFjdG9yeS5nZXRQcm9wKGVsZW0sZGF0YS50ciwyLG51bGwsdGhpcy5keW5hbWljUHJvcGVydGllcyk7XHJcbiAgICB0aGlzLmRhdGEgPSBkYXRhO1xyXG4gICAgaWYoIXRoaXMuZHluYW1pY1Byb3BlcnRpZXMubGVuZ3RoKXtcclxuICAgICAgICB0aGlzLmdldFZhbHVlKHRydWUpO1xyXG4gICAgfVxyXG4gICAgdGhpcy5wTWF0cml4ID0gbmV3IE1hdHJpeCgpO1xyXG4gICAgdGhpcy5yTWF0cml4ID0gbmV3IE1hdHJpeCgpO1xyXG4gICAgdGhpcy5zTWF0cml4ID0gbmV3IE1hdHJpeCgpO1xyXG4gICAgdGhpcy50TWF0cml4ID0gbmV3IE1hdHJpeCgpO1xyXG4gICAgdGhpcy5tYXRyaXggPSBuZXcgTWF0cml4KCk7XHJcbn07XHJcblxyXG5SZXBlYXRlck1vZGlmaWVyLnByb3RvdHlwZS5hcHBseVRyYW5zZm9ybXMgPSBmdW5jdGlvbihwTWF0cml4LCByTWF0cml4LCBzTWF0cml4LCB0cmFuc2Zvcm0sIHBlcmMsIGludil7XHJcbiAgICB2YXIgZGlyID0gaW52ID8gLTEgOiAxO1xyXG4gICAgdmFyIHNjYWxlWCA9IHRyYW5zZm9ybS5zLnZbMF0gKyAoMSAtIHRyYW5zZm9ybS5zLnZbMF0pICogKDEgLSBwZXJjKTtcclxuICAgIHZhciBzY2FsZVkgPSB0cmFuc2Zvcm0ucy52WzFdICsgKDEgLSB0cmFuc2Zvcm0ucy52WzFdKSAqICgxIC0gcGVyYyk7XHJcbiAgICBwTWF0cml4LnRyYW5zbGF0ZSh0cmFuc2Zvcm0ucC52WzBdICogZGlyICogcGVyYywgdHJhbnNmb3JtLnAudlsxXSAqIGRpciAqIHBlcmMsIHRyYW5zZm9ybS5wLnZbMl0pO1xyXG4gICAgck1hdHJpeC50cmFuc2xhdGUoLXRyYW5zZm9ybS5hLnZbMF0sIC10cmFuc2Zvcm0uYS52WzFdLCB0cmFuc2Zvcm0uYS52WzJdKTtcclxuICAgIHJNYXRyaXgucm90YXRlKC10cmFuc2Zvcm0uci52ICogZGlyICogcGVyYyk7XHJcbiAgICByTWF0cml4LnRyYW5zbGF0ZSh0cmFuc2Zvcm0uYS52WzBdLCB0cmFuc2Zvcm0uYS52WzFdLCB0cmFuc2Zvcm0uYS52WzJdKTtcclxuICAgIHNNYXRyaXgudHJhbnNsYXRlKC10cmFuc2Zvcm0uYS52WzBdLCAtdHJhbnNmb3JtLmEudlsxXSwgdHJhbnNmb3JtLmEudlsyXSk7XHJcbiAgICBzTWF0cml4LnNjYWxlKGludiA/IDEvc2NhbGVYIDogc2NhbGVYLCBpbnYgPyAxL3NjYWxlWSA6IHNjYWxlWSk7XHJcbiAgICBzTWF0cml4LnRyYW5zbGF0ZSh0cmFuc2Zvcm0uYS52WzBdLCB0cmFuc2Zvcm0uYS52WzFdLCB0cmFuc2Zvcm0uYS52WzJdKTtcclxufVxyXG5cclxuUmVwZWF0ZXJNb2RpZmllci5wcm90b3R5cGUuaW5pdCA9IGZ1bmN0aW9uKGVsZW0sIGFyciwgcG9zLCBlbGVtc0RhdGEsIGR5bmFtaWNQcm9wZXJ0aWVzKSB7XHJcbiAgICB0aGlzLmVsZW0gPSBlbGVtO1xyXG4gICAgdGhpcy5hcnIgPSBhcnI7XHJcbiAgICB0aGlzLnBvcyA9IHBvcztcclxuICAgIHRoaXMuZWxlbXNEYXRhID0gZWxlbXNEYXRhO1xyXG4gICAgdGhpcy5fY3VycmVudENvcGllcyA9IDA7XHJcbiAgICB0aGlzLl9lbGVtZW50cyA9IFtdO1xyXG4gICAgdGhpcy5fZ3JvdXBzID0gW107XHJcbiAgICB0aGlzLmR5bmFtaWNQcm9wZXJ0aWVzID0gW107XHJcbiAgICB0aGlzLmZyYW1lSWQgPSAtMTtcclxuICAgIHRoaXMuaW5pdE1vZGlmaWVyUHJvcGVydGllcyhlbGVtLGFycltwb3NdKTtcclxuICAgIHZhciBjb250ID0gMDtcclxuICAgIHdoaWxlKHBvcz4wKXtcclxuICAgICAgICBwb3MgLT0gMTtcclxuICAgICAgICAvL3RoaXMuX2VsZW1lbnRzLnVuc2hpZnQoYXJyLnNwbGljZShwb3MsMSlbMF0pO1xyXG4gICAgICAgIHRoaXMuX2VsZW1lbnRzLnVuc2hpZnQoYXJyW3Bvc10pO1xyXG4gICAgICAgIGNvbnQgKz0gMTtcclxuICAgIH1cclxuICAgIGlmKHRoaXMuZHluYW1pY1Byb3BlcnRpZXMubGVuZ3RoKXtcclxuICAgICAgICB0aGlzLmsgPSB0cnVlO1xyXG4gICAgICAgIGR5bmFtaWNQcm9wZXJ0aWVzLnB1c2godGhpcyk7XHJcbiAgICB9ZWxzZXtcclxuICAgICAgICB0aGlzLmdldFZhbHVlKHRydWUpO1xyXG4gICAgfVxyXG59XHJcblxyXG5SZXBlYXRlck1vZGlmaWVyLnByb3RvdHlwZS5yZXNldEVsZW1lbnRzID0gZnVuY3Rpb24oZWxlbWVudHMpe1xyXG4gICAgdmFyIGksIGxlbiA9IGVsZW1lbnRzLmxlbmd0aDtcclxuICAgIGZvcihpID0gMDsgaSA8IGxlbjsgaSArPSAxKSB7XHJcbiAgICAgICAgZWxlbWVudHNbaV0uX3Byb2Nlc3NlZCA9IGZhbHNlO1xyXG4gICAgICAgIGlmKGVsZW1lbnRzW2ldLnR5ID09PSAnZ3InKXtcclxuICAgICAgICAgICAgdGhpcy5yZXNldEVsZW1lbnRzKGVsZW1lbnRzW2ldLml0KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuXHJcblJlcGVhdGVyTW9kaWZpZXIucHJvdG90eXBlLmNsb25lRWxlbWVudHMgPSBmdW5jdGlvbihlbGVtZW50cyl7XHJcbiAgICB2YXIgaSwgbGVuID0gZWxlbWVudHMubGVuZ3RoO1xyXG4gICAgdmFyIG5ld0VsZW1lbnRzID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShlbGVtZW50cykpO1xyXG4gICAgdGhpcy5yZXNldEVsZW1lbnRzKG5ld0VsZW1lbnRzKTtcclxuICAgIHJldHVybiBuZXdFbGVtZW50cztcclxufVxyXG5cclxuUmVwZWF0ZXJNb2RpZmllci5wcm90b3R5cGUuY2hhbmdlR3JvdXBSZW5kZXIgPSBmdW5jdGlvbihlbGVtZW50cywgcmVuZGVyRmxhZykge1xyXG4gICAgdmFyIGksIGxlbiA9IGVsZW1lbnRzLmxlbmd0aDtcclxuICAgIGZvcihpID0gMDsgaSA8IGxlbiA7IGkgKz0gMSkge1xyXG4gICAgICAgIGVsZW1lbnRzW2ldLl9yZW5kZXIgPSByZW5kZXJGbGFnO1xyXG4gICAgICAgIGlmKGVsZW1lbnRzW2ldLnR5ID09PSAnZ3InKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY2hhbmdlR3JvdXBSZW5kZXIoZWxlbWVudHNbaV0uaXQsIHJlbmRlckZsYWcpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG5cclxuUmVwZWF0ZXJNb2RpZmllci5wcm90b3R5cGUucHJvY2Vzc1NoYXBlcyA9IGZ1bmN0aW9uKGZpcnN0RnJhbWUpe1xyXG5cclxuICAgIGlmKHRoaXMuZWxlbS5nbG9iYWxEYXRhLmZyYW1lSWQgPT09IHRoaXMuZnJhbWVJZCl7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgdGhpcy5mcmFtZUlkID0gdGhpcy5lbGVtLmdsb2JhbERhdGEuZnJhbWVJZDtcclxuICAgIGlmKCF0aGlzLmR5bmFtaWNQcm9wZXJ0aWVzLmxlbmd0aCAmJiAhZmlyc3RGcmFtZSl7XHJcbiAgICAgICAgdGhpcy5tZGYgPSBmYWxzZTtcclxuICAgIH1cclxuICAgIGlmKHRoaXMubWRmKXtcclxuICAgICAgICB2YXIgY29waWVzID0gTWF0aC5jZWlsKHRoaXMuYy52KTtcclxuICAgICAgICBpZih0aGlzLl9ncm91cHMubGVuZ3RoIDwgY29waWVzKXtcclxuICAgICAgICAgICAgd2hpbGUodGhpcy5fZ3JvdXBzLmxlbmd0aCA8IGNvcGllcyl7XHJcbiAgICAgICAgICAgICAgICB2YXIgZ3JvdXAgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaXQ6dGhpcy5jbG9uZUVsZW1lbnRzKHRoaXMuX2VsZW1lbnRzKSxcclxuICAgICAgICAgICAgICAgICAgICB0eTonZ3InXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBncm91cC5pdC5wdXNoKHtcImFcIjp7XCJhXCI6MCxcIml4XCI6MSxcImtcIjpbMCwwXX0sXCJubVwiOlwiVHJhbnNmb3JtXCIsXCJvXCI6e1wiYVwiOjAsXCJpeFwiOjcsXCJrXCI6MTAwfSxcInBcIjp7XCJhXCI6MCxcIml4XCI6MixcImtcIjpbMCwwXX0sXCJyXCI6e1wiYVwiOjAsXCJpeFwiOjYsXCJrXCI6MH0sXCJzXCI6e1wiYVwiOjAsXCJpeFwiOjMsXCJrXCI6WzEwMCwxMDBdfSxcInNhXCI6e1wiYVwiOjAsXCJpeFwiOjUsXCJrXCI6MH0sXCJza1wiOntcImFcIjowLFwiaXhcIjo0LFwia1wiOjB9LFwidHlcIjpcInRyXCJ9KTtcclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgdGhpcy5hcnIuc3BsaWNlKDAsMCxncm91cCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9ncm91cHMuc3BsaWNlKDAsMCxncm91cCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9jdXJyZW50Q29waWVzICs9IDE7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5lbGVtLnJlbG9hZFNoYXBlcygpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgaSwgY29udCA9IDAsIHJlbmRlckZsYWc7XHJcbiAgICAgICAgZm9yKGkgPSAwOyBpICA8PSB0aGlzLl9ncm91cHMubGVuZ3RoIC0gMTsgaSArPSAxKXtcclxuICAgICAgICAgICAgcmVuZGVyRmxhZyA9IGNvbnQgPCBjb3BpZXM7XHJcbiAgICAgICAgICAgIHRoaXMuX2dyb3Vwc1tpXS5fcmVuZGVyID0gcmVuZGVyRmxhZztcclxuICAgICAgICAgICAgdGhpcy5jaGFuZ2VHcm91cFJlbmRlcih0aGlzLl9ncm91cHNbaV0uaXQsIHJlbmRlckZsYWcpO1xyXG4gICAgICAgICAgICBjb250ICs9IDE7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIHRoaXMuX2N1cnJlbnRDb3BpZXMgPSBjb3BpZXM7XHJcbiAgICAgICAgdGhpcy5lbGVtLmZpcnN0RnJhbWUgPSB0cnVlO1xyXG4gICAgICAgIC8vLy9cclxuXHJcbiAgICAgICAgdmFyIG9mZnNldCA9IHRoaXMuby52O1xyXG4gICAgICAgIHZhciBvZmZzZXRNb2R1bG8gPSBvZmZzZXQlMTtcclxuICAgICAgICB2YXIgcm91bmRPZmZzZXQgPSBvZmZzZXQgPiAwID8gTWF0aC5mbG9vcihvZmZzZXQpIDogTWF0aC5jZWlsKG9mZnNldCk7XHJcbiAgICAgICAgdmFyIGs7XHJcbiAgICAgICAgdmFyIHRNYXQgPSB0aGlzLnRyLnYucHJvcHM7XHJcbiAgICAgICAgdmFyIHBQcm9wcyA9IHRoaXMucE1hdHJpeC5wcm9wcztcclxuICAgICAgICB2YXIgclByb3BzID0gdGhpcy5yTWF0cml4LnByb3BzO1xyXG4gICAgICAgIHZhciBzUHJvcHMgPSB0aGlzLnNNYXRyaXgucHJvcHM7XHJcbiAgICAgICAgdGhpcy5wTWF0cml4LnJlc2V0KCk7XHJcbiAgICAgICAgdGhpcy5yTWF0cml4LnJlc2V0KCk7XHJcbiAgICAgICAgdGhpcy5zTWF0cml4LnJlc2V0KCk7XHJcbiAgICAgICAgdGhpcy50TWF0cml4LnJlc2V0KCk7XHJcbiAgICAgICAgdGhpcy5tYXRyaXgucmVzZXQoKTtcclxuICAgICAgICB2YXIgaXRlcmF0aW9uID0gMDtcclxuXHJcbiAgICAgICAgaWYob2Zmc2V0ID4gMCkge1xyXG4gICAgICAgICAgICB3aGlsZShpdGVyYXRpb248cm91bmRPZmZzZXQpe1xyXG4gICAgICAgICAgICAgICAgdGhpcy5hcHBseVRyYW5zZm9ybXModGhpcy5wTWF0cml4LCB0aGlzLnJNYXRyaXgsIHRoaXMuc01hdHJpeCwgdGhpcy50ciwgMSwgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgaXRlcmF0aW9uICs9IDE7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYob2Zmc2V0TW9kdWxvKXtcclxuICAgICAgICAgICAgICAgIHRoaXMuYXBwbHlUcmFuc2Zvcm1zKHRoaXMucE1hdHJpeCwgdGhpcy5yTWF0cml4LCB0aGlzLnNNYXRyaXgsIHRoaXMudHIsIG9mZnNldE1vZHVsbywgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgaXRlcmF0aW9uICs9IG9mZnNldE1vZHVsbztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSBpZihvZmZzZXQgPCAwKSB7XHJcbiAgICAgICAgICAgIHdoaWxlKGl0ZXJhdGlvbj5yb3VuZE9mZnNldCl7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmFwcGx5VHJhbnNmb3Jtcyh0aGlzLnBNYXRyaXgsIHRoaXMuck1hdHJpeCwgdGhpcy5zTWF0cml4LCB0aGlzLnRyLCAxLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgIGl0ZXJhdGlvbiAtPSAxO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmKG9mZnNldE1vZHVsbyl7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmFwcGx5VHJhbnNmb3Jtcyh0aGlzLnBNYXRyaXgsIHRoaXMuck1hdHJpeCwgdGhpcy5zTWF0cml4LCB0aGlzLnRyLCAtIG9mZnNldE1vZHVsbywgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICBpdGVyYXRpb24gLT0gb2Zmc2V0TW9kdWxvO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGkgPSB0aGlzLmRhdGEubSA9PT0gMSA/IDAgOiB0aGlzLl9jdXJyZW50Q29waWVzIC0gMTtcclxuICAgICAgICB2YXIgZGlyID0gdGhpcy5kYXRhLm0gPT09IDEgPyAxIDogLTE7XHJcbiAgICAgICAgY29udCA9IHRoaXMuX2N1cnJlbnRDb3BpZXM7XHJcbiAgICAgICAgd2hpbGUoY29udCl7XHJcbiAgICAgICAgICAgIGlmKGl0ZXJhdGlvbiAhPT0gMCl7XHJcbiAgICAgICAgICAgICAgICBpZigoaSAhPT0gMCAmJiBkaXIgPT09IDEpIHx8IChpICE9PSB0aGlzLl9jdXJyZW50Q29waWVzIC0gMSAmJiBkaXIgPT09IC0xKSl7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hcHBseVRyYW5zZm9ybXModGhpcy5wTWF0cml4LCB0aGlzLnJNYXRyaXgsIHRoaXMuc01hdHJpeCwgdGhpcy50ciwgMSwgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgdGhpcy5tYXRyaXgudHJhbnNmb3JtKHJQcm9wc1swXSxyUHJvcHNbMV0sclByb3BzWzJdLHJQcm9wc1szXSxyUHJvcHNbNF0sclByb3BzWzVdLHJQcm9wc1s2XSxyUHJvcHNbN10sclByb3BzWzhdLHJQcm9wc1s5XSxyUHJvcHNbMTBdLHJQcm9wc1sxMV0sclByb3BzWzEyXSxyUHJvcHNbMTNdLHJQcm9wc1sxNF0sclByb3BzWzE1XSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLm1hdHJpeC50cmFuc2Zvcm0oc1Byb3BzWzBdLHNQcm9wc1sxXSxzUHJvcHNbMl0sc1Byb3BzWzNdLHNQcm9wc1s0XSxzUHJvcHNbNV0sc1Byb3BzWzZdLHNQcm9wc1s3XSxzUHJvcHNbOF0sc1Byb3BzWzldLHNQcm9wc1sxMF0sc1Byb3BzWzExXSxzUHJvcHNbMTJdLHNQcm9wc1sxM10sc1Byb3BzWzE0XSxzUHJvcHNbMTVdKTtcclxuICAgICAgICAgICAgICAgIHRoaXMubWF0cml4LnRyYW5zZm9ybShwUHJvcHNbMF0scFByb3BzWzFdLHBQcm9wc1syXSxwUHJvcHNbM10scFByb3BzWzRdLHBQcm9wc1s1XSxwUHJvcHNbNl0scFByb3BzWzddLHBQcm9wc1s4XSxwUHJvcHNbOV0scFByb3BzWzEwXSxwUHJvcHNbMTFdLHBQcm9wc1sxMl0scFByb3BzWzEzXSxwUHJvcHNbMTRdLHBQcm9wc1sxNV0pO1xyXG4gICAgICAgICAgICAgICAgdmFyIGl0ZW1zID0gdGhpcy5lbGVtc0RhdGFbaV0uaXQ7XHJcbiAgICAgICAgICAgICAgICB2YXIgaXRlbXNUcmFuc2Zvcm0gPSBpdGVtc1tpdGVtcy5sZW5ndGggLSAxXS50cmFuc2Zvcm0ubVByb3BzLnYucHJvcHM7XHJcbiAgICAgICAgICAgICAgICB2YXIgaiwgakxlbiA9IGl0ZW1zVHJhbnNmb3JtLmxlbmd0aDtcclxuICAgICAgICAgICAgICAgIGZvcihqPTA7ajxqTGVuO2orPTEpIHtcclxuICAgICAgICAgICAgICAgICAgICBpdGVtc1RyYW5zZm9ybVtqXSA9IHRoaXMubWF0cml4LnByb3BzW2pdO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgdGhpcy5tYXRyaXgucmVzZXQoKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMubWF0cml4LnJlc2V0KCk7XHJcbiAgICAgICAgICAgICAgICB2YXIgaXRlbXMgPSB0aGlzLmVsZW1zRGF0YVtpXS5pdDtcclxuICAgICAgICAgICAgICAgIHZhciBpdGVtc1RyYW5zZm9ybSA9IGl0ZW1zW2l0ZW1zLmxlbmd0aCAtIDFdLnRyYW5zZm9ybS5tUHJvcHMudi5wcm9wcztcclxuICAgICAgICAgICAgICAgIHZhciBqLCBqTGVuID0gaXRlbXNUcmFuc2Zvcm0ubGVuZ3RoO1xyXG4gICAgICAgICAgICAgICAgZm9yKGo9MDtqPGpMZW47ais9MSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGl0ZW1zVHJhbnNmb3JtW2pdID0gdGhpcy5tYXRyaXgucHJvcHNbal07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaXRlcmF0aW9uICs9IDE7XHJcbiAgICAgICAgICAgIGNvbnQgLT0gMTtcclxuICAgICAgICAgICAgaSArPSBkaXI7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcblxyXG5SZXBlYXRlck1vZGlmaWVyLnByb3RvdHlwZS5hZGRTaGFwZSA9IGZ1bmN0aW9uKCl7fVxyXG5cclxuU2hhcGVNb2RpZmllcnMucmVnaXN0ZXJNb2RpZmllcigncnAnLFJlcGVhdGVyTW9kaWZpZXIpO1xuZnVuY3Rpb24gU2hhcGVDb2xsZWN0aW9uKCl7XHJcblx0dGhpcy5fbGVuZ3RoID0gMDtcclxuXHR0aGlzLl9tYXhMZW5ndGggPSA0O1xyXG5cdHRoaXMuc2hhcGVzID0gQXJyYXkuYXBwbHkobnVsbCx7bGVuZ3RoOnRoaXMuX21heExlbmd0aH0pO1xyXG59O1xyXG5cclxuU2hhcGVDb2xsZWN0aW9uLnByb3RvdHlwZS5hZGRTaGFwZSA9IGZ1bmN0aW9uKHNoYXBlRGF0YSl7XHJcblx0aWYodGhpcy5fbGVuZ3RoID09PSB0aGlzLl9tYXhMZW5ndGgpe1xyXG5cdFx0dGhpcy5zaGFwZXMgPSB0aGlzLnNoYXBlcy5jb25jYXQoQXJyYXkuYXBwbHkobnVsbCx7bGVuZ3RoOnRoaXMuX21heExlbmd0aH0pKTtcclxuXHRcdHRoaXMuX21heExlbmd0aCAqPSAyO1xyXG5cdH1cclxuXHR0aGlzLnNoYXBlc1t0aGlzLl9sZW5ndGhdID0gc2hhcGVEYXRhO1xyXG5cdHRoaXMuX2xlbmd0aCArPSAxO1xyXG59O1xyXG5cclxuU2hhcGVDb2xsZWN0aW9uLnByb3RvdHlwZS5yZWxlYXNlU2hhcGVzID0gZnVuY3Rpb24oKXtcclxuXHR2YXIgaTtcclxuXHRmb3IoaSA9IDA7IGkgPCB0aGlzLl9sZW5ndGg7IGkgKz0gMSkge1xyXG5cdFx0c2hhcGVfcG9vbC5yZWxlYXNlKHRoaXMuc2hhcGVzW2ldKTtcclxuXHR9XHJcblx0dGhpcy5fbGVuZ3RoID0gMDtcclxufTtcbnZhciBJbWFnZVByZWxvYWRlciA9IChmdW5jdGlvbigpe1xyXG5cclxuICAgIGZ1bmN0aW9uIGltYWdlTG9hZGVkKCl7XHJcbiAgICAgICAgdGhpcy5sb2FkZWRBc3NldHMgKz0gMTtcclxuICAgICAgICBpZih0aGlzLmxvYWRlZEFzc2V0cyA9PT0gdGhpcy50b3RhbEltYWdlcyl7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIGdldEFzc2V0c1BhdGgoYXNzZXREYXRhKXtcclxuICAgICAgICB2YXIgcGF0aCA9ICcnO1xyXG4gICAgICAgIGlmKHRoaXMuYXNzZXRzUGF0aCl7XHJcbiAgICAgICAgICAgIHZhciBpbWFnZVBhdGggPSBhc3NldERhdGEucDtcclxuICAgICAgICAgICAgaWYoaW1hZ2VQYXRoLmluZGV4T2YoJ2ltYWdlcy8nKSAhPT0gLTEpe1xyXG4gICAgICAgICAgICAgICAgaW1hZ2VQYXRoID0gaW1hZ2VQYXRoLnNwbGl0KCcvJylbMV07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcGF0aCA9IHRoaXMuYXNzZXRzUGF0aCArIGltYWdlUGF0aDtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBwYXRoID0gdGhpcy5wYXRoO1xyXG4gICAgICAgICAgICBwYXRoICs9IGFzc2V0RGF0YS51ID8gYXNzZXREYXRhLnUgOiAnJztcclxuICAgICAgICAgICAgcGF0aCArPSBhc3NldERhdGEucDtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHBhdGg7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gbG9hZEltYWdlKHBhdGgpe1xyXG4gICAgICAgIHZhciBpbWcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbWcnKTtcclxuICAgICAgICBpbWcuYWRkRXZlbnRMaXN0ZW5lcignbG9hZCcsIGltYWdlTG9hZGVkLmJpbmQodGhpcyksIGZhbHNlKTtcclxuICAgICAgICBpbWcuYWRkRXZlbnRMaXN0ZW5lcignZXJyb3InLCBpbWFnZUxvYWRlZC5iaW5kKHRoaXMpLCBmYWxzZSk7XHJcbiAgICAgICAgaW1nLnNyYyA9IHBhdGg7XHJcbiAgICB9XHJcbiAgICBmdW5jdGlvbiBsb2FkQXNzZXRzKGFzc2V0cyl7XHJcbiAgICAgICAgdGhpcy50b3RhbEFzc2V0cyA9IGFzc2V0cy5sZW5ndGg7XHJcbiAgICAgICAgdmFyIGk7XHJcbiAgICAgICAgZm9yKGk9MDtpPHRoaXMudG90YWxBc3NldHM7aSs9MSl7XHJcbiAgICAgICAgICAgIGlmKCFhc3NldHNbaV0ubGF5ZXJzKXtcclxuICAgICAgICAgICAgICAgIGxvYWRJbWFnZS5iaW5kKHRoaXMpKGdldEFzc2V0c1BhdGguYmluZCh0aGlzKShhc3NldHNbaV0pKTtcclxuICAgICAgICAgICAgICAgIHRoaXMudG90YWxJbWFnZXMgKz0gMTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBzZXRQYXRoKHBhdGgpe1xyXG4gICAgICAgIHRoaXMucGF0aCA9IHBhdGggfHwgJyc7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gc2V0QXNzZXRzUGF0aChwYXRoKXtcclxuICAgICAgICB0aGlzLmFzc2V0c1BhdGggPSBwYXRoIHx8ICcnO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBmdW5jdGlvbiBJbWFnZVByZWxvYWRlcigpe1xyXG4gICAgICAgIHRoaXMubG9hZEFzc2V0cyA9IGxvYWRBc3NldHM7XHJcbiAgICAgICAgdGhpcy5zZXRBc3NldHNQYXRoID0gc2V0QXNzZXRzUGF0aDtcclxuICAgICAgICB0aGlzLnNldFBhdGggPSBzZXRQYXRoO1xyXG4gICAgICAgIHRoaXMuYXNzZXRzUGF0aCA9ICcnO1xyXG4gICAgICAgIHRoaXMucGF0aCA9ICcnO1xyXG4gICAgICAgIHRoaXMudG90YWxBc3NldHMgPSAwO1xyXG4gICAgICAgIHRoaXMudG90YWxJbWFnZXMgPSAwO1xyXG4gICAgICAgIHRoaXMubG9hZGVkQXNzZXRzID0gMDtcclxuICAgIH1cclxufSgpKTtcbnZhciBmZWF0dXJlU3VwcG9ydCA9IChmdW5jdGlvbigpe1xyXG5cdHZhciBvYiA9IHtcclxuXHRcdG1hc2tUeXBlOiB0cnVlXHJcblx0fVxyXG5cdGlmICgvTVNJRSAxMC9pLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCkgfHwgL01TSUUgOS9pLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCkgfHwgL3J2OjExLjAvaS50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpIHx8IC9FZGdlXFwvXFxkLi9pLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCkpIHtcclxuXHQgICBvYi5tYXNrVHlwZSA9IGZhbHNlO1xyXG5cdH1cclxuXHRyZXR1cm4gb2I7XHJcbn0oKSk7XG52YXIgZmlsdGVyc0ZhY3RvcnkgPSAoZnVuY3Rpb24oKXtcclxuXHR2YXIgb2IgPSB7fTtcclxuXHRvYi5jcmVhdGVGaWx0ZXIgPSBjcmVhdGVGaWx0ZXI7XHJcblx0b2IuY3JlYXRlQWxwaGFUb0x1bWluYW5jZUZpbHRlciA9IGNyZWF0ZUFscGhhVG9MdW1pbmFuY2VGaWx0ZXI7XHJcblxyXG5cdGZ1bmN0aW9uIGNyZWF0ZUZpbHRlcihmaWxJZCl7XHJcbiAgICAgICAgXHR2YXIgZmlsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKHN2Z05TLCdmaWx0ZXInKTtcclxuICAgICAgICBcdGZpbC5zZXRBdHRyaWJ1dGUoJ2lkJyxmaWxJZCk7XHJcbiAgICAgICAgICAgICAgICBmaWwuc2V0QXR0cmlidXRlKCdmaWx0ZXJVbml0cycsJ29iamVjdEJvdW5kaW5nQm94Jyk7XHJcbiAgICAgICAgICAgICAgICBmaWwuc2V0QXR0cmlidXRlKCd4JywnMCUnKTtcclxuICAgICAgICAgICAgICAgIGZpbC5zZXRBdHRyaWJ1dGUoJ3knLCcwJScpO1xyXG4gICAgICAgICAgICAgICAgZmlsLnNldEF0dHJpYnV0ZSgnd2lkdGgnLCcxMDAlJyk7XHJcbiAgICAgICAgICAgICAgICBmaWwuc2V0QXR0cmlidXRlKCdoZWlnaHQnLCcxMDAlJyk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmlsO1xyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gY3JlYXRlQWxwaGFUb0x1bWluYW5jZUZpbHRlcigpe1xyXG4gICAgICAgICAgICAgICAgdmFyIGZlQ29sb3JNYXRyaXggPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoc3ZnTlMsJ2ZlQ29sb3JNYXRyaXgnKTtcclxuICAgICAgICAgICAgICAgIGZlQ29sb3JNYXRyaXguc2V0QXR0cmlidXRlKCd0eXBlJywnbWF0cml4Jyk7XHJcbiAgICAgICAgICAgICAgICBmZUNvbG9yTWF0cml4LnNldEF0dHJpYnV0ZSgnY29sb3ItaW50ZXJwb2xhdGlvbi1maWx0ZXJzJywnc1JHQicpO1xyXG4gICAgICAgICAgICAgICAgZmVDb2xvck1hdHJpeC5zZXRBdHRyaWJ1dGUoJ3ZhbHVlcycsJzAgMCAwIDEgMCAgMCAwIDAgMSAwICAwIDAgMCAxIDAgIDAgMCAwIDAgMScpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZlQ29sb3JNYXRyaXg7XHJcblx0fVxyXG5cclxuXHRyZXR1cm4gb2I7XHJcbn0oKSlcbnZhciBwb29saW5nID0gKGZ1bmN0aW9uKCl7XHJcblxyXG5cdGZ1bmN0aW9uIGRvdWJsZShhcnIpe1xyXG5cdFx0cmV0dXJuIGFyci5jb25jYXQoQXJyYXkuYXBwbHkobnVsbCx7bGVuZ3RoOmFyci5sZW5ndGh9KSlcclxuXHR9XHJcblxyXG5cdHJldHVybiB7XHJcblx0XHRkb3VibGU6IGRvdWJsZVxyXG5cdH1cclxufSgpKTtcbnZhciBwb2ludF9wb29sID0gKGZ1bmN0aW9uKCl7XHJcblx0dmFyIG9iID0ge1xyXG5cdFx0bmV3UG9pbnQ6IG5ld1BvaW50LFxyXG5cdFx0cmVsZWFzZTogcmVsZWFzZVxyXG5cdFx0LyosZ2V0TGVuZ3RoOmZ1bmN0aW9uKCl7cmV0dXJuIF9sZW5ndGh9XHJcblx0XHQsZ2V0Q29udDpmdW5jdGlvbigpe3JldHVybiBjb250fSovXHJcblx0fVxyXG5cclxuXHR2YXIgX2xlbmd0aCA9IDA7XHJcblx0dmFyIF9tYXhMZW5ndGggPSA4O1xyXG5cdHZhciBwb29sID0gQXJyYXkuYXBwbHkobnVsbCx7bGVuZ3RoOl9tYXhMZW5ndGh9KTtcclxuXHJcblx0Ly92YXIgY29udCA9IDA7XHJcblxyXG5cdGZ1bmN0aW9uIG5ld1BvaW50KCl7XHJcblx0XHQvL3dpbmRvdy5ibV9uZXdQb2ludCA9IHdpbmRvdy5ibV9uZXdQb2ludCA/IHdpbmRvdy5ibV9uZXdQb2ludCArIDEgOiAxO1xyXG5cdFx0dmFyIHBvaW50O1xyXG5cdFx0aWYoX2xlbmd0aCl7XHJcblx0XHRcdF9sZW5ndGggLT0gMTtcclxuXHRcdFx0cG9pbnQgPSBwb29sW19sZW5ndGhdO1xyXG5cdFx0XHQvL3dpbmRvdy5ibV9yZXVzZSA9IHdpbmRvdy5ibV9yZXVzZSA/IHdpbmRvdy5ibV9yZXVzZSArIDEgOiAxO1xyXG5cdFx0fSBlbHNlIHtcclxuXHRcdFx0cG9pbnQgPSBbMC4xLDAuMV07XHJcblx0XHRcdC8vY29udCsrO1xyXG5cdFx0XHQvL2NvbnNvbGUubG9nKCduZXcnKTtcclxuXHRcdFx0Ly93aW5kb3cuYm1fbmV3ID0gd2luZG93LmJtX25ldyA/IHdpbmRvdy5ibV9uZXcgKyAxIDogMTtcclxuXHRcdFx0Ly9wb2ludC5fdHN0ID0gY29udCsrO1xyXG5cdFx0fVxyXG5cdFx0cmV0dXJuIHBvaW50O1xyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gcmVsZWFzZShwb2ludCkge1xyXG5cdFx0aWYoX2xlbmd0aCA9PT0gX21heExlbmd0aCkge1xyXG5cdFx0XHRwb29sID0gcG9vbGluZy5kb3VibGUocG9vbCk7XHJcblx0XHRcdF9tYXhMZW5ndGggPSBfbWF4TGVuZ3RoKjI7XHJcblx0XHR9XHJcblx0XHRwb29sW19sZW5ndGhdID0gcG9pbnQ7XHJcblx0XHRfbGVuZ3RoICs9IDE7XHJcblx0XHQvL3dpbmRvdy5ibV9yZWxlYXNlID0gd2luZG93LmJtX3JlbGVhc2UgPyB3aW5kb3cuYm1fcmVsZWFzZSArIDEgOiAxO1xyXG5cdFx0Ly9jb25zb2xlLmxvZygncmVsZWFzZScpO1xyXG5cdH1cclxuXHJcblxyXG5cdHJldHVybiBvYjtcclxufSgpKTtcbnZhciBzaGFwZV9wb29sID0gKGZ1bmN0aW9uKCl7XHJcblx0dmFyIG9iID0ge1xyXG5cdFx0Y2xvbmU6IGNsb25lLFxyXG5cdFx0bmV3U2hhcGU6IG5ld1NoYXBlLFxyXG5cdFx0cmVsZWFzZTogcmVsZWFzZSxcclxuXHRcdHJlbGVhc2VBcnJheTogcmVsZWFzZUFycmF5XHJcblx0fVxyXG5cclxuXHR2YXIgX2xlbmd0aCA9IDA7XHJcblx0dmFyIF9tYXhMZW5ndGggPSA0O1xyXG5cdHZhciBwb29sID0gQXJyYXkuYXBwbHkobnVsbCx7bGVuZ3RoOl9tYXhMZW5ndGh9KTtcclxuXHJcblx0ZnVuY3Rpb24gbmV3U2hhcGUoKXtcclxuXHRcdHZhciBzaGFwZVBhdGg7XHJcblx0XHRpZihfbGVuZ3RoKXtcclxuXHRcdFx0X2xlbmd0aCAtPSAxO1xyXG5cdFx0XHRzaGFwZVBhdGggPSBwb29sW19sZW5ndGhdO1xyXG5cdFx0fSBlbHNlIHtcclxuXHRcdFx0c2hhcGVQYXRoID0gbmV3IFNoYXBlUGF0aCgpO1xyXG5cdFx0fVxyXG5cdFx0cmV0dXJuIHNoYXBlUGF0aDtcclxuXHR9XHJcblxyXG5cdGZ1bmN0aW9uIHJlbGVhc2Uoc2hhcGVQYXRoKSB7XHJcblx0XHRpZihfbGVuZ3RoID09PSBfbWF4TGVuZ3RoKSB7XHJcblx0XHRcdHBvb2wgPSBwb29saW5nLmRvdWJsZShwb29sKTtcclxuXHRcdFx0X21heExlbmd0aCA9IF9tYXhMZW5ndGgqMjtcclxuXHRcdH1cclxuXHRcdHZhciBsZW4gPSBzaGFwZVBhdGguX2xlbmd0aCwgaTtcclxuXHRcdGZvcihpID0gMDsgaSA8IGxlbjsgaSArPSAxKSB7XHJcblx0XHRcdHBvaW50X3Bvb2wucmVsZWFzZShzaGFwZVBhdGgudltpXSk7XHJcblx0XHRcdHBvaW50X3Bvb2wucmVsZWFzZShzaGFwZVBhdGguaVtpXSk7XHJcblx0XHRcdHBvaW50X3Bvb2wucmVsZWFzZShzaGFwZVBhdGgub1tpXSk7XHJcblx0XHRcdHNoYXBlUGF0aC52W2ldID0gbnVsbDtcclxuXHRcdFx0c2hhcGVQYXRoLmlbaV0gPSBudWxsO1xyXG5cdFx0XHRzaGFwZVBhdGgub1tpXSA9IG51bGw7XHJcblx0XHR9XHJcblx0XHRzaGFwZVBhdGguX2xlbmd0aCA9IDA7XHJcblx0XHRzaGFwZVBhdGguYyA9IGZhbHNlO1xyXG5cdFx0cG9vbFtfbGVuZ3RoXSA9IHNoYXBlUGF0aDtcclxuXHRcdF9sZW5ndGggKz0gMTtcclxuXHR9XHJcblxyXG5cdGZ1bmN0aW9uIHJlbGVhc2VBcnJheShzaGFwZVBhdGhzQ29sbGVjdGlvbiwgbGVuZ3RoKSB7XHJcblx0XHR3aGlsZShsZW5ndGgtLSkge1xyXG5cdFx0XHRyZWxlYXNlKHNoYXBlUGF0aHNDb2xsZWN0aW9uW2xlbmd0aF0pO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gY2xvbmUoc2hhcGUsIHRyYW5zZm9ybSkge1xyXG5cdFx0dmFyIGksIGxlbiA9IHNoYXBlLl9sZW5ndGg7XHJcblx0XHR2YXIgY2xvbmVkID0gbmV3U2hhcGUoKTtcclxuXHRcdGNsb25lZC5fbGVuZ3RoID0gc2hhcGUuX2xlbmd0aDtcclxuXHRcdGNsb25lZC5jID0gc2hhcGUuYztcclxuXHJcblx0XHR2YXIgcHQ7XHJcblx0XHRcclxuXHRcdGZvcihpID0gMDsgaSA8IGxlbjsgaSArPSAxKSB7XHJcblx0XHRcdGlmKHRyYW5zZm9ybSl7XHJcblx0XHRcdFx0cHQgPSB0cmFuc2Zvcm0uYXBwbHlUb1BvaW50QXJyYXkoc2hhcGUudltpXVswXSxzaGFwZS52W2ldWzFdLDAsMik7XHJcblx0XHRcdFx0Y2xvbmVkLnNldFhZQXQocHRbMF0scHRbMV0sJ3YnLGkpO1xyXG5cdFx0XHRcdHBvaW50X3Bvb2wucmVsZWFzZShwdCk7XHJcblx0XHRcdFx0cHQgPSB0cmFuc2Zvcm0uYXBwbHlUb1BvaW50QXJyYXkoc2hhcGUub1tpXVswXSxzaGFwZS5vW2ldWzFdLDAsMik7XHJcblx0XHRcdFx0Y2xvbmVkLnNldFhZQXQocHRbMF0scHRbMV0sJ28nLGkpO1xyXG5cdFx0XHRcdHBvaW50X3Bvb2wucmVsZWFzZShwdCk7XHJcblx0XHRcdFx0cHQgPSB0cmFuc2Zvcm0uYXBwbHlUb1BvaW50QXJyYXkoc2hhcGUuaVtpXVswXSxzaGFwZS5pW2ldWzFdLDAsMik7XHJcblx0XHRcdFx0Y2xvbmVkLnNldFhZQXQocHRbMF0scHRbMV0sJ2knLGkpO1xyXG5cdFx0XHRcdHBvaW50X3Bvb2wucmVsZWFzZShwdCk7XHJcblx0XHRcdH1lbHNle1xyXG5cdFx0XHRcdGNsb25lZC5zZXRUcmlwbGVBdChzaGFwZS52W2ldWzBdLHNoYXBlLnZbaV1bMV0sc2hhcGUub1tpXVswXSxzaGFwZS5vW2ldWzFdLHNoYXBlLmlbaV1bMF0sc2hhcGUuaVtpXVsxXSwgaSk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHRcdHJldHVybiBjbG9uZWRcclxuXHR9XHJcblxyXG5cclxuXHRyZXR1cm4gb2I7XHJcbn0oKSk7XG52YXIgc2hhcGVDb2xsZWN0aW9uX3Bvb2wgPSAoZnVuY3Rpb24oKXtcclxuXHR2YXIgb2IgPSB7XHJcblx0XHRuZXdTaGFwZUNvbGxlY3Rpb246IG5ld1NoYXBlQ29sbGVjdGlvbixcclxuXHRcdHJlbGVhc2U6IHJlbGVhc2UsXHJcblx0XHRjbG9uZTogY2xvbmVcclxuXHR9XHJcblxyXG5cdHZhciBfbGVuZ3RoID0gMDtcclxuXHR2YXIgX21heExlbmd0aCA9IDQ7XHJcblx0dmFyIHBvb2wgPSBBcnJheS5hcHBseShudWxsLHtsZW5ndGg6X21heExlbmd0aH0pO1xyXG5cclxuXHR2YXIgY29udCA9IDA7XHJcblxyXG5cdGZ1bmN0aW9uIG5ld1NoYXBlQ29sbGVjdGlvbigpe1xyXG5cdFx0dmFyIHNoYXBlQ29sbGVjdGlvbjtcclxuXHRcdGlmKF9sZW5ndGgpe1xyXG5cdFx0XHRfbGVuZ3RoIC09IDE7XHJcblx0XHRcdHNoYXBlQ29sbGVjdGlvbiA9IHBvb2xbX2xlbmd0aF07XHJcblx0XHR9IGVsc2Uge1xyXG5cdFx0XHRzaGFwZUNvbGxlY3Rpb24gPSBuZXcgU2hhcGVDb2xsZWN0aW9uKCk7XHJcblx0XHR9XHJcblx0XHRyZXR1cm4gc2hhcGVDb2xsZWN0aW9uO1xyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gcmVsZWFzZShzaGFwZUNvbGxlY3Rpb24pIHtcclxuXHRcdHZhciBpLCBsZW4gPSBzaGFwZUNvbGxlY3Rpb24uX2xlbmd0aDtcclxuXHRcdGZvcihpID0gMDsgaSA8IGxlbjsgaSArPSAxKSB7XHJcblx0XHRcdHNoYXBlX3Bvb2wucmVsZWFzZShzaGFwZUNvbGxlY3Rpb24uc2hhcGVzW2ldKTtcclxuXHRcdH1cclxuXHRcdHNoYXBlQ29sbGVjdGlvbi5fbGVuZ3RoID0gMDtcclxuXHJcblx0XHRpZihfbGVuZ3RoID09PSBfbWF4TGVuZ3RoKSB7XHJcblx0XHRcdHBvb2wgPSBwb29saW5nLmRvdWJsZShwb29sKTtcclxuXHRcdFx0X21heExlbmd0aCA9IF9tYXhMZW5ndGgqMjtcclxuXHRcdH1cclxuXHRcdHBvb2xbX2xlbmd0aF0gPSBzaGFwZUNvbGxlY3Rpb247XHJcblx0XHRfbGVuZ3RoICs9IDE7XHJcblx0fVxyXG5cclxuXHRmdW5jdGlvbiBjbG9uZShzaGFwZUNvbGxlY3Rpb24sIG9yaWdpbkNvbGxlY3Rpb24pIHtcclxuXHRcdHJlbGVhc2Uoc2hhcGVDb2xsZWN0aW9uKTtcclxuXHRcdGlmKF9sZW5ndGggPT09IF9tYXhMZW5ndGgpIHtcclxuXHRcdFx0cG9vbCA9IHBvb2xpbmcuZG91YmxlKHBvb2wpO1xyXG5cdFx0XHRfbWF4TGVuZ3RoID0gX21heExlbmd0aCoyO1xyXG5cdFx0fVxyXG5cdFx0cG9vbFtfbGVuZ3RoXSA9IHNoYXBlQ29sbGVjdGlvbjtcclxuXHRcdF9sZW5ndGggKz0gMTtcclxuXHR9XHJcblxyXG5cclxuXHRyZXR1cm4gb2I7XHJcbn0oKSk7XG5mdW5jdGlvbiBCYXNlUmVuZGVyZXIoKXt9XHJcbkJhc2VSZW5kZXJlci5wcm90b3R5cGUuY2hlY2tMYXllcnMgPSBmdW5jdGlvbihudW0pe1xyXG4gICAgdmFyIGksIGxlbiA9IHRoaXMubGF5ZXJzLmxlbmd0aCwgZGF0YTtcclxuICAgIHRoaXMuY29tcGxldGVMYXllcnMgPSB0cnVlO1xyXG4gICAgZm9yIChpID0gbGVuIC0gMTsgaSA+PSAwOyBpLS0pIHtcclxuICAgICAgICBpZiAoIXRoaXMuZWxlbWVudHNbaV0pIHtcclxuICAgICAgICAgICAgZGF0YSA9IHRoaXMubGF5ZXJzW2ldO1xyXG4gICAgICAgICAgICBpZihkYXRhLmlwIC0gZGF0YS5zdCA8PSAobnVtIC0gdGhpcy5sYXllcnNbaV0uc3QpICYmIGRhdGEub3AgLSBkYXRhLnN0ID4gKG51bSAtIHRoaXMubGF5ZXJzW2ldLnN0KSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5idWlsZEl0ZW0oaSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5jb21wbGV0ZUxheWVycyA9IHRoaXMuZWxlbWVudHNbaV0gPyB0aGlzLmNvbXBsZXRlTGF5ZXJzOmZhbHNlO1xyXG4gICAgfVxyXG4gICAgdGhpcy5jaGVja1BlbmRpbmdFbGVtZW50cygpO1xyXG59O1xyXG5cclxuQmFzZVJlbmRlcmVyLnByb3RvdHlwZS5jcmVhdGVJdGVtID0gZnVuY3Rpb24obGF5ZXIpe1xyXG4gICAgc3dpdGNoKGxheWVyLnR5KXtcclxuICAgICAgICBjYXNlIDI6XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmNyZWF0ZUltYWdlKGxheWVyKTtcclxuICAgICAgICBjYXNlIDA6XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmNyZWF0ZUNvbXAobGF5ZXIpO1xyXG4gICAgICAgIGNhc2UgMTpcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuY3JlYXRlU29saWQobGF5ZXIpO1xyXG4gICAgICAgIGNhc2UgNDpcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuY3JlYXRlU2hhcGUobGF5ZXIpO1xyXG4gICAgICAgIGNhc2UgNTpcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuY3JlYXRlVGV4dChsYXllcik7XHJcbiAgICAgICAgY2FzZSAxMzpcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuY3JlYXRlQ2FtZXJhKGxheWVyKTtcclxuICAgICAgICBjYXNlIDk5OlxyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuICAgIHJldHVybiB0aGlzLmNyZWF0ZUJhc2UobGF5ZXIpO1xyXG59O1xyXG5cclxuQmFzZVJlbmRlcmVyLnByb3RvdHlwZS5jcmVhdGVDYW1lcmEgPSBmdW5jdGlvbigpe1xyXG4gICAgdGhyb3cgbmV3IEVycm9yKCdZb3VcXCdyZSB1c2luZyBhIDNkIGNhbWVyYS4gVHJ5IHRoZSBodG1sIHJlbmRlcmVyLicpO1xyXG59XHJcblxyXG5CYXNlUmVuZGVyZXIucHJvdG90eXBlLmJ1aWxkQWxsSXRlbXMgPSBmdW5jdGlvbigpe1xyXG4gICAgdmFyIGksIGxlbiA9IHRoaXMubGF5ZXJzLmxlbmd0aDtcclxuICAgIGZvcihpPTA7aTxsZW47aSs9MSl7XHJcbiAgICAgICAgdGhpcy5idWlsZEl0ZW0oaSk7XHJcbiAgICB9XHJcbiAgICB0aGlzLmNoZWNrUGVuZGluZ0VsZW1lbnRzKCk7XHJcbn07XHJcblxyXG5CYXNlUmVuZGVyZXIucHJvdG90eXBlLmluY2x1ZGVMYXllcnMgPSBmdW5jdGlvbihuZXdMYXllcnMpe1xyXG4gICAgdGhpcy5jb21wbGV0ZUxheWVycyA9IGZhbHNlO1xyXG4gICAgdmFyIGksIGxlbiA9IG5ld0xheWVycy5sZW5ndGg7XHJcbiAgICB2YXIgaiwgakxlbiA9IHRoaXMubGF5ZXJzLmxlbmd0aDtcclxuICAgIGZvcihpPTA7aTxsZW47aSs9MSl7XHJcbiAgICAgICAgaiA9IDA7XHJcbiAgICAgICAgd2hpbGUoajxqTGVuKXtcclxuICAgICAgICAgICAgaWYodGhpcy5sYXllcnNbal0uaWQgPT0gbmV3TGF5ZXJzW2ldLmlkKXtcclxuICAgICAgICAgICAgICAgIHRoaXMubGF5ZXJzW2pdID0gbmV3TGF5ZXJzW2ldO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaiArPSAxO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufTtcclxuXHJcbkJhc2VSZW5kZXJlci5wcm90b3R5cGUuc2V0UHJvamVjdEludGVyZmFjZSA9IGZ1bmN0aW9uKHBJbnRlcmZhY2Upe1xyXG4gICAgdGhpcy5nbG9iYWxEYXRhLnByb2plY3RJbnRlcmZhY2UgPSBwSW50ZXJmYWNlO1xyXG59O1xyXG5cclxuQmFzZVJlbmRlcmVyLnByb3RvdHlwZS5pbml0SXRlbXMgPSBmdW5jdGlvbigpe1xyXG4gICAgaWYoIXRoaXMuZ2xvYmFsRGF0YS5wcm9ncmVzc2l2ZUxvYWQpe1xyXG4gICAgICAgIHRoaXMuYnVpbGRBbGxJdGVtcygpO1xyXG4gICAgfVxyXG59O1xyXG5CYXNlUmVuZGVyZXIucHJvdG90eXBlLmJ1aWxkRWxlbWVudFBhcmVudGluZyA9IGZ1bmN0aW9uKGVsZW1lbnQsIHBhcmVudE5hbWUsIGhpZXJhcmNoeSl7XHJcbiAgICBoaWVyYXJjaHkgPSBoaWVyYXJjaHkgfHwgW107XHJcbiAgICB2YXIgZWxlbWVudHMgPSB0aGlzLmVsZW1lbnRzO1xyXG4gICAgdmFyIGxheWVycyA9IHRoaXMubGF5ZXJzO1xyXG4gICAgdmFyIGk9MCwgbGVuID0gbGF5ZXJzLmxlbmd0aDtcclxuICAgIHdoaWxlKGk8bGVuKXtcclxuICAgICAgICBpZihsYXllcnNbaV0uaW5kID09IHBhcmVudE5hbWUpe1xyXG4gICAgICAgICAgICBpZighZWxlbWVudHNbaV0gfHwgZWxlbWVudHNbaV0gPT09IHRydWUpe1xyXG4gICAgICAgICAgICAgICAgdGhpcy5idWlsZEl0ZW0oaSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmFkZFBlbmRpbmdFbGVtZW50KGVsZW1lbnQpO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYobGF5ZXJzW2ldLnBhcmVudCAhPT0gdW5kZWZpbmVkKXtcclxuICAgICAgICAgICAgICAgIGhpZXJhcmNoeS5wdXNoKGVsZW1lbnRzW2ldKTtcclxuICAgICAgICAgICAgICAgIGVsZW1lbnRzW2ldLl9pc1BhcmVudCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmJ1aWxkRWxlbWVudFBhcmVudGluZyhlbGVtZW50LGxheWVyc1tpXS5wYXJlbnQsIGhpZXJhcmNoeSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBoaWVyYXJjaHkucHVzaChlbGVtZW50c1tpXSk7XHJcbiAgICAgICAgICAgICAgICBlbGVtZW50c1tpXS5faXNQYXJlbnQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgZWxlbWVudC5zZXRIaWVyYXJjaHkoaGllcmFyY2h5KTtcclxuICAgICAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgfVxyXG4gICAgICAgIGkgKz0gMTtcclxuICAgIH1cclxufTtcclxuXHJcbkJhc2VSZW5kZXJlci5wcm90b3R5cGUuYWRkUGVuZGluZ0VsZW1lbnQgPSBmdW5jdGlvbihlbGVtZW50KXtcclxuICAgIHRoaXMucGVuZGluZ0VsZW1lbnRzLnB1c2goZWxlbWVudCk7XHJcbn07XG5mdW5jdGlvbiBTVkdSZW5kZXJlcihhbmltYXRpb25JdGVtLCBjb25maWcpe1xyXG4gICAgdGhpcy5hbmltYXRpb25JdGVtID0gYW5pbWF0aW9uSXRlbTtcclxuICAgIHRoaXMubGF5ZXJzID0gbnVsbDtcclxuICAgIHRoaXMucmVuZGVyZWRGcmFtZSA9IC0xO1xyXG4gICAgdGhpcy5nbG9iYWxEYXRhID0ge1xyXG4gICAgICAgIGZyYW1lTnVtOiAtMVxyXG4gICAgfTtcclxuICAgIHRoaXMucmVuZGVyQ29uZmlnID0ge1xyXG4gICAgICAgIHByZXNlcnZlQXNwZWN0UmF0aW86IChjb25maWcgJiYgY29uZmlnLnByZXNlcnZlQXNwZWN0UmF0aW8pIHx8ICd4TWlkWU1pZCBtZWV0JyxcclxuICAgICAgICBwcm9ncmVzc2l2ZUxvYWQ6IChjb25maWcgJiYgY29uZmlnLnByb2dyZXNzaXZlTG9hZCkgfHwgZmFsc2UsXHJcbiAgICAgICAgaGlkZU9uVHJhbnNwYXJlbnQ6IChjb25maWcgJiYgY29uZmlnLmhpZGVPblRyYW5zcGFyZW50ID09PSBmYWxzZSkgPyBmYWxzZSA6IHRydWVcclxuICAgIH07XHJcbiAgICB0aGlzLmdsb2JhbERhdGEucmVuZGVyQ29uZmlnID0gdGhpcy5yZW5kZXJDb25maWc7XHJcbiAgICB0aGlzLmVsZW1lbnRzID0gW107XHJcbiAgICB0aGlzLnBlbmRpbmdFbGVtZW50cyA9IFtdO1xyXG4gICAgdGhpcy5kZXN0cm95ZWQgPSBmYWxzZTtcclxuXHJcbn1cclxuXHJcbmV4dGVuZFByb3RvdHlwZShCYXNlUmVuZGVyZXIsU1ZHUmVuZGVyZXIpO1xyXG5cclxuU1ZHUmVuZGVyZXIucHJvdG90eXBlLmNyZWF0ZUJhc2UgPSBmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgcmV0dXJuIG5ldyBTVkdCYXNlRWxlbWVudChkYXRhLCB0aGlzLmxheWVyRWxlbWVudCx0aGlzLmdsb2JhbERhdGEsdGhpcyk7XHJcbn07XHJcblxyXG5TVkdSZW5kZXJlci5wcm90b3R5cGUuY3JlYXRlU2hhcGUgPSBmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgcmV0dXJuIG5ldyBJU2hhcGVFbGVtZW50KGRhdGEsIHRoaXMubGF5ZXJFbGVtZW50LHRoaXMuZ2xvYmFsRGF0YSx0aGlzKTtcclxufTtcclxuXHJcblNWR1JlbmRlcmVyLnByb3RvdHlwZS5jcmVhdGVUZXh0ID0gZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgIHJldHVybiBuZXcgU1ZHVGV4dEVsZW1lbnQoZGF0YSwgdGhpcy5sYXllckVsZW1lbnQsdGhpcy5nbG9iYWxEYXRhLHRoaXMpO1xyXG5cclxufTtcclxuXHJcblNWR1JlbmRlcmVyLnByb3RvdHlwZS5jcmVhdGVJbWFnZSA9IGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICByZXR1cm4gbmV3IElJbWFnZUVsZW1lbnQoZGF0YSwgdGhpcy5sYXllckVsZW1lbnQsdGhpcy5nbG9iYWxEYXRhLHRoaXMpO1xyXG59O1xyXG5cclxuU1ZHUmVuZGVyZXIucHJvdG90eXBlLmNyZWF0ZUNvbXAgPSBmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgcmV0dXJuIG5ldyBJQ29tcEVsZW1lbnQoZGF0YSwgdGhpcy5sYXllckVsZW1lbnQsdGhpcy5nbG9iYWxEYXRhLHRoaXMpO1xyXG5cclxufTtcclxuXHJcblNWR1JlbmRlcmVyLnByb3RvdHlwZS5jcmVhdGVTb2xpZCA9IGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICByZXR1cm4gbmV3IElTb2xpZEVsZW1lbnQoZGF0YSwgdGhpcy5sYXllckVsZW1lbnQsdGhpcy5nbG9iYWxEYXRhLHRoaXMpO1xyXG59O1xyXG5cclxuU1ZHUmVuZGVyZXIucHJvdG90eXBlLmNvbmZpZ0FuaW1hdGlvbiA9IGZ1bmN0aW9uKGFuaW1EYXRhKXtcclxuICAgIHRoaXMubGF5ZXJFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKHN2Z05TLCdzdmcnKTtcclxuICAgIHRoaXMubGF5ZXJFbGVtZW50LnNldEF0dHJpYnV0ZSgneG1sbnMnLCdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZycpO1xyXG4gICAgdGhpcy5sYXllckVsZW1lbnQuc2V0QXR0cmlidXRlKCd3aWR0aCcsYW5pbURhdGEudyk7XHJcbiAgICB0aGlzLmxheWVyRWxlbWVudC5zZXRBdHRyaWJ1dGUoJ2hlaWdodCcsYW5pbURhdGEuaCk7XHJcbiAgICB0aGlzLmxheWVyRWxlbWVudC5zZXRBdHRyaWJ1dGUoJ3ZpZXdCb3gnLCcwIDAgJythbmltRGF0YS53KycgJythbmltRGF0YS5oKTtcclxuICAgIHRoaXMubGF5ZXJFbGVtZW50LnNldEF0dHJpYnV0ZSgncHJlc2VydmVBc3BlY3RSYXRpbycsdGhpcy5yZW5kZXJDb25maWcucHJlc2VydmVBc3BlY3RSYXRpbyk7XHJcbiAgICB0aGlzLmxheWVyRWxlbWVudC5zdHlsZS53aWR0aCA9ICcxMDAlJztcclxuICAgIHRoaXMubGF5ZXJFbGVtZW50LnN0eWxlLmhlaWdodCA9ICcxMDAlJztcclxuICAgIC8vdGhpcy5sYXllckVsZW1lbnQuc3R5bGUudHJhbnNmb3JtID0gJ3RyYW5zbGF0ZTNkKDAsMCwwKSc7XHJcbiAgICAvL3RoaXMubGF5ZXJFbGVtZW50LnN0eWxlLnRyYW5zZm9ybU9yaWdpbiA9IHRoaXMubGF5ZXJFbGVtZW50LnN0eWxlLm1velRyYW5zZm9ybU9yaWdpbiA9IHRoaXMubGF5ZXJFbGVtZW50LnN0eWxlLndlYmtpdFRyYW5zZm9ybU9yaWdpbiA9IHRoaXMubGF5ZXJFbGVtZW50LnN0eWxlWyctd2Via2l0LXRyYW5zZm9ybSddID0gXCIwcHggMHB4IDBweFwiO1xyXG4gICAgdGhpcy5hbmltYXRpb25JdGVtLndyYXBwZXIuYXBwZW5kQ2hpbGQodGhpcy5sYXllckVsZW1lbnQpO1xyXG4gICAgLy9NYXNrIGFuaW1hdGlvblxyXG4gICAgdmFyIGRlZnMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoc3ZnTlMsICdkZWZzJyk7XHJcbiAgICB0aGlzLmdsb2JhbERhdGEuZGVmcyA9IGRlZnM7XHJcbiAgICB0aGlzLmxheWVyRWxlbWVudC5hcHBlbmRDaGlsZChkZWZzKTtcclxuICAgIHRoaXMuZ2xvYmFsRGF0YS5nZXRBc3NldERhdGEgPSB0aGlzLmFuaW1hdGlvbkl0ZW0uZ2V0QXNzZXREYXRhLmJpbmQodGhpcy5hbmltYXRpb25JdGVtKTtcclxuICAgIHRoaXMuZ2xvYmFsRGF0YS5nZXRBc3NldHNQYXRoID0gdGhpcy5hbmltYXRpb25JdGVtLmdldEFzc2V0c1BhdGguYmluZCh0aGlzLmFuaW1hdGlvbkl0ZW0pO1xyXG4gICAgdGhpcy5nbG9iYWxEYXRhLnByb2dyZXNzaXZlTG9hZCA9IHRoaXMucmVuZGVyQ29uZmlnLnByb2dyZXNzaXZlTG9hZDtcclxuICAgIHRoaXMuZ2xvYmFsRGF0YS5mcmFtZUlkID0gMDtcclxuICAgIHRoaXMuZ2xvYmFsRGF0YS5ubSA9IGFuaW1EYXRhLm5tO1xyXG4gICAgdGhpcy5nbG9iYWxEYXRhLmNvbXBTaXplID0ge1xyXG4gICAgICAgIHc6IGFuaW1EYXRhLncsXHJcbiAgICAgICAgaDogYW5pbURhdGEuaFxyXG4gICAgfTtcclxuICAgIHRoaXMuZGF0YSA9IGFuaW1EYXRhO1xyXG4gICAgdGhpcy5nbG9iYWxEYXRhLmZyYW1lUmF0ZSA9IGFuaW1EYXRhLmZyO1xyXG4gICAgdmFyIG1hc2tFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKHN2Z05TLCAnY2xpcFBhdGgnKTtcclxuICAgIHZhciByZWN0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKHN2Z05TLCdyZWN0Jyk7XHJcbiAgICByZWN0LnNldEF0dHJpYnV0ZSgnd2lkdGgnLGFuaW1EYXRhLncpO1xyXG4gICAgcmVjdC5zZXRBdHRyaWJ1dGUoJ2hlaWdodCcsYW5pbURhdGEuaCk7XHJcbiAgICByZWN0LnNldEF0dHJpYnV0ZSgneCcsMCk7XHJcbiAgICByZWN0LnNldEF0dHJpYnV0ZSgneScsMCk7XHJcbiAgICB2YXIgbWFza0lkID0gJ2FuaW1hdGlvbk1hc2tfJytyYW5kb21TdHJpbmcoMTApO1xyXG4gICAgbWFza0VsZW1lbnQuc2V0QXR0cmlidXRlKCdpZCcsIG1hc2tJZCk7XHJcbiAgICBtYXNrRWxlbWVudC5hcHBlbmRDaGlsZChyZWN0KTtcclxuICAgIHZhciBtYXNrZWRFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKHN2Z05TLCdnJyk7XHJcbiAgICBtYXNrZWRFbGVtZW50LnNldEF0dHJpYnV0ZShcImNsaXAtcGF0aFwiLCBcInVybCgjXCIrbWFza0lkK1wiKVwiKTtcclxuICAgIHRoaXMubGF5ZXJFbGVtZW50LmFwcGVuZENoaWxkKG1hc2tlZEVsZW1lbnQpO1xyXG4gICAgZGVmcy5hcHBlbmRDaGlsZChtYXNrRWxlbWVudCk7XHJcbiAgICB0aGlzLmxheWVyRWxlbWVudCA9IG1hc2tlZEVsZW1lbnQ7XHJcbiAgICB0aGlzLmxheWVycyA9IGFuaW1EYXRhLmxheWVycztcclxuICAgIHRoaXMuZ2xvYmFsRGF0YS5mb250TWFuYWdlciA9IG5ldyBGb250TWFuYWdlcigpO1xyXG4gICAgdGhpcy5nbG9iYWxEYXRhLmZvbnRNYW5hZ2VyLmFkZENoYXJzKGFuaW1EYXRhLmNoYXJzKTtcclxuICAgIHRoaXMuZ2xvYmFsRGF0YS5mb250TWFuYWdlci5hZGRGb250cyhhbmltRGF0YS5mb250cyxkZWZzKTtcclxuICAgIHRoaXMuZWxlbWVudHMgPSBBcnJheS5hcHBseShudWxsLHtsZW5ndGg6YW5pbURhdGEubGF5ZXJzLmxlbmd0aH0pO1xyXG59O1xyXG5cclxuXHJcblNWR1JlbmRlcmVyLnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgdGhpcy5hbmltYXRpb25JdGVtLndyYXBwZXIuaW5uZXJIVE1MID0gJyc7XHJcbiAgICB0aGlzLmxheWVyRWxlbWVudCA9IG51bGw7XHJcbiAgICB0aGlzLmdsb2JhbERhdGEuZGVmcyA9IG51bGw7XHJcbiAgICB2YXIgaSwgbGVuID0gdGhpcy5sYXllcnMgPyB0aGlzLmxheWVycy5sZW5ndGggOiAwO1xyXG4gICAgZm9yIChpID0gMDsgaSA8IGxlbjsgaSsrKSB7XHJcbiAgICAgICAgaWYodGhpcy5lbGVtZW50c1tpXSl7XHJcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudHNbaV0uZGVzdHJveSgpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHRoaXMuZWxlbWVudHMubGVuZ3RoID0gMDtcclxuICAgIHRoaXMuZGVzdHJveWVkID0gdHJ1ZTtcclxuICAgIHRoaXMuYW5pbWF0aW9uSXRlbSA9IG51bGw7XHJcbn07XHJcblxyXG5TVkdSZW5kZXJlci5wcm90b3R5cGUudXBkYXRlQ29udGFpbmVyU2l6ZSA9IGZ1bmN0aW9uICgpIHtcclxufTtcclxuXHJcblNWR1JlbmRlcmVyLnByb3RvdHlwZS5idWlsZEl0ZW0gID0gZnVuY3Rpb24ocG9zKXtcclxuICAgIHZhciBlbGVtZW50cyA9IHRoaXMuZWxlbWVudHM7XHJcbiAgICBpZihlbGVtZW50c1twb3NdIHx8IHRoaXMubGF5ZXJzW3Bvc10udHkgPT0gOTkpe1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGVsZW1lbnRzW3Bvc10gPSB0cnVlO1xyXG4gICAgdmFyIGVsZW1lbnQgPSB0aGlzLmNyZWF0ZUl0ZW0odGhpcy5sYXllcnNbcG9zXSk7XHJcblxyXG4gICAgZWxlbWVudHNbcG9zXSA9IGVsZW1lbnQ7XHJcbiAgICBpZihleHByZXNzaW9uc1BsdWdpbil7XHJcbiAgICAgICAgaWYodGhpcy5sYXllcnNbcG9zXS50eSA9PT0gMCl7XHJcbiAgICAgICAgICAgIHRoaXMuZ2xvYmFsRGF0YS5wcm9qZWN0SW50ZXJmYWNlLnJlZ2lzdGVyQ29tcG9zaXRpb24oZWxlbWVudCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsZW1lbnQuaW5pdEV4cHJlc3Npb25zKCk7XHJcbiAgICB9XHJcbiAgICB0aGlzLmFwcGVuZEVsZW1lbnRJblBvcyhlbGVtZW50LHBvcyk7XHJcbiAgICBpZih0aGlzLmxheWVyc1twb3NdLnR0KXtcclxuICAgICAgICBpZighdGhpcy5lbGVtZW50c1twb3MgLSAxXSB8fCB0aGlzLmVsZW1lbnRzW3BvcyAtIDFdID09PSB0cnVlKXtcclxuICAgICAgICAgICAgdGhpcy5idWlsZEl0ZW0ocG9zIC0gMSk7XHJcbiAgICAgICAgICAgIHRoaXMuYWRkUGVuZGluZ0VsZW1lbnQoZWxlbWVudCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgZWxlbWVudC5zZXRNYXR0ZShlbGVtZW50c1twb3MgLSAxXS5sYXllcklkKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn07XHJcblxyXG5TVkdSZW5kZXJlci5wcm90b3R5cGUuY2hlY2tQZW5kaW5nRWxlbWVudHMgID0gZnVuY3Rpb24oKXtcclxuICAgIHdoaWxlKHRoaXMucGVuZGluZ0VsZW1lbnRzLmxlbmd0aCl7XHJcbiAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLnBlbmRpbmdFbGVtZW50cy5wb3AoKTtcclxuICAgICAgICBlbGVtZW50LmNoZWNrUGFyZW50aW5nKCk7XHJcbiAgICAgICAgaWYoZWxlbWVudC5kYXRhLnR0KXtcclxuICAgICAgICAgICAgdmFyIGkgPSAwLCBsZW4gPSB0aGlzLmVsZW1lbnRzLmxlbmd0aDtcclxuICAgICAgICAgICAgd2hpbGUoaTxsZW4pe1xyXG4gICAgICAgICAgICAgICAgaWYodGhpcy5lbGVtZW50c1tpXSA9PT0gZWxlbWVudCl7XHJcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5zZXRNYXR0ZSh0aGlzLmVsZW1lbnRzW2kgLSAxXS5sYXllcklkKTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGkgKz0gMTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxufTtcclxuXHJcblNWR1JlbmRlcmVyLnByb3RvdHlwZS5yZW5kZXJGcmFtZSA9IGZ1bmN0aW9uKG51bSl7XHJcbiAgICBpZih0aGlzLnJlbmRlcmVkRnJhbWUgPT0gbnVtIHx8IHRoaXMuZGVzdHJveWVkKXtcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBpZihudW0gPT09IG51bGwpe1xyXG4gICAgICAgIG51bSA9IHRoaXMucmVuZGVyZWRGcmFtZTtcclxuICAgIH1lbHNle1xyXG4gICAgICAgIHRoaXMucmVuZGVyZWRGcmFtZSA9IG51bTtcclxuICAgIH1cclxuICAgIC8vY2xlYXJQb2ludHMoKTtcclxuICAgIC8qY29uc29sZS5sb2coJy0tLS0tLS0nKTtcclxuICAgIGNvbnNvbGUubG9nKCdGUkFNRSAnLG51bSk7Ki9cclxuICAgIHRoaXMuZ2xvYmFsRGF0YS5mcmFtZU51bSA9IG51bTtcclxuICAgIHRoaXMuZ2xvYmFsRGF0YS5mcmFtZUlkICs9IDE7XHJcbiAgICB0aGlzLmdsb2JhbERhdGEucHJvamVjdEludGVyZmFjZS5jdXJyZW50RnJhbWUgPSBudW07XHJcbiAgICB2YXIgaSwgbGVuID0gdGhpcy5sYXllcnMubGVuZ3RoO1xyXG4gICAgaWYoIXRoaXMuY29tcGxldGVMYXllcnMpe1xyXG4gICAgICAgIHRoaXMuY2hlY2tMYXllcnMobnVtKTtcclxuICAgIH1cclxuICAgIGZvciAoaSA9IGxlbiAtIDE7IGkgPj0gMDsgaS0tKSB7XHJcbiAgICAgICAgaWYodGhpcy5jb21wbGV0ZUxheWVycyB8fCB0aGlzLmVsZW1lbnRzW2ldKXtcclxuICAgICAgICAgICAgdGhpcy5lbGVtZW50c1tpXS5wcmVwYXJlRnJhbWUobnVtIC0gdGhpcy5sYXllcnNbaV0uc3QpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGZvciAoaSA9IGxlbiAtIDE7IGkgPj0gMDsgaS0tKSB7XHJcbiAgICAgICAgaWYodGhpcy5jb21wbGV0ZUxheWVycyB8fCB0aGlzLmVsZW1lbnRzW2ldKXtcclxuICAgICAgICAgICAgdGhpcy5lbGVtZW50c1tpXS5yZW5kZXJGcmFtZSgpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufTtcclxuXHJcblNWR1JlbmRlcmVyLnByb3RvdHlwZS5hcHBlbmRFbGVtZW50SW5Qb3MgPSBmdW5jdGlvbihlbGVtZW50LCBwb3Mpe1xyXG4gICAgdmFyIG5ld0VsZW1lbnQgPSBlbGVtZW50LmdldEJhc2VFbGVtZW50KCk7XHJcbiAgICBpZighbmV3RWxlbWVudCl7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgdmFyIGkgPSAwO1xyXG4gICAgdmFyIG5leHRFbGVtZW50O1xyXG4gICAgd2hpbGUoaTxwb3Mpe1xyXG4gICAgICAgIGlmKHRoaXMuZWxlbWVudHNbaV0gJiYgdGhpcy5lbGVtZW50c1tpXSE9PSB0cnVlICYmIHRoaXMuZWxlbWVudHNbaV0uZ2V0QmFzZUVsZW1lbnQoKSl7XHJcbiAgICAgICAgICAgIG5leHRFbGVtZW50ID0gdGhpcy5lbGVtZW50c1tpXS5nZXRCYXNlRWxlbWVudCgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpICs9IDE7XHJcbiAgICB9XHJcbiAgICBpZihuZXh0RWxlbWVudCl7XHJcbiAgICAgICAgdGhpcy5sYXllckVsZW1lbnQuaW5zZXJ0QmVmb3JlKG5ld0VsZW1lbnQsIG5leHRFbGVtZW50KTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdGhpcy5sYXllckVsZW1lbnQuYXBwZW5kQ2hpbGQobmV3RWxlbWVudCk7XHJcbiAgICB9XHJcbn07XHJcblxyXG5TVkdSZW5kZXJlci5wcm90b3R5cGUuaGlkZSA9IGZ1bmN0aW9uKCl7XHJcbiAgICB0aGlzLmxheWVyRWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xyXG59O1xyXG5cclxuU1ZHUmVuZGVyZXIucHJvdG90eXBlLnNob3cgPSBmdW5jdGlvbigpe1xyXG4gICAgdGhpcy5sYXllckVsZW1lbnQuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7XHJcbn07XHJcblxyXG5TVkdSZW5kZXJlci5wcm90b3R5cGUuc2VhcmNoRXh0cmFDb21wb3NpdGlvbnMgPSBmdW5jdGlvbihhc3NldHMpe1xyXG4gICAgdmFyIGksIGxlbiA9IGFzc2V0cy5sZW5ndGg7XHJcbiAgICB2YXIgZmxvYXRpbmdDb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoc3ZnTlMsJ2cnKTtcclxuICAgIGZvcihpPTA7aTxsZW47aSs9MSl7XHJcbiAgICAgICAgaWYoYXNzZXRzW2ldLnh0KXtcclxuICAgICAgICAgICAgdmFyIGNvbXAgPSB0aGlzLmNyZWF0ZUNvbXAoYXNzZXRzW2ldLGZsb2F0aW5nQ29udGFpbmVyLHRoaXMuZ2xvYmFsRGF0YS5jb21wLG51bGwpO1xyXG4gICAgICAgICAgICBjb21wLmluaXRFeHByZXNzaW9ucygpO1xyXG4gICAgICAgICAgICAvL2NvbXAuY29tcEludGVyZmFjZSA9IENvbXBFeHByZXNzaW9uSW50ZXJmYWNlKGNvbXApO1xyXG4gICAgICAgICAgICAvL0V4cHJlc3Npb25zLmFkZExheWVyc0ludGVyZmFjZShjb21wLmVsZW1lbnRzLCB0aGlzLmdsb2JhbERhdGEucHJvamVjdEludGVyZmFjZSk7XHJcbiAgICAgICAgICAgIHRoaXMuZ2xvYmFsRGF0YS5wcm9qZWN0SW50ZXJmYWNlLnJlZ2lzdGVyQ29tcG9zaXRpb24oY29tcCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59O1xyXG5cbmZ1bmN0aW9uIE1hc2tFbGVtZW50KGRhdGEsZWxlbWVudCxnbG9iYWxEYXRhKSB7XHJcbiAgICB0aGlzLmR5bmFtaWNQcm9wZXJ0aWVzID0gW107XHJcbiAgICB0aGlzLmRhdGEgPSBkYXRhO1xyXG4gICAgdGhpcy5lbGVtZW50ID0gZWxlbWVudDtcclxuICAgIHRoaXMuZ2xvYmFsRGF0YSA9IGdsb2JhbERhdGE7XHJcbiAgICB0aGlzLnBhdGhzID0gW107XHJcbiAgICB0aGlzLnN0b3JlZERhdGEgPSBbXTtcclxuICAgIHRoaXMubWFza3NQcm9wZXJ0aWVzID0gdGhpcy5kYXRhLm1hc2tzUHJvcGVydGllcztcclxuICAgIHRoaXMudmlld0RhdGEgPSBuZXcgQXJyYXkodGhpcy5tYXNrc1Byb3BlcnRpZXMubGVuZ3RoKTtcclxuICAgIHRoaXMubWFza0VsZW1lbnQgPSBudWxsO1xyXG4gICAgdGhpcy5maXJzdEZyYW1lID0gdHJ1ZTtcclxuICAgIHZhciBkZWZzID0gdGhpcy5nbG9iYWxEYXRhLmRlZnM7XHJcbiAgICB2YXIgaSwgbGVuID0gdGhpcy5tYXNrc1Byb3BlcnRpZXMubGVuZ3RoO1xyXG5cclxuXHJcbiAgICB2YXIgcGF0aCwgcHJvcGVydGllcyA9IHRoaXMubWFza3NQcm9wZXJ0aWVzO1xyXG4gICAgdmFyIGNvdW50ID0gMDtcclxuICAgIHZhciBjdXJyZW50TWFza3MgPSBbXTtcclxuICAgIHZhciBqLCBqTGVuO1xyXG4gICAgdmFyIGxheWVySWQgPSByYW5kb21TdHJpbmcoMTApO1xyXG4gICAgdmFyIHJlY3QsIGV4cGFuc29yLCBmZU1vcnBoLHg7XHJcbiAgICB2YXIgbWFza1R5cGUgPSAnY2xpcFBhdGgnLCBtYXNrUmVmID0gJ2NsaXAtcGF0aCc7XHJcbiAgICBmb3IgKGkgPSAwOyBpIDwgbGVuOyBpKyspIHtcclxuXHJcbiAgICAgICAgaWYoKHByb3BlcnRpZXNbaV0ubW9kZSAhPT0gJ2EnICYmIHByb3BlcnRpZXNbaV0ubW9kZSAhPT0gJ24nKXx8IHByb3BlcnRpZXNbaV0uaW52IHx8IHByb3BlcnRpZXNbaV0uby5rICE9PSAxMDApe1xyXG4gICAgICAgICAgICBtYXNrVHlwZSA9ICdtYXNrJztcclxuICAgICAgICAgICAgbWFza1JlZiA9ICdtYXNrJztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmKChwcm9wZXJ0aWVzW2ldLm1vZGUgPT0gJ3MnIHx8IHByb3BlcnRpZXNbaV0ubW9kZSA9PSAnaScpICYmIGNvdW50ID09IDApe1xyXG4gICAgICAgICAgICByZWN0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKHN2Z05TLCAncmVjdCcpO1xyXG4gICAgICAgICAgICByZWN0LnNldEF0dHJpYnV0ZSgnZmlsbCcsICcjZmZmZmZmJyk7XHJcbiAgICAgICAgICAgIHJlY3Quc2V0QXR0cmlidXRlKCd3aWR0aCcsIHRoaXMuZWxlbWVudC5jb21wLmRhdGEudyk7XHJcbiAgICAgICAgICAgIHJlY3Quc2V0QXR0cmlidXRlKCdoZWlnaHQnLCB0aGlzLmVsZW1lbnQuY29tcC5kYXRhLmgpO1xyXG4gICAgICAgICAgICBjdXJyZW50TWFza3MucHVzaChyZWN0KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZWN0ID0gbnVsbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHBhdGggPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoc3ZnTlMsICdwYXRoJyk7XHJcbiAgICAgICAgaWYocHJvcGVydGllc1tpXS5tb2RlID09ICduJykge1xyXG4gICAgICAgICAgICB0aGlzLnZpZXdEYXRhW2ldID0ge1xyXG4gICAgICAgICAgICAgICAgb3A6IFByb3BlcnR5RmFjdG9yeS5nZXRQcm9wKHRoaXMuZWxlbWVudCxwcm9wZXJ0aWVzW2ldLm8sMCwwLjAxLHRoaXMuZHluYW1pY1Byb3BlcnRpZXMpLFxyXG4gICAgICAgICAgICAgICAgcHJvcDogU2hhcGVQcm9wZXJ0eUZhY3RvcnkuZ2V0U2hhcGVQcm9wKHRoaXMuZWxlbWVudCxwcm9wZXJ0aWVzW2ldLDMsdGhpcy5keW5hbWljUHJvcGVydGllcyxudWxsKSxcclxuICAgICAgICAgICAgICAgIGVsZW06IHBhdGhcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgZGVmcy5hcHBlbmRDaGlsZChwYXRoKTtcclxuICAgICAgICAgICAgY29udGludWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvdW50ICs9IDE7XHJcblxyXG4gICAgICAgIGlmKHByb3BlcnRpZXNbaV0ubW9kZSA9PSAncycpe1xyXG4gICAgICAgICAgICBwYXRoLnNldEF0dHJpYnV0ZSgnZmlsbCcsICcjMDAwMDAwJyk7XHJcbiAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgIHBhdGguc2V0QXR0cmlidXRlKCdmaWxsJywgJyNmZmZmZmYnKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcGF0aC5zZXRBdHRyaWJ1dGUoJ2NsaXAtcnVsZScsJ25vbnplcm8nKTtcclxuXHJcbiAgICAgICAgaWYocHJvcGVydGllc1tpXS54LmsgIT09IDApe1xyXG4gICAgICAgICAgICBtYXNrVHlwZSA9ICdtYXNrJztcclxuICAgICAgICAgICAgbWFza1JlZiA9ICdtYXNrJztcclxuICAgICAgICAgICAgeCA9IFByb3BlcnR5RmFjdG9yeS5nZXRQcm9wKHRoaXMuZWxlbWVudCxwcm9wZXJ0aWVzW2ldLngsMCxudWxsLHRoaXMuZHluYW1pY1Byb3BlcnRpZXMpO1xyXG4gICAgICAgICAgICB2YXIgZmlsdGVySUQgPSAnZmlfJytyYW5kb21TdHJpbmcoMTApO1xyXG4gICAgICAgICAgICBleHBhbnNvciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhzdmdOUywnZmlsdGVyJyk7XHJcbiAgICAgICAgICAgIGV4cGFuc29yLnNldEF0dHJpYnV0ZSgnaWQnLGZpbHRlcklEKTtcclxuICAgICAgICAgICAgZmVNb3JwaCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhzdmdOUywnZmVNb3JwaG9sb2d5Jyk7XHJcbiAgICAgICAgICAgIGZlTW9ycGguc2V0QXR0cmlidXRlKCdvcGVyYXRvcicsJ2RpbGF0ZScpO1xyXG4gICAgICAgICAgICBmZU1vcnBoLnNldEF0dHJpYnV0ZSgnaW4nLCdTb3VyY2VHcmFwaGljJyk7XHJcbiAgICAgICAgICAgIGZlTW9ycGguc2V0QXR0cmlidXRlKCdyYWRpdXMnLCcwJyk7XHJcbiAgICAgICAgICAgIGV4cGFuc29yLmFwcGVuZENoaWxkKGZlTW9ycGgpO1xyXG4gICAgICAgICAgICBkZWZzLmFwcGVuZENoaWxkKGV4cGFuc29yKTtcclxuICAgICAgICAgICAgaWYocHJvcGVydGllc1tpXS5tb2RlID09ICdzJyl7XHJcbiAgICAgICAgICAgICAgICBwYXRoLnNldEF0dHJpYnV0ZSgnc3Ryb2tlJywgJyMwMDAwMDAnKTtcclxuICAgICAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgICAgICBwYXRoLnNldEF0dHJpYnV0ZSgnc3Ryb2tlJywgJyNmZmZmZmYnKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICBmZU1vcnBoID0gbnVsbDtcclxuICAgICAgICAgICAgeCA9IG51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgdGhpcy5zdG9yZWREYXRhW2ldID0ge1xyXG4gICAgICAgICAgICAgZWxlbTogcGF0aCxcclxuICAgICAgICAgICAgIHg6IHgsXHJcbiAgICAgICAgICAgICBleHBhbjogZmVNb3JwaCxcclxuICAgICAgICAgICAgbGFzdFBhdGg6ICcnLFxyXG4gICAgICAgICAgICBsYXN0T3BlcmF0b3I6JycsXHJcbiAgICAgICAgICAgIGZpbHRlcklkOmZpbHRlcklELFxyXG4gICAgICAgICAgICBsYXN0UmFkaXVzOjBcclxuICAgICAgICB9O1xyXG4gICAgICAgIGlmKHByb3BlcnRpZXNbaV0ubW9kZSA9PSAnaScpe1xyXG4gICAgICAgICAgICBqTGVuID0gY3VycmVudE1hc2tzLmxlbmd0aDtcclxuICAgICAgICAgICAgdmFyIGcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoc3ZnTlMsJ2cnKTtcclxuICAgICAgICAgICAgZm9yKGo9MDtqPGpMZW47ais9MSl7XHJcbiAgICAgICAgICAgICAgICBnLmFwcGVuZENoaWxkKGN1cnJlbnRNYXNrc1tqXSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdmFyIG1hc2sgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoc3ZnTlMsJ21hc2snKTtcclxuICAgICAgICAgICAgbWFzay5zZXRBdHRyaWJ1dGUoJ21hc2stdHlwZScsJ2FscGhhJyk7XHJcbiAgICAgICAgICAgIG1hc2suc2V0QXR0cmlidXRlKCdpZCcsbGF5ZXJJZCsnXycrY291bnQpO1xyXG4gICAgICAgICAgICBtYXNrLmFwcGVuZENoaWxkKHBhdGgpO1xyXG4gICAgICAgICAgICBkZWZzLmFwcGVuZENoaWxkKG1hc2spO1xyXG4gICAgICAgICAgICBnLnNldEF0dHJpYnV0ZSgnbWFzaycsJ3VybCgjJytsYXllcklkKydfJytjb3VudCsnKScpO1xyXG5cclxuICAgICAgICAgICAgY3VycmVudE1hc2tzLmxlbmd0aCA9IDA7XHJcbiAgICAgICAgICAgIGN1cnJlbnRNYXNrcy5wdXNoKGcpO1xyXG4gICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICBjdXJyZW50TWFza3MucHVzaChwYXRoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYocHJvcGVydGllc1tpXS5pbnYgJiYgIXRoaXMuc29saWRQYXRoKXtcclxuICAgICAgICAgICAgdGhpcy5zb2xpZFBhdGggPSB0aGlzLmNyZWF0ZUxheWVyU29saWRQYXRoKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMudmlld0RhdGFbaV0gPSB7XHJcbiAgICAgICAgICAgIGVsZW06IHBhdGgsXHJcbiAgICAgICAgICAgIGxhc3RQYXRoOiAnJyxcclxuICAgICAgICAgICAgb3A6IFByb3BlcnR5RmFjdG9yeS5nZXRQcm9wKHRoaXMuZWxlbWVudCxwcm9wZXJ0aWVzW2ldLm8sMCwwLjAxLHRoaXMuZHluYW1pY1Byb3BlcnRpZXMpLFxyXG4gICAgICAgICAgICBwcm9wOlNoYXBlUHJvcGVydHlGYWN0b3J5LmdldFNoYXBlUHJvcCh0aGlzLmVsZW1lbnQscHJvcGVydGllc1tpXSwzLHRoaXMuZHluYW1pY1Byb3BlcnRpZXMsbnVsbClcclxuICAgICAgICB9O1xyXG4gICAgICAgIGlmKHJlY3Qpe1xyXG4gICAgICAgICAgICB0aGlzLnZpZXdEYXRhW2ldLmludlJlY3QgPSByZWN0O1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZighdGhpcy52aWV3RGF0YVtpXS5wcm9wLmspe1xyXG4gICAgICAgICAgICB0aGlzLmRyYXdQYXRoKHByb3BlcnRpZXNbaV0sdGhpcy52aWV3RGF0YVtpXS5wcm9wLnYsdGhpcy52aWV3RGF0YVtpXSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHRoaXMubWFza0VsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoc3ZnTlMsIG1hc2tUeXBlKTtcclxuXHJcbiAgICBsZW4gPSBjdXJyZW50TWFza3MubGVuZ3RoO1xyXG4gICAgZm9yKGk9MDtpPGxlbjtpKz0xKXtcclxuICAgICAgICB0aGlzLm1hc2tFbGVtZW50LmFwcGVuZENoaWxkKGN1cnJlbnRNYXNrc1tpXSk7XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5tYXNrRWxlbWVudC5zZXRBdHRyaWJ1dGUoJ2lkJywgbGF5ZXJJZCk7XHJcbiAgICBpZihjb3VudCA+IDApe1xyXG4gICAgICAgIHRoaXMuZWxlbWVudC5tYXNrZWRFbGVtZW50LnNldEF0dHJpYnV0ZShtYXNrUmVmLCBcInVybCgjXCIgKyBsYXllcklkICsgXCIpXCIpO1xyXG4gICAgfVxyXG5cclxuICAgIGRlZnMuYXBwZW5kQ2hpbGQodGhpcy5tYXNrRWxlbWVudCk7XHJcbn07XHJcblxyXG5NYXNrRWxlbWVudC5wcm90b3R5cGUuZ2V0TWFza1Byb3BlcnR5ID0gZnVuY3Rpb24ocG9zKXtcclxuICAgIHJldHVybiB0aGlzLnZpZXdEYXRhW3Bvc10ucHJvcDtcclxufTtcclxuXHJcbk1hc2tFbGVtZW50LnByb3RvdHlwZS5wcmVwYXJlRnJhbWUgPSBmdW5jdGlvbigpe1xyXG4gICAgdmFyIGksIGxlbiA9IHRoaXMuZHluYW1pY1Byb3BlcnRpZXMubGVuZ3RoO1xyXG4gICAgZm9yKGk9MDtpPGxlbjtpKz0xKXtcclxuICAgICAgICB0aGlzLmR5bmFtaWNQcm9wZXJ0aWVzW2ldLmdldFZhbHVlKCk7XHJcblxyXG4gICAgfVxyXG59O1xyXG5cclxuTWFza0VsZW1lbnQucHJvdG90eXBlLnJlbmRlckZyYW1lID0gZnVuY3Rpb24gKGZpbmFsTWF0KSB7XHJcbiAgICB2YXIgaSwgbGVuID0gdGhpcy5tYXNrc1Byb3BlcnRpZXMubGVuZ3RoO1xyXG4gICAgZm9yIChpID0gMDsgaSA8IGxlbjsgaSsrKSB7XHJcbiAgICAgICAgaWYodGhpcy52aWV3RGF0YVtpXS5wcm9wLm1kZiB8fCB0aGlzLmZpcnN0RnJhbWUpe1xyXG4gICAgICAgICAgICB0aGlzLmRyYXdQYXRoKHRoaXMubWFza3NQcm9wZXJ0aWVzW2ldLHRoaXMudmlld0RhdGFbaV0ucHJvcC52LHRoaXMudmlld0RhdGFbaV0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZih0aGlzLnZpZXdEYXRhW2ldLm9wLm1kZiB8fCB0aGlzLmZpcnN0RnJhbWUpe1xyXG4gICAgICAgICAgICB0aGlzLnZpZXdEYXRhW2ldLmVsZW0uc2V0QXR0cmlidXRlKCdmaWxsLW9wYWNpdHknLHRoaXMudmlld0RhdGFbaV0ub3Audik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmKHRoaXMubWFza3NQcm9wZXJ0aWVzW2ldLm1vZGUgIT09ICduJyl7XHJcbiAgICAgICAgICAgIGlmKHRoaXMudmlld0RhdGFbaV0uaW52UmVjdCAmJiAodGhpcy5lbGVtZW50LmZpbmFsVHJhbnNmb3JtLm1Qcm9wLm1kZiB8fCB0aGlzLmZpcnN0RnJhbWUpKXtcclxuICAgICAgICAgICAgICAgIHRoaXMudmlld0RhdGFbaV0uaW52UmVjdC5zZXRBdHRyaWJ1dGUoJ3gnLCAtZmluYWxNYXQucHJvcHNbMTJdKTtcclxuICAgICAgICAgICAgICAgIHRoaXMudmlld0RhdGFbaV0uaW52UmVjdC5zZXRBdHRyaWJ1dGUoJ3knLCAtZmluYWxNYXQucHJvcHNbMTNdKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZih0aGlzLnN0b3JlZERhdGFbaV0ueCAmJiAodGhpcy5zdG9yZWREYXRhW2ldLngubWRmIHx8IHRoaXMuZmlyc3RGcmFtZSkpe1xyXG4gICAgICAgICAgICAgICAgdmFyIGZlTW9ycGggPSB0aGlzLnN0b3JlZERhdGFbaV0uZXhwYW47XHJcbiAgICAgICAgICAgICAgICBpZih0aGlzLnN0b3JlZERhdGFbaV0ueC52IDwgMCl7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYodGhpcy5zdG9yZWREYXRhW2ldLmxhc3RPcGVyYXRvciAhPT0gJ2Vyb2RlJyl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc3RvcmVkRGF0YVtpXS5sYXN0T3BlcmF0b3IgPSAnZXJvZGUnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnN0b3JlZERhdGFbaV0uZWxlbS5zZXRBdHRyaWJ1dGUoJ2ZpbHRlcicsJ3VybCgjJyt0aGlzLnN0b3JlZERhdGFbaV0uZmlsdGVySWQrJyknKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZmVNb3JwaC5zZXRBdHRyaWJ1dGUoJ3JhZGl1cycsLXRoaXMuc3RvcmVkRGF0YVtpXS54LnYpO1xyXG4gICAgICAgICAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYodGhpcy5zdG9yZWREYXRhW2ldLmxhc3RPcGVyYXRvciAhPT0gJ2RpbGF0ZScpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnN0b3JlZERhdGFbaV0ubGFzdE9wZXJhdG9yID0gJ2RpbGF0ZSc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc3RvcmVkRGF0YVtpXS5lbGVtLnNldEF0dHJpYnV0ZSgnZmlsdGVyJyxudWxsKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zdG9yZWREYXRhW2ldLmVsZW0uc2V0QXR0cmlidXRlKCdzdHJva2Utd2lkdGgnLCB0aGlzLnN0b3JlZERhdGFbaV0ueC52KjIpO1xyXG5cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHRoaXMuZmlyc3RGcmFtZSA9IGZhbHNlO1xyXG59O1xyXG5cclxuTWFza0VsZW1lbnQucHJvdG90eXBlLmdldE1hc2tlbGVtZW50ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgcmV0dXJuIHRoaXMubWFza0VsZW1lbnQ7XHJcbn07XHJcblxyXG5NYXNrRWxlbWVudC5wcm90b3R5cGUuY3JlYXRlTGF5ZXJTb2xpZFBhdGggPSBmdW5jdGlvbigpe1xyXG4gICAgdmFyIHBhdGggPSAnTTAsMCAnO1xyXG4gICAgcGF0aCArPSAnIGgnICsgdGhpcy5nbG9iYWxEYXRhLmNvbXBTaXplLncgO1xyXG4gICAgcGF0aCArPSAnIHYnICsgdGhpcy5nbG9iYWxEYXRhLmNvbXBTaXplLmggO1xyXG4gICAgcGF0aCArPSAnIGgtJyArIHRoaXMuZ2xvYmFsRGF0YS5jb21wU2l6ZS53IDtcclxuICAgIHBhdGggKz0gJyB2LScgKyB0aGlzLmdsb2JhbERhdGEuY29tcFNpemUuaCArICcgJztcclxuICAgIHJldHVybiBwYXRoO1xyXG59O1xyXG5cclxuTWFza0VsZW1lbnQucHJvdG90eXBlLmRyYXdQYXRoID0gZnVuY3Rpb24ocGF0aERhdGEscGF0aE5vZGVzLHZpZXdEYXRhKXtcclxuICAgIHZhciBwYXRoU3RyaW5nID0gXCIgTVwiK3BhdGhOb2Rlcy52WzBdWzBdKycsJytwYXRoTm9kZXMudlswXVsxXTtcclxuICAgIHZhciBpLCBsZW47XHJcbiAgICBsZW4gPSBwYXRoTm9kZXMuX2xlbmd0aDtcclxuICAgIGZvcihpPTE7aTxsZW47aSs9MSl7XHJcbiAgICAgICAgLy9wYXRoU3RyaW5nICs9IFwiIENcIitwYXRoTm9kZXMub1tpLTFdWzBdKycsJytwYXRoTm9kZXMub1tpLTFdWzFdICsgXCIgXCIrcGF0aE5vZGVzLmlbaV1bMF0rJywnK3BhdGhOb2Rlcy5pW2ldWzFdICsgXCIgXCIrcGF0aE5vZGVzLnZbaV1bMF0rJywnK3BhdGhOb2Rlcy52W2ldWzFdO1xyXG4gICAgICAgIHBhdGhTdHJpbmcgKz0gXCIgQ1wiK2JtX3JuZChwYXRoTm9kZXMub1tpLTFdWzBdKSsnLCcrYm1fcm5kKHBhdGhOb2Rlcy5vW2ktMV1bMV0pICsgXCIgXCIrYm1fcm5kKHBhdGhOb2Rlcy5pW2ldWzBdKSsnLCcrYm1fcm5kKHBhdGhOb2Rlcy5pW2ldWzFdKSArIFwiIFwiK2JtX3JuZChwYXRoTm9kZXMudltpXVswXSkrJywnK2JtX3JuZChwYXRoTm9kZXMudltpXVsxXSk7XHJcbiAgICB9XHJcbiAgICAgICAgLy9wYXRoU3RyaW5nICs9IFwiIENcIitwYXRoTm9kZXMub1tpLTFdWzBdKycsJytwYXRoTm9kZXMub1tpLTFdWzFdICsgXCIgXCIrcGF0aE5vZGVzLmlbMF1bMF0rJywnK3BhdGhOb2Rlcy5pWzBdWzFdICsgXCIgXCIrcGF0aE5vZGVzLnZbMF1bMF0rJywnK3BhdGhOb2Rlcy52WzBdWzFdO1xyXG4gICAgaWYocGF0aE5vZGVzLmMgJiYgbGVuID4gMSl7XHJcbiAgICAgICAgcGF0aFN0cmluZyArPSBcIiBDXCIrYm1fcm5kKHBhdGhOb2Rlcy5vW2ktMV1bMF0pKycsJytibV9ybmQocGF0aE5vZGVzLm9baS0xXVsxXSkgKyBcIiBcIitibV9ybmQocGF0aE5vZGVzLmlbMF1bMF0pKycsJytibV9ybmQocGF0aE5vZGVzLmlbMF1bMV0pICsgXCIgXCIrYm1fcm5kKHBhdGhOb2Rlcy52WzBdWzBdKSsnLCcrYm1fcm5kKHBhdGhOb2Rlcy52WzBdWzFdKTtcclxuICAgIH1cclxuICAgIC8vcGF0aE5vZGVzLl9fcmVuZGVyZWRTdHJpbmcgPSBwYXRoU3RyaW5nO1xyXG5cclxuXHJcbiAgICBpZih2aWV3RGF0YS5sYXN0UGF0aCAhPT0gcGF0aFN0cmluZyl7XHJcbiAgICAgICAgaWYodmlld0RhdGEuZWxlbSl7XHJcbiAgICAgICAgICAgIGlmKCFwYXRoTm9kZXMuYyl7XHJcbiAgICAgICAgICAgICAgICB2aWV3RGF0YS5lbGVtLnNldEF0dHJpYnV0ZSgnZCcsJycpO1xyXG4gICAgICAgICAgICB9ZWxzZSBpZihwYXRoRGF0YS5pbnYpe1xyXG4gICAgICAgICAgICAgICAgdmlld0RhdGEuZWxlbS5zZXRBdHRyaWJ1dGUoJ2QnLHRoaXMuc29saWRQYXRoICsgcGF0aFN0cmluZyk7XHJcbiAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgdmlld0RhdGEuZWxlbS5zZXRBdHRyaWJ1dGUoJ2QnLHBhdGhTdHJpbmcpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZpZXdEYXRhLmxhc3RQYXRoID0gcGF0aFN0cmluZztcclxuICAgIH1cclxufTtcclxuXHJcbk1hc2tFbGVtZW50LnByb3RvdHlwZS5nZXRNYXNrID0gZnVuY3Rpb24obm0pe1xyXG4gICAgdmFyIGkgPSAwLCBsZW4gPSB0aGlzLm1hc2tzUHJvcGVydGllcy5sZW5ndGg7XHJcbiAgICB3aGlsZShpPGxlbil7XHJcbiAgICAgICAgaWYodGhpcy5tYXNrc1Byb3BlcnRpZXNbaV0ubm0gPT09IG5tKXtcclxuICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgIG1hc2tQYXRoOiB0aGlzLnZpZXdEYXRhW2ldLnByb3AucHZcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpICs9IDE7XHJcbiAgICB9XHJcbn07XHJcblxyXG5NYXNrRWxlbWVudC5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uKCl7XHJcbiAgICB0aGlzLmVsZW1lbnQgPSBudWxsO1xyXG4gICAgdGhpcy5nbG9iYWxEYXRhID0gbnVsbDtcclxuICAgIHRoaXMubWFza0VsZW1lbnQgPSBudWxsO1xyXG4gICAgdGhpcy5kYXRhID0gbnVsbDtcclxuICAgIHRoaXMucGF0aHMgPSBudWxsO1xyXG4gICAgdGhpcy5tYXNrc1Byb3BlcnRpZXMgPSBudWxsO1xyXG59O1xuZnVuY3Rpb24gQmFzZUVsZW1lbnQoKXtcclxufTtcclxuQmFzZUVsZW1lbnQucHJvdG90eXBlLmNoZWNrTWFza3MgPSBmdW5jdGlvbigpe1xyXG4gICAgaWYoIXRoaXMuZGF0YS5oYXNNYXNrKXtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgICB2YXIgaSA9IDAsIGxlbiA9IHRoaXMuZGF0YS5tYXNrc1Byb3BlcnRpZXMubGVuZ3RoO1xyXG4gICAgd2hpbGUoaTxsZW4pIHtcclxuICAgICAgICBpZigodGhpcy5kYXRhLm1hc2tzUHJvcGVydGllc1tpXS5tb2RlICE9PSAnbicgJiYgdGhpcy5kYXRhLm1hc2tzUHJvcGVydGllc1tpXS5jbCAhPT0gZmFsc2UpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpICs9IDE7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gZmFsc2U7XHJcbn1cclxuXHJcbkJhc2VFbGVtZW50LnByb3RvdHlwZS5jaGVja1BhcmVudGluZyA9IGZ1bmN0aW9uKCl7XHJcbiAgICBpZih0aGlzLmRhdGEucGFyZW50ICE9PSB1bmRlZmluZWQpe1xyXG4gICAgICAgIHRoaXMuY29tcC5idWlsZEVsZW1lbnRQYXJlbnRpbmcodGhpcywgdGhpcy5kYXRhLnBhcmVudCk7XHJcbiAgICB9XHJcbn1cclxuXHJcbkJhc2VFbGVtZW50LnByb3RvdHlwZS5wcmVwYXJlRnJhbWUgPSBmdW5jdGlvbihudW0pe1xyXG4gICAgaWYodGhpcy5kYXRhLmlwIC0gdGhpcy5kYXRhLnN0IDw9IG51bSAmJiB0aGlzLmRhdGEub3AgLSB0aGlzLmRhdGEuc3QgPiBudW0pXHJcbiAgICB7XHJcbiAgICAgICAgaWYodGhpcy5pc1Zpc2libGUgIT09IHRydWUpe1xyXG4gICAgICAgICAgICB0aGlzLmVsZW1NZGYgPSB0cnVlO1xyXG4gICAgICAgICAgICB0aGlzLmdsb2JhbERhdGEubWRmID0gdHJ1ZTtcclxuICAgICAgICAgICAgdGhpcy5pc1Zpc2libGUgPSB0cnVlO1xyXG4gICAgICAgICAgICB0aGlzLmZpcnN0RnJhbWUgPSB0cnVlO1xyXG4gICAgICAgICAgICBpZih0aGlzLmRhdGEuaGFzTWFzayl7XHJcbiAgICAgICAgICAgICAgICB0aGlzLm1hc2tNYW5hZ2VyLmZpcnN0RnJhbWUgPSB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfWVsc2V7XHJcbiAgICAgICAgaWYodGhpcy5pc1Zpc2libGUgIT09IGZhbHNlKXtcclxuICAgICAgICAgICAgdGhpcy5lbGVtTWRmID0gdHJ1ZTtcclxuICAgICAgICAgICAgdGhpcy5nbG9iYWxEYXRhLm1kZiA9IHRydWU7XHJcbiAgICAgICAgICAgIHRoaXMuaXNWaXNpYmxlID0gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgdmFyIGksIGxlbiA9IHRoaXMuZHluYW1pY1Byb3BlcnRpZXMubGVuZ3RoO1xyXG4gICAgZm9yKGk9MDtpPGxlbjtpKz0xKXtcclxuICAgICAgICBpZih0aGlzLmlzVmlzaWJsZSB8fCAodGhpcy5faXNQYXJlbnQgJiYgdGhpcy5keW5hbWljUHJvcGVydGllc1tpXS50eXBlID09PSAndHJhbnNmb3JtJykpe1xyXG4gICAgICAgICAgICB0aGlzLmR5bmFtaWNQcm9wZXJ0aWVzW2ldLmdldFZhbHVlKCk7XHJcbiAgICAgICAgICAgIGlmKHRoaXMuZHluYW1pY1Byb3BlcnRpZXNbaV0ubWRmKXtcclxuICAgICAgICAgICAgICAgIHRoaXMuZWxlbU1kZiA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmdsb2JhbERhdGEubWRmID0gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGlmKHRoaXMuZGF0YS5oYXNNYXNrICYmIHRoaXMuaXNWaXNpYmxlKXtcclxuICAgICAgICB0aGlzLm1hc2tNYW5hZ2VyLnByZXBhcmVGcmFtZShudW0qdGhpcy5kYXRhLnNyKTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgLyogVE9ETyBjaGVjayB0aGlzXHJcbiAgICBpZih0aGlzLmRhdGEuc3kpe1xyXG4gICAgICAgIGlmKHRoaXMuZGF0YS5zeVswXS5yZW5kZXJlZERhdGFbbnVtXSl7XHJcbiAgICAgICAgICAgIGlmKHRoaXMuZGF0YS5zeVswXS5yZW5kZXJlZERhdGFbbnVtXS5jKXtcclxuICAgICAgICAgICAgICAgIHRoaXMuZmVGbG9vZC5zZXRBdHRyaWJ1dGUoJ2Zsb29kLWNvbG9yJywncmdiKCcrTWF0aC5yb3VuZCh0aGlzLmRhdGEuc3lbMF0ucmVuZGVyZWREYXRhW251bV0uY1swXSkrJywnK01hdGgucm91bmQodGhpcy5kYXRhLnN5WzBdLnJlbmRlcmVkRGF0YVtudW1dLmNbMV0pKycsJytNYXRoLnJvdW5kKHRoaXMuZGF0YS5zeVswXS5yZW5kZXJlZERhdGFbbnVtXS5jWzJdKSsnKScpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmKHRoaXMuZGF0YS5zeVswXS5yZW5kZXJlZERhdGFbbnVtXS5zKXtcclxuICAgICAgICAgICAgICAgIHRoaXMuZmVNb3JwaC5zZXRBdHRyaWJ1dGUoJ3JhZGl1cycsdGhpcy5kYXRhLnN5WzBdLnJlbmRlcmVkRGF0YVtudW1dLnMpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgKi9cclxuXHJcblxyXG4gICAgdGhpcy5jdXJyZW50RnJhbWVOdW0gPSBudW0qdGhpcy5kYXRhLnNyO1xyXG4gICAgcmV0dXJuIHRoaXMuaXNWaXNpYmxlO1xyXG59O1xyXG5cclxuQmFzZUVsZW1lbnQucHJvdG90eXBlLmdsb2JhbFRvTG9jYWwgPSBmdW5jdGlvbihwdCl7XHJcbiAgICB2YXIgdHJhbnNmb3JtcyA9IFtdO1xyXG4gICAgdHJhbnNmb3Jtcy5wdXNoKHRoaXMuZmluYWxUcmFuc2Zvcm0pO1xyXG4gICAgdmFyIGZsYWcgPSB0cnVlO1xyXG4gICAgdmFyIGNvbXAgPSB0aGlzLmNvbXA7XHJcbiAgICB3aGlsZShmbGFnKXtcclxuICAgICAgICBpZihjb21wLmZpbmFsVHJhbnNmb3JtKXtcclxuICAgICAgICAgICAgaWYoY29tcC5kYXRhLmhhc01hc2spe1xyXG4gICAgICAgICAgICAgICAgdHJhbnNmb3Jtcy5zcGxpY2UoMCwwLGNvbXAuZmluYWxUcmFuc2Zvcm0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNvbXAgPSBjb21wLmNvbXA7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgZmxhZyA9IGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHZhciBpLCBsZW4gPSB0cmFuc2Zvcm1zLmxlbmd0aCxwdE5ldztcclxuICAgIGZvcihpPTA7aTxsZW47aSs9MSl7XHJcbiAgICAgICAgcHROZXcgPSB0cmFuc2Zvcm1zW2ldLm1hdC5hcHBseVRvUG9pbnRBcnJheSgwLDAsMCk7XHJcbiAgICAgICAgLy9wdE5ldyA9IHRyYW5zZm9ybXNbaV0ubWF0LmFwcGx5VG9Qb2ludEFycmF5KHB0WzBdLHB0WzFdLHB0WzJdKTtcclxuICAgICAgICBwdCA9IFtwdFswXSAtIHB0TmV3WzBdLHB0WzFdIC0gcHROZXdbMV0sMF07XHJcbiAgICB9XHJcbiAgICByZXR1cm4gcHQ7XHJcbn07XHJcblxyXG5CYXNlRWxlbWVudC5wcm90b3R5cGUuaW5pdEV4cHJlc3Npb25zID0gZnVuY3Rpb24oKXtcclxuICAgIHRoaXMubGF5ZXJJbnRlcmZhY2UgPSBMYXllckV4cHJlc3Npb25JbnRlcmZhY2UodGhpcyk7XHJcbiAgICAvL2xheWVyc1tpXS5sYXllckludGVyZmFjZSA9IExheWVyRXhwcmVzc2lvbkludGVyZmFjZShsYXllcnNbaV0pO1xyXG4gICAgLy9sYXllcnNbaV0ubGF5ZXJJbnRlcmZhY2UgPSBMYXllckV4cHJlc3Npb25JbnRlcmZhY2UobGF5ZXJzW2ldKTtcclxuICAgIGlmKHRoaXMuZGF0YS5oYXNNYXNrKXtcclxuICAgICAgICB0aGlzLmxheWVySW50ZXJmYWNlLnJlZ2lzdGVyTWFza0ludGVyZmFjZSh0aGlzLm1hc2tNYW5hZ2VyKTtcclxuICAgIH1cclxuICAgIHZhciBlZmZlY3RzSW50ZXJmYWNlID0gRWZmZWN0c0V4cHJlc3Npb25JbnRlcmZhY2UuY3JlYXRlRWZmZWN0c0ludGVyZmFjZSh0aGlzLHRoaXMubGF5ZXJJbnRlcmZhY2UpO1xyXG4gICAgdGhpcy5sYXllckludGVyZmFjZS5yZWdpc3RlckVmZmVjdHNJbnRlcmZhY2UoZWZmZWN0c0ludGVyZmFjZSk7XHJcblxyXG4gICAgaWYodGhpcy5kYXRhLnR5ID09PSAwIHx8IHRoaXMuZGF0YS54dCl7XHJcbiAgICAgICAgdGhpcy5jb21wSW50ZXJmYWNlID0gQ29tcEV4cHJlc3Npb25JbnRlcmZhY2UodGhpcyk7XHJcbiAgICB9IGVsc2UgaWYodGhpcy5kYXRhLnR5ID09PSA0KXtcclxuICAgICAgICB0aGlzLmxheWVySW50ZXJmYWNlLnNoYXBlSW50ZXJmYWNlID0gU2hhcGVFeHByZXNzaW9uSW50ZXJmYWNlLmNyZWF0ZVNoYXBlSW50ZXJmYWNlKHRoaXMuc2hhcGVzRGF0YSx0aGlzLml0ZW1zRGF0YSx0aGlzLmxheWVySW50ZXJmYWNlKTtcclxuICAgIH0gZWxzZSBpZih0aGlzLmRhdGEudHkgPT09IDUpe1xyXG4gICAgICAgIHRoaXMubGF5ZXJJbnRlcmZhY2UudGV4dEludGVyZmFjZSA9IFRleHRFeHByZXNzaW9uSW50ZXJmYWNlKHRoaXMpO1xyXG4gICAgfVxyXG59XHJcblxyXG5CYXNlRWxlbWVudC5wcm90b3R5cGUuc2V0QmxlbmRNb2RlID0gZnVuY3Rpb24oKXtcclxuICAgIHZhciBibGVuZE1vZGVWYWx1ZSA9ICcnO1xyXG4gICAgc3dpdGNoKHRoaXMuZGF0YS5ibSl7XHJcbiAgICAgICAgY2FzZSAxOlxyXG4gICAgICAgICAgICBibGVuZE1vZGVWYWx1ZSA9ICdtdWx0aXBseSc7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgMjpcclxuICAgICAgICAgICAgYmxlbmRNb2RlVmFsdWUgPSAnc2NyZWVuJztcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAzOlxyXG4gICAgICAgICAgICBibGVuZE1vZGVWYWx1ZSA9ICdvdmVybGF5JztcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSA0OlxyXG4gICAgICAgICAgICBibGVuZE1vZGVWYWx1ZSA9ICdkYXJrZW4nO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlIDU6XHJcbiAgICAgICAgICAgIGJsZW5kTW9kZVZhbHVlID0gJ2xpZ2h0ZW4nO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlIDY6XHJcbiAgICAgICAgICAgIGJsZW5kTW9kZVZhbHVlID0gJ2NvbG9yLWRvZGdlJztcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSA3OlxyXG4gICAgICAgICAgICBibGVuZE1vZGVWYWx1ZSA9ICdjb2xvci1idXJuJztcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSA4OlxyXG4gICAgICAgICAgICBibGVuZE1vZGVWYWx1ZSA9ICdoYXJkLWxpZ2h0JztcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSA5OlxyXG4gICAgICAgICAgICBibGVuZE1vZGVWYWx1ZSA9ICdzb2Z0LWxpZ2h0JztcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAxMDpcclxuICAgICAgICAgICAgYmxlbmRNb2RlVmFsdWUgPSAnZGlmZmVyZW5jZSc7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgMTE6XHJcbiAgICAgICAgICAgIGJsZW5kTW9kZVZhbHVlID0gJ2V4Y2x1c2lvbic7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgMTI6XHJcbiAgICAgICAgICAgIGJsZW5kTW9kZVZhbHVlID0gJ2h1ZSc7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgMTM6XHJcbiAgICAgICAgICAgIGJsZW5kTW9kZVZhbHVlID0gJ3NhdHVyYXRpb24nO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlIDE0OlxyXG4gICAgICAgICAgICBibGVuZE1vZGVWYWx1ZSA9ICdjb2xvcic7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgMTU6XHJcbiAgICAgICAgICAgIGJsZW5kTW9kZVZhbHVlID0gJ2x1bWlub3NpdHknO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgIH1cclxuICAgIHZhciBlbGVtID0gdGhpcy5iYXNlRWxlbWVudCB8fCB0aGlzLmxheWVyRWxlbWVudDtcclxuXHJcbiAgICBlbGVtLnN0eWxlWydtaXgtYmxlbmQtbW9kZSddID0gYmxlbmRNb2RlVmFsdWU7XHJcbn1cclxuXHJcbkJhc2VFbGVtZW50LnByb3RvdHlwZS5pbml0ID0gZnVuY3Rpb24oKXtcclxuICAgIGlmKCF0aGlzLmRhdGEuc3Ipe1xyXG4gICAgICAgIHRoaXMuZGF0YS5zciA9IDE7XHJcbiAgICB9XHJcbiAgICB0aGlzLmR5bmFtaWNQcm9wZXJ0aWVzID0gW107XHJcbiAgICBpZih0aGlzLmRhdGEuZWYpe1xyXG4gICAgICAgIHRoaXMuZWZmZWN0cyA9IG5ldyBFZmZlY3RzTWFuYWdlcih0aGlzLmRhdGEsdGhpcyx0aGlzLmR5bmFtaWNQcm9wZXJ0aWVzKTtcclxuICAgICAgICAvL3RoaXMuZWZmZWN0ID0gdGhpcy5lZmZlY3RzTWFuYWdlci5iaW5kKHRoaXMuZWZmZWN0c01hbmFnZXIpO1xyXG4gICAgfVxyXG4gICAgLy90aGlzLmVsZW1JbnRlcmZhY2UgPSBidWlsZExheWVyRXhwcmVzc2lvbkludGVyZmFjZSh0aGlzKTtcclxuICAgIHRoaXMuaGlkZGVuID0gZmFsc2U7XHJcbiAgICB0aGlzLmZpcnN0RnJhbWUgPSB0cnVlO1xyXG4gICAgdGhpcy5pc1Zpc2libGUgPSBmYWxzZTtcclxuICAgIHRoaXMuX2lzUGFyZW50ID0gZmFsc2U7XHJcbiAgICB0aGlzLmN1cnJlbnRGcmFtZU51bSA9IC05OTk5OTtcclxuICAgIHRoaXMubGFzdE51bSA9IC05OTk5OTtcclxuICAgIGlmKHRoaXMuZGF0YS5rcyl7XHJcbiAgICAgICAgdGhpcy5maW5hbFRyYW5zZm9ybSA9IHtcclxuICAgICAgICAgICAgbVByb3A6IFByb3BlcnR5RmFjdG9yeS5nZXRQcm9wKHRoaXMsdGhpcy5kYXRhLmtzLDIsbnVsbCx0aGlzLmR5bmFtaWNQcm9wZXJ0aWVzKSxcclxuICAgICAgICAgICAgbWF0TWRmOiBmYWxzZSxcclxuICAgICAgICAgICAgb3BNZGY6IGZhbHNlLFxyXG4gICAgICAgICAgICBtYXQ6IG5ldyBNYXRyaXgoKSxcclxuICAgICAgICAgICAgb3BhY2l0eTogMVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgaWYodGhpcy5kYXRhLmFvKXtcclxuICAgICAgICAgICAgdGhpcy5maW5hbFRyYW5zZm9ybS5tUHJvcC5hdXRvT3JpZW50ZWQgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmZpbmFsVHJhbnNmb3JtLm9wID0gdGhpcy5maW5hbFRyYW5zZm9ybS5tUHJvcC5vO1xyXG4gICAgICAgIHRoaXMudHJhbnNmb3JtID0gdGhpcy5maW5hbFRyYW5zZm9ybS5tUHJvcDtcclxuICAgICAgICBpZih0aGlzLmRhdGEudHkgIT09IDExKXtcclxuICAgICAgICAgICAgdGhpcy5jcmVhdGVFbGVtZW50cygpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZih0aGlzLmRhdGEuaGFzTWFzayl7XHJcbiAgICAgICAgICAgIHRoaXMuYWRkTWFza3ModGhpcy5kYXRhKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICB0aGlzLmVsZW1NZGYgPSBmYWxzZTtcclxufTtcclxuQmFzZUVsZW1lbnQucHJvdG90eXBlLmdldFR5cGUgPSBmdW5jdGlvbigpe1xyXG4gICAgcmV0dXJuIHRoaXMudHlwZTtcclxufTtcclxuXHJcbkJhc2VFbGVtZW50LnByb3RvdHlwZS5yZXNldEhpZXJhcmNoeSA9IGZ1bmN0aW9uKCl7XHJcbiAgICBpZighdGhpcy5oaWVyYXJjaHkpe1xyXG4gICAgICAgIHRoaXMuaGllcmFyY2h5ID0gW107XHJcbiAgICB9ZWxzZXtcclxuICAgICAgICB0aGlzLmhpZXJhcmNoeS5sZW5ndGggPSAwO1xyXG4gICAgfVxyXG59O1xyXG5cclxuQmFzZUVsZW1lbnQucHJvdG90eXBlLmdldEhpZXJhcmNoeSA9IGZ1bmN0aW9uKCl7XHJcbiAgICBpZighdGhpcy5oaWVyYXJjaHkpe1xyXG4gICAgICAgIHRoaXMuaGllcmFyY2h5ID0gW107XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdGhpcy5oaWVyYXJjaHk7XHJcbn07XHJcblxyXG5CYXNlRWxlbWVudC5wcm90b3R5cGUuc2V0SGllcmFyY2h5ID0gZnVuY3Rpb24oaGllcmFyY2h5KXtcclxuICAgIHRoaXMuaGllcmFyY2h5ID0gaGllcmFyY2h5O1xyXG59O1xyXG5cclxuQmFzZUVsZW1lbnQucHJvdG90eXBlLmdldExheWVyU2l6ZSA9IGZ1bmN0aW9uKCl7XHJcbiAgICBpZih0aGlzLmRhdGEudHkgPT09IDUpe1xyXG4gICAgICAgIHJldHVybiB7dzp0aGlzLmRhdGEudGV4dERhdGEud2lkdGgsaDp0aGlzLmRhdGEudGV4dERhdGEuaGVpZ2h0fTtcclxuICAgIH1lbHNle1xyXG4gICAgICAgIHJldHVybiB7dzp0aGlzLmRhdGEud2lkdGgsaDp0aGlzLmRhdGEuaGVpZ2h0fTtcclxuICAgIH1cclxufTtcclxuXHJcbkJhc2VFbGVtZW50LnByb3RvdHlwZS5oaWRlID0gZnVuY3Rpb24oKXtcclxuXHJcbn07XHJcblxyXG5CYXNlRWxlbWVudC5wcm90b3R5cGUubUhlbHBlciA9IG5ldyBNYXRyaXgoKTtcbmZ1bmN0aW9uIFNWR0Jhc2VFbGVtZW50KGRhdGEscGFyZW50Q29udGFpbmVyLGdsb2JhbERhdGEsY29tcCwgcGxhY2Vob2xkZXIpe1xyXG4gICAgdGhpcy5nbG9iYWxEYXRhID0gZ2xvYmFsRGF0YTtcclxuICAgIHRoaXMuY29tcCA9IGNvbXA7XHJcbiAgICB0aGlzLmRhdGEgPSBkYXRhO1xyXG4gICAgdGhpcy5tYXR0ZUVsZW1lbnQgPSBudWxsO1xyXG4gICAgdGhpcy50cmFuc2Zvcm1lZEVsZW1lbnQgPSBudWxsO1xyXG4gICAgdGhpcy5pc1RyYW5zcGFyZW50ID0gZmFsc2U7XHJcbiAgICB0aGlzLnBhcmVudENvbnRhaW5lciA9IHBhcmVudENvbnRhaW5lcjtcclxuICAgIHRoaXMubGF5ZXJJZCA9IHBsYWNlaG9sZGVyID8gcGxhY2Vob2xkZXIubGF5ZXJJZCA6ICdseV8nK3JhbmRvbVN0cmluZygxMCk7XHJcbiAgICB0aGlzLnBsYWNlaG9sZGVyID0gcGxhY2Vob2xkZXI7XHJcbiAgICB0aGlzLmluaXQoKTtcclxufTtcclxuXHJcbmNyZWF0ZUVsZW1lbnQoQmFzZUVsZW1lbnQsIFNWR0Jhc2VFbGVtZW50KTtcclxuXHJcblNWR0Jhc2VFbGVtZW50LnByb3RvdHlwZS5jcmVhdGVFbGVtZW50cyA9IGZ1bmN0aW9uKCl7XHJcbiAgICB0aGlzLmxheWVyRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhzdmdOUywnZycpO1xyXG4gICAgdGhpcy50cmFuc2Zvcm1lZEVsZW1lbnQgPSB0aGlzLmxheWVyRWxlbWVudDtcclxuICAgIGlmKHRoaXMuZGF0YS5oYXNNYXNrKXtcclxuICAgICAgICB0aGlzLm1hc2tlZEVsZW1lbnQgPSB0aGlzLmxheWVyRWxlbWVudDtcclxuICAgIH1cclxuICAgIHZhciBsYXllckVsZW1lbnRQYXJlbnQgPSBudWxsO1xyXG4gICAgaWYodGhpcy5kYXRhLnRkKXtcclxuICAgICAgICBpZih0aGlzLmRhdGEudGQgPT0gMyB8fCB0aGlzLmRhdGEudGQgPT0gMSl7XHJcbiAgICAgICAgICAgIHZhciBtYXNrZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoc3ZnTlMsJ21hc2snKTtcclxuICAgICAgICAgICAgbWFza2VyLnNldEF0dHJpYnV0ZSgnaWQnLHRoaXMubGF5ZXJJZCk7XHJcbiAgICAgICAgICAgIG1hc2tlci5zZXRBdHRyaWJ1dGUoJ21hc2stdHlwZScsdGhpcy5kYXRhLnRkID09IDMgPyAnbHVtaW5hbmNlJzonYWxwaGEnKTtcclxuICAgICAgICAgICAgbWFza2VyLmFwcGVuZENoaWxkKHRoaXMubGF5ZXJFbGVtZW50KTtcclxuICAgICAgICAgICAgbGF5ZXJFbGVtZW50UGFyZW50ID0gbWFza2VyO1xyXG4gICAgICAgICAgICB0aGlzLmdsb2JhbERhdGEuZGVmcy5hcHBlbmRDaGlsZChtYXNrZXIpO1xyXG4gICAgICAgICAgICAvLy8vLy8gVGhpcyBpcyBvbmx5IGZvciBJRSBhbmQgRWRnZSB3aGVuIG1hc2sgaWYgb2YgdHlwZSBhbHBoYVxyXG4gICAgICAgICAgICBpZighZmVhdHVyZVN1cHBvcnQubWFza1R5cGUgJiYgdGhpcy5kYXRhLnRkID09IDEpe1xyXG4gICAgICAgICAgICAgICAgbWFza2VyLnNldEF0dHJpYnV0ZSgnbWFzay10eXBlJywnbHVtaW5hbmNlJyk7XHJcbiAgICAgICAgICAgICAgICB2YXIgZmlsSWQgPSByYW5kb21TdHJpbmcoMTApO1xyXG4gICAgICAgICAgICAgICAgdmFyIGZpbCA9IGZpbHRlcnNGYWN0b3J5LmNyZWF0ZUZpbHRlcihmaWxJZCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmdsb2JhbERhdGEuZGVmcy5hcHBlbmRDaGlsZChmaWwpO1xyXG4gICAgICAgICAgICAgICAgZmlsLmFwcGVuZENoaWxkKGZpbHRlcnNGYWN0b3J5LmNyZWF0ZUFscGhhVG9MdW1pbmFuY2VGaWx0ZXIoKSk7XHJcbiAgICAgICAgICAgICAgICB2YXIgZ2cgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoc3ZnTlMsJ2cnKTtcclxuICAgICAgICAgICAgICAgIGdnLmFwcGVuZENoaWxkKHRoaXMubGF5ZXJFbGVtZW50KTtcclxuICAgICAgICAgICAgICAgIGxheWVyRWxlbWVudFBhcmVudCA9IGdnO1xyXG4gICAgICAgICAgICAgICAgbWFza2VyLmFwcGVuZENoaWxkKGdnKTtcclxuICAgICAgICAgICAgICAgIGdnLnNldEF0dHJpYnV0ZSgnZmlsdGVyJywndXJsKCMnK2ZpbElkKycpJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9ZWxzZSBpZih0aGlzLmRhdGEudGQgPT0gMil7XHJcbiAgICAgICAgICAgIHZhciBtYXNrR3JvdXAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoc3ZnTlMsJ21hc2snKTtcclxuICAgICAgICAgICAgbWFza0dyb3VwLnNldEF0dHJpYnV0ZSgnaWQnLHRoaXMubGF5ZXJJZCk7XHJcbiAgICAgICAgICAgIG1hc2tHcm91cC5zZXRBdHRyaWJ1dGUoJ21hc2stdHlwZScsJ2FscGhhJyk7XHJcbiAgICAgICAgICAgIHZhciBtYXNrR3JvdXBlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhzdmdOUywnZycpO1xyXG4gICAgICAgICAgICBtYXNrR3JvdXAuYXBwZW5kQ2hpbGQobWFza0dyb3VwZXIpO1xyXG4gICAgICAgICAgICB2YXIgZmlsSWQgPSByYW5kb21TdHJpbmcoMTApO1xyXG4gICAgICAgICAgICB2YXIgZmlsID0gZmlsdGVyc0ZhY3RvcnkuY3JlYXRlRmlsdGVyKGZpbElkKTtcclxuICAgICAgICAgICAgLy8vL1xyXG5cclxuICAgICAgICAgICAgdmFyIGZlQ29sb3JNYXRyaXggPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoc3ZnTlMsJ2ZlQ29sb3JNYXRyaXgnKTtcclxuICAgICAgICAgICAgZmVDb2xvck1hdHJpeC5zZXRBdHRyaWJ1dGUoJ3R5cGUnLCdtYXRyaXgnKTtcclxuICAgICAgICAgICAgZmVDb2xvck1hdHJpeC5zZXRBdHRyaWJ1dGUoJ2NvbG9yLWludGVycG9sYXRpb24tZmlsdGVycycsJ3NSR0InKTtcclxuICAgICAgICAgICAgZmVDb2xvck1hdHJpeC5zZXRBdHRyaWJ1dGUoJ3ZhbHVlcycsJzEgMCAwIDAgMCAwIDEgMCAwIDAgMCAwIDEgMCAwIDAgMCAwIC0xIDEnKTtcclxuICAgICAgICAgICAgZmlsLmFwcGVuZENoaWxkKGZlQ29sb3JNYXRyaXgpO1xyXG5cclxuICAgICAgICAgICAgLy8vL1xyXG4gICAgICAgICAgICAvKnZhciBmZUNUciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhzdmdOUywnZmVDb21wb25lbnRUcmFuc2ZlcicpO1xyXG4gICAgICAgICAgICBmZUNUci5zZXRBdHRyaWJ1dGUoJ2luJywnU291cmNlR3JhcGhpYycpO1xyXG4gICAgICAgICAgICBmaWwuYXBwZW5kQ2hpbGQoZmVDVHIpO1xyXG4gICAgICAgICAgICB2YXIgZmVGdW5jID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKHN2Z05TLCdmZUZ1bmNBJyk7XHJcbiAgICAgICAgICAgIGZlRnVuYy5zZXRBdHRyaWJ1dGUoJ3R5cGUnLCd0YWJsZScpO1xyXG4gICAgICAgICAgICBmZUZ1bmMuc2V0QXR0cmlidXRlKCd0YWJsZVZhbHVlcycsJzEuMCAwLjAnKTtcclxuICAgICAgICAgICAgZmVDVHIuYXBwZW5kQ2hpbGQoZmVGdW5jKTsqL1xyXG4gICAgICAgICAgICB0aGlzLmdsb2JhbERhdGEuZGVmcy5hcHBlbmRDaGlsZChmaWwpO1xyXG4gICAgICAgICAgICB2YXIgYWxwaGFSZWN0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKHN2Z05TLCdyZWN0Jyk7XHJcbiAgICAgICAgICAgIGFscGhhUmVjdC5zZXRBdHRyaWJ1dGUoJ3dpZHRoJyx0aGlzLmNvbXAuZGF0YS53KTtcclxuICAgICAgICAgICAgYWxwaGFSZWN0LnNldEF0dHJpYnV0ZSgnaGVpZ2h0Jyx0aGlzLmNvbXAuZGF0YS5oKTtcclxuICAgICAgICAgICAgYWxwaGFSZWN0LnNldEF0dHJpYnV0ZSgneCcsJzAnKTtcclxuICAgICAgICAgICAgYWxwaGFSZWN0LnNldEF0dHJpYnV0ZSgneScsJzAnKTtcclxuICAgICAgICAgICAgYWxwaGFSZWN0LnNldEF0dHJpYnV0ZSgnZmlsbCcsJyNmZmZmZmYnKTtcclxuICAgICAgICAgICAgYWxwaGFSZWN0LnNldEF0dHJpYnV0ZSgnb3BhY2l0eScsJzAnKTtcclxuICAgICAgICAgICAgbWFza0dyb3VwZXIuc2V0QXR0cmlidXRlKCdmaWx0ZXInLCd1cmwoIycrZmlsSWQrJyknKTtcclxuICAgICAgICAgICAgbWFza0dyb3VwZXIuYXBwZW5kQ2hpbGQoYWxwaGFSZWN0KTtcclxuICAgICAgICAgICAgbWFza0dyb3VwZXIuYXBwZW5kQ2hpbGQodGhpcy5sYXllckVsZW1lbnQpO1xyXG4gICAgICAgICAgICBsYXllckVsZW1lbnRQYXJlbnQgPSBtYXNrR3JvdXBlcjtcclxuICAgICAgICAgICAgaWYoIWZlYXR1cmVTdXBwb3J0Lm1hc2tUeXBlKXtcclxuICAgICAgICAgICAgICAgIG1hc2tHcm91cC5zZXRBdHRyaWJ1dGUoJ21hc2stdHlwZScsJ2x1bWluYW5jZScpO1xyXG4gICAgICAgICAgICAgICAgZmlsLmFwcGVuZENoaWxkKGZpbHRlcnNGYWN0b3J5LmNyZWF0ZUFscGhhVG9MdW1pbmFuY2VGaWx0ZXIoKSk7XHJcbiAgICAgICAgICAgICAgICB2YXIgZ2cgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoc3ZnTlMsJ2cnKTtcclxuICAgICAgICAgICAgICAgIG1hc2tHcm91cGVyLmFwcGVuZENoaWxkKGFscGhhUmVjdCk7XHJcbiAgICAgICAgICAgICAgICBnZy5hcHBlbmRDaGlsZCh0aGlzLmxheWVyRWxlbWVudCk7XHJcbiAgICAgICAgICAgICAgICBsYXllckVsZW1lbnRQYXJlbnQgPSBnZztcclxuICAgICAgICAgICAgICAgIG1hc2tHcm91cGVyLmFwcGVuZENoaWxkKGdnKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLmdsb2JhbERhdGEuZGVmcy5hcHBlbmRDaGlsZChtYXNrR3JvdXApO1xyXG4gICAgICAgIH1cclxuICAgIH1lbHNlIGlmKHRoaXMuZGF0YS5oYXNNYXNrIHx8IHRoaXMuZGF0YS50dCl7XHJcbiAgICAgICAgaWYodGhpcy5kYXRhLnR0KXtcclxuICAgICAgICAgICAgdGhpcy5tYXR0ZUVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoc3ZnTlMsJ2cnKTtcclxuICAgICAgICAgICAgdGhpcy5tYXR0ZUVsZW1lbnQuYXBwZW5kQ2hpbGQodGhpcy5sYXllckVsZW1lbnQpO1xyXG4gICAgICAgICAgICBsYXllckVsZW1lbnRQYXJlbnQgPSB0aGlzLm1hdHRlRWxlbWVudDtcclxuICAgICAgICAgICAgdGhpcy5iYXNlRWxlbWVudCA9IHRoaXMubWF0dGVFbGVtZW50O1xyXG4gICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICB0aGlzLmJhc2VFbGVtZW50ID0gdGhpcy5sYXllckVsZW1lbnQ7XHJcbiAgICAgICAgfVxyXG4gICAgfWVsc2V7XHJcbiAgICAgICAgdGhpcy5iYXNlRWxlbWVudCA9IHRoaXMubGF5ZXJFbGVtZW50O1xyXG4gICAgfVxyXG4gICAgaWYoKHRoaXMuZGF0YS5sbiB8fCB0aGlzLmRhdGEuY2wpICYmICh0aGlzLmRhdGEudHkgPT09IDQgfHwgdGhpcy5kYXRhLnR5ID09PSAwKSl7XHJcbiAgICAgICAgaWYodGhpcy5kYXRhLmxuKXtcclxuICAgICAgICAgICAgdGhpcy5sYXllckVsZW1lbnQuc2V0QXR0cmlidXRlKCdpZCcsdGhpcy5kYXRhLmxuKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYodGhpcy5kYXRhLmNsKXtcclxuICAgICAgICAgICAgdGhpcy5sYXllckVsZW1lbnQuc2V0QXR0cmlidXRlKCdjbGFzcycsdGhpcy5kYXRhLmNsKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBpZih0aGlzLmRhdGEudHkgPT09IDApe1xyXG4gICAgICAgICAgICB2YXIgY3AgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoc3ZnTlMsICdjbGlwUGF0aCcpO1xyXG4gICAgICAgICAgICB2YXIgcHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoc3ZnTlMsJ3BhdGgnKTtcclxuICAgICAgICAgICAgcHQuc2V0QXR0cmlidXRlKCdkJywnTTAsMCBMJyt0aGlzLmRhdGEudysnLDAnKycgTCcrdGhpcy5kYXRhLncrJywnK3RoaXMuZGF0YS5oKycgTDAsJyt0aGlzLmRhdGEuaCsneicpO1xyXG4gICAgICAgICAgICB2YXIgY2xpcElkID0gJ2NwXycrcmFuZG9tU3RyaW5nKDgpO1xyXG4gICAgICAgICAgICBjcC5zZXRBdHRyaWJ1dGUoJ2lkJyxjbGlwSWQpO1xyXG4gICAgICAgICAgICBjcC5hcHBlbmRDaGlsZChwdCk7XHJcbiAgICAgICAgICAgIHRoaXMuZ2xvYmFsRGF0YS5kZWZzLmFwcGVuZENoaWxkKGNwKTtcclxuICAgICAgICBpZih0aGlzLmNoZWNrTWFza3MoKSl7XHJcbiAgICAgICAgICAgIHZhciBjcEdyb3VwID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKHN2Z05TLCdnJyk7XHJcbiAgICAgICAgICAgIGNwR3JvdXAuc2V0QXR0cmlidXRlKCdjbGlwLXBhdGgnLCd1cmwoIycrY2xpcElkKycpJyk7XHJcbiAgICAgICAgICAgIGNwR3JvdXAuYXBwZW5kQ2hpbGQodGhpcy5sYXllckVsZW1lbnQpO1xyXG4gICAgICAgICAgICB0aGlzLnRyYW5zZm9ybWVkRWxlbWVudCA9IGNwR3JvdXA7XHJcbiAgICAgICAgICAgIGlmKGxheWVyRWxlbWVudFBhcmVudCl7XHJcbiAgICAgICAgICAgICAgICBsYXllckVsZW1lbnRQYXJlbnQuYXBwZW5kQ2hpbGQodGhpcy50cmFuc2Zvcm1lZEVsZW1lbnQpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5iYXNlRWxlbWVudCA9IHRoaXMudHJhbnNmb3JtZWRFbGVtZW50O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5sYXllckVsZW1lbnQuc2V0QXR0cmlidXRlKCdjbGlwLXBhdGgnLCd1cmwoIycrY2xpcElkKycpJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgfVxyXG4gICAgaWYodGhpcy5kYXRhLmJtICE9PSAwKXtcclxuICAgICAgICB0aGlzLnNldEJsZW5kTW9kZSgpO1xyXG4gICAgfVxyXG4gICAgaWYodGhpcy5sYXllckVsZW1lbnQgIT09IHRoaXMucGFyZW50Q29udGFpbmVyKXtcclxuICAgICAgICB0aGlzLnBsYWNlaG9sZGVyID0gbnVsbDtcclxuICAgIH1cclxuICAgIC8qIFRvZG8gcGVyZm9ybWFuY2Uga2lsbGVyXHJcbiAgICBpZih0aGlzLmRhdGEuc3kpe1xyXG4gICAgICAgIHZhciBmaWx0ZXJJRCA9ICdzdF8nK3JhbmRvbVN0cmluZygxMCk7XHJcbiAgICAgICAgdmFyIGMgPSB0aGlzLmRhdGEuc3lbMF0uYy5rO1xyXG4gICAgICAgIHZhciByID0gdGhpcy5kYXRhLnN5WzBdLnMuaztcclxuICAgICAgICB2YXIgZXhwYW5zb3IgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoc3ZnTlMsJ2ZpbHRlcicpO1xyXG4gICAgICAgIGV4cGFuc29yLnNldEF0dHJpYnV0ZSgnaWQnLGZpbHRlcklEKTtcclxuICAgICAgICB2YXIgZmVGbG9vZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhzdmdOUywnZmVGbG9vZCcpO1xyXG4gICAgICAgIHRoaXMuZmVGbG9vZCA9IGZlRmxvb2Q7XHJcbiAgICAgICAgaWYoIWNbMF0uZSl7XHJcbiAgICAgICAgICAgIGZlRmxvb2Quc2V0QXR0cmlidXRlKCdmbG9vZC1jb2xvcicsJ3JnYignK2NbMF0rJywnK2NbMV0rJywnK2NbMl0rJyknKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZmVGbG9vZC5zZXRBdHRyaWJ1dGUoJ3Jlc3VsdCcsJ2Jhc2UnKTtcclxuICAgICAgICBleHBhbnNvci5hcHBlbmRDaGlsZChmZUZsb29kKTtcclxuICAgICAgICB2YXIgZmVNb3JwaCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhzdmdOUywnZmVNb3JwaG9sb2d5Jyk7XHJcbiAgICAgICAgZmVNb3JwaC5zZXRBdHRyaWJ1dGUoJ29wZXJhdG9yJywnZGlsYXRlJyk7XHJcbiAgICAgICAgZmVNb3JwaC5zZXRBdHRyaWJ1dGUoJ2luJywnU291cmNlR3JhcGhpYycpO1xyXG4gICAgICAgIGZlTW9ycGguc2V0QXR0cmlidXRlKCdyZXN1bHQnLCdiaWdnZXInKTtcclxuICAgICAgICB0aGlzLmZlTW9ycGggPSBmZU1vcnBoO1xyXG4gICAgICAgIGlmKCFyLmxlbmd0aCl7XHJcbiAgICAgICAgICAgIGZlTW9ycGguc2V0QXR0cmlidXRlKCdyYWRpdXMnLHRoaXMuZGF0YS5zeVswXS5zLmspO1xyXG4gICAgICAgIH1cclxuICAgICAgICBleHBhbnNvci5hcHBlbmRDaGlsZChmZU1vcnBoKTtcclxuICAgICAgICB2YXIgZmVDb2xvck1hdHJpeCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhzdmdOUywnZmVDb2xvck1hdHJpeCcpO1xyXG4gICAgICAgIGZlQ29sb3JNYXRyaXguc2V0QXR0cmlidXRlKCdyZXN1bHQnLCdtYXNrJyk7XHJcbiAgICAgICAgZmVDb2xvck1hdHJpeC5zZXRBdHRyaWJ1dGUoJ2luJywnYmlnZ2VyJyk7XHJcbiAgICAgICAgZmVDb2xvck1hdHJpeC5zZXRBdHRyaWJ1dGUoJ3R5cGUnLCdtYXRyaXgnKTtcclxuICAgICAgICBmZUNvbG9yTWF0cml4LnNldEF0dHJpYnV0ZSgndmFsdWVzJywnMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMSAwJyk7XHJcbiAgICAgICAgZXhwYW5zb3IuYXBwZW5kQ2hpbGQoZmVDb2xvck1hdHJpeCk7XHJcbiAgICAgICAgdmFyIGZlQ29tcG9zaXRlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKHN2Z05TLCdmZUNvbXBvc2l0ZScpO1xyXG4gICAgICAgIGZlQ29tcG9zaXRlLnNldEF0dHJpYnV0ZSgncmVzdWx0JywnZHJvcCcpO1xyXG4gICAgICAgIGZlQ29tcG9zaXRlLnNldEF0dHJpYnV0ZSgnaW4nLCdiYXNlJyk7XHJcbiAgICAgICAgZmVDb21wb3NpdGUuc2V0QXR0cmlidXRlKCdpbjInLCdtYXNrJyk7XHJcbiAgICAgICAgZmVDb21wb3NpdGUuc2V0QXR0cmlidXRlKCdvcGVyYXRvcicsJ2luJyk7XHJcbiAgICAgICAgZXhwYW5zb3IuYXBwZW5kQ2hpbGQoZmVDb21wb3NpdGUpO1xyXG4gICAgICAgIHZhciBmZUJsZW5kID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKHN2Z05TLCdmZUJsZW5kJyk7XHJcbiAgICAgICAgZmVCbGVuZC5zZXRBdHRyaWJ1dGUoJ2luJywnU291cmNlR3JhcGhpYycpO1xyXG4gICAgICAgIGZlQmxlbmQuc2V0QXR0cmlidXRlKCdpbjInLCdkcm9wJyk7XHJcbiAgICAgICAgZmVCbGVuZC5zZXRBdHRyaWJ1dGUoJ21vZGUnLCdub3JtYWwnKTtcclxuICAgICAgICBleHBhbnNvci5hcHBlbmRDaGlsZChmZUJsZW5kKTtcclxuICAgICAgICB0aGlzLmdsb2JhbERhdGEuZGVmcy5hcHBlbmRDaGlsZChleHBhbnNvcik7XHJcbiAgICAgICAgdmFyIGNvbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoc3ZnTlMsJ2cnKTtcclxuICAgICAgICBpZih0aGlzLmxheWVyRWxlbWVudCA9PT0gdGhpcy5wYXJlbnRDb250YWluZXIpe1xyXG4gICAgICAgICAgICB0aGlzLmxheWVyRWxlbWVudCA9IGNvbnQ7XHJcbiAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgIGNvbnQuYXBwZW5kQ2hpbGQodGhpcy5sYXllckVsZW1lbnQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb250LnNldEF0dHJpYnV0ZSgnZmlsdGVyJywndXJsKCMnK2ZpbHRlcklEKycpJyk7XHJcbiAgICAgICAgaWYodGhpcy5kYXRhLnRkKXtcclxuICAgICAgICAgICAgY29udC5zZXRBdHRyaWJ1dGUoJ2RhdGEtdGQnLHRoaXMuZGF0YS50ZCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmKHRoaXMuZGF0YS50ZCA9PSAzKXtcclxuICAgICAgICAgICAgdGhpcy5nbG9iYWxEYXRhLmRlZnMuYXBwZW5kQ2hpbGQoY29udCk7XHJcbiAgICAgICAgfWVsc2UgaWYodGhpcy5kYXRhLnRkID09IDIpe1xyXG4gICAgICAgICAgICBtYXNrR3JvdXBlci5hcHBlbmRDaGlsZChjb250KTtcclxuICAgICAgICB9ZWxzZSBpZih0aGlzLmRhdGEudGQgPT0gMSl7XHJcbiAgICAgICAgICAgIG1hc2tlci5hcHBlbmRDaGlsZChjb250KTtcclxuICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgaWYodGhpcy5kYXRhLmhhc01hc2sgJiYgdGhpcy5kYXRhLnR0KXtcclxuICAgICAgICAgICAgICAgIHRoaXMubWF0dGVFbGVtZW50LmFwcGVuZENoaWxkKGNvbnQpO1xyXG4gICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgIHRoaXMuYXBwZW5kTm9kZVRvUGFyZW50KGNvbnQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfSovXHJcbiAgICBpZih0aGlzLmRhdGEuZWYpe1xyXG4gICAgICAgIHRoaXMuZWZmZWN0c01hbmFnZXIgPSBuZXcgU1ZHRWZmZWN0cyh0aGlzKTtcclxuICAgIH1cclxuICAgIHRoaXMuY2hlY2tQYXJlbnRpbmcoKTtcclxufTtcclxuXHJcblxyXG5TVkdCYXNlRWxlbWVudC5wcm90b3R5cGUuc2V0QmxlbmRNb2RlID0gQmFzZUVsZW1lbnQucHJvdG90eXBlLnNldEJsZW5kTW9kZTtcclxuXHJcblNWR0Jhc2VFbGVtZW50LnByb3RvdHlwZS5yZW5kZXJGcmFtZSA9IGZ1bmN0aW9uKHBhcmVudFRyYW5zZm9ybSl7XHJcbiAgICBpZih0aGlzLmRhdGEudHkgPT09IDMgfHwgdGhpcy5kYXRhLmhkIHx8ICF0aGlzLmlzVmlzaWJsZSl7XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMubGFzdE51bSA9IHRoaXMuY3VycmVudEZyYW1lTnVtO1xyXG4gICAgdGhpcy5maW5hbFRyYW5zZm9ybS5vcE1kZiA9IHRoaXMuZmlyc3RGcmFtZSB8fCB0aGlzLmZpbmFsVHJhbnNmb3JtLm9wLm1kZjtcclxuICAgIHRoaXMuZmluYWxUcmFuc2Zvcm0ubWF0TWRmID0gdGhpcy5maXJzdEZyYW1lIHx8IHRoaXMuZmluYWxUcmFuc2Zvcm0ubVByb3AubWRmO1xyXG4gICAgdGhpcy5maW5hbFRyYW5zZm9ybS5vcGFjaXR5ID0gdGhpcy5maW5hbFRyYW5zZm9ybS5vcC52O1xyXG5cclxuICAgIHZhciBtYXQ7XHJcbiAgICB2YXIgZmluYWxNYXQgPSB0aGlzLmZpbmFsVHJhbnNmb3JtLm1hdDtcclxuXHJcbiAgICBpZih0aGlzLmhpZXJhcmNoeSl7XHJcbiAgICAgICAgdmFyIGkgPSAwLCBsZW4gPSB0aGlzLmhpZXJhcmNoeS5sZW5ndGg7XHJcbiAgICAgICAgaWYoIXRoaXMuZmluYWxUcmFuc2Zvcm0ubWF0TWRmKSB7XHJcbiAgICAgICAgICAgIHdoaWxlKGkgPCBsZW4pIHtcclxuICAgICAgICAgICAgICAgIGlmKHRoaXMuaGllcmFyY2h5W2ldLmZpbmFsVHJhbnNmb3JtLm1Qcm9wLm1kZikge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZmluYWxUcmFuc2Zvcm0ubWF0TWRmID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGkgKz0gMTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICBpZih0aGlzLmZpbmFsVHJhbnNmb3JtLm1hdE1kZikge1xyXG4gICAgICAgICAgICBtYXQgPSB0aGlzLmZpbmFsVHJhbnNmb3JtLm1Qcm9wLnYucHJvcHM7XHJcbiAgICAgICAgICAgIGZpbmFsTWF0LmNsb25lRnJvbVByb3BzKG1hdCk7XHJcbiAgICAgICAgICAgIGZvcihpPTA7aTxsZW47aSs9MSl7XHJcbiAgICAgICAgICAgICAgICBtYXQgPSB0aGlzLmhpZXJhcmNoeVtpXS5maW5hbFRyYW5zZm9ybS5tUHJvcC52LnByb3BzO1xyXG4gICAgICAgICAgICAgICAgZmluYWxNYXQudHJhbnNmb3JtKG1hdFswXSxtYXRbMV0sbWF0WzJdLG1hdFszXSxtYXRbNF0sbWF0WzVdLG1hdFs2XSxtYXRbN10sbWF0WzhdLG1hdFs5XSxtYXRbMTBdLG1hdFsxMV0sbWF0WzEyXSxtYXRbMTNdLG1hdFsxNF0sbWF0WzE1XSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICB9ZWxzZSBpZih0aGlzLmlzVmlzaWJsZSl7XHJcbiAgICAgICAgZmluYWxNYXQgPSB0aGlzLmZpbmFsVHJhbnNmb3JtLm1Qcm9wLnY7XHJcbiAgICB9XHJcbiAgICBpZih0aGlzLmZpbmFsVHJhbnNmb3JtLm1hdE1kZiAmJiB0aGlzLmxheWVyRWxlbWVudCl7XHJcbiAgICAgICAgdGhpcy50cmFuc2Zvcm1lZEVsZW1lbnQuc2V0QXR0cmlidXRlKCd0cmFuc2Zvcm0nLGZpbmFsTWF0LnRvMmRDU1MoKSk7XHJcbiAgICB9XHJcbiAgICBpZih0aGlzLmZpbmFsVHJhbnNmb3JtLm9wTWRmICYmIHRoaXMubGF5ZXJFbGVtZW50KXtcclxuICAgICAgICBpZih0aGlzLmZpbmFsVHJhbnNmb3JtLm9wLnYgPD0gMCkge1xyXG4gICAgICAgICAgICBpZighdGhpcy5pc1RyYW5zcGFyZW50ICYmIHRoaXMuZ2xvYmFsRGF0YS5yZW5kZXJDb25maWcuaGlkZU9uVHJhbnNwYXJlbnQpe1xyXG4gICAgICAgICAgICAgICAgdGhpcy5pc1RyYW5zcGFyZW50ID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIHRoaXMuaGlkZSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIGlmKHRoaXMuaGlkZGVuICYmIHRoaXMuaXNUcmFuc3BhcmVudCl7XHJcbiAgICAgICAgICAgIHRoaXMuaXNUcmFuc3BhcmVudCA9IGZhbHNlO1xyXG4gICAgICAgICAgICB0aGlzLnNob3coKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy50cmFuc2Zvcm1lZEVsZW1lbnQuc2V0QXR0cmlidXRlKCdvcGFjaXR5Jyx0aGlzLmZpbmFsVHJhbnNmb3JtLm9wLnYpO1xyXG4gICAgfVxyXG5cclxuICAgIGlmKHRoaXMuZGF0YS5oYXNNYXNrKXtcclxuICAgICAgICB0aGlzLm1hc2tNYW5hZ2VyLnJlbmRlckZyYW1lKGZpbmFsTWF0KTtcclxuICAgIH1cclxuICAgIGlmKHRoaXMuZWZmZWN0c01hbmFnZXIpe1xyXG4gICAgICAgIHRoaXMuZWZmZWN0c01hbmFnZXIucmVuZGVyRnJhbWUodGhpcy5maXJzdEZyYW1lKTtcclxuICAgIH1cclxuICAgIHJldHVybiB0aGlzLmlzVmlzaWJsZTtcclxufTtcclxuXHJcblNWR0Jhc2VFbGVtZW50LnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24oKXtcclxuICAgIHRoaXMubGF5ZXJFbGVtZW50ID0gbnVsbDtcclxuICAgIHRoaXMucGFyZW50Q29udGFpbmVyID0gbnVsbDtcclxuICAgIGlmKHRoaXMubWF0dGVFbGVtZW50KSB7XHJcbiAgICAgICAgdGhpcy5tYXR0ZUVsZW1lbnQgPSBudWxsO1xyXG4gICAgfVxyXG4gICAgaWYodGhpcy5tYXNrTWFuYWdlcikge1xyXG4gICAgICAgIHRoaXMubWFza01hbmFnZXIuZGVzdHJveSgpO1xyXG4gICAgfVxyXG59O1xyXG5cclxuU1ZHQmFzZUVsZW1lbnQucHJvdG90eXBlLmdldEJhc2VFbGVtZW50ID0gZnVuY3Rpb24oKXtcclxuICAgIHJldHVybiB0aGlzLmJhc2VFbGVtZW50O1xyXG59O1xyXG5TVkdCYXNlRWxlbWVudC5wcm90b3R5cGUuYWRkTWFza3MgPSBmdW5jdGlvbihkYXRhKXtcclxuICAgIHRoaXMubWFza01hbmFnZXIgPSBuZXcgTWFza0VsZW1lbnQoZGF0YSx0aGlzLHRoaXMuZ2xvYmFsRGF0YSk7XHJcbn07XHJcblxyXG5TVkdCYXNlRWxlbWVudC5wcm90b3R5cGUuc2V0TWF0dGUgPSBmdW5jdGlvbihpZCl7XHJcbiAgICBpZighdGhpcy5tYXR0ZUVsZW1lbnQpe1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIHRoaXMubWF0dGVFbGVtZW50LnNldEF0dHJpYnV0ZShcIm1hc2tcIiwgXCJ1cmwoI1wiICsgaWQgKyBcIilcIik7XHJcbn07XHJcblxyXG5TVkdCYXNlRWxlbWVudC5wcm90b3R5cGUuc2V0TWF0dGUgPSBmdW5jdGlvbihpZCl7XHJcbiAgICBpZighdGhpcy5tYXR0ZUVsZW1lbnQpe1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIHRoaXMubWF0dGVFbGVtZW50LnNldEF0dHJpYnV0ZShcIm1hc2tcIiwgXCJ1cmwoI1wiICsgaWQgKyBcIilcIik7XHJcbn07XHJcblxyXG5TVkdCYXNlRWxlbWVudC5wcm90b3R5cGUuaGlkZSA9IGZ1bmN0aW9uKCl7XHJcbiAgICBpZighdGhpcy5oaWRkZW4pe1xyXG4gICAgICAgIHRoaXMubGF5ZXJFbGVtZW50LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XHJcbiAgICAgICAgdGhpcy5oaWRkZW4gPSB0cnVlO1xyXG4gICAgfVxyXG59O1xyXG5cclxuU1ZHQmFzZUVsZW1lbnQucHJvdG90eXBlLnNob3cgPSBmdW5jdGlvbigpe1xyXG4gICAgaWYodGhpcy5pc1Zpc2libGUgJiYgIXRoaXMuaXNUcmFuc3BhcmVudCl7XHJcbiAgICAgICAgdGhpcy5oaWRkZW4gPSBmYWxzZTtcclxuICAgICAgICB0aGlzLmxheWVyRWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJztcclxuICAgIH1cclxufTtcclxuXG5mdW5jdGlvbiBJU2hhcGVFbGVtZW50KGRhdGEscGFyZW50Q29udGFpbmVyLGdsb2JhbERhdGEsY29tcCwgcGxhY2Vob2xkZXIpe1xyXG4gICAgdGhpcy5zaGFwZXMgPSBbXTtcclxuICAgIHRoaXMuc2hhcGVzRGF0YSA9IGRhdGEuc2hhcGVzO1xyXG4gICAgdGhpcy5zdHlsZXNMaXN0ID0gW107XHJcbiAgICB0aGlzLml0ZW1zRGF0YSA9IFtdO1xyXG4gICAgdGhpcy5wcmV2Vmlld0RhdGEgPSBbXTtcclxuICAgIHRoaXMuc2hhcGVNb2RpZmllcnMgPSBbXTtcclxuICAgIHRoaXMucHJvY2Vzc2VkRWxlbWVudHMgPSBbXTtcclxuICAgIHRoaXMuX3BhcmVudC5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsZGF0YSxwYXJlbnRDb250YWluZXIsZ2xvYmFsRGF0YSxjb21wLCBwbGFjZWhvbGRlcik7XHJcbn1cclxuY3JlYXRlRWxlbWVudChTVkdCYXNlRWxlbWVudCwgSVNoYXBlRWxlbWVudCk7XHJcblxyXG5JU2hhcGVFbGVtZW50LnByb3RvdHlwZS5pZGVudGl0eU1hdHJpeCA9IG5ldyBNYXRyaXgoKTtcclxuXHJcbklTaGFwZUVsZW1lbnQucHJvdG90eXBlLmxjRW51bSA9IHtcclxuICAgICcxJzogJ2J1dHQnLFxyXG4gICAgJzInOiAncm91bmQnLFxyXG4gICAgJzMnOiAnYnV0dCdcclxufVxyXG5cclxuSVNoYXBlRWxlbWVudC5wcm90b3R5cGUubGpFbnVtID0ge1xyXG4gICAgJzEnOiAnbWl0ZXInLFxyXG4gICAgJzInOiAncm91bmQnLFxyXG4gICAgJzMnOiAnYnV0dCdcclxufVxyXG5cclxuSVNoYXBlRWxlbWVudC5wcm90b3R5cGUuc2VhcmNoUHJvY2Vzc2VkRWxlbWVudCA9IGZ1bmN0aW9uKGVsZW0pe1xyXG4gICAgdmFyIGkgPSB0aGlzLnByb2Nlc3NlZEVsZW1lbnRzLmxlbmd0aDtcclxuICAgIHdoaWxlKGkpe1xyXG4gICAgICAgIGkgLT0gMTtcclxuICAgICAgICBpZih0aGlzLnByb2Nlc3NlZEVsZW1lbnRzW2ldLmVsZW0gPT09IGVsZW0pe1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5wcm9jZXNzZWRFbGVtZW50c1tpXS5wb3M7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIDA7XHJcbn07XHJcblxyXG5JU2hhcGVFbGVtZW50LnByb3RvdHlwZS5hZGRQcm9jZXNzZWRFbGVtZW50ID0gZnVuY3Rpb24oZWxlbSwgcG9zKXtcclxuICAgIHZhciBpID0gdGhpcy5wcm9jZXNzZWRFbGVtZW50cy5sZW5ndGg7XHJcbiAgICB3aGlsZShpKXtcclxuICAgICAgICBpIC09IDE7XHJcbiAgICAgICAgaWYodGhpcy5wcm9jZXNzZWRFbGVtZW50c1tpXS5lbGVtID09PSBlbGVtKXtcclxuICAgICAgICAgICAgdGhpcy5wcm9jZXNzZWRFbGVtZW50c1tpXS5wb3MgPSBwb3M7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGlmKGkgPT09IDApe1xyXG4gICAgICAgIHRoaXMucHJvY2Vzc2VkRWxlbWVudHMucHVzaCh7XHJcbiAgICAgICAgICAgIGVsZW06IGVsZW0sXHJcbiAgICAgICAgICAgIHBvczogcG9zXHJcbiAgICAgICAgfSlcclxuICAgIH1cclxufTtcclxuXHJcbklTaGFwZUVsZW1lbnQucHJvdG90eXBlLmJ1aWxkRXhwcmVzc2lvbkludGVyZmFjZSA9IGZ1bmN0aW9uKCl7fTtcclxuXHJcbklTaGFwZUVsZW1lbnQucHJvdG90eXBlLmNyZWF0ZUVsZW1lbnRzID0gZnVuY3Rpb24oKXtcclxuICAgIC8vVE9ETyBjaGVjayBpZiBJIGNhbiB1c2Ugc3ltYm9sIHNvIGkgY2FuIHNldCBpdHMgdmlld0JveFxyXG4gICAgdGhpcy5fcGFyZW50LmNyZWF0ZUVsZW1lbnRzLmNhbGwodGhpcyk7XHJcbiAgICB0aGlzLnNlYXJjaFNoYXBlcyh0aGlzLnNoYXBlc0RhdGEsdGhpcy5pdGVtc0RhdGEsdGhpcy5wcmV2Vmlld0RhdGEsdGhpcy5sYXllckVsZW1lbnQsdGhpcy5keW5hbWljUHJvcGVydGllcywgMCwgW10sIHRydWUpO1xyXG4gICAgaWYoIXRoaXMuZGF0YS5oZCB8fCB0aGlzLmRhdGEudGQpe1xyXG4gICAgICAgIHN0eWxlVW5zZWxlY3RhYmxlRGl2KHRoaXMubGF5ZXJFbGVtZW50KTtcclxuICAgIH1cclxufTtcclxuXHJcbklTaGFwZUVsZW1lbnQucHJvdG90eXBlLnNldEdyYWRpZW50RGF0YSA9IGZ1bmN0aW9uKHBhdGhFbGVtZW50LGFycixkYXRhKXtcclxuXHJcbiAgICB2YXIgZ3JhZGllbnRJZCA9ICdncl8nK3JhbmRvbVN0cmluZygxMCk7XHJcbiAgICB2YXIgZ2ZpbGw7XHJcbiAgICBpZihhcnIudCA9PT0gMSl7XHJcbiAgICAgICAgZ2ZpbGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoc3ZnTlMsJ2xpbmVhckdyYWRpZW50Jyk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIGdmaWxsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKHN2Z05TLCdyYWRpYWxHcmFkaWVudCcpO1xyXG4gICAgfVxyXG4gICAgZ2ZpbGwuc2V0QXR0cmlidXRlKCdpZCcsZ3JhZGllbnRJZCk7XHJcbiAgICBnZmlsbC5zZXRBdHRyaWJ1dGUoJ3NwcmVhZE1ldGhvZCcsJ3BhZCcpO1xyXG4gICAgZ2ZpbGwuc2V0QXR0cmlidXRlKCdncmFkaWVudFVuaXRzJywndXNlclNwYWNlT25Vc2UnKTtcclxuICAgIHZhciBzdG9wcyA9IFtdO1xyXG4gICAgdmFyIHN0b3AsIGosIGpMZW47XHJcbiAgICBqTGVuID0gYXJyLmcucCo0O1xyXG4gICAgZm9yKGo9MDtqPGpMZW47ais9NCl7XHJcbiAgICAgICAgc3RvcCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhzdmdOUywnc3RvcCcpO1xyXG4gICAgICAgIGdmaWxsLmFwcGVuZENoaWxkKHN0b3ApO1xyXG4gICAgICAgIHN0b3BzLnB1c2goc3RvcCk7XHJcbiAgICB9XHJcbiAgICBwYXRoRWxlbWVudC5zZXRBdHRyaWJ1dGUoIGFyci50eSA9PT0gJ2dmJyA/ICdmaWxsJzonc3Ryb2tlJywndXJsKCMnK2dyYWRpZW50SWQrJyknKTtcclxuICAgIHRoaXMuZ2xvYmFsRGF0YS5kZWZzLmFwcGVuZENoaWxkKGdmaWxsKTtcclxuICAgIGRhdGEuZ2YgPSBnZmlsbDtcclxuICAgIGRhdGEuY3N0ID0gc3RvcHM7XHJcbn1cclxuXHJcbklTaGFwZUVsZW1lbnQucHJvdG90eXBlLnNldEdyYWRpZW50T3BhY2l0eSA9IGZ1bmN0aW9uKGFyciwgZGF0YSwgc3R5bGVPYil7XHJcbiAgICBpZigoYXJyLmcuay5rWzBdLnMgJiYgYXJyLmcuay5rWzBdLnMubGVuZ3RoID4gYXJyLmcucCo0KSB8fCBhcnIuZy5rLmsubGVuZ3RoID4gYXJyLmcucCo0KXtcclxuICAgICAgICB2YXIgb3BGaWxsO1xyXG4gICAgICAgIHZhciBzdG9wLCBqLCBqTGVuO1xyXG4gICAgICAgIHZhciBtYXNrID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKHN2Z05TLFwibWFza1wiKTtcclxuICAgICAgICB2YXIgbWFza0VsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoc3ZnTlMsICdwYXRoJyk7XHJcbiAgICAgICAgbWFzay5hcHBlbmRDaGlsZChtYXNrRWxlbWVudCk7XHJcbiAgICAgICAgdmFyIG9wYWNpdHlJZCA9ICdvcF8nK3JhbmRvbVN0cmluZygxMCk7XHJcbiAgICAgICAgdmFyIG1hc2tJZCA9ICdta18nK3JhbmRvbVN0cmluZygxMCk7XHJcbiAgICAgICAgbWFzay5zZXRBdHRyaWJ1dGUoJ2lkJyxtYXNrSWQpO1xyXG4gICAgICAgIGlmKGFyci50ID09PSAxKXtcclxuICAgICAgICAgICAgb3BGaWxsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKHN2Z05TLCdsaW5lYXJHcmFkaWVudCcpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIG9wRmlsbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhzdmdOUywncmFkaWFsR3JhZGllbnQnKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgb3BGaWxsLnNldEF0dHJpYnV0ZSgnaWQnLG9wYWNpdHlJZCk7XHJcbiAgICAgICAgb3BGaWxsLnNldEF0dHJpYnV0ZSgnc3ByZWFkTWV0aG9kJywncGFkJyk7XHJcbiAgICAgICAgb3BGaWxsLnNldEF0dHJpYnV0ZSgnZ3JhZGllbnRVbml0cycsJ3VzZXJTcGFjZU9uVXNlJyk7XHJcbiAgICAgICAgakxlbiA9IGFyci5nLmsua1swXS5zID8gYXJyLmcuay5rWzBdLnMubGVuZ3RoIDogYXJyLmcuay5rLmxlbmd0aDtcclxuICAgICAgICB2YXIgc3RvcHMgPSBbXTtcclxuICAgICAgICBmb3Ioaj1hcnIuZy5wKjQ7ajxqTGVuO2orPTIpe1xyXG4gICAgICAgICAgICBzdG9wID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKHN2Z05TLCdzdG9wJyk7XHJcbiAgICAgICAgICAgIHN0b3Auc2V0QXR0cmlidXRlKCdzdG9wLWNvbG9yJywncmdiKDI1NSwyNTUsMjU1KScpO1xyXG4gICAgICAgICAgICAvL3N0b3Auc2V0QXR0cmlidXRlKCdvZmZzZXQnLE1hdGgucm91bmQoYXJyLnlbal1bMF0qMTAwKSsnJScpO1xyXG4gICAgICAgICAgICAvL3N0b3Auc2V0QXR0cmlidXRlKCdzdHlsZScsJ3N0b3AtY29sb3I6cmdiKDI1NSwyNTUsMjU1KTtzdG9wLW9wYWNpdHk6JythcnIueVtqXVsxXSk7XHJcbiAgICAgICAgICAgIG9wRmlsbC5hcHBlbmRDaGlsZChzdG9wKTtcclxuICAgICAgICAgICAgc3RvcHMucHVzaChzdG9wKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgbWFza0VsZW1lbnQuc2V0QXR0cmlidXRlKCBhcnIudHkgPT09ICdnZicgPyAnZmlsbCc6J3N0cm9rZScsJ3VybCgjJytvcGFjaXR5SWQrJyknKTtcclxuICAgICAgICB0aGlzLmdsb2JhbERhdGEuZGVmcy5hcHBlbmRDaGlsZChvcEZpbGwpO1xyXG4gICAgICAgIHRoaXMuZ2xvYmFsRGF0YS5kZWZzLmFwcGVuZENoaWxkKG1hc2spO1xyXG4gICAgICAgIGRhdGEub2YgPSBvcEZpbGw7XHJcbiAgICAgICAgZGF0YS5vc3QgPSBzdG9wcztcclxuICAgICAgICBzdHlsZU9iLm1zRWxlbSA9IG1hc2tFbGVtZW50O1xyXG4gICAgICAgIHJldHVybiBtYXNrSWQ7XHJcbiAgICB9XHJcbn07XHJcblxyXG5JU2hhcGVFbGVtZW50LnByb3RvdHlwZS5jcmVhdGVTdHlsZUVsZW1lbnQgPSBmdW5jdGlvbihkYXRhLCBsZXZlbCwgZHluYW1pY1Byb3BlcnRpZXMpe1xyXG4gICAgdmFyIGVsZW1lbnREYXRhID0ge1xyXG4gICAgfTtcclxuICAgIHZhciBzdHlsZU9iID0ge1xyXG4gICAgICAgIGRhdGE6IGRhdGEsXHJcbiAgICAgICAgdHlwZTogZGF0YS50eSxcclxuICAgICAgICBkOiAnJyxcclxuICAgICAgICBsZDogJycsXHJcbiAgICAgICAgbHZsOiBsZXZlbCxcclxuICAgICAgICBtZGY6IGZhbHNlLFxyXG4gICAgICAgIGNsb3NlZDogZmFsc2VcclxuICAgIH07XHJcbiAgICB2YXIgcGF0aEVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoc3ZnTlMsIFwicGF0aFwiKTtcclxuICAgIGVsZW1lbnREYXRhLm8gPSBQcm9wZXJ0eUZhY3RvcnkuZ2V0UHJvcCh0aGlzLGRhdGEubywwLDAuMDEsZHluYW1pY1Byb3BlcnRpZXMpO1xyXG4gICAgaWYoZGF0YS50eSA9PSAnc3QnIHx8IGRhdGEudHkgPT0gJ2dzJykge1xyXG4gICAgICAgIHBhdGhFbGVtZW50LnNldEF0dHJpYnV0ZSgnc3Ryb2tlLWxpbmVjYXAnLCB0aGlzLmxjRW51bVtkYXRhLmxjXSB8fCAncm91bmQnKTtcclxuICAgICAgICAvLy8vcGF0aEVsZW1lbnQuc3R5bGUuc3Ryb2tlTGluZWNhcCA9IHRoaXMubGNFbnVtW2RhdGEubGNdIHx8ICdyb3VuZCc7XHJcbiAgICAgICAgcGF0aEVsZW1lbnQuc2V0QXR0cmlidXRlKCdzdHJva2UtbGluZWpvaW4nLHRoaXMubGpFbnVtW2RhdGEubGpdIHx8ICdyb3VuZCcpO1xyXG4gICAgICAgIC8vLy9wYXRoRWxlbWVudC5zdHlsZS5zdHJva2VMaW5lam9pbiA9IHRoaXMubGpFbnVtW2RhdGEubGpdIHx8ICdyb3VuZCc7XHJcbiAgICAgICAgcGF0aEVsZW1lbnQuc2V0QXR0cmlidXRlKCdmaWxsLW9wYWNpdHknLCcwJyk7XHJcbiAgICAgICAgLy8vL3BhdGhFbGVtZW50LnN0eWxlLmZpbGxPcGFjaXR5ID0gMDtcclxuICAgICAgICBpZihkYXRhLmxqID09IDEpIHtcclxuICAgICAgICAgICAgcGF0aEVsZW1lbnQuc2V0QXR0cmlidXRlKCdzdHJva2UtbWl0ZXJsaW1pdCcsZGF0YS5tbCk7XHJcbiAgICAgICAgICAgIC8vLy9wYXRoRWxlbWVudC5zdHlsZS5zdHJva2VNaXRlcmxpbWl0ID0gZGF0YS5tbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGVsZW1lbnREYXRhLncgPSBQcm9wZXJ0eUZhY3RvcnkuZ2V0UHJvcCh0aGlzLGRhdGEudywwLG51bGwsZHluYW1pY1Byb3BlcnRpZXMpO1xyXG4gICAgICAgIGlmKGRhdGEuZCl7XHJcbiAgICAgICAgICAgIHZhciBkID0gUHJvcGVydHlGYWN0b3J5LmdldERhc2hQcm9wKHRoaXMsZGF0YS5kLCdzdmcnLGR5bmFtaWNQcm9wZXJ0aWVzKTtcclxuICAgICAgICAgICAgaWYoIWQuayl7XHJcbiAgICAgICAgICAgICAgICBwYXRoRWxlbWVudC5zZXRBdHRyaWJ1dGUoJ3N0cm9rZS1kYXNoYXJyYXknLCBkLmRhc2hhcnJheSk7XHJcbiAgICAgICAgICAgICAgICAvLy8vcGF0aEVsZW1lbnQuc3R5bGUuc3Ryb2tlRGFzaGFycmF5ID0gZC5kYXNoYXJyYXk7XHJcbiAgICAgICAgICAgICAgICBwYXRoRWxlbWVudC5zZXRBdHRyaWJ1dGUoJ3N0cm9rZS1kYXNob2Zmc2V0JywgZC5kYXNob2Zmc2V0KTtcclxuICAgICAgICAgICAgICAgIC8vLy9wYXRoRWxlbWVudC5zdHlsZS5zdHJva2VEYXNob2Zmc2V0ID0gZC5kYXNob2Zmc2V0O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsZW1lbnREYXRhLmQgPSBkO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICB9XHJcbiAgICBpZihkYXRhLnR5ID09ICdmbCcgfHwgZGF0YS50eSA9PSAnc3QnKXtcclxuICAgICAgICBlbGVtZW50RGF0YS5jID0gUHJvcGVydHlGYWN0b3J5LmdldFByb3AodGhpcyxkYXRhLmMsMSwyNTUsZHluYW1pY1Byb3BlcnRpZXMpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICBlbGVtZW50RGF0YS5nID0gUHJvcGVydHlGYWN0b3J5LmdldEdyYWRpZW50UHJvcCh0aGlzLGRhdGEuZyxkeW5hbWljUHJvcGVydGllcyk7XHJcbiAgICAgICAgaWYoZGF0YS50ID09IDIpe1xyXG4gICAgICAgICAgICBlbGVtZW50RGF0YS5oID0gUHJvcGVydHlGYWN0b3J5LmdldFByb3AodGhpcyxkYXRhLmgsMSwwLjAxLGR5bmFtaWNQcm9wZXJ0aWVzKTtcclxuICAgICAgICAgICAgZWxlbWVudERhdGEuYSA9IFByb3BlcnR5RmFjdG9yeS5nZXRQcm9wKHRoaXMsZGF0YS5hLDEsZGVnVG9SYWRzLGR5bmFtaWNQcm9wZXJ0aWVzKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxlbWVudERhdGEucyA9IFByb3BlcnR5RmFjdG9yeS5nZXRQcm9wKHRoaXMsZGF0YS5zLDEsbnVsbCxkeW5hbWljUHJvcGVydGllcyk7XHJcbiAgICAgICAgZWxlbWVudERhdGEuZSA9IFByb3BlcnR5RmFjdG9yeS5nZXRQcm9wKHRoaXMsZGF0YS5lLDEsbnVsbCxkeW5hbWljUHJvcGVydGllcyk7XHJcbiAgICAgICAgdGhpcy5zZXRHcmFkaWVudERhdGEocGF0aEVsZW1lbnQsZGF0YSxlbGVtZW50RGF0YSwgc3R5bGVPYik7XHJcbiAgICAgICAgdmFyIG1hc2tJZCA9IHRoaXMuc2V0R3JhZGllbnRPcGFjaXR5KGRhdGEsZWxlbWVudERhdGEsIHN0eWxlT2IpO1xyXG4gICAgICAgIGlmKG1hc2tJZCl7XHJcbiAgICAgICAgICAgIHBhdGhFbGVtZW50LnNldEF0dHJpYnV0ZSgnbWFzaycsJ3VybCgjJyttYXNrSWQrJyknKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBlbGVtZW50RGF0YS5lbGVtID0gcGF0aEVsZW1lbnQ7XHJcbiAgICAvL2NvbnRhaW5lci5hcHBlbmRDaGlsZChwYXRoRWxlbWVudCk7XHJcbiAgICBpZihkYXRhLnIgPT09IDIpIHtcclxuICAgICAgICBwYXRoRWxlbWVudC5zZXRBdHRyaWJ1dGUoJ2ZpbGwtcnVsZScsICdldmVub2RkJyk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYoZGF0YS5sbil7XHJcbiAgICAgICAgcGF0aEVsZW1lbnQuc2V0QXR0cmlidXRlKCdpZCcsZGF0YS5sbik7XHJcbiAgICB9XHJcbiAgICBpZihkYXRhLmNsKXtcclxuICAgICAgICBwYXRoRWxlbWVudC5zZXRBdHRyaWJ1dGUoJ2NsYXNzJyxkYXRhLmNsKTtcclxuICAgIH1cclxuICAgIHN0eWxlT2IucEVsZW0gPSBwYXRoRWxlbWVudDtcclxuICAgIHRoaXMuc3R5bGVzTGlzdC5wdXNoKHN0eWxlT2IpO1xyXG4gICAgZWxlbWVudERhdGEuc3R5bGUgPSBzdHlsZU9iO1xyXG4gICAgcmV0dXJuIGVsZW1lbnREYXRhO1xyXG59XHJcblxyXG5JU2hhcGVFbGVtZW50LnByb3RvdHlwZS5jcmVhdGVHcm91cEVsZW1lbnQgPSBmdW5jdGlvbihkYXRhKSB7XHJcbiAgICB2YXIgZWxlbWVudERhdGEgPSB7XHJcbiAgICAgICAgaXQ6IFtdLFxyXG4gICAgICAgIHByZXZWaWV3RGF0YTogW11cclxuICAgIH07XHJcbiAgICB2YXIgZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhzdmdOUywnZycpO1xyXG4gICAgZWxlbWVudERhdGEuZ3IgPSBnO1xyXG4gICAgaWYoZGF0YS5sbil7XHJcbiAgICAgICAgZWxlbWVudERhdGEuZ3Iuc2V0QXR0cmlidXRlKCdpZCcsZGF0YS5sbik7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gZWxlbWVudERhdGE7XHJcbn1cclxuXHJcbklTaGFwZUVsZW1lbnQucHJvdG90eXBlLmNyZWF0ZVRyYW5zZm9ybUVsZW1lbnQgPSBmdW5jdGlvbihkYXRhLCBkeW5hbWljUHJvcGVydGllcykge1xyXG4gICAgdmFyIGVsZW1lbnREYXRhID0ge1xyXG4gICAgICAgIHRyYW5zZm9ybSA6IHtcclxuICAgICAgICAgICAgb3A6IFByb3BlcnR5RmFjdG9yeS5nZXRQcm9wKHRoaXMsZGF0YS5vLDAsMC4wMSxkeW5hbWljUHJvcGVydGllcyksXHJcbiAgICAgICAgICAgIG1Qcm9wczogUHJvcGVydHlGYWN0b3J5LmdldFByb3AodGhpcyxkYXRhLDIsbnVsbCxkeW5hbWljUHJvcGVydGllcylcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVsZW1lbnRzOiBbXVxyXG4gICAgfTtcclxuICAgIHJldHVybiBlbGVtZW50RGF0YTtcclxufVxyXG5cclxuSVNoYXBlRWxlbWVudC5wcm90b3R5cGUuY3JlYXRlU2hhcGVFbGVtZW50ID0gZnVuY3Rpb24oZGF0YSwgb3duVHJhbnNmb3JtZXJzLCBsZXZlbCwgZHluYW1pY1Byb3BlcnRpZXMpIHtcclxuICAgIHZhciBlbGVtZW50RGF0YSA9IHtcclxuICAgICAgICBlbGVtZW50cyA6IFtdLFxyXG4gICAgICAgIGNhY2hlczpbXSxcclxuICAgICAgICBzdHlsZXMgOiBbXSxcclxuICAgICAgICB0cmFuc2Zvcm1lcnM6IG93blRyYW5zZm9ybWVycyxcclxuICAgICAgICBsU3RyOiAnJ1xyXG4gICAgfTtcclxuICAgIHZhciB0eSA9IDQ7XHJcbiAgICBpZihkYXRhLnR5ID09ICdyYycpe1xyXG4gICAgICAgIHR5ID0gNTtcclxuICAgIH1lbHNlIGlmKGRhdGEudHkgPT0gJ2VsJyl7XHJcbiAgICAgICAgdHkgPSA2O1xyXG4gICAgfWVsc2UgaWYoZGF0YS50eSA9PSAnc3InKXtcclxuICAgICAgICB0eSA9IDc7XHJcbiAgICB9XHJcbiAgICBlbGVtZW50RGF0YS5zaCA9IFNoYXBlUHJvcGVydHlGYWN0b3J5LmdldFNoYXBlUHJvcCh0aGlzLGRhdGEsdHksZHluYW1pY1Byb3BlcnRpZXMpO1xyXG4gICAgZWxlbWVudERhdGEubHZsID0gbGV2ZWw7XHJcbiAgICB0aGlzLnNoYXBlcy5wdXNoKGVsZW1lbnREYXRhLnNoKTtcclxuICAgIHRoaXMuYWRkU2hhcGVUb01vZGlmaWVycyhlbGVtZW50RGF0YSk7XHJcbiAgICByZXR1cm4gZWxlbWVudERhdGE7XHJcbn1cclxuXHJcbnZhciBjb250ID0gMDtcclxuXHJcbklTaGFwZUVsZW1lbnQucHJvdG90eXBlLnNldEVsZW1lbnRTdHlsZXMgPSBmdW5jdGlvbigpe1xyXG4gICAgdmFyIGosIGpMZW4gPSB0aGlzLnN0eWxlc0xpc3QubGVuZ3RoO1xyXG4gICAgdmFyIGFyciA9IFtdO1xyXG4gICAgZm9yKGo9MDtqPGpMZW47ais9MSl7XHJcbiAgICAgICAgaWYoIXRoaXMuc3R5bGVzTGlzdFtqXS5jbG9zZWQpe1xyXG4gICAgICAgICAgICBhcnIucHVzaCh0aGlzLnN0eWxlc0xpc3Rbal0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiBhcnI7XHJcbn1cclxuXHJcbklTaGFwZUVsZW1lbnQucHJvdG90eXBlLnJlbG9hZFNoYXBlcyA9IGZ1bmN0aW9uKCl7XHJcbiAgICB0aGlzLmZpcnN0RnJhbWUgPSB0cnVlO1xyXG4gICAgdmFyIGksIGxlbiA9IHRoaXMuaXRlbXNEYXRhLmxlbmd0aDtcclxuICAgIGZvcihpPTA7aTxsZW47aSs9MSl7XHJcbiAgICAgICAgdGhpcy5wcmV2Vmlld0RhdGFbaV0gPSB0aGlzLml0ZW1zRGF0YVtpXTtcclxuICAgIH1cclxuICAgIHRoaXMuc2VhcmNoU2hhcGVzKHRoaXMuc2hhcGVzRGF0YSx0aGlzLml0ZW1zRGF0YSx0aGlzLnByZXZWaWV3RGF0YSx0aGlzLmxheWVyRWxlbWVudCx0aGlzLmR5bmFtaWNQcm9wZXJ0aWVzLCAwLCBbXSwgdHJ1ZSk7XHJcbiAgICB2YXIgaSwgbGVuID0gdGhpcy5keW5hbWljUHJvcGVydGllcy5sZW5ndGg7XHJcbiAgICBmb3IoaT0wO2k8bGVuO2krPTEpe1xyXG4gICAgICAgIHRoaXMuZHluYW1pY1Byb3BlcnRpZXNbaV0uZ2V0VmFsdWUoKTtcclxuICAgIH1cclxuICAgIHRoaXMucmVuZGVyTW9kaWZpZXJzKCk7XHJcbn1cclxuXHJcbklTaGFwZUVsZW1lbnQucHJvdG90eXBlLnNlYXJjaFNoYXBlcyA9IGZ1bmN0aW9uKGFycixpdGVtc0RhdGEscHJldlZpZXdEYXRhLGNvbnRhaW5lcixkeW5hbWljUHJvcGVydGllcywgbGV2ZWwsIHRyYW5zZm9ybWVycywgcmVuZGVyKXtcclxuICAgIHZhciBvd25UcmFuc2Zvcm1lcnMgPSBbXS5jb25jYXQodHJhbnNmb3JtZXJzKTtcclxuICAgIHZhciBpLCBsZW4gPSBhcnIubGVuZ3RoIC0gMTtcclxuICAgIHZhciBqLCBqTGVuO1xyXG4gICAgdmFyIG93blN0eWxlcyA9IFtdLCBvd25Nb2RpZmllcnMgPSBbXSwgc3R5bGVPYiwgY3VycmVudFRyYW5zZm9ybSwgbW9kaWZpZXIsIHByb2Nlc3NlZFBvcztcclxuICAgIGZvcihpPWxlbjtpPj0wO2ktPTEpe1xyXG4gICAgICAgIHByb2Nlc3NlZFBvcyA9IHRoaXMuc2VhcmNoUHJvY2Vzc2VkRWxlbWVudChhcnJbaV0pO1xyXG4gICAgICAgIGlmKCFwcm9jZXNzZWRQb3Mpe1xyXG4gICAgICAgICAgICBhcnJbaV0uX3JlbmRlciA9IHJlbmRlcjtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBpdGVtc0RhdGFbaV0gPSBwcmV2Vmlld0RhdGFbcHJvY2Vzc2VkUG9zIC0gMV07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmKGFycltpXS50eSA9PSAnZmwnIHx8IGFycltpXS50eSA9PSAnc3QnIHx8IGFycltpXS50eSA9PSAnZ2YnIHx8IGFycltpXS50eSA9PSAnZ3MnKXtcclxuICAgICAgICAgICAgaWYoIXByb2Nlc3NlZFBvcyl7XHJcbiAgICAgICAgICAgICAgICBpdGVtc0RhdGFbaV0gPSB0aGlzLmNyZWF0ZVN0eWxlRWxlbWVudChhcnJbaV0sIGxldmVsLCBkeW5hbWljUHJvcGVydGllcyk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBpdGVtc0RhdGFbaV0uc3R5bGUuY2xvc2VkID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYoYXJyW2ldLl9yZW5kZXIpe1xyXG4gICAgICAgICAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKGl0ZW1zRGF0YVtpXS5lbGVtKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBvd25TdHlsZXMucHVzaChpdGVtc0RhdGFbaV0uc3R5bGUpO1xyXG4gICAgICAgIH1lbHNlIGlmKGFycltpXS50eSA9PSAnZ3InKXtcclxuICAgICAgICAgICAgaWYoIXByb2Nlc3NlZFBvcyl7XHJcbiAgICAgICAgICAgICAgICBpdGVtc0RhdGFbaV0gPSB0aGlzLmNyZWF0ZUdyb3VwRWxlbWVudChhcnJbaV0pO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgakxlbiA9IGl0ZW1zRGF0YVtpXS5pdC5sZW5ndGg7XHJcbiAgICAgICAgICAgICAgICBmb3Ioaj0wO2o8akxlbjtqKz0xKXtcclxuICAgICAgICAgICAgICAgICAgICBpdGVtc0RhdGFbaV0ucHJldlZpZXdEYXRhW2pdID0gaXRlbXNEYXRhW2ldLml0W2pdO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuc2VhcmNoU2hhcGVzKGFycltpXS5pdCxpdGVtc0RhdGFbaV0uaXQsaXRlbXNEYXRhW2ldLnByZXZWaWV3RGF0YSxpdGVtc0RhdGFbaV0uZ3IsZHluYW1pY1Byb3BlcnRpZXMsIGxldmVsICsgMSwgb3duVHJhbnNmb3JtZXJzLCByZW5kZXIpO1xyXG4gICAgICAgICAgICBpZihhcnJbaV0uX3JlbmRlcil7XHJcbiAgICAgICAgICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoaXRlbXNEYXRhW2ldLmdyKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1lbHNlIGlmKGFycltpXS50eSA9PSAndHInKXtcclxuICAgICAgICAgICAgaWYoIXByb2Nlc3NlZFBvcyl7XHJcbiAgICAgICAgICAgICAgICBpdGVtc0RhdGFbaV0gPSB0aGlzLmNyZWF0ZVRyYW5zZm9ybUVsZW1lbnQoYXJyW2ldLCBkeW5hbWljUHJvcGVydGllcyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY3VycmVudFRyYW5zZm9ybSA9IGl0ZW1zRGF0YVtpXS50cmFuc2Zvcm07XHJcbiAgICAgICAgICAgIG93blRyYW5zZm9ybWVycy5wdXNoKGN1cnJlbnRUcmFuc2Zvcm0pO1xyXG4gICAgICAgIH1lbHNlIGlmKGFycltpXS50eSA9PSAnc2gnIHx8IGFycltpXS50eSA9PSAncmMnIHx8IGFycltpXS50eSA9PSAnZWwnIHx8IGFycltpXS50eSA9PSAnc3InKXtcclxuICAgICAgICAgICAgaWYoIXByb2Nlc3NlZFBvcyl7XHJcbiAgICAgICAgICAgICAgICBpdGVtc0RhdGFbaV0gPSB0aGlzLmNyZWF0ZVNoYXBlRWxlbWVudChhcnJbaV0sIG93blRyYW5zZm9ybWVycywgbGV2ZWwsIGR5bmFtaWNQcm9wZXJ0aWVzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpdGVtc0RhdGFbaV0uZWxlbWVudHMgPSB0aGlzLnNldEVsZW1lbnRTdHlsZXMoKTtcclxuXHJcbiAgICAgICAgfWVsc2UgaWYoYXJyW2ldLnR5ID09ICd0bScgfHwgYXJyW2ldLnR5ID09ICdyZCcgfHwgYXJyW2ldLnR5ID09ICdtcycpe1xyXG4gICAgICAgICAgICBpZighcHJvY2Vzc2VkUG9zKXtcclxuICAgICAgICAgICAgICAgIG1vZGlmaWVyID0gU2hhcGVNb2RpZmllcnMuZ2V0TW9kaWZpZXIoYXJyW2ldLnR5KTtcclxuICAgICAgICAgICAgICAgIG1vZGlmaWVyLmluaXQodGhpcyxhcnJbaV0sZHluYW1pY1Byb3BlcnRpZXMpO1xyXG4gICAgICAgICAgICAgICAgaXRlbXNEYXRhW2ldID0gbW9kaWZpZXI7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNoYXBlTW9kaWZpZXJzLnB1c2gobW9kaWZpZXIpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgbW9kaWZpZXIgPSBpdGVtc0RhdGFbaV07XHJcbiAgICAgICAgICAgICAgICBtb2RpZmllci5jbG9zZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBvd25Nb2RpZmllcnMucHVzaChtb2RpZmllcik7XHJcbiAgICAgICAgfWVsc2UgaWYoYXJyW2ldLnR5ID09ICdycCcpe1xyXG4gICAgICAgICAgICBpZighcHJvY2Vzc2VkUG9zKXtcclxuICAgICAgICAgICAgICAgIG1vZGlmaWVyID0gU2hhcGVNb2RpZmllcnMuZ2V0TW9kaWZpZXIoYXJyW2ldLnR5KTtcclxuICAgICAgICAgICAgICAgIGl0ZW1zRGF0YVtpXSA9IG1vZGlmaWVyO1xyXG4gICAgICAgICAgICAgICAgbW9kaWZpZXIuaW5pdCh0aGlzLGFycixpLGl0ZW1zRGF0YSxkeW5hbWljUHJvcGVydGllcyk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNoYXBlTW9kaWZpZXJzLnB1c2gobW9kaWZpZXIpO1xyXG4gICAgICAgICAgICAgICAgcmVuZGVyID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgbW9kaWZpZXIgPSBpdGVtc0RhdGFbaV07XHJcbiAgICAgICAgICAgICAgICBtb2RpZmllci5jbG9zZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIG93bk1vZGlmaWVycy5wdXNoKG1vZGlmaWVyKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5hZGRQcm9jZXNzZWRFbGVtZW50KGFycltpXSwgaSArIDEpO1xyXG4gICAgfVxyXG4gICAgbGVuID0gb3duU3R5bGVzLmxlbmd0aDtcclxuICAgIGZvcihpPTA7aTxsZW47aSs9MSl7XHJcbiAgICAgICAgb3duU3R5bGVzW2ldLmNsb3NlZCA9IHRydWU7XHJcbiAgICB9XHJcbiAgICBsZW4gPSBvd25Nb2RpZmllcnMubGVuZ3RoO1xyXG4gICAgZm9yKGk9MDtpPGxlbjtpKz0xKXtcclxuICAgICAgICBvd25Nb2RpZmllcnNbaV0uY2xvc2VkID0gdHJ1ZTtcclxuICAgIH1cclxufTtcclxuXHJcbklTaGFwZUVsZW1lbnQucHJvdG90eXBlLmFkZFNoYXBlVG9Nb2RpZmllcnMgPSBmdW5jdGlvbihkYXRhKSB7XHJcbiAgICB2YXIgaSwgbGVuID0gdGhpcy5zaGFwZU1vZGlmaWVycy5sZW5ndGg7XHJcbiAgICBmb3IoaT0wO2k8bGVuO2krPTEpe1xyXG4gICAgICAgIHRoaXMuc2hhcGVNb2RpZmllcnNbaV0uYWRkU2hhcGUoZGF0YSk7XHJcbiAgICB9XHJcbn07XHJcblxyXG5JU2hhcGVFbGVtZW50LnByb3RvdHlwZS5yZW5kZXJNb2RpZmllcnMgPSBmdW5jdGlvbigpIHtcclxuICAgIGlmKCF0aGlzLnNoYXBlTW9kaWZpZXJzLmxlbmd0aCl7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgdmFyIGksIGxlbiA9IHRoaXMuc2hhcGVzLmxlbmd0aDtcclxuICAgIGZvcihpPTA7aTxsZW47aSs9MSl7XHJcbiAgICAgICAgdGhpcy5zaGFwZXNbaV0ucmVzZXQoKTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgbGVuID0gdGhpcy5zaGFwZU1vZGlmaWVycy5sZW5ndGg7XHJcblxyXG4gICAgZm9yKGk9bGVuLTE7aT49MDtpLT0xKXtcclxuICAgICAgICB0aGlzLnNoYXBlTW9kaWZpZXJzW2ldLnByb2Nlc3NTaGFwZXModGhpcy5maXJzdEZyYW1lKTtcclxuICAgIH1cclxufTtcclxuXHJcbklTaGFwZUVsZW1lbnQucHJvdG90eXBlLnJlbmRlckZyYW1lID0gZnVuY3Rpb24ocGFyZW50TWF0cml4KXtcclxuICAgIC8vdGhpcy5yZWxvYWRTaGFwZXMoKTtcclxuICAgIHZhciByZW5kZXJQYXJlbnQgPSB0aGlzLl9wYXJlbnQucmVuZGVyRnJhbWUuY2FsbCh0aGlzLHBhcmVudE1hdHJpeCk7XHJcbiAgICBpZihyZW5kZXJQYXJlbnQ9PT1mYWxzZSl7XHJcbiAgICAgICAgdGhpcy5oaWRlKCk7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgaWYodGhpcy5oaWRkZW4pe1xyXG4gICAgICAgIHRoaXMubGF5ZXJFbGVtZW50LnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snO1xyXG4gICAgICAgIHRoaXMuaGlkZGVuID0gZmFsc2U7XHJcbiAgICB9XHJcbiAgICB0aGlzLnJlbmRlck1vZGlmaWVycygpO1xyXG4gICAgdmFyIGksIGxlbiA9IHRoaXMuc3R5bGVzTGlzdC5sZW5ndGg7XHJcbiAgICBmb3IoaT0wO2k8bGVuO2krPTEpe1xyXG4gICAgICAgIHRoaXMuc3R5bGVzTGlzdFtpXS5kID0gJyc7XHJcbiAgICAgICAgdGhpcy5zdHlsZXNMaXN0W2ldLm1kZiA9IGZhbHNlO1xyXG4gICAgfVxyXG4gICAgdGhpcy5yZW5kZXJTaGFwZSh0aGlzLnNoYXBlc0RhdGEsdGhpcy5pdGVtc0RhdGEsIG51bGwpO1xyXG5cclxuICAgIGZvciAoaSA9IDA7IGkgPCBsZW47IGkgKz0gMSkge1xyXG4gICAgICAgIGlmICh0aGlzLnN0eWxlc0xpc3RbaV0ubGQgPT09ICcwJykge1xyXG4gICAgICAgICAgICB0aGlzLnN0eWxlc0xpc3RbaV0ubGQgPSAnMSc7XHJcbiAgICAgICAgICAgIHRoaXMuc3R5bGVzTGlzdFtpXS5wRWxlbS5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJztcclxuICAgICAgICAgICAgLy90aGlzLnN0eWxlc0xpc3RbaV0ucGFyZW50LmFwcGVuZENoaWxkKHRoaXMuc3R5bGVzTGlzdFtpXS5wRWxlbSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLnN0eWxlc0xpc3RbaV0ubWRmIHx8IHRoaXMuZmlyc3RGcmFtZSkge1xyXG4gICAgICAgICAgICB0aGlzLnN0eWxlc0xpc3RbaV0ucEVsZW0uc2V0QXR0cmlidXRlKCdkJywgdGhpcy5zdHlsZXNMaXN0W2ldLmQpO1xyXG4gICAgICAgICAgICBpZih0aGlzLnN0eWxlc0xpc3RbaV0ubXNFbGVtKXtcclxuICAgICAgICAgICAgICAgIHRoaXMuc3R5bGVzTGlzdFtpXS5tc0VsZW0uc2V0QXR0cmlidXRlKCdkJywgdGhpcy5zdHlsZXNMaXN0W2ldLmQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgaWYgKHRoaXMuZmlyc3RGcmFtZSkge1xyXG4gICAgICAgIHRoaXMuZmlyc3RGcmFtZSA9IGZhbHNlO1xyXG4gICAgfVxyXG59O1xyXG5cclxuSVNoYXBlRWxlbWVudC5wcm90b3R5cGUuaGlkZSA9IGZ1bmN0aW9uKCl7XHJcbiAgICBpZighdGhpcy5oaWRkZW4pe1xyXG4gICAgICAgIHRoaXMubGF5ZXJFbGVtZW50LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XHJcbiAgICAgICAgdmFyIGksIGxlbiA9IHRoaXMuc3R5bGVzTGlzdC5sZW5ndGg7XHJcbiAgICAgICAgZm9yKGk9bGVuLTE7aT49MDtpLT0xKXtcclxuICAgICAgICAgICAgaWYodGhpcy5zdHlsZXNMaXN0W2ldLmxkICE9PSAnMCcpe1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zdHlsZXNMaXN0W2ldLmxkID0gJzAnO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zdHlsZXNMaXN0W2ldLnBFbGVtLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XHJcbiAgICAgICAgICAgICAgICBpZih0aGlzLnN0eWxlc0xpc3RbaV0ucEVsZW0ucGFyZW50Tm9kZSl7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zdHlsZXNMaXN0W2ldLnBhcmVudCA9IHRoaXMuc3R5bGVzTGlzdFtpXS5wRWxlbS5wYXJlbnROb2RlO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vdGhpcy5zdHlsZXNMaXN0W2ldLnBFbGVtLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodGhpcy5zdHlsZXNMaXN0W2ldLnBFbGVtKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmhpZGRlbiA9IHRydWU7XHJcbiAgICB9XHJcbn07XHJcblxyXG5JU2hhcGVFbGVtZW50LnByb3RvdHlwZS5yZW5kZXJTaGFwZSA9IGZ1bmN0aW9uKGl0ZW1zLGRhdGEsIGNvbnRhaW5lcil7XHJcbiAgICB2YXIgaSwgbGVuID0gaXRlbXMubGVuZ3RoIC0gMTtcclxuICAgIHZhciB0eTtcclxuICAgIGZvcihpPWxlbjtpPj0wO2ktPTEpe1xyXG4gICAgICAgIHR5ID0gaXRlbXNbaV0udHk7XHJcbiAgICAgICAgaWYodHkgPT0gJ3RyJyl7XHJcbiAgICAgICAgICAgIGlmKHRoaXMuZmlyc3RGcmFtZSB8fCBkYXRhW2ldLnRyYW5zZm9ybS5vcC5tZGYgJiYgY29udGFpbmVyKXtcclxuICAgICAgICAgICAgICAgIGNvbnRhaW5lci5zZXRBdHRyaWJ1dGUoJ29wYWNpdHknLGRhdGFbaV0udHJhbnNmb3JtLm9wLnYpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmKHRoaXMuZmlyc3RGcmFtZSB8fCBkYXRhW2ldLnRyYW5zZm9ybS5tUHJvcHMubWRmICYmIGNvbnRhaW5lcil7XHJcbiAgICAgICAgICAgICAgICBjb250YWluZXIuc2V0QXR0cmlidXRlKCd0cmFuc2Zvcm0nLGRhdGFbaV0udHJhbnNmb3JtLm1Qcm9wcy52LnRvMmRDU1MoKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9ZWxzZSBpZih0eSA9PSAnc2gnIHx8IHR5ID09ICdlbCcgfHwgdHkgPT0gJ3JjJyB8fCB0eSA9PSAnc3InKXtcclxuICAgICAgICAgICAgdGhpcy5yZW5kZXJQYXRoKGl0ZW1zW2ldLGRhdGFbaV0pO1xyXG4gICAgICAgIH1lbHNlIGlmKHR5ID09ICdmbCcpe1xyXG4gICAgICAgICAgICB0aGlzLnJlbmRlckZpbGwoaXRlbXNbaV0sZGF0YVtpXSk7XHJcbiAgICAgICAgfWVsc2UgaWYodHkgPT0gJ2dmJyl7XHJcbiAgICAgICAgICAgIHRoaXMucmVuZGVyR3JhZGllbnQoaXRlbXNbaV0sZGF0YVtpXSk7XHJcbiAgICAgICAgfWVsc2UgaWYodHkgPT0gJ2dzJyl7XHJcbiAgICAgICAgICAgIHRoaXMucmVuZGVyR3JhZGllbnQoaXRlbXNbaV0sZGF0YVtpXSk7XHJcbiAgICAgICAgICAgIHRoaXMucmVuZGVyU3Ryb2tlKGl0ZW1zW2ldLGRhdGFbaV0pO1xyXG4gICAgICAgIH1lbHNlIGlmKHR5ID09ICdzdCcpe1xyXG4gICAgICAgICAgICB0aGlzLnJlbmRlclN0cm9rZShpdGVtc1tpXSxkYXRhW2ldKTtcclxuICAgICAgICB9ZWxzZSBpZih0eSA9PSAnZ3InKXtcclxuICAgICAgICAgICAgdGhpcy5yZW5kZXJTaGFwZShpdGVtc1tpXS5pdCxkYXRhW2ldLml0LCBkYXRhW2ldLmdyKTtcclxuICAgICAgICB9ZWxzZSBpZih0eSA9PSAndG0nKXtcclxuICAgICAgICAgICAgLy9cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG59O1xyXG5cclxuSVNoYXBlRWxlbWVudC5wcm90b3R5cGUuYnVpbGRTaGFwZVN0cmluZyA9IGZ1bmN0aW9uKHBhdGhOb2RlcywgbGVuZ3RoLCBjbG9zZWQsIG1hdCkge1xyXG4gICAgdmFyIGksIHNoYXBlU3RyaW5nID0gJyc7XHJcbiAgICBmb3IoaSA9IDE7IGkgPCBsZW5ndGg7IGkgKz0gMSkge1xyXG4gICAgICAgIGlmIChpID09PSAxKSB7XHJcbiAgICAgICAgICAgIHNoYXBlU3RyaW5nICs9IFwiIE1cIiArIG1hdC5hcHBseVRvUG9pbnRTdHJpbmdpZmllZChwYXRoTm9kZXMudlswXVswXSwgcGF0aE5vZGVzLnZbMF1bMV0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBzaGFwZVN0cmluZyArPSBcIiBDXCIgKyBtYXQuYXBwbHlUb1BvaW50U3RyaW5naWZpZWQocGF0aE5vZGVzLm9baSAtIDFdWzBdLCBwYXRoTm9kZXMub1tpIC0gMV1bMV0pICsgXCIgXCIgKyBtYXQuYXBwbHlUb1BvaW50U3RyaW5naWZpZWQocGF0aE5vZGVzLmlbaV1bMF0sIHBhdGhOb2Rlcy5pW2ldWzFdKSArIFwiIFwiICsgbWF0LmFwcGx5VG9Qb2ludFN0cmluZ2lmaWVkKHBhdGhOb2Rlcy52W2ldWzBdLCBwYXRoTm9kZXMudltpXVsxXSk7XHJcbiAgICB9XHJcbiAgICBpZiAobGVuZ3RoID09PSAxKSB7XHJcbiAgICAgICAgc2hhcGVTdHJpbmcgKz0gXCIgTVwiICsgbWF0LmFwcGx5VG9Qb2ludFN0cmluZ2lmaWVkKHBhdGhOb2Rlcy52WzBdWzBdLCBwYXRoTm9kZXMudlswXVsxXSk7XHJcbiAgICB9XHJcbiAgICBpZiAoY2xvc2VkICYmIGxlbmd0aCkge1xyXG4gICAgICAgIHNoYXBlU3RyaW5nICs9IFwiIENcIiArIG1hdC5hcHBseVRvUG9pbnRTdHJpbmdpZmllZChwYXRoTm9kZXMub1tpIC0gMV1bMF0sIHBhdGhOb2Rlcy5vW2kgLSAxXVsxXSkgKyBcIiBcIiArIG1hdC5hcHBseVRvUG9pbnRTdHJpbmdpZmllZChwYXRoTm9kZXMuaVswXVswXSwgcGF0aE5vZGVzLmlbMF1bMV0pICsgXCIgXCIgKyBtYXQuYXBwbHlUb1BvaW50U3RyaW5naWZpZWQocGF0aE5vZGVzLnZbMF1bMF0sIHBhdGhOb2Rlcy52WzBdWzFdKTtcclxuICAgICAgICBzaGFwZVN0cmluZyArPSAneic7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gc2hhcGVTdHJpbmc7XHJcbn07XHJcblxyXG5JU2hhcGVFbGVtZW50LnByb3RvdHlwZS5yZW5kZXJQYXRoID0gZnVuY3Rpb24ocGF0aERhdGEsaXRlbURhdGEpe1xyXG4gICAgdmFyIGxlbiwgaSwgaiwgakxlbixwYXRoU3RyaW5nVHJhbnNmb3JtZWQscmVkcmF3LHBhdGhOb2RlcyxsLCBsTGVuID0gaXRlbURhdGEuZWxlbWVudHMubGVuZ3RoO1xyXG4gICAgdmFyIGx2bCA9IGl0ZW1EYXRhLmx2bDtcclxuICAgIGlmKCFwYXRoRGF0YS5fcmVuZGVyKXtcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBmb3IobD0wO2w8bExlbjtsKz0xKXtcclxuICAgICAgICBpZihpdGVtRGF0YS5lbGVtZW50c1tsXS5kYXRhLl9yZW5kZXIpe1xyXG4gICAgICAgICAgICByZWRyYXcgPSBpdGVtRGF0YS5zaC5tZGYgfHwgdGhpcy5maXJzdEZyYW1lO1xyXG4gICAgICAgICAgICBwYXRoU3RyaW5nVHJhbnNmb3JtZWQgPSAnTTAgMCc7XHJcbiAgICAgICAgICAgIHZhciBwYXRocyA9IGl0ZW1EYXRhLnNoLnBhdGhzO1xyXG4gICAgICAgICAgICBqTGVuID0gcGF0aHMuX2xlbmd0aDtcclxuICAgICAgICAgICAgaWYoaXRlbURhdGEuZWxlbWVudHNbbF0ubHZsIDwgbHZsKXtcclxuICAgICAgICAgICAgICAgIHZhciBtYXQgPSB0aGlzLm1IZWxwZXIucmVzZXQoKSwgcHJvcHM7XHJcbiAgICAgICAgICAgICAgICB2YXIgaXRlcmF0aW9ucyA9IGx2bCAtIGl0ZW1EYXRhLmVsZW1lbnRzW2xdLmx2bDtcclxuICAgICAgICAgICAgICAgIHZhciBrID0gaXRlbURhdGEudHJhbnNmb3JtZXJzLmxlbmd0aC0xO1xyXG4gICAgICAgICAgICAgICAgd2hpbGUoaXRlcmF0aW9ucyA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICByZWRyYXcgPSBpdGVtRGF0YS50cmFuc2Zvcm1lcnNba10ubVByb3BzLm1kZiB8fCByZWRyYXc7XHJcbiAgICAgICAgICAgICAgICAgICAgcHJvcHMgPSBpdGVtRGF0YS50cmFuc2Zvcm1lcnNba10ubVByb3BzLnYucHJvcHM7XHJcbiAgICAgICAgICAgICAgICAgICAgbWF0LnRyYW5zZm9ybShwcm9wc1swXSxwcm9wc1sxXSxwcm9wc1syXSxwcm9wc1szXSxwcm9wc1s0XSxwcm9wc1s1XSxwcm9wc1s2XSxwcm9wc1s3XSxwcm9wc1s4XSxwcm9wc1s5XSxwcm9wc1sxMF0scHJvcHNbMTFdLHByb3BzWzEyXSxwcm9wc1sxM10scHJvcHNbMTRdLHByb3BzWzE1XSk7XHJcbiAgICAgICAgICAgICAgICAgICAgaXRlcmF0aW9ucyAtLTtcclxuICAgICAgICAgICAgICAgICAgICBrIC0tO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYocmVkcmF3KXtcclxuICAgICAgICAgICAgICAgICAgICBmb3Ioaj0wO2o8akxlbjtqKz0xKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcGF0aE5vZGVzID0gcGF0aHMuc2hhcGVzW2pdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZihwYXRoTm9kZXMgJiYgcGF0aE5vZGVzLl9sZW5ndGgpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF0aFN0cmluZ1RyYW5zZm9ybWVkICs9IHRoaXMuYnVpbGRTaGFwZVN0cmluZyhwYXRoTm9kZXMsIHBhdGhOb2Rlcy5fbGVuZ3RoLCBwYXRoTm9kZXMuYywgbWF0KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpdGVtRGF0YS5jYWNoZXNbbF0gPSBwYXRoU3RyaW5nVHJhbnNmb3JtZWQ7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHBhdGhTdHJpbmdUcmFuc2Zvcm1lZCA9IGl0ZW1EYXRhLmNhY2hlc1tsXTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGlmKHJlZHJhdyl7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yKGo9MDtqPGpMZW47ais9MSl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhdGhOb2RlcyA9IHBhdGhzLnNoYXBlc1tqXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYocGF0aE5vZGVzICYmIHBhdGhOb2Rlcy5fbGVuZ3RoKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhdGhTdHJpbmdUcmFuc2Zvcm1lZCArPSB0aGlzLmJ1aWxkU2hhcGVTdHJpbmcocGF0aE5vZGVzLCBwYXRoTm9kZXMuX2xlbmd0aCwgcGF0aE5vZGVzLmMsIHRoaXMuaWRlbnRpdHlNYXRyaXgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGl0ZW1EYXRhLmNhY2hlc1tsXSA9IHBhdGhTdHJpbmdUcmFuc2Zvcm1lZDtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcGF0aFN0cmluZ1RyYW5zZm9ybWVkID0gaXRlbURhdGEuY2FjaGVzW2xdO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGl0ZW1EYXRhLmVsZW1lbnRzW2xdLmQgKz0gcGF0aFN0cmluZ1RyYW5zZm9ybWVkO1xyXG4gICAgICAgICAgICBpdGVtRGF0YS5lbGVtZW50c1tsXS5tZGYgPSByZWRyYXcgfHwgaXRlbURhdGEuZWxlbWVudHNbbF0ubWRmO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGl0ZW1EYXRhLmVsZW1lbnRzW2xdLm1kZiA9IHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59O1xyXG5cclxuSVNoYXBlRWxlbWVudC5wcm90b3R5cGUucmVuZGVyRmlsbCA9IGZ1bmN0aW9uKHN0eWxlRGF0YSxpdGVtRGF0YSl7XHJcbiAgICB2YXIgc3R5bGVFbGVtID0gaXRlbURhdGEuc3R5bGU7XHJcblxyXG4gICAgaWYoaXRlbURhdGEuYy5tZGYgfHwgdGhpcy5maXJzdEZyYW1lKXtcclxuICAgICAgICBzdHlsZUVsZW0ucEVsZW0uc2V0QXR0cmlidXRlKCdmaWxsJywncmdiKCcrYm1fZmxvb3IoaXRlbURhdGEuYy52WzBdKSsnLCcrYm1fZmxvb3IoaXRlbURhdGEuYy52WzFdKSsnLCcrYm1fZmxvb3IoaXRlbURhdGEuYy52WzJdKSsnKScpO1xyXG4gICAgICAgIC8vLy9zdHlsZUVsZW0ucEVsZW0uc3R5bGUuZmlsbCA9ICdyZ2IoJytibV9mbG9vcihpdGVtRGF0YS5jLnZbMF0pKycsJytibV9mbG9vcihpdGVtRGF0YS5jLnZbMV0pKycsJytibV9mbG9vcihpdGVtRGF0YS5jLnZbMl0pKycpJztcclxuICAgIH1cclxuICAgIGlmKGl0ZW1EYXRhLm8ubWRmIHx8IHRoaXMuZmlyc3RGcmFtZSl7XHJcbiAgICAgICAgc3R5bGVFbGVtLnBFbGVtLnNldEF0dHJpYnV0ZSgnZmlsbC1vcGFjaXR5JyxpdGVtRGF0YS5vLnYpO1xyXG4gICAgfVxyXG59O1xyXG5cclxuSVNoYXBlRWxlbWVudC5wcm90b3R5cGUucmVuZGVyR3JhZGllbnQgPSBmdW5jdGlvbihzdHlsZURhdGEsaXRlbURhdGEpe1xyXG4gICAgdmFyIGdmaWxsID0gaXRlbURhdGEuZ2Y7XHJcbiAgICB2YXIgb3BGaWxsID0gaXRlbURhdGEub2Y7XHJcbiAgICB2YXIgcHQxID0gaXRlbURhdGEucy52LHB0MiA9IGl0ZW1EYXRhLmUudjtcclxuXHJcbiAgICBpZihpdGVtRGF0YS5vLm1kZiB8fCB0aGlzLmZpcnN0RnJhbWUpe1xyXG4gICAgICAgIHZhciBhdHRyID0gc3R5bGVEYXRhLnR5ID09PSAnZ2YnID8gJ2ZpbGwtb3BhY2l0eSc6J3N0cm9rZS1vcGFjaXR5JztcclxuICAgICAgICBpdGVtRGF0YS5lbGVtLnNldEF0dHJpYnV0ZShhdHRyLGl0ZW1EYXRhLm8udik7XHJcbiAgICB9XHJcbiAgICAvL2NsaXBwZWRFbGVtZW50LnNldEF0dHJpYnV0ZSgndHJhbnNmb3JtJywnbWF0cml4KDEsMCwwLDEsLTEwMCwwKScpO1xyXG4gICAgaWYoaXRlbURhdGEucy5tZGYgfHwgdGhpcy5maXJzdEZyYW1lKXtcclxuICAgICAgICB2YXIgYXR0cjEgPSBzdHlsZURhdGEudCA9PT0gMSA/ICd4MSc6J2N4JztcclxuICAgICAgICB2YXIgYXR0cjIgPSBhdHRyMSA9PT0gJ3gxJyA/ICd5MSc6J2N5JztcclxuICAgICAgICBnZmlsbC5zZXRBdHRyaWJ1dGUoYXR0cjEscHQxWzBdKTtcclxuICAgICAgICBnZmlsbC5zZXRBdHRyaWJ1dGUoYXR0cjIscHQxWzFdKTtcclxuICAgICAgICBpZihvcEZpbGwpe1xyXG4gICAgICAgICAgICBvcEZpbGwuc2V0QXR0cmlidXRlKGF0dHIxLHB0MVswXSk7XHJcbiAgICAgICAgICAgIG9wRmlsbC5zZXRBdHRyaWJ1dGUoYXR0cjIscHQxWzFdKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICB2YXIgc3RvcHMsIGksIGxlbiwgc3RvcDtcclxuICAgIGlmKGl0ZW1EYXRhLmcuY21kZiB8fCB0aGlzLmZpcnN0RnJhbWUpe1xyXG4gICAgICAgIHN0b3BzID0gaXRlbURhdGEuY3N0O1xyXG4gICAgICAgIHZhciBjVmFsdWVzID0gaXRlbURhdGEuZy5jO1xyXG4gICAgICAgIGxlbiA9IHN0b3BzLmxlbmd0aDtcclxuICAgICAgICBmb3IoaT0wO2k8bGVuO2krPTEpe1xyXG4gICAgICAgICAgICBzdG9wID0gc3RvcHNbaV07XHJcbiAgICAgICAgICAgIHN0b3Auc2V0QXR0cmlidXRlKCdvZmZzZXQnLGNWYWx1ZXNbaSo0XSsnJScpO1xyXG4gICAgICAgICAgICBzdG9wLnNldEF0dHJpYnV0ZSgnc3RvcC1jb2xvcicsJ3JnYignK2NWYWx1ZXNbaSo0KzFdKycsJytjVmFsdWVzW2kqNCsyXSsnLCcrY1ZhbHVlc1tpKjQrM10rJyknKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBpZihvcEZpbGwgJiYgKGl0ZW1EYXRhLmcub21kZiB8fCB0aGlzLmZpcnN0RnJhbWUpKXtcclxuICAgICAgICBzdG9wcyA9IGl0ZW1EYXRhLm9zdDtcclxuICAgICAgICB2YXIgb1ZhbHVlcyA9IGl0ZW1EYXRhLmcubztcclxuICAgICAgICBsZW4gPSBzdG9wcy5sZW5ndGg7XHJcbiAgICAgICAgZm9yKGk9MDtpPGxlbjtpKz0xKXtcclxuICAgICAgICAgICAgc3RvcCA9IHN0b3BzW2ldO1xyXG4gICAgICAgICAgICBzdG9wLnNldEF0dHJpYnV0ZSgnb2Zmc2V0JyxvVmFsdWVzW2kqMl0rJyUnKTtcclxuICAgICAgICAgICAgc3RvcC5zZXRBdHRyaWJ1dGUoJ3N0b3Atb3BhY2l0eScsb1ZhbHVlc1tpKjIrMV0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGlmKHN0eWxlRGF0YS50ID09PSAxKXtcclxuICAgICAgICBpZihpdGVtRGF0YS5lLm1kZiAgfHwgdGhpcy5maXJzdEZyYW1lKXtcclxuICAgICAgICAgICAgZ2ZpbGwuc2V0QXR0cmlidXRlKCd4MicscHQyWzBdKTtcclxuICAgICAgICAgICAgZ2ZpbGwuc2V0QXR0cmlidXRlKCd5MicscHQyWzFdKTtcclxuICAgICAgICAgICAgaWYob3BGaWxsKXtcclxuICAgICAgICAgICAgICAgIG9wRmlsbC5zZXRBdHRyaWJ1dGUoJ3gyJyxwdDJbMF0pO1xyXG4gICAgICAgICAgICAgICAgb3BGaWxsLnNldEF0dHJpYnV0ZSgneTInLHB0MlsxXSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIHZhciByYWQ7XHJcbiAgICAgICAgaWYoaXRlbURhdGEucy5tZGYgfHwgaXRlbURhdGEuZS5tZGYgfHwgdGhpcy5maXJzdEZyYW1lKXtcclxuICAgICAgICAgICAgcmFkID0gTWF0aC5zcXJ0KE1hdGgucG93KHB0MVswXS1wdDJbMF0sMikrTWF0aC5wb3cocHQxWzFdLXB0MlsxXSwyKSk7XHJcbiAgICAgICAgICAgIGdmaWxsLnNldEF0dHJpYnV0ZSgncicscmFkKTtcclxuICAgICAgICAgICAgaWYob3BGaWxsKXtcclxuICAgICAgICAgICAgICAgIG9wRmlsbC5zZXRBdHRyaWJ1dGUoJ3InLHJhZCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgaWYoaXRlbURhdGEuZS5tZGYgfHwgaXRlbURhdGEuaC5tZGYgfHwgaXRlbURhdGEuYS5tZGYgfHwgdGhpcy5maXJzdEZyYW1lKXtcclxuICAgICAgICAgICAgaWYoIXJhZCl7XHJcbiAgICAgICAgICAgICAgICByYWQgPSBNYXRoLnNxcnQoTWF0aC5wb3cocHQxWzBdLXB0MlswXSwyKStNYXRoLnBvdyhwdDFbMV0tcHQyWzFdLDIpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB2YXIgYW5nID0gTWF0aC5hdGFuMihwdDJbMV0tcHQxWzFdLCBwdDJbMF0tcHQxWzBdKTtcclxuXHJcbiAgICAgICAgICAgIHZhciBwZXJjZW50ID0gaXRlbURhdGEuaC52ID49IDEgPyAwLjk5IDogaXRlbURhdGEuaC52IDw9IC0xID8gLTAuOTk6aXRlbURhdGEuaC52O1xyXG4gICAgICAgICAgICB2YXIgZGlzdCA9IHJhZCpwZXJjZW50O1xyXG4gICAgICAgICAgICB2YXIgeCA9IE1hdGguY29zKGFuZyArIGl0ZW1EYXRhLmEudikqZGlzdCArIHB0MVswXTtcclxuICAgICAgICAgICAgdmFyIHkgPSBNYXRoLnNpbihhbmcgKyBpdGVtRGF0YS5hLnYpKmRpc3QgKyBwdDFbMV07XHJcbiAgICAgICAgICAgIGdmaWxsLnNldEF0dHJpYnV0ZSgnZngnLHgpO1xyXG4gICAgICAgICAgICBnZmlsbC5zZXRBdHRyaWJ1dGUoJ2Z5Jyx5KTtcclxuICAgICAgICAgICAgaWYob3BGaWxsKXtcclxuICAgICAgICAgICAgICAgIG9wRmlsbC5zZXRBdHRyaWJ1dGUoJ2Z4Jyx4KTtcclxuICAgICAgICAgICAgICAgIG9wRmlsbC5zZXRBdHRyaWJ1dGUoJ2Z5Jyx5KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICAvL2dmaWxsLnNldEF0dHJpYnV0ZSgnZnknLCcyMDAnKTtcclxuICAgIH1cclxufTtcclxuXHJcbklTaGFwZUVsZW1lbnQucHJvdG90eXBlLnJlbmRlclN0cm9rZSA9IGZ1bmN0aW9uKHN0eWxlRGF0YSxpdGVtRGF0YSl7XHJcbiAgICB2YXIgc3R5bGVFbGVtID0gaXRlbURhdGEuc3R5bGU7XHJcbiAgICAvL1RPRE8gZml4IGRhc2hlc1xyXG4gICAgdmFyIGQgPSBpdGVtRGF0YS5kO1xyXG4gICAgdmFyIGRhc2hhcnJheSxkYXNob2Zmc2V0O1xyXG4gICAgaWYoZCAmJiBkLmsgJiYgKGQubWRmIHx8IHRoaXMuZmlyc3RGcmFtZSkpe1xyXG4gICAgICAgIHN0eWxlRWxlbS5wRWxlbS5zZXRBdHRyaWJ1dGUoJ3N0cm9rZS1kYXNoYXJyYXknLCBkLmRhc2hhcnJheSk7XHJcbiAgICAgICAgLy8vL3N0eWxlRWxlbS5wRWxlbS5zdHlsZS5zdHJva2VEYXNoYXJyYXkgPSBkLmRhc2hhcnJheTtcclxuICAgICAgICBzdHlsZUVsZW0ucEVsZW0uc2V0QXR0cmlidXRlKCdzdHJva2UtZGFzaG9mZnNldCcsIGQuZGFzaG9mZnNldCk7XHJcbiAgICAgICAgLy8vL3N0eWxlRWxlbS5wRWxlbS5zdHlsZS5zdHJva2VEYXNob2Zmc2V0ID0gZC5kYXNob2Zmc2V0O1xyXG4gICAgfVxyXG4gICAgaWYoaXRlbURhdGEuYyAmJiAoaXRlbURhdGEuYy5tZGYgfHwgdGhpcy5maXJzdEZyYW1lKSl7XHJcbiAgICAgICAgc3R5bGVFbGVtLnBFbGVtLnNldEF0dHJpYnV0ZSgnc3Ryb2tlJywncmdiKCcrYm1fZmxvb3IoaXRlbURhdGEuYy52WzBdKSsnLCcrYm1fZmxvb3IoaXRlbURhdGEuYy52WzFdKSsnLCcrYm1fZmxvb3IoaXRlbURhdGEuYy52WzJdKSsnKScpO1xyXG4gICAgICAgIC8vLy9zdHlsZUVsZW0ucEVsZW0uc3R5bGUuc3Ryb2tlID0gJ3JnYignK2JtX2Zsb29yKGl0ZW1EYXRhLmMudlswXSkrJywnK2JtX2Zsb29yKGl0ZW1EYXRhLmMudlsxXSkrJywnK2JtX2Zsb29yKGl0ZW1EYXRhLmMudlsyXSkrJyknO1xyXG4gICAgfVxyXG4gICAgaWYoaXRlbURhdGEuby5tZGYgfHwgdGhpcy5maXJzdEZyYW1lKXtcclxuICAgICAgICBzdHlsZUVsZW0ucEVsZW0uc2V0QXR0cmlidXRlKCdzdHJva2Utb3BhY2l0eScsaXRlbURhdGEuby52KTtcclxuICAgIH1cclxuICAgIGlmKGl0ZW1EYXRhLncubWRmIHx8IHRoaXMuZmlyc3RGcmFtZSl7XHJcbiAgICAgICAgc3R5bGVFbGVtLnBFbGVtLnNldEF0dHJpYnV0ZSgnc3Ryb2tlLXdpZHRoJyxpdGVtRGF0YS53LnYpO1xyXG4gICAgICAgIGlmKHN0eWxlRWxlbS5tc0VsZW0pe1xyXG4gICAgICAgICAgICBzdHlsZUVsZW0ubXNFbGVtLnNldEF0dHJpYnV0ZSgnc3Ryb2tlLXdpZHRoJyxpdGVtRGF0YS53LnYpO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLy8vc3R5bGVFbGVtLnBFbGVtLnN0eWxlLnN0cm9rZVdpZHRoID0gaXRlbURhdGEudy52O1xyXG4gICAgfVxyXG59O1xyXG5cclxuSVNoYXBlRWxlbWVudC5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uKCl7XHJcbiAgICB0aGlzLl9wYXJlbnQuZGVzdHJveS5jYWxsKHRoaXMuX3BhcmVudCk7XHJcbiAgICB0aGlzLnNoYXBlRGF0YSA9IG51bGw7XHJcbiAgICB0aGlzLml0ZW1zRGF0YSA9IG51bGw7XHJcbiAgICB0aGlzLnBhcmVudENvbnRhaW5lciA9IG51bGw7XHJcbiAgICB0aGlzLnBsYWNlaG9sZGVyID0gbnVsbDtcclxufTtcclxuXG5mdW5jdGlvbiBJVGV4dEVsZW1lbnQoZGF0YSwgYW5pbWF0aW9uSXRlbSxwYXJlbnRDb250YWluZXIsZ2xvYmFsRGF0YSl7XHJcbn1cclxuSVRleHRFbGVtZW50LnByb3RvdHlwZS5pbml0ID0gZnVuY3Rpb24oKXtcclxuICAgIHRoaXMuX3BhcmVudC5pbml0LmNhbGwodGhpcyk7XHJcblxyXG4gICAgdGhpcy5sZXR0ZXJzQ2hhbmdlZEZsYWcgPSBmYWxzZTtcclxuICAgIHRoaXMuY3VycmVudFRleHREb2N1bWVudERhdGEgPSB7fTtcclxuICAgIHZhciBkYXRhID0gdGhpcy5kYXRhO1xyXG4gICAgdGhpcy52aWV3RGF0YSA9IHtcclxuICAgICAgICBtOntcclxuICAgICAgICAgICAgYTogUHJvcGVydHlGYWN0b3J5LmdldFByb3AodGhpcyxkYXRhLnQubS5hLDEsMCx0aGlzLmR5bmFtaWNQcm9wZXJ0aWVzKVxyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICB2YXIgdGV4dERhdGEgPSB0aGlzLmRhdGEudDtcclxuICAgIGlmKHRleHREYXRhLmEubGVuZ3RoKXtcclxuICAgICAgICB0aGlzLnZpZXdEYXRhLmEgPSBBcnJheS5hcHBseShudWxsLHtsZW5ndGg6dGV4dERhdGEuYS5sZW5ndGh9KTtcclxuICAgICAgICB2YXIgaSwgbGVuID0gdGV4dERhdGEuYS5sZW5ndGgsIGFuaW1hdG9yRGF0YSwgYW5pbWF0b3JQcm9wcztcclxuICAgICAgICBmb3IoaT0wO2k8bGVuO2krPTEpe1xyXG4gICAgICAgICAgICBhbmltYXRvclByb3BzID0gdGV4dERhdGEuYVtpXTtcclxuICAgICAgICAgICAgYW5pbWF0b3JEYXRhID0ge1xyXG4gICAgICAgICAgICAgICAgYToge30sXHJcbiAgICAgICAgICAgICAgICBzOiB7fVxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICBpZigncicgaW4gYW5pbWF0b3JQcm9wcy5hKSB7XHJcbiAgICAgICAgICAgICAgICBhbmltYXRvckRhdGEuYS5yID0gUHJvcGVydHlGYWN0b3J5LmdldFByb3AodGhpcyxhbmltYXRvclByb3BzLmEuciwwLGRlZ1RvUmFkcyx0aGlzLmR5bmFtaWNQcm9wZXJ0aWVzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZigncngnIGluIGFuaW1hdG9yUHJvcHMuYSkge1xyXG4gICAgICAgICAgICAgICAgYW5pbWF0b3JEYXRhLmEucnggPSBQcm9wZXJ0eUZhY3RvcnkuZ2V0UHJvcCh0aGlzLGFuaW1hdG9yUHJvcHMuYS5yeCwwLGRlZ1RvUmFkcyx0aGlzLmR5bmFtaWNQcm9wZXJ0aWVzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZigncnknIGluIGFuaW1hdG9yUHJvcHMuYSkge1xyXG4gICAgICAgICAgICAgICAgYW5pbWF0b3JEYXRhLmEucnkgPSBQcm9wZXJ0eUZhY3RvcnkuZ2V0UHJvcCh0aGlzLGFuaW1hdG9yUHJvcHMuYS5yeSwwLGRlZ1RvUmFkcyx0aGlzLmR5bmFtaWNQcm9wZXJ0aWVzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZignc2snIGluIGFuaW1hdG9yUHJvcHMuYSkge1xyXG4gICAgICAgICAgICAgICAgYW5pbWF0b3JEYXRhLmEuc2sgPSBQcm9wZXJ0eUZhY3RvcnkuZ2V0UHJvcCh0aGlzLGFuaW1hdG9yUHJvcHMuYS5zaywwLGRlZ1RvUmFkcyx0aGlzLmR5bmFtaWNQcm9wZXJ0aWVzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZignc2EnIGluIGFuaW1hdG9yUHJvcHMuYSkge1xyXG4gICAgICAgICAgICAgICAgYW5pbWF0b3JEYXRhLmEuc2EgPSBQcm9wZXJ0eUZhY3RvcnkuZ2V0UHJvcCh0aGlzLGFuaW1hdG9yUHJvcHMuYS5zYSwwLGRlZ1RvUmFkcyx0aGlzLmR5bmFtaWNQcm9wZXJ0aWVzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZigncycgaW4gYW5pbWF0b3JQcm9wcy5hKSB7XHJcbiAgICAgICAgICAgICAgICBhbmltYXRvckRhdGEuYS5zID0gUHJvcGVydHlGYWN0b3J5LmdldFByb3AodGhpcyxhbmltYXRvclByb3BzLmEucywxLDAuMDEsdGhpcy5keW5hbWljUHJvcGVydGllcyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYoJ2EnIGluIGFuaW1hdG9yUHJvcHMuYSkge1xyXG4gICAgICAgICAgICAgICAgYW5pbWF0b3JEYXRhLmEuYSA9IFByb3BlcnR5RmFjdG9yeS5nZXRQcm9wKHRoaXMsYW5pbWF0b3JQcm9wcy5hLmEsMSwwLHRoaXMuZHluYW1pY1Byb3BlcnRpZXMpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmKCdvJyBpbiBhbmltYXRvclByb3BzLmEpIHtcclxuICAgICAgICAgICAgICAgIGFuaW1hdG9yRGF0YS5hLm8gPSBQcm9wZXJ0eUZhY3RvcnkuZ2V0UHJvcCh0aGlzLGFuaW1hdG9yUHJvcHMuYS5vLDAsMC4wMSx0aGlzLmR5bmFtaWNQcm9wZXJ0aWVzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZigncCcgaW4gYW5pbWF0b3JQcm9wcy5hKSB7XHJcbiAgICAgICAgICAgICAgICBhbmltYXRvckRhdGEuYS5wID0gUHJvcGVydHlGYWN0b3J5LmdldFByb3AodGhpcyxhbmltYXRvclByb3BzLmEucCwxLDAsdGhpcy5keW5hbWljUHJvcGVydGllcyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYoJ3N3JyBpbiBhbmltYXRvclByb3BzLmEpIHtcclxuICAgICAgICAgICAgICAgIGFuaW1hdG9yRGF0YS5hLnN3ID0gUHJvcGVydHlGYWN0b3J5LmdldFByb3AodGhpcyxhbmltYXRvclByb3BzLmEuc3csMCwwLHRoaXMuZHluYW1pY1Byb3BlcnRpZXMpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmKCdzYycgaW4gYW5pbWF0b3JQcm9wcy5hKSB7XHJcbiAgICAgICAgICAgICAgICBhbmltYXRvckRhdGEuYS5zYyA9IFByb3BlcnR5RmFjdG9yeS5nZXRQcm9wKHRoaXMsYW5pbWF0b3JQcm9wcy5hLnNjLDEsMCx0aGlzLmR5bmFtaWNQcm9wZXJ0aWVzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZignZmMnIGluIGFuaW1hdG9yUHJvcHMuYSkge1xyXG4gICAgICAgICAgICAgICAgYW5pbWF0b3JEYXRhLmEuZmMgPSBQcm9wZXJ0eUZhY3RvcnkuZ2V0UHJvcCh0aGlzLGFuaW1hdG9yUHJvcHMuYS5mYywxLDAsdGhpcy5keW5hbWljUHJvcGVydGllcyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYoJ2ZoJyBpbiBhbmltYXRvclByb3BzLmEpIHtcclxuICAgICAgICAgICAgICAgIGFuaW1hdG9yRGF0YS5hLmZoID0gUHJvcGVydHlGYWN0b3J5LmdldFByb3AodGhpcyxhbmltYXRvclByb3BzLmEuZmgsMCwwLHRoaXMuZHluYW1pY1Byb3BlcnRpZXMpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmKCdmcycgaW4gYW5pbWF0b3JQcm9wcy5hKSB7XHJcbiAgICAgICAgICAgICAgICBhbmltYXRvckRhdGEuYS5mcyA9IFByb3BlcnR5RmFjdG9yeS5nZXRQcm9wKHRoaXMsYW5pbWF0b3JQcm9wcy5hLmZzLDAsMC4wMSx0aGlzLmR5bmFtaWNQcm9wZXJ0aWVzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZignZmInIGluIGFuaW1hdG9yUHJvcHMuYSkge1xyXG4gICAgICAgICAgICAgICAgYW5pbWF0b3JEYXRhLmEuZmIgPSBQcm9wZXJ0eUZhY3RvcnkuZ2V0UHJvcCh0aGlzLGFuaW1hdG9yUHJvcHMuYS5mYiwwLDAuMDEsdGhpcy5keW5hbWljUHJvcGVydGllcyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYoJ3QnIGluIGFuaW1hdG9yUHJvcHMuYSkge1xyXG4gICAgICAgICAgICAgICAgYW5pbWF0b3JEYXRhLmEudCA9IFByb3BlcnR5RmFjdG9yeS5nZXRQcm9wKHRoaXMsYW5pbWF0b3JQcm9wcy5hLnQsMCwwLHRoaXMuZHluYW1pY1Byb3BlcnRpZXMpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGFuaW1hdG9yRGF0YS5zID0gUHJvcGVydHlGYWN0b3J5LmdldFRleHRTZWxlY3RvclByb3AodGhpcyxhbmltYXRvclByb3BzLnMsdGhpcy5keW5hbWljUHJvcGVydGllcyk7XHJcbiAgICAgICAgICAgIGFuaW1hdG9yRGF0YS5zLnQgPSBhbmltYXRvclByb3BzLnMudDtcclxuICAgICAgICAgICAgdGhpcy52aWV3RGF0YS5hW2ldID0gYW5pbWF0b3JEYXRhO1xyXG4gICAgICAgIH1cclxuICAgIH1lbHNle1xyXG4gICAgICAgIHRoaXMudmlld0RhdGEuYSA9IFtdO1xyXG4gICAgfVxyXG4gICAgaWYodGV4dERhdGEucCAmJiAnbScgaW4gdGV4dERhdGEucCl7XHJcbiAgICAgICAgdGhpcy52aWV3RGF0YS5wID0ge1xyXG4gICAgICAgICAgICBmOiBQcm9wZXJ0eUZhY3RvcnkuZ2V0UHJvcCh0aGlzLHRleHREYXRhLnAuZiwwLDAsdGhpcy5keW5hbWljUHJvcGVydGllcyksXHJcbiAgICAgICAgICAgIGw6IFByb3BlcnR5RmFjdG9yeS5nZXRQcm9wKHRoaXMsdGV4dERhdGEucC5sLDAsMCx0aGlzLmR5bmFtaWNQcm9wZXJ0aWVzKSxcclxuICAgICAgICAgICAgcjogdGV4dERhdGEucC5yLFxyXG4gICAgICAgICAgICBtOiB0aGlzLm1hc2tNYW5hZ2VyLmdldE1hc2tQcm9wZXJ0eSh0ZXh0RGF0YS5wLm0pXHJcbiAgICAgICAgfTtcclxuICAgICAgICB0aGlzLm1hc2tQYXRoID0gdHJ1ZTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdGhpcy5tYXNrUGF0aCA9IGZhbHNlO1xyXG4gICAgfVxyXG59O1xyXG5JVGV4dEVsZW1lbnQucHJvdG90eXBlLnByZXBhcmVGcmFtZSA9IGZ1bmN0aW9uKG51bSkge1xyXG4gICAgdmFyIGkgPSAwLCBsZW4gPSB0aGlzLmRhdGEudC5kLmsubGVuZ3RoO1xyXG4gICAgdmFyIHRleHREb2N1bWVudERhdGEgPSB0aGlzLmRhdGEudC5kLmtbaV0ucztcclxuICAgIGkgKz0gMTtcclxuICAgIHdoaWxlKGk8bGVuKXtcclxuICAgICAgICBpZih0aGlzLmRhdGEudC5kLmtbaV0udCA+IG51bSl7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0ZXh0RG9jdW1lbnREYXRhID0gdGhpcy5kYXRhLnQuZC5rW2ldLnM7XHJcbiAgICAgICAgaSArPSAxO1xyXG4gICAgfVxyXG4gICAgdGhpcy5sZXR0ZXJzQ2hhbmdlZEZsYWcgPSBmYWxzZTtcclxuICAgIGlmKHRleHREb2N1bWVudERhdGEgIT09IHRoaXMuY3VycmVudFRleHREb2N1bWVudERhdGEpe1xyXG4gICAgICAgIHRoaXMuY3VycmVudFRleHREb2N1bWVudERhdGEgPSB0ZXh0RG9jdW1lbnREYXRhO1xyXG4gICAgICAgIHRoaXMubGV0dGVyc0NoYW5nZWRGbGFnID0gdHJ1ZTtcclxuICAgICAgICB0aGlzLmJ1aWxkTmV3VGV4dCgpO1xyXG4gICAgfVxyXG4gICAgdGhpcy5fcGFyZW50LnByZXBhcmVGcmFtZS5jYWxsKHRoaXMsIG51bSk7XHJcbn1cclxuXHJcbklUZXh0RWxlbWVudC5wcm90b3R5cGUuY3JlYXRlUGF0aFNoYXBlID0gZnVuY3Rpb24obWF0cml4SGVscGVyLCBzaGFwZXMpIHtcclxuICAgIHZhciBqLGpMZW4gPSBzaGFwZXMubGVuZ3RoO1xyXG4gICAgdmFyIGssIGtMZW4sIHBhdGhOb2RlcztcclxuICAgIHZhciBzaGFwZVN0ciA9ICcnO1xyXG4gICAgZm9yKGo9MDtqPGpMZW47ais9MSl7XHJcbiAgICAgICAgcGF0aE5vZGVzID0gc2hhcGVzW2pdLmtzLms7XHJcbiAgICAgICAgc2hhcGVTdHIgKz0gdGhpcy5idWlsZFNoYXBlU3RyaW5nKHBhdGhOb2RlcywgcGF0aE5vZGVzLmkubGVuZ3RoLCB0cnVlLCBtYXRyaXhIZWxwZXIpO1xyXG4gICAgICAgIC8qa0xlbiA9IHBhdGhOb2Rlcy5pLmxlbmd0aDtcclxuICAgICAgICBmb3Ioaz0xO2s8a0xlbjtrKz0xKXtcclxuICAgICAgICAgICAgaWYoaz09MSl7XHJcbiAgICAgICAgICAgICAgICBzaGFwZVN0ciArPSBcIiBNXCIrbWF0cml4SGVscGVyLmFwcGx5VG9Qb2ludFN0cmluZ2lmaWVkKHBhdGhOb2Rlcy52WzBdWzBdLHBhdGhOb2Rlcy52WzBdWzFdKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBzaGFwZVN0ciArPSBcIiBDXCIrbWF0cml4SGVscGVyLmFwcGx5VG9Qb2ludFN0cmluZ2lmaWVkKHBhdGhOb2Rlcy5vW2stMV1bMF0scGF0aE5vZGVzLm9bay0xXVsxXSkgKyBcIiBcIittYXRyaXhIZWxwZXIuYXBwbHlUb1BvaW50U3RyaW5naWZpZWQocGF0aE5vZGVzLmlba11bMF0scGF0aE5vZGVzLmlba11bMV0pICsgXCIgXCIrbWF0cml4SGVscGVyLmFwcGx5VG9Qb2ludFN0cmluZ2lmaWVkKHBhdGhOb2Rlcy52W2tdWzBdLHBhdGhOb2Rlcy52W2tdWzFdKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgc2hhcGVTdHIgKz0gXCIgQ1wiK21hdHJpeEhlbHBlci5hcHBseVRvUG9pbnRTdHJpbmdpZmllZChwYXRoTm9kZXMub1trLTFdWzBdLHBhdGhOb2Rlcy5vW2stMV1bMV0pICsgXCIgXCIrbWF0cml4SGVscGVyLmFwcGx5VG9Qb2ludFN0cmluZ2lmaWVkKHBhdGhOb2Rlcy5pWzBdWzBdLHBhdGhOb2Rlcy5pWzBdWzFdKSArIFwiIFwiK21hdHJpeEhlbHBlci5hcHBseVRvUG9pbnRTdHJpbmdpZmllZChwYXRoTm9kZXMudlswXVswXSxwYXRoTm9kZXMudlswXVsxXSk7XHJcbiAgICAgICAgc2hhcGVTdHIgKz0gJ3onOyovXHJcbiAgICB9XHJcbiAgICByZXR1cm4gc2hhcGVTdHI7XHJcbn07XHJcblxyXG5JVGV4dEVsZW1lbnQucHJvdG90eXBlLmdldE1lYXN1cmVzID0gZnVuY3Rpb24oKXtcclxuXHJcbiAgICB2YXIgbWF0cml4SGVscGVyID0gdGhpcy5tSGVscGVyO1xyXG4gICAgdmFyIHJlbmRlclR5cGUgPSB0aGlzLnJlbmRlclR5cGU7XHJcbiAgICB2YXIgZGF0YSA9IHRoaXMuZGF0YTtcclxuICAgIHZhciB4UG9zLHlQb3M7XHJcbiAgICB2YXIgaSwgbGVuO1xyXG4gICAgdmFyIGRvY3VtZW50RGF0YSA9IHRoaXMuY3VycmVudFRleHREb2N1bWVudERhdGE7XHJcbiAgICB2YXIgbGV0dGVycyA9IGRvY3VtZW50RGF0YS5sO1xyXG4gICAgaWYodGhpcy5tYXNrUGF0aCkge1xyXG4gICAgICAgIHZhciBtYXNrID0gdGhpcy52aWV3RGF0YS5wLm07XHJcbiAgICAgICAgaWYoIXRoaXMudmlld0RhdGEucC5uIHx8IHRoaXMudmlld0RhdGEucC5tZGYpe1xyXG4gICAgICAgICAgICB2YXIgcGF0aHMgPSBtYXNrLnY7XHJcbiAgICAgICAgICAgIGlmKHRoaXMudmlld0RhdGEucC5yKXtcclxuICAgICAgICAgICAgICAgIHBhdGhzID0gcmV2ZXJzZVBhdGgocGF0aHMpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZhciBwYXRoSW5mbyA9IHtcclxuICAgICAgICAgICAgICAgIHRMZW5ndGg6IDAsXHJcbiAgICAgICAgICAgICAgICBzZWdtZW50czogW11cclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgbGVuID0gcGF0aHMudi5sZW5ndGggLSAxO1xyXG4gICAgICAgICAgICB2YXIgcGF0aERhdGE7XHJcbiAgICAgICAgICAgIHZhciB0b3RhbExlbmd0aCA9IDA7XHJcbiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBsZW47IGkgKz0gMSkge1xyXG4gICAgICAgICAgICAgICAgcGF0aERhdGEgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgczogcGF0aHMudltpXSxcclxuICAgICAgICAgICAgICAgICAgICBlOiBwYXRocy52W2kgKyAxXSxcclxuICAgICAgICAgICAgICAgICAgICB0bzogW3BhdGhzLm9baV1bMF0gLSBwYXRocy52W2ldWzBdLCBwYXRocy5vW2ldWzFdIC0gcGF0aHMudltpXVsxXV0sXHJcbiAgICAgICAgICAgICAgICAgICAgdGk6IFtwYXRocy5pW2kgKyAxXVswXSAtIHBhdGhzLnZbaSArIDFdWzBdLCBwYXRocy5pW2kgKyAxXVsxXSAtIHBhdGhzLnZbaSArIDFdWzFdXVxyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIGJlei5idWlsZEJlemllckRhdGEocGF0aERhdGEpO1xyXG4gICAgICAgICAgICAgICAgcGF0aEluZm8udExlbmd0aCArPSBwYXRoRGF0YS5iZXppZXJEYXRhLnNlZ21lbnRMZW5ndGg7XHJcbiAgICAgICAgICAgICAgICBwYXRoSW5mby5zZWdtZW50cy5wdXNoKHBhdGhEYXRhKTtcclxuICAgICAgICAgICAgICAgIHRvdGFsTGVuZ3RoICs9IHBhdGhEYXRhLmJlemllckRhdGEuc2VnbWVudExlbmd0aDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpID0gbGVuO1xyXG4gICAgICAgICAgICBpZiAobWFzay52LmMpIHtcclxuICAgICAgICAgICAgICAgIHBhdGhEYXRhID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIHM6IHBhdGhzLnZbaV0sXHJcbiAgICAgICAgICAgICAgICAgICAgZTogcGF0aHMudlswXSxcclxuICAgICAgICAgICAgICAgICAgICB0bzogW3BhdGhzLm9baV1bMF0gLSBwYXRocy52W2ldWzBdLCBwYXRocy5vW2ldWzFdIC0gcGF0aHMudltpXVsxXV0sXHJcbiAgICAgICAgICAgICAgICAgICAgdGk6IFtwYXRocy5pWzBdWzBdIC0gcGF0aHMudlswXVswXSwgcGF0aHMuaVswXVsxXSAtIHBhdGhzLnZbMF1bMV1dXHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgYmV6LmJ1aWxkQmV6aWVyRGF0YShwYXRoRGF0YSk7XHJcbiAgICAgICAgICAgICAgICBwYXRoSW5mby50TGVuZ3RoICs9IHBhdGhEYXRhLmJlemllckRhdGEuc2VnbWVudExlbmd0aDtcclxuICAgICAgICAgICAgICAgIHBhdGhJbmZvLnNlZ21lbnRzLnB1c2gocGF0aERhdGEpO1xyXG4gICAgICAgICAgICAgICAgdG90YWxMZW5ndGggKz0gcGF0aERhdGEuYmV6aWVyRGF0YS5zZWdtZW50TGVuZ3RoO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMudmlld0RhdGEucC5waSA9IHBhdGhJbmZvO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgcGF0aEluZm8gPSB0aGlzLnZpZXdEYXRhLnAucGk7XHJcblxyXG4gICAgICAgIHZhciBjdXJyZW50TGVuZ3RoID0gdGhpcy52aWV3RGF0YS5wLmYudiwgc2VnbWVudEluZCA9IDAsIHBvaW50SW5kID0gMSwgY3VycmVudFBvaW50LCBwcmV2UG9pbnQsIHBvaW50cztcclxuICAgICAgICB2YXIgc2VnbWVudExlbmd0aCA9IDAsIGZsYWcgPSB0cnVlO1xyXG4gICAgICAgIHZhciBzZWdtZW50cyA9IHBhdGhJbmZvLnNlZ21lbnRzO1xyXG4gICAgICAgIGlmIChjdXJyZW50TGVuZ3RoIDwgMCAmJiBtYXNrLnYuYykge1xyXG4gICAgICAgICAgICBpZiAocGF0aEluZm8udExlbmd0aCA8IE1hdGguYWJzKGN1cnJlbnRMZW5ndGgpKSB7XHJcbiAgICAgICAgICAgICAgICBjdXJyZW50TGVuZ3RoID0gLU1hdGguYWJzKGN1cnJlbnRMZW5ndGgpICUgcGF0aEluZm8udExlbmd0aDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBzZWdtZW50SW5kID0gc2VnbWVudHMubGVuZ3RoIC0gMTtcclxuICAgICAgICAgICAgcG9pbnRzID0gc2VnbWVudHNbc2VnbWVudEluZF0uYmV6aWVyRGF0YS5wb2ludHM7XHJcbiAgICAgICAgICAgIHBvaW50SW5kID0gcG9pbnRzLmxlbmd0aCAtIDE7XHJcbiAgICAgICAgICAgIHdoaWxlIChjdXJyZW50TGVuZ3RoIDwgMCkge1xyXG4gICAgICAgICAgICAgICAgY3VycmVudExlbmd0aCArPSBwb2ludHNbcG9pbnRJbmRdLnBhcnRpYWxMZW5ndGg7XHJcbiAgICAgICAgICAgICAgICBwb2ludEluZCAtPSAxO1xyXG4gICAgICAgICAgICAgICAgaWYgKHBvaW50SW5kIDwgMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHNlZ21lbnRJbmQgLT0gMTtcclxuICAgICAgICAgICAgICAgICAgICBwb2ludHMgPSBzZWdtZW50c1tzZWdtZW50SW5kXS5iZXppZXJEYXRhLnBvaW50cztcclxuICAgICAgICAgICAgICAgICAgICBwb2ludEluZCA9IHBvaW50cy5sZW5ndGggLSAxO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgIH1cclxuICAgICAgICBwb2ludHMgPSBzZWdtZW50c1tzZWdtZW50SW5kXS5iZXppZXJEYXRhLnBvaW50cztcclxuICAgICAgICBwcmV2UG9pbnQgPSBwb2ludHNbcG9pbnRJbmQgLSAxXTtcclxuICAgICAgICBjdXJyZW50UG9pbnQgPSBwb2ludHNbcG9pbnRJbmRdO1xyXG4gICAgICAgIHZhciBwYXJ0aWFsTGVuZ3RoID0gY3VycmVudFBvaW50LnBhcnRpYWxMZW5ndGg7XHJcbiAgICAgICAgdmFyIHBlcmMsIHRhbkFuZ2xlO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICBsZW4gPSBsZXR0ZXJzLmxlbmd0aDtcclxuICAgIHhQb3MgPSAwO1xyXG4gICAgeVBvcyA9IDA7XHJcbiAgICB2YXIgeU9mZiA9IGRvY3VtZW50RGF0YS5zKjEuMiouNzE0O1xyXG4gICAgdmFyIGZpcnN0TGluZSA9IHRydWU7XHJcbiAgICB2YXIgcmVuZGVyZWREYXRhID0gdGhpcy52aWV3RGF0YSwgYW5pbWF0b3JQcm9wcywgYW5pbWF0b3JTZWxlY3RvcjtcclxuICAgIHZhciBqLCBqTGVuO1xyXG4gICAgdmFyIGxldHRlcnNWYWx1ZSA9IEFycmF5LmFwcGx5KG51bGwse2xlbmd0aDpsZW59KSwgbGV0dGVyVmFsdWU7XHJcblxyXG4gICAgakxlbiA9IHJlbmRlcmVkRGF0YS5hLmxlbmd0aDtcclxuICAgIHZhciBsYXN0TGV0dGVyO1xyXG5cclxuICAgIHZhciBtdWx0LCBpbmQgPSAtMSwgb2ZmZiwgeFBhdGhQb3MsIHlQYXRoUG9zO1xyXG4gICAgdmFyIGluaXRQYXRoUG9zID0gY3VycmVudExlbmd0aCxpbml0U2VnbWVudEluZCA9IHNlZ21lbnRJbmQsIGluaXRQb2ludEluZCA9IHBvaW50SW5kLCBjdXJyZW50TGluZSA9IC0xO1xyXG4gICAgdmFyIGVsZW1PcGFjaXR5O1xyXG4gICAgdmFyIHNjLHN3LGZjLGs7XHJcbiAgICB2YXIgbGluZUxlbmd0aCA9IDA7XHJcbiAgICB2YXIgbGV0dGVyU3csbGV0dGVyU2MsbGV0dGVyRmMsbGV0dGVyTSxsZXR0ZXJQLGxldHRlck87XHJcbiAgICBmb3IoIGkgPSAwOyBpIDwgbGVuOyBpICs9IDEpIHtcclxuICAgICAgICBtYXRyaXhIZWxwZXIucmVzZXQoKTtcclxuICAgICAgICBlbGVtT3BhY2l0eSA9IDE7XHJcbiAgICAgICAgaWYobGV0dGVyc1tpXS5uKSB7XHJcbiAgICAgICAgICAgIHhQb3MgPSAwO1xyXG4gICAgICAgICAgICB5UG9zICs9IGRvY3VtZW50RGF0YS55T2Zmc2V0O1xyXG4gICAgICAgICAgICB5UG9zICs9IGZpcnN0TGluZSA/IDEgOiAwO1xyXG4gICAgICAgICAgICBjdXJyZW50TGVuZ3RoID0gaW5pdFBhdGhQb3MgO1xyXG4gICAgICAgICAgICBmaXJzdExpbmUgPSBmYWxzZTtcclxuICAgICAgICAgICAgbGluZUxlbmd0aCA9IDA7XHJcbiAgICAgICAgICAgIGlmKHRoaXMubWFza1BhdGgpIHtcclxuICAgICAgICAgICAgICAgIHNlZ21lbnRJbmQgPSBpbml0U2VnbWVudEluZDtcclxuICAgICAgICAgICAgICAgIHBvaW50SW5kID0gaW5pdFBvaW50SW5kO1xyXG4gICAgICAgICAgICAgICAgcG9pbnRzID0gc2VnbWVudHNbc2VnbWVudEluZF0uYmV6aWVyRGF0YS5wb2ludHM7XHJcbiAgICAgICAgICAgICAgICBwcmV2UG9pbnQgPSBwb2ludHNbcG9pbnRJbmQgLSAxXTtcclxuICAgICAgICAgICAgICAgIGN1cnJlbnRQb2ludCA9IHBvaW50c1twb2ludEluZF07XHJcbiAgICAgICAgICAgICAgICBwYXJ0aWFsTGVuZ3RoID0gY3VycmVudFBvaW50LnBhcnRpYWxMZW5ndGg7XHJcbiAgICAgICAgICAgICAgICBzZWdtZW50TGVuZ3RoID0gMDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBsZXR0ZXJzVmFsdWVbaV0gPSB0aGlzLmVtcHR5UHJvcDtcclxuICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgaWYodGhpcy5tYXNrUGF0aCkge1xyXG4gICAgICAgICAgICAgICAgaWYoY3VycmVudExpbmUgIT09IGxldHRlcnNbaV0ubGluZSl7XHJcbiAgICAgICAgICAgICAgICAgICAgc3dpdGNoKGRvY3VtZW50RGF0YS5qKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAxOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudExlbmd0aCArPSB0b3RhbExlbmd0aCAtIGRvY3VtZW50RGF0YS5saW5lV2lkdGhzW2xldHRlcnNbaV0ubGluZV07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAyOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudExlbmd0aCArPSAodG90YWxMZW5ndGggLSBkb2N1bWVudERhdGEubGluZVdpZHRoc1tsZXR0ZXJzW2ldLmxpbmVdKS8yO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGN1cnJlbnRMaW5lID0gbGV0dGVyc1tpXS5saW5lO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKGluZCAhPT0gbGV0dGVyc1tpXS5pbmQpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAobGV0dGVyc1tpbmRdKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRMZW5ndGggKz0gbGV0dGVyc1tpbmRdLmV4dHJhO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBjdXJyZW50TGVuZ3RoICs9IGxldHRlcnNbaV0uYW4gLyAyO1xyXG4gICAgICAgICAgICAgICAgICAgIGluZCA9IGxldHRlcnNbaV0uaW5kO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgY3VycmVudExlbmd0aCArPSByZW5kZXJlZERhdGEubS5hLnZbMF0gKiBsZXR0ZXJzW2ldLmFuIC8gMjAwO1xyXG4gICAgICAgICAgICAgICAgdmFyIGFuaW1hdG9yT2Zmc2V0ID0gMDtcclxuICAgICAgICAgICAgICAgIGZvciAoaiA9IDA7IGogPCBqTGVuOyBqICs9IDEpIHtcclxuICAgICAgICAgICAgICAgICAgICBhbmltYXRvclByb3BzID0gcmVuZGVyZWREYXRhLmFbal0uYTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoJ3AnIGluIGFuaW1hdG9yUHJvcHMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYW5pbWF0b3JTZWxlY3RvciA9IHJlbmRlcmVkRGF0YS5hW2pdLnM7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG11bHQgPSBhbmltYXRvclNlbGVjdG9yLmdldE11bHQobGV0dGVyc1tpXS5hbkluZGV4ZXNbal0sZGF0YS50LmFbal0ucy50b3RhbENoYXJzKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYobXVsdC5sZW5ndGgpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYW5pbWF0b3JPZmZzZXQgKz0gYW5pbWF0b3JQcm9wcy5wLnZbMF0gKiBtdWx0WzBdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2V7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbmltYXRvck9mZnNldCArPSBhbmltYXRvclByb3BzLnAudlswXSAqIG11bHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmICgnYScgaW4gYW5pbWF0b3JQcm9wcykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhbmltYXRvclNlbGVjdG9yID0gcmVuZGVyZWREYXRhLmFbal0ucztcclxuICAgICAgICAgICAgICAgICAgICAgICAgbXVsdCA9IGFuaW1hdG9yU2VsZWN0b3IuZ2V0TXVsdChsZXR0ZXJzW2ldLmFuSW5kZXhlc1tqXSxkYXRhLnQuYVtqXS5zLnRvdGFsQ2hhcnMpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZihtdWx0Lmxlbmd0aCl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbmltYXRvck9mZnNldCArPSBhbmltYXRvclByb3BzLmEudlswXSAqIG11bHRbMF07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFuaW1hdG9yT2Zmc2V0ICs9IGFuaW1hdG9yUHJvcHMuYS52WzBdICogbXVsdDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBmbGFnID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIHdoaWxlIChmbGFnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNlZ21lbnRMZW5ndGggKyBwYXJ0aWFsTGVuZ3RoID49IGN1cnJlbnRMZW5ndGggKyBhbmltYXRvck9mZnNldCB8fCAhcG9pbnRzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBlcmMgPSAoY3VycmVudExlbmd0aCArIGFuaW1hdG9yT2Zmc2V0IC0gc2VnbWVudExlbmd0aCkgLyBjdXJyZW50UG9pbnQucGFydGlhbExlbmd0aDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgeFBhdGhQb3MgPSBwcmV2UG9pbnQucG9pbnRbMF0gKyAoY3VycmVudFBvaW50LnBvaW50WzBdIC0gcHJldlBvaW50LnBvaW50WzBdKSAqIHBlcmM7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHlQYXRoUG9zID0gcHJldlBvaW50LnBvaW50WzFdICsgKGN1cnJlbnRQb2ludC5wb2ludFsxXSAtIHByZXZQb2ludC5wb2ludFsxXSkgKiBwZXJjO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBtYXRyaXhIZWxwZXIudHJhbnNsYXRlKC1yZW5kZXJlZERhdGEubS5hLnZbMF0qbGV0dGVyc1tpXS5hbi8yMDAsIC0ocmVuZGVyZWREYXRhLm0uYS52WzFdICogeU9mZiAvIDEwMCkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmbGFnID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChwb2ludHMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2VnbWVudExlbmd0aCArPSBjdXJyZW50UG9pbnQucGFydGlhbExlbmd0aDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnRJbmQgKz0gMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBvaW50SW5kID49IHBvaW50cy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50SW5kID0gMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlZ21lbnRJbmQgKz0gMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghc2VnbWVudHNbc2VnbWVudEluZF0pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobWFzay52LmMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnRJbmQgPSAwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWdtZW50SW5kID0gMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnRzID0gc2VnbWVudHNbc2VnbWVudEluZF0uYmV6aWVyRGF0YS5wb2ludHM7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VnbWVudExlbmd0aCAtPSBjdXJyZW50UG9pbnQucGFydGlhbExlbmd0aDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnRzID0gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50cyA9IHNlZ21lbnRzW3NlZ21lbnRJbmRdLmJlemllckRhdGEucG9pbnRzO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwb2ludHMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByZXZQb2ludCA9IGN1cnJlbnRQb2ludDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRQb2ludCA9IHBvaW50c1twb2ludEluZF07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJ0aWFsTGVuZ3RoID0gY3VycmVudFBvaW50LnBhcnRpYWxMZW5ndGg7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBvZmZmID0gbGV0dGVyc1tpXS5hbiAvIDIgLSBsZXR0ZXJzW2ldLmFkZDtcclxuICAgICAgICAgICAgICAgIG1hdHJpeEhlbHBlci50cmFuc2xhdGUoLW9mZmYsIDAsIDApO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgb2ZmZiA9IGxldHRlcnNbaV0uYW4vMiAtIGxldHRlcnNbaV0uYWRkO1xyXG4gICAgICAgICAgICAgICAgbWF0cml4SGVscGVyLnRyYW5zbGF0ZSgtb2ZmZiwwLDApO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIEdyb3VwaW5nIGFsaWdubWVudFxyXG4gICAgICAgICAgICAgICAgbWF0cml4SGVscGVyLnRyYW5zbGF0ZSgtcmVuZGVyZWREYXRhLm0uYS52WzBdKmxldHRlcnNbaV0uYW4vMjAwLCAtcmVuZGVyZWREYXRhLm0uYS52WzFdKnlPZmYvMTAwLCAwKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgbGluZUxlbmd0aCArPSBsZXR0ZXJzW2ldLmwvMjtcclxuICAgICAgICAgICAgZm9yKGo9MDtqPGpMZW47ais9MSl7XHJcbiAgICAgICAgICAgICAgICBhbmltYXRvclByb3BzID0gcmVuZGVyZWREYXRhLmFbal0uYTtcclxuICAgICAgICAgICAgICAgIGlmICgndCcgaW4gYW5pbWF0b3JQcm9wcykge1xyXG4gICAgICAgICAgICAgICAgICAgIGFuaW1hdG9yU2VsZWN0b3IgPSByZW5kZXJlZERhdGEuYVtqXS5zO1xyXG4gICAgICAgICAgICAgICAgICAgIG11bHQgPSBhbmltYXRvclNlbGVjdG9yLmdldE11bHQobGV0dGVyc1tpXS5hbkluZGV4ZXNbal0sZGF0YS50LmFbal0ucy50b3RhbENoYXJzKTtcclxuICAgICAgICAgICAgICAgICAgICBpZih0aGlzLm1hc2tQYXRoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKG11bHQubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50TGVuZ3RoICs9IGFuaW1hdG9yUHJvcHMudCptdWx0WzBdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudExlbmd0aCArPSBhbmltYXRvclByb3BzLnQqbXVsdDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZihtdWx0Lmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgeFBvcyArPSBhbmltYXRvclByb3BzLnQudiptdWx0WzBdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgeFBvcyArPSBhbmltYXRvclByb3BzLnQudiptdWx0O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGxpbmVMZW5ndGggKz0gbGV0dGVyc1tpXS5sLzI7XHJcbiAgICAgICAgICAgIGlmKGRvY3VtZW50RGF0YS5zdHJva2VXaWR0aEFuaW0pIHtcclxuICAgICAgICAgICAgICAgIHN3ID0gZG9jdW1lbnREYXRhLnN3IHx8IDA7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYoZG9jdW1lbnREYXRhLnN0cm9rZUNvbG9yQW5pbSkge1xyXG4gICAgICAgICAgICAgICAgaWYoZG9jdW1lbnREYXRhLnNjKXtcclxuICAgICAgICAgICAgICAgICAgICBzYyA9IFtkb2N1bWVudERhdGEuc2NbMF0sIGRvY3VtZW50RGF0YS5zY1sxXSwgZG9jdW1lbnREYXRhLnNjWzJdXTtcclxuICAgICAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgICAgIHNjID0gWzAsMCwwXTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZihkb2N1bWVudERhdGEuZmlsbENvbG9yQW5pbSkge1xyXG4gICAgICAgICAgICAgICAgZmMgPSBbZG9jdW1lbnREYXRhLmZjWzBdLCBkb2N1bWVudERhdGEuZmNbMV0sIGRvY3VtZW50RGF0YS5mY1syXV07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZm9yKGo9MDtqPGpMZW47ais9MSl7XHJcbiAgICAgICAgICAgICAgICBhbmltYXRvclByb3BzID0gcmVuZGVyZWREYXRhLmFbal0uYTtcclxuICAgICAgICAgICAgICAgIGlmICgnYScgaW4gYW5pbWF0b3JQcm9wcykge1xyXG4gICAgICAgICAgICAgICAgICAgIGFuaW1hdG9yU2VsZWN0b3IgPSByZW5kZXJlZERhdGEuYVtqXS5zO1xyXG4gICAgICAgICAgICAgICAgICAgIG11bHQgPSBhbmltYXRvclNlbGVjdG9yLmdldE11bHQobGV0dGVyc1tpXS5hbkluZGV4ZXNbal0sZGF0YS50LmFbal0ucy50b3RhbENoYXJzKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYobXVsdC5sZW5ndGgpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBtYXRyaXhIZWxwZXIudHJhbnNsYXRlKC1hbmltYXRvclByb3BzLmEudlswXSptdWx0WzBdLCAtYW5pbWF0b3JQcm9wcy5hLnZbMV0qbXVsdFsxXSwgYW5pbWF0b3JQcm9wcy5hLnZbMl0qbXVsdFsyXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWF0cml4SGVscGVyLnRyYW5zbGF0ZSgtYW5pbWF0b3JQcm9wcy5hLnZbMF0qbXVsdCwgLWFuaW1hdG9yUHJvcHMuYS52WzFdKm11bHQsIGFuaW1hdG9yUHJvcHMuYS52WzJdKm11bHQpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBmb3Ioaj0wO2o8akxlbjtqKz0xKXtcclxuICAgICAgICAgICAgICAgIGFuaW1hdG9yUHJvcHMgPSByZW5kZXJlZERhdGEuYVtqXS5hO1xyXG4gICAgICAgICAgICAgICAgaWYgKCdzJyBpbiBhbmltYXRvclByb3BzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYW5pbWF0b3JTZWxlY3RvciA9IHJlbmRlcmVkRGF0YS5hW2pdLnM7XHJcbiAgICAgICAgICAgICAgICAgICAgbXVsdCA9IGFuaW1hdG9yU2VsZWN0b3IuZ2V0TXVsdChsZXR0ZXJzW2ldLmFuSW5kZXhlc1tqXSxkYXRhLnQuYVtqXS5zLnRvdGFsQ2hhcnMpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmKG11bHQubGVuZ3RoKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWF0cml4SGVscGVyLnNjYWxlKDErKChhbmltYXRvclByb3BzLnMudlswXS0xKSptdWx0WzBdKSwxKygoYW5pbWF0b3JQcm9wcy5zLnZbMV0tMSkqbXVsdFsxXSksMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWF0cml4SGVscGVyLnNjYWxlKDErKChhbmltYXRvclByb3BzLnMudlswXS0xKSptdWx0KSwxKygoYW5pbWF0b3JQcm9wcy5zLnZbMV0tMSkqbXVsdCksMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGZvcihqPTA7ajxqTGVuO2orPTEpIHtcclxuICAgICAgICAgICAgICAgIGFuaW1hdG9yUHJvcHMgPSByZW5kZXJlZERhdGEuYVtqXS5hO1xyXG4gICAgICAgICAgICAgICAgYW5pbWF0b3JTZWxlY3RvciA9IHJlbmRlcmVkRGF0YS5hW2pdLnM7XHJcbiAgICAgICAgICAgICAgICBtdWx0ID0gYW5pbWF0b3JTZWxlY3Rvci5nZXRNdWx0KGxldHRlcnNbaV0uYW5JbmRleGVzW2pdLGRhdGEudC5hW2pdLnMudG90YWxDaGFycyk7XHJcbiAgICAgICAgICAgICAgICBpZiAoJ3NrJyBpbiBhbmltYXRvclByb3BzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYobXVsdC5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWF0cml4SGVscGVyLnNrZXdGcm9tQXhpcygtYW5pbWF0b3JQcm9wcy5zay52ICogbXVsdFswXSwgYW5pbWF0b3JQcm9wcy5zYS52ICogbXVsdFsxXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWF0cml4SGVscGVyLnNrZXdGcm9tQXhpcygtYW5pbWF0b3JQcm9wcy5zay52ICogbXVsdCwgYW5pbWF0b3JQcm9wcy5zYS52ICogbXVsdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKCdyJyBpbiBhbmltYXRvclByb3BzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYobXVsdC5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWF0cml4SGVscGVyLnJvdGF0ZVooLWFuaW1hdG9yUHJvcHMuci52ICogbXVsdFsyXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWF0cml4SGVscGVyLnJvdGF0ZVooLWFuaW1hdG9yUHJvcHMuci52ICogbXVsdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKCdyeScgaW4gYW5pbWF0b3JQcm9wcykge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZihtdWx0Lmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBtYXRyaXhIZWxwZXIucm90YXRlWShhbmltYXRvclByb3BzLnJ5LnYqbXVsdFsxXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1hdHJpeEhlbHBlci5yb3RhdGVZKGFuaW1hdG9yUHJvcHMucnkudiptdWx0KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoJ3J4JyBpbiBhbmltYXRvclByb3BzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYobXVsdC5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWF0cml4SGVscGVyLnJvdGF0ZVgoYW5pbWF0b3JQcm9wcy5yeC52Km11bHRbMF0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1hdHJpeEhlbHBlci5yb3RhdGVYKGFuaW1hdG9yUHJvcHMucngudiptdWx0KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoJ28nIGluIGFuaW1hdG9yUHJvcHMpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZihtdWx0Lmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbGVtT3BhY2l0eSArPSAoKGFuaW1hdG9yUHJvcHMuby52KSptdWx0WzBdIC0gZWxlbU9wYWNpdHkpKm11bHRbMF07XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZWxlbU9wYWNpdHkgKz0gKChhbmltYXRvclByb3BzLm8udikqbXVsdCAtIGVsZW1PcGFjaXR5KSptdWx0O1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChkb2N1bWVudERhdGEuc3Ryb2tlV2lkdGhBbmltICYmICdzdycgaW4gYW5pbWF0b3JQcm9wcykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmKG11bHQubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN3ICs9IGFuaW1hdG9yUHJvcHMuc3cudiptdWx0WzBdO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN3ICs9IGFuaW1hdG9yUHJvcHMuc3cudiptdWx0O1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChkb2N1bWVudERhdGEuc3Ryb2tlQ29sb3JBbmltICYmICdzYycgaW4gYW5pbWF0b3JQcm9wcykge1xyXG4gICAgICAgICAgICAgICAgICAgIGZvcihrPTA7azwzO2srPTEpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZihtdWx0Lmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2Nba10gPSBNYXRoLnJvdW5kKDI1NSooc2Nba10gKyAoYW5pbWF0b3JQcm9wcy5zYy52W2tdIC0gc2Nba10pKm11bHRbMF0pKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjW2tdID0gTWF0aC5yb3VuZCgyNTUqKHNjW2tdICsgKGFuaW1hdG9yUHJvcHMuc2MudltrXSAtIHNjW2tdKSptdWx0KSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoZG9jdW1lbnREYXRhLmZpbGxDb2xvckFuaW0pIHtcclxuICAgICAgICAgICAgICAgICAgICBpZignZmMnIGluIGFuaW1hdG9yUHJvcHMpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3Ioaz0wO2s8MztrKz0xKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKG11bHQubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmNba10gPSBmY1trXSArIChhbmltYXRvclByb3BzLmZjLnZba10gLSBmY1trXSkqbXVsdFswXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmNba10gPSBmY1trXSArIChhbmltYXRvclByb3BzLmZjLnZba10gLSBmY1trXSkqbXVsdDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKCdtdWx0JyxtdWx0KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKE1hdGgucm91bmQoZmNba10gKyAoYW5pbWF0b3JQcm9wcy5mYy52W2tdIC0gZmNba10pKm11bHQpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZignZmgnIGluIGFuaW1hdG9yUHJvcHMpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZihtdWx0Lmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmMgPSBhZGRIdWVUb1JHQihmYyxhbmltYXRvclByb3BzLmZoLnYqbXVsdFswXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmYyA9IGFkZEh1ZVRvUkdCKGZjLGFuaW1hdG9yUHJvcHMuZmgudiptdWx0KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZignZnMnIGluIGFuaW1hdG9yUHJvcHMpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZihtdWx0Lmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmMgPSBhZGRTYXR1cmF0aW9uVG9SR0IoZmMsYW5pbWF0b3JQcm9wcy5mcy52Km11bHRbMF0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmMgPSBhZGRTYXR1cmF0aW9uVG9SR0IoZmMsYW5pbWF0b3JQcm9wcy5mcy52Km11bHQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmKCdmYicgaW4gYW5pbWF0b3JQcm9wcyl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKG11bHQubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmYyA9IGFkZEJyaWdodG5lc3NUb1JHQihmYyxhbmltYXRvclByb3BzLmZiLnYqbXVsdFswXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmYyA9IGFkZEJyaWdodG5lc3NUb1JHQihmYyxhbmltYXRvclByb3BzLmZiLnYqbXVsdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGZvcihqPTA7ajxqTGVuO2orPTEpe1xyXG4gICAgICAgICAgICAgICAgYW5pbWF0b3JQcm9wcyA9IHJlbmRlcmVkRGF0YS5hW2pdLmE7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKCdwJyBpbiBhbmltYXRvclByb3BzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYW5pbWF0b3JTZWxlY3RvciA9IHJlbmRlcmVkRGF0YS5hW2pdLnM7XHJcbiAgICAgICAgICAgICAgICAgICAgbXVsdCA9IGFuaW1hdG9yU2VsZWN0b3IuZ2V0TXVsdChsZXR0ZXJzW2ldLmFuSW5kZXhlc1tqXSxkYXRhLnQuYVtqXS5zLnRvdGFsQ2hhcnMpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmKHRoaXMubWFza1BhdGgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYobXVsdC5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hdHJpeEhlbHBlci50cmFuc2xhdGUoMCwgYW5pbWF0b3JQcm9wcy5wLnZbMV0gKiBtdWx0WzBdLCAtYW5pbWF0b3JQcm9wcy5wLnZbMl0gKiBtdWx0WzFdKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hdHJpeEhlbHBlci50cmFuc2xhdGUoMCwgYW5pbWF0b3JQcm9wcy5wLnZbMV0gKiBtdWx0LCAtYW5pbWF0b3JQcm9wcy5wLnZbMl0gKiBtdWx0KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZihtdWx0Lmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWF0cml4SGVscGVyLnRyYW5zbGF0ZShhbmltYXRvclByb3BzLnAudlswXSAqIG11bHRbMF0sIGFuaW1hdG9yUHJvcHMucC52WzFdICogbXVsdFsxXSwgLWFuaW1hdG9yUHJvcHMucC52WzJdICogbXVsdFsyXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXRyaXhIZWxwZXIudHJhbnNsYXRlKGFuaW1hdG9yUHJvcHMucC52WzBdICogbXVsdCwgYW5pbWF0b3JQcm9wcy5wLnZbMV0gKiBtdWx0LCAtYW5pbWF0b3JQcm9wcy5wLnZbMl0gKiBtdWx0KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZihkb2N1bWVudERhdGEuc3Ryb2tlV2lkdGhBbmltKXtcclxuICAgICAgICAgICAgICAgIGxldHRlclN3ID0gc3cgPCAwID8gMCA6IHN3O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmKGRvY3VtZW50RGF0YS5zdHJva2VDb2xvckFuaW0pe1xyXG4gICAgICAgICAgICAgICAgbGV0dGVyU2MgPSAncmdiKCcrTWF0aC5yb3VuZChzY1swXSoyNTUpKycsJytNYXRoLnJvdW5kKHNjWzFdKjI1NSkrJywnK01hdGgucm91bmQoc2NbMl0qMjU1KSsnKSc7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYoZG9jdW1lbnREYXRhLmZpbGxDb2xvckFuaW0pe1xyXG4gICAgICAgICAgICAgICAgbGV0dGVyRmMgPSAncmdiKCcrTWF0aC5yb3VuZChmY1swXSoyNTUpKycsJytNYXRoLnJvdW5kKGZjWzFdKjI1NSkrJywnK01hdGgucm91bmQoZmNbMl0qMjU1KSsnKSc7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmKHRoaXMubWFza1BhdGgpIHtcclxuICAgICAgICAgICAgICAgIG1hdHJpeEhlbHBlci50cmFuc2xhdGUoMCwtZG9jdW1lbnREYXRhLmxzKTtcclxuXHJcbiAgICAgICAgICAgICAgICBtYXRyaXhIZWxwZXIudHJhbnNsYXRlKDAsIHJlbmRlcmVkRGF0YS5tLmEudlsxXSp5T2ZmLzEwMCArIHlQb3MsMCk7XHJcbiAgICAgICAgICAgICAgICBpZiAoZGF0YS50LnAucCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRhbkFuZ2xlID0gKGN1cnJlbnRQb2ludC5wb2ludFsxXSAtIHByZXZQb2ludC5wb2ludFsxXSkgLyAoY3VycmVudFBvaW50LnBvaW50WzBdIC0gcHJldlBvaW50LnBvaW50WzBdKTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgcm90ID0gTWF0aC5hdGFuKHRhbkFuZ2xlKSAqIDE4MCAvIE1hdGguUEk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRQb2ludC5wb2ludFswXSA8IHByZXZQb2ludC5wb2ludFswXSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByb3QgKz0gMTgwO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBtYXRyaXhIZWxwZXIucm90YXRlKC1yb3QgKiBNYXRoLlBJIC8gMTgwKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIG1hdHJpeEhlbHBlci50cmFuc2xhdGUoeFBhdGhQb3MsIHlQYXRoUG9zLCAwKTtcclxuICAgICAgICAgICAgICAgIGN1cnJlbnRMZW5ndGggLT0gcmVuZGVyZWREYXRhLm0uYS52WzBdKmxldHRlcnNbaV0uYW4vMjAwO1xyXG4gICAgICAgICAgICAgICAgaWYobGV0dGVyc1tpKzFdICYmIGluZCAhPT0gbGV0dGVyc1tpKzFdLmluZCl7XHJcbiAgICAgICAgICAgICAgICAgICAgY3VycmVudExlbmd0aCArPSBsZXR0ZXJzW2ldLmFuIC8gMjtcclxuICAgICAgICAgICAgICAgICAgICBjdXJyZW50TGVuZ3RoICs9IGRvY3VtZW50RGF0YS50ci8xMDAwKmRvY3VtZW50RGF0YS5zO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9ZWxzZXtcclxuXHJcbiAgICAgICAgICAgICAgICBtYXRyaXhIZWxwZXIudHJhbnNsYXRlKHhQb3MseVBvcywwKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZihkb2N1bWVudERhdGEucHMpe1xyXG4gICAgICAgICAgICAgICAgICAgIC8vbWF0cml4SGVscGVyLnRyYW5zbGF0ZShkb2N1bWVudERhdGEucHNbMF0sZG9jdW1lbnREYXRhLnBzWzFdLDApO1xyXG4gICAgICAgICAgICAgICAgICAgIG1hdHJpeEhlbHBlci50cmFuc2xhdGUoZG9jdW1lbnREYXRhLnBzWzBdLGRvY3VtZW50RGF0YS5wc1sxXSArIGRvY3VtZW50RGF0YS5hc2NlbnQsMCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBzd2l0Y2goZG9jdW1lbnREYXRhLmope1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMTpcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWF0cml4SGVscGVyLnRyYW5zbGF0ZShkb2N1bWVudERhdGEuanVzdGlmeU9mZnNldCArIChkb2N1bWVudERhdGEuYm94V2lkdGggLSBkb2N1bWVudERhdGEubGluZVdpZHRoc1tsZXR0ZXJzW2ldLmxpbmVdKSwwLDApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIDI6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1hdHJpeEhlbHBlci50cmFuc2xhdGUoZG9jdW1lbnREYXRhLmp1c3RpZnlPZmZzZXQgKyAoZG9jdW1lbnREYXRhLmJveFdpZHRoIC0gZG9jdW1lbnREYXRhLmxpbmVXaWR0aHNbbGV0dGVyc1tpXS5saW5lXSkvMiwwLDApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIG1hdHJpeEhlbHBlci50cmFuc2xhdGUoMCwtZG9jdW1lbnREYXRhLmxzKTtcclxuICAgICAgICAgICAgICAgIG1hdHJpeEhlbHBlci50cmFuc2xhdGUob2ZmZiwwLDApO1xyXG4gICAgICAgICAgICAgICAgbWF0cml4SGVscGVyLnRyYW5zbGF0ZShyZW5kZXJlZERhdGEubS5hLnZbMF0qbGV0dGVyc1tpXS5hbi8yMDAscmVuZGVyZWREYXRhLm0uYS52WzFdKnlPZmYvMTAwLDApO1xyXG4gICAgICAgICAgICAgICAgeFBvcyArPSBsZXR0ZXJzW2ldLmwgKyBkb2N1bWVudERhdGEudHIvMTAwMCpkb2N1bWVudERhdGEucztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZihyZW5kZXJUeXBlID09PSAnaHRtbCcpe1xyXG4gICAgICAgICAgICAgICAgbGV0dGVyTSA9IG1hdHJpeEhlbHBlci50b0NTUygpO1xyXG4gICAgICAgICAgICB9ZWxzZSBpZihyZW5kZXJUeXBlID09PSAnc3ZnJyl7XHJcbiAgICAgICAgICAgICAgICBsZXR0ZXJNID0gbWF0cml4SGVscGVyLnRvMmRDU1MoKTtcclxuICAgICAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgICAgICBsZXR0ZXJQID0gW21hdHJpeEhlbHBlci5wcm9wc1swXSxtYXRyaXhIZWxwZXIucHJvcHNbMV0sbWF0cml4SGVscGVyLnByb3BzWzJdLG1hdHJpeEhlbHBlci5wcm9wc1szXSxtYXRyaXhIZWxwZXIucHJvcHNbNF0sbWF0cml4SGVscGVyLnByb3BzWzVdLG1hdHJpeEhlbHBlci5wcm9wc1s2XSxtYXRyaXhIZWxwZXIucHJvcHNbN10sbWF0cml4SGVscGVyLnByb3BzWzhdLG1hdHJpeEhlbHBlci5wcm9wc1s5XSxtYXRyaXhIZWxwZXIucHJvcHNbMTBdLG1hdHJpeEhlbHBlci5wcm9wc1sxMV0sbWF0cml4SGVscGVyLnByb3BzWzEyXSxtYXRyaXhIZWxwZXIucHJvcHNbMTNdLG1hdHJpeEhlbHBlci5wcm9wc1sxNF0sbWF0cml4SGVscGVyLnByb3BzWzE1XV07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgbGV0dGVyTyA9IGVsZW1PcGFjaXR5O1xyXG5cclxuICAgICAgICAgICAgbGFzdExldHRlciA9IHRoaXMucmVuZGVyZWRMZXR0ZXJzW2ldO1xyXG4gICAgICAgICAgICBpZihsYXN0TGV0dGVyICYmIChsYXN0TGV0dGVyLm8gIT09IGxldHRlck8gfHwgbGFzdExldHRlci5zdyAhPT0gbGV0dGVyU3cgfHwgbGFzdExldHRlci5zYyAhPT0gbGV0dGVyU2MgfHwgbGFzdExldHRlci5mYyAhPT0gbGV0dGVyRmMpKXtcclxuICAgICAgICAgICAgICAgIHRoaXMubGV0dGVyc0NoYW5nZWRGbGFnID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIGxldHRlclZhbHVlID0gbmV3IExldHRlclByb3BzKGxldHRlck8sbGV0dGVyU3csbGV0dGVyU2MsbGV0dGVyRmMsbGV0dGVyTSxsZXR0ZXJQKTtcclxuICAgICAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgICAgICBpZigocmVuZGVyVHlwZSA9PT0gJ3N2ZycgfHwgcmVuZGVyVHlwZSA9PT0gJ2h0bWwnKSAmJiAoIWxhc3RMZXR0ZXIgfHwgbGFzdExldHRlci5tICE9PSBsZXR0ZXJNKSl7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sZXR0ZXJzQ2hhbmdlZEZsYWcgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIGxldHRlclZhbHVlID0gbmV3IExldHRlclByb3BzKGxldHRlck8sbGV0dGVyU3csbGV0dGVyU2MsbGV0dGVyRmMsbGV0dGVyTSk7XHJcbiAgICAgICAgICAgICAgICB9ZWxzZSBpZihyZW5kZXJUeXBlID09PSAnY2FudmFzJyAmJiAoIWxhc3RMZXR0ZXIgfHwgKGxhc3RMZXR0ZXIucHJvcHNbMF0gIT09IGxldHRlclBbMF0gfHwgbGFzdExldHRlci5wcm9wc1sxXSAhPT0gbGV0dGVyUFsxXSB8fCBsYXN0TGV0dGVyLnByb3BzWzRdICE9PSBsZXR0ZXJQWzRdIHx8IGxhc3RMZXR0ZXIucHJvcHNbNV0gIT09IGxldHRlclBbNV0gfHwgbGFzdExldHRlci5wcm9wc1sxMl0gIT09IGxldHRlclBbMTJdIHx8IGxhc3RMZXR0ZXIucHJvcHNbMTNdICE9PSBsZXR0ZXJQWzEzXSkpKXtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmxldHRlcnNDaGFuZ2VkRmxhZyA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0dGVyVmFsdWUgPSBuZXcgTGV0dGVyUHJvcHMobGV0dGVyTyxsZXR0ZXJTdyxsZXR0ZXJTYyxsZXR0ZXJGYyxudWxsLGxldHRlclApO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBsZXR0ZXJWYWx1ZSA9IGxhc3RMZXR0ZXI7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5yZW5kZXJlZExldHRlcnNbaV0gPSBsZXR0ZXJWYWx1ZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn07XHJcblxyXG5JVGV4dEVsZW1lbnQucHJvdG90eXBlLmJ1aWxkU2hhcGVTdHJpbmcgPSBJU2hhcGVFbGVtZW50LnByb3RvdHlwZS5idWlsZFNoYXBlU3RyaW5nO1xyXG5cclxuSVRleHRFbGVtZW50LnByb3RvdHlwZS5lbXB0eVByb3AgPSBuZXcgTGV0dGVyUHJvcHMoKTtcclxuXG5mdW5jdGlvbiBTVkdUZXh0RWxlbWVudChkYXRhLHBhcmVudENvbnRhaW5lcixnbG9iYWxEYXRhLGNvbXAsIHBsYWNlaG9sZGVyKXtcclxuICAgIHRoaXMudGV4dFNwYW5zID0gW107XHJcbiAgICB0aGlzLnJlbmRlclR5cGUgPSAnc3ZnJztcclxuICAgIHRoaXMuX3BhcmVudC5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsZGF0YSxwYXJlbnRDb250YWluZXIsZ2xvYmFsRGF0YSxjb21wLCBwbGFjZWhvbGRlcik7XHJcbn1cclxuY3JlYXRlRWxlbWVudChTVkdCYXNlRWxlbWVudCwgU1ZHVGV4dEVsZW1lbnQpO1xyXG5cclxuU1ZHVGV4dEVsZW1lbnQucHJvdG90eXBlLmluaXQgPSBJVGV4dEVsZW1lbnQucHJvdG90eXBlLmluaXQ7XHJcblNWR1RleHRFbGVtZW50LnByb3RvdHlwZS5jcmVhdGVQYXRoU2hhcGUgPSBJVGV4dEVsZW1lbnQucHJvdG90eXBlLmNyZWF0ZVBhdGhTaGFwZTtcclxuU1ZHVGV4dEVsZW1lbnQucHJvdG90eXBlLmdldE1lYXN1cmVzID0gSVRleHRFbGVtZW50LnByb3RvdHlwZS5nZXRNZWFzdXJlcztcclxuU1ZHVGV4dEVsZW1lbnQucHJvdG90eXBlLnByZXBhcmVGcmFtZSA9IElUZXh0RWxlbWVudC5wcm90b3R5cGUucHJlcGFyZUZyYW1lO1xyXG5TVkdUZXh0RWxlbWVudC5wcm90b3R5cGUuYnVpbGRTaGFwZVN0cmluZyA9IElUZXh0RWxlbWVudC5wcm90b3R5cGUuYnVpbGRTaGFwZVN0cmluZztcclxuXHJcblNWR1RleHRFbGVtZW50LnByb3RvdHlwZS5jcmVhdGVFbGVtZW50cyA9IGZ1bmN0aW9uKCl7XHJcblxyXG4gICAgdGhpcy5fcGFyZW50LmNyZWF0ZUVsZW1lbnRzLmNhbGwodGhpcyk7XHJcblxyXG5cclxuICAgIGlmKHRoaXMuZGF0YS5sbil7XHJcbiAgICAgICAgdGhpcy5sYXllckVsZW1lbnQuc2V0QXR0cmlidXRlKCdpZCcsdGhpcy5kYXRhLmxuKTtcclxuICAgIH1cclxuICAgIGlmKHRoaXMuZGF0YS5jbCl7XHJcbiAgICAgICAgdGhpcy5sYXllckVsZW1lbnQuc2V0QXR0cmlidXRlKCdjbGFzcycsdGhpcy5kYXRhLmNsKTtcclxuICAgIH1cclxufTtcclxuXHJcblNWR1RleHRFbGVtZW50LnByb3RvdHlwZS5idWlsZE5ld1RleHQgPSBmdW5jdGlvbigpe1xyXG4gICAgdmFyIGksIGxlbjtcclxuXHJcbiAgICB2YXIgZG9jdW1lbnREYXRhID0gdGhpcy5jdXJyZW50VGV4dERvY3VtZW50RGF0YTtcclxuICAgIHRoaXMucmVuZGVyZWRMZXR0ZXJzID0gQXJyYXkuYXBwbHkobnVsbCx7bGVuZ3RoOnRoaXMuY3VycmVudFRleHREb2N1bWVudERhdGEubCA/IHRoaXMuY3VycmVudFRleHREb2N1bWVudERhdGEubC5sZW5ndGggOiAwfSk7XHJcbiAgICBpZihkb2N1bWVudERhdGEuZmMpIHtcclxuICAgICAgICB0aGlzLmxheWVyRWxlbWVudC5zZXRBdHRyaWJ1dGUoJ2ZpbGwnLCAncmdiKCcgKyBNYXRoLnJvdW5kKGRvY3VtZW50RGF0YS5mY1swXSoyNTUpICsgJywnICsgTWF0aC5yb3VuZChkb2N1bWVudERhdGEuZmNbMV0qMjU1KSArICcsJyArIE1hdGgucm91bmQoZG9jdW1lbnREYXRhLmZjWzJdKjI1NSkgKyAnKScpO1xyXG4gICAgfWVsc2V7XHJcbiAgICAgICAgdGhpcy5sYXllckVsZW1lbnQuc2V0QXR0cmlidXRlKCdmaWxsJywgJ3JnYmEoMCwwLDAsMCknKTtcclxuICAgIH1cclxuICAgIGlmKGRvY3VtZW50RGF0YS5zYyl7XHJcbiAgICAgICAgdGhpcy5sYXllckVsZW1lbnQuc2V0QXR0cmlidXRlKCdzdHJva2UnLCAncmdiKCcgKyBNYXRoLnJvdW5kKGRvY3VtZW50RGF0YS5zY1swXSoyNTUpICsgJywnICsgTWF0aC5yb3VuZChkb2N1bWVudERhdGEuc2NbMV0qMjU1KSArICcsJyArIE1hdGgucm91bmQoZG9jdW1lbnREYXRhLnNjWzJdKjI1NSkgKyAnKScpO1xyXG4gICAgICAgIHRoaXMubGF5ZXJFbGVtZW50LnNldEF0dHJpYnV0ZSgnc3Ryb2tlLXdpZHRoJywgZG9jdW1lbnREYXRhLnN3KTtcclxuICAgIH1cclxuICAgIHRoaXMubGF5ZXJFbGVtZW50LnNldEF0dHJpYnV0ZSgnZm9udC1zaXplJywgZG9jdW1lbnREYXRhLnMpO1xyXG4gICAgdmFyIGZvbnREYXRhID0gdGhpcy5nbG9iYWxEYXRhLmZvbnRNYW5hZ2VyLmdldEZvbnRCeU5hbWUoZG9jdW1lbnREYXRhLmYpO1xyXG4gICAgaWYoZm9udERhdGEuZkNsYXNzKXtcclxuICAgICAgICB0aGlzLmxheWVyRWxlbWVudC5zZXRBdHRyaWJ1dGUoJ2NsYXNzJyxmb250RGF0YS5mQ2xhc3MpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICB0aGlzLmxheWVyRWxlbWVudC5zZXRBdHRyaWJ1dGUoJ2ZvbnQtZmFtaWx5JywgZm9udERhdGEuZkZhbWlseSk7XHJcbiAgICAgICAgdmFyIGZXZWlnaHQgPSBkb2N1bWVudERhdGEuZldlaWdodCwgZlN0eWxlID0gZG9jdW1lbnREYXRhLmZTdHlsZTtcclxuICAgICAgICB0aGlzLmxheWVyRWxlbWVudC5zZXRBdHRyaWJ1dGUoJ2ZvbnQtc3R5bGUnLCBmU3R5bGUpO1xyXG4gICAgICAgIHRoaXMubGF5ZXJFbGVtZW50LnNldEF0dHJpYnV0ZSgnZm9udC13ZWlnaHQnLCBmV2VpZ2h0KTtcclxuICAgIH1cclxuXHJcblxyXG5cclxuICAgIHZhciBsZXR0ZXJzID0gZG9jdW1lbnREYXRhLmwgfHwgW107XHJcbiAgICBsZW4gPSBsZXR0ZXJzLmxlbmd0aDtcclxuICAgIGlmKCFsZW4pe1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIHZhciB0U3BhbjtcclxuICAgIHZhciBtYXRyaXhIZWxwZXIgPSB0aGlzLm1IZWxwZXI7XHJcbiAgICB2YXIgc2hhcGVzLCBzaGFwZVN0ciA9ICcnLCBzaW5nbGVTaGFwZSA9IHRoaXMuZGF0YS5zaW5nbGVTaGFwZTtcclxuICAgIGlmIChzaW5nbGVTaGFwZSkge1xyXG4gICAgICAgIHZhciB4UG9zID0gMCwgeVBvcyA9IDAsIGxpbmVXaWR0aHMgPSBkb2N1bWVudERhdGEubGluZVdpZHRocywgYm94V2lkdGggPSBkb2N1bWVudERhdGEuYm94V2lkdGgsIGZpcnN0TGluZSA9IHRydWU7XHJcbiAgICB9XHJcbiAgICB2YXIgY250ID0gMDtcclxuICAgIGZvciAoaSA9IDA7aSA8IGxlbiA7aSArPSAxKSB7XHJcbiAgICAgICAgaWYodGhpcy5nbG9iYWxEYXRhLmZvbnRNYW5hZ2VyLmNoYXJzKXtcclxuICAgICAgICAgICAgaWYoIXNpbmdsZVNoYXBlIHx8IGkgPT09IDApe1xyXG4gICAgICAgICAgICAgICAgdFNwYW4gPSB0aGlzLnRleHRTcGFuc1tjbnRdID8gdGhpcy50ZXh0U3BhbnNbY250XSA6IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhzdmdOUywncGF0aCcpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgIHRTcGFuID0gdGhpcy50ZXh0U3BhbnNbY250XSA/IHRoaXMudGV4dFNwYW5zW2NudF0gOiBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoc3ZnTlMsJ3RleHQnKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdFNwYW4uc3R5bGUuZGlzcGxheSA9ICdpbmhlcml0JztcclxuICAgICAgICB0U3Bhbi5zZXRBdHRyaWJ1dGUoJ3N0cm9rZS1saW5lY2FwJywgJ2J1dHQnKTtcclxuICAgICAgICB0U3Bhbi5zZXRBdHRyaWJ1dGUoJ3N0cm9rZS1saW5lam9pbicsJ3JvdW5kJyk7XHJcbiAgICAgICAgdFNwYW4uc2V0QXR0cmlidXRlKCdzdHJva2UtbWl0ZXJsaW1pdCcsJzQnKTtcclxuICAgICAgICAvL3RTcGFuLnNldEF0dHJpYnV0ZSgndmlzaWJpbGl0eScsICdoaWRkZW4nKTtcclxuICAgICAgICBpZihzaW5nbGVTaGFwZSAmJiBsZXR0ZXJzW2ldLm4pIHtcclxuICAgICAgICAgICAgeFBvcyA9IDA7XHJcbiAgICAgICAgICAgIHlQb3MgKz0gZG9jdW1lbnREYXRhLnlPZmZzZXQ7XHJcbiAgICAgICAgICAgIHlQb3MgKz0gZmlyc3RMaW5lID8gMSA6IDA7XHJcbiAgICAgICAgICAgIGZpcnN0TGluZSA9IGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBtYXRyaXhIZWxwZXIucmVzZXQoKTtcclxuICAgICAgICBpZih0aGlzLmdsb2JhbERhdGEuZm9udE1hbmFnZXIuY2hhcnMpIHtcclxuICAgICAgICAgICAgbWF0cml4SGVscGVyLnNjYWxlKGRvY3VtZW50RGF0YS5zIC8gMTAwLCBkb2N1bWVudERhdGEucyAvIDEwMCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChzaW5nbGVTaGFwZSkge1xyXG4gICAgICAgICAgICBpZihkb2N1bWVudERhdGEucHMpe1xyXG4gICAgICAgICAgICAgICAgbWF0cml4SGVscGVyLnRyYW5zbGF0ZShkb2N1bWVudERhdGEucHNbMF0sZG9jdW1lbnREYXRhLnBzWzFdICsgZG9jdW1lbnREYXRhLmFzY2VudCwwKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBtYXRyaXhIZWxwZXIudHJhbnNsYXRlKDAsLWRvY3VtZW50RGF0YS5scywwKTtcclxuICAgICAgICAgICAgc3dpdGNoKGRvY3VtZW50RGF0YS5qKXtcclxuICAgICAgICAgICAgICAgIGNhc2UgMTpcclxuICAgICAgICAgICAgICAgICAgICBtYXRyaXhIZWxwZXIudHJhbnNsYXRlKGRvY3VtZW50RGF0YS5qdXN0aWZ5T2Zmc2V0ICsgKGJveFdpZHRoIC0gbGluZVdpZHRoc1tsZXR0ZXJzW2ldLmxpbmVdKSwwLDApO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSAyOlxyXG4gICAgICAgICAgICAgICAgICAgIG1hdHJpeEhlbHBlci50cmFuc2xhdGUoZG9jdW1lbnREYXRhLmp1c3RpZnlPZmZzZXQgKyAoYm94V2lkdGggLSBsaW5lV2lkdGhzW2xldHRlcnNbaV0ubGluZV0pLzIsMCwwKTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBtYXRyaXhIZWxwZXIudHJhbnNsYXRlKHhQb3MsIHlQb3MsIDApO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZih0aGlzLmdsb2JhbERhdGEuZm9udE1hbmFnZXIuY2hhcnMpe1xyXG4gICAgICAgICAgICB2YXIgY2hhckRhdGEgPSB0aGlzLmdsb2JhbERhdGEuZm9udE1hbmFnZXIuZ2V0Q2hhckRhdGEoZG9jdW1lbnREYXRhLnQuY2hhckF0KGkpLCBmb250RGF0YS5mU3R5bGUsIHRoaXMuZ2xvYmFsRGF0YS5mb250TWFuYWdlci5nZXRGb250QnlOYW1lKGRvY3VtZW50RGF0YS5mKS5mRmFtaWx5KTtcclxuICAgICAgICAgICAgdmFyIHNoYXBlRGF0YTtcclxuICAgICAgICAgICAgaWYoY2hhckRhdGEpe1xyXG4gICAgICAgICAgICAgICAgc2hhcGVEYXRhID0gY2hhckRhdGEuZGF0YTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHNoYXBlRGF0YSA9IG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYoc2hhcGVEYXRhICYmIHNoYXBlRGF0YS5zaGFwZXMpe1xyXG4gICAgICAgICAgICAgICAgc2hhcGVzID0gc2hhcGVEYXRhLnNoYXBlc1swXS5pdDtcclxuICAgICAgICAgICAgICAgIGlmKCFzaW5nbGVTaGFwZSl7XHJcbiAgICAgICAgICAgICAgICAgICAgc2hhcGVTdHIgPSAnJztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHNoYXBlU3RyICs9IHRoaXMuY3JlYXRlUGF0aFNoYXBlKG1hdHJpeEhlbHBlcixzaGFwZXMpO1xyXG4gICAgICAgICAgICAgICAgaWYoIXNpbmdsZVNoYXBlKXtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdFNwYW4uc2V0QXR0cmlidXRlKCdkJyxzaGFwZVN0cik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYoIXNpbmdsZVNoYXBlKXtcclxuICAgICAgICAgICAgICAgIHRoaXMubGF5ZXJFbGVtZW50LmFwcGVuZENoaWxkKHRTcGFuKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICB0U3Bhbi50ZXh0Q29udGVudCA9IGxldHRlcnNbaV0udmFsO1xyXG4gICAgICAgICAgICB0U3Bhbi5zZXRBdHRyaWJ1dGVOUyhcImh0dHA6Ly93d3cudzMub3JnL1hNTC8xOTk4L25hbWVzcGFjZVwiLCBcInhtbDpzcGFjZVwiLFwicHJlc2VydmVcIik7XHJcbiAgICAgICAgICAgIHRoaXMubGF5ZXJFbGVtZW50LmFwcGVuZENoaWxkKHRTcGFuKTtcclxuICAgICAgICAgICAgaWYoc2luZ2xlU2hhcGUpe1xyXG4gICAgICAgICAgICAgICAgdFNwYW4uc2V0QXR0cmlidXRlKCd0cmFuc2Zvcm0nLG1hdHJpeEhlbHBlci50bzJkQ1NTKCkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmKHNpbmdsZVNoYXBlKSB7XHJcbiAgICAgICAgICAgIHhQb3MgKz0gbGV0dGVyc1tpXS5sIHx8IDA7XHJcbiAgICAgICAgICAgIHhQb3MgKz0gZG9jdW1lbnREYXRhLnRyLzEwMDAqZG9jdW1lbnREYXRhLnM7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vXHJcbiAgICAgICAgdGhpcy50ZXh0U3BhbnNbY250XSA9IHRTcGFuO1xyXG4gICAgICAgIGNudCArPSAxO1xyXG4gICAgfVxyXG4gICAgaWYoIXNpbmdsZVNoYXBlKXtcclxuICAgICAgICB3aGlsZShjbnQgPCB0aGlzLnRleHRTcGFucy5sZW5ndGgpe1xyXG4gICAgICAgICAgICB0aGlzLnRleHRTcGFuc1tjbnRdLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XHJcbiAgICAgICAgICAgIGNudCArPSAxO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGlmKHNpbmdsZVNoYXBlICYmIHRoaXMuZ2xvYmFsRGF0YS5mb250TWFuYWdlci5jaGFycyl7XHJcbiAgICAgICAgdFNwYW4uc2V0QXR0cmlidXRlKCdkJyxzaGFwZVN0cik7XHJcbiAgICAgICAgdGhpcy5sYXllckVsZW1lbnQuYXBwZW5kQ2hpbGQodFNwYW4pO1xyXG4gICAgfVxyXG59XHJcblxyXG5TVkdUZXh0RWxlbWVudC5wcm90b3R5cGUucmVuZGVyRnJhbWUgPSBmdW5jdGlvbihwYXJlbnRNYXRyaXgpe1xyXG5cclxuICAgIHZhciByZW5kZXJQYXJlbnQgPSB0aGlzLl9wYXJlbnQucmVuZGVyRnJhbWUuY2FsbCh0aGlzLHBhcmVudE1hdHJpeCk7XHJcbiAgICBpZihyZW5kZXJQYXJlbnQ9PT1mYWxzZSl7XHJcbiAgICAgICAgdGhpcy5oaWRlKCk7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgaWYodGhpcy5oaWRkZW4pe1xyXG4gICAgICAgIHRoaXMuc2hvdygpO1xyXG4gICAgfVxyXG5cclxuICAgIGlmKHRoaXMuZGF0YS5zaW5nbGVTaGFwZSl7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgdGhpcy5nZXRNZWFzdXJlcygpO1xyXG4gICAgaWYoIXRoaXMubGV0dGVyc0NoYW5nZWRGbGFnKXtcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICB2YXIgIGksbGVuO1xyXG4gICAgdmFyIHJlbmRlcmVkTGV0dGVycyA9IHRoaXMucmVuZGVyZWRMZXR0ZXJzO1xyXG5cclxuICAgIHZhciBsZXR0ZXJzID0gdGhpcy5jdXJyZW50VGV4dERvY3VtZW50RGF0YS5sO1xyXG5cclxuICAgIGxlbiA9IGxldHRlcnMubGVuZ3RoO1xyXG4gICAgdmFyIHJlbmRlcmVkTGV0dGVyO1xyXG4gICAgZm9yKGk9MDtpPGxlbjtpKz0xKXtcclxuICAgICAgICBpZihsZXR0ZXJzW2ldLm4pe1xyXG4gICAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmVuZGVyZWRMZXR0ZXIgPSByZW5kZXJlZExldHRlcnNbaV07XHJcbiAgICAgICAgdGhpcy50ZXh0U3BhbnNbaV0uc2V0QXR0cmlidXRlKCd0cmFuc2Zvcm0nLHJlbmRlcmVkTGV0dGVyLm0pO1xyXG4gICAgICAgIHRoaXMudGV4dFNwYW5zW2ldLnNldEF0dHJpYnV0ZSgnb3BhY2l0eScscmVuZGVyZWRMZXR0ZXIubyk7XHJcbiAgICAgICAgaWYocmVuZGVyZWRMZXR0ZXIuc3cpe1xyXG4gICAgICAgICAgICB0aGlzLnRleHRTcGFuc1tpXS5zZXRBdHRyaWJ1dGUoJ3N0cm9rZS13aWR0aCcscmVuZGVyZWRMZXR0ZXIuc3cpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZihyZW5kZXJlZExldHRlci5zYyl7XHJcbiAgICAgICAgICAgIHRoaXMudGV4dFNwYW5zW2ldLnNldEF0dHJpYnV0ZSgnc3Ryb2tlJyxyZW5kZXJlZExldHRlci5zYyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmKHJlbmRlcmVkTGV0dGVyLmZjKXtcclxuICAgICAgICAgICAgdGhpcy50ZXh0U3BhbnNbaV0uc2V0QXR0cmlidXRlKCdmaWxsJyxyZW5kZXJlZExldHRlci5mYyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgaWYodGhpcy5maXJzdEZyYW1lKSB7XHJcbiAgICAgICAgdGhpcy5maXJzdEZyYW1lID0gZmFsc2U7XHJcbiAgICB9XHJcbn1cclxuXHJcblxyXG5TVkdUZXh0RWxlbWVudC5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uKCl7XHJcbiAgICB0aGlzLl9wYXJlbnQuZGVzdHJveS5jYWxsKHRoaXMuX3BhcmVudCk7XHJcbn07XG5mdW5jdGlvbiBTVkdUaW50RmlsdGVyKGZpbHRlciwgZmlsdGVyTWFuYWdlcil7XHJcbiAgICB0aGlzLmZpbHRlck1hbmFnZXIgPSBmaWx0ZXJNYW5hZ2VyO1xyXG4gICAgdmFyIGZlQ29sb3JNYXRyaXggPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoc3ZnTlMsJ2ZlQ29sb3JNYXRyaXgnKTtcclxuICAgIGZlQ29sb3JNYXRyaXguc2V0QXR0cmlidXRlKCd0eXBlJywnbWF0cml4Jyk7XHJcbiAgICBmZUNvbG9yTWF0cml4LnNldEF0dHJpYnV0ZSgnY29sb3ItaW50ZXJwb2xhdGlvbi1maWx0ZXJzJywnbGluZWFyUkdCJyk7XHJcbiAgICBmZUNvbG9yTWF0cml4LnNldEF0dHJpYnV0ZSgndmFsdWVzJywnMC4zMzMzIDAuMzMzMyAwLjMzMzMgMCAwIDAuMzMzMyAwLjMzMzMgMC4zMzMzIDAgMCAwLjMzMzMgMC4zMzMzIDAuMzMzMyAwIDAgMCAwIDAgMSAwJyk7XHJcbiAgICBmZUNvbG9yTWF0cml4LnNldEF0dHJpYnV0ZSgncmVzdWx0JywnZjEnKTtcclxuICAgIGZpbHRlci5hcHBlbmRDaGlsZChmZUNvbG9yTWF0cml4KTtcclxuICAgIGZlQ29sb3JNYXRyaXggPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoc3ZnTlMsJ2ZlQ29sb3JNYXRyaXgnKTtcclxuICAgIGZlQ29sb3JNYXRyaXguc2V0QXR0cmlidXRlKCd0eXBlJywnbWF0cml4Jyk7XHJcbiAgICBmZUNvbG9yTWF0cml4LnNldEF0dHJpYnV0ZSgnY29sb3ItaW50ZXJwb2xhdGlvbi1maWx0ZXJzJywnc1JHQicpO1xyXG4gICAgZmVDb2xvck1hdHJpeC5zZXRBdHRyaWJ1dGUoJ3ZhbHVlcycsJzEgMCAwIDAgMCAwIDEgMCAwIDAgMCAwIDEgMCAwIDAgMCAwIDEgMCcpO1xyXG4gICAgZmVDb2xvck1hdHJpeC5zZXRBdHRyaWJ1dGUoJ3Jlc3VsdCcsJ2YyJyk7XHJcbiAgICBmaWx0ZXIuYXBwZW5kQ2hpbGQoZmVDb2xvck1hdHJpeCk7XHJcbiAgICB0aGlzLm1hdHJpeEZpbHRlciA9IGZlQ29sb3JNYXRyaXg7XHJcbiAgICBpZihmaWx0ZXJNYW5hZ2VyLmVmZmVjdEVsZW1lbnRzWzJdLnAudiAhPT0gMTAwIHx8IGZpbHRlck1hbmFnZXIuZWZmZWN0RWxlbWVudHNbMl0ucC5rKXtcclxuICAgICAgICB2YXIgZmVNZXJnZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhzdmdOUywnZmVNZXJnZScpO1xyXG4gICAgICAgIGZpbHRlci5hcHBlbmRDaGlsZChmZU1lcmdlKTtcclxuICAgICAgICB2YXIgZmVNZXJnZU5vZGU7XHJcbiAgICAgICAgZmVNZXJnZU5vZGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoc3ZnTlMsJ2ZlTWVyZ2VOb2RlJyk7XHJcbiAgICAgICAgZmVNZXJnZU5vZGUuc2V0QXR0cmlidXRlKCdpbicsJ1NvdXJjZUdyYXBoaWMnKTtcclxuICAgICAgICBmZU1lcmdlLmFwcGVuZENoaWxkKGZlTWVyZ2VOb2RlKTtcclxuICAgICAgICBmZU1lcmdlTm9kZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhzdmdOUywnZmVNZXJnZU5vZGUnKTtcclxuICAgICAgICBmZU1lcmdlTm9kZS5zZXRBdHRyaWJ1dGUoJ2luJywnZjInKTtcclxuICAgICAgICBmZU1lcmdlLmFwcGVuZENoaWxkKGZlTWVyZ2VOb2RlKTtcclxuICAgIH1cclxufVxyXG5cclxuU1ZHVGludEZpbHRlci5wcm90b3R5cGUucmVuZGVyRnJhbWUgPSBmdW5jdGlvbihmb3JjZVJlbmRlcil7XHJcbiAgICBpZihmb3JjZVJlbmRlciB8fCB0aGlzLmZpbHRlck1hbmFnZXIubWRmKXtcclxuICAgICAgICB2YXIgY29sb3JCbGFjayA9IHRoaXMuZmlsdGVyTWFuYWdlci5lZmZlY3RFbGVtZW50c1swXS5wLnY7XHJcbiAgICAgICAgdmFyIGNvbG9yV2hpdGUgPSB0aGlzLmZpbHRlck1hbmFnZXIuZWZmZWN0RWxlbWVudHNbMV0ucC52O1xyXG4gICAgICAgIHZhciBvcGFjaXR5ID0gdGhpcy5maWx0ZXJNYW5hZ2VyLmVmZmVjdEVsZW1lbnRzWzJdLnAudi8xMDA7XHJcbiAgICAgICAgdGhpcy5tYXRyaXhGaWx0ZXIuc2V0QXR0cmlidXRlKCd2YWx1ZXMnLChjb2xvcldoaXRlWzBdLSBjb2xvckJsYWNrWzBdKSsnIDAgMCAwICcrIGNvbG9yQmxhY2tbMF0gKycgJysgKGNvbG9yV2hpdGVbMV0tIGNvbG9yQmxhY2tbMV0pICsnIDAgMCAwICcrIGNvbG9yQmxhY2tbMV0gKycgJysgKGNvbG9yV2hpdGVbMl0tIGNvbG9yQmxhY2tbMl0pICsnIDAgMCAwICcrIGNvbG9yQmxhY2tbMl0gKycgMCAwIDAgJyArIG9wYWNpdHkgKyAnIDAnKTtcclxuICAgIH1cclxufTtcbmZ1bmN0aW9uIFNWR0ZpbGxGaWx0ZXIoZmlsdGVyLCBmaWx0ZXJNYW5hZ2VyKXtcclxuICAgIHRoaXMuZmlsdGVyTWFuYWdlciA9IGZpbHRlck1hbmFnZXI7XHJcbiAgICB2YXIgZmVDb2xvck1hdHJpeCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhzdmdOUywnZmVDb2xvck1hdHJpeCcpO1xyXG4gICAgZmVDb2xvck1hdHJpeC5zZXRBdHRyaWJ1dGUoJ3R5cGUnLCdtYXRyaXgnKTtcclxuICAgIGZlQ29sb3JNYXRyaXguc2V0QXR0cmlidXRlKCdjb2xvci1pbnRlcnBvbGF0aW9uLWZpbHRlcnMnLCdzUkdCJyk7XHJcbiAgICBmZUNvbG9yTWF0cml4LnNldEF0dHJpYnV0ZSgndmFsdWVzJywnMSAwIDAgMCAwIDAgMSAwIDAgMCAwIDAgMSAwIDAgMCAwIDAgMSAwJyk7XHJcbiAgICBmaWx0ZXIuYXBwZW5kQ2hpbGQoZmVDb2xvck1hdHJpeCk7XHJcbiAgICB0aGlzLm1hdHJpeEZpbHRlciA9IGZlQ29sb3JNYXRyaXg7XHJcbn1cclxuU1ZHRmlsbEZpbHRlci5wcm90b3R5cGUucmVuZGVyRnJhbWUgPSBmdW5jdGlvbihmb3JjZVJlbmRlcil7XHJcbiAgICBpZihmb3JjZVJlbmRlciB8fCB0aGlzLmZpbHRlck1hbmFnZXIubWRmKXtcclxuICAgICAgICB2YXIgY29sb3IgPSB0aGlzLmZpbHRlck1hbmFnZXIuZWZmZWN0RWxlbWVudHNbMl0ucC52O1xyXG4gICAgICAgIHZhciBvcGFjaXR5ID0gdGhpcy5maWx0ZXJNYW5hZ2VyLmVmZmVjdEVsZW1lbnRzWzZdLnAudjtcclxuICAgICAgICB0aGlzLm1hdHJpeEZpbHRlci5zZXRBdHRyaWJ1dGUoJ3ZhbHVlcycsJzAgMCAwIDAgJytjb2xvclswXSsnIDAgMCAwIDAgJytjb2xvclsxXSsnIDAgMCAwIDAgJytjb2xvclsyXSsnIDAgMCAwICcrb3BhY2l0eSsnIDAnKTtcclxuICAgIH1cclxufTtcbmZ1bmN0aW9uIFNWR1N0cm9rZUVmZmVjdChlbGVtLCBmaWx0ZXJNYW5hZ2VyKXtcclxuICAgIHRoaXMuaW5pdGlhbGl6ZWQgPSBmYWxzZTtcclxuICAgIHRoaXMuZmlsdGVyTWFuYWdlciA9IGZpbHRlck1hbmFnZXI7XHJcbiAgICB0aGlzLmVsZW0gPSBlbGVtO1xyXG4gICAgdGhpcy5wYXRocyA9IFtdO1xyXG59XHJcblxyXG5TVkdTdHJva2VFZmZlY3QucHJvdG90eXBlLmluaXRpYWxpemUgPSBmdW5jdGlvbigpe1xyXG5cclxuICAgIHZhciBlbGVtQ2hpbGRyZW4gPSB0aGlzLmVsZW0ubGF5ZXJFbGVtZW50LmNoaWxkcmVuIHx8IHRoaXMuZWxlbS5sYXllckVsZW1lbnQuY2hpbGROb2RlcztcclxuICAgIHZhciBwYXRoLGdyb3VwUGF0aCwgaSwgbGVuO1xyXG4gICAgaWYodGhpcy5maWx0ZXJNYW5hZ2VyLmVmZmVjdEVsZW1lbnRzWzFdLnAudiA9PT0gMSl7XHJcbiAgICAgICAgbGVuID0gdGhpcy5lbGVtLm1hc2tNYW5hZ2VyLm1hc2tzUHJvcGVydGllcy5sZW5ndGg7XHJcbiAgICAgICAgaSA9IDA7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIGkgPSB0aGlzLmZpbHRlck1hbmFnZXIuZWZmZWN0RWxlbWVudHNbMF0ucC52IC0gMTtcclxuICAgICAgICBsZW4gPSBpICsgMTtcclxuICAgIH1cclxuICAgIGdyb3VwUGF0aCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhzdmdOUywnZycpOyBcclxuICAgIGdyb3VwUGF0aC5zZXRBdHRyaWJ1dGUoJ2ZpbGwnLCdub25lJyk7XHJcbiAgICBncm91cFBhdGguc2V0QXR0cmlidXRlKCdzdHJva2UtbGluZWNhcCcsJ3JvdW5kJyk7XHJcbiAgICBncm91cFBhdGguc2V0QXR0cmlidXRlKCdzdHJva2UtZGFzaG9mZnNldCcsMSk7XHJcbiAgICBmb3IoaTtpPGxlbjtpKz0xKXtcclxuICAgICAgICBwYXRoID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKHN2Z05TLCdwYXRoJyk7XHJcbiAgICAgICAgZ3JvdXBQYXRoLmFwcGVuZENoaWxkKHBhdGgpO1xyXG4gICAgICAgIHRoaXMucGF0aHMucHVzaCh7cDpwYXRoLG06aX0pO1xyXG4gICAgfVxyXG4gICAgaWYodGhpcy5maWx0ZXJNYW5hZ2VyLmVmZmVjdEVsZW1lbnRzWzEwXS5wLnYgPT09IDMpe1xyXG4gICAgICAgIHZhciBtYXNrID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKHN2Z05TLCdtYXNrJyk7XHJcbiAgICAgICAgdmFyIGlkID0gJ3N0bXNfJyArIHJhbmRvbVN0cmluZygxMCk7XHJcbiAgICAgICAgbWFzay5zZXRBdHRyaWJ1dGUoJ2lkJyxpZCk7XHJcbiAgICAgICAgbWFzay5zZXRBdHRyaWJ1dGUoJ21hc2stdHlwZScsJ2FscGhhJyk7XHJcbiAgICAgICAgbWFzay5hcHBlbmRDaGlsZChncm91cFBhdGgpO1xyXG4gICAgICAgIHRoaXMuZWxlbS5nbG9iYWxEYXRhLmRlZnMuYXBwZW5kQ2hpbGQobWFzayk7XHJcbiAgICAgICAgdmFyIGcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoc3ZnTlMsJ2cnKTtcclxuICAgICAgICBnLnNldEF0dHJpYnV0ZSgnbWFzaycsJ3VybCgjJytpZCsnKScpO1xyXG4gICAgICAgIGlmKGVsZW1DaGlsZHJlblswXSl7XHJcbiAgICAgICAgICAgIGcuYXBwZW5kQ2hpbGQoZWxlbUNoaWxkcmVuWzBdKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5lbGVtLmxheWVyRWxlbWVudC5hcHBlbmRDaGlsZChnKTtcclxuICAgICAgICB0aGlzLm1hc2tlciA9IG1hc2s7XHJcbiAgICAgICAgZ3JvdXBQYXRoLnNldEF0dHJpYnV0ZSgnc3Ryb2tlJywnI2ZmZicpO1xyXG4gICAgfSBlbHNlIGlmKHRoaXMuZmlsdGVyTWFuYWdlci5lZmZlY3RFbGVtZW50c1sxMF0ucC52ID09PSAxIHx8IHRoaXMuZmlsdGVyTWFuYWdlci5lZmZlY3RFbGVtZW50c1sxMF0ucC52ID09PSAyKXtcclxuICAgICAgICBpZih0aGlzLmZpbHRlck1hbmFnZXIuZWZmZWN0RWxlbWVudHNbMTBdLnAudiA9PT0gMil7XHJcbiAgICAgICAgICAgIHZhciBlbGVtQ2hpbGRyZW4gPSB0aGlzLmVsZW0ubGF5ZXJFbGVtZW50LmNoaWxkcmVuIHx8IHRoaXMuZWxlbS5sYXllckVsZW1lbnQuY2hpbGROb2RlcztcclxuICAgICAgICAgICAgd2hpbGUoZWxlbUNoaWxkcmVuLmxlbmd0aCl7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmVsZW0ubGF5ZXJFbGVtZW50LnJlbW92ZUNoaWxkKGVsZW1DaGlsZHJlblswXSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5lbGVtLmxheWVyRWxlbWVudC5hcHBlbmRDaGlsZChncm91cFBhdGgpO1xyXG4gICAgICAgIHRoaXMuZWxlbS5sYXllckVsZW1lbnQucmVtb3ZlQXR0cmlidXRlKCdtYXNrJyk7XHJcbiAgICAgICAgZ3JvdXBQYXRoLnNldEF0dHJpYnV0ZSgnc3Ryb2tlJywnI2ZmZicpO1xyXG4gICAgfVxyXG4gICAgdGhpcy5pbml0aWFsaXplZCA9IHRydWU7XHJcbiAgICB0aGlzLnBhdGhNYXNrZXIgPSBncm91cFBhdGg7XHJcbn1cclxuXHJcblNWR1N0cm9rZUVmZmVjdC5wcm90b3R5cGUucmVuZGVyRnJhbWUgPSBmdW5jdGlvbihmb3JjZVJlbmRlcil7XHJcbiAgICBpZighdGhpcy5pbml0aWFsaXplZCl7XHJcbiAgICAgICAgdGhpcy5pbml0aWFsaXplKCk7XHJcbiAgICB9XHJcbiAgICB2YXIgaSwgbGVuID0gdGhpcy5wYXRocy5sZW5ndGg7XHJcbiAgICB2YXIgbWFzaywgcGF0aDtcclxuICAgIGZvcihpPTA7aTxsZW47aSs9MSl7XHJcbiAgICAgICAgbWFzayA9IHRoaXMuZWxlbS5tYXNrTWFuYWdlci52aWV3RGF0YVt0aGlzLnBhdGhzW2ldLm1dO1xyXG4gICAgICAgIHBhdGggPSB0aGlzLnBhdGhzW2ldLnA7XHJcbiAgICAgICAgaWYoZm9yY2VSZW5kZXIgfHwgdGhpcy5maWx0ZXJNYW5hZ2VyLm1kZiB8fCBtYXNrLnByb3AubWRmKXtcclxuICAgICAgICAgICAgcGF0aC5zZXRBdHRyaWJ1dGUoJ2QnLG1hc2subGFzdFBhdGgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZihmb3JjZVJlbmRlciB8fCB0aGlzLmZpbHRlck1hbmFnZXIuZWZmZWN0RWxlbWVudHNbOV0ucC5tZGYgfHwgdGhpcy5maWx0ZXJNYW5hZ2VyLmVmZmVjdEVsZW1lbnRzWzRdLnAubWRmIHx8IHRoaXMuZmlsdGVyTWFuYWdlci5lZmZlY3RFbGVtZW50c1s3XS5wLm1kZiB8fCB0aGlzLmZpbHRlck1hbmFnZXIuZWZmZWN0RWxlbWVudHNbOF0ucC5tZGYgfHwgbWFzay5wcm9wLm1kZil7XHJcbiAgICAgICAgICAgIHZhciBkYXNoYXJyYXlWYWx1ZTtcclxuICAgICAgICAgICAgaWYodGhpcy5maWx0ZXJNYW5hZ2VyLmVmZmVjdEVsZW1lbnRzWzddLnAudiAhPT0gMCB8fCB0aGlzLmZpbHRlck1hbmFnZXIuZWZmZWN0RWxlbWVudHNbOF0ucC52ICE9PSAxMDApe1xyXG4gICAgICAgICAgICAgICAgdmFyIHMgPSBNYXRoLm1pbih0aGlzLmZpbHRlck1hbmFnZXIuZWZmZWN0RWxlbWVudHNbN10ucC52LHRoaXMuZmlsdGVyTWFuYWdlci5lZmZlY3RFbGVtZW50c1s4XS5wLnYpLzEwMDtcclxuICAgICAgICAgICAgICAgIHZhciBlID0gTWF0aC5tYXgodGhpcy5maWx0ZXJNYW5hZ2VyLmVmZmVjdEVsZW1lbnRzWzddLnAudix0aGlzLmZpbHRlck1hbmFnZXIuZWZmZWN0RWxlbWVudHNbOF0ucC52KS8xMDA7XHJcbiAgICAgICAgICAgICAgICB2YXIgbCA9IHBhdGguZ2V0VG90YWxMZW5ndGgoKTtcclxuICAgICAgICAgICAgICAgIGRhc2hhcnJheVZhbHVlID0gJzAgMCAwICcgKyBsKnMgKyAnICc7XHJcbiAgICAgICAgICAgICAgICB2YXIgbGluZUxlbmd0aCA9IGwqKGUtcyk7XHJcbiAgICAgICAgICAgICAgICB2YXIgc2VnbWVudCA9IDErdGhpcy5maWx0ZXJNYW5hZ2VyLmVmZmVjdEVsZW1lbnRzWzRdLnAudioyKnRoaXMuZmlsdGVyTWFuYWdlci5lZmZlY3RFbGVtZW50c1s5XS5wLnYvMTAwO1xyXG4gICAgICAgICAgICAgICAgdmFyIHVuaXRzID0gTWF0aC5mbG9vcihsaW5lTGVuZ3RoL3NlZ21lbnQpO1xyXG4gICAgICAgICAgICAgICAgdmFyIGo7XHJcbiAgICAgICAgICAgICAgICBmb3Ioaj0wO2o8dW5pdHM7ais9MSl7XHJcbiAgICAgICAgICAgICAgICAgICAgZGFzaGFycmF5VmFsdWUgKz0gJzEgJyArIHRoaXMuZmlsdGVyTWFuYWdlci5lZmZlY3RFbGVtZW50c1s0XS5wLnYqMip0aGlzLmZpbHRlck1hbmFnZXIuZWZmZWN0RWxlbWVudHNbOV0ucC52LzEwMCArICcgJztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGRhc2hhcnJheVZhbHVlICs9ICcwICcgKyBsKjEwICsgJyAwIDAnO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgZGFzaGFycmF5VmFsdWUgPSAnMSAnICsgdGhpcy5maWx0ZXJNYW5hZ2VyLmVmZmVjdEVsZW1lbnRzWzRdLnAudioyKnRoaXMuZmlsdGVyTWFuYWdlci5lZmZlY3RFbGVtZW50c1s5XS5wLnYvMTAwO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHBhdGguc2V0QXR0cmlidXRlKCdzdHJva2UtZGFzaGFycmF5JyxkYXNoYXJyYXlWYWx1ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgaWYoZm9yY2VSZW5kZXIgfHwgdGhpcy5maWx0ZXJNYW5hZ2VyLmVmZmVjdEVsZW1lbnRzWzRdLnAubWRmKXtcclxuICAgICAgICB0aGlzLnBhdGhNYXNrZXIuc2V0QXR0cmlidXRlKCdzdHJva2Utd2lkdGgnLHRoaXMuZmlsdGVyTWFuYWdlci5lZmZlY3RFbGVtZW50c1s0XS5wLnYqMik7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIGlmKGZvcmNlUmVuZGVyIHx8IHRoaXMuZmlsdGVyTWFuYWdlci5lZmZlY3RFbGVtZW50c1s2XS5wLm1kZil7XHJcbiAgICAgICAgdGhpcy5wYXRoTWFza2VyLnNldEF0dHJpYnV0ZSgnb3BhY2l0eScsdGhpcy5maWx0ZXJNYW5hZ2VyLmVmZmVjdEVsZW1lbnRzWzZdLnAudik7XHJcbiAgICB9XHJcbiAgICBpZih0aGlzLmZpbHRlck1hbmFnZXIuZWZmZWN0RWxlbWVudHNbMTBdLnAudiA9PT0gMSB8fCB0aGlzLmZpbHRlck1hbmFnZXIuZWZmZWN0RWxlbWVudHNbMTBdLnAudiA9PT0gMil7XHJcbiAgICAgICAgaWYoZm9yY2VSZW5kZXIgfHwgdGhpcy5maWx0ZXJNYW5hZ2VyLmVmZmVjdEVsZW1lbnRzWzNdLnAubWRmKXtcclxuICAgICAgICAgICAgdmFyIGNvbG9yID0gdGhpcy5maWx0ZXJNYW5hZ2VyLmVmZmVjdEVsZW1lbnRzWzNdLnAudjtcclxuICAgICAgICAgICAgdGhpcy5wYXRoTWFza2VyLnNldEF0dHJpYnV0ZSgnc3Ryb2tlJywncmdiKCcrYm1fZmxvb3IoY29sb3JbMF0qMjU1KSsnLCcrYm1fZmxvb3IoY29sb3JbMV0qMjU1KSsnLCcrYm1fZmxvb3IoY29sb3JbMl0qMjU1KSsnKScpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufTtcbmZ1bmN0aW9uIFNWR1RyaXRvbmVGaWx0ZXIoZmlsdGVyLCBmaWx0ZXJNYW5hZ2VyKXtcclxuICAgIHRoaXMuZmlsdGVyTWFuYWdlciA9IGZpbHRlck1hbmFnZXI7XHJcbiAgICB2YXIgZmVDb2xvck1hdHJpeCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhzdmdOUywnZmVDb2xvck1hdHJpeCcpO1xyXG4gICAgZmVDb2xvck1hdHJpeC5zZXRBdHRyaWJ1dGUoJ3R5cGUnLCdtYXRyaXgnKTtcclxuICAgIGZlQ29sb3JNYXRyaXguc2V0QXR0cmlidXRlKCdjb2xvci1pbnRlcnBvbGF0aW9uLWZpbHRlcnMnLCdsaW5lYXJSR0InKTtcclxuICAgIGZlQ29sb3JNYXRyaXguc2V0QXR0cmlidXRlKCd2YWx1ZXMnLCcwLjMzMzMgMC4zMzMzIDAuMzMzMyAwIDAgMC4zMzMzIDAuMzMzMyAwLjMzMzMgMCAwIDAuMzMzMyAwLjMzMzMgMC4zMzMzIDAgMCAwIDAgMCAxIDAnKTtcclxuICAgIGZlQ29sb3JNYXRyaXguc2V0QXR0cmlidXRlKCdyZXN1bHQnLCdmMScpO1xyXG4gICAgZmlsdGVyLmFwcGVuZENoaWxkKGZlQ29sb3JNYXRyaXgpO1xyXG4gICAgdmFyIGZlQ29tcG9uZW50VHJhbnNmZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoc3ZnTlMsJ2ZlQ29tcG9uZW50VHJhbnNmZXInKTtcclxuICAgIGZlQ29tcG9uZW50VHJhbnNmZXIuc2V0QXR0cmlidXRlKCdjb2xvci1pbnRlcnBvbGF0aW9uLWZpbHRlcnMnLCdzUkdCJyk7XHJcbiAgICBmaWx0ZXIuYXBwZW5kQ2hpbGQoZmVDb21wb25lbnRUcmFuc2Zlcik7XHJcbiAgICB0aGlzLm1hdHJpeEZpbHRlciA9IGZlQ29tcG9uZW50VHJhbnNmZXI7XHJcbiAgICB2YXIgZmVGdW5jUiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhzdmdOUywnZmVGdW5jUicpO1xyXG4gICAgZmVGdW5jUi5zZXRBdHRyaWJ1dGUoJ3R5cGUnLCd0YWJsZScpO1xyXG4gICAgZmVDb21wb25lbnRUcmFuc2Zlci5hcHBlbmRDaGlsZChmZUZ1bmNSKTtcclxuICAgIHRoaXMuZmVGdW5jUiA9IGZlRnVuY1I7XHJcbiAgICB2YXIgZmVGdW5jRyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhzdmdOUywnZmVGdW5jRycpO1xyXG4gICAgZmVGdW5jRy5zZXRBdHRyaWJ1dGUoJ3R5cGUnLCd0YWJsZScpO1xyXG4gICAgZmVDb21wb25lbnRUcmFuc2Zlci5hcHBlbmRDaGlsZChmZUZ1bmNHKTtcclxuICAgIHRoaXMuZmVGdW5jRyA9IGZlRnVuY0c7XHJcbiAgICB2YXIgZmVGdW5jQiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhzdmdOUywnZmVGdW5jQicpO1xyXG4gICAgZmVGdW5jQi5zZXRBdHRyaWJ1dGUoJ3R5cGUnLCd0YWJsZScpO1xyXG4gICAgZmVDb21wb25lbnRUcmFuc2Zlci5hcHBlbmRDaGlsZChmZUZ1bmNCKTtcclxuICAgIHRoaXMuZmVGdW5jQiA9IGZlRnVuY0I7XHJcbn1cclxuXHJcblNWR1RyaXRvbmVGaWx0ZXIucHJvdG90eXBlLnJlbmRlckZyYW1lID0gZnVuY3Rpb24oZm9yY2VSZW5kZXIpe1xyXG4gICAgaWYoZm9yY2VSZW5kZXIgfHwgdGhpcy5maWx0ZXJNYW5hZ2VyLm1kZil7XHJcbiAgICAgICAgdmFyIGNvbG9yMSA9IHRoaXMuZmlsdGVyTWFuYWdlci5lZmZlY3RFbGVtZW50c1swXS5wLnY7XHJcbiAgICAgICAgdmFyIGNvbG9yMiA9IHRoaXMuZmlsdGVyTWFuYWdlci5lZmZlY3RFbGVtZW50c1sxXS5wLnY7XHJcbiAgICAgICAgdmFyIGNvbG9yMyA9IHRoaXMuZmlsdGVyTWFuYWdlci5lZmZlY3RFbGVtZW50c1syXS5wLnY7XHJcbiAgICAgICAgdmFyIHRhYmxlUiA9IGNvbG9yM1swXSArICcgJyArIGNvbG9yMlswXSArICcgJyArIGNvbG9yMVswXVxyXG4gICAgICAgIHZhciB0YWJsZUcgPSBjb2xvcjNbMV0gKyAnICcgKyBjb2xvcjJbMV0gKyAnICcgKyBjb2xvcjFbMV1cclxuICAgICAgICB2YXIgdGFibGVCID0gY29sb3IzWzJdICsgJyAnICsgY29sb3IyWzJdICsgJyAnICsgY29sb3IxWzJdXHJcbiAgICAgICAgdGhpcy5mZUZ1bmNSLnNldEF0dHJpYnV0ZSgndGFibGVWYWx1ZXMnLCB0YWJsZVIpO1xyXG4gICAgICAgIHRoaXMuZmVGdW5jRy5zZXRBdHRyaWJ1dGUoJ3RhYmxlVmFsdWVzJywgdGFibGVHKTtcclxuICAgICAgICB0aGlzLmZlRnVuY0Iuc2V0QXR0cmlidXRlKCd0YWJsZVZhbHVlcycsIHRhYmxlQik7XHJcbiAgICAgICAgLy92YXIgb3BhY2l0eSA9IHRoaXMuZmlsdGVyTWFuYWdlci5lZmZlY3RFbGVtZW50c1syXS5wLnYvMTAwO1xyXG4gICAgICAgIC8vdGhpcy5tYXRyaXhGaWx0ZXIuc2V0QXR0cmlidXRlKCd2YWx1ZXMnLChjb2xvcldoaXRlWzBdLSBjb2xvckJsYWNrWzBdKSsnIDAgMCAwICcrIGNvbG9yQmxhY2tbMF0gKycgJysgKGNvbG9yV2hpdGVbMV0tIGNvbG9yQmxhY2tbMV0pICsnIDAgMCAwICcrIGNvbG9yQmxhY2tbMV0gKycgJysgKGNvbG9yV2hpdGVbMl0tIGNvbG9yQmxhY2tbMl0pICsnIDAgMCAwICcrIGNvbG9yQmxhY2tbMl0gKycgMCAwIDAgJyArIG9wYWNpdHkgKyAnIDAnKTtcclxuICAgIH1cclxufTtcbmZ1bmN0aW9uIFNWR1Byb0xldmVsc0ZpbHRlcihmaWx0ZXIsIGZpbHRlck1hbmFnZXIpe1xyXG4gICAgdGhpcy5maWx0ZXJNYW5hZ2VyID0gZmlsdGVyTWFuYWdlcjtcclxuICAgIHZhciBlZmZlY3RFbGVtZW50cyA9IHRoaXMuZmlsdGVyTWFuYWdlci5lZmZlY3RFbGVtZW50cztcclxuICAgIHZhciBmZUNvbXBvbmVudFRyYW5zZmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKHN2Z05TLCdmZUNvbXBvbmVudFRyYW5zZmVyJyk7XHJcbiAgICB2YXIgZmVGdW5jUiwgZmVGdW5jRywgZmVGdW5jQjtcclxuICAgIFxyXG4gICAgaWYoZWZmZWN0RWxlbWVudHNbOV0ucC5rIHx8IGVmZmVjdEVsZW1lbnRzWzldLnAudiAhPT0gMCB8fCBlZmZlY3RFbGVtZW50c1sxMF0ucC5rIHx8IGVmZmVjdEVsZW1lbnRzWzEwXS5wLnYgIT09IDEgfHwgZWZmZWN0RWxlbWVudHNbMTFdLnAuayB8fCBlZmZlY3RFbGVtZW50c1sxMV0ucC52ICE9PSAxIHx8IGVmZmVjdEVsZW1lbnRzWzEyXS5wLmsgfHwgZWZmZWN0RWxlbWVudHNbMTJdLnAudiAhPT0gMCB8fCBlZmZlY3RFbGVtZW50c1sxM10ucC5rIHx8IGVmZmVjdEVsZW1lbnRzWzEzXS5wLnYgIT09IDEpe1xyXG4gICAgICAgIHRoaXMuZmVGdW5jUiA9IHRoaXMuY3JlYXRlRmVGdW5jKCdmZUZ1bmNSJywgZmVDb21wb25lbnRUcmFuc2Zlcik7XHJcbiAgICB9XHJcbiAgICBpZihlZmZlY3RFbGVtZW50c1sxNl0ucC5rIHx8IGVmZmVjdEVsZW1lbnRzWzE2XS5wLnYgIT09IDAgfHwgZWZmZWN0RWxlbWVudHNbMTddLnAuayB8fCBlZmZlY3RFbGVtZW50c1sxN10ucC52ICE9PSAxIHx8IGVmZmVjdEVsZW1lbnRzWzE4XS5wLmsgfHwgZWZmZWN0RWxlbWVudHNbMThdLnAudiAhPT0gMSB8fCBlZmZlY3RFbGVtZW50c1sxOV0ucC5rIHx8IGVmZmVjdEVsZW1lbnRzWzE5XS5wLnYgIT09IDAgfHwgZWZmZWN0RWxlbWVudHNbMjBdLnAuayB8fCBlZmZlY3RFbGVtZW50c1syMF0ucC52ICE9PSAxKXtcclxuICAgICAgICB0aGlzLmZlRnVuY0cgPSB0aGlzLmNyZWF0ZUZlRnVuYygnZmVGdW5jRycsIGZlQ29tcG9uZW50VHJhbnNmZXIpO1xyXG4gICAgfVxyXG4gICAgaWYoZWZmZWN0RWxlbWVudHNbMjNdLnAuayB8fCBlZmZlY3RFbGVtZW50c1syM10ucC52ICE9PSAwIHx8IGVmZmVjdEVsZW1lbnRzWzI0XS5wLmsgfHwgZWZmZWN0RWxlbWVudHNbMjRdLnAudiAhPT0gMSB8fCBlZmZlY3RFbGVtZW50c1syNV0ucC5rIHx8IGVmZmVjdEVsZW1lbnRzWzI1XS5wLnYgIT09IDEgfHwgZWZmZWN0RWxlbWVudHNbMjZdLnAuayB8fCBlZmZlY3RFbGVtZW50c1syNl0ucC52ICE9PSAwIHx8IGVmZmVjdEVsZW1lbnRzWzI3XS5wLmsgfHwgZWZmZWN0RWxlbWVudHNbMjddLnAudiAhPT0gMSl7XHJcbiAgICAgICAgdGhpcy5mZUZ1bmNCID0gdGhpcy5jcmVhdGVGZUZ1bmMoJ2ZlRnVuY0InLCBmZUNvbXBvbmVudFRyYW5zZmVyKTtcclxuICAgIH1cclxuICAgIGlmKGVmZmVjdEVsZW1lbnRzWzMwXS5wLmsgfHwgZWZmZWN0RWxlbWVudHNbMzBdLnAudiAhPT0gMCB8fCBlZmZlY3RFbGVtZW50c1szMV0ucC5rIHx8IGVmZmVjdEVsZW1lbnRzWzMxXS5wLnYgIT09IDEgfHwgZWZmZWN0RWxlbWVudHNbMzJdLnAuayB8fCBlZmZlY3RFbGVtZW50c1szMl0ucC52ICE9PSAxIHx8IGVmZmVjdEVsZW1lbnRzWzMzXS5wLmsgfHwgZWZmZWN0RWxlbWVudHNbMzNdLnAudiAhPT0gMCB8fCBlZmZlY3RFbGVtZW50c1szNF0ucC5rIHx8IGVmZmVjdEVsZW1lbnRzWzM0XS5wLnYgIT09IDEpe1xyXG4gICAgICAgIHRoaXMuZmVGdW5jQSA9IHRoaXMuY3JlYXRlRmVGdW5jKCdmZUZ1bmNBJywgZmVDb21wb25lbnRUcmFuc2Zlcik7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIGlmKHRoaXMuZmVGdW5jUiB8fCB0aGlzLmZlRnVuY0cgfHwgdGhpcy5mZUZ1bmNCIHx8IHRoaXMuZmVGdW5jQSl7XHJcbiAgICAgICAgZmVDb21wb25lbnRUcmFuc2Zlci5zZXRBdHRyaWJ1dGUoJ2NvbG9yLWludGVycG9sYXRpb24tZmlsdGVycycsJ3NSR0InKTtcclxuICAgICAgICBmaWx0ZXIuYXBwZW5kQ2hpbGQoZmVDb21wb25lbnRUcmFuc2Zlcik7XHJcbiAgICAgICAgZmVDb21wb25lbnRUcmFuc2ZlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhzdmdOUywnZmVDb21wb25lbnRUcmFuc2ZlcicpO1xyXG4gICAgfVxyXG5cclxuICAgIGlmKGVmZmVjdEVsZW1lbnRzWzJdLnAuayB8fCBlZmZlY3RFbGVtZW50c1syXS5wLnYgIT09IDAgfHwgZWZmZWN0RWxlbWVudHNbM10ucC5rIHx8IGVmZmVjdEVsZW1lbnRzWzNdLnAudiAhPT0gMSB8fCBlZmZlY3RFbGVtZW50c1s0XS5wLmsgfHwgZWZmZWN0RWxlbWVudHNbNF0ucC52ICE9PSAxIHx8IGVmZmVjdEVsZW1lbnRzWzVdLnAuayB8fCBlZmZlY3RFbGVtZW50c1s1XS5wLnYgIT09IDAgfHwgZWZmZWN0RWxlbWVudHNbNl0ucC5rIHx8IGVmZmVjdEVsZW1lbnRzWzZdLnAudiAhPT0gMSl7XHJcblxyXG4gICAgICAgIGZlQ29tcG9uZW50VHJhbnNmZXIuc2V0QXR0cmlidXRlKCdjb2xvci1pbnRlcnBvbGF0aW9uLWZpbHRlcnMnLCdzUkdCJyk7XHJcbiAgICAgICAgZmlsdGVyLmFwcGVuZENoaWxkKGZlQ29tcG9uZW50VHJhbnNmZXIpO1xyXG4gICAgICAgIHRoaXMuZmVGdW5jUkNvbXBvc2VkID0gdGhpcy5jcmVhdGVGZUZ1bmMoJ2ZlRnVuY1InLCBmZUNvbXBvbmVudFRyYW5zZmVyKTtcclxuICAgICAgICB0aGlzLmZlRnVuY0dDb21wb3NlZCA9IHRoaXMuY3JlYXRlRmVGdW5jKCdmZUZ1bmNHJywgZmVDb21wb25lbnRUcmFuc2Zlcik7XHJcbiAgICAgICAgdGhpcy5mZUZ1bmNCQ29tcG9zZWQgPSB0aGlzLmNyZWF0ZUZlRnVuYygnZmVGdW5jQicsIGZlQ29tcG9uZW50VHJhbnNmZXIpO1xyXG4gICAgfVxyXG59XHJcblxyXG5TVkdQcm9MZXZlbHNGaWx0ZXIucHJvdG90eXBlLmNyZWF0ZUZlRnVuYyA9IGZ1bmN0aW9uKHR5cGUsIGZlQ29tcG9uZW50VHJhbnNmZXIpIHtcclxuICAgIHZhciBmZUZ1bmMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoc3ZnTlMsdHlwZSk7XHJcbiAgICBmZUZ1bmMuc2V0QXR0cmlidXRlKCd0eXBlJywndGFibGUnKTtcclxuICAgIGZlQ29tcG9uZW50VHJhbnNmZXIuYXBwZW5kQ2hpbGQoZmVGdW5jKTtcclxuICAgIHJldHVybiBmZUZ1bmM7XHJcbn07XHJcblxyXG5TVkdQcm9MZXZlbHNGaWx0ZXIucHJvdG90eXBlLmdldFRhYmxlVmFsdWUgPSBmdW5jdGlvbihpbnB1dEJsYWNrLCBpbnB1dFdoaXRlLCBnYW1tYSwgb3V0cHV0QmxhY2ssIG91dHB1dFdoaXRlKSB7XHJcbiAgICB2YXIgY250ID0gMDtcclxuICAgIHZhciBzZWdtZW50cyA9IDI1NjtcclxuICAgIHZhciBwZXJjO1xyXG4gICAgdmFyIG1pbiA9IE1hdGgubWluKGlucHV0QmxhY2ssIGlucHV0V2hpdGUpO1xyXG4gICAgdmFyIG1heCA9IE1hdGgubWF4KGlucHV0QmxhY2ssIGlucHV0V2hpdGUpO1xyXG4gICAgdmFyIHRhYmxlID0gQXJyYXkuY2FsbChudWxsLHtsZW5ndGg6c2VnbWVudHN9KTtcclxuICAgIHZhciBjb2xvclZhbHVlO1xyXG4gICAgdmFyIHBvcyA9IDA7XHJcbiAgICB2YXIgb3V0cHV0RGVsdGEgPSBvdXRwdXRXaGl0ZSAtIG91dHB1dEJsYWNrOyBcclxuICAgIHZhciBpbnB1dERlbHRhID0gaW5wdXRXaGl0ZSAtIGlucHV0QmxhY2s7IFxyXG4gICAgd2hpbGUoY250IDw9IDI1Nikge1xyXG4gICAgICAgIHBlcmMgPSBjbnQvMjU2O1xyXG4gICAgICAgIGlmKHBlcmMgPD0gbWluKXtcclxuICAgICAgICAgICAgY29sb3JWYWx1ZSA9IGlucHV0RGVsdGEgPCAwID8gb3V0cHV0V2hpdGUgOiBvdXRwdXRCbGFjaztcclxuICAgICAgICB9IGVsc2UgaWYocGVyYyA+PSBtYXgpe1xyXG4gICAgICAgICAgICBjb2xvclZhbHVlID0gaW5wdXREZWx0YSA8IDAgPyBvdXRwdXRCbGFjayA6IG91dHB1dFdoaXRlO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGNvbG9yVmFsdWUgPSAob3V0cHV0QmxhY2sgKyBvdXRwdXREZWx0YSAqIE1hdGgucG93KChwZXJjIC0gaW5wdXRCbGFjaykgLyBpbnB1dERlbHRhLCAxIC8gZ2FtbWEpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGFibGVbcG9zKytdID0gY29sb3JWYWx1ZTtcclxuICAgICAgICBjbnQgKz0gMjU2LyhzZWdtZW50cy0xKTtcclxuICAgIH1cclxuICAgIHJldHVybiB0YWJsZS5qb2luKCcgJyk7XHJcbn07XHJcblxyXG5TVkdQcm9MZXZlbHNGaWx0ZXIucHJvdG90eXBlLnJlbmRlckZyYW1lID0gZnVuY3Rpb24oZm9yY2VSZW5kZXIpe1xyXG4gICAgaWYoZm9yY2VSZW5kZXIgfHwgdGhpcy5maWx0ZXJNYW5hZ2VyLm1kZil7XHJcbiAgICAgICAgdmFyIHZhbCwgY250LCBwZXJjLCBiZXppZXI7XHJcbiAgICAgICAgdmFyIGVmZmVjdEVsZW1lbnRzID0gdGhpcy5maWx0ZXJNYW5hZ2VyLmVmZmVjdEVsZW1lbnRzO1xyXG4gICAgICAgIGlmKHRoaXMuZmVGdW5jUkNvbXBvc2VkICYmIChmb3JjZVJlbmRlciB8fCBlZmZlY3RFbGVtZW50c1syXS5wLm1kZiB8fCBlZmZlY3RFbGVtZW50c1szXS5wLm1kZiB8fCBlZmZlY3RFbGVtZW50c1s0XS5wLm1kZiB8fCBlZmZlY3RFbGVtZW50c1s1XS5wLm1kZiB8fCBlZmZlY3RFbGVtZW50c1s2XS5wLm1kZikpe1xyXG4gICAgICAgICAgICB2YWwgPSB0aGlzLmdldFRhYmxlVmFsdWUoZWZmZWN0RWxlbWVudHNbMl0ucC52LGVmZmVjdEVsZW1lbnRzWzNdLnAudixlZmZlY3RFbGVtZW50c1s0XS5wLnYsZWZmZWN0RWxlbWVudHNbNV0ucC52LGVmZmVjdEVsZW1lbnRzWzZdLnAudik7XHJcbiAgICAgICAgICAgIHRoaXMuZmVGdW5jUkNvbXBvc2VkLnNldEF0dHJpYnV0ZSgndGFibGVWYWx1ZXMnLHZhbCk7XHJcbiAgICAgICAgICAgIHRoaXMuZmVGdW5jR0NvbXBvc2VkLnNldEF0dHJpYnV0ZSgndGFibGVWYWx1ZXMnLHZhbCk7XHJcbiAgICAgICAgICAgIHRoaXMuZmVGdW5jQkNvbXBvc2VkLnNldEF0dHJpYnV0ZSgndGFibGVWYWx1ZXMnLHZhbCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZih0aGlzLmZlRnVuY1IgJiYgKGZvcmNlUmVuZGVyIHx8IGVmZmVjdEVsZW1lbnRzWzldLnAubWRmIHx8IGVmZmVjdEVsZW1lbnRzWzEwXS5wLm1kZiB8fCBlZmZlY3RFbGVtZW50c1sxMV0ucC5tZGYgfHwgZWZmZWN0RWxlbWVudHNbMTJdLnAubWRmIHx8IGVmZmVjdEVsZW1lbnRzWzEzXS5wLm1kZikpe1xyXG4gICAgICAgICAgICB2YWwgPSB0aGlzLmdldFRhYmxlVmFsdWUoZWZmZWN0RWxlbWVudHNbOV0ucC52LGVmZmVjdEVsZW1lbnRzWzEwXS5wLnYsZWZmZWN0RWxlbWVudHNbMTFdLnAudixlZmZlY3RFbGVtZW50c1sxMl0ucC52LGVmZmVjdEVsZW1lbnRzWzEzXS5wLnYpO1xyXG4gICAgICAgICAgICB0aGlzLmZlRnVuY1Iuc2V0QXR0cmlidXRlKCd0YWJsZVZhbHVlcycsdmFsKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmKHRoaXMuZmVGdW5jRyAmJiAoZm9yY2VSZW5kZXIgfHwgZWZmZWN0RWxlbWVudHNbMTZdLnAubWRmIHx8IGVmZmVjdEVsZW1lbnRzWzE3XS5wLm1kZiB8fCBlZmZlY3RFbGVtZW50c1sxOF0ucC5tZGYgfHwgZWZmZWN0RWxlbWVudHNbMTldLnAubWRmIHx8IGVmZmVjdEVsZW1lbnRzWzIwXS5wLm1kZikpe1xyXG4gICAgICAgICAgICB2YWwgPSB0aGlzLmdldFRhYmxlVmFsdWUoZWZmZWN0RWxlbWVudHNbMTZdLnAudixlZmZlY3RFbGVtZW50c1sxN10ucC52LGVmZmVjdEVsZW1lbnRzWzE4XS5wLnYsZWZmZWN0RWxlbWVudHNbMTldLnAudixlZmZlY3RFbGVtZW50c1syMF0ucC52KTtcclxuICAgICAgICAgICAgdGhpcy5mZUZ1bmNHLnNldEF0dHJpYnV0ZSgndGFibGVWYWx1ZXMnLHZhbCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZih0aGlzLmZlRnVuY0IgJiYgKGZvcmNlUmVuZGVyIHx8IGVmZmVjdEVsZW1lbnRzWzIzXS5wLm1kZiB8fCBlZmZlY3RFbGVtZW50c1syNF0ucC5tZGYgfHwgZWZmZWN0RWxlbWVudHNbMjVdLnAubWRmIHx8IGVmZmVjdEVsZW1lbnRzWzI2XS5wLm1kZiB8fCBlZmZlY3RFbGVtZW50c1syN10ucC5tZGYpKXtcclxuICAgICAgICAgICAgdmFsID0gdGhpcy5nZXRUYWJsZVZhbHVlKGVmZmVjdEVsZW1lbnRzWzIzXS5wLnYsZWZmZWN0RWxlbWVudHNbMjRdLnAudixlZmZlY3RFbGVtZW50c1syNV0ucC52LGVmZmVjdEVsZW1lbnRzWzI2XS5wLnYsZWZmZWN0RWxlbWVudHNbMjddLnAudik7XHJcbiAgICAgICAgICAgIHRoaXMuZmVGdW5jQi5zZXRBdHRyaWJ1dGUoJ3RhYmxlVmFsdWVzJyx2YWwpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYodGhpcy5mZUZ1bmNBICYmIChmb3JjZVJlbmRlciB8fCBlZmZlY3RFbGVtZW50c1szMF0ucC5tZGYgfHwgZWZmZWN0RWxlbWVudHNbMzFdLnAubWRmIHx8IGVmZmVjdEVsZW1lbnRzWzMyXS5wLm1kZiB8fCBlZmZlY3RFbGVtZW50c1szM10ucC5tZGYgfHwgZWZmZWN0RWxlbWVudHNbMzRdLnAubWRmKSl7XHJcbiAgICAgICAgICAgIHZhbCA9IHRoaXMuZ2V0VGFibGVWYWx1ZShlZmZlY3RFbGVtZW50c1szMF0ucC52LGVmZmVjdEVsZW1lbnRzWzMxXS5wLnYsZWZmZWN0RWxlbWVudHNbMzJdLnAudixlZmZlY3RFbGVtZW50c1szM10ucC52LGVmZmVjdEVsZW1lbnRzWzM0XS5wLnYpO1xyXG4gICAgICAgICAgICB0aGlzLmZlRnVuY0Euc2V0QXR0cmlidXRlKCd0YWJsZVZhbHVlcycsdmFsKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICB9XHJcbn07XG5mdW5jdGlvbiBTVkdEcm9wU2hhZG93RWZmZWN0KGZpbHRlciwgZmlsdGVyTWFuYWdlcil7XHJcbiAgICAvKjxmZUdhdXNzaWFuQmx1ciBpbj1cIlNvdXJjZUFscGhhXCIgc3RkRGV2aWF0aW9uPVwiM1wiLz4gPCEtLSBzdGREZXZpYXRpb24gaXMgaG93IG11Y2ggdG8gYmx1ciAtLT5cclxuICA8ZmVPZmZzZXQgZHg9XCIyXCIgZHk9XCIyXCIgcmVzdWx0PVwib2Zmc2V0Ymx1clwiLz4gPCEtLSBob3cgbXVjaCB0byBvZmZzZXQgLS0+XHJcbiAgPGZlTWVyZ2U+IFxyXG4gICAgPGZlTWVyZ2VOb2RlLz4gPCEtLSB0aGlzIGNvbnRhaW5zIHRoZSBvZmZzZXQgYmx1cnJlZCBpbWFnZSAtLT5cclxuICAgIDxmZU1lcmdlTm9kZSBpbj1cIlNvdXJjZUdyYXBoaWNcIi8+IDwhLS0gdGhpcyBjb250YWlucyB0aGUgZWxlbWVudCB0aGF0IHRoZSBmaWx0ZXIgaXMgYXBwbGllZCB0byAtLT5cclxuICA8L2ZlTWVyZ2U+Ki9cclxuICAvKjxmZUZsb29kIGZsb29kLWNvbG9yPVwiIzNENDU3NFwiIGZsb29kLW9wYWNpdHk9XCIwLjVcIiByZXN1bHQ9XCJvZmZzZXRDb2xvclwiLz4qL1xyXG4gICAgZmlsdGVyLnNldEF0dHJpYnV0ZSgneCcsJy0xMDAlJyk7XHJcbiAgICBmaWx0ZXIuc2V0QXR0cmlidXRlKCd5JywnLTEwMCUnKTtcclxuICAgIGZpbHRlci5zZXRBdHRyaWJ1dGUoJ3dpZHRoJywnNDAwJScpO1xyXG4gICAgZmlsdGVyLnNldEF0dHJpYnV0ZSgnaGVpZ2h0JywnNDAwJScpO1xyXG4gICAgdGhpcy5maWx0ZXJNYW5hZ2VyID0gZmlsdGVyTWFuYWdlcjtcclxuXHJcbiAgICB2YXIgZmVHYXVzc2lhbkJsdXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoc3ZnTlMsJ2ZlR2F1c3NpYW5CbHVyJyk7XHJcbiAgICBmZUdhdXNzaWFuQmx1ci5zZXRBdHRyaWJ1dGUoJ2luJywnU291cmNlQWxwaGEnKTtcclxuICAgIGZlR2F1c3NpYW5CbHVyLnNldEF0dHJpYnV0ZSgncmVzdWx0JywnZHJvcF9zaGFkb3dfMScpO1xyXG4gICAgZmVHYXVzc2lhbkJsdXIuc2V0QXR0cmlidXRlKCdzdGREZXZpYXRpb24nLCcwJyk7XHJcbiAgICB0aGlzLmZlR2F1c3NpYW5CbHVyID0gZmVHYXVzc2lhbkJsdXI7XHJcbiAgICBmaWx0ZXIuYXBwZW5kQ2hpbGQoZmVHYXVzc2lhbkJsdXIpO1xyXG5cclxuICAgIHZhciBmZU9mZnNldCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhzdmdOUywnZmVPZmZzZXQnKTtcclxuICAgIGZlT2Zmc2V0LnNldEF0dHJpYnV0ZSgnZHgnLCcyNScpO1xyXG4gICAgZmVPZmZzZXQuc2V0QXR0cmlidXRlKCdkeScsJzAnKTtcclxuICAgIGZlT2Zmc2V0LnNldEF0dHJpYnV0ZSgnaW4nLCdkcm9wX3NoYWRvd18xJyk7XHJcbiAgICBmZU9mZnNldC5zZXRBdHRyaWJ1dGUoJ3Jlc3VsdCcsJ2Ryb3Bfc2hhZG93XzInKTtcclxuICAgIHRoaXMuZmVPZmZzZXQgPSBmZU9mZnNldDtcclxuICAgIGZpbHRlci5hcHBlbmRDaGlsZChmZU9mZnNldCk7XHJcbiAgICB2YXIgZmVGbG9vZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhzdmdOUywnZmVGbG9vZCcpO1xyXG4gICAgZmVGbG9vZC5zZXRBdHRyaWJ1dGUoJ2Zsb29kLWNvbG9yJywnIzAwZmYwMCcpO1xyXG4gICAgZmVGbG9vZC5zZXRBdHRyaWJ1dGUoJ2Zsb29kLW9wYWNpdHknLCcxJyk7XHJcbiAgICBmZUZsb29kLnNldEF0dHJpYnV0ZSgncmVzdWx0JywnZHJvcF9zaGFkb3dfMycpO1xyXG4gICAgdGhpcy5mZUZsb29kID0gZmVGbG9vZDtcclxuICAgIGZpbHRlci5hcHBlbmRDaGlsZChmZUZsb29kKTtcclxuXHJcbiAgICB2YXIgZmVDb21wb3NpdGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoc3ZnTlMsJ2ZlQ29tcG9zaXRlJyk7XHJcbiAgICBmZUNvbXBvc2l0ZS5zZXRBdHRyaWJ1dGUoJ2luJywnZHJvcF9zaGFkb3dfMycpO1xyXG4gICAgZmVDb21wb3NpdGUuc2V0QXR0cmlidXRlKCdpbjInLCdkcm9wX3NoYWRvd18yJyk7XHJcbiAgICBmZUNvbXBvc2l0ZS5zZXRBdHRyaWJ1dGUoJ29wZXJhdG9yJywnaW4nKTtcclxuICAgIGZlQ29tcG9zaXRlLnNldEF0dHJpYnV0ZSgncmVzdWx0JywnZHJvcF9zaGFkb3dfNCcpO1xyXG4gICAgZmlsdGVyLmFwcGVuZENoaWxkKGZlQ29tcG9zaXRlKTtcclxuXHJcblxyXG4gICAgdmFyIGZlTWVyZ2UgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoc3ZnTlMsJ2ZlTWVyZ2UnKTtcclxuICAgIGZpbHRlci5hcHBlbmRDaGlsZChmZU1lcmdlKTtcclxuICAgIHZhciBmZU1lcmdlTm9kZTtcclxuICAgIGZlTWVyZ2VOb2RlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKHN2Z05TLCdmZU1lcmdlTm9kZScpO1xyXG4gICAgZmVNZXJnZS5hcHBlbmRDaGlsZChmZU1lcmdlTm9kZSk7XHJcbiAgICBmZU1lcmdlTm9kZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhzdmdOUywnZmVNZXJnZU5vZGUnKTtcclxuICAgIGZlTWVyZ2VOb2RlLnNldEF0dHJpYnV0ZSgnaW4nLCdTb3VyY2VHcmFwaGljJyk7XHJcbiAgICB0aGlzLmZlTWVyZ2VOb2RlID0gZmVNZXJnZU5vZGU7XHJcbiAgICB0aGlzLmZlTWVyZ2UgPSBmZU1lcmdlO1xyXG4gICAgdGhpcy5vcmlnaW5hbE5vZGVBZGRlZCA9IGZhbHNlO1xyXG4gICAgZmVNZXJnZS5hcHBlbmRDaGlsZChmZU1lcmdlTm9kZSk7XHJcbn1cclxuXHJcblNWR0Ryb3BTaGFkb3dFZmZlY3QucHJvdG90eXBlLnJlbmRlckZyYW1lID0gZnVuY3Rpb24oZm9yY2VSZW5kZXIpe1xyXG4gICAgaWYoZm9yY2VSZW5kZXIgfHwgdGhpcy5maWx0ZXJNYW5hZ2VyLm1kZil7XHJcbiAgICAgICAgaWYoZm9yY2VSZW5kZXIgfHwgdGhpcy5maWx0ZXJNYW5hZ2VyLmVmZmVjdEVsZW1lbnRzWzRdLnAubWRmKXtcclxuICAgICAgICAgICAgdGhpcy5mZUdhdXNzaWFuQmx1ci5zZXRBdHRyaWJ1dGUoJ3N0ZERldmlhdGlvbicsIHRoaXMuZmlsdGVyTWFuYWdlci5lZmZlY3RFbGVtZW50c1s0XS5wLnYgLyA0KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYoZm9yY2VSZW5kZXIgfHwgdGhpcy5maWx0ZXJNYW5hZ2VyLmVmZmVjdEVsZW1lbnRzWzBdLnAubWRmKXtcclxuICAgICAgICAgICAgdmFyIGNvbCA9IHRoaXMuZmlsdGVyTWFuYWdlci5lZmZlY3RFbGVtZW50c1swXS5wLnY7XHJcbiAgICAgICAgICAgIHRoaXMuZmVGbG9vZC5zZXRBdHRyaWJ1dGUoJ2Zsb29kLWNvbG9yJyxyZ2JUb0hleChNYXRoLnJvdW5kKGNvbFswXSoyNTUpLE1hdGgucm91bmQoY29sWzFdKjI1NSksTWF0aC5yb3VuZChjb2xbMl0qMjU1KSkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZihmb3JjZVJlbmRlciB8fCB0aGlzLmZpbHRlck1hbmFnZXIuZWZmZWN0RWxlbWVudHNbMV0ucC5tZGYpe1xyXG4gICAgICAgICAgICB0aGlzLmZlRmxvb2Quc2V0QXR0cmlidXRlKCdmbG9vZC1vcGFjaXR5Jyx0aGlzLmZpbHRlck1hbmFnZXIuZWZmZWN0RWxlbWVudHNbMV0ucC52LzI1NSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmKGZvcmNlUmVuZGVyIHx8IHRoaXMuZmlsdGVyTWFuYWdlci5lZmZlY3RFbGVtZW50c1syXS5wLm1kZiB8fCB0aGlzLmZpbHRlck1hbmFnZXIuZWZmZWN0RWxlbWVudHNbM10ucC5tZGYpe1xyXG4gICAgICAgICAgICB2YXIgZGlzdGFuY2UgPSB0aGlzLmZpbHRlck1hbmFnZXIuZWZmZWN0RWxlbWVudHNbM10ucC52XHJcbiAgICAgICAgICAgIHZhciBhbmdsZSA9ICh0aGlzLmZpbHRlck1hbmFnZXIuZWZmZWN0RWxlbWVudHNbMl0ucC52IC0gOTApICogZGVnVG9SYWRzXHJcbiAgICAgICAgICAgIHZhciB4ID0gZGlzdGFuY2UgKiBNYXRoLmNvcyhhbmdsZSlcclxuICAgICAgICAgICAgdmFyIHkgPSBkaXN0YW5jZSAqIE1hdGguc2luKGFuZ2xlKVxyXG4gICAgICAgICAgICB0aGlzLmZlT2Zmc2V0LnNldEF0dHJpYnV0ZSgnZHgnLCB4KTtcclxuICAgICAgICAgICAgdGhpcy5mZU9mZnNldC5zZXRBdHRyaWJ1dGUoJ2R5JywgeSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8qaWYoZm9yY2VSZW5kZXIgfHwgdGhpcy5maWx0ZXJNYW5hZ2VyLmVmZmVjdEVsZW1lbnRzWzVdLnAubWRmKXtcclxuICAgICAgICAgICAgaWYodGhpcy5maWx0ZXJNYW5hZ2VyLmVmZmVjdEVsZW1lbnRzWzVdLnAudiA9PT0gMSAmJiB0aGlzLm9yaWdpbmFsTm9kZUFkZGVkKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmZlTWVyZ2UucmVtb3ZlQ2hpbGQodGhpcy5mZU1lcmdlTm9kZSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLm9yaWdpbmFsTm9kZUFkZGVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZih0aGlzLmZpbHRlck1hbmFnZXIuZWZmZWN0RWxlbWVudHNbNV0ucC52ID09PSAwICYmICF0aGlzLm9yaWdpbmFsTm9kZUFkZGVkKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmZlTWVyZ2UuYXBwZW5kQ2hpbGQodGhpcy5mZU1lcmdlTm9kZSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLm9yaWdpbmFsTm9kZUFkZGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0qL1xyXG4gICAgfVxyXG59O1xuZnVuY3Rpb24gU1ZHRWZmZWN0cyhlbGVtKXtcclxuICAgIHZhciBpLCBsZW4gPSBlbGVtLmRhdGEuZWYubGVuZ3RoO1xyXG4gICAgdmFyIGZpbElkID0gcmFuZG9tU3RyaW5nKDEwKTtcclxuICAgIHZhciBmaWwgPSBmaWx0ZXJzRmFjdG9yeS5jcmVhdGVGaWx0ZXIoZmlsSWQpO1xyXG4gICAgdmFyIGNvdW50ID0gMDtcclxuICAgIHRoaXMuZmlsdGVycyA9IFtdO1xyXG4gICAgdmFyIGZpbHRlck1hbmFnZXI7XHJcbiAgICBmb3IoaT0wO2k8bGVuO2krPTEpe1xyXG4gICAgICAgIGlmKGVsZW0uZGF0YS5lZltpXS50eSA9PT0gMjApe1xyXG4gICAgICAgICAgICBjb3VudCArPSAxO1xyXG4gICAgICAgICAgICBmaWx0ZXJNYW5hZ2VyID0gbmV3IFNWR1RpbnRGaWx0ZXIoZmlsLCBlbGVtLmVmZmVjdHMuZWZmZWN0RWxlbWVudHNbaV0pO1xyXG4gICAgICAgICAgICB0aGlzLmZpbHRlcnMucHVzaChmaWx0ZXJNYW5hZ2VyKTtcclxuICAgICAgICB9ZWxzZSBpZihlbGVtLmRhdGEuZWZbaV0udHkgPT09IDIxKXtcclxuICAgICAgICAgICAgY291bnQgKz0gMTtcclxuICAgICAgICAgICAgZmlsdGVyTWFuYWdlciA9IG5ldyBTVkdGaWxsRmlsdGVyKGZpbCwgZWxlbS5lZmZlY3RzLmVmZmVjdEVsZW1lbnRzW2ldKTtcclxuICAgICAgICAgICAgdGhpcy5maWx0ZXJzLnB1c2goZmlsdGVyTWFuYWdlcik7XHJcbiAgICAgICAgfWVsc2UgaWYoZWxlbS5kYXRhLmVmW2ldLnR5ID09PSAyMil7XHJcbiAgICAgICAgICAgIGZpbHRlck1hbmFnZXIgPSBuZXcgU1ZHU3Ryb2tlRWZmZWN0KGVsZW0sIGVsZW0uZWZmZWN0cy5lZmZlY3RFbGVtZW50c1tpXSk7XHJcbiAgICAgICAgICAgIHRoaXMuZmlsdGVycy5wdXNoKGZpbHRlck1hbmFnZXIpO1xyXG4gICAgICAgIH1lbHNlIGlmKGVsZW0uZGF0YS5lZltpXS50eSA9PT0gMjMpe1xyXG4gICAgICAgICAgICBjb3VudCArPSAxO1xyXG4gICAgICAgICAgICBmaWx0ZXJNYW5hZ2VyID0gbmV3IFNWR1RyaXRvbmVGaWx0ZXIoZmlsLCBlbGVtLmVmZmVjdHMuZWZmZWN0RWxlbWVudHNbaV0pO1xyXG4gICAgICAgICAgICB0aGlzLmZpbHRlcnMucHVzaChmaWx0ZXJNYW5hZ2VyKTtcclxuICAgICAgICB9ZWxzZSBpZihlbGVtLmRhdGEuZWZbaV0udHkgPT09IDI0KXtcclxuICAgICAgICAgICAgY291bnQgKz0gMTtcclxuICAgICAgICAgICAgZmlsdGVyTWFuYWdlciA9IG5ldyBTVkdQcm9MZXZlbHNGaWx0ZXIoZmlsLCBlbGVtLmVmZmVjdHMuZWZmZWN0RWxlbWVudHNbaV0pO1xyXG4gICAgICAgICAgICB0aGlzLmZpbHRlcnMucHVzaChmaWx0ZXJNYW5hZ2VyKTtcclxuICAgICAgICB9ZWxzZSBpZihlbGVtLmRhdGEuZWZbaV0udHkgPT09IDI1KXtcclxuICAgICAgICAgICAgY291bnQgKz0gMTtcclxuICAgICAgICAgICAgZmlsdGVyTWFuYWdlciA9IG5ldyBTVkdEcm9wU2hhZG93RWZmZWN0KGZpbCwgZWxlbS5lZmZlY3RzLmVmZmVjdEVsZW1lbnRzW2ldKTtcclxuICAgICAgICAgICAgdGhpcy5maWx0ZXJzLnB1c2goZmlsdGVyTWFuYWdlcik7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgaWYoY291bnQpe1xyXG4gICAgICAgIGVsZW0uZ2xvYmFsRGF0YS5kZWZzLmFwcGVuZENoaWxkKGZpbCk7XHJcbiAgICAgICAgZWxlbS5sYXllckVsZW1lbnQuc2V0QXR0cmlidXRlKCdmaWx0ZXInLCd1cmwoIycrZmlsSWQrJyknKTtcclxuICAgIH1cclxufVxyXG5cclxuU1ZHRWZmZWN0cy5wcm90b3R5cGUucmVuZGVyRnJhbWUgPSBmdW5jdGlvbihmaXJzdEZyYW1lKXtcclxuICAgIHZhciBpLCBsZW4gPSB0aGlzLmZpbHRlcnMubGVuZ3RoO1xyXG4gICAgZm9yKGk9MDtpPGxlbjtpKz0xKXtcclxuICAgICAgICB0aGlzLmZpbHRlcnNbaV0ucmVuZGVyRnJhbWUoZmlyc3RGcmFtZSk7XHJcbiAgICB9XHJcbn07XG5mdW5jdGlvbiBJQ29tcEVsZW1lbnQoZGF0YSxwYXJlbnRDb250YWluZXIsZ2xvYmFsRGF0YSxjb21wLCBwbGFjZWhvbGRlcil7XHJcbiAgICB0aGlzLl9wYXJlbnQuY29uc3RydWN0b3IuY2FsbCh0aGlzLGRhdGEscGFyZW50Q29udGFpbmVyLGdsb2JhbERhdGEsY29tcCwgcGxhY2Vob2xkZXIpO1xyXG4gICAgdGhpcy5sYXllcnMgPSBkYXRhLmxheWVycztcclxuICAgIHRoaXMuc3VwcG9ydHMzZCA9IHRydWU7XHJcbiAgICB0aGlzLmNvbXBsZXRlTGF5ZXJzID0gZmFsc2U7XHJcbiAgICB0aGlzLnBlbmRpbmdFbGVtZW50cyA9IFtdO1xyXG4gICAgdGhpcy5lbGVtZW50cyA9IHRoaXMubGF5ZXJzID8gQXJyYXkuYXBwbHkobnVsbCx7bGVuZ3RoOnRoaXMubGF5ZXJzLmxlbmd0aH0pIDogW107XHJcbiAgICBpZih0aGlzLmRhdGEudG0pe1xyXG4gICAgICAgIHRoaXMudG0gPSBQcm9wZXJ0eUZhY3RvcnkuZ2V0UHJvcCh0aGlzLHRoaXMuZGF0YS50bSwwLGdsb2JhbERhdGEuZnJhbWVSYXRlLHRoaXMuZHluYW1pY1Byb3BlcnRpZXMpO1xyXG4gICAgfVxyXG4gICAgaWYodGhpcy5kYXRhLnh0KXtcclxuICAgICAgICB0aGlzLmxheWVyRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhzdmdOUywnZycpO1xyXG4gICAgICAgIHRoaXMuYnVpbGRBbGxJdGVtcygpO1xyXG4gICAgfSBlbHNlIGlmKCFnbG9iYWxEYXRhLnByb2dyZXNzaXZlTG9hZCl7XHJcbiAgICAgICAgdGhpcy5idWlsZEFsbEl0ZW1zKCk7XHJcbiAgICB9XHJcbn1cclxuY3JlYXRlRWxlbWVudChTVkdCYXNlRWxlbWVudCwgSUNvbXBFbGVtZW50KTtcclxuXHJcbklDb21wRWxlbWVudC5wcm90b3R5cGUuaGlkZSA9IGZ1bmN0aW9uKCl7XHJcbiAgICBpZighdGhpcy5oaWRkZW4pe1xyXG4gICAgICAgIHRoaXMuX3BhcmVudC5oaWRlLmNhbGwodGhpcyk7XHJcbiAgICAgICAgdmFyIGksbGVuID0gdGhpcy5lbGVtZW50cy5sZW5ndGg7XHJcbiAgICAgICAgZm9yKCBpID0gMDsgaSA8IGxlbjsgaSs9MSApe1xyXG4gICAgICAgICAgICBpZih0aGlzLmVsZW1lbnRzW2ldKXtcclxuICAgICAgICAgICAgICAgIHRoaXMuZWxlbWVudHNbaV0uaGlkZSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59O1xyXG5cclxuSUNvbXBFbGVtZW50LnByb3RvdHlwZS5wcmVwYXJlRnJhbWUgPSBmdW5jdGlvbihudW0pe1xyXG4gICAgdGhpcy5fcGFyZW50LnByZXBhcmVGcmFtZS5jYWxsKHRoaXMsbnVtKTtcclxuICAgIGlmKHRoaXMuaXNWaXNpYmxlPT09ZmFsc2UgJiYgIXRoaXMuZGF0YS54dCl7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIGlmKHRoaXMudG0pe1xyXG4gICAgICAgIHZhciB0aW1lUmVtYXBwZWQgPSB0aGlzLnRtLnY7XHJcbiAgICAgICAgaWYodGltZVJlbWFwcGVkID09PSB0aGlzLmRhdGEub3Ape1xyXG4gICAgICAgICAgICB0aW1lUmVtYXBwZWQgPSB0aGlzLmRhdGEub3AgLSAxO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnJlbmRlcmVkRnJhbWUgPSB0aW1lUmVtYXBwZWQ7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIHRoaXMucmVuZGVyZWRGcmFtZSA9IG51bS90aGlzLmRhdGEuc3I7XHJcbiAgICB9XHJcbiAgICB2YXIgaSxsZW4gPSB0aGlzLmVsZW1lbnRzLmxlbmd0aDtcclxuICAgIGlmKCF0aGlzLmNvbXBsZXRlTGF5ZXJzKXtcclxuICAgICAgICB0aGlzLmNoZWNrTGF5ZXJzKHRoaXMucmVuZGVyZWRGcmFtZSk7XHJcbiAgICB9XHJcbiAgICBmb3IoIGkgPSAwOyBpIDwgbGVuOyBpKz0xICl7XHJcbiAgICAgICAgaWYodGhpcy5jb21wbGV0ZUxheWVycyB8fCB0aGlzLmVsZW1lbnRzW2ldKXtcclxuICAgICAgICAgICAgdGhpcy5lbGVtZW50c1tpXS5wcmVwYXJlRnJhbWUodGhpcy5yZW5kZXJlZEZyYW1lIC0gdGhpcy5sYXllcnNbaV0uc3QpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufTtcclxuXHJcbklDb21wRWxlbWVudC5wcm90b3R5cGUucmVuZGVyRnJhbWUgPSBmdW5jdGlvbihwYXJlbnRNYXRyaXgpe1xyXG4gICAgdmFyIHJlbmRlclBhcmVudCA9IHRoaXMuX3BhcmVudC5yZW5kZXJGcmFtZS5jYWxsKHRoaXMscGFyZW50TWF0cml4KTtcclxuICAgIHZhciBpLGxlbiA9IHRoaXMubGF5ZXJzLmxlbmd0aDtcclxuICAgIGlmKHJlbmRlclBhcmVudD09PWZhbHNlKXtcclxuICAgICAgICB0aGlzLmhpZGUoKTtcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgaWYodGhpcy5oaWRkZW4pIHtcclxuICAgICAgICB0aGlzLnNob3coKTtcclxuICAgIH1cclxuICAgIGZvciggaSA9IDA7IGkgPCBsZW47IGkrPTEgKXtcclxuICAgICAgICBpZih0aGlzLmNvbXBsZXRlTGF5ZXJzIHx8IHRoaXMuZWxlbWVudHNbaV0pe1xyXG4gICAgICAgICAgICB0aGlzLmVsZW1lbnRzW2ldLnJlbmRlckZyYW1lKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgaWYodGhpcy5maXJzdEZyYW1lKXtcclxuICAgICAgICB0aGlzLmZpcnN0RnJhbWUgPSBmYWxzZTtcclxuICAgIH1cclxufTtcclxuXHJcbklDb21wRWxlbWVudC5wcm90b3R5cGUuc2V0RWxlbWVudHMgPSBmdW5jdGlvbihlbGVtcyl7XHJcbiAgICB0aGlzLmVsZW1lbnRzID0gZWxlbXM7XHJcbn07XHJcblxyXG5JQ29tcEVsZW1lbnQucHJvdG90eXBlLmdldEVsZW1lbnRzID0gZnVuY3Rpb24oKXtcclxuICAgIHJldHVybiB0aGlzLmVsZW1lbnRzO1xyXG59O1xyXG5cclxuSUNvbXBFbGVtZW50LnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24oKXtcclxuICAgIHRoaXMuX3BhcmVudC5kZXN0cm95LmNhbGwodGhpcy5fcGFyZW50KTtcclxuICAgIHZhciBpLGxlbiA9IHRoaXMubGF5ZXJzLmxlbmd0aDtcclxuICAgIGZvciggaSA9IDA7IGkgPCBsZW47IGkrPTEgKXtcclxuICAgICAgICBpZih0aGlzLmVsZW1lbnRzW2ldKXtcclxuICAgICAgICAgICAgdGhpcy5lbGVtZW50c1tpXS5kZXN0cm95KCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59O1xyXG5cclxuSUNvbXBFbGVtZW50LnByb3RvdHlwZS5jaGVja0xheWVycyA9IFNWR1JlbmRlcmVyLnByb3RvdHlwZS5jaGVja0xheWVycztcclxuSUNvbXBFbGVtZW50LnByb3RvdHlwZS5idWlsZEl0ZW0gPSBTVkdSZW5kZXJlci5wcm90b3R5cGUuYnVpbGRJdGVtO1xyXG5JQ29tcEVsZW1lbnQucHJvdG90eXBlLmJ1aWxkQWxsSXRlbXMgPSBTVkdSZW5kZXJlci5wcm90b3R5cGUuYnVpbGRBbGxJdGVtcztcclxuSUNvbXBFbGVtZW50LnByb3RvdHlwZS5idWlsZEVsZW1lbnRQYXJlbnRpbmcgPSBTVkdSZW5kZXJlci5wcm90b3R5cGUuYnVpbGRFbGVtZW50UGFyZW50aW5nO1xyXG5JQ29tcEVsZW1lbnQucHJvdG90eXBlLmNyZWF0ZUl0ZW0gPSBTVkdSZW5kZXJlci5wcm90b3R5cGUuY3JlYXRlSXRlbTtcclxuSUNvbXBFbGVtZW50LnByb3RvdHlwZS5jcmVhdGVJbWFnZSA9IFNWR1JlbmRlcmVyLnByb3RvdHlwZS5jcmVhdGVJbWFnZTtcclxuSUNvbXBFbGVtZW50LnByb3RvdHlwZS5jcmVhdGVDb21wID0gU1ZHUmVuZGVyZXIucHJvdG90eXBlLmNyZWF0ZUNvbXA7XHJcbklDb21wRWxlbWVudC5wcm90b3R5cGUuY3JlYXRlU29saWQgPSBTVkdSZW5kZXJlci5wcm90b3R5cGUuY3JlYXRlU29saWQ7XHJcbklDb21wRWxlbWVudC5wcm90b3R5cGUuY3JlYXRlU2hhcGUgPSBTVkdSZW5kZXJlci5wcm90b3R5cGUuY3JlYXRlU2hhcGU7XHJcbklDb21wRWxlbWVudC5wcm90b3R5cGUuY3JlYXRlVGV4dCA9IFNWR1JlbmRlcmVyLnByb3RvdHlwZS5jcmVhdGVUZXh0O1xyXG5JQ29tcEVsZW1lbnQucHJvdG90eXBlLmNyZWF0ZUJhc2UgPSBTVkdSZW5kZXJlci5wcm90b3R5cGUuY3JlYXRlQmFzZTtcclxuSUNvbXBFbGVtZW50LnByb3RvdHlwZS5hcHBlbmRFbGVtZW50SW5Qb3MgPSBTVkdSZW5kZXJlci5wcm90b3R5cGUuYXBwZW5kRWxlbWVudEluUG9zO1xyXG5JQ29tcEVsZW1lbnQucHJvdG90eXBlLmNoZWNrUGVuZGluZ0VsZW1lbnRzID0gU1ZHUmVuZGVyZXIucHJvdG90eXBlLmNoZWNrUGVuZGluZ0VsZW1lbnRzO1xyXG5JQ29tcEVsZW1lbnQucHJvdG90eXBlLmFkZFBlbmRpbmdFbGVtZW50ID0gU1ZHUmVuZGVyZXIucHJvdG90eXBlLmFkZFBlbmRpbmdFbGVtZW50O1xuZnVuY3Rpb24gSUltYWdlRWxlbWVudChkYXRhLHBhcmVudENvbnRhaW5lcixnbG9iYWxEYXRhLGNvbXAscGxhY2Vob2xkZXIpe1xyXG4gICAgdGhpcy5hc3NldERhdGEgPSBnbG9iYWxEYXRhLmdldEFzc2V0RGF0YShkYXRhLnJlZklkKTtcclxuICAgIHRoaXMuX3BhcmVudC5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsZGF0YSxwYXJlbnRDb250YWluZXIsZ2xvYmFsRGF0YSxjb21wLHBsYWNlaG9sZGVyKTtcclxufVxyXG5jcmVhdGVFbGVtZW50KFNWR0Jhc2VFbGVtZW50LCBJSW1hZ2VFbGVtZW50KTtcclxuXHJcbklJbWFnZUVsZW1lbnQucHJvdG90eXBlLmNyZWF0ZUVsZW1lbnRzID0gZnVuY3Rpb24oKXtcclxuXHJcbiAgICB2YXIgYXNzZXRQYXRoID0gdGhpcy5nbG9iYWxEYXRhLmdldEFzc2V0c1BhdGgodGhpcy5hc3NldERhdGEpO1xyXG5cclxuICAgIHRoaXMuX3BhcmVudC5jcmVhdGVFbGVtZW50cy5jYWxsKHRoaXMpO1xyXG5cclxuICAgIHRoaXMuaW5uZXJFbGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKHN2Z05TLCdpbWFnZScpO1xyXG4gICAgdGhpcy5pbm5lckVsZW0uc2V0QXR0cmlidXRlKCd3aWR0aCcsdGhpcy5hc3NldERhdGEudytcInB4XCIpO1xyXG4gICAgdGhpcy5pbm5lckVsZW0uc2V0QXR0cmlidXRlKCdoZWlnaHQnLHRoaXMuYXNzZXREYXRhLmgrXCJweFwiKTtcclxuICAgIHRoaXMuaW5uZXJFbGVtLnNldEF0dHJpYnV0ZSgncHJlc2VydmVBc3BlY3RSYXRpbycsJ3hNaWRZTWlkIHNsaWNlJyk7XHJcbiAgICB0aGlzLmlubmVyRWxlbS5zZXRBdHRyaWJ1dGVOUygnaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluaycsJ2hyZWYnLGFzc2V0UGF0aCk7XHJcbiAgICB0aGlzLm1hc2tlZEVsZW1lbnQgPSB0aGlzLmlubmVyRWxlbTtcclxuICAgIHRoaXMubGF5ZXJFbGVtZW50LmFwcGVuZENoaWxkKHRoaXMuaW5uZXJFbGVtKTtcclxuICAgIGlmKHRoaXMuZGF0YS5sbil7XHJcbiAgICAgICAgdGhpcy5sYXllckVsZW1lbnQuc2V0QXR0cmlidXRlKCdpZCcsdGhpcy5kYXRhLmxuKTtcclxuICAgIH1cclxuICAgIGlmKHRoaXMuZGF0YS5jbCl7XHJcbiAgICAgICAgdGhpcy5sYXllckVsZW1lbnQuc2V0QXR0cmlidXRlKCdjbGFzcycsdGhpcy5kYXRhLmNsKTtcclxuICAgIH1cclxuXHJcbn07XHJcblxyXG5JSW1hZ2VFbGVtZW50LnByb3RvdHlwZS5yZW5kZXJGcmFtZSA9IGZ1bmN0aW9uKHBhcmVudE1hdHJpeCl7XHJcbiAgICB2YXIgcmVuZGVyUGFyZW50ID0gdGhpcy5fcGFyZW50LnJlbmRlckZyYW1lLmNhbGwodGhpcyxwYXJlbnRNYXRyaXgpO1xyXG4gICAgaWYocmVuZGVyUGFyZW50PT09ZmFsc2Upe1xyXG4gICAgICAgIHRoaXMuaGlkZSgpO1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGlmKHRoaXMuaGlkZGVuKXtcclxuICAgICAgICB0aGlzLnNob3coKTtcclxuICAgIH1cclxuICAgIGlmKHRoaXMuZmlyc3RGcmFtZSl7XHJcbiAgICAgICAgdGhpcy5maXJzdEZyYW1lID0gZmFsc2U7XHJcbiAgICB9XHJcbn07XHJcblxyXG5JSW1hZ2VFbGVtZW50LnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24oKXtcclxuICAgIHRoaXMuX3BhcmVudC5kZXN0cm95LmNhbGwodGhpcy5fcGFyZW50KTtcclxuICAgIHRoaXMuaW5uZXJFbGVtID0gIG51bGw7XHJcbn07XG5mdW5jdGlvbiBJU29saWRFbGVtZW50KGRhdGEscGFyZW50Q29udGFpbmVyLGdsb2JhbERhdGEsY29tcCwgcGxhY2Vob2xkZXIpe1xyXG4gICAgdGhpcy5fcGFyZW50LmNvbnN0cnVjdG9yLmNhbGwodGhpcyxkYXRhLHBhcmVudENvbnRhaW5lcixnbG9iYWxEYXRhLGNvbXAsIHBsYWNlaG9sZGVyKTtcclxufVxyXG5jcmVhdGVFbGVtZW50KFNWR0Jhc2VFbGVtZW50LCBJU29saWRFbGVtZW50KTtcclxuXHJcbklTb2xpZEVsZW1lbnQucHJvdG90eXBlLmNyZWF0ZUVsZW1lbnRzID0gZnVuY3Rpb24oKXtcclxuICAgIHRoaXMuX3BhcmVudC5jcmVhdGVFbGVtZW50cy5jYWxsKHRoaXMpO1xyXG5cclxuICAgIHZhciByZWN0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKHN2Z05TLCdyZWN0Jyk7XHJcbiAgICAvLy8vcmVjdC5zdHlsZS53aWR0aCA9IHRoaXMuZGF0YS5zdztcclxuICAgIC8vLy9yZWN0LnN0eWxlLmhlaWdodCA9IHRoaXMuZGF0YS5zaDtcclxuICAgIC8vLy9yZWN0LnN0eWxlLmZpbGwgPSB0aGlzLmRhdGEuc2M7XHJcbiAgICByZWN0LnNldEF0dHJpYnV0ZSgnd2lkdGgnLHRoaXMuZGF0YS5zdyk7XHJcbiAgICByZWN0LnNldEF0dHJpYnV0ZSgnaGVpZ2h0Jyx0aGlzLmRhdGEuc2gpO1xyXG4gICAgcmVjdC5zZXRBdHRyaWJ1dGUoJ2ZpbGwnLHRoaXMuZGF0YS5zYyk7XHJcbiAgICB0aGlzLmxheWVyRWxlbWVudC5hcHBlbmRDaGlsZChyZWN0KTtcclxuICAgIHRoaXMuaW5uZXJFbGVtID0gcmVjdDtcclxuICAgIGlmKHRoaXMuZGF0YS5sbil7XHJcbiAgICAgICAgdGhpcy5sYXllckVsZW1lbnQuc2V0QXR0cmlidXRlKCdpZCcsdGhpcy5kYXRhLmxuKTtcclxuICAgIH1cclxuICAgIGlmKHRoaXMuZGF0YS5jbCl7XHJcbiAgICAgICAgdGhpcy5sYXllckVsZW1lbnQuc2V0QXR0cmlidXRlKCdjbGFzcycsdGhpcy5kYXRhLmNsKTtcclxuICAgIH1cclxufTtcclxuXHJcbklTb2xpZEVsZW1lbnQucHJvdG90eXBlLnJlbmRlckZyYW1lID0gSUltYWdlRWxlbWVudC5wcm90b3R5cGUucmVuZGVyRnJhbWU7XHJcbklTb2xpZEVsZW1lbnQucHJvdG90eXBlLmRlc3Ryb3kgPSBJSW1hZ2VFbGVtZW50LnByb3RvdHlwZS5kZXN0cm95O1xyXG5cbnZhciBhbmltYXRpb25NYW5hZ2VyID0gKGZ1bmN0aW9uKCl7XHJcbiAgICB2YXIgbW9kdWxlT2IgPSB7fTtcclxuICAgIHZhciByZWdpc3RlcmVkQW5pbWF0aW9ucyA9IFtdO1xyXG4gICAgdmFyIGluaXRUaW1lID0gMDtcclxuICAgIHZhciBsZW4gPSAwO1xyXG4gICAgdmFyIGlkbGVkID0gdHJ1ZTtcclxuICAgIHZhciBwbGF5aW5nQW5pbWF0aW9uc051bSA9IDA7XHJcblxyXG4gICAgZnVuY3Rpb24gcmVtb3ZlRWxlbWVudChldil7XHJcbiAgICAgICAgdmFyIGkgPSAwO1xyXG4gICAgICAgIHZhciBhbmltSXRlbSA9IGV2LnRhcmdldDtcclxuICAgICAgICB3aGlsZShpPGxlbikge1xyXG4gICAgICAgICAgICBpZiAocmVnaXN0ZXJlZEFuaW1hdGlvbnNbaV0uYW5pbWF0aW9uID09PSBhbmltSXRlbSkge1xyXG4gICAgICAgICAgICAgICAgcmVnaXN0ZXJlZEFuaW1hdGlvbnMuc3BsaWNlKGksIDEpO1xyXG4gICAgICAgICAgICAgICAgaSAtPSAxO1xyXG4gICAgICAgICAgICAgICAgbGVuIC09IDE7XHJcbiAgICAgICAgICAgICAgICBpZighYW5pbUl0ZW0uaXNQYXVzZWQpe1xyXG4gICAgICAgICAgICAgICAgICAgIHN1YnRyYWN0UGxheWluZ0NvdW50KCk7ICAgXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaSArPSAxO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiByZWdpc3RlckFuaW1hdGlvbihlbGVtZW50LCBhbmltYXRpb25EYXRhKXtcclxuICAgICAgICBpZighZWxlbWVudCl7XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgaT0wO1xyXG4gICAgICAgIHdoaWxlKGk8bGVuKXtcclxuICAgICAgICAgICAgaWYocmVnaXN0ZXJlZEFuaW1hdGlvbnNbaV0uZWxlbSA9PSBlbGVtZW50ICYmIHJlZ2lzdGVyZWRBbmltYXRpb25zW2ldLmVsZW0gIT09IG51bGwgKXtcclxuICAgICAgICAgICAgICAgIHJldHVybiByZWdpc3RlcmVkQW5pbWF0aW9uc1tpXS5hbmltYXRpb247XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaSs9MTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIGFuaW1JdGVtID0gbmV3IEFuaW1hdGlvbkl0ZW0oKTtcclxuICAgICAgICBzZXR1cEFuaW1hdGlvbihhbmltSXRlbSwgZWxlbWVudCk7XHJcbiAgICAgICAgYW5pbUl0ZW0uc2V0RGF0YShlbGVtZW50LCBhbmltYXRpb25EYXRhKTtcclxuICAgICAgICByZXR1cm4gYW5pbUl0ZW07XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gYWRkUGxheWluZ0NvdW50KCl7XHJcbiAgICAgICAgcGxheWluZ0FuaW1hdGlvbnNOdW0gKz0gMTtcclxuICAgICAgICBhY3RpdmF0ZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIHN1YnRyYWN0UGxheWluZ0NvdW50KCl7XHJcbiAgICAgICAgcGxheWluZ0FuaW1hdGlvbnNOdW0gLT0gMTtcclxuICAgICAgICBpZihwbGF5aW5nQW5pbWF0aW9uc051bSA9PT0gMCl7XHJcbiAgICAgICAgICAgIGlkbGVkID0gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gc2V0dXBBbmltYXRpb24oYW5pbUl0ZW0sIGVsZW1lbnQpe1xyXG4gICAgICAgIGFuaW1JdGVtLmFkZEV2ZW50TGlzdGVuZXIoJ2Rlc3Ryb3knLHJlbW92ZUVsZW1lbnQpO1xyXG4gICAgICAgIGFuaW1JdGVtLmFkZEV2ZW50TGlzdGVuZXIoJ19hY3RpdmUnLGFkZFBsYXlpbmdDb3VudCk7XHJcbiAgICAgICAgYW5pbUl0ZW0uYWRkRXZlbnRMaXN0ZW5lcignX2lkbGUnLHN1YnRyYWN0UGxheWluZ0NvdW50KTtcclxuICAgICAgICByZWdpc3RlcmVkQW5pbWF0aW9ucy5wdXNoKHtlbGVtOiBlbGVtZW50LGFuaW1hdGlvbjphbmltSXRlbX0pO1xyXG4gICAgICAgIGxlbiArPSAxO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIGxvYWRBbmltYXRpb24ocGFyYW1zKXtcclxuICAgICAgICB2YXIgYW5pbUl0ZW0gPSBuZXcgQW5pbWF0aW9uSXRlbSgpO1xyXG4gICAgICAgIHNldHVwQW5pbWF0aW9uKGFuaW1JdGVtLCBudWxsKTtcclxuICAgICAgICBhbmltSXRlbS5zZXRQYXJhbXMocGFyYW1zKTtcclxuICAgICAgICByZXR1cm4gYW5pbUl0ZW07XHJcbiAgICB9XHJcblxyXG5cclxuICAgIGZ1bmN0aW9uIHNldFNwZWVkKHZhbCxhbmltYXRpb24pe1xyXG4gICAgICAgIHZhciBpO1xyXG4gICAgICAgIGZvcihpPTA7aTxsZW47aSs9MSl7XHJcbiAgICAgICAgICAgIHJlZ2lzdGVyZWRBbmltYXRpb25zW2ldLmFuaW1hdGlvbi5zZXRTcGVlZCh2YWwsIGFuaW1hdGlvbik7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIHNldERpcmVjdGlvbih2YWwsIGFuaW1hdGlvbil7XHJcbiAgICAgICAgdmFyIGk7XHJcbiAgICAgICAgZm9yKGk9MDtpPGxlbjtpKz0xKXtcclxuICAgICAgICAgICAgcmVnaXN0ZXJlZEFuaW1hdGlvbnNbaV0uYW5pbWF0aW9uLnNldERpcmVjdGlvbih2YWwsIGFuaW1hdGlvbik7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIHBsYXkoYW5pbWF0aW9uKXtcclxuICAgICAgICB2YXIgaTtcclxuICAgICAgICBmb3IoaT0wO2k8bGVuO2krPTEpe1xyXG4gICAgICAgICAgICByZWdpc3RlcmVkQW5pbWF0aW9uc1tpXS5hbmltYXRpb24ucGxheShhbmltYXRpb24pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBtb3ZlRnJhbWUgKHZhbHVlLCBhbmltYXRpb24pIHtcclxuICAgICAgICBpbml0VGltZSA9IERhdGUubm93KCk7XHJcbiAgICAgICAgdmFyIGk7XHJcbiAgICAgICAgZm9yKGk9MDtpPGxlbjtpKz0xKXtcclxuICAgICAgICAgICAgcmVnaXN0ZXJlZEFuaW1hdGlvbnNbaV0uYW5pbWF0aW9uLm1vdmVGcmFtZSh2YWx1ZSxhbmltYXRpb24pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiByZXN1bWUobm93VGltZSkge1xyXG5cclxuICAgICAgICB2YXIgZWxhcHNlZFRpbWUgPSBub3dUaW1lIC0gaW5pdFRpbWU7XHJcbiAgICAgICAgdmFyIGk7XHJcbiAgICAgICAgZm9yKGk9MDtpPGxlbjtpKz0xKXtcclxuICAgICAgICAgICAgcmVnaXN0ZXJlZEFuaW1hdGlvbnNbaV0uYW5pbWF0aW9uLmFkdmFuY2VUaW1lKGVsYXBzZWRUaW1lKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaW5pdFRpbWUgPSBub3dUaW1lO1xyXG4gICAgICAgIGlmKCFpZGxlZCkge1xyXG4gICAgICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUocmVzdW1lKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gZmlyc3Qobm93VGltZSl7XHJcbiAgICAgICAgaW5pdFRpbWUgPSBub3dUaW1lO1xyXG4gICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShyZXN1bWUpO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIHBhdXNlKGFuaW1hdGlvbikge1xyXG4gICAgICAgIHZhciBpO1xyXG4gICAgICAgIGZvcihpPTA7aTxsZW47aSs9MSl7XHJcbiAgICAgICAgICAgIHJlZ2lzdGVyZWRBbmltYXRpb25zW2ldLmFuaW1hdGlvbi5wYXVzZShhbmltYXRpb24pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBnb1RvQW5kU3RvcCh2YWx1ZSxpc0ZyYW1lLGFuaW1hdGlvbikge1xyXG4gICAgICAgIHZhciBpO1xyXG4gICAgICAgIGZvcihpPTA7aTxsZW47aSs9MSl7XHJcbiAgICAgICAgICAgIHJlZ2lzdGVyZWRBbmltYXRpb25zW2ldLmFuaW1hdGlvbi5nb1RvQW5kU3RvcCh2YWx1ZSxpc0ZyYW1lLGFuaW1hdGlvbik7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIHN0b3AoYW5pbWF0aW9uKSB7XHJcbiAgICAgICAgdmFyIGk7XHJcbiAgICAgICAgZm9yKGk9MDtpPGxlbjtpKz0xKXtcclxuICAgICAgICAgICAgcmVnaXN0ZXJlZEFuaW1hdGlvbnNbaV0uYW5pbWF0aW9uLnN0b3AoYW5pbWF0aW9uKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gdG9nZ2xlUGF1c2UoYW5pbWF0aW9uKSB7XHJcbiAgICAgICAgdmFyIGk7XHJcbiAgICAgICAgZm9yKGk9MDtpPGxlbjtpKz0xKXtcclxuICAgICAgICAgICAgcmVnaXN0ZXJlZEFuaW1hdGlvbnNbaV0uYW5pbWF0aW9uLnRvZ2dsZVBhdXNlKGFuaW1hdGlvbik7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIGRlc3Ryb3koYW5pbWF0aW9uKSB7XHJcbiAgICAgICAgdmFyIGk7XHJcbiAgICAgICAgZm9yKGk9KGxlbi0xKTtpPj0wO2ktPTEpe1xyXG4gICAgICAgICAgICByZWdpc3RlcmVkQW5pbWF0aW9uc1tpXS5hbmltYXRpb24uZGVzdHJveShhbmltYXRpb24pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBzZWFyY2hBbmltYXRpb25zKGFuaW1hdGlvbkRhdGEsIHN0YW5kYWxvbmUsIHJlbmRlcmVyKXtcclxuICAgICAgICB2YXIgYW5pbUVsZW1lbnRzID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgnYm9keW1vdmluJyk7XHJcbiAgICAgICAgdmFyIGksIGxlbiA9IGFuaW1FbGVtZW50cy5sZW5ndGg7XHJcbiAgICAgICAgZm9yKGk9MDtpPGxlbjtpKz0xKXtcclxuICAgICAgICAgICAgaWYocmVuZGVyZXIpe1xyXG4gICAgICAgICAgICAgICAgYW5pbUVsZW1lbnRzW2ldLnNldEF0dHJpYnV0ZSgnZGF0YS1ibS10eXBlJyxyZW5kZXJlcik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmVnaXN0ZXJBbmltYXRpb24oYW5pbUVsZW1lbnRzW2ldLCBhbmltYXRpb25EYXRhKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYoc3RhbmRhbG9uZSAmJiBsZW4gPT09IDApe1xyXG4gICAgICAgICAgICBpZighcmVuZGVyZXIpe1xyXG4gICAgICAgICAgICAgICAgcmVuZGVyZXIgPSAnc3ZnJztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB2YXIgYm9keSA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdib2R5JylbMF07XHJcbiAgICAgICAgICAgIGJvZHkuaW5uZXJIVE1MID0gJyc7XHJcbiAgICAgICAgICAgIHZhciBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgICAgICAgICAgZGl2LnN0eWxlLndpZHRoID0gJzEwMCUnO1xyXG4gICAgICAgICAgICBkaXYuc3R5bGUuaGVpZ2h0ID0gJzEwMCUnO1xyXG4gICAgICAgICAgICBkaXYuc2V0QXR0cmlidXRlKCdkYXRhLWJtLXR5cGUnLHJlbmRlcmVyKTtcclxuICAgICAgICAgICAgYm9keS5hcHBlbmRDaGlsZChkaXYpO1xyXG4gICAgICAgICAgICByZWdpc3RlckFuaW1hdGlvbihkaXYsIGFuaW1hdGlvbkRhdGEpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiByZXNpemUoKXtcclxuICAgICAgICB2YXIgaTtcclxuICAgICAgICBmb3IoaT0wO2k8bGVuO2krPTEpe1xyXG4gICAgICAgICAgICByZWdpc3RlcmVkQW5pbWF0aW9uc1tpXS5hbmltYXRpb24ucmVzaXplKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIHN0YXJ0KCl7XHJcbiAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGZpcnN0KTtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBhY3RpdmF0ZSgpe1xyXG4gICAgICAgIGlmKGlkbGVkKXtcclxuICAgICAgICAgICAgaWRsZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGZpcnN0KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy9zdGFydCgpO1xyXG5cclxuICAgIHNldFRpbWVvdXQoc3RhcnQsMCk7XHJcblxyXG4gICAgbW9kdWxlT2IucmVnaXN0ZXJBbmltYXRpb24gPSByZWdpc3RlckFuaW1hdGlvbjtcclxuICAgIG1vZHVsZU9iLmxvYWRBbmltYXRpb24gPSBsb2FkQW5pbWF0aW9uO1xyXG4gICAgbW9kdWxlT2Iuc2V0U3BlZWQgPSBzZXRTcGVlZDtcclxuICAgIG1vZHVsZU9iLnNldERpcmVjdGlvbiA9IHNldERpcmVjdGlvbjtcclxuICAgIG1vZHVsZU9iLnBsYXkgPSBwbGF5O1xyXG4gICAgbW9kdWxlT2IubW92ZUZyYW1lID0gbW92ZUZyYW1lO1xyXG4gICAgbW9kdWxlT2IucGF1c2UgPSBwYXVzZTtcclxuICAgIG1vZHVsZU9iLnN0b3AgPSBzdG9wO1xyXG4gICAgbW9kdWxlT2IudG9nZ2xlUGF1c2UgPSB0b2dnbGVQYXVzZTtcclxuICAgIG1vZHVsZU9iLnNlYXJjaEFuaW1hdGlvbnMgPSBzZWFyY2hBbmltYXRpb25zO1xyXG4gICAgbW9kdWxlT2IucmVzaXplID0gcmVzaXplO1xyXG4gICAgbW9kdWxlT2Iuc3RhcnQgPSBzdGFydDtcclxuICAgIG1vZHVsZU9iLmdvVG9BbmRTdG9wID0gZ29Ub0FuZFN0b3A7XHJcbiAgICBtb2R1bGVPYi5kZXN0cm95ID0gZGVzdHJveTtcclxuICAgIHJldHVybiBtb2R1bGVPYjtcclxufSgpKTtcbnZhciBBbmltYXRpb25JdGVtID0gZnVuY3Rpb24gKCkge1xyXG4gICAgdGhpcy5fY2JzID0gW107XHJcbiAgICB0aGlzLm5hbWUgPSAnJztcclxuICAgIHRoaXMucGF0aCA9ICcnO1xyXG4gICAgdGhpcy5pc0xvYWRlZCA9IGZhbHNlO1xyXG4gICAgdGhpcy5jdXJyZW50RnJhbWUgPSAwO1xyXG4gICAgdGhpcy5jdXJyZW50UmF3RnJhbWUgPSAwO1xyXG4gICAgdGhpcy50b3RhbEZyYW1lcyA9IDA7XHJcbiAgICB0aGlzLmZyYW1lUmF0ZSA9IDA7XHJcbiAgICB0aGlzLmZyYW1lTXVsdCA9IDA7XHJcbiAgICB0aGlzLnBsYXlTcGVlZCA9IDE7XHJcbiAgICB0aGlzLnBsYXlEaXJlY3Rpb24gPSAxO1xyXG4gICAgdGhpcy5wZW5kaW5nRWxlbWVudHMgPSAwO1xyXG4gICAgdGhpcy5wbGF5Q291bnQgPSAwO1xyXG4gICAgdGhpcy5wcmVyZW5kZXJGcmFtZXNGbGFnID0gdHJ1ZTtcclxuICAgIHRoaXMuYW5pbWF0aW9uRGF0YSA9IHt9O1xyXG4gICAgdGhpcy5sYXllcnMgPSBbXTtcclxuICAgIHRoaXMuYXNzZXRzID0gW107XHJcbiAgICB0aGlzLmlzUGF1c2VkID0gdHJ1ZTtcclxuICAgIHRoaXMuYXV0b3BsYXkgPSBmYWxzZTtcclxuICAgIHRoaXMubG9vcCA9IHRydWU7XHJcbiAgICB0aGlzLnJlbmRlcmVyID0gbnVsbDtcclxuICAgIHRoaXMuYW5pbWF0aW9uSUQgPSByYW5kb21TdHJpbmcoMTApO1xyXG4gICAgdGhpcy5zY2FsZU1vZGUgPSAnZml0JztcclxuICAgIHRoaXMuYXNzZXRzUGF0aCA9ICcnO1xyXG4gICAgdGhpcy50aW1lQ29tcGxldGVkID0gMDtcclxuICAgIHRoaXMuc2VnbWVudFBvcyA9IDA7XHJcbiAgICB0aGlzLnN1YmZyYW1lRW5hYmxlZCA9IHN1YmZyYW1lRW5hYmxlZDtcclxuICAgIHRoaXMuc2VnbWVudHMgPSBbXTtcclxuICAgIHRoaXMucGVuZGluZ1NlZ21lbnQgPSBmYWxzZTtcclxuICAgIHRoaXMuX2lkbGUgPSB0cnVlO1xyXG4gICAgdGhpcy5wcm9qZWN0SW50ZXJmYWNlID0gUHJvamVjdEludGVyZmFjZSgpO1xyXG59O1xyXG5cclxuQW5pbWF0aW9uSXRlbS5wcm90b3R5cGUuc2V0UGFyYW1zID0gZnVuY3Rpb24ocGFyYW1zKSB7XHJcbiAgICB2YXIgc2VsZiA9IHRoaXM7XHJcbiAgICBpZihwYXJhbXMuY29udGV4dCl7XHJcbiAgICAgICAgdGhpcy5jb250ZXh0ID0gcGFyYW1zLmNvbnRleHQ7XHJcbiAgICB9XHJcbiAgICBpZihwYXJhbXMud3JhcHBlciB8fCBwYXJhbXMuY29udGFpbmVyKXtcclxuICAgICAgICB0aGlzLndyYXBwZXIgPSBwYXJhbXMud3JhcHBlciB8fCBwYXJhbXMuY29udGFpbmVyO1xyXG4gICAgfVxyXG4gICAgdmFyIGFuaW1UeXBlID0gcGFyYW1zLmFuaW1UeXBlID8gcGFyYW1zLmFuaW1UeXBlIDogcGFyYW1zLnJlbmRlcmVyID8gcGFyYW1zLnJlbmRlcmVyIDogJ3N2Zyc7XHJcbiAgICBzd2l0Y2goYW5pbVR5cGUpe1xyXG4gICAgICAgIGNhc2UgJ2NhbnZhcyc6XHJcbiAgICAgICAgICAgIHRoaXMucmVuZGVyZXIgPSBuZXcgQ2FudmFzUmVuZGVyZXIodGhpcywgcGFyYW1zLnJlbmRlcmVyU2V0dGluZ3MpO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlICdzdmcnOlxyXG4gICAgICAgICAgICB0aGlzLnJlbmRlcmVyID0gbmV3IFNWR1JlbmRlcmVyKHRoaXMsIHBhcmFtcy5yZW5kZXJlclNldHRpbmdzKTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAnaHlicmlkJzpcclxuICAgICAgICBjYXNlICdodG1sJzpcclxuICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICB0aGlzLnJlbmRlcmVyID0gbmV3IEh5YnJpZFJlbmRlcmVyKHRoaXMsIHBhcmFtcy5yZW5kZXJlclNldHRpbmdzKTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICB9XHJcbiAgICB0aGlzLnJlbmRlcmVyLnNldFByb2plY3RJbnRlcmZhY2UodGhpcy5wcm9qZWN0SW50ZXJmYWNlKTtcclxuICAgIHRoaXMuYW5pbVR5cGUgPSBhbmltVHlwZTtcclxuXHJcbiAgICBpZihwYXJhbXMubG9vcCA9PT0gJycgfHwgcGFyYW1zLmxvb3AgPT09IG51bGwpe1xyXG4gICAgfWVsc2UgaWYocGFyYW1zLmxvb3AgPT09IGZhbHNlKXtcclxuICAgICAgICB0aGlzLmxvb3AgPSBmYWxzZTtcclxuICAgIH1lbHNlIGlmKHBhcmFtcy5sb29wID09PSB0cnVlKXtcclxuICAgICAgICB0aGlzLmxvb3AgPSB0cnVlO1xyXG4gICAgfWVsc2V7XHJcbiAgICAgICAgdGhpcy5sb29wID0gcGFyc2VJbnQocGFyYW1zLmxvb3ApO1xyXG4gICAgfVxyXG4gICAgdGhpcy5hdXRvcGxheSA9ICdhdXRvcGxheScgaW4gcGFyYW1zID8gcGFyYW1zLmF1dG9wbGF5IDogdHJ1ZTtcclxuICAgIHRoaXMubmFtZSA9IHBhcmFtcy5uYW1lID8gcGFyYW1zLm5hbWUgOiAgJyc7XHJcbiAgICB0aGlzLnByZXJlbmRlckZyYW1lc0ZsYWcgPSAncHJlcmVuZGVyJyBpbiBwYXJhbXMgPyBwYXJhbXMucHJlcmVuZGVyIDogdHJ1ZTtcclxuICAgIHRoaXMuYXV0b2xvYWRTZWdtZW50cyA9IHBhcmFtcy5oYXNPd25Qcm9wZXJ0eSgnYXV0b2xvYWRTZWdtZW50cycpID8gcGFyYW1zLmF1dG9sb2FkU2VnbWVudHMgOiAgdHJ1ZTtcclxuICAgIGlmKHBhcmFtcy5hbmltYXRpb25EYXRhKXtcclxuICAgICAgICBzZWxmLmNvbmZpZ0FuaW1hdGlvbihwYXJhbXMuYW5pbWF0aW9uRGF0YSk7XHJcbiAgICB9ZWxzZSBpZihwYXJhbXMucGF0aCl7XHJcbiAgICAgICAgaWYocGFyYW1zLnBhdGguc3Vic3RyKC00KSAhPSAnanNvbicpe1xyXG4gICAgICAgICAgICBpZiAocGFyYW1zLnBhdGguc3Vic3RyKC0xLCAxKSAhPSAnLycpIHtcclxuICAgICAgICAgICAgICAgIHBhcmFtcy5wYXRoICs9ICcvJztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBwYXJhbXMucGF0aCArPSAnZGF0YS5qc29uJztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZhciB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcclxuICAgICAgICBpZihwYXJhbXMucGF0aC5sYXN0SW5kZXhPZignXFxcXCcpICE9IC0xKXtcclxuICAgICAgICAgICAgdGhpcy5wYXRoID0gcGFyYW1zLnBhdGguc3Vic3RyKDAscGFyYW1zLnBhdGgubGFzdEluZGV4T2YoJ1xcXFwnKSsxKTtcclxuICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgdGhpcy5wYXRoID0gcGFyYW1zLnBhdGguc3Vic3RyKDAscGFyYW1zLnBhdGgubGFzdEluZGV4T2YoJy8nKSsxKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5hc3NldHNQYXRoID0gcGFyYW1zLmFzc2V0c1BhdGg7XHJcbiAgICAgICAgdGhpcy5maWxlTmFtZSA9IHBhcmFtcy5wYXRoLnN1YnN0cihwYXJhbXMucGF0aC5sYXN0SW5kZXhPZignLycpKzEpO1xyXG4gICAgICAgIHRoaXMuZmlsZU5hbWUgPSB0aGlzLmZpbGVOYW1lLnN1YnN0cigwLHRoaXMuZmlsZU5hbWUubGFzdEluZGV4T2YoJy5qc29uJykpO1xyXG4gICAgICAgIHhoci5vcGVuKCdHRVQnLCBwYXJhbXMucGF0aCwgdHJ1ZSk7XHJcbiAgICAgICAgeGhyLnNlbmQoKTtcclxuICAgICAgICB4aHIub25yZWFkeXN0YXRlY2hhbmdlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBpZiAoeGhyLnJlYWR5U3RhdGUgPT0gNCkge1xyXG4gICAgICAgICAgICAgICAgaWYoeGhyLnN0YXR1cyA9PSAyMDApe1xyXG4gICAgICAgICAgICAgICAgICAgIHNlbGYuY29uZmlnQW5pbWF0aW9uKEpTT04ucGFyc2UoeGhyLnJlc3BvbnNlVGV4dCkpO1xyXG4gICAgICAgICAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgICAgICAgICAgdHJ5e1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmVzcG9uc2UgPSBKU09OLnBhcnNlKHhoci5yZXNwb25zZVRleHQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmNvbmZpZ0FuaW1hdGlvbihyZXNwb25zZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfWNhdGNoKGVycil7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgIH1cclxufTtcclxuXHJcbkFuaW1hdGlvbkl0ZW0ucHJvdG90eXBlLnNldERhdGEgPSBmdW5jdGlvbiAod3JhcHBlciwgYW5pbWF0aW9uRGF0YSkge1xyXG4gICAgdmFyIHBhcmFtcyA9IHtcclxuICAgICAgICB3cmFwcGVyOiB3cmFwcGVyLFxyXG4gICAgICAgIGFuaW1hdGlvbkRhdGE6IGFuaW1hdGlvbkRhdGEgPyAodHlwZW9mIGFuaW1hdGlvbkRhdGEgID09PSBcIm9iamVjdFwiKSA/IGFuaW1hdGlvbkRhdGEgOiBKU09OLnBhcnNlKGFuaW1hdGlvbkRhdGEpIDogbnVsbFxyXG4gICAgfTtcclxuICAgIHZhciB3cmFwcGVyQXR0cmlidXRlcyA9IHdyYXBwZXIuYXR0cmlidXRlcztcclxuXHJcbiAgICBwYXJhbXMucGF0aCA9IHdyYXBwZXJBdHRyaWJ1dGVzLmdldE5hbWVkSXRlbSgnZGF0YS1hbmltYXRpb24tcGF0aCcpID8gd3JhcHBlckF0dHJpYnV0ZXMuZ2V0TmFtZWRJdGVtKCdkYXRhLWFuaW1hdGlvbi1wYXRoJykudmFsdWUgOiB3cmFwcGVyQXR0cmlidXRlcy5nZXROYW1lZEl0ZW0oJ2RhdGEtYm0tcGF0aCcpID8gd3JhcHBlckF0dHJpYnV0ZXMuZ2V0TmFtZWRJdGVtKCdkYXRhLWJtLXBhdGgnKS52YWx1ZSA6ICB3cmFwcGVyQXR0cmlidXRlcy5nZXROYW1lZEl0ZW0oJ2JtLXBhdGgnKSA/IHdyYXBwZXJBdHRyaWJ1dGVzLmdldE5hbWVkSXRlbSgnYm0tcGF0aCcpLnZhbHVlIDogJyc7XHJcbiAgICBwYXJhbXMuYW5pbVR5cGUgPSB3cmFwcGVyQXR0cmlidXRlcy5nZXROYW1lZEl0ZW0oJ2RhdGEtYW5pbS10eXBlJykgPyB3cmFwcGVyQXR0cmlidXRlcy5nZXROYW1lZEl0ZW0oJ2RhdGEtYW5pbS10eXBlJykudmFsdWUgOiB3cmFwcGVyQXR0cmlidXRlcy5nZXROYW1lZEl0ZW0oJ2RhdGEtYm0tdHlwZScpID8gd3JhcHBlckF0dHJpYnV0ZXMuZ2V0TmFtZWRJdGVtKCdkYXRhLWJtLXR5cGUnKS52YWx1ZSA6IHdyYXBwZXJBdHRyaWJ1dGVzLmdldE5hbWVkSXRlbSgnYm0tdHlwZScpID8gd3JhcHBlckF0dHJpYnV0ZXMuZ2V0TmFtZWRJdGVtKCdibS10eXBlJykudmFsdWUgOiAgd3JhcHBlckF0dHJpYnV0ZXMuZ2V0TmFtZWRJdGVtKCdkYXRhLWJtLXJlbmRlcmVyJykgPyB3cmFwcGVyQXR0cmlidXRlcy5nZXROYW1lZEl0ZW0oJ2RhdGEtYm0tcmVuZGVyZXInKS52YWx1ZSA6IHdyYXBwZXJBdHRyaWJ1dGVzLmdldE5hbWVkSXRlbSgnYm0tcmVuZGVyZXInKSA/IHdyYXBwZXJBdHRyaWJ1dGVzLmdldE5hbWVkSXRlbSgnYm0tcmVuZGVyZXInKS52YWx1ZSA6ICdjYW52YXMnO1xyXG5cclxuICAgIHZhciBsb29wID0gd3JhcHBlckF0dHJpYnV0ZXMuZ2V0TmFtZWRJdGVtKCdkYXRhLWFuaW0tbG9vcCcpID8gd3JhcHBlckF0dHJpYnV0ZXMuZ2V0TmFtZWRJdGVtKCdkYXRhLWFuaW0tbG9vcCcpLnZhbHVlIDogIHdyYXBwZXJBdHRyaWJ1dGVzLmdldE5hbWVkSXRlbSgnZGF0YS1ibS1sb29wJykgPyB3cmFwcGVyQXR0cmlidXRlcy5nZXROYW1lZEl0ZW0oJ2RhdGEtYm0tbG9vcCcpLnZhbHVlIDogIHdyYXBwZXJBdHRyaWJ1dGVzLmdldE5hbWVkSXRlbSgnYm0tbG9vcCcpID8gd3JhcHBlckF0dHJpYnV0ZXMuZ2V0TmFtZWRJdGVtKCdibS1sb29wJykudmFsdWUgOiAnJztcclxuICAgIGlmKGxvb3AgPT09ICcnKXtcclxuICAgIH1lbHNlIGlmKGxvb3AgPT09ICdmYWxzZScpe1xyXG4gICAgICAgIHBhcmFtcy5sb29wID0gZmFsc2U7XHJcbiAgICB9ZWxzZSBpZihsb29wID09PSAndHJ1ZScpe1xyXG4gICAgICAgIHBhcmFtcy5sb29wID0gdHJ1ZTtcclxuICAgIH1lbHNle1xyXG4gICAgICAgIHBhcmFtcy5sb29wID0gcGFyc2VJbnQobG9vcCk7XHJcbiAgICB9XHJcbiAgICB2YXIgYXV0b3BsYXkgPSB3cmFwcGVyQXR0cmlidXRlcy5nZXROYW1lZEl0ZW0oJ2RhdGEtYW5pbS1hdXRvcGxheScpID8gd3JhcHBlckF0dHJpYnV0ZXMuZ2V0TmFtZWRJdGVtKCdkYXRhLWFuaW0tYXV0b3BsYXknKS52YWx1ZSA6ICB3cmFwcGVyQXR0cmlidXRlcy5nZXROYW1lZEl0ZW0oJ2RhdGEtYm0tYXV0b3BsYXknKSA/IHdyYXBwZXJBdHRyaWJ1dGVzLmdldE5hbWVkSXRlbSgnZGF0YS1ibS1hdXRvcGxheScpLnZhbHVlIDogIHdyYXBwZXJBdHRyaWJ1dGVzLmdldE5hbWVkSXRlbSgnYm0tYXV0b3BsYXknKSA/IHdyYXBwZXJBdHRyaWJ1dGVzLmdldE5hbWVkSXRlbSgnYm0tYXV0b3BsYXknKS52YWx1ZSA6IHRydWU7XHJcbiAgICBwYXJhbXMuYXV0b3BsYXkgPSBhdXRvcGxheSAhPT0gXCJmYWxzZVwiO1xyXG5cclxuICAgIHBhcmFtcy5uYW1lID0gd3JhcHBlckF0dHJpYnV0ZXMuZ2V0TmFtZWRJdGVtKCdkYXRhLW5hbWUnKSA/IHdyYXBwZXJBdHRyaWJ1dGVzLmdldE5hbWVkSXRlbSgnZGF0YS1uYW1lJykudmFsdWUgOiAgd3JhcHBlckF0dHJpYnV0ZXMuZ2V0TmFtZWRJdGVtKCdkYXRhLWJtLW5hbWUnKSA/IHdyYXBwZXJBdHRyaWJ1dGVzLmdldE5hbWVkSXRlbSgnZGF0YS1ibS1uYW1lJykudmFsdWUgOiB3cmFwcGVyQXR0cmlidXRlcy5nZXROYW1lZEl0ZW0oJ2JtLW5hbWUnKSA/IHdyYXBwZXJBdHRyaWJ1dGVzLmdldE5hbWVkSXRlbSgnYm0tbmFtZScpLnZhbHVlIDogICcnO1xyXG4gICAgdmFyIHByZXJlbmRlciA9IHdyYXBwZXJBdHRyaWJ1dGVzLmdldE5hbWVkSXRlbSgnZGF0YS1hbmltLXByZXJlbmRlcicpID8gd3JhcHBlckF0dHJpYnV0ZXMuZ2V0TmFtZWRJdGVtKCdkYXRhLWFuaW0tcHJlcmVuZGVyJykudmFsdWUgOiAgd3JhcHBlckF0dHJpYnV0ZXMuZ2V0TmFtZWRJdGVtKCdkYXRhLWJtLXByZXJlbmRlcicpID8gd3JhcHBlckF0dHJpYnV0ZXMuZ2V0TmFtZWRJdGVtKCdkYXRhLWJtLXByZXJlbmRlcicpLnZhbHVlIDogIHdyYXBwZXJBdHRyaWJ1dGVzLmdldE5hbWVkSXRlbSgnYm0tcHJlcmVuZGVyJykgPyB3cmFwcGVyQXR0cmlidXRlcy5nZXROYW1lZEl0ZW0oJ2JtLXByZXJlbmRlcicpLnZhbHVlIDogJyc7XHJcblxyXG4gICAgaWYocHJlcmVuZGVyID09PSAnZmFsc2UnKXtcclxuICAgICAgICBwYXJhbXMucHJlcmVuZGVyID0gZmFsc2U7XHJcbiAgICB9XHJcbiAgICBjb25zb2xlLmxvZygnYW5pbUVsZW1lbnRzOicsIHBhcmFtcylcclxuICAgIHRoaXMuc2V0UGFyYW1zKHBhcmFtcyk7XHJcbn07XHJcblxyXG5BbmltYXRpb25JdGVtLnByb3RvdHlwZS5pbmNsdWRlTGF5ZXJzID0gZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgaWYoZGF0YS5vcCA+IHRoaXMuYW5pbWF0aW9uRGF0YS5vcCl7XHJcbiAgICAgICAgdGhpcy5hbmltYXRpb25EYXRhLm9wID0gZGF0YS5vcDtcclxuICAgICAgICB0aGlzLnRvdGFsRnJhbWVzID0gTWF0aC5mbG9vcihkYXRhLm9wIC0gdGhpcy5hbmltYXRpb25EYXRhLmlwKTtcclxuICAgICAgICB0aGlzLmFuaW1hdGlvbkRhdGEudGYgPSB0aGlzLnRvdGFsRnJhbWVzO1xyXG4gICAgfVxyXG4gICAgdmFyIGxheWVycyA9IHRoaXMuYW5pbWF0aW9uRGF0YS5sYXllcnM7XHJcbiAgICB2YXIgaSwgbGVuID0gbGF5ZXJzLmxlbmd0aDtcclxuICAgIHZhciBuZXdMYXllcnMgPSBkYXRhLmxheWVycztcclxuICAgIHZhciBqLCBqTGVuID0gbmV3TGF5ZXJzLmxlbmd0aDtcclxuICAgIGZvcihqPTA7ajxqTGVuO2orPTEpe1xyXG4gICAgICAgIGkgPSAwO1xyXG4gICAgICAgIHdoaWxlKGk8bGVuKXtcclxuICAgICAgICAgICAgaWYobGF5ZXJzW2ldLmlkID09IG5ld0xheWVyc1tqXS5pZCl7XHJcbiAgICAgICAgICAgICAgICBsYXllcnNbaV0gPSBuZXdMYXllcnNbal07XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpICs9IDE7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgaWYoZGF0YS5jaGFycyB8fCBkYXRhLmZvbnRzKXtcclxuICAgICAgICB0aGlzLnJlbmRlcmVyLmdsb2JhbERhdGEuZm9udE1hbmFnZXIuYWRkQ2hhcnMoZGF0YS5jaGFycyk7XHJcbiAgICAgICAgdGhpcy5yZW5kZXJlci5nbG9iYWxEYXRhLmZvbnRNYW5hZ2VyLmFkZEZvbnRzKGRhdGEuZm9udHMsIHRoaXMucmVuZGVyZXIuZ2xvYmFsRGF0YS5kZWZzKTtcclxuICAgIH1cclxuICAgIGlmKGRhdGEuYXNzZXRzKXtcclxuICAgICAgICBsZW4gPSBkYXRhLmFzc2V0cy5sZW5ndGg7XHJcbiAgICAgICAgZm9yKGkgPSAwOyBpIDwgbGVuOyBpICs9IDEpe1xyXG4gICAgICAgICAgICB0aGlzLmFuaW1hdGlvbkRhdGEuYXNzZXRzLnB1c2goZGF0YS5hc3NldHNbaV0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIC8vdGhpcy50b3RhbEZyYW1lcyA9IDUwO1xyXG4gICAgLy90aGlzLmFuaW1hdGlvbkRhdGEudGYgPSA1MDtcclxuICAgIHRoaXMuYW5pbWF0aW9uRGF0YS5fX2NvbXBsZXRlID0gZmFsc2U7XHJcbiAgICBkYXRhTWFuYWdlci5jb21wbGV0ZURhdGEodGhpcy5hbmltYXRpb25EYXRhLHRoaXMucmVuZGVyZXIuZ2xvYmFsRGF0YS5mb250TWFuYWdlcik7XHJcbiAgICB0aGlzLnJlbmRlcmVyLmluY2x1ZGVMYXllcnMoZGF0YS5sYXllcnMpO1xyXG4gICAgaWYoZXhwcmVzc2lvbnNQbHVnaW4pe1xyXG4gICAgICAgIGV4cHJlc3Npb25zUGx1Z2luLmluaXRFeHByZXNzaW9ucyh0aGlzKTtcclxuICAgIH1cclxuICAgIHRoaXMucmVuZGVyZXIucmVuZGVyRnJhbWUobnVsbCk7XHJcbiAgICB0aGlzLmxvYWROZXh0U2VnbWVudCgpO1xyXG59O1xyXG5cclxuQW5pbWF0aW9uSXRlbS5wcm90b3R5cGUubG9hZE5leHRTZWdtZW50ID0gZnVuY3Rpb24oKSB7XHJcbiAgICB2YXIgc2VnbWVudHMgPSB0aGlzLmFuaW1hdGlvbkRhdGEuc2VnbWVudHM7XHJcbiAgICBpZighc2VnbWVudHMgfHwgc2VnbWVudHMubGVuZ3RoID09PSAwIHx8ICF0aGlzLmF1dG9sb2FkU2VnbWVudHMpe1xyXG4gICAgICAgIHRoaXMudHJpZ2dlcignZGF0YV9yZWFkeScpO1xyXG4gICAgICAgIHRoaXMudGltZUNvbXBsZXRlZCA9IHRoaXMuYW5pbWF0aW9uRGF0YS50ZjtcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICB2YXIgc2VnbWVudCA9IHNlZ21lbnRzLnNoaWZ0KCk7XHJcbiAgICB0aGlzLnRpbWVDb21wbGV0ZWQgPSBzZWdtZW50LnRpbWUgKiB0aGlzLmZyYW1lUmF0ZTtcclxuICAgIHZhciB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcclxuICAgIHZhciBzZWxmID0gdGhpcztcclxuICAgIHZhciBzZWdtZW50UGF0aCA9IHRoaXMucGF0aCt0aGlzLmZpbGVOYW1lKydfJyArIHRoaXMuc2VnbWVudFBvcyArICcuanNvbic7XHJcbiAgICB0aGlzLnNlZ21lbnRQb3MgKz0gMTtcclxuICAgIHhoci5vcGVuKCdHRVQnLCBzZWdtZW50UGF0aCwgdHJ1ZSk7XHJcbiAgICB4aHIuc2VuZCgpO1xyXG4gICAgeGhyLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBpZiAoeGhyLnJlYWR5U3RhdGUgPT0gNCkge1xyXG4gICAgICAgICAgICBpZih4aHIuc3RhdHVzID09IDIwMCl7XHJcbiAgICAgICAgICAgICAgICBzZWxmLmluY2x1ZGVMYXllcnMoSlNPTi5wYXJzZSh4aHIucmVzcG9uc2VUZXh0KSk7XHJcbiAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgdHJ5e1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciByZXNwb25zZSA9IEpTT04ucGFyc2UoeGhyLnJlc3BvbnNlVGV4dCk7XHJcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5pbmNsdWRlTGF5ZXJzKHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgICAgIH1jYXRjaChlcnIpe1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxufTtcclxuXHJcbkFuaW1hdGlvbkl0ZW0ucHJvdG90eXBlLmxvYWRTZWdtZW50cyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgdmFyIHNlZ21lbnRzID0gdGhpcy5hbmltYXRpb25EYXRhLnNlZ21lbnRzO1xyXG4gICAgaWYoIXNlZ21lbnRzKSB7XHJcbiAgICAgICAgdGhpcy50aW1lQ29tcGxldGVkID0gdGhpcy5hbmltYXRpb25EYXRhLnRmO1xyXG4gICAgfVxyXG4gICAgdGhpcy5sb2FkTmV4dFNlZ21lbnQoKTtcclxufTtcclxuXHJcbkFuaW1hdGlvbkl0ZW0ucHJvdG90eXBlLmNvbmZpZ0FuaW1hdGlvbiA9IGZ1bmN0aW9uIChhbmltRGF0YSkge1xyXG4gICAgaWYodGhpcy5yZW5kZXJlciAmJiB0aGlzLnJlbmRlcmVyLmRlc3Ryb3llZCl7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgLy9jb25zb2xlLmxvZyhKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGFuaW1EYXRhKSkpO1xyXG4gICAgLy9hbmltRGF0YS53ID0gTWF0aC5yb3VuZChhbmltRGF0YS53L2JsaXR0ZXIpO1xyXG4gICAgLy9hbmltRGF0YS5oID0gTWF0aC5yb3VuZChhbmltRGF0YS5oL2JsaXR0ZXIpO1xyXG4gICAgdGhpcy5hbmltYXRpb25EYXRhID0gYW5pbURhdGE7XHJcbiAgICB0aGlzLnRvdGFsRnJhbWVzID0gTWF0aC5mbG9vcih0aGlzLmFuaW1hdGlvbkRhdGEub3AgLSB0aGlzLmFuaW1hdGlvbkRhdGEuaXApO1xyXG4gICAgdGhpcy5hbmltYXRpb25EYXRhLnRmID0gdGhpcy50b3RhbEZyYW1lcztcclxuICAgIHRoaXMucmVuZGVyZXIuY29uZmlnQW5pbWF0aW9uKGFuaW1EYXRhKTtcclxuICAgIGlmKCFhbmltRGF0YS5hc3NldHMpe1xyXG4gICAgICAgIGFuaW1EYXRhLmFzc2V0cyA9IFtdO1xyXG4gICAgfVxyXG4gICAgaWYoYW5pbURhdGEuY29tcHMpIHtcclxuICAgICAgICBhbmltRGF0YS5hc3NldHMgPSBhbmltRGF0YS5hc3NldHMuY29uY2F0KGFuaW1EYXRhLmNvbXBzKTtcclxuICAgICAgICBhbmltRGF0YS5jb21wcyA9IG51bGw7XHJcbiAgICB9XHJcbiAgICB0aGlzLnJlbmRlcmVyLnNlYXJjaEV4dHJhQ29tcG9zaXRpb25zKGFuaW1EYXRhLmFzc2V0cyk7XHJcblxyXG4gICAgdGhpcy5sYXllcnMgPSB0aGlzLmFuaW1hdGlvbkRhdGEubGF5ZXJzO1xyXG4gICAgdGhpcy5hc3NldHMgPSB0aGlzLmFuaW1hdGlvbkRhdGEuYXNzZXRzO1xyXG4gICAgdGhpcy5mcmFtZVJhdGUgPSB0aGlzLmFuaW1hdGlvbkRhdGEuZnI7XHJcbiAgICB0aGlzLmZpcnN0RnJhbWUgPSBNYXRoLnJvdW5kKHRoaXMuYW5pbWF0aW9uRGF0YS5pcCk7XHJcbiAgICB0aGlzLmZyYW1lTXVsdCA9IHRoaXMuYW5pbWF0aW9uRGF0YS5mciAvIDEwMDA7XHJcbiAgICB0aGlzLnRyaWdnZXIoJ2NvbmZpZ19yZWFkeScpO1xyXG4gICAgdGhpcy5pbWFnZVByZWxvYWRlciA9IG5ldyBJbWFnZVByZWxvYWRlcigpO1xyXG4gICAgdGhpcy5pbWFnZVByZWxvYWRlci5zZXRBc3NldHNQYXRoKHRoaXMuYXNzZXRzUGF0aCk7XHJcbiAgICB0aGlzLmltYWdlUHJlbG9hZGVyLnNldFBhdGgodGhpcy5wYXRoKTtcclxuICAgIHRoaXMuaW1hZ2VQcmVsb2FkZXIubG9hZEFzc2V0cyhhbmltRGF0YS5hc3NldHMpO1xyXG4gICAgdGhpcy5sb2FkU2VnbWVudHMoKTtcclxuICAgIHRoaXMudXBkYUZyYW1lTW9kaWZpZXIoKTtcclxuICAgIGlmKHRoaXMucmVuZGVyZXIuZ2xvYmFsRGF0YS5mb250TWFuYWdlcil7XHJcbiAgICAgICAgdGhpcy53YWl0Rm9yRm9udHNMb2FkZWQoKTtcclxuICAgIH1lbHNle1xyXG4gICAgICAgIGRhdGFNYW5hZ2VyLmNvbXBsZXRlRGF0YSh0aGlzLmFuaW1hdGlvbkRhdGEsdGhpcy5yZW5kZXJlci5nbG9iYWxEYXRhLmZvbnRNYW5hZ2VyKTtcclxuICAgICAgICB0aGlzLmNoZWNrTG9hZGVkKCk7XHJcbiAgICB9XHJcbn07XHJcblxyXG5BbmltYXRpb25JdGVtLnByb3RvdHlwZS53YWl0Rm9yRm9udHNMb2FkZWQgPSAoZnVuY3Rpb24oKXtcclxuICAgIGZ1bmN0aW9uIGNoZWNrRm9udHNMb2FkZWQoKXtcclxuICAgICAgICBpZih0aGlzLnJlbmRlcmVyLmdsb2JhbERhdGEuZm9udE1hbmFnZXIubG9hZGVkKXtcclxuICAgICAgICAgICAgZGF0YU1hbmFnZXIuY29tcGxldGVEYXRhKHRoaXMuYW5pbWF0aW9uRGF0YSx0aGlzLnJlbmRlcmVyLmdsb2JhbERhdGEuZm9udE1hbmFnZXIpO1xyXG4gICAgICAgICAgICAvL3RoaXMucmVuZGVyZXIuYnVpbGRJdGVtcyh0aGlzLmFuaW1hdGlvbkRhdGEubGF5ZXJzKTtcclxuICAgICAgICAgICAgdGhpcy5jaGVja0xvYWRlZCgpO1xyXG4gICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICBzZXRUaW1lb3V0KGNoZWNrRm9udHNMb2FkZWQuYmluZCh0aGlzKSwyMCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBmdW5jdGlvbigpe1xyXG4gICAgICAgIGNoZWNrRm9udHNMb2FkZWQuYmluZCh0aGlzKSgpO1xyXG4gICAgfVxyXG59KCkpO1xyXG5cclxuQW5pbWF0aW9uSXRlbS5wcm90b3R5cGUuYWRkUGVuZGluZ0VsZW1lbnQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICB0aGlzLnBlbmRpbmdFbGVtZW50cyArPSAxO1xyXG59XHJcblxyXG5BbmltYXRpb25JdGVtLnByb3RvdHlwZS5lbGVtZW50TG9hZGVkID0gZnVuY3Rpb24gKCkge1xyXG4gICAgdGhpcy5wZW5kaW5nRWxlbWVudHMtLTtcclxuICAgIHRoaXMuY2hlY2tMb2FkZWQoKTtcclxufTtcclxuXHJcbkFuaW1hdGlvbkl0ZW0ucHJvdG90eXBlLmNoZWNrTG9hZGVkID0gZnVuY3Rpb24gKCkge1xyXG4gICAgaWYgKHRoaXMucGVuZGluZ0VsZW1lbnRzID09PSAwKSB7XHJcbiAgICAgICAgaWYoZXhwcmVzc2lvbnNQbHVnaW4pe1xyXG4gICAgICAgICAgICBleHByZXNzaW9uc1BsdWdpbi5pbml0RXhwcmVzc2lvbnModGhpcyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMucmVuZGVyZXIuaW5pdEl0ZW1zKCk7XHJcbiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICB0aGlzLnRyaWdnZXIoJ0RPTUxvYWRlZCcpO1xyXG4gICAgICAgIH0uYmluZCh0aGlzKSwwKTtcclxuICAgICAgICB0aGlzLmlzTG9hZGVkID0gdHJ1ZTtcclxuICAgICAgICB0aGlzLmdvdG9GcmFtZSgpO1xyXG4gICAgICAgIGlmKHRoaXMuYXV0b3BsYXkpe1xyXG4gICAgICAgICAgICB0aGlzLnBsYXkoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn07XHJcblxyXG5BbmltYXRpb25JdGVtLnByb3RvdHlwZS5yZXNpemUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICB0aGlzLnJlbmRlcmVyLnVwZGF0ZUNvbnRhaW5lclNpemUoKTtcclxufTtcclxuXHJcbkFuaW1hdGlvbkl0ZW0ucHJvdG90eXBlLnNldFN1YmZyYW1lID0gZnVuY3Rpb24oZmxhZyl7XHJcbiAgICB0aGlzLnN1YmZyYW1lRW5hYmxlZCA9IGZsYWcgPyB0cnVlIDogZmFsc2U7XHJcbn1cclxuXHJcbkFuaW1hdGlvbkl0ZW0ucHJvdG90eXBlLmdvdG9GcmFtZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgIGlmKHRoaXMuc3ViZnJhbWVFbmFibGVkKXtcclxuICAgICAgICB0aGlzLmN1cnJlbnRGcmFtZSA9IHRoaXMuY3VycmVudFJhd0ZyYW1lO1xyXG4gICAgfWVsc2V7XHJcbiAgICAgICAgdGhpcy5jdXJyZW50RnJhbWUgPSBNYXRoLmZsb29yKHRoaXMuY3VycmVudFJhd0ZyYW1lKTtcclxuICAgIH1cclxuXHJcbiAgICBpZih0aGlzLnRpbWVDb21wbGV0ZWQgIT09IHRoaXMudG90YWxGcmFtZXMgJiYgdGhpcy5jdXJyZW50RnJhbWUgPiB0aGlzLnRpbWVDb21wbGV0ZWQpe1xyXG4gICAgICAgIHRoaXMuY3VycmVudEZyYW1lID0gdGhpcy50aW1lQ29tcGxldGVkO1xyXG4gICAgfVxyXG4gICAgdGhpcy50cmlnZ2VyKCdlbnRlckZyYW1lJyk7XHJcbiAgICB0aGlzLnJlbmRlckZyYW1lKCk7XHJcbn07XHJcblxyXG5BbmltYXRpb25JdGVtLnByb3RvdHlwZS5yZW5kZXJGcmFtZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgIGlmKHRoaXMuaXNMb2FkZWQgPT09IGZhbHNlKXtcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICAvL2NvbnNvbGUubG9nKCd0aGlzLmN1cnJlbnRGcmFtZTonLHRoaXMuY3VycmVudEZyYW1lICsgdGhpcy5maXJzdEZyYW1lKTtcclxuICAgIHRoaXMucmVuZGVyZXIucmVuZGVyRnJhbWUodGhpcy5jdXJyZW50RnJhbWUgKyB0aGlzLmZpcnN0RnJhbWUpO1xyXG59O1xyXG5cclxuQW5pbWF0aW9uSXRlbS5wcm90b3R5cGUucGxheSA9IGZ1bmN0aW9uIChuYW1lKSB7XHJcbiAgICBpZihuYW1lICYmIHRoaXMubmFtZSAhPSBuYW1lKXtcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBpZih0aGlzLmlzUGF1c2VkID09PSB0cnVlKXtcclxuICAgICAgICB0aGlzLmlzUGF1c2VkID0gZmFsc2U7XHJcbiAgICAgICAgaWYodGhpcy5faWRsZSl7XHJcbiAgICAgICAgICAgIHRoaXMuX2lkbGUgPSBmYWxzZTtcclxuICAgICAgICAgICAgdGhpcy50cmlnZ2VyKCdfYWN0aXZlJyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59O1xyXG5cclxuQW5pbWF0aW9uSXRlbS5wcm90b3R5cGUucGF1c2UgPSBmdW5jdGlvbiAobmFtZSkge1xyXG4gICAgaWYobmFtZSAmJiB0aGlzLm5hbWUgIT0gbmFtZSl7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgaWYodGhpcy5pc1BhdXNlZCA9PT0gZmFsc2Upe1xyXG4gICAgICAgIHRoaXMuaXNQYXVzZWQgPSB0cnVlO1xyXG4gICAgICAgIGlmKCF0aGlzLnBlbmRpbmdTZWdtZW50KXtcclxuICAgICAgICAgICAgdGhpcy5faWRsZSA9IHRydWU7XHJcbiAgICAgICAgICAgIHRoaXMudHJpZ2dlcignX2lkbGUnKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn07XHJcblxyXG5BbmltYXRpb25JdGVtLnByb3RvdHlwZS50b2dnbGVQYXVzZSA9IGZ1bmN0aW9uIChuYW1lKSB7XHJcbiAgICBpZihuYW1lICYmIHRoaXMubmFtZSAhPSBuYW1lKXtcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBpZih0aGlzLmlzUGF1c2VkID09PSB0cnVlKXtcclxuICAgICAgICB0aGlzLnBsYXkoKTtcclxuICAgIH1lbHNle1xyXG4gICAgICAgIHRoaXMucGF1c2UoKTtcclxuICAgIH1cclxufTtcclxuXHJcbkFuaW1hdGlvbkl0ZW0ucHJvdG90eXBlLnN0b3AgPSBmdW5jdGlvbiAobmFtZSkge1xyXG4gICAgaWYobmFtZSAmJiB0aGlzLm5hbWUgIT0gbmFtZSl7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgdGhpcy5wYXVzZSgpO1xyXG4gICAgdGhpcy5jdXJyZW50RnJhbWUgPSB0aGlzLmN1cnJlbnRSYXdGcmFtZSA9IDA7XHJcbiAgICB0aGlzLnBsYXlDb3VudCA9IDA7XHJcbiAgICB0aGlzLmdvdG9GcmFtZSgpO1xyXG59O1xyXG5cclxuQW5pbWF0aW9uSXRlbS5wcm90b3R5cGUuZ29Ub0FuZFN0b3AgPSBmdW5jdGlvbiAodmFsdWUsIGlzRnJhbWUsIG5hbWUpIHtcclxuICAgIGlmKG5hbWUgJiYgdGhpcy5uYW1lICE9IG5hbWUpe1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGlmKGlzRnJhbWUpe1xyXG4gICAgICAgIHRoaXMuc2V0Q3VycmVudFJhd0ZyYW1lVmFsdWUodmFsdWUpO1xyXG4gICAgfWVsc2V7XHJcbiAgICAgICAgdGhpcy5zZXRDdXJyZW50UmF3RnJhbWVWYWx1ZSh2YWx1ZSAqIHRoaXMuZnJhbWVNb2RpZmllcik7XHJcbiAgICB9XHJcbiAgICB0aGlzLnBhdXNlKCk7XHJcbn07XHJcblxyXG5BbmltYXRpb25JdGVtLnByb3RvdHlwZS5nb1RvQW5kUGxheSA9IGZ1bmN0aW9uICh2YWx1ZSwgaXNGcmFtZSwgbmFtZSkge1xyXG4gICAgdGhpcy5nb1RvQW5kU3RvcCh2YWx1ZSwgaXNGcmFtZSwgbmFtZSk7XHJcbiAgICB0aGlzLnBsYXkoKTtcclxufTtcclxuXHJcbkFuaW1hdGlvbkl0ZW0ucHJvdG90eXBlLmFkdmFuY2VUaW1lID0gZnVuY3Rpb24gKHZhbHVlKSB7XHJcbiAgICBpZih0aGlzLnBlbmRpbmdTZWdtZW50KXtcclxuICAgICAgICB0aGlzLnBlbmRpbmdTZWdtZW50ID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5hZGp1c3RTZWdtZW50KHRoaXMuc2VnbWVudHMuc2hpZnQoKSk7XHJcbiAgICAgICAgaWYodGhpcy5pc1BhdXNlZCl7XHJcbiAgICAgICAgICAgIHRoaXMucGxheSgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBpZiAodGhpcy5pc1BhdXNlZCA9PT0gdHJ1ZSB8fCB0aGlzLmlzTG9hZGVkID09PSBmYWxzZSkge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIHRoaXMuc2V0Q3VycmVudFJhd0ZyYW1lVmFsdWUodGhpcy5jdXJyZW50UmF3RnJhbWUgKyB2YWx1ZSAqIHRoaXMuZnJhbWVNb2RpZmllcik7XHJcbn07XHJcblxyXG5BbmltYXRpb25JdGVtLnByb3RvdHlwZS51cGRhdGVBbmltYXRpb24gPSBmdW5jdGlvbiAocGVyYykge1xyXG4gICAgdGhpcy5zZXRDdXJyZW50UmF3RnJhbWVWYWx1ZSh0aGlzLnRvdGFsRnJhbWVzICogcGVyYyk7XHJcbn07XHJcblxyXG5BbmltYXRpb25JdGVtLnByb3RvdHlwZS5tb3ZlRnJhbWUgPSBmdW5jdGlvbiAodmFsdWUsIG5hbWUpIHtcclxuICAgIGlmKG5hbWUgJiYgdGhpcy5uYW1lICE9IG5hbWUpe1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIHRoaXMuc2V0Q3VycmVudFJhd0ZyYW1lVmFsdWUodGhpcy5jdXJyZW50UmF3RnJhbWUrdmFsdWUpO1xyXG59O1xyXG5cclxuQW5pbWF0aW9uSXRlbS5wcm90b3R5cGUuYWRqdXN0U2VnbWVudCA9IGZ1bmN0aW9uKGFycil7XHJcbiAgICB0aGlzLnBsYXlDb3VudCA9IDA7XHJcbiAgICBpZihhcnJbMV0gPCBhcnJbMF0pe1xyXG4gICAgICAgIGlmKHRoaXMuZnJhbWVNb2RpZmllciA+IDApe1xyXG4gICAgICAgICAgICBpZih0aGlzLnBsYXlTcGVlZCA8IDApe1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZXRTcGVlZCgtdGhpcy5wbGF5U3BlZWQpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZXREaXJlY3Rpb24oLTEpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMudG90YWxGcmFtZXMgPSBhcnJbMF0gLSBhcnJbMV07XHJcbiAgICAgICAgdGhpcy5maXJzdEZyYW1lID0gYXJyWzFdO1xyXG4gICAgICAgIHRoaXMuc2V0Q3VycmVudFJhd0ZyYW1lVmFsdWUodGhpcy50b3RhbEZyYW1lcyAtIDAuMDEpO1xyXG4gICAgfSBlbHNlIGlmKGFyclsxXSA+IGFyclswXSl7XHJcbiAgICAgICAgaWYodGhpcy5mcmFtZU1vZGlmaWVyIDwgMCl7XHJcbiAgICAgICAgICAgIGlmKHRoaXMucGxheVNwZWVkIDwgMCl7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNldFNwZWVkKC10aGlzLnBsYXlTcGVlZCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNldERpcmVjdGlvbigxKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnRvdGFsRnJhbWVzID0gYXJyWzFdIC0gYXJyWzBdO1xyXG4gICAgICAgIHRoaXMuZmlyc3RGcmFtZSA9IGFyclswXTtcclxuICAgICAgICB0aGlzLnNldEN1cnJlbnRSYXdGcmFtZVZhbHVlKDApO1xyXG4gICAgfVxyXG4gICAgdGhpcy50cmlnZ2VyKCdzZWdtZW50U3RhcnQnKTtcclxufTtcclxuQW5pbWF0aW9uSXRlbS5wcm90b3R5cGUuc2V0U2VnbWVudCA9IGZ1bmN0aW9uIChpbml0LGVuZCkge1xyXG4gICAgdmFyIHBlbmRpbmdGcmFtZSA9IC0xO1xyXG4gICAgaWYodGhpcy5pc1BhdXNlZCkge1xyXG4gICAgICAgIGlmICh0aGlzLmN1cnJlbnRSYXdGcmFtZSArIHRoaXMuZmlyc3RGcmFtZSA8IGluaXQpIHtcclxuICAgICAgICAgICAgcGVuZGluZ0ZyYW1lID0gaW5pdDtcclxuICAgICAgICB9IGVsc2UgaWYgKHRoaXMuY3VycmVudFJhd0ZyYW1lICsgdGhpcy5maXJzdEZyYW1lID4gZW5kKSB7XHJcbiAgICAgICAgICAgIHBlbmRpbmdGcmFtZSA9IGVuZCAtIGluaXQgLSAwLjAxO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICB0aGlzLmZpcnN0RnJhbWUgPSBpbml0O1xyXG4gICAgdGhpcy50b3RhbEZyYW1lcyA9IGVuZCAtIGluaXQ7XHJcbiAgICBpZihwZW5kaW5nRnJhbWUgIT09IC0xKSB7XHJcbiAgICAgICAgdGhpcy5nb1RvQW5kU3RvcChwZW5kaW5nRnJhbWUsdHJ1ZSk7XHJcbiAgICB9XHJcbn1cclxuXHJcbkFuaW1hdGlvbkl0ZW0ucHJvdG90eXBlLnBsYXlTZWdtZW50cyA9IGZ1bmN0aW9uIChhcnIsZm9yY2VGbGFnKSB7XHJcbiAgICBpZih0eXBlb2YgYXJyWzBdID09PSAnb2JqZWN0Jyl7XHJcbiAgICAgICAgdmFyIGksIGxlbiA9IGFyci5sZW5ndGg7XHJcbiAgICAgICAgZm9yKGk9MDtpPGxlbjtpKz0xKXtcclxuICAgICAgICAgICAgdGhpcy5zZWdtZW50cy5wdXNoKGFycltpXSk7XHJcbiAgICAgICAgfVxyXG4gICAgfWVsc2V7XHJcbiAgICAgICAgdGhpcy5zZWdtZW50cy5wdXNoKGFycik7XHJcbiAgICB9XHJcbiAgICBpZihmb3JjZUZsYWcpe1xyXG4gICAgICAgIHRoaXMuYWRqdXN0U2VnbWVudCh0aGlzLnNlZ21lbnRzLnNoaWZ0KCkpO1xyXG4gICAgfVxyXG4gICAgaWYodGhpcy5pc1BhdXNlZCl7XHJcbiAgICAgICAgdGhpcy5wbGF5KCk7XHJcbiAgICB9XHJcbn07XHJcblxyXG5BbmltYXRpb25JdGVtLnByb3RvdHlwZS5yZXNldFNlZ21lbnRzID0gZnVuY3Rpb24gKGZvcmNlRmxhZykge1xyXG4gICAgdGhpcy5zZWdtZW50cy5sZW5ndGggPSAwO1xyXG4gICAgdGhpcy5zZWdtZW50cy5wdXNoKFt0aGlzLmFuaW1hdGlvbkRhdGEuaXAqdGhpcy5mcmFtZVJhdGUsTWF0aC5mbG9vcih0aGlzLmFuaW1hdGlvbkRhdGEub3AgLSB0aGlzLmFuaW1hdGlvbkRhdGEuaXArdGhpcy5hbmltYXRpb25EYXRhLmlwKnRoaXMuZnJhbWVSYXRlKV0pO1xyXG4gICAgaWYoZm9yY2VGbGFnKXtcclxuICAgICAgICB0aGlzLmFkanVzdFNlZ21lbnQodGhpcy5zZWdtZW50cy5zaGlmdCgpKTtcclxuICAgIH1cclxufTtcclxuQW5pbWF0aW9uSXRlbS5wcm90b3R5cGUuY2hlY2tTZWdtZW50cyA9IGZ1bmN0aW9uKCl7XHJcbiAgICBpZih0aGlzLnNlZ21lbnRzLmxlbmd0aCl7XHJcbiAgICAgICAgdGhpcy5wZW5kaW5nU2VnbWVudCA9IHRydWU7XHJcbiAgICB9XHJcbn1cclxuXHJcbkFuaW1hdGlvbkl0ZW0ucHJvdG90eXBlLnJlbW92ZSA9IGZ1bmN0aW9uIChuYW1lKSB7XHJcbiAgICBpZihuYW1lICYmIHRoaXMubmFtZSAhPSBuYW1lKXtcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICB0aGlzLnJlbmRlcmVyLmRlc3Ryb3koKTtcclxufTtcclxuXHJcbkFuaW1hdGlvbkl0ZW0ucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbiAobmFtZSkge1xyXG4gICAgaWYoKG5hbWUgJiYgdGhpcy5uYW1lICE9IG5hbWUpIHx8ICh0aGlzLnJlbmRlcmVyICYmIHRoaXMucmVuZGVyZXIuZGVzdHJveWVkKSl7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgdGhpcy5yZW5kZXJlci5kZXN0cm95KCk7XHJcbiAgICB0aGlzLnRyaWdnZXIoJ2Rlc3Ryb3knKTtcclxuICAgIHRoaXMuX2NicyA9IG51bGw7XHJcbiAgICB0aGlzLm9uRW50ZXJGcmFtZSA9IHRoaXMub25Mb29wQ29tcGxldGUgPSB0aGlzLm9uQ29tcGxldGUgPSB0aGlzLm9uU2VnbWVudFN0YXJ0ID0gdGhpcy5vbkRlc3Ryb3kgPSBudWxsO1xyXG59O1xyXG5cclxuQW5pbWF0aW9uSXRlbS5wcm90b3R5cGUuc2V0Q3VycmVudFJhd0ZyYW1lVmFsdWUgPSBmdW5jdGlvbih2YWx1ZSl7XHJcbiAgICB0aGlzLmN1cnJlbnRSYXdGcmFtZSA9IHZhbHVlO1xyXG4gICAgLy9jb25zb2xlLmxvZyh0aGlzLnRvdGFsRnJhbWVzKTtcclxuICAgIGlmICh0aGlzLmN1cnJlbnRSYXdGcmFtZSA+PSB0aGlzLnRvdGFsRnJhbWVzKSB7XHJcbiAgICAgICAgdGhpcy5jaGVja1NlZ21lbnRzKCk7XHJcbiAgICAgICAgaWYodGhpcy5sb29wID09PSBmYWxzZSl7XHJcbiAgICAgICAgICAgIHRoaXMuY3VycmVudFJhd0ZyYW1lID0gdGhpcy50b3RhbEZyYW1lcyAtIDAuMDE7XHJcbiAgICAgICAgICAgIHRoaXMuZ290b0ZyYW1lKCk7XHJcbiAgICAgICAgICAgIHRoaXMucGF1c2UoKTtcclxuICAgICAgICAgICAgdGhpcy50cmlnZ2VyKCdjb21wbGV0ZScpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgIHRoaXMudHJpZ2dlcignbG9vcENvbXBsZXRlJyk7XHJcbiAgICAgICAgICAgIHRoaXMucGxheUNvdW50ICs9IDE7XHJcbiAgICAgICAgICAgIGlmKCh0aGlzLmxvb3AgIT09IHRydWUgJiYgdGhpcy5wbGF5Q291bnQgPT0gdGhpcy5sb29wKSB8fCB0aGlzLnBlbmRpbmdTZWdtZW50KXtcclxuICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudFJhd0ZyYW1lID0gdGhpcy50b3RhbEZyYW1lcyAtIDAuMDE7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmdvdG9GcmFtZSgpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5wYXVzZSgpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy50cmlnZ2VyKCdjb21wbGV0ZScpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50UmF3RnJhbWUgPSB0aGlzLmN1cnJlbnRSYXdGcmFtZSAlIHRoaXMudG90YWxGcmFtZXM7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9IGVsc2UgaWYgKHRoaXMuY3VycmVudFJhd0ZyYW1lIDwgMCkge1xyXG4gICAgICAgIHRoaXMuY2hlY2tTZWdtZW50cygpO1xyXG4gICAgICAgIHRoaXMucGxheUNvdW50IC09IDE7XHJcbiAgICAgICAgaWYodGhpcy5wbGF5Q291bnQgPCAwKXtcclxuICAgICAgICAgICAgdGhpcy5wbGF5Q291bnQgPSAwO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZih0aGlzLmxvb3AgPT09IGZhbHNlICB8fCB0aGlzLnBlbmRpbmdTZWdtZW50KXtcclxuICAgICAgICAgICAgdGhpcy5jdXJyZW50UmF3RnJhbWUgPSAwO1xyXG4gICAgICAgICAgICB0aGlzLmdvdG9GcmFtZSgpO1xyXG4gICAgICAgICAgICB0aGlzLnBhdXNlKCk7XHJcbiAgICAgICAgICAgIHRoaXMudHJpZ2dlcignY29tcGxldGUnKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICB0aGlzLnRyaWdnZXIoJ2xvb3BDb21wbGV0ZScpO1xyXG4gICAgICAgICAgICB0aGlzLmN1cnJlbnRSYXdGcmFtZSA9ICh0aGlzLnRvdGFsRnJhbWVzICsgdGhpcy5jdXJyZW50UmF3RnJhbWUpICUgdGhpcy50b3RhbEZyYW1lcztcclxuICAgICAgICAgICAgdGhpcy5nb3RvRnJhbWUoKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICB0aGlzLmdvdG9GcmFtZSgpO1xyXG59O1xyXG5cclxuQW5pbWF0aW9uSXRlbS5wcm90b3R5cGUuc2V0U3BlZWQgPSBmdW5jdGlvbiAodmFsKSB7XHJcbiAgICB0aGlzLnBsYXlTcGVlZCA9IHZhbDtcclxuICAgIHRoaXMudXBkYUZyYW1lTW9kaWZpZXIoKTtcclxufTtcclxuXHJcbkFuaW1hdGlvbkl0ZW0ucHJvdG90eXBlLnNldERpcmVjdGlvbiA9IGZ1bmN0aW9uICh2YWwpIHtcclxuICAgIHRoaXMucGxheURpcmVjdGlvbiA9IHZhbCA8IDAgPyAtMSA6IDE7XHJcbiAgICB0aGlzLnVwZGFGcmFtZU1vZGlmaWVyKCk7XHJcbn07XHJcblxyXG5BbmltYXRpb25JdGVtLnByb3RvdHlwZS51cGRhRnJhbWVNb2RpZmllciA9IGZ1bmN0aW9uICgpIHtcclxuICAgIHRoaXMuZnJhbWVNb2RpZmllciA9IHRoaXMuZnJhbWVNdWx0ICogdGhpcy5wbGF5U3BlZWQgKiB0aGlzLnBsYXlEaXJlY3Rpb247XHJcbn07XHJcblxyXG5BbmltYXRpb25JdGVtLnByb3RvdHlwZS5nZXRQYXRoID0gZnVuY3Rpb24gKCkge1xyXG4gICAgcmV0dXJuIHRoaXMucGF0aDtcclxufTtcclxuXHJcbkFuaW1hdGlvbkl0ZW0ucHJvdG90eXBlLmdldEFzc2V0c1BhdGggPSBmdW5jdGlvbiAoYXNzZXREYXRhKSB7XHJcbiAgICB2YXIgcGF0aCA9ICcnO1xyXG4gICAgaWYodGhpcy5hc3NldHNQYXRoKXtcclxuICAgICAgICB2YXIgaW1hZ2VQYXRoID0gYXNzZXREYXRhLnA7XHJcbiAgICAgICAgaWYoaW1hZ2VQYXRoLmluZGV4T2YoJ2ltYWdlcy8nKSAhPT0gLTEpe1xyXG4gICAgICAgICAgICBpbWFnZVBhdGggPSBpbWFnZVBhdGguc3BsaXQoJy8nKVsxXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcGF0aCA9IHRoaXMuYXNzZXRzUGF0aCArIGltYWdlUGF0aDtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcGF0aCA9IHRoaXMucGF0aDtcclxuICAgICAgICBwYXRoICs9IGFzc2V0RGF0YS51ID8gYXNzZXREYXRhLnUgOiAnJztcclxuICAgICAgICBwYXRoICs9IGFzc2V0RGF0YS5wO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHBhdGg7XHJcbn07XHJcblxyXG5BbmltYXRpb25JdGVtLnByb3RvdHlwZS5nZXRBc3NldERhdGEgPSBmdW5jdGlvbiAoaWQpIHtcclxuICAgIHZhciBpID0gMCwgbGVuID0gdGhpcy5hc3NldHMubGVuZ3RoO1xyXG4gICAgd2hpbGUgKGkgPCBsZW4pIHtcclxuICAgICAgICBpZihpZCA9PSB0aGlzLmFzc2V0c1tpXS5pZCl7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmFzc2V0c1tpXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaSArPSAxO1xyXG4gICAgfVxyXG59O1xyXG5cclxuQW5pbWF0aW9uSXRlbS5wcm90b3R5cGUuaGlkZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgIHRoaXMucmVuZGVyZXIuaGlkZSgpO1xyXG59O1xyXG5cclxuQW5pbWF0aW9uSXRlbS5wcm90b3R5cGUuc2hvdyA9IGZ1bmN0aW9uICgpIHtcclxuICAgIHRoaXMucmVuZGVyZXIuc2hvdygpO1xyXG59O1xyXG5cclxuQW5pbWF0aW9uSXRlbS5wcm90b3R5cGUuZ2V0QXNzZXRzID0gZnVuY3Rpb24gKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuYXNzZXRzO1xyXG59O1xyXG5cclxuQW5pbWF0aW9uSXRlbS5wcm90b3R5cGUudHJpZ2dlciA9IGZ1bmN0aW9uKG5hbWUpe1xyXG4gICAgaWYodGhpcy5fY2JzICYmIHRoaXMuX2Nic1tuYW1lXSl7XHJcbiAgICAgICAgc3dpdGNoKG5hbWUpe1xyXG4gICAgICAgICAgICBjYXNlICdlbnRlckZyYW1lJzpcclxuICAgICAgICAgICAgICAgIHRoaXMudHJpZ2dlckV2ZW50KG5hbWUsbmV3IEJNRW50ZXJGcmFtZUV2ZW50KG5hbWUsdGhpcy5jdXJyZW50RnJhbWUsdGhpcy50b3RhbEZyYW1lcyx0aGlzLmZyYW1lTXVsdCkpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgJ2xvb3BDb21wbGV0ZSc6XHJcbiAgICAgICAgICAgICAgICB0aGlzLnRyaWdnZXJFdmVudChuYW1lLG5ldyBCTUNvbXBsZXRlTG9vcEV2ZW50KG5hbWUsdGhpcy5sb29wLHRoaXMucGxheUNvdW50LHRoaXMuZnJhbWVNdWx0KSk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAnY29tcGxldGUnOlxyXG4gICAgICAgICAgICAgICAgdGhpcy50cmlnZ2VyRXZlbnQobmFtZSxuZXcgQk1Db21wbGV0ZUV2ZW50KG5hbWUsdGhpcy5mcmFtZU11bHQpKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlICdzZWdtZW50U3RhcnQnOlxyXG4gICAgICAgICAgICAgICAgdGhpcy50cmlnZ2VyRXZlbnQobmFtZSxuZXcgQk1TZWdtZW50U3RhcnRFdmVudChuYW1lLHRoaXMuZmlyc3RGcmFtZSx0aGlzLnRvdGFsRnJhbWVzKSk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAnZGVzdHJveSc6XHJcbiAgICAgICAgICAgICAgICB0aGlzLnRyaWdnZXJFdmVudChuYW1lLG5ldyBCTURlc3Ryb3lFdmVudChuYW1lLHRoaXMpKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgdGhpcy50cmlnZ2VyRXZlbnQobmFtZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgaWYobmFtZSA9PT0gJ2VudGVyRnJhbWUnICYmIHRoaXMub25FbnRlckZyYW1lKXtcclxuICAgICAgICB0aGlzLm9uRW50ZXJGcmFtZS5jYWxsKHRoaXMsbmV3IEJNRW50ZXJGcmFtZUV2ZW50KG5hbWUsdGhpcy5jdXJyZW50RnJhbWUsdGhpcy50b3RhbEZyYW1lcyx0aGlzLmZyYW1lTXVsdCkpO1xyXG4gICAgfVxyXG4gICAgaWYobmFtZSA9PT0gJ2xvb3BDb21wbGV0ZScgJiYgdGhpcy5vbkxvb3BDb21wbGV0ZSl7XHJcbiAgICAgICAgdGhpcy5vbkxvb3BDb21wbGV0ZS5jYWxsKHRoaXMsbmV3IEJNQ29tcGxldGVMb29wRXZlbnQobmFtZSx0aGlzLmxvb3AsdGhpcy5wbGF5Q291bnQsdGhpcy5mcmFtZU11bHQpKTtcclxuICAgIH1cclxuICAgIGlmKG5hbWUgPT09ICdjb21wbGV0ZScgJiYgdGhpcy5vbkNvbXBsZXRlKXtcclxuICAgICAgICB0aGlzLm9uQ29tcGxldGUuY2FsbCh0aGlzLG5ldyBCTUNvbXBsZXRlRXZlbnQobmFtZSx0aGlzLmZyYW1lTXVsdCkpO1xyXG4gICAgfVxyXG4gICAgaWYobmFtZSA9PT0gJ3NlZ21lbnRTdGFydCcgJiYgdGhpcy5vblNlZ21lbnRTdGFydCl7XHJcbiAgICAgICAgdGhpcy5vblNlZ21lbnRTdGFydC5jYWxsKHRoaXMsbmV3IEJNU2VnbWVudFN0YXJ0RXZlbnQobmFtZSx0aGlzLmZpcnN0RnJhbWUsdGhpcy50b3RhbEZyYW1lcykpO1xyXG4gICAgfVxyXG4gICAgaWYobmFtZSA9PT0gJ2Rlc3Ryb3knICYmIHRoaXMub25EZXN0cm95KXtcclxuICAgICAgICB0aGlzLm9uRGVzdHJveS5jYWxsKHRoaXMsbmV3IEJNRGVzdHJveUV2ZW50KG5hbWUsdGhpcykpO1xyXG4gICAgfVxyXG59O1xyXG5cclxuQW5pbWF0aW9uSXRlbS5wcm90b3R5cGUuYWRkRXZlbnRMaXN0ZW5lciA9IF9hZGRFdmVudExpc3RlbmVyO1xyXG5BbmltYXRpb25JdGVtLnByb3RvdHlwZS5yZW1vdmVFdmVudExpc3RlbmVyID0gX3JlbW92ZUV2ZW50TGlzdGVuZXI7XHJcbkFuaW1hdGlvbkl0ZW0ucHJvdG90eXBlLnRyaWdnZXJFdmVudCA9IF90cmlnZ2VyRXZlbnQ7XHJcblxuZnVuY3Rpb24gQ2FudmFzUmVuZGVyZXIoYW5pbWF0aW9uSXRlbSwgY29uZmlnKXtcclxuICAgIHRoaXMuYW5pbWF0aW9uSXRlbSA9IGFuaW1hdGlvbkl0ZW07XHJcbiAgICB0aGlzLnJlbmRlckNvbmZpZyA9IHtcclxuICAgICAgICBjbGVhckNhbnZhczogKGNvbmZpZyAmJiBjb25maWcuY2xlYXJDYW52YXMgIT09IHVuZGVmaW5lZCkgPyBjb25maWcuY2xlYXJDYW52YXMgOiB0cnVlLFxyXG4gICAgICAgIGNvbnRleHQ6IChjb25maWcgJiYgY29uZmlnLmNvbnRleHQpIHx8IG51bGwsXHJcbiAgICAgICAgcHJvZ3Jlc3NpdmVMb2FkOiAoY29uZmlnICYmIGNvbmZpZy5wcm9ncmVzc2l2ZUxvYWQpIHx8IGZhbHNlLFxyXG4gICAgICAgIHByZXNlcnZlQXNwZWN0UmF0aW86IChjb25maWcgJiYgY29uZmlnLnByZXNlcnZlQXNwZWN0UmF0aW8pIHx8ICd4TWlkWU1pZCBtZWV0J1xyXG4gICAgfTtcclxuICAgIHRoaXMucmVuZGVyQ29uZmlnLmRwciA9IChjb25maWcgJiYgY29uZmlnLmRwcikgfHwgMTtcclxuICAgIGlmICh0aGlzLmFuaW1hdGlvbkl0ZW0ud3JhcHBlcikge1xyXG4gICAgICAgIHRoaXMucmVuZGVyQ29uZmlnLmRwciA9IChjb25maWcgJiYgY29uZmlnLmRwcikgfHwgd2luZG93LmRldmljZVBpeGVsUmF0aW8gfHwgMTtcclxuICAgIH1cclxuICAgIHRoaXMucmVuZGVyZWRGcmFtZSA9IC0xO1xyXG4gICAgdGhpcy5nbG9iYWxEYXRhID0ge1xyXG4gICAgICAgIGZyYW1lTnVtOiAtMVxyXG4gICAgfTtcclxuICAgIHRoaXMuY29udGV4dERhdGEgPSB7XHJcbiAgICAgICAgc2F2ZWQgOiBBcnJheS5hcHBseShudWxsLHtsZW5ndGg6MTV9KSxcclxuICAgICAgICBzYXZlZE9wOiBBcnJheS5hcHBseShudWxsLHtsZW5ndGg6MTV9KSxcclxuICAgICAgICBjQXJyUG9zIDogMCxcclxuICAgICAgICBjVHIgOiBuZXcgTWF0cml4KCksXHJcbiAgICAgICAgY08gOiAxXHJcbiAgICB9O1xyXG4gICAgdmFyIGksIGxlbiA9IDE1O1xyXG4gICAgZm9yKGk9MDtpPGxlbjtpKz0xKXtcclxuICAgICAgICB0aGlzLmNvbnRleHREYXRhLnNhdmVkW2ldID0gQXJyYXkuYXBwbHkobnVsbCx7bGVuZ3RoOjE2fSk7XHJcbiAgICB9XHJcbiAgICB0aGlzLmVsZW1lbnRzID0gW107XHJcbiAgICB0aGlzLnBlbmRpbmdFbGVtZW50cyA9IFtdO1xyXG4gICAgdGhpcy50cmFuc2Zvcm1NYXQgPSBuZXcgTWF0cml4KCk7XHJcbiAgICB0aGlzLmNvbXBsZXRlTGF5ZXJzID0gZmFsc2U7XHJcbn1cclxuZXh0ZW5kUHJvdG90eXBlKEJhc2VSZW5kZXJlcixDYW52YXNSZW5kZXJlcik7XHJcblxyXG5DYW52YXNSZW5kZXJlci5wcm90b3R5cGUuY3JlYXRlQmFzZSA9IGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICByZXR1cm4gbmV3IENWQmFzZUVsZW1lbnQoZGF0YSwgdGhpcywgdGhpcy5nbG9iYWxEYXRhKTtcclxufTtcclxuXHJcbkNhbnZhc1JlbmRlcmVyLnByb3RvdHlwZS5jcmVhdGVTaGFwZSA9IGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICByZXR1cm4gbmV3IENWU2hhcGVFbGVtZW50KGRhdGEsIHRoaXMsIHRoaXMuZ2xvYmFsRGF0YSk7XHJcbn07XHJcblxyXG5DYW52YXNSZW5kZXJlci5wcm90b3R5cGUuY3JlYXRlVGV4dCA9IGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICByZXR1cm4gbmV3IENWVGV4dEVsZW1lbnQoZGF0YSwgdGhpcywgdGhpcy5nbG9iYWxEYXRhKTtcclxufTtcclxuXHJcbkNhbnZhc1JlbmRlcmVyLnByb3RvdHlwZS5jcmVhdGVJbWFnZSA9IGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICByZXR1cm4gbmV3IENWSW1hZ2VFbGVtZW50KGRhdGEsIHRoaXMsIHRoaXMuZ2xvYmFsRGF0YSk7XHJcbn07XHJcblxyXG5DYW52YXNSZW5kZXJlci5wcm90b3R5cGUuY3JlYXRlQ29tcCA9IGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICByZXR1cm4gbmV3IENWQ29tcEVsZW1lbnQoZGF0YSwgdGhpcywgdGhpcy5nbG9iYWxEYXRhKTtcclxufTtcclxuXHJcbkNhbnZhc1JlbmRlcmVyLnByb3RvdHlwZS5jcmVhdGVTb2xpZCA9IGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICByZXR1cm4gbmV3IENWU29saWRFbGVtZW50KGRhdGEsIHRoaXMsIHRoaXMuZ2xvYmFsRGF0YSk7XHJcbn07XHJcblxyXG5DYW52YXNSZW5kZXJlci5wcm90b3R5cGUuY3R4VHJhbnNmb3JtID0gZnVuY3Rpb24ocHJvcHMpe1xyXG4gICAgaWYocHJvcHNbMF0gPT09IDEgJiYgcHJvcHNbMV0gPT09IDAgJiYgcHJvcHNbNF0gPT09IDAgJiYgcHJvcHNbNV0gPT09IDEgJiYgcHJvcHNbMTJdID09PSAwICYmIHByb3BzWzEzXSA9PT0gMCl7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgaWYoIXRoaXMucmVuZGVyQ29uZmlnLmNsZWFyQ2FudmFzKXtcclxuICAgICAgICB0aGlzLmNhbnZhc0NvbnRleHQudHJhbnNmb3JtKHByb3BzWzBdLHByb3BzWzFdLHByb3BzWzRdLHByb3BzWzVdLHByb3BzWzEyXSxwcm9wc1sxM10pO1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIHRoaXMudHJhbnNmb3JtTWF0LmNsb25lRnJvbVByb3BzKHByb3BzKTtcclxuICAgIHRoaXMudHJhbnNmb3JtTWF0LnRyYW5zZm9ybSh0aGlzLmNvbnRleHREYXRhLmNUci5wcm9wc1swXSx0aGlzLmNvbnRleHREYXRhLmNUci5wcm9wc1sxXSx0aGlzLmNvbnRleHREYXRhLmNUci5wcm9wc1syXSx0aGlzLmNvbnRleHREYXRhLmNUci5wcm9wc1szXSx0aGlzLmNvbnRleHREYXRhLmNUci5wcm9wc1s0XSx0aGlzLmNvbnRleHREYXRhLmNUci5wcm9wc1s1XSx0aGlzLmNvbnRleHREYXRhLmNUci5wcm9wc1s2XSx0aGlzLmNvbnRleHREYXRhLmNUci5wcm9wc1s3XSx0aGlzLmNvbnRleHREYXRhLmNUci5wcm9wc1s4XSx0aGlzLmNvbnRleHREYXRhLmNUci5wcm9wc1s5XSx0aGlzLmNvbnRleHREYXRhLmNUci5wcm9wc1sxMF0sdGhpcy5jb250ZXh0RGF0YS5jVHIucHJvcHNbMTFdLHRoaXMuY29udGV4dERhdGEuY1RyLnByb3BzWzEyXSx0aGlzLmNvbnRleHREYXRhLmNUci5wcm9wc1sxM10sdGhpcy5jb250ZXh0RGF0YS5jVHIucHJvcHNbMTRdLHRoaXMuY29udGV4dERhdGEuY1RyLnByb3BzWzE1XSlcclxuICAgIC8vdGhpcy5jb250ZXh0RGF0YS5jVHIudHJhbnNmb3JtKHByb3BzWzBdLHByb3BzWzFdLHByb3BzWzJdLHByb3BzWzNdLHByb3BzWzRdLHByb3BzWzVdLHByb3BzWzZdLHByb3BzWzddLHByb3BzWzhdLHByb3BzWzldLHByb3BzWzEwXSxwcm9wc1sxMV0scHJvcHNbMTJdLHByb3BzWzEzXSxwcm9wc1sxNF0scHJvcHNbMTVdKTtcclxuICAgIHRoaXMuY29udGV4dERhdGEuY1RyLmNsb25lRnJvbVByb3BzKHRoaXMudHJhbnNmb3JtTWF0LnByb3BzKTtcclxuICAgIHZhciB0clByb3BzID0gdGhpcy5jb250ZXh0RGF0YS5jVHIucHJvcHM7XHJcbiAgICB0aGlzLmNhbnZhc0NvbnRleHQuc2V0VHJhbnNmb3JtKHRyUHJvcHNbMF0sdHJQcm9wc1sxXSx0clByb3BzWzRdLHRyUHJvcHNbNV0sdHJQcm9wc1sxMl0sdHJQcm9wc1sxM10pO1xyXG59O1xyXG5cclxuQ2FudmFzUmVuZGVyZXIucHJvdG90eXBlLmN0eE9wYWNpdHkgPSBmdW5jdGlvbihvcCl7XHJcbiAgICBpZihvcCA9PT0gMSl7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgaWYoIXRoaXMucmVuZGVyQ29uZmlnLmNsZWFyQ2FudmFzKXtcclxuICAgICAgICB0aGlzLmNhbnZhc0NvbnRleHQuZ2xvYmFsQWxwaGEgKj0gb3AgPCAwID8gMCA6IG9wO1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIHRoaXMuY29udGV4dERhdGEuY08gKj0gb3AgPCAwID8gMCA6IG9wO1xyXG4gICAgdGhpcy5jYW52YXNDb250ZXh0Lmdsb2JhbEFscGhhID0gdGhpcy5jb250ZXh0RGF0YS5jTztcclxufTtcclxuXHJcbkNhbnZhc1JlbmRlcmVyLnByb3RvdHlwZS5yZXNldCA9IGZ1bmN0aW9uKCl7XHJcbiAgICBpZighdGhpcy5yZW5kZXJDb25maWcuY2xlYXJDYW52YXMpe1xyXG4gICAgICAgIHRoaXMuY2FudmFzQ29udGV4dC5yZXN0b3JlKCk7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgdGhpcy5jb250ZXh0RGF0YS5jQXJyUG9zID0gMDtcclxuICAgIHRoaXMuY29udGV4dERhdGEuY1RyLnJlc2V0KCk7XHJcbiAgICB0aGlzLmNvbnRleHREYXRhLmNPID0gMTtcclxufTtcclxuXHJcbkNhbnZhc1JlbmRlcmVyLnByb3RvdHlwZS5zYXZlID0gZnVuY3Rpb24oYWN0aW9uRmxhZyl7XHJcbiAgICBpZighdGhpcy5yZW5kZXJDb25maWcuY2xlYXJDYW52YXMpe1xyXG4gICAgICAgIHRoaXMuY2FudmFzQ29udGV4dC5zYXZlKCk7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgaWYoYWN0aW9uRmxhZyl7XHJcbiAgICAgICAgdGhpcy5jYW52YXNDb250ZXh0LnNhdmUoKTtcclxuICAgIH1cclxuICAgIHZhciBwcm9wcyA9IHRoaXMuY29udGV4dERhdGEuY1RyLnByb3BzO1xyXG4gICAgaWYodGhpcy5jb250ZXh0RGF0YS5zYXZlZFt0aGlzLmNvbnRleHREYXRhLmNBcnJQb3NdID09PSBudWxsIHx8IHRoaXMuY29udGV4dERhdGEuc2F2ZWRbdGhpcy5jb250ZXh0RGF0YS5jQXJyUG9zXSA9PT0gdW5kZWZpbmVkKXtcclxuICAgICAgICB0aGlzLmNvbnRleHREYXRhLnNhdmVkW3RoaXMuY29udGV4dERhdGEuY0FyclBvc10gPSBuZXcgQXJyYXkoMTYpO1xyXG4gICAgfVxyXG4gICAgdmFyIGksYXJyID0gdGhpcy5jb250ZXh0RGF0YS5zYXZlZFt0aGlzLmNvbnRleHREYXRhLmNBcnJQb3NdO1xyXG4gICAgZm9yKGk9MDtpPDE2O2krPTEpe1xyXG4gICAgICAgIGFycltpXSA9IHByb3BzW2ldO1xyXG4gICAgfVxyXG4gICAgdGhpcy5jb250ZXh0RGF0YS5zYXZlZE9wW3RoaXMuY29udGV4dERhdGEuY0FyclBvc10gPSB0aGlzLmNvbnRleHREYXRhLmNPO1xyXG4gICAgdGhpcy5jb250ZXh0RGF0YS5jQXJyUG9zICs9IDE7XHJcbn07XHJcblxyXG5DYW52YXNSZW5kZXJlci5wcm90b3R5cGUucmVzdG9yZSA9IGZ1bmN0aW9uKGFjdGlvbkZsYWcpe1xyXG4gICAgaWYoIXRoaXMucmVuZGVyQ29uZmlnLmNsZWFyQ2FudmFzKXtcclxuICAgICAgICB0aGlzLmNhbnZhc0NvbnRleHQucmVzdG9yZSgpO1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGlmKGFjdGlvbkZsYWcpe1xyXG4gICAgICAgIHRoaXMuY2FudmFzQ29udGV4dC5yZXN0b3JlKCk7XHJcbiAgICB9XHJcbiAgICB0aGlzLmNvbnRleHREYXRhLmNBcnJQb3MgLT0gMTtcclxuICAgIHZhciBwb3BwZWQgPSB0aGlzLmNvbnRleHREYXRhLnNhdmVkW3RoaXMuY29udGV4dERhdGEuY0FyclBvc107XHJcbiAgICB2YXIgaSxhcnIgPSB0aGlzLmNvbnRleHREYXRhLmNUci5wcm9wcztcclxuICAgIGZvcihpPTA7aTwxNjtpKz0xKXtcclxuICAgICAgICBhcnJbaV0gPSBwb3BwZWRbaV07XHJcbiAgICB9XHJcbiAgICB0aGlzLmNhbnZhc0NvbnRleHQuc2V0VHJhbnNmb3JtKHBvcHBlZFswXSxwb3BwZWRbMV0scG9wcGVkWzRdLHBvcHBlZFs1XSxwb3BwZWRbMTJdLHBvcHBlZFsxM10pO1xyXG4gICAgcG9wcGVkID0gdGhpcy5jb250ZXh0RGF0YS5zYXZlZE9wW3RoaXMuY29udGV4dERhdGEuY0FyclBvc107XHJcbiAgICB0aGlzLmNvbnRleHREYXRhLmNPID0gcG9wcGVkO1xyXG4gICAgdGhpcy5jYW52YXNDb250ZXh0Lmdsb2JhbEFscGhhID0gcG9wcGVkO1xyXG59O1xyXG5cclxuQ2FudmFzUmVuZGVyZXIucHJvdG90eXBlLmNvbmZpZ0FuaW1hdGlvbiA9IGZ1bmN0aW9uKGFuaW1EYXRhKXtcclxuICAgIGlmKHRoaXMuYW5pbWF0aW9uSXRlbS53cmFwcGVyKXtcclxuICAgICAgICB0aGlzLmFuaW1hdGlvbkl0ZW0uY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7XHJcbiAgICAgICAgdGhpcy5hbmltYXRpb25JdGVtLmNvbnRhaW5lci5zdHlsZS53aWR0aCA9ICcxMDAlJztcclxuICAgICAgICB0aGlzLmFuaW1hdGlvbkl0ZW0uY29udGFpbmVyLnN0eWxlLmhlaWdodCA9ICcxMDAlJztcclxuICAgICAgICAvL3RoaXMuYW5pbWF0aW9uSXRlbS5jb250YWluZXIuc3R5bGUudHJhbnNmb3JtID0gJ3RyYW5zbGF0ZTNkKDAsMCwwKSc7XHJcbiAgICAgICAgLy90aGlzLmFuaW1hdGlvbkl0ZW0uY29udGFpbmVyLnN0eWxlLndlYmtpdFRyYW5zZm9ybSA9ICd0cmFuc2xhdGUzZCgwLDAsMCknO1xyXG4gICAgICAgIHRoaXMuYW5pbWF0aW9uSXRlbS5jb250YWluZXIuc3R5bGUudHJhbnNmb3JtT3JpZ2luID0gdGhpcy5hbmltYXRpb25JdGVtLmNvbnRhaW5lci5zdHlsZS5tb3pUcmFuc2Zvcm1PcmlnaW4gPSB0aGlzLmFuaW1hdGlvbkl0ZW0uY29udGFpbmVyLnN0eWxlLndlYmtpdFRyYW5zZm9ybU9yaWdpbiA9IHRoaXMuYW5pbWF0aW9uSXRlbS5jb250YWluZXIuc3R5bGVbJy13ZWJraXQtdHJhbnNmb3JtJ10gPSBcIjBweCAwcHggMHB4XCI7XHJcbiAgICAgICAgdGhpcy5hbmltYXRpb25JdGVtLndyYXBwZXIuYXBwZW5kQ2hpbGQodGhpcy5hbmltYXRpb25JdGVtLmNvbnRhaW5lcik7XHJcbiAgICAgICAgdGhpcy5jYW52YXNDb250ZXh0ID0gdGhpcy5hbmltYXRpb25JdGVtLmNvbnRhaW5lci5nZXRDb250ZXh0KCcyZCcpO1xyXG4gICAgfWVsc2V7XHJcbiAgICAgICAgdGhpcy5jYW52YXNDb250ZXh0ID0gdGhpcy5yZW5kZXJDb25maWcuY29udGV4dDtcclxuICAgIH1cclxuICAgIHRoaXMuZGF0YSA9IGFuaW1EYXRhO1xyXG4gICAgdGhpcy5nbG9iYWxEYXRhLmNhbnZhc0NvbnRleHQgPSB0aGlzLmNhbnZhc0NvbnRleHQ7XHJcbiAgICB0aGlzLmdsb2JhbERhdGEucmVuZGVyZXIgPSB0aGlzO1xyXG4gICAgdGhpcy5nbG9iYWxEYXRhLmlzRGFzaGVkID0gZmFsc2U7XHJcbiAgICB0aGlzLmdsb2JhbERhdGEudG90YWxGcmFtZXMgPSBNYXRoLmZsb29yKGFuaW1EYXRhLnRmKTtcclxuICAgIHRoaXMuZ2xvYmFsRGF0YS5jb21wV2lkdGggPSBhbmltRGF0YS53O1xyXG4gICAgdGhpcy5nbG9iYWxEYXRhLmNvbXBIZWlnaHQgPSBhbmltRGF0YS5oO1xyXG4gICAgdGhpcy5nbG9iYWxEYXRhLmZyYW1lUmF0ZSA9IGFuaW1EYXRhLmZyO1xyXG4gICAgdGhpcy5nbG9iYWxEYXRhLmZyYW1lSWQgPSAwO1xyXG4gICAgdGhpcy5nbG9iYWxEYXRhLmNvbXBTaXplID0ge1xyXG4gICAgICAgIHc6IGFuaW1EYXRhLncsXHJcbiAgICAgICAgaDogYW5pbURhdGEuaFxyXG4gICAgfTtcclxuICAgIHRoaXMuZ2xvYmFsRGF0YS5wcm9ncmVzc2l2ZUxvYWQgPSB0aGlzLnJlbmRlckNvbmZpZy5wcm9ncmVzc2l2ZUxvYWQ7XHJcbiAgICB0aGlzLmxheWVycyA9IGFuaW1EYXRhLmxheWVycztcclxuICAgIHRoaXMudHJhbnNmb3JtQ2FudmFzID0ge307XHJcbiAgICB0aGlzLnRyYW5zZm9ybUNhbnZhcy53ID0gYW5pbURhdGEudztcclxuICAgIHRoaXMudHJhbnNmb3JtQ2FudmFzLmggPSBhbmltRGF0YS5oO1xyXG4gICAgdGhpcy5nbG9iYWxEYXRhLmZvbnRNYW5hZ2VyID0gbmV3IEZvbnRNYW5hZ2VyKCk7XHJcbiAgICB0aGlzLmdsb2JhbERhdGEuZm9udE1hbmFnZXIuYWRkQ2hhcnMoYW5pbURhdGEuY2hhcnMpO1xyXG4gICAgdGhpcy5nbG9iYWxEYXRhLmZvbnRNYW5hZ2VyLmFkZEZvbnRzKGFuaW1EYXRhLmZvbnRzLGRvY3VtZW50LmJvZHkpO1xyXG4gICAgdGhpcy5nbG9iYWxEYXRhLmdldEFzc2V0RGF0YSA9IHRoaXMuYW5pbWF0aW9uSXRlbS5nZXRBc3NldERhdGEuYmluZCh0aGlzLmFuaW1hdGlvbkl0ZW0pO1xyXG4gICAgdGhpcy5nbG9iYWxEYXRhLmdldEFzc2V0c1BhdGggPSB0aGlzLmFuaW1hdGlvbkl0ZW0uZ2V0QXNzZXRzUGF0aC5iaW5kKHRoaXMuYW5pbWF0aW9uSXRlbSk7XHJcbiAgICB0aGlzLmdsb2JhbERhdGEuZWxlbWVudExvYWRlZCA9IHRoaXMuYW5pbWF0aW9uSXRlbS5lbGVtZW50TG9hZGVkLmJpbmQodGhpcy5hbmltYXRpb25JdGVtKTtcclxuICAgIHRoaXMuZ2xvYmFsRGF0YS5hZGRQZW5kaW5nRWxlbWVudCA9IHRoaXMuYW5pbWF0aW9uSXRlbS5hZGRQZW5kaW5nRWxlbWVudC5iaW5kKHRoaXMuYW5pbWF0aW9uSXRlbSk7XHJcbiAgICB0aGlzLmdsb2JhbERhdGEudHJhbnNmb3JtQ2FudmFzID0gdGhpcy50cmFuc2Zvcm1DYW52YXM7XHJcbiAgICB0aGlzLmVsZW1lbnRzID0gQXJyYXkuYXBwbHkobnVsbCx7bGVuZ3RoOmFuaW1EYXRhLmxheWVycy5sZW5ndGh9KTtcclxuXHJcbiAgICB0aGlzLnVwZGF0ZUNvbnRhaW5lclNpemUoKTtcclxufTtcclxuXHJcbkNhbnZhc1JlbmRlcmVyLnByb3RvdHlwZS51cGRhdGVDb250YWluZXJTaXplID0gZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIGVsZW1lbnRXaWR0aCxlbGVtZW50SGVpZ2h0O1xyXG4gICAgaWYodGhpcy5hbmltYXRpb25JdGVtLndyYXBwZXIgJiYgdGhpcy5hbmltYXRpb25JdGVtLmNvbnRhaW5lcil7XHJcbiAgICAgICAgZWxlbWVudFdpZHRoID0gdGhpcy5hbmltYXRpb25JdGVtLndyYXBwZXIub2Zmc2V0V2lkdGg7XHJcbiAgICAgICAgZWxlbWVudEhlaWdodCA9IHRoaXMuYW5pbWF0aW9uSXRlbS53cmFwcGVyLm9mZnNldEhlaWdodDtcclxuICAgICAgICB0aGlzLmFuaW1hdGlvbkl0ZW0uY29udGFpbmVyLnNldEF0dHJpYnV0ZSgnd2lkdGgnLGVsZW1lbnRXaWR0aCAqIHRoaXMucmVuZGVyQ29uZmlnLmRwciApO1xyXG4gICAgICAgIHRoaXMuYW5pbWF0aW9uSXRlbS5jb250YWluZXIuc2V0QXR0cmlidXRlKCdoZWlnaHQnLGVsZW1lbnRIZWlnaHQgKiB0aGlzLnJlbmRlckNvbmZpZy5kcHIpO1xyXG4gICAgfWVsc2V7XHJcbiAgICAgICAgZWxlbWVudFdpZHRoID0gdGhpcy5jYW52YXNDb250ZXh0LmNhbnZhcy53aWR0aCAqIHRoaXMucmVuZGVyQ29uZmlnLmRwcjtcclxuICAgICAgICBlbGVtZW50SGVpZ2h0ID0gdGhpcy5jYW52YXNDb250ZXh0LmNhbnZhcy5oZWlnaHQgKiB0aGlzLnJlbmRlckNvbmZpZy5kcHI7XHJcbiAgICB9XHJcbiAgICB2YXIgZWxlbWVudFJlbCxhbmltYXRpb25SZWw7XHJcbiAgICBpZih0aGlzLnJlbmRlckNvbmZpZy5wcmVzZXJ2ZUFzcGVjdFJhdGlvLmluZGV4T2YoJ21lZXQnKSAhPT0gLTEgfHwgdGhpcy5yZW5kZXJDb25maWcucHJlc2VydmVBc3BlY3RSYXRpby5pbmRleE9mKCdzbGljZScpICE9PSAtMSl7XHJcbiAgICAgICAgdmFyIHBhciA9IHRoaXMucmVuZGVyQ29uZmlnLnByZXNlcnZlQXNwZWN0UmF0aW8uc3BsaXQoJyAnKTtcclxuICAgICAgICB2YXIgZmlsbFR5cGUgPSBwYXJbMV0gfHwgJ21lZXQnO1xyXG4gICAgICAgIHZhciBwb3MgPSBwYXJbMF0gfHwgJ3hNaWRZTWlkJztcclxuICAgICAgICB2YXIgeFBvcyA9IHBvcy5zdWJzdHIoMCw0KTtcclxuICAgICAgICB2YXIgeVBvcyA9IHBvcy5zdWJzdHIoNCk7XHJcbiAgICAgICAgZWxlbWVudFJlbCA9IGVsZW1lbnRXaWR0aC9lbGVtZW50SGVpZ2h0O1xyXG4gICAgICAgIGFuaW1hdGlvblJlbCA9IHRoaXMudHJhbnNmb3JtQ2FudmFzLncvdGhpcy50cmFuc2Zvcm1DYW52YXMuaDtcclxuICAgICAgICBpZihhbmltYXRpb25SZWw+ZWxlbWVudFJlbCAmJiBmaWxsVHlwZSA9PT0gJ21lZXQnIHx8IGFuaW1hdGlvblJlbDxlbGVtZW50UmVsICYmIGZpbGxUeXBlID09PSAnc2xpY2UnKXtcclxuICAgICAgICAgICAgdGhpcy50cmFuc2Zvcm1DYW52YXMuc3ggPSBlbGVtZW50V2lkdGgvKHRoaXMudHJhbnNmb3JtQ2FudmFzLncvdGhpcy5yZW5kZXJDb25maWcuZHByKTtcclxuICAgICAgICAgICAgdGhpcy50cmFuc2Zvcm1DYW52YXMuc3kgPSBlbGVtZW50V2lkdGgvKHRoaXMudHJhbnNmb3JtQ2FudmFzLncvdGhpcy5yZW5kZXJDb25maWcuZHByKTtcclxuICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgdGhpcy50cmFuc2Zvcm1DYW52YXMuc3ggPSBlbGVtZW50SGVpZ2h0Lyh0aGlzLnRyYW5zZm9ybUNhbnZhcy5oIC8gdGhpcy5yZW5kZXJDb25maWcuZHByKTtcclxuICAgICAgICAgICAgdGhpcy50cmFuc2Zvcm1DYW52YXMuc3kgPSBlbGVtZW50SGVpZ2h0Lyh0aGlzLnRyYW5zZm9ybUNhbnZhcy5oIC8gdGhpcy5yZW5kZXJDb25maWcuZHByKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmKHhQb3MgPT09ICd4TWlkJyAmJiAoKGFuaW1hdGlvblJlbDxlbGVtZW50UmVsICYmIGZpbGxUeXBlPT09J21lZXQnKSB8fCAoYW5pbWF0aW9uUmVsPmVsZW1lbnRSZWwgJiYgZmlsbFR5cGUgPT09ICdzbGljZScpKSl7XHJcbiAgICAgICAgICAgIHRoaXMudHJhbnNmb3JtQ2FudmFzLnR4ID0gKGVsZW1lbnRXaWR0aC10aGlzLnRyYW5zZm9ybUNhbnZhcy53KihlbGVtZW50SGVpZ2h0L3RoaXMudHJhbnNmb3JtQ2FudmFzLmgpKS8yKnRoaXMucmVuZGVyQ29uZmlnLmRwcjtcclxuICAgICAgICB9IGVsc2UgaWYoeFBvcyA9PT0gJ3hNYXgnICYmICgoYW5pbWF0aW9uUmVsPGVsZW1lbnRSZWwgJiYgZmlsbFR5cGU9PT0nbWVldCcpIHx8IChhbmltYXRpb25SZWw+ZWxlbWVudFJlbCAmJiBmaWxsVHlwZSA9PT0gJ3NsaWNlJykpKXtcclxuICAgICAgICAgICAgdGhpcy50cmFuc2Zvcm1DYW52YXMudHggPSAoZWxlbWVudFdpZHRoLXRoaXMudHJhbnNmb3JtQ2FudmFzLncqKGVsZW1lbnRIZWlnaHQvdGhpcy50cmFuc2Zvcm1DYW52YXMuaCkpKnRoaXMucmVuZGVyQ29uZmlnLmRwcjtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLnRyYW5zZm9ybUNhbnZhcy50eCA9IDA7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmKHlQb3MgPT09ICdZTWlkJyAmJiAoKGFuaW1hdGlvblJlbD5lbGVtZW50UmVsICYmIGZpbGxUeXBlPT09J21lZXQnKSB8fCAoYW5pbWF0aW9uUmVsPGVsZW1lbnRSZWwgJiYgZmlsbFR5cGUgPT09ICdzbGljZScpKSl7XHJcbiAgICAgICAgICAgIHRoaXMudHJhbnNmb3JtQ2FudmFzLnR5ID0gKChlbGVtZW50SGVpZ2h0LXRoaXMudHJhbnNmb3JtQ2FudmFzLmgqKGVsZW1lbnRXaWR0aC90aGlzLnRyYW5zZm9ybUNhbnZhcy53KSkvMikqdGhpcy5yZW5kZXJDb25maWcuZHByO1xyXG4gICAgICAgIH0gZWxzZSBpZih5UG9zID09PSAnWU1heCcgJiYgKChhbmltYXRpb25SZWw+ZWxlbWVudFJlbCAmJiBmaWxsVHlwZT09PSdtZWV0JykgfHwgKGFuaW1hdGlvblJlbDxlbGVtZW50UmVsICYmIGZpbGxUeXBlID09PSAnc2xpY2UnKSkpe1xyXG4gICAgICAgICAgICB0aGlzLnRyYW5zZm9ybUNhbnZhcy50eSA9ICgoZWxlbWVudEhlaWdodC10aGlzLnRyYW5zZm9ybUNhbnZhcy5oKihlbGVtZW50V2lkdGgvdGhpcy50cmFuc2Zvcm1DYW52YXMudykpKSp0aGlzLnJlbmRlckNvbmZpZy5kcHI7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy50cmFuc2Zvcm1DYW52YXMudHkgPSAwO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICB9ZWxzZSBpZih0aGlzLnJlbmRlckNvbmZpZy5wcmVzZXJ2ZUFzcGVjdFJhdGlvID09ICdub25lJyl7XHJcbiAgICAgICAgdGhpcy50cmFuc2Zvcm1DYW52YXMuc3ggPSBlbGVtZW50V2lkdGgvKHRoaXMudHJhbnNmb3JtQ2FudmFzLncvdGhpcy5yZW5kZXJDb25maWcuZHByKTtcclxuICAgICAgICB0aGlzLnRyYW5zZm9ybUNhbnZhcy5zeSA9IGVsZW1lbnRIZWlnaHQvKHRoaXMudHJhbnNmb3JtQ2FudmFzLmgvdGhpcy5yZW5kZXJDb25maWcuZHByKTtcclxuICAgICAgICB0aGlzLnRyYW5zZm9ybUNhbnZhcy50eCA9IDA7XHJcbiAgICAgICAgdGhpcy50cmFuc2Zvcm1DYW52YXMudHkgPSAwO1xyXG4gICAgfWVsc2V7XHJcbiAgICAgICAgdGhpcy50cmFuc2Zvcm1DYW52YXMuc3ggPSB0aGlzLnJlbmRlckNvbmZpZy5kcHI7XHJcbiAgICAgICAgdGhpcy50cmFuc2Zvcm1DYW52YXMuc3kgPSB0aGlzLnJlbmRlckNvbmZpZy5kcHI7XHJcbiAgICAgICAgdGhpcy50cmFuc2Zvcm1DYW52YXMudHggPSAwO1xyXG4gICAgICAgIHRoaXMudHJhbnNmb3JtQ2FudmFzLnR5ID0gMDtcclxuICAgIH1cclxuICAgIHRoaXMudHJhbnNmb3JtQ2FudmFzLnByb3BzID0gW3RoaXMudHJhbnNmb3JtQ2FudmFzLnN4LDAsMCwwLDAsdGhpcy50cmFuc2Zvcm1DYW52YXMuc3ksMCwwLDAsMCwxLDAsdGhpcy50cmFuc2Zvcm1DYW52YXMudHgsdGhpcy50cmFuc2Zvcm1DYW52YXMudHksMCwxXTtcclxuICAgIHZhciBpLCBsZW4gPSB0aGlzLmVsZW1lbnRzLmxlbmd0aDtcclxuICAgIGZvcihpPTA7aTxsZW47aSs9MSl7XHJcbiAgICAgICAgaWYodGhpcy5lbGVtZW50c1tpXSAmJiB0aGlzLmVsZW1lbnRzW2ldLmRhdGEudHkgPT09IDApe1xyXG4gICAgICAgICAgICB0aGlzLmVsZW1lbnRzW2ldLnJlc2l6ZSh0aGlzLmdsb2JhbERhdGEudHJhbnNmb3JtQ2FudmFzKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn07XHJcblxyXG5DYW52YXNSZW5kZXJlci5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uICgpIHtcclxuICAgIGlmKHRoaXMucmVuZGVyQ29uZmlnLmNsZWFyQ2FudmFzKSB7XHJcbiAgICAgICAgdGhpcy5hbmltYXRpb25JdGVtLndyYXBwZXIuaW5uZXJIVE1MID0gJyc7XHJcbiAgICB9XHJcbiAgICB2YXIgaSwgbGVuID0gdGhpcy5sYXllcnMgPyB0aGlzLmxheWVycy5sZW5ndGggOiAwO1xyXG4gICAgZm9yIChpID0gbGVuIC0gMTsgaSA+PSAwOyBpLT0xKSB7XHJcbiAgICAgICAgdGhpcy5lbGVtZW50c1tpXS5kZXN0cm95KCk7XHJcbiAgICB9XHJcbiAgICB0aGlzLmVsZW1lbnRzLmxlbmd0aCA9IDA7XHJcbiAgICB0aGlzLmdsb2JhbERhdGEuY2FudmFzQ29udGV4dCA9IG51bGw7XHJcbiAgICB0aGlzLmFuaW1hdGlvbkl0ZW0uY29udGFpbmVyID0gbnVsbDtcclxuICAgIHRoaXMuZGVzdHJveWVkID0gdHJ1ZTtcclxufTtcclxuXHJcbkNhbnZhc1JlbmRlcmVyLnByb3RvdHlwZS5yZW5kZXJGcmFtZSA9IGZ1bmN0aW9uKG51bSl7XHJcbiAgICBpZigodGhpcy5yZW5kZXJlZEZyYW1lID09IG51bSAmJiB0aGlzLnJlbmRlckNvbmZpZy5jbGVhckNhbnZhcyA9PT0gdHJ1ZSkgfHwgdGhpcy5kZXN0cm95ZWQgfHwgbnVtID09PSBudWxsKXtcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICB0aGlzLnJlbmRlcmVkRnJhbWUgPSBudW07XHJcbiAgICB0aGlzLmdsb2JhbERhdGEuZnJhbWVOdW0gPSBudW0gLSB0aGlzLmFuaW1hdGlvbkl0ZW0uZmlyc3RGcmFtZTtcclxuICAgIHRoaXMuZ2xvYmFsRGF0YS5mcmFtZUlkICs9IDE7XHJcbiAgICB0aGlzLmdsb2JhbERhdGEucHJvamVjdEludGVyZmFjZS5jdXJyZW50RnJhbWUgPSBudW07XHJcbiAgICBpZih0aGlzLnJlbmRlckNvbmZpZy5jbGVhckNhbnZhcyA9PT0gdHJ1ZSl7XHJcbiAgICAgICAgdGhpcy5yZXNldCgpO1xyXG4gICAgICAgIHRoaXMuY2FudmFzQ29udGV4dC5zYXZlKCk7XHJcbiAgICAgICAgLy90aGlzLmNhbnZhc0NvbnRleHQuY2FudmFzLndpZHRoID0gdGhpcy5jYW52YXNDb250ZXh0LmNhbnZhcy53aWR0aDtcclxuICAgICAgICB0aGlzLmNhbnZhc0NvbnRleHQuY2xlYXJSZWN0KHRoaXMudHJhbnNmb3JtQ2FudmFzLnR4LCB0aGlzLnRyYW5zZm9ybUNhbnZhcy50eSwgdGhpcy50cmFuc2Zvcm1DYW52YXMudyp0aGlzLnRyYW5zZm9ybUNhbnZhcy5zeCwgdGhpcy50cmFuc2Zvcm1DYW52YXMuaCp0aGlzLnRyYW5zZm9ybUNhbnZhcy5zeSk7XHJcbiAgICB9ZWxzZXtcclxuICAgICAgICB0aGlzLnNhdmUoKTtcclxuICAgIH1cclxuICAgIHRoaXMuY3R4VHJhbnNmb3JtKHRoaXMudHJhbnNmb3JtQ2FudmFzLnByb3BzKTtcclxuICAgIHRoaXMuY2FudmFzQ29udGV4dC5iZWdpblBhdGgoKTtcclxuICAgIHRoaXMuY2FudmFzQ29udGV4dC5yZWN0KDAsMCx0aGlzLnRyYW5zZm9ybUNhbnZhcy53LHRoaXMudHJhbnNmb3JtQ2FudmFzLmgpO1xyXG4gICAgdGhpcy5jYW52YXNDb250ZXh0LmNsb3NlUGF0aCgpO1xyXG4gICAgdGhpcy5jYW52YXNDb250ZXh0LmNsaXAoKTtcclxuXHJcbiAgICAvL2NvbnNvbGUubG9nKCctLS0tLS0tLScpO1xyXG4gICAgLy9jb25zb2xlLmxvZygnTkVXOiAnLG51bSk7XHJcbiAgICB2YXIgaSwgbGVuID0gdGhpcy5sYXllcnMubGVuZ3RoO1xyXG4gICAgaWYoIXRoaXMuY29tcGxldGVMYXllcnMpe1xyXG4gICAgICAgIHRoaXMuY2hlY2tMYXllcnMobnVtKTtcclxuICAgIH1cclxuXHJcbiAgICBmb3IgKGkgPSAwOyBpIDwgbGVuOyBpKyspIHtcclxuICAgICAgICBpZih0aGlzLmNvbXBsZXRlTGF5ZXJzIHx8IHRoaXMuZWxlbWVudHNbaV0pe1xyXG4gICAgICAgICAgICB0aGlzLmVsZW1lbnRzW2ldLnByZXBhcmVGcmFtZShudW0gLSB0aGlzLmxheWVyc1tpXS5zdCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgZm9yIChpID0gbGVuIC0gMTsgaSA+PSAwOyBpLT0xKSB7XHJcbiAgICAgICAgaWYodGhpcy5jb21wbGV0ZUxheWVycyB8fCB0aGlzLmVsZW1lbnRzW2ldKXtcclxuICAgICAgICAgICAgdGhpcy5lbGVtZW50c1tpXS5yZW5kZXJGcmFtZSgpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGlmKHRoaXMucmVuZGVyQ29uZmlnLmNsZWFyQ2FudmFzICE9PSB0cnVlKXtcclxuICAgICAgICB0aGlzLnJlc3RvcmUoKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdGhpcy5jYW52YXNDb250ZXh0LnJlc3RvcmUoKTtcclxuICAgIH1cclxufTtcclxuXHJcbkNhbnZhc1JlbmRlcmVyLnByb3RvdHlwZS5idWlsZEl0ZW0gPSBmdW5jdGlvbihwb3Mpe1xyXG4gICAgdmFyIGVsZW1lbnRzID0gdGhpcy5lbGVtZW50cztcclxuICAgIGlmKGVsZW1lbnRzW3Bvc10gfHwgdGhpcy5sYXllcnNbcG9zXS50eSA9PSA5OSl7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgdmFyIGVsZW1lbnQgPSB0aGlzLmNyZWF0ZUl0ZW0odGhpcy5sYXllcnNbcG9zXSwgdGhpcyx0aGlzLmdsb2JhbERhdGEpO1xyXG4gICAgZWxlbWVudHNbcG9zXSA9IGVsZW1lbnQ7XHJcbiAgICBlbGVtZW50LmluaXRFeHByZXNzaW9ucygpO1xyXG4gICAgaWYodGhpcy5sYXllcnNbcG9zXS50eSA9PT0gMCl7XHJcbiAgICAgICAgZWxlbWVudC5yZXNpemUodGhpcy5nbG9iYWxEYXRhLnRyYW5zZm9ybUNhbnZhcyk7XHJcbiAgICB9XHJcbn07XHJcblxyXG5DYW52YXNSZW5kZXJlci5wcm90b3R5cGUuY2hlY2tQZW5kaW5nRWxlbWVudHMgID0gZnVuY3Rpb24oKXtcclxuICAgIHdoaWxlKHRoaXMucGVuZGluZ0VsZW1lbnRzLmxlbmd0aCl7XHJcbiAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLnBlbmRpbmdFbGVtZW50cy5wb3AoKTtcclxuICAgICAgICBlbGVtZW50LmNoZWNrUGFyZW50aW5nKCk7XHJcbiAgICB9XHJcbn07XHJcblxyXG5DYW52YXNSZW5kZXJlci5wcm90b3R5cGUuaGlkZSA9IGZ1bmN0aW9uKCl7XHJcbiAgICB0aGlzLmFuaW1hdGlvbkl0ZW0uY29udGFpbmVyLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XHJcbn07XHJcblxyXG5DYW52YXNSZW5kZXJlci5wcm90b3R5cGUuc2hvdyA9IGZ1bmN0aW9uKCl7XHJcbiAgICB0aGlzLmFuaW1hdGlvbkl0ZW0uY29udGFpbmVyLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snO1xyXG59O1xyXG5cclxuQ2FudmFzUmVuZGVyZXIucHJvdG90eXBlLnNlYXJjaEV4dHJhQ29tcG9zaXRpb25zID0gZnVuY3Rpb24oYXNzZXRzKXtcclxuICAgIHZhciBpLCBsZW4gPSBhc3NldHMubGVuZ3RoO1xyXG4gICAgdmFyIGZsb2F0aW5nQ29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKHN2Z05TLCdnJyk7XHJcbiAgICBmb3IoaT0wO2k8bGVuO2krPTEpe1xyXG4gICAgICAgIGlmKGFzc2V0c1tpXS54dCl7XHJcbiAgICAgICAgICAgIHZhciBjb21wID0gdGhpcy5jcmVhdGVDb21wKGFzc2V0c1tpXSx0aGlzLmdsb2JhbERhdGEuY29tcCx0aGlzLmdsb2JhbERhdGEpO1xyXG4gICAgICAgICAgICBjb21wLmluaXRFeHByZXNzaW9ucygpO1xyXG4gICAgICAgICAgICAvL2NvbXAuY29tcEludGVyZmFjZSA9IENvbXBFeHByZXNzaW9uSW50ZXJmYWNlKGNvbXApO1xyXG4gICAgICAgICAgICAvL0V4cHJlc3Npb25zLmFkZExheWVyc0ludGVyZmFjZShjb21wLmVsZW1lbnRzLCB0aGlzLmdsb2JhbERhdGEucHJvamVjdEludGVyZmFjZSk7XHJcbiAgICAgICAgICAgIHRoaXMuZ2xvYmFsRGF0YS5wcm9qZWN0SW50ZXJmYWNlLnJlZ2lzdGVyQ29tcG9zaXRpb24oY29tcCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59O1xuZnVuY3Rpb24gSHlicmlkUmVuZGVyZXIoYW5pbWF0aW9uSXRlbSl7XHJcbiAgICB0aGlzLmFuaW1hdGlvbkl0ZW0gPSBhbmltYXRpb25JdGVtO1xyXG4gICAgdGhpcy5sYXllcnMgPSBudWxsO1xyXG4gICAgdGhpcy5yZW5kZXJlZEZyYW1lID0gLTE7XHJcbiAgICB0aGlzLmdsb2JhbERhdGEgPSB7XHJcbiAgICAgICAgZnJhbWVOdW06IC0xXHJcbiAgICB9O1xyXG4gICAgdGhpcy5wZW5kaW5nRWxlbWVudHMgPSBbXTtcclxuICAgIHRoaXMuZWxlbWVudHMgPSBbXTtcclxuICAgIHRoaXMudGhyZWVERWxlbWVudHMgPSBbXTtcclxuICAgIHRoaXMuZGVzdHJveWVkID0gZmFsc2U7XHJcbiAgICB0aGlzLmNhbWVyYSA9IG51bGw7XHJcbiAgICB0aGlzLnN1cHBvcnRzM2QgPSB0cnVlO1xyXG5cclxufVxyXG5cclxuZXh0ZW5kUHJvdG90eXBlKEJhc2VSZW5kZXJlcixIeWJyaWRSZW5kZXJlcik7XHJcblxyXG5IeWJyaWRSZW5kZXJlci5wcm90b3R5cGUuYnVpbGRJdGVtID0gU1ZHUmVuZGVyZXIucHJvdG90eXBlLmJ1aWxkSXRlbTtcclxuXHJcbkh5YnJpZFJlbmRlcmVyLnByb3RvdHlwZS5jaGVja1BlbmRpbmdFbGVtZW50cyAgPSBmdW5jdGlvbigpe1xyXG4gICAgd2hpbGUodGhpcy5wZW5kaW5nRWxlbWVudHMubGVuZ3RoKXtcclxuICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMucGVuZGluZ0VsZW1lbnRzLnBvcCgpO1xyXG4gICAgICAgIGVsZW1lbnQuY2hlY2tQYXJlbnRpbmcoKTtcclxuICAgIH1cclxufTtcclxuXHJcbkh5YnJpZFJlbmRlcmVyLnByb3RvdHlwZS5hcHBlbmRFbGVtZW50SW5Qb3MgPSBmdW5jdGlvbihlbGVtZW50LCBwb3Mpe1xyXG4gICAgdmFyIG5ld0VsZW1lbnQgPSBlbGVtZW50LmdldEJhc2VFbGVtZW50KCk7XHJcbiAgICBpZighbmV3RWxlbWVudCl7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgdmFyIGxheWVyID0gdGhpcy5sYXllcnNbcG9zXTtcclxuICAgIGlmKCFsYXllci5kZGQgfHwgIXRoaXMuc3VwcG9ydHMzZCl7XHJcbiAgICAgICAgdmFyIGkgPSAwO1xyXG4gICAgICAgIHZhciBuZXh0RWxlbWVudDtcclxuICAgICAgICB3aGlsZShpPHBvcyl7XHJcbiAgICAgICAgICAgIGlmKHRoaXMuZWxlbWVudHNbaV0gJiYgdGhpcy5lbGVtZW50c1tpXSE9PSB0cnVlICYmIHRoaXMuZWxlbWVudHNbaV0uZ2V0QmFzZUVsZW1lbnQpe1xyXG4gICAgICAgICAgICAgICAgbmV4dEVsZW1lbnQgPSB0aGlzLmVsZW1lbnRzW2ldLmdldEJhc2VFbGVtZW50KCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaSArPSAxO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZihuZXh0RWxlbWVudCl7XHJcbiAgICAgICAgICAgIGlmKCFsYXllci5kZGQgfHwgIXRoaXMuc3VwcG9ydHMzZCl7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmxheWVyRWxlbWVudC5pbnNlcnRCZWZvcmUobmV3RWxlbWVudCwgbmV4dEVsZW1lbnQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgaWYoIWxheWVyLmRkZCB8fCAhdGhpcy5zdXBwb3J0czNkKXtcclxuICAgICAgICAgICAgICAgIHRoaXMubGF5ZXJFbGVtZW50LmFwcGVuZENoaWxkKG5ld0VsZW1lbnQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICB0aGlzLmFkZFRvM2RDb250YWluZXIobmV3RWxlbWVudCxwb3MpO1xyXG4gICAgfVxyXG59O1xyXG5cclxuXHJcbkh5YnJpZFJlbmRlcmVyLnByb3RvdHlwZS5jcmVhdGVCYXNlID0gZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgIHJldHVybiBuZXcgU1ZHQmFzZUVsZW1lbnQoZGF0YSwgdGhpcy5sYXllckVsZW1lbnQsdGhpcy5nbG9iYWxEYXRhLHRoaXMpO1xyXG59O1xyXG5cclxuSHlicmlkUmVuZGVyZXIucHJvdG90eXBlLmNyZWF0ZVNoYXBlID0gZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgIGlmKCF0aGlzLnN1cHBvcnRzM2Qpe1xyXG4gICAgICAgIHJldHVybiBuZXcgSVNoYXBlRWxlbWVudChkYXRhLCB0aGlzLmxheWVyRWxlbWVudCx0aGlzLmdsb2JhbERhdGEsdGhpcyk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gbmV3IEhTaGFwZUVsZW1lbnQoZGF0YSwgdGhpcy5sYXllckVsZW1lbnQsdGhpcy5nbG9iYWxEYXRhLHRoaXMpO1xyXG59O1xyXG5cclxuSHlicmlkUmVuZGVyZXIucHJvdG90eXBlLmNyZWF0ZVRleHQgPSBmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgaWYoIXRoaXMuc3VwcG9ydHMzZCl7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBTVkdUZXh0RWxlbWVudChkYXRhLCB0aGlzLmxheWVyRWxlbWVudCx0aGlzLmdsb2JhbERhdGEsdGhpcyk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gbmV3IEhUZXh0RWxlbWVudChkYXRhLCB0aGlzLmxheWVyRWxlbWVudCx0aGlzLmdsb2JhbERhdGEsdGhpcyk7XHJcbn07XHJcblxyXG5IeWJyaWRSZW5kZXJlci5wcm90b3R5cGUuY3JlYXRlQ2FtZXJhID0gZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgIHRoaXMuY2FtZXJhID0gbmV3IEhDYW1lcmFFbGVtZW50KGRhdGEsIHRoaXMubGF5ZXJFbGVtZW50LHRoaXMuZ2xvYmFsRGF0YSx0aGlzKTtcclxuICAgIHJldHVybiB0aGlzLmNhbWVyYTtcclxufTtcclxuXHJcbkh5YnJpZFJlbmRlcmVyLnByb3RvdHlwZS5jcmVhdGVJbWFnZSA9IGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICBpZighdGhpcy5zdXBwb3J0czNkKXtcclxuICAgICAgICByZXR1cm4gbmV3IElJbWFnZUVsZW1lbnQoZGF0YSwgdGhpcy5sYXllckVsZW1lbnQsdGhpcy5nbG9iYWxEYXRhLHRoaXMpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIG5ldyBISW1hZ2VFbGVtZW50KGRhdGEsIHRoaXMubGF5ZXJFbGVtZW50LHRoaXMuZ2xvYmFsRGF0YSx0aGlzKTtcclxufTtcclxuXHJcbkh5YnJpZFJlbmRlcmVyLnByb3RvdHlwZS5jcmVhdGVDb21wID0gZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgIGlmKCF0aGlzLnN1cHBvcnRzM2Qpe1xyXG4gICAgICAgIHJldHVybiBuZXcgSUNvbXBFbGVtZW50KGRhdGEsIHRoaXMubGF5ZXJFbGVtZW50LHRoaXMuZ2xvYmFsRGF0YSx0aGlzKTtcclxuICAgIH1cclxuICAgIHJldHVybiBuZXcgSENvbXBFbGVtZW50KGRhdGEsIHRoaXMubGF5ZXJFbGVtZW50LHRoaXMuZ2xvYmFsRGF0YSx0aGlzKTtcclxuXHJcbn07XHJcblxyXG5IeWJyaWRSZW5kZXJlci5wcm90b3R5cGUuY3JlYXRlU29saWQgPSBmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgaWYoIXRoaXMuc3VwcG9ydHMzZCl7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBJU29saWRFbGVtZW50KGRhdGEsIHRoaXMubGF5ZXJFbGVtZW50LHRoaXMuZ2xvYmFsRGF0YSx0aGlzKTtcclxuICAgIH1cclxuICAgIHJldHVybiBuZXcgSFNvbGlkRWxlbWVudChkYXRhLCB0aGlzLmxheWVyRWxlbWVudCx0aGlzLmdsb2JhbERhdGEsdGhpcyk7XHJcbn07XHJcblxyXG5IeWJyaWRSZW5kZXJlci5wcm90b3R5cGUuZ2V0VGhyZWVEQ29udGFpbmVyID0gZnVuY3Rpb24ocG9zKXtcclxuICAgIHZhciBwZXJzcGVjdGl2ZUVsZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgIHN0eWxlRGl2KHBlcnNwZWN0aXZlRWxlbSk7XHJcbiAgICBwZXJzcGVjdGl2ZUVsZW0uc3R5bGUud2lkdGggPSB0aGlzLmdsb2JhbERhdGEuY29tcFNpemUudysncHgnO1xyXG4gICAgcGVyc3BlY3RpdmVFbGVtLnN0eWxlLmhlaWdodCA9IHRoaXMuZ2xvYmFsRGF0YS5jb21wU2l6ZS5oKydweCc7XHJcbiAgICBwZXJzcGVjdGl2ZUVsZW0uc3R5bGUudHJhbnNmb3JtT3JpZ2luID0gcGVyc3BlY3RpdmVFbGVtLnN0eWxlLm1velRyYW5zZm9ybU9yaWdpbiA9IHBlcnNwZWN0aXZlRWxlbS5zdHlsZS53ZWJraXRUcmFuc2Zvcm1PcmlnaW4gPSBcIjUwJSA1MCVcIjtcclxuICAgIHZhciBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgIHN0eWxlRGl2KGNvbnRhaW5lcik7XHJcbiAgICBjb250YWluZXIuc3R5bGUudHJhbnNmb3JtID0gY29udGFpbmVyLnN0eWxlLndlYmtpdFRyYW5zZm9ybSA9ICdtYXRyaXgzZCgxLDAsMCwwLDAsMSwwLDAsMCwwLDEsMCwwLDAsMCwxKSc7XHJcbiAgICBwZXJzcGVjdGl2ZUVsZW0uYXBwZW5kQ2hpbGQoY29udGFpbmVyKTtcclxuICAgIHRoaXMucmVzaXplckVsZW0uYXBwZW5kQ2hpbGQocGVyc3BlY3RpdmVFbGVtKTtcclxuICAgIHZhciB0aHJlZURDb250YWluZXJEYXRhID0ge1xyXG4gICAgICAgIGNvbnRhaW5lcjpjb250YWluZXIsXHJcbiAgICAgICAgcGVyc3BlY3RpdmVFbGVtOnBlcnNwZWN0aXZlRWxlbSxcclxuICAgICAgICBzdGFydFBvczogcG9zLFxyXG4gICAgICAgIGVuZFBvczogcG9zXHJcbiAgICB9O1xyXG4gICAgdGhpcy50aHJlZURFbGVtZW50cy5wdXNoKHRocmVlRENvbnRhaW5lckRhdGEpO1xyXG4gICAgcmV0dXJuIHRocmVlRENvbnRhaW5lckRhdGE7XHJcbn07XHJcblxyXG5IeWJyaWRSZW5kZXJlci5wcm90b3R5cGUuYnVpbGQzZENvbnRhaW5lcnMgPSBmdW5jdGlvbigpe1xyXG4gICAgdmFyIGksIGxlbiA9IHRoaXMubGF5ZXJzLmxlbmd0aDtcclxuICAgIHZhciBsYXN0VGhyZWVEQ29udGFpbmVyRGF0YTtcclxuICAgIGZvcihpPTA7aTxsZW47aSs9MSl7XHJcbiAgICAgICAgaWYodGhpcy5sYXllcnNbaV0uZGRkKXtcclxuICAgICAgICAgICAgaWYoIWxhc3RUaHJlZURDb250YWluZXJEYXRhKXtcclxuICAgICAgICAgICAgICAgIGxhc3RUaHJlZURDb250YWluZXJEYXRhID0gdGhpcy5nZXRUaHJlZURDb250YWluZXIoaSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgbGFzdFRocmVlRENvbnRhaW5lckRhdGEuZW5kUG9zID0gTWF0aC5tYXgobGFzdFRocmVlRENvbnRhaW5lckRhdGEuZW5kUG9zLGkpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGxhc3RUaHJlZURDb250YWluZXJEYXRhID0gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn07XHJcblxyXG5IeWJyaWRSZW5kZXJlci5wcm90b3R5cGUuYWRkVG8zZENvbnRhaW5lciA9IGZ1bmN0aW9uKGVsZW0scG9zKXtcclxuICAgIHZhciBpID0gMCwgbGVuID0gdGhpcy50aHJlZURFbGVtZW50cy5sZW5ndGg7XHJcbiAgICB3aGlsZShpPGxlbil7XHJcbiAgICAgICAgaWYocG9zIDw9IHRoaXMudGhyZWVERWxlbWVudHNbaV0uZW5kUG9zKXtcclxuICAgICAgICAgICAgdmFyIGogPSB0aGlzLnRocmVlREVsZW1lbnRzW2ldLnN0YXJ0UG9zO1xyXG4gICAgICAgICAgICB2YXIgbmV4dEVsZW1lbnQ7XHJcbiAgICAgICAgICAgIHdoaWxlKGo8cG9zKXtcclxuICAgICAgICAgICAgICAgIGlmKHRoaXMuZWxlbWVudHNbal0gJiYgdGhpcy5lbGVtZW50c1tqXS5nZXRCYXNlRWxlbWVudCl7XHJcbiAgICAgICAgICAgICAgICAgICAgbmV4dEVsZW1lbnQgPSB0aGlzLmVsZW1lbnRzW2pdLmdldEJhc2VFbGVtZW50KCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBqICs9IDE7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYobmV4dEVsZW1lbnQpe1xyXG4gICAgICAgICAgICAgICAgdGhpcy50aHJlZURFbGVtZW50c1tpXS5jb250YWluZXIuaW5zZXJ0QmVmb3JlKGVsZW0sIG5leHRFbGVtZW50KTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMudGhyZWVERWxlbWVudHNbaV0uY29udGFpbmVyLmFwcGVuZENoaWxkKGVsZW0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpICs9IDE7XHJcbiAgICB9XHJcbn07XHJcblxyXG5IeWJyaWRSZW5kZXJlci5wcm90b3R5cGUuY29uZmlnQW5pbWF0aW9uID0gZnVuY3Rpb24oYW5pbURhdGEpe1xyXG4gICAgdmFyIHJlc2l6ZXJFbGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICB2YXIgd3JhcHBlciA9IHRoaXMuYW5pbWF0aW9uSXRlbS53cmFwcGVyO1xyXG4gICAgcmVzaXplckVsZW0uc3R5bGUud2lkdGggPSBhbmltRGF0YS53KydweCc7XHJcbiAgICByZXNpemVyRWxlbS5zdHlsZS5oZWlnaHQgPSBhbmltRGF0YS5oKydweCc7XHJcbiAgICB0aGlzLnJlc2l6ZXJFbGVtID0gcmVzaXplckVsZW07XHJcbiAgICBzdHlsZURpdihyZXNpemVyRWxlbSk7XHJcbiAgICByZXNpemVyRWxlbS5zdHlsZS50cmFuc2Zvcm1TdHlsZSA9IHJlc2l6ZXJFbGVtLnN0eWxlLndlYmtpdFRyYW5zZm9ybVN0eWxlID0gcmVzaXplckVsZW0uc3R5bGUubW96VHJhbnNmb3JtU3R5bGUgPSBcImZsYXRcIjtcclxuICAgIHdyYXBwZXIuYXBwZW5kQ2hpbGQocmVzaXplckVsZW0pO1xyXG5cclxuICAgIHJlc2l6ZXJFbGVtLnN0eWxlLm92ZXJmbG93ID0gJ2hpZGRlbic7XHJcbiAgICB2YXIgc3ZnID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKHN2Z05TLCdzdmcnKTtcclxuICAgIHN2Zy5zZXRBdHRyaWJ1dGUoJ3dpZHRoJywnMScpO1xyXG4gICAgc3ZnLnNldEF0dHJpYnV0ZSgnaGVpZ2h0JywnMScpO1xyXG4gICAgc3R5bGVEaXYoc3ZnKTtcclxuICAgIHRoaXMucmVzaXplckVsZW0uYXBwZW5kQ2hpbGQoc3ZnKTtcclxuICAgIHZhciBkZWZzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKHN2Z05TLCdkZWZzJyk7XHJcbiAgICBzdmcuYXBwZW5kQ2hpbGQoZGVmcyk7XHJcbiAgICB0aGlzLmdsb2JhbERhdGEuZGVmcyA9IGRlZnM7XHJcbiAgICB0aGlzLmRhdGEgPSBhbmltRGF0YTtcclxuICAgIC8vTWFzayBhbmltYXRpb25cclxuICAgIHRoaXMuZ2xvYmFsRGF0YS5nZXRBc3NldERhdGEgPSB0aGlzLmFuaW1hdGlvbkl0ZW0uZ2V0QXNzZXREYXRhLmJpbmQodGhpcy5hbmltYXRpb25JdGVtKTtcclxuICAgIHRoaXMuZ2xvYmFsRGF0YS5nZXRBc3NldHNQYXRoID0gdGhpcy5hbmltYXRpb25JdGVtLmdldEFzc2V0c1BhdGguYmluZCh0aGlzLmFuaW1hdGlvbkl0ZW0pO1xyXG4gICAgdGhpcy5nbG9iYWxEYXRhLmVsZW1lbnRMb2FkZWQgPSB0aGlzLmFuaW1hdGlvbkl0ZW0uZWxlbWVudExvYWRlZC5iaW5kKHRoaXMuYW5pbWF0aW9uSXRlbSk7XHJcbiAgICB0aGlzLmdsb2JhbERhdGEuZnJhbWVJZCA9IDA7XHJcbiAgICB0aGlzLmdsb2JhbERhdGEuY29tcFNpemUgPSB7XHJcbiAgICAgICAgdzogYW5pbURhdGEudyxcclxuICAgICAgICBoOiBhbmltRGF0YS5oXHJcbiAgICB9O1xyXG4gICAgdGhpcy5nbG9iYWxEYXRhLmZyYW1lUmF0ZSA9IGFuaW1EYXRhLmZyO1xyXG4gICAgdGhpcy5sYXllcnMgPSBhbmltRGF0YS5sYXllcnM7XHJcbiAgICB0aGlzLmdsb2JhbERhdGEuZm9udE1hbmFnZXIgPSBuZXcgRm9udE1hbmFnZXIoKTtcclxuICAgIHRoaXMuZ2xvYmFsRGF0YS5mb250TWFuYWdlci5hZGRDaGFycyhhbmltRGF0YS5jaGFycyk7XHJcbiAgICB0aGlzLmdsb2JhbERhdGEuZm9udE1hbmFnZXIuYWRkRm9udHMoYW5pbURhdGEuZm9udHMsc3ZnKTtcclxuICAgIHRoaXMubGF5ZXJFbGVtZW50ID0gdGhpcy5yZXNpemVyRWxlbTtcclxuICAgIHRoaXMuYnVpbGQzZENvbnRhaW5lcnMoKTtcclxuICAgIHRoaXMudXBkYXRlQ29udGFpbmVyU2l6ZSgpO1xyXG59O1xyXG5cclxuSHlicmlkUmVuZGVyZXIucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICB0aGlzLmFuaW1hdGlvbkl0ZW0ud3JhcHBlci5pbm5lckhUTUwgPSAnJztcclxuICAgIHRoaXMuYW5pbWF0aW9uSXRlbS5jb250YWluZXIgPSBudWxsO1xyXG4gICAgdGhpcy5nbG9iYWxEYXRhLmRlZnMgPSBudWxsO1xyXG4gICAgdmFyIGksIGxlbiA9IHRoaXMubGF5ZXJzID8gdGhpcy5sYXllcnMubGVuZ3RoIDogMDtcclxuICAgIGZvciAoaSA9IDA7IGkgPCBsZW47IGkrKykge1xyXG4gICAgICAgIHRoaXMuZWxlbWVudHNbaV0uZGVzdHJveSgpO1xyXG4gICAgfVxyXG4gICAgdGhpcy5lbGVtZW50cy5sZW5ndGggPSAwO1xyXG4gICAgdGhpcy5kZXN0cm95ZWQgPSB0cnVlO1xyXG4gICAgdGhpcy5hbmltYXRpb25JdGVtID0gbnVsbDtcclxufTtcclxuXHJcbkh5YnJpZFJlbmRlcmVyLnByb3RvdHlwZS51cGRhdGVDb250YWluZXJTaXplID0gZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIGVsZW1lbnRXaWR0aCA9IHRoaXMuYW5pbWF0aW9uSXRlbS53cmFwcGVyLm9mZnNldFdpZHRoO1xyXG4gICAgdmFyIGVsZW1lbnRIZWlnaHQgPSB0aGlzLmFuaW1hdGlvbkl0ZW0ud3JhcHBlci5vZmZzZXRIZWlnaHQ7XHJcbiAgICB2YXIgZWxlbWVudFJlbCA9IGVsZW1lbnRXaWR0aC9lbGVtZW50SGVpZ2h0O1xyXG4gICAgdmFyIGFuaW1hdGlvblJlbCA9IHRoaXMuZ2xvYmFsRGF0YS5jb21wU2l6ZS53L3RoaXMuZ2xvYmFsRGF0YS5jb21wU2l6ZS5oO1xyXG4gICAgdmFyIHN4LHN5LHR4LHR5O1xyXG4gICAgaWYoYW5pbWF0aW9uUmVsPmVsZW1lbnRSZWwpe1xyXG4gICAgICAgIHN4ID0gZWxlbWVudFdpZHRoLyh0aGlzLmdsb2JhbERhdGEuY29tcFNpemUudyk7XHJcbiAgICAgICAgc3kgPSBlbGVtZW50V2lkdGgvKHRoaXMuZ2xvYmFsRGF0YS5jb21wU2l6ZS53KTtcclxuICAgICAgICB0eCA9IDA7XHJcbiAgICAgICAgdHkgPSAoKGVsZW1lbnRIZWlnaHQtdGhpcy5nbG9iYWxEYXRhLmNvbXBTaXplLmgqKGVsZW1lbnRXaWR0aC90aGlzLmdsb2JhbERhdGEuY29tcFNpemUudykpLzIpO1xyXG4gICAgfWVsc2V7XHJcbiAgICAgICAgc3ggPSBlbGVtZW50SGVpZ2h0Lyh0aGlzLmdsb2JhbERhdGEuY29tcFNpemUuaCk7XHJcbiAgICAgICAgc3kgPSBlbGVtZW50SGVpZ2h0Lyh0aGlzLmdsb2JhbERhdGEuY29tcFNpemUuaCk7XHJcbiAgICAgICAgdHggPSAoZWxlbWVudFdpZHRoLXRoaXMuZ2xvYmFsRGF0YS5jb21wU2l6ZS53KihlbGVtZW50SGVpZ2h0L3RoaXMuZ2xvYmFsRGF0YS5jb21wU2l6ZS5oKSkvMjtcclxuICAgICAgICB0eSA9IDA7XHJcbiAgICB9XHJcbiAgICB0aGlzLnJlc2l6ZXJFbGVtLnN0eWxlLnRyYW5zZm9ybSA9IHRoaXMucmVzaXplckVsZW0uc3R5bGUud2Via2l0VHJhbnNmb3JtID0gJ21hdHJpeDNkKCcgKyBzeCArICcsMCwwLDAsMCwnK3N5KycsMCwwLDAsMCwxLDAsJyt0eCsnLCcrdHkrJywwLDEpJztcclxufTtcclxuXHJcbkh5YnJpZFJlbmRlcmVyLnByb3RvdHlwZS5yZW5kZXJGcmFtZSA9IFNWR1JlbmRlcmVyLnByb3RvdHlwZS5yZW5kZXJGcmFtZTtcclxuXHJcbkh5YnJpZFJlbmRlcmVyLnByb3RvdHlwZS5oaWRlID0gZnVuY3Rpb24oKXtcclxuICAgIHRoaXMucmVzaXplckVsZW0uc3R5bGUuZGlzcGxheSA9ICdub25lJztcclxufTtcclxuXHJcbkh5YnJpZFJlbmRlcmVyLnByb3RvdHlwZS5zaG93ID0gZnVuY3Rpb24oKXtcclxuICAgIHRoaXMucmVzaXplckVsZW0uc3R5bGUuZGlzcGxheSA9ICdibG9jayc7XHJcbn07XHJcblxyXG5IeWJyaWRSZW5kZXJlci5wcm90b3R5cGUuaW5pdEl0ZW1zID0gZnVuY3Rpb24oKXtcclxuICAgIHRoaXMuYnVpbGRBbGxJdGVtcygpO1xyXG4gICAgaWYodGhpcy5jYW1lcmEpe1xyXG4gICAgICAgIHRoaXMuY2FtZXJhLnNldHVwKCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIHZhciBjV2lkdGggPSB0aGlzLmdsb2JhbERhdGEuY29tcFNpemUudztcclxuICAgICAgICB2YXIgY0hlaWdodCA9IHRoaXMuZ2xvYmFsRGF0YS5jb21wU2l6ZS5oO1xyXG4gICAgICAgIHZhciBpLCBsZW4gPSB0aGlzLnRocmVlREVsZW1lbnRzLmxlbmd0aDtcclxuICAgICAgICBmb3IoaT0wO2k8bGVuO2krPTEpe1xyXG4gICAgICAgICAgICB0aGlzLnRocmVlREVsZW1lbnRzW2ldLnBlcnNwZWN0aXZlRWxlbS5zdHlsZS5wZXJzcGVjdGl2ZSA9IHRoaXMudGhyZWVERWxlbWVudHNbaV0ucGVyc3BlY3RpdmVFbGVtLnN0eWxlLndlYmtpdFBlcnNwZWN0aXZlID0gTWF0aC5zcXJ0KE1hdGgucG93KGNXaWR0aCwyKSArIE1hdGgucG93KGNIZWlnaHQsMikpICsgJ3B4JztcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn07XHJcblxyXG5IeWJyaWRSZW5kZXJlci5wcm90b3R5cGUuc2VhcmNoRXh0cmFDb21wb3NpdGlvbnMgPSBmdW5jdGlvbihhc3NldHMpe1xyXG4gICAgdmFyIGksIGxlbiA9IGFzc2V0cy5sZW5ndGg7XHJcbiAgICB2YXIgZmxvYXRpbmdDb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgIGZvcihpPTA7aTxsZW47aSs9MSl7XHJcbiAgICAgICAgaWYoYXNzZXRzW2ldLnh0KXtcclxuICAgICAgICAgICAgdmFyIGNvbXAgPSB0aGlzLmNyZWF0ZUNvbXAoYXNzZXRzW2ldLGZsb2F0aW5nQ29udGFpbmVyLHRoaXMuZ2xvYmFsRGF0YS5jb21wLG51bGwpO1xyXG4gICAgICAgICAgICBjb21wLmluaXRFeHByZXNzaW9ucygpO1xyXG4gICAgICAgICAgICB0aGlzLmdsb2JhbERhdGEucHJvamVjdEludGVyZmFjZS5yZWdpc3RlckNvbXBvc2l0aW9uKGNvbXApO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufTtcbmZ1bmN0aW9uIENWQmFzZUVsZW1lbnQoZGF0YSwgY29tcCxnbG9iYWxEYXRhKXtcclxuICAgIHRoaXMuZ2xvYmFsRGF0YSA9IGdsb2JhbERhdGE7XHJcbiAgICB0aGlzLmRhdGEgPSBkYXRhO1xyXG4gICAgdGhpcy5jb21wID0gY29tcDtcclxuICAgIHRoaXMuY2FudmFzQ29udGV4dCA9IGdsb2JhbERhdGEuY2FudmFzQ29udGV4dDtcclxuICAgIHRoaXMuaW5pdCgpO1xyXG59XHJcblxyXG5jcmVhdGVFbGVtZW50KEJhc2VFbGVtZW50LCBDVkJhc2VFbGVtZW50KTtcclxuXHJcbkNWQmFzZUVsZW1lbnQucHJvdG90eXBlLmNyZWF0ZUVsZW1lbnRzID0gZnVuY3Rpb24oKXtcclxuICAgIHRoaXMuY2hlY2tQYXJlbnRpbmcoKTtcclxufTtcclxuXHJcbkNWQmFzZUVsZW1lbnQucHJvdG90eXBlLmNoZWNrQmxlbmRNb2RlID0gZnVuY3Rpb24oZ2xvYmFsRGF0YSl7XHJcbiAgICBpZihnbG9iYWxEYXRhLmJsZW5kTW9kZSAhPT0gdGhpcy5kYXRhLmJtKSB7XHJcbiAgICAgICAgZ2xvYmFsRGF0YS5ibGVuZE1vZGUgPSB0aGlzLmRhdGEuYm07XHJcblxyXG4gICAgICAgIHZhciBibGVuZE1vZGVWYWx1ZSA9ICcnO1xyXG4gICAgICAgIHN3aXRjaCAodGhpcy5kYXRhLmJtKSB7XHJcbiAgICAgICAgICAgIGNhc2UgMDpcclxuICAgICAgICAgICAgICAgIGJsZW5kTW9kZVZhbHVlID0gJ25vcm1hbCc7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAxOlxyXG4gICAgICAgICAgICAgICAgYmxlbmRNb2RlVmFsdWUgPSAnbXVsdGlwbHknO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgMjpcclxuICAgICAgICAgICAgICAgIGJsZW5kTW9kZVZhbHVlID0gJ3NjcmVlbic7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAzOlxyXG4gICAgICAgICAgICAgICAgYmxlbmRNb2RlVmFsdWUgPSAnb3ZlcmxheSc7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSA0OlxyXG4gICAgICAgICAgICAgICAgYmxlbmRNb2RlVmFsdWUgPSAnZGFya2VuJztcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIDU6XHJcbiAgICAgICAgICAgICAgICBibGVuZE1vZGVWYWx1ZSA9ICdsaWdodGVuJztcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIDY6XHJcbiAgICAgICAgICAgICAgICBibGVuZE1vZGVWYWx1ZSA9ICdjb2xvci1kb2RnZSc7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSA3OlxyXG4gICAgICAgICAgICAgICAgYmxlbmRNb2RlVmFsdWUgPSAnY29sb3ItYnVybic7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSA4OlxyXG4gICAgICAgICAgICAgICAgYmxlbmRNb2RlVmFsdWUgPSAnaGFyZC1saWdodCc7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSA5OlxyXG4gICAgICAgICAgICAgICAgYmxlbmRNb2RlVmFsdWUgPSAnc29mdC1saWdodCc7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAxMDpcclxuICAgICAgICAgICAgICAgIGJsZW5kTW9kZVZhbHVlID0gJ2RpZmZlcmVuY2UnO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgMTE6XHJcbiAgICAgICAgICAgICAgICBibGVuZE1vZGVWYWx1ZSA9ICdleGNsdXNpb24nO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgMTI6XHJcbiAgICAgICAgICAgICAgICBibGVuZE1vZGVWYWx1ZSA9ICdodWUnO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgMTM6XHJcbiAgICAgICAgICAgICAgICBibGVuZE1vZGVWYWx1ZSA9ICdzYXR1cmF0aW9uJztcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIDE0OlxyXG4gICAgICAgICAgICAgICAgYmxlbmRNb2RlVmFsdWUgPSAnY29sb3InO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgMTU6XHJcbiAgICAgICAgICAgICAgICBibGVuZE1vZGVWYWx1ZSA9ICdsdW1pbm9zaXR5JztcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgICAgICBnbG9iYWxEYXRhLmNhbnZhc0NvbnRleHQuZ2xvYmFsQ29tcG9zaXRlT3BlcmF0aW9uID0gYmxlbmRNb2RlVmFsdWU7XHJcbiAgICB9XHJcbn07XHJcblxyXG5cclxuQ1ZCYXNlRWxlbWVudC5wcm90b3R5cGUucmVuZGVyRnJhbWUgPSBmdW5jdGlvbihwYXJlbnRUcmFuc2Zvcm0pe1xyXG4gICAgaWYodGhpcy5kYXRhLnR5ID09PSAzKXtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgICAgICAgdGhpcy5jaGVja0JsZW5kTW9kZSh0aGlzLmRhdGEudHkgPT09IDA/dGhpcy5wYXJlbnRHbG9iYWxEYXRhOnRoaXMuZ2xvYmFsRGF0YSk7XHJcblxyXG4gICAgaWYoIXRoaXMuaXNWaXNpYmxlKXtcclxuICAgICAgICByZXR1cm4gdGhpcy5pc1Zpc2libGU7XHJcbiAgICB9XHJcbiAgICB0aGlzLmZpbmFsVHJhbnNmb3JtLm9wTWRmID0gdGhpcy5maW5hbFRyYW5zZm9ybS5vcC5tZGY7XHJcbiAgICB0aGlzLmZpbmFsVHJhbnNmb3JtLm1hdE1kZiA9IHRoaXMuZmluYWxUcmFuc2Zvcm0ubVByb3AubWRmO1xyXG4gICAgdGhpcy5maW5hbFRyYW5zZm9ybS5vcGFjaXR5ID0gdGhpcy5maW5hbFRyYW5zZm9ybS5vcC52O1xyXG5cclxuICAgIHZhciBtYXQ7XHJcbiAgICB2YXIgZmluYWxNYXQgPSB0aGlzLmZpbmFsVHJhbnNmb3JtLm1hdDtcclxuXHJcbiAgICBpZih0aGlzLmhpZXJhcmNoeSl7XHJcbiAgICAgICAgdmFyIGksIGxlbiA9IHRoaXMuaGllcmFyY2h5Lmxlbmd0aDtcclxuICAgICAgICBtYXQgPSB0aGlzLmZpbmFsVHJhbnNmb3JtLm1Qcm9wLnYucHJvcHM7XHJcbiAgICAgICAgZmluYWxNYXQuY2xvbmVGcm9tUHJvcHMobWF0KTtcclxuICAgICAgICBmb3IoaT0wO2k8bGVuO2krPTEpe1xyXG4gICAgICAgICAgICB0aGlzLmZpbmFsVHJhbnNmb3JtLm1hdE1kZiA9IHRoaXMuaGllcmFyY2h5W2ldLmZpbmFsVHJhbnNmb3JtLm1Qcm9wLm1kZiA/IHRydWUgOiB0aGlzLmZpbmFsVHJhbnNmb3JtLm1hdE1kZjtcclxuICAgICAgICAgICAgbWF0ID0gdGhpcy5oaWVyYXJjaHlbaV0uZmluYWxUcmFuc2Zvcm0ubVByb3Audi5wcm9wcztcclxuICAgICAgICAgICAgZmluYWxNYXQudHJhbnNmb3JtKG1hdFswXSxtYXRbMV0sbWF0WzJdLG1hdFszXSxtYXRbNF0sbWF0WzVdLG1hdFs2XSxtYXRbN10sbWF0WzhdLG1hdFs5XSxtYXRbMTBdLG1hdFsxMV0sbWF0WzEyXSxtYXRbMTNdLG1hdFsxNF0sbWF0WzE1XSk7XHJcbiAgICAgICAgfVxyXG4gICAgfWVsc2V7XHJcbiAgICAgICAgaWYoIXBhcmVudFRyYW5zZm9ybSl7XHJcbiAgICAgICAgICAgIGZpbmFsTWF0LmNsb25lRnJvbVByb3BzKHRoaXMuZmluYWxUcmFuc2Zvcm0ubVByb3Audi5wcm9wcyk7XHJcbiAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgIG1hdCA9IHRoaXMuZmluYWxUcmFuc2Zvcm0ubVByb3Audi5wcm9wcztcclxuICAgICAgICAgICAgZmluYWxNYXQuY2xvbmVGcm9tUHJvcHMobWF0KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgaWYocGFyZW50VHJhbnNmb3JtKXtcclxuICAgICAgICBtYXQgPSBwYXJlbnRUcmFuc2Zvcm0ubWF0LnByb3BzO1xyXG4gICAgICAgIGZpbmFsTWF0LnRyYW5zZm9ybShtYXRbMF0sbWF0WzFdLG1hdFsyXSxtYXRbM10sbWF0WzRdLG1hdFs1XSxtYXRbNl0sbWF0WzddLG1hdFs4XSxtYXRbOV0sbWF0WzEwXSxtYXRbMTFdLG1hdFsxMl0sbWF0WzEzXSxtYXRbMTRdLG1hdFsxNV0pO1xyXG4gICAgICAgIHRoaXMuZmluYWxUcmFuc2Zvcm0ub3BhY2l0eSAqPSBwYXJlbnRUcmFuc2Zvcm0ub3BhY2l0eTtcclxuICAgICAgICB0aGlzLmZpbmFsVHJhbnNmb3JtLm9wTWRmID0gcGFyZW50VHJhbnNmb3JtLm9wTWRmID8gdHJ1ZSA6IHRoaXMuZmluYWxUcmFuc2Zvcm0ub3BNZGY7XHJcbiAgICAgICAgdGhpcy5maW5hbFRyYW5zZm9ybS5tYXRNZGYgPSBwYXJlbnRUcmFuc2Zvcm0ubWF0TWRmID8gdHJ1ZSA6IHRoaXMuZmluYWxUcmFuc2Zvcm0ubWF0TWRmXHJcbiAgICB9XHJcblxyXG4gICAgaWYodGhpcy5kYXRhLmhhc01hc2spe1xyXG4gICAgICAgIHRoaXMuZ2xvYmFsRGF0YS5yZW5kZXJlci5zYXZlKHRydWUpO1xyXG4gICAgICAgIHRoaXMubWFza01hbmFnZXIucmVuZGVyRnJhbWUodGhpcy5kYXRhLnR5ID09PSAwP251bGw6ZmluYWxNYXQpO1xyXG4gICAgfVxyXG4gICAgaWYodGhpcy5kYXRhLmhkKXtcclxuICAgICAgICB0aGlzLmlzVmlzaWJsZSA9IGZhbHNlO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHRoaXMuaXNWaXNpYmxlO1xyXG5cclxufTtcclxuXHJcbkNWQmFzZUVsZW1lbnQucHJvdG90eXBlLmFkZE1hc2tzID0gZnVuY3Rpb24oZGF0YSl7XHJcbiAgICB0aGlzLm1hc2tNYW5hZ2VyID0gbmV3IENWTWFza0VsZW1lbnQoZGF0YSx0aGlzLHRoaXMuZ2xvYmFsRGF0YSk7XHJcbn07XHJcblxyXG5cclxuQ1ZCYXNlRWxlbWVudC5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uKCl7XHJcbiAgICB0aGlzLmNhbnZhc0NvbnRleHQgPSBudWxsO1xyXG4gICAgdGhpcy5kYXRhID0gbnVsbDtcclxuICAgIHRoaXMuZ2xvYmFsRGF0YSA9IG51bGw7XHJcbiAgICBpZih0aGlzLm1hc2tNYW5hZ2VyKSB7XHJcbiAgICAgICAgdGhpcy5tYXNrTWFuYWdlci5kZXN0cm95KCk7XHJcbiAgICB9XHJcbn07XHJcblxyXG5DVkJhc2VFbGVtZW50LnByb3RvdHlwZS5tSGVscGVyID0gbmV3IE1hdHJpeCgpO1xyXG5cbmZ1bmN0aW9uIENWQ29tcEVsZW1lbnQoZGF0YSwgY29tcCxnbG9iYWxEYXRhKXtcclxuICAgIHRoaXMuX3BhcmVudC5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsZGF0YSwgY29tcCxnbG9iYWxEYXRhKTtcclxuICAgIHZhciBjb21wR2xvYmFsRGF0YSA9IHt9O1xyXG4gICAgZm9yKHZhciBzIGluIGdsb2JhbERhdGEpe1xyXG4gICAgICAgIGlmKGdsb2JhbERhdGEuaGFzT3duUHJvcGVydHkocykpe1xyXG4gICAgICAgICAgICBjb21wR2xvYmFsRGF0YVtzXSA9IGdsb2JhbERhdGFbc107XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgY29tcEdsb2JhbERhdGEucmVuZGVyZXIgPSB0aGlzO1xyXG4gICAgY29tcEdsb2JhbERhdGEuY29tcEhlaWdodCA9IHRoaXMuZGF0YS5oO1xyXG4gICAgY29tcEdsb2JhbERhdGEuY29tcFdpZHRoID0gdGhpcy5kYXRhLnc7XHJcbiAgICB0aGlzLnJlbmRlckNvbmZpZyA9IHtcclxuICAgICAgICBjbGVhckNhbnZhczogdHJ1ZVxyXG4gICAgfTtcclxuICAgIHRoaXMuY29udGV4dERhdGEgPSB7XHJcbiAgICAgICAgc2F2ZWQgOiBBcnJheS5hcHBseShudWxsLHtsZW5ndGg6MTV9KSxcclxuICAgICAgICBzYXZlZE9wOiBBcnJheS5hcHBseShudWxsLHtsZW5ndGg6MTV9KSxcclxuICAgICAgICBjQXJyUG9zIDogMCxcclxuICAgICAgICBjVHIgOiBuZXcgTWF0cml4KCksXHJcbiAgICAgICAgY08gOiAxXHJcbiAgICB9O1xyXG4gICAgdGhpcy5jb21wbGV0ZUxheWVycyA9IGZhbHNlO1xyXG4gICAgdmFyIGksIGxlbiA9IDE1O1xyXG4gICAgZm9yKGk9MDtpPGxlbjtpKz0xKXtcclxuICAgICAgICB0aGlzLmNvbnRleHREYXRhLnNhdmVkW2ldID0gQXJyYXkuYXBwbHkobnVsbCx7bGVuZ3RoOjE2fSk7XHJcbiAgICB9XHJcbiAgICB0aGlzLnRyYW5zZm9ybU1hdCA9IG5ldyBNYXRyaXgoKTtcclxuICAgIHRoaXMucGFyZW50R2xvYmFsRGF0YSA9IHRoaXMuZ2xvYmFsRGF0YTtcclxuICAgIHZhciBjdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpO1xyXG4gICAgLy9kb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGN2KTtcclxuICAgIGNvbXBHbG9iYWxEYXRhLmNhbnZhc0NvbnRleHQgPSBjdi5nZXRDb250ZXh0KCcyZCcpO1xyXG4gICAgdGhpcy5jYW52YXNDb250ZXh0ID0gY29tcEdsb2JhbERhdGEuY2FudmFzQ29udGV4dDtcclxuICAgIGN2LndpZHRoID0gdGhpcy5kYXRhLnc7XHJcbiAgICBjdi5oZWlnaHQgPSB0aGlzLmRhdGEuaDtcclxuICAgIHRoaXMuY2FudmFzID0gY3Y7XHJcbiAgICB0aGlzLmdsb2JhbERhdGEgPSBjb21wR2xvYmFsRGF0YTtcclxuICAgIHRoaXMubGF5ZXJzID0gZGF0YS5sYXllcnM7XHJcbiAgICB0aGlzLnBlbmRpbmdFbGVtZW50cyA9IFtdO1xyXG4gICAgdGhpcy5lbGVtZW50cyA9IEFycmF5LmFwcGx5KG51bGwse2xlbmd0aDp0aGlzLmxheWVycy5sZW5ndGh9KTtcclxuICAgIGlmKHRoaXMuZGF0YS50bSl7XHJcbiAgICAgICAgdGhpcy50bSA9IFByb3BlcnR5RmFjdG9yeS5nZXRQcm9wKHRoaXMsdGhpcy5kYXRhLnRtLDAsZ2xvYmFsRGF0YS5mcmFtZVJhdGUsdGhpcy5keW5hbWljUHJvcGVydGllcyk7XHJcbiAgICB9XHJcbiAgICBpZih0aGlzLmRhdGEueHQgfHwgIWdsb2JhbERhdGEucHJvZ3Jlc3NpdmVMb2FkKXtcclxuICAgICAgICB0aGlzLmJ1aWxkQWxsSXRlbXMoKTtcclxuICAgIH1cclxufVxyXG5jcmVhdGVFbGVtZW50KENWQmFzZUVsZW1lbnQsIENWQ29tcEVsZW1lbnQpO1xyXG5cclxuQ1ZDb21wRWxlbWVudC5wcm90b3R5cGUuY3R4VHJhbnNmb3JtID0gQ2FudmFzUmVuZGVyZXIucHJvdG90eXBlLmN0eFRyYW5zZm9ybTtcclxuQ1ZDb21wRWxlbWVudC5wcm90b3R5cGUuY3R4T3BhY2l0eSA9IENhbnZhc1JlbmRlcmVyLnByb3RvdHlwZS5jdHhPcGFjaXR5O1xyXG5DVkNvbXBFbGVtZW50LnByb3RvdHlwZS5zYXZlID0gQ2FudmFzUmVuZGVyZXIucHJvdG90eXBlLnNhdmU7XHJcbkNWQ29tcEVsZW1lbnQucHJvdG90eXBlLnJlc3RvcmUgPSBDYW52YXNSZW5kZXJlci5wcm90b3R5cGUucmVzdG9yZTtcclxuQ1ZDb21wRWxlbWVudC5wcm90b3R5cGUucmVzZXQgPSAgZnVuY3Rpb24oKXtcclxuICAgIHRoaXMuY29udGV4dERhdGEuY0FyclBvcyA9IDA7XHJcbiAgICB0aGlzLmNvbnRleHREYXRhLmNUci5yZXNldCgpO1xyXG4gICAgdGhpcy5jb250ZXh0RGF0YS5jTyA9IDE7XHJcbn07XHJcbkNWQ29tcEVsZW1lbnQucHJvdG90eXBlLnJlc2l6ZSA9IGZ1bmN0aW9uKHRyYW5zZm9ybUNhbnZhcyl7XHJcbiAgICB2YXIgbWF4U2NhbGUgPSBNYXRoLm1heCh0cmFuc2Zvcm1DYW52YXMuc3gsdHJhbnNmb3JtQ2FudmFzLnN5KTtcclxuICAgIHRoaXMuY2FudmFzLndpZHRoID0gdGhpcy5kYXRhLncqbWF4U2NhbGU7XHJcbiAgICB0aGlzLmNhbnZhcy5oZWlnaHQgPSB0aGlzLmRhdGEuaCptYXhTY2FsZTtcclxuICAgIHRoaXMudHJhbnNmb3JtQ2FudmFzID0ge1xyXG4gICAgICAgIHNjOm1heFNjYWxlLFxyXG4gICAgICAgIHc6dGhpcy5kYXRhLncqbWF4U2NhbGUsXHJcbiAgICAgICAgaDp0aGlzLmRhdGEuaCptYXhTY2FsZSxcclxuICAgICAgICBwcm9wczpbbWF4U2NhbGUsMCwwLDAsMCxtYXhTY2FsZSwwLDAsMCwwLDEsMCwwLDAsMCwxXVxyXG4gICAgfVxyXG4gICAgdmFyIGksbGVuID0gdGhpcy5lbGVtZW50cy5sZW5ndGg7XHJcbiAgICBmb3IoIGkgPSAwOyBpIDwgbGVuOyBpKz0xICl7XHJcbiAgICAgICAgaWYodGhpcy5lbGVtZW50c1tpXSAmJiB0aGlzLmVsZW1lbnRzW2ldLmRhdGEudHkgPT09IDApe1xyXG4gICAgICAgICAgICB0aGlzLmVsZW1lbnRzW2ldLnJlc2l6ZSh0cmFuc2Zvcm1DYW52YXMpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufTtcclxuXHJcbkNWQ29tcEVsZW1lbnQucHJvdG90eXBlLnByZXBhcmVGcmFtZSA9IGZ1bmN0aW9uKG51bSl7XHJcbiAgICB0aGlzLmdsb2JhbERhdGEuZnJhbWVJZCA9IHRoaXMucGFyZW50R2xvYmFsRGF0YS5mcmFtZUlkO1xyXG4gICAgdGhpcy5nbG9iYWxEYXRhLm1kZiA9IGZhbHNlO1xyXG4gICAgdGhpcy5fcGFyZW50LnByZXBhcmVGcmFtZS5jYWxsKHRoaXMsbnVtKTtcclxuICAgIGlmKHRoaXMuaXNWaXNpYmxlPT09ZmFsc2UgJiYgIXRoaXMuZGF0YS54dCl7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgdmFyIHRpbWVSZW1hcHBlZCA9IG51bTtcclxuICAgIGlmKHRoaXMudG0pe1xyXG4gICAgICAgIHRpbWVSZW1hcHBlZCA9IHRoaXMudG0udjtcclxuICAgICAgICBpZih0aW1lUmVtYXBwZWQgPT09IHRoaXMuZGF0YS5vcCl7XHJcbiAgICAgICAgICAgIHRpbWVSZW1hcHBlZCA9IHRoaXMuZGF0YS5vcCAtIDE7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgdGhpcy5yZW5kZXJlZEZyYW1lID0gdGltZVJlbWFwcGVkL3RoaXMuZGF0YS5zcjtcclxuICAgIHZhciBpLGxlbiA9IHRoaXMuZWxlbWVudHMubGVuZ3RoO1xyXG5cclxuICAgIGlmKCF0aGlzLmNvbXBsZXRlTGF5ZXJzKXtcclxuICAgICAgICB0aGlzLmNoZWNrTGF5ZXJzKG51bSk7XHJcbiAgICB9XHJcblxyXG4gICAgZm9yKCBpID0gMDsgaSA8IGxlbjsgaSs9MSApe1xyXG4gICAgICAgIGlmKHRoaXMuY29tcGxldGVMYXllcnMgfHwgdGhpcy5lbGVtZW50c1tpXSl7XHJcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudHNbaV0ucHJlcGFyZUZyYW1lKHRpbWVSZW1hcHBlZC90aGlzLmRhdGEuc3IgLSB0aGlzLmxheWVyc1tpXS5zdCk7XHJcbiAgICAgICAgICAgIGlmKHRoaXMuZWxlbWVudHNbaV0uZGF0YS50eSA9PT0gMCAmJiB0aGlzLmVsZW1lbnRzW2ldLmdsb2JhbERhdGEubWRmKXtcclxuICAgICAgICAgICAgICAgIHRoaXMuZ2xvYmFsRGF0YS5tZGYgPSB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgaWYodGhpcy5nbG9iYWxEYXRhLm1kZiAmJiAhdGhpcy5kYXRhLnh0KXtcclxuICAgICAgICB0aGlzLmNhbnZhc0NvbnRleHQuY2xlYXJSZWN0KDAsIDAsIHRoaXMuZGF0YS53LCB0aGlzLmRhdGEuaCk7XHJcbiAgICAgICAgdGhpcy5jdHhUcmFuc2Zvcm0odGhpcy50cmFuc2Zvcm1DYW52YXMucHJvcHMpO1xyXG4gICAgfVxyXG59O1xyXG5cclxuQ1ZDb21wRWxlbWVudC5wcm90b3R5cGUucmVuZGVyRnJhbWUgPSBmdW5jdGlvbihwYXJlbnRNYXRyaXgpe1xyXG4gICAgaWYodGhpcy5fcGFyZW50LnJlbmRlckZyYW1lLmNhbGwodGhpcyxwYXJlbnRNYXRyaXgpPT09ZmFsc2Upe1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGlmKHRoaXMuZ2xvYmFsRGF0YS5tZGYpe1xyXG4gICAgICAgIHZhciBpLGxlbiA9IHRoaXMubGF5ZXJzLmxlbmd0aDtcclxuICAgICAgICBmb3IoIGkgPSBsZW4gLSAxOyBpID49IDA7IGkgLT0gMSApe1xyXG4gICAgICAgICAgICBpZih0aGlzLmNvbXBsZXRlTGF5ZXJzIHx8IHRoaXMuZWxlbWVudHNbaV0pe1xyXG4gICAgICAgICAgICAgICAgdGhpcy5lbGVtZW50c1tpXS5yZW5kZXJGcmFtZSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgaWYodGhpcy5kYXRhLmhhc01hc2spe1xyXG4gICAgICAgIHRoaXMuZ2xvYmFsRGF0YS5yZW5kZXJlci5yZXN0b3JlKHRydWUpO1xyXG4gICAgfVxyXG4gICAgaWYodGhpcy5maXJzdEZyYW1lKXtcclxuICAgICAgICB0aGlzLmZpcnN0RnJhbWUgPSBmYWxzZTtcclxuICAgIH1cclxuICAgIHRoaXMucGFyZW50R2xvYmFsRGF0YS5yZW5kZXJlci5zYXZlKCk7XHJcbiAgICB0aGlzLnBhcmVudEdsb2JhbERhdGEucmVuZGVyZXIuY3R4VHJhbnNmb3JtKHRoaXMuZmluYWxUcmFuc2Zvcm0ubWF0LnByb3BzKTtcclxuICAgIHRoaXMucGFyZW50R2xvYmFsRGF0YS5yZW5kZXJlci5jdHhPcGFjaXR5KHRoaXMuZmluYWxUcmFuc2Zvcm0ub3BhY2l0eSk7XHJcbiAgICB0aGlzLnBhcmVudEdsb2JhbERhdGEucmVuZGVyZXIuY2FudmFzQ29udGV4dC5kcmF3SW1hZ2UodGhpcy5jYW52YXMsMCwwLHRoaXMuZGF0YS53LHRoaXMuZGF0YS5oKTtcclxuICAgIHRoaXMucGFyZW50R2xvYmFsRGF0YS5yZW5kZXJlci5yZXN0b3JlKCk7XHJcblxyXG4gICAgaWYodGhpcy5nbG9iYWxEYXRhLm1kZil7XHJcbiAgICAgICAgdGhpcy5yZXNldCgpO1xyXG4gICAgfVxyXG59O1xyXG5cclxuQ1ZDb21wRWxlbWVudC5wcm90b3R5cGUuc2V0RWxlbWVudHMgPSBmdW5jdGlvbihlbGVtcyl7XHJcbiAgICB0aGlzLmVsZW1lbnRzID0gZWxlbXM7XHJcbn07XHJcblxyXG5DVkNvbXBFbGVtZW50LnByb3RvdHlwZS5nZXRFbGVtZW50cyA9IGZ1bmN0aW9uKCl7XHJcbiAgICByZXR1cm4gdGhpcy5lbGVtZW50cztcclxufTtcclxuXHJcbkNWQ29tcEVsZW1lbnQucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbigpe1xyXG4gICAgdmFyIGksbGVuID0gdGhpcy5sYXllcnMubGVuZ3RoO1xyXG4gICAgZm9yKCBpID0gbGVuIC0gMTsgaSA+PSAwOyBpIC09IDEgKXtcclxuICAgICAgICB0aGlzLmVsZW1lbnRzW2ldLmRlc3Ryb3koKTtcclxuICAgIH1cclxuICAgIHRoaXMubGF5ZXJzID0gbnVsbDtcclxuICAgIHRoaXMuZWxlbWVudHMgPSBudWxsO1xyXG4gICAgdGhpcy5fcGFyZW50LmRlc3Ryb3kuY2FsbCh0aGlzLl9wYXJlbnQpO1xyXG59O1xyXG5DVkNvbXBFbGVtZW50LnByb3RvdHlwZS5jaGVja0xheWVycyA9IENhbnZhc1JlbmRlcmVyLnByb3RvdHlwZS5jaGVja0xheWVycztcclxuQ1ZDb21wRWxlbWVudC5wcm90b3R5cGUuYnVpbGRJdGVtID0gQ2FudmFzUmVuZGVyZXIucHJvdG90eXBlLmJ1aWxkSXRlbTtcclxuQ1ZDb21wRWxlbWVudC5wcm90b3R5cGUuY2hlY2tQZW5kaW5nRWxlbWVudHMgPSBDYW52YXNSZW5kZXJlci5wcm90b3R5cGUuY2hlY2tQZW5kaW5nRWxlbWVudHM7XHJcbkNWQ29tcEVsZW1lbnQucHJvdG90eXBlLmFkZFBlbmRpbmdFbGVtZW50ID0gQ2FudmFzUmVuZGVyZXIucHJvdG90eXBlLmFkZFBlbmRpbmdFbGVtZW50O1xyXG5DVkNvbXBFbGVtZW50LnByb3RvdHlwZS5idWlsZEFsbEl0ZW1zID0gQ2FudmFzUmVuZGVyZXIucHJvdG90eXBlLmJ1aWxkQWxsSXRlbXM7XHJcbkNWQ29tcEVsZW1lbnQucHJvdG90eXBlLmNyZWF0ZUl0ZW0gPSBDYW52YXNSZW5kZXJlci5wcm90b3R5cGUuY3JlYXRlSXRlbTtcclxuQ1ZDb21wRWxlbWVudC5wcm90b3R5cGUuY3JlYXRlSW1hZ2UgPSBDYW52YXNSZW5kZXJlci5wcm90b3R5cGUuY3JlYXRlSW1hZ2U7XHJcbkNWQ29tcEVsZW1lbnQucHJvdG90eXBlLmNyZWF0ZUNvbXAgPSBDYW52YXNSZW5kZXJlci5wcm90b3R5cGUuY3JlYXRlQ29tcDtcclxuQ1ZDb21wRWxlbWVudC5wcm90b3R5cGUuY3JlYXRlU29saWQgPSBDYW52YXNSZW5kZXJlci5wcm90b3R5cGUuY3JlYXRlU29saWQ7XHJcbkNWQ29tcEVsZW1lbnQucHJvdG90eXBlLmNyZWF0ZVNoYXBlID0gQ2FudmFzUmVuZGVyZXIucHJvdG90eXBlLmNyZWF0ZVNoYXBlO1xyXG5DVkNvbXBFbGVtZW50LnByb3RvdHlwZS5jcmVhdGVUZXh0ID0gQ2FudmFzUmVuZGVyZXIucHJvdG90eXBlLmNyZWF0ZVRleHQ7XHJcbkNWQ29tcEVsZW1lbnQucHJvdG90eXBlLmNyZWF0ZUJhc2UgPSBDYW52YXNSZW5kZXJlci5wcm90b3R5cGUuY3JlYXRlQmFzZTtcclxuQ1ZDb21wRWxlbWVudC5wcm90b3R5cGUuYnVpbGRFbGVtZW50UGFyZW50aW5nID0gQ2FudmFzUmVuZGVyZXIucHJvdG90eXBlLmJ1aWxkRWxlbWVudFBhcmVudGluZztcbmZ1bmN0aW9uIENWSW1hZ2VFbGVtZW50KGRhdGEsIGNvbXAsZ2xvYmFsRGF0YSl7XHJcbiAgICB0aGlzLmFzc2V0RGF0YSA9IGdsb2JhbERhdGEuZ2V0QXNzZXREYXRhKGRhdGEucmVmSWQpO1xyXG4gICAgdGhpcy5fcGFyZW50LmNvbnN0cnVjdG9yLmNhbGwodGhpcyxkYXRhLCBjb21wLGdsb2JhbERhdGEpO1xyXG4gICAgdGhpcy5nbG9iYWxEYXRhLmFkZFBlbmRpbmdFbGVtZW50KCk7XHJcbn1cclxuY3JlYXRlRWxlbWVudChDVkJhc2VFbGVtZW50LCBDVkltYWdlRWxlbWVudCk7XHJcblxyXG5DVkltYWdlRWxlbWVudC5wcm90b3R5cGUuY3JlYXRlRWxlbWVudHMgPSBmdW5jdGlvbigpe1xyXG4gICAgdmFyIGltYWdlTG9hZGVkID0gZnVuY3Rpb24oKXtcclxuICAgICAgICB0aGlzLmdsb2JhbERhdGEuZWxlbWVudExvYWRlZCgpO1xyXG4gICAgICAgIGlmKHRoaXMuYXNzZXREYXRhLncgIT09IHRoaXMuaW1nLndpZHRoIHx8IHRoaXMuYXNzZXREYXRhLmggIT09IHRoaXMuaW1nLmhlaWdodCl7XHJcbiAgICAgICAgICAgIHZhciBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTtcclxuICAgICAgICAgICAgY2FudmFzLndpZHRoID0gdGhpcy5hc3NldERhdGEudztcclxuICAgICAgICAgICAgY2FudmFzLmhlaWdodCA9IHRoaXMuYXNzZXREYXRhLmg7XHJcbiAgICAgICAgICAgIHZhciBjdHggPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTtcclxuXHJcbiAgICAgICAgICAgIHZhciBpbWdXID0gdGhpcy5pbWcud2lkdGg7XHJcbiAgICAgICAgICAgIHZhciBpbWdIID0gdGhpcy5pbWcuaGVpZ2h0O1xyXG4gICAgICAgICAgICB2YXIgaW1nUmVsID0gaW1nVyAvIGltZ0g7XHJcbiAgICAgICAgICAgIHZhciBjYW52YXNSZWwgPSB0aGlzLmFzc2V0RGF0YS53L3RoaXMuYXNzZXREYXRhLmg7XHJcbiAgICAgICAgICAgIHZhciB3aWR0aENyb3AsIGhlaWdodENyb3A7XHJcbiAgICAgICAgICAgIGlmKGltZ1JlbD5jYW52YXNSZWwpe1xyXG4gICAgICAgICAgICAgICAgaGVpZ2h0Q3JvcCA9IGltZ0g7XHJcbiAgICAgICAgICAgICAgICB3aWR0aENyb3AgPSBoZWlnaHRDcm9wKmNhbnZhc1JlbDtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHdpZHRoQ3JvcCA9IGltZ1c7XHJcbiAgICAgICAgICAgICAgICBoZWlnaHRDcm9wID0gd2lkdGhDcm9wL2NhbnZhc1JlbDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjdHguZHJhd0ltYWdlKHRoaXMuaW1nLChpbWdXLXdpZHRoQ3JvcCkvMiwoaW1nSC1oZWlnaHRDcm9wKS8yLHdpZHRoQ3JvcCxoZWlnaHRDcm9wLDAsMCx0aGlzLmFzc2V0RGF0YS53LHRoaXMuYXNzZXREYXRhLmgpO1xyXG4gICAgICAgICAgICB0aGlzLmltZyA9IGNhbnZhcztcclxuICAgICAgICB9XHJcbiAgICB9LmJpbmQodGhpcyk7XHJcbiAgICB2YXIgaW1hZ2VGYWlsZWQgPSBmdW5jdGlvbigpe1xyXG4gICAgICAgIHRoaXMuZmFpbGVkID0gdHJ1ZTtcclxuICAgICAgICB0aGlzLmdsb2JhbERhdGEuZWxlbWVudExvYWRlZCgpO1xyXG4gICAgfS5iaW5kKHRoaXMpO1xyXG5cclxuICAgIHRoaXMuaW1nID0gbmV3IEltYWdlKCk7XHJcbiAgICB0aGlzLmltZy5hZGRFdmVudExpc3RlbmVyKCdsb2FkJywgaW1hZ2VMb2FkZWQsIGZhbHNlKTtcclxuICAgIHRoaXMuaW1nLmFkZEV2ZW50TGlzdGVuZXIoJ2Vycm9yJywgaW1hZ2VGYWlsZWQsIGZhbHNlKTtcclxuICAgIHZhciBhc3NldFBhdGggPSB0aGlzLmdsb2JhbERhdGEuZ2V0QXNzZXRzUGF0aCh0aGlzLmFzc2V0RGF0YSk7XHJcbiAgICB0aGlzLmltZy5zcmMgPSBhc3NldFBhdGg7XHJcblxyXG4gICAgdGhpcy5fcGFyZW50LmNyZWF0ZUVsZW1lbnRzLmNhbGwodGhpcyk7XHJcblxyXG59O1xyXG5cclxuQ1ZJbWFnZUVsZW1lbnQucHJvdG90eXBlLnJlbmRlckZyYW1lID0gZnVuY3Rpb24ocGFyZW50TWF0cml4KXtcclxuICAgIGlmKHRoaXMuZmFpbGVkKXtcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBpZih0aGlzLl9wYXJlbnQucmVuZGVyRnJhbWUuY2FsbCh0aGlzLHBhcmVudE1hdHJpeCk9PT1mYWxzZSl7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgdmFyIGN0eCA9IHRoaXMuY2FudmFzQ29udGV4dDtcclxuICAgIHRoaXMuZ2xvYmFsRGF0YS5yZW5kZXJlci5zYXZlKCk7XHJcbiAgICB2YXIgZmluYWxNYXQgPSB0aGlzLmZpbmFsVHJhbnNmb3JtLm1hdC5wcm9wcztcclxuICAgIHRoaXMuZ2xvYmFsRGF0YS5yZW5kZXJlci5jdHhUcmFuc2Zvcm0oZmluYWxNYXQpO1xyXG4gICAgdGhpcy5nbG9iYWxEYXRhLnJlbmRlcmVyLmN0eE9wYWNpdHkodGhpcy5maW5hbFRyYW5zZm9ybS5vcGFjaXR5KTtcclxuICAgIGN0eC5kcmF3SW1hZ2UodGhpcy5pbWcsMCwwKTtcclxuICAgIHRoaXMuZ2xvYmFsRGF0YS5yZW5kZXJlci5yZXN0b3JlKHRoaXMuZGF0YS5oYXNNYXNrKTtcclxuICAgIGlmKHRoaXMuZmlyc3RGcmFtZSl7XHJcbiAgICAgICAgdGhpcy5maXJzdEZyYW1lID0gZmFsc2U7XHJcbiAgICB9XHJcbn07XHJcblxyXG5DVkltYWdlRWxlbWVudC5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uKCl7XHJcbiAgICB0aGlzLmltZyA9IG51bGw7XHJcbiAgICB0aGlzLl9wYXJlbnQuZGVzdHJveS5jYWxsKHRoaXMuX3BhcmVudCk7XHJcbn07XG5cclxuZnVuY3Rpb24gQ1ZNYXNrRWxlbWVudChkYXRhLGVsZW1lbnQpe1xyXG4gICAgdGhpcy5kYXRhID0gZGF0YTtcclxuICAgIHRoaXMuZWxlbWVudCA9IGVsZW1lbnQ7XHJcbiAgICB0aGlzLmR5bmFtaWNQcm9wZXJ0aWVzID0gW107XHJcbiAgICB0aGlzLm1hc2tzUHJvcGVydGllcyA9IHRoaXMuZGF0YS5tYXNrc1Byb3BlcnRpZXM7XHJcbiAgICB0aGlzLnZpZXdEYXRhID0gbmV3IEFycmF5KHRoaXMubWFza3NQcm9wZXJ0aWVzLmxlbmd0aCk7XHJcbiAgICB2YXIgaSwgbGVuID0gdGhpcy5tYXNrc1Byb3BlcnRpZXMubGVuZ3RoO1xyXG4gICAgZm9yIChpID0gMDsgaSA8IGxlbjsgaSsrKSB7XHJcbiAgICAgICAgdGhpcy52aWV3RGF0YVtpXSA9IFNoYXBlUHJvcGVydHlGYWN0b3J5LmdldFNoYXBlUHJvcCh0aGlzLmVsZW1lbnQsdGhpcy5tYXNrc1Byb3BlcnRpZXNbaV0sMyx0aGlzLmR5bmFtaWNQcm9wZXJ0aWVzLG51bGwpO1xyXG4gICAgfVxyXG59XHJcblxyXG5DVk1hc2tFbGVtZW50LnByb3RvdHlwZS5nZXRNYXNrUHJvcGVydHkgPSBmdW5jdGlvbihwb3Mpe1xyXG4gICAgcmV0dXJuIHRoaXMudmlld0RhdGFbcG9zXTtcclxufTtcclxuXHJcbkNWTWFza0VsZW1lbnQucHJvdG90eXBlLnByZXBhcmVGcmFtZSA9IGZ1bmN0aW9uKG51bSl7XHJcbiAgICB2YXIgaSwgbGVuID0gdGhpcy5keW5hbWljUHJvcGVydGllcy5sZW5ndGg7XHJcbiAgICBmb3IoaT0wO2k8bGVuO2krPTEpe1xyXG4gICAgICAgIHRoaXMuZHluYW1pY1Byb3BlcnRpZXNbaV0uZ2V0VmFsdWUobnVtKTtcclxuICAgICAgICBpZih0aGlzLmR5bmFtaWNQcm9wZXJ0aWVzW2ldLm1kZil7XHJcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudC5nbG9iYWxEYXRhLm1kZiA9IHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59O1xyXG5cclxuQ1ZNYXNrRWxlbWVudC5wcm90b3R5cGUucmVuZGVyRnJhbWUgPSBmdW5jdGlvbiAodHJhbnNmb3JtKSB7XHJcbiAgICB2YXIgY3R4ID0gdGhpcy5lbGVtZW50LmNhbnZhc0NvbnRleHQ7XHJcbiAgICB2YXIgaSwgbGVuID0gdGhpcy5kYXRhLm1hc2tzUHJvcGVydGllcy5sZW5ndGg7XHJcbiAgICB2YXIgcHQscHQyLHB0MyxkYXRhLCBoYXNNYXNrcyA9IGZhbHNlO1xyXG4gICAgZm9yIChpID0gMDsgaSA8IGxlbjsgaSsrKSB7XHJcbiAgICAgICAgaWYodGhpcy5tYXNrc1Byb3BlcnRpZXNbaV0ubW9kZSA9PT0gJ24nKXtcclxuICAgICAgICAgICAgY29udGludWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmKGhhc01hc2tzID09PSBmYWxzZSl7XHJcbiAgICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTtcclxuICAgICAgICAgICAgaGFzTWFza3MgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5tYXNrc1Byb3BlcnRpZXNbaV0uaW52KSB7XHJcbiAgICAgICAgICAgIGN0eC5tb3ZlVG8oMCwgMCk7XHJcbiAgICAgICAgICAgIGN0eC5saW5lVG8odGhpcy5lbGVtZW50Lmdsb2JhbERhdGEuY29tcFdpZHRoLCAwKTtcclxuICAgICAgICAgICAgY3R4LmxpbmVUbyh0aGlzLmVsZW1lbnQuZ2xvYmFsRGF0YS5jb21wV2lkdGgsIHRoaXMuZWxlbWVudC5nbG9iYWxEYXRhLmNvbXBIZWlnaHQpO1xyXG4gICAgICAgICAgICBjdHgubGluZVRvKDAsIHRoaXMuZWxlbWVudC5nbG9iYWxEYXRhLmNvbXBIZWlnaHQpO1xyXG4gICAgICAgICAgICBjdHgubGluZVRvKDAsIDApO1xyXG4gICAgICAgIH1cclxuICAgICAgICBkYXRhID0gdGhpcy52aWV3RGF0YVtpXS52O1xyXG4gICAgICAgIHB0ID0gdHJhbnNmb3JtID8gdHJhbnNmb3JtLmFwcGx5VG9Qb2ludEFycmF5KGRhdGEudlswXVswXSxkYXRhLnZbMF1bMV0sMCk6ZGF0YS52WzBdO1xyXG4gICAgICAgIGN0eC5tb3ZlVG8ocHRbMF0sIHB0WzFdKTtcclxuICAgICAgICB2YXIgaiwgakxlbiA9IGRhdGEuX2xlbmd0aDtcclxuICAgICAgICBmb3IgKGogPSAxOyBqIDwgakxlbjsgaisrKSB7XHJcbiAgICAgICAgICAgIHB0ID0gdHJhbnNmb3JtID8gdHJhbnNmb3JtLmFwcGx5VG9Qb2ludEFycmF5KGRhdGEub1tqIC0gMV1bMF0sZGF0YS5vW2ogLSAxXVsxXSwwKSA6IGRhdGEub1tqIC0gMV07XHJcbiAgICAgICAgICAgIHB0MiA9IHRyYW5zZm9ybSA/IHRyYW5zZm9ybS5hcHBseVRvUG9pbnRBcnJheShkYXRhLmlbal1bMF0sZGF0YS5pW2pdWzFdLDApIDogZGF0YS5pW2pdO1xyXG4gICAgICAgICAgICBwdDMgPSB0cmFuc2Zvcm0gPyB0cmFuc2Zvcm0uYXBwbHlUb1BvaW50QXJyYXkoZGF0YS52W2pdWzBdLGRhdGEudltqXVsxXSwwKSA6IGRhdGEudltqXTtcclxuICAgICAgICAgICAgY3R4LmJlemllckN1cnZlVG8ocHRbMF0sIHB0WzFdLCBwdDJbMF0sIHB0MlsxXSwgcHQzWzBdLCBwdDNbMV0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdCA9IHRyYW5zZm9ybSA/IHRyYW5zZm9ybS5hcHBseVRvUG9pbnRBcnJheShkYXRhLm9baiAtIDFdWzBdLGRhdGEub1tqIC0gMV1bMV0sMCkgOiBkYXRhLm9baiAtIDFdO1xyXG4gICAgICAgIHB0MiA9IHRyYW5zZm9ybSA/IHRyYW5zZm9ybS5hcHBseVRvUG9pbnRBcnJheShkYXRhLmlbMF1bMF0sZGF0YS5pWzBdWzFdLDApIDogZGF0YS5pWzBdO1xyXG4gICAgICAgIHB0MyA9IHRyYW5zZm9ybSA/IHRyYW5zZm9ybS5hcHBseVRvUG9pbnRBcnJheShkYXRhLnZbMF1bMF0sZGF0YS52WzBdWzFdLDApIDogZGF0YS52WzBdO1xyXG4gICAgICAgIGN0eC5iZXppZXJDdXJ2ZVRvKHB0WzBdLCBwdFsxXSwgcHQyWzBdLCBwdDJbMV0sIHB0M1swXSwgcHQzWzFdKTtcclxuICAgIH1cclxuICAgIGlmKGhhc01hc2tzKXtcclxuICAgICAgICBjdHguY2xpcCgpO1xyXG4gICAgfVxyXG59O1xyXG5cclxuQ1ZNYXNrRWxlbWVudC5wcm90b3R5cGUuZ2V0TWFzayA9IGZ1bmN0aW9uKG5tKXtcclxuICAgIHZhciBpID0gMCwgbGVuID0gdGhpcy5tYXNrc1Byb3BlcnRpZXMubGVuZ3RoO1xyXG4gICAgd2hpbGUoaTxsZW4pe1xyXG4gICAgICAgIGlmKHRoaXMubWFza3NQcm9wZXJ0aWVzW2ldLm5tID09PSBubSl7XHJcbiAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICBtYXNrUGF0aDogdGhpcy52aWV3RGF0YVtpXS5wdlxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGkgKz0gMTtcclxuICAgIH1cclxufTtcclxuXHJcbkNWTWFza0VsZW1lbnQucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbigpe1xyXG4gICAgdGhpcy5lbGVtZW50ID0gbnVsbDtcclxufTtcbmZ1bmN0aW9uIENWU2hhcGVFbGVtZW50KGRhdGEsIGNvbXAsZ2xvYmFsRGF0YSl7XHJcbiAgICB0aGlzLnNoYXBlcyA9IFtdO1xyXG4gICAgdGhpcy5zaGFwZXNEYXRhID0gZGF0YS5zaGFwZXM7XHJcbiAgICB0aGlzLnN0eWxlc0xpc3QgPSBbXTtcclxuICAgIHRoaXMuaXRlbXNEYXRhID0gW107XHJcbiAgICB0aGlzLnByZXZWaWV3RGF0YSA9IFtdO1xyXG4gICAgdGhpcy5zaGFwZU1vZGlmaWVycyA9IFtdO1xyXG4gICAgdGhpcy5wcm9jZXNzZWRFbGVtZW50cyA9IFtdO1xyXG4gICAgdGhpcy5fcGFyZW50LmNvbnN0cnVjdG9yLmNhbGwodGhpcyxkYXRhLCBjb21wLGdsb2JhbERhdGEpO1xyXG59XHJcbmNyZWF0ZUVsZW1lbnQoQ1ZCYXNlRWxlbWVudCwgQ1ZTaGFwZUVsZW1lbnQpO1xyXG5cclxuQ1ZTaGFwZUVsZW1lbnQucHJvdG90eXBlLnRyYW5zZm9ybUhlbHBlciA9IHtvcGFjaXR5OjEsbWF0Om5ldyBNYXRyaXgoKSxtYXRNZGY6ZmFsc2Usb3BNZGY6ZmFsc2V9O1xyXG5cclxuQ1ZTaGFwZUVsZW1lbnQucHJvdG90eXBlLmRhc2hSZXNldHRlciA9IFtdO1xyXG5cclxuQ1ZTaGFwZUVsZW1lbnQucHJvdG90eXBlLmNyZWF0ZUVsZW1lbnRzID0gZnVuY3Rpb24oKXtcclxuXHJcbiAgICB0aGlzLl9wYXJlbnQuY3JlYXRlRWxlbWVudHMuY2FsbCh0aGlzKTtcclxuICAgIHRoaXMuc2VhcmNoU2hhcGVzKHRoaXMuc2hhcGVzRGF0YSx0aGlzLml0ZW1zRGF0YSx0aGlzLnByZXZWaWV3RGF0YSx0aGlzLmR5bmFtaWNQcm9wZXJ0aWVzLCB0cnVlKTtcclxufTtcclxuXHJcbkNWU2hhcGVFbGVtZW50LnByb3RvdHlwZS5jcmVhdGVTdHlsZUVsZW1lbnQgPSBmdW5jdGlvbihkYXRhLCBkeW5hbWljUHJvcGVydGllcyl7XHJcbiAgICB2YXIgc3R5bGVFbGVtID0ge1xyXG4gICAgICAgIGRhdGE6IGRhdGEsXHJcbiAgICAgICAgdHlwZTogZGF0YS50eSxcclxuICAgICAgICBlbGVtZW50czogW11cclxuICAgIH07XHJcbiAgICB2YXIgZWxlbWVudERhdGEgPSB7fTtcclxuICAgIGlmKGRhdGEudHkgPT0gJ2ZsJyB8fCBkYXRhLnR5ID09ICdzdCcpe1xyXG4gICAgICAgIGVsZW1lbnREYXRhLmMgPSBQcm9wZXJ0eUZhY3RvcnkuZ2V0UHJvcCh0aGlzLGRhdGEuYywxLDI1NSxkeW5hbWljUHJvcGVydGllcyk7XHJcbiAgICAgICAgaWYoIWVsZW1lbnREYXRhLmMuayl7XHJcbiAgICAgICAgICAgIHN0eWxlRWxlbS5jbyA9ICdyZ2IoJytibV9mbG9vcihlbGVtZW50RGF0YS5jLnZbMF0pKycsJytibV9mbG9vcihlbGVtZW50RGF0YS5jLnZbMV0pKycsJytibV9mbG9vcihlbGVtZW50RGF0YS5jLnZbMl0pKycpJztcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBlbGVtZW50RGF0YS5vID0gUHJvcGVydHlGYWN0b3J5LmdldFByb3AodGhpcyxkYXRhLm8sMCwwLjAxLGR5bmFtaWNQcm9wZXJ0aWVzKTtcclxuICAgIGlmKGRhdGEudHkgPT0gJ3N0Jykge1xyXG4gICAgICAgIHN0eWxlRWxlbS5sYyA9IHRoaXMubGNFbnVtW2RhdGEubGNdIHx8ICdyb3VuZCc7XHJcbiAgICAgICAgc3R5bGVFbGVtLmxqID0gdGhpcy5sakVudW1bZGF0YS5sal0gfHwgJ3JvdW5kJztcclxuICAgICAgICBpZihkYXRhLmxqID09IDEpIHtcclxuICAgICAgICAgICAgc3R5bGVFbGVtLm1sID0gZGF0YS5tbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxlbWVudERhdGEudyA9IFByb3BlcnR5RmFjdG9yeS5nZXRQcm9wKHRoaXMsZGF0YS53LDAsbnVsbCxkeW5hbWljUHJvcGVydGllcyk7XHJcbiAgICAgICAgaWYoIWVsZW1lbnREYXRhLncuayl7XHJcbiAgICAgICAgICAgIHN0eWxlRWxlbS53aSA9IGVsZW1lbnREYXRhLncudjtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYoZGF0YS5kKXtcclxuICAgICAgICAgICAgdmFyIGQgPSBQcm9wZXJ0eUZhY3RvcnkuZ2V0RGFzaFByb3AodGhpcyxkYXRhLmQsJ2NhbnZhcycsZHluYW1pY1Byb3BlcnRpZXMpO1xyXG4gICAgICAgICAgICBlbGVtZW50RGF0YS5kID0gZDtcclxuICAgICAgICAgICAgaWYoIWVsZW1lbnREYXRhLmQuayl7XHJcbiAgICAgICAgICAgICAgICBzdHlsZUVsZW0uZGEgPSBlbGVtZW50RGF0YS5kLmRhc2hhcnJheTtcclxuICAgICAgICAgICAgICAgIHN0eWxlRWxlbS5kbyA9IGVsZW1lbnREYXRhLmQuZGFzaG9mZnNldDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICB9IGVsc2Uge1xyXG5cclxuICAgICAgICBzdHlsZUVsZW0uciA9IGRhdGEuciA9PT0gMiA/ICdldmVub2RkJyA6ICdub256ZXJvJztcclxuICAgIH1cclxuICAgIHRoaXMuc3R5bGVzTGlzdC5wdXNoKHN0eWxlRWxlbSk7XHJcbiAgICBlbGVtZW50RGF0YS5zdHlsZSA9IHN0eWxlRWxlbTtcclxuICAgIHJldHVybiBlbGVtZW50RGF0YTtcclxufVxyXG5cclxuQ1ZTaGFwZUVsZW1lbnQucHJvdG90eXBlLmNyZWF0ZUdyb3VwRWxlbWVudCA9IGZ1bmN0aW9uKGRhdGEpIHtcclxuICAgIHZhciBlbGVtZW50RGF0YSA9IHtcclxuICAgICAgICBpdDogW10sXHJcbiAgICAgICAgcHJldlZpZXdEYXRhOiBbXVxyXG4gICAgfTtcclxuICAgIHJldHVybiBlbGVtZW50RGF0YTtcclxufVxyXG5cclxuQ1ZTaGFwZUVsZW1lbnQucHJvdG90eXBlLmNyZWF0ZVRyYW5zZm9ybUVsZW1lbnQgPSBmdW5jdGlvbihkYXRhLCBkeW5hbWljUHJvcGVydGllcykge1xyXG4gICAgdmFyIGVsZW1lbnREYXRhID0ge1xyXG4gICAgICAgIHRyYW5zZm9ybSA6IHtcclxuICAgICAgICAgICAgbWF0OiBuZXcgTWF0cml4KCksXHJcbiAgICAgICAgICAgIG9wYWNpdHk6IDEsXHJcbiAgICAgICAgICAgIG1hdE1kZjpmYWxzZSxcclxuICAgICAgICAgICAgb3BNZGY6ZmFsc2UsXHJcbiAgICAgICAgICAgIG9wOiBQcm9wZXJ0eUZhY3RvcnkuZ2V0UHJvcCh0aGlzLGRhdGEubywwLDAuMDEsZHluYW1pY1Byb3BlcnRpZXMpLFxyXG4gICAgICAgICAgICBtUHJvcHM6IFByb3BlcnR5RmFjdG9yeS5nZXRQcm9wKHRoaXMsZGF0YSwyLG51bGwsZHluYW1pY1Byb3BlcnRpZXMpXHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbGVtZW50czogW11cclxuICAgIH07XHJcbiAgICByZXR1cm4gZWxlbWVudERhdGE7XHJcbn1cclxuXHJcbkNWU2hhcGVFbGVtZW50LnByb3RvdHlwZS5jcmVhdGVTaGFwZUVsZW1lbnQgPSBmdW5jdGlvbihkYXRhLCBkeW5hbWljUHJvcGVydGllcykge1xyXG4gICAgdmFyIGVsZW1lbnREYXRhID0ge1xyXG4gICAgICAgIG5vZGVzOltdLFxyXG4gICAgICAgIHRyTm9kZXM6W10sXHJcbiAgICAgICAgdHI6WzAsMCwwLDAsMCwwXVxyXG4gICAgfTtcclxuICAgIHZhciB0eSA9IDQ7XHJcbiAgICBpZihkYXRhLnR5ID09ICdyYycpe1xyXG4gICAgICAgIHR5ID0gNTtcclxuICAgIH1lbHNlIGlmKGRhdGEudHkgPT0gJ2VsJyl7XHJcbiAgICAgICAgdHkgPSA2O1xyXG4gICAgfWVsc2UgaWYoZGF0YS50eSA9PSAnc3InKXtcclxuICAgICAgICB0eSA9IDc7XHJcbiAgICB9XHJcbiAgICBlbGVtZW50RGF0YS5zaCA9IFNoYXBlUHJvcGVydHlGYWN0b3J5LmdldFNoYXBlUHJvcCh0aGlzLGRhdGEsdHksZHluYW1pY1Byb3BlcnRpZXMpO1xyXG4gICAgdGhpcy5zaGFwZXMucHVzaChlbGVtZW50RGF0YS5zaCk7XHJcbiAgICB0aGlzLmFkZFNoYXBlVG9Nb2RpZmllcnMoZWxlbWVudERhdGEpO1xyXG4gICAgakxlbiA9IHRoaXMuc3R5bGVzTGlzdC5sZW5ndGg7XHJcbiAgICB2YXIgaGFzU3Ryb2tlcyA9IGZhbHNlLCBoYXNGaWxscyA9IGZhbHNlO1xyXG4gICAgZm9yKGo9MDtqPGpMZW47ais9MSl7XHJcbiAgICAgICAgaWYoIXRoaXMuc3R5bGVzTGlzdFtqXS5jbG9zZWQpe1xyXG4gICAgICAgICAgICB0aGlzLnN0eWxlc0xpc3Rbal0uZWxlbWVudHMucHVzaChlbGVtZW50RGF0YSk7XHJcbiAgICAgICAgICAgIGlmKHRoaXMuc3R5bGVzTGlzdFtqXS50eXBlID09PSAnc3QnKXtcclxuICAgICAgICAgICAgICAgIGhhc1N0cm9rZXMgPSB0cnVlO1xyXG4gICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgIGhhc0ZpbGxzID0gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGVsZW1lbnREYXRhLnN0ID0gaGFzU3Ryb2tlcztcclxuICAgIGVsZW1lbnREYXRhLmZsID0gaGFzRmlsbHM7XHJcbiAgICByZXR1cm4gZWxlbWVudERhdGE7XHJcbn1cclxuXHJcbkNWU2hhcGVFbGVtZW50LnByb3RvdHlwZS5yZWxvYWRTaGFwZXMgPSBmdW5jdGlvbigpe1xyXG4gICAgdGhpcy5maXJzdEZyYW1lID0gdHJ1ZTtcclxuICAgIHZhciBpLCBsZW4gPSB0aGlzLml0ZW1zRGF0YS5sZW5ndGg7XHJcbiAgICBmb3IoaT0wO2k8bGVuO2krPTEpe1xyXG4gICAgICAgIHRoaXMucHJldlZpZXdEYXRhW2ldID0gdGhpcy5pdGVtc0RhdGFbaV07XHJcbiAgICB9XHJcbiAgICB0aGlzLnNlYXJjaFNoYXBlcyh0aGlzLnNoYXBlc0RhdGEsdGhpcy5pdGVtc0RhdGEsdGhpcy5wcmV2Vmlld0RhdGEsdGhpcy5keW5hbWljUHJvcGVydGllcywgdHJ1ZSk7XHJcbiAgICB2YXIgaSwgbGVuID0gdGhpcy5keW5hbWljUHJvcGVydGllcy5sZW5ndGg7XHJcbiAgICBmb3IoaT0wO2k8bGVuO2krPTEpe1xyXG4gICAgICAgIHRoaXMuZHluYW1pY1Byb3BlcnRpZXNbaV0uZ2V0VmFsdWUoKTtcclxuICAgIH1cclxuICAgIHRoaXMucmVuZGVyTW9kaWZpZXJzKCk7XHJcbn1cclxuXHJcbkNWU2hhcGVFbGVtZW50LnByb3RvdHlwZS5zZWFyY2hTaGFwZXMgPSBmdW5jdGlvbihhcnIsaXRlbXNEYXRhLCBwcmV2Vmlld0RhdGEsZHluYW1pY1Byb3BlcnRpZXMsIHJlbmRlcil7XHJcbiAgICB2YXIgaSwgbGVuID0gYXJyLmxlbmd0aCAtIDE7XHJcbiAgICB2YXIgaiwgakxlbjtcclxuICAgIHZhciBvd25BcnJheXMgPSBbXSwgb3duTW9kaWZpZXJzID0gW10sIHByb2Nlc3NlZFBvcztcclxuICAgIGZvcihpPWxlbjtpPj0wO2ktPTEpe1xyXG4gICAgICAgIHByb2Nlc3NlZFBvcyA9IHRoaXMuc2VhcmNoUHJvY2Vzc2VkRWxlbWVudChhcnJbaV0pO1xyXG4gICAgICAgIGlmKCFwcm9jZXNzZWRQb3Mpe1xyXG4gICAgICAgICAgICBhcnJbaV0uX3JlbmRlciA9IHJlbmRlcjtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBpdGVtc0RhdGFbaV0gPSBwcmV2Vmlld0RhdGFbcHJvY2Vzc2VkUG9zIC0gMV07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmKGFycltpXS50eSA9PSAnZmwnIHx8IGFycltpXS50eSA9PSAnc3QnKXtcclxuICAgICAgICAgICAgaWYoIXByb2Nlc3NlZFBvcyl7XHJcbiAgICAgICAgICAgICAgICBpdGVtc0RhdGFbaV0gPSB0aGlzLmNyZWF0ZVN0eWxlRWxlbWVudChhcnJbaV0sIGR5bmFtaWNQcm9wZXJ0aWVzKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGl0ZW1zRGF0YVtpXS5zdHlsZS5jbG9zZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgb3duQXJyYXlzLnB1c2goaXRlbXNEYXRhW2ldLnN0eWxlKTtcclxuICAgICAgICB9ZWxzZSBpZihhcnJbaV0udHkgPT0gJ2dyJyl7XHJcbiAgICAgICAgICAgIGlmKCFwcm9jZXNzZWRQb3Mpe1xyXG4gICAgICAgICAgICAgICAgaXRlbXNEYXRhW2ldID0gdGhpcy5jcmVhdGVHcm91cEVsZW1lbnQoYXJyW2ldKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGpMZW4gPSBpdGVtc0RhdGFbaV0uaXQubGVuZ3RoO1xyXG4gICAgICAgICAgICAgICAgZm9yKGo9MDtqPGpMZW47ais9MSl7XHJcbiAgICAgICAgICAgICAgICAgICAgaXRlbXNEYXRhW2ldLnByZXZWaWV3RGF0YVtqXSA9IGl0ZW1zRGF0YVtpXS5pdFtqXTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLnNlYXJjaFNoYXBlcyhhcnJbaV0uaXQsaXRlbXNEYXRhW2ldLml0LGl0ZW1zRGF0YVtpXS5wcmV2Vmlld0RhdGEsZHluYW1pY1Byb3BlcnRpZXMsIHJlbmRlcik7XHJcbiAgICAgICAgfWVsc2UgaWYoYXJyW2ldLnR5ID09ICd0cicpe1xyXG4gICAgICAgICAgICBpZighcHJvY2Vzc2VkUG9zKXtcclxuICAgICAgICAgICAgICAgIGl0ZW1zRGF0YVtpXSA9IHRoaXMuY3JlYXRlVHJhbnNmb3JtRWxlbWVudChhcnJbaV0sIGR5bmFtaWNQcm9wZXJ0aWVzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1lbHNlIGlmKGFycltpXS50eSA9PSAnc2gnIHx8IGFycltpXS50eSA9PSAncmMnIHx8IGFycltpXS50eSA9PSAnZWwnIHx8IGFycltpXS50eSA9PSAnc3InKXtcclxuICAgICAgICAgICAgaWYoIXByb2Nlc3NlZFBvcyl7XHJcbiAgICAgICAgICAgICAgICBpdGVtc0RhdGFbaV0gPSB0aGlzLmNyZWF0ZVNoYXBlRWxlbWVudChhcnJbaV0sIGR5bmFtaWNQcm9wZXJ0aWVzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBcclxuICAgICAgICB9ZWxzZSBpZihhcnJbaV0udHkgPT0gJ3RtJyB8fCBhcnJbaV0udHkgPT0gJ3JkJyl7XHJcbiAgICAgICAgICAgIGlmKCFwcm9jZXNzZWRQb3Mpe1xyXG4gICAgICAgICAgICAgICAgdmFyIG1vZGlmaWVyID0gU2hhcGVNb2RpZmllcnMuZ2V0TW9kaWZpZXIoYXJyW2ldLnR5KTtcclxuICAgICAgICAgICAgICAgIG1vZGlmaWVyLmluaXQodGhpcyxhcnJbaV0sZHluYW1pY1Byb3BlcnRpZXMpO1xyXG4gICAgICAgICAgICAgICAgaXRlbXNEYXRhW2ldID0gbW9kaWZpZXI7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNoYXBlTW9kaWZpZXJzLnB1c2gobW9kaWZpZXIpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgbW9kaWZpZXIgPSBpdGVtc0RhdGFbaV07XHJcbiAgICAgICAgICAgICAgICBtb2RpZmllci5jbG9zZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBvd25Nb2RpZmllcnMucHVzaChtb2RpZmllcik7XHJcbiAgICAgICAgfSBlbHNlIGlmKGFycltpXS50eSA9PSAncnAnKXtcclxuICAgICAgICAgICAgaWYoIXByb2Nlc3NlZFBvcyl7XHJcbiAgICAgICAgICAgICAgICBtb2RpZmllciA9IFNoYXBlTW9kaWZpZXJzLmdldE1vZGlmaWVyKGFycltpXS50eSk7XHJcbiAgICAgICAgICAgICAgICBpdGVtc0RhdGFbaV0gPSBtb2RpZmllcjtcclxuICAgICAgICAgICAgICAgIG1vZGlmaWVyLmluaXQodGhpcyxhcnIsaSxpdGVtc0RhdGEsZHluYW1pY1Byb3BlcnRpZXMpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zaGFwZU1vZGlmaWVycy5wdXNoKG1vZGlmaWVyKTtcclxuICAgICAgICAgICAgICAgIHJlbmRlciA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgIG1vZGlmaWVyID0gaXRlbXNEYXRhW2ldO1xyXG4gICAgICAgICAgICAgICAgbW9kaWZpZXIuY2xvc2VkID0gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBvd25Nb2RpZmllcnMucHVzaChtb2RpZmllcik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuYWRkUHJvY2Vzc2VkRWxlbWVudChhcnJbaV0sIGkgKyAxKTtcclxuICAgIH1cclxuICAgIGxlbiA9IG93bkFycmF5cy5sZW5ndGg7XHJcbiAgICBmb3IoaT0wO2k8bGVuO2krPTEpe1xyXG4gICAgICAgIG93bkFycmF5c1tpXS5jbG9zZWQgPSB0cnVlO1xyXG4gICAgfVxyXG4gICAgbGVuID0gb3duTW9kaWZpZXJzLmxlbmd0aDtcclxuICAgIGZvcihpPTA7aTxsZW47aSs9MSl7XHJcbiAgICAgICAgb3duTW9kaWZpZXJzW2ldLmNsb3NlZCA9IHRydWU7XHJcbiAgICB9XHJcbn07XHJcblxyXG5DVlNoYXBlRWxlbWVudC5wcm90b3R5cGUuYWRkU2hhcGVUb01vZGlmaWVycyA9IElTaGFwZUVsZW1lbnQucHJvdG90eXBlLmFkZFNoYXBlVG9Nb2RpZmllcnM7XHJcbkNWU2hhcGVFbGVtZW50LnByb3RvdHlwZS5yZW5kZXJNb2RpZmllcnMgPSBJU2hhcGVFbGVtZW50LnByb3RvdHlwZS5yZW5kZXJNb2RpZmllcnM7XHJcbkNWU2hhcGVFbGVtZW50LnByb3RvdHlwZS5sY0VudW0gPSBJU2hhcGVFbGVtZW50LnByb3RvdHlwZS5sY0VudW07XHJcbkNWU2hhcGVFbGVtZW50LnByb3RvdHlwZS5sakVudW0gPSBJU2hhcGVFbGVtZW50LnByb3RvdHlwZS5sakVudW07XHJcbkNWU2hhcGVFbGVtZW50LnByb3RvdHlwZS5zZWFyY2hQcm9jZXNzZWRFbGVtZW50ID0gSVNoYXBlRWxlbWVudC5wcm90b3R5cGUuc2VhcmNoUHJvY2Vzc2VkRWxlbWVudDtcclxuQ1ZTaGFwZUVsZW1lbnQucHJvdG90eXBlLmFkZFByb2Nlc3NlZEVsZW1lbnQgPSBJU2hhcGVFbGVtZW50LnByb3RvdHlwZS5hZGRQcm9jZXNzZWRFbGVtZW50O1xyXG5cclxuQ1ZTaGFwZUVsZW1lbnQucHJvdG90eXBlLnJlbmRlckZyYW1lID0gZnVuY3Rpb24ocGFyZW50TWF0cml4KXtcclxuICAgIGlmKHRoaXMuX3BhcmVudC5yZW5kZXJGcmFtZS5jYWxsKHRoaXMsIHBhcmVudE1hdHJpeCk9PT1mYWxzZSl7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgdGhpcy50cmFuc2Zvcm1IZWxwZXIubWF0LnJlc2V0KCk7XHJcbiAgICB0aGlzLnRyYW5zZm9ybUhlbHBlci5vcGFjaXR5ID0gdGhpcy5maW5hbFRyYW5zZm9ybS5vcGFjaXR5O1xyXG4gICAgdGhpcy50cmFuc2Zvcm1IZWxwZXIubWF0TWRmID0gZmFsc2U7XHJcbiAgICB0aGlzLnRyYW5zZm9ybUhlbHBlci5vcE1kZiA9IHRoaXMuZmluYWxUcmFuc2Zvcm0ub3BNZGY7XHJcbiAgICB0aGlzLnJlbmRlck1vZGlmaWVycygpO1xyXG4gICAgdGhpcy5yZW5kZXJTaGFwZSh0aGlzLnRyYW5zZm9ybUhlbHBlcixudWxsLG51bGwsdHJ1ZSk7XHJcbiAgICBpZih0aGlzLmRhdGEuaGFzTWFzayl7XHJcbiAgICAgICAgdGhpcy5nbG9iYWxEYXRhLnJlbmRlcmVyLnJlc3RvcmUodHJ1ZSk7XHJcbiAgICB9XHJcbn07XHJcblxyXG5DVlNoYXBlRWxlbWVudC5wcm90b3R5cGUucmVuZGVyU2hhcGUgPSBmdW5jdGlvbihwYXJlbnRUcmFuc2Zvcm0saXRlbXMsZGF0YSxpc01haW4pe1xyXG4gICAgdmFyIGksIGxlbjtcclxuICAgIGlmKCFpdGVtcyl7XHJcbiAgICAgICAgaXRlbXMgPSB0aGlzLnNoYXBlc0RhdGE7XHJcbiAgICAgICAgbGVuID0gdGhpcy5zdHlsZXNMaXN0Lmxlbmd0aDtcclxuICAgICAgICBmb3IoaT0wO2k8bGVuO2krPTEpe1xyXG4gICAgICAgICAgICB0aGlzLnN0eWxlc0xpc3RbaV0uZCA9ICcnO1xyXG4gICAgICAgICAgICB0aGlzLnN0eWxlc0xpc3RbaV0ubWRmID0gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgaWYoIWRhdGEpe1xyXG4gICAgICAgIGRhdGEgPSB0aGlzLml0ZW1zRGF0YTtcclxuICAgIH1cclxuICAgIC8vL1xyXG4gICAgLy8vXHJcbiAgICBsZW4gPSBpdGVtcy5sZW5ndGggLSAxO1xyXG4gICAgdmFyIGdyb3VwVHJhbnNmb3JtLGdyb3VwTWF0cml4O1xyXG4gICAgZ3JvdXBUcmFuc2Zvcm0gPSBwYXJlbnRUcmFuc2Zvcm07XHJcbiAgICBmb3IoaT1sZW47aT49MDtpLT0xKXtcclxuICAgICAgICBpZihpdGVtc1tpXS50eSA9PSAndHInKXtcclxuICAgICAgICAgICAgZ3JvdXBUcmFuc2Zvcm0gPSBkYXRhW2ldLnRyYW5zZm9ybTtcclxuICAgICAgICAgICAgdmFyIG10QXJyID0gZGF0YVtpXS50cmFuc2Zvcm0ubVByb3BzLnYucHJvcHM7XHJcbiAgICAgICAgICAgIGdyb3VwVHJhbnNmb3JtLm1hdE1kZiA9IGdyb3VwVHJhbnNmb3JtLm1Qcm9wcy5tZGY7XHJcbiAgICAgICAgICAgIGdyb3VwVHJhbnNmb3JtLm9wTWRmID0gZ3JvdXBUcmFuc2Zvcm0ub3AubWRmO1xyXG4gICAgICAgICAgICBncm91cE1hdHJpeCA9IGdyb3VwVHJhbnNmb3JtLm1hdDtcclxuICAgICAgICAgICAgZ3JvdXBNYXRyaXguY2xvbmVGcm9tUHJvcHMobXRBcnIpO1xyXG4gICAgICAgICAgICBpZihwYXJlbnRUcmFuc2Zvcm0pe1xyXG4gICAgICAgICAgICAgICAgdmFyIHByb3BzID0gcGFyZW50VHJhbnNmb3JtLm1hdC5wcm9wcztcclxuICAgICAgICAgICAgICAgIGdyb3VwVHJhbnNmb3JtLm9wYWNpdHkgPSBwYXJlbnRUcmFuc2Zvcm0ub3BhY2l0eTtcclxuICAgICAgICAgICAgICAgIGdyb3VwVHJhbnNmb3JtLm9wYWNpdHkgKj0gZGF0YVtpXS50cmFuc2Zvcm0ub3AudjtcclxuICAgICAgICAgICAgICAgIGdyb3VwVHJhbnNmb3JtLm1hdE1kZiA9IHBhcmVudFRyYW5zZm9ybS5tYXRNZGYgPyB0cnVlIDogZ3JvdXBUcmFuc2Zvcm0ubWF0TWRmO1xyXG4gICAgICAgICAgICAgICAgZ3JvdXBUcmFuc2Zvcm0ub3BNZGYgPSBwYXJlbnRUcmFuc2Zvcm0ub3BNZGYgPyB0cnVlIDogZ3JvdXBUcmFuc2Zvcm0ub3BNZGY7XHJcbiAgICAgICAgICAgICAgICBncm91cE1hdHJpeC50cmFuc2Zvcm0ocHJvcHNbMF0scHJvcHNbMV0scHJvcHNbMl0scHJvcHNbM10scHJvcHNbNF0scHJvcHNbNV0scHJvcHNbNl0scHJvcHNbN10scHJvcHNbOF0scHJvcHNbOV0scHJvcHNbMTBdLHByb3BzWzExXSxwcm9wc1sxMl0scHJvcHNbMTNdLHByb3BzWzE0XSxwcm9wc1sxNV0pO1xyXG4gICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgIGdyb3VwVHJhbnNmb3JtLm9wYWNpdHkgPSBncm91cFRyYW5zZm9ybS5vcC5vO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfWVsc2UgaWYoaXRlbXNbaV0udHkgPT0gJ3NoJyB8fCBpdGVtc1tpXS50eSA9PSAnZWwnIHx8IGl0ZW1zW2ldLnR5ID09ICdyYycgfHwgaXRlbXNbaV0udHkgPT0gJ3NyJyl7XHJcbiAgICAgICAgICAgIHRoaXMucmVuZGVyUGF0aChpdGVtc1tpXSxkYXRhW2ldLGdyb3VwVHJhbnNmb3JtKTtcclxuICAgICAgICB9ZWxzZSBpZihpdGVtc1tpXS50eSA9PSAnZmwnKXtcclxuICAgICAgICAgICAgdGhpcy5yZW5kZXJGaWxsKGl0ZW1zW2ldLGRhdGFbaV0sZ3JvdXBUcmFuc2Zvcm0pO1xyXG4gICAgICAgIH1lbHNlIGlmKGl0ZW1zW2ldLnR5ID09ICdzdCcpe1xyXG4gICAgICAgICAgICB0aGlzLnJlbmRlclN0cm9rZShpdGVtc1tpXSxkYXRhW2ldLGdyb3VwVHJhbnNmb3JtKTtcclxuICAgICAgICB9ZWxzZSBpZihpdGVtc1tpXS50eSA9PSAnZ3InKXtcclxuICAgICAgICAgICAgdGhpcy5yZW5kZXJTaGFwZShncm91cFRyYW5zZm9ybSxpdGVtc1tpXS5pdCxkYXRhW2ldLml0KTtcclxuICAgICAgICB9ZWxzZSBpZihpdGVtc1tpXS50eSA9PSAndG0nKXtcclxuICAgICAgICAgICAgLy9cclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBpZighaXNNYWluKXtcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBsZW4gPSB0aGlzLnN0eWxlc0xpc3QubGVuZ3RoO1xyXG4gICAgdmFyIGosIGpMZW4sIGssIGtMZW4sZWxlbXMsbm9kZXMsIHJlbmRlcmVyID0gdGhpcy5nbG9iYWxEYXRhLnJlbmRlcmVyLCBjdHggPSB0aGlzLmdsb2JhbERhdGEuY2FudmFzQ29udGV4dCwgdHlwZTtcclxuICAgIHJlbmRlcmVyLnNhdmUoKTtcclxuICAgIHJlbmRlcmVyLmN0eFRyYW5zZm9ybSh0aGlzLmZpbmFsVHJhbnNmb3JtLm1hdC5wcm9wcyk7XHJcbiAgICBmb3IoaT0wO2k8bGVuO2krPTEpe1xyXG4gICAgICAgIHR5cGUgPSB0aGlzLnN0eWxlc0xpc3RbaV0udHlwZTtcclxuICAgICAgICBpZigodHlwZSA9PT0gJ3N0JyAmJiB0aGlzLnN0eWxlc0xpc3RbaV0ud2kgPT09IDApIHx8ICF0aGlzLnN0eWxlc0xpc3RbaV0uZGF0YS5fcmVuZGVyKXtcclxuICAgICAgICAgICAgY29udGludWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJlbmRlcmVyLnNhdmUoKTtcclxuICAgICAgICBlbGVtcyA9IHRoaXMuc3R5bGVzTGlzdFtpXS5lbGVtZW50cztcclxuICAgICAgICBpZih0eXBlID09PSAnc3QnKXtcclxuICAgICAgICAgICAgY3R4LnN0cm9rZVN0eWxlID0gdGhpcy5zdHlsZXNMaXN0W2ldLmNvO1xyXG4gICAgICAgICAgICBjdHgubGluZVdpZHRoID0gdGhpcy5zdHlsZXNMaXN0W2ldLndpO1xyXG4gICAgICAgICAgICBjdHgubGluZUNhcCA9IHRoaXMuc3R5bGVzTGlzdFtpXS5sYztcclxuICAgICAgICAgICAgY3R4LmxpbmVKb2luID0gdGhpcy5zdHlsZXNMaXN0W2ldLmxqO1xyXG4gICAgICAgICAgICBjdHgubWl0ZXJMaW1pdCA9IHRoaXMuc3R5bGVzTGlzdFtpXS5tbCB8fCAwO1xyXG4gICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gdGhpcy5zdHlsZXNMaXN0W2ldLmNvO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZW5kZXJlci5jdHhPcGFjaXR5KHRoaXMuc3R5bGVzTGlzdFtpXS5jb09wKTtcclxuICAgICAgICBpZih0eXBlICE9PSAnc3QnKXtcclxuICAgICAgICAgICAgY3R4LmJlZ2luUGF0aCgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBqTGVuID0gZWxlbXMubGVuZ3RoO1xyXG4gICAgICAgIGZvcihqPTA7ajxqTGVuO2orPTEpe1xyXG4gICAgICAgICAgICBpZih0eXBlID09PSAnc3QnKXtcclxuICAgICAgICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTtcclxuICAgICAgICAgICAgICAgIGlmKHRoaXMuc3R5bGVzTGlzdFtpXS5kYSl7XHJcbiAgICAgICAgICAgICAgICAgICAgY3R4LnNldExpbmVEYXNoKHRoaXMuc3R5bGVzTGlzdFtpXS5kYSk7XHJcbiAgICAgICAgICAgICAgICAgICAgY3R4LmxpbmVEYXNoT2Zmc2V0ID0gdGhpcy5zdHlsZXNMaXN0W2ldLmRvO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZ2xvYmFsRGF0YS5pc0Rhc2hlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB9ZWxzZSBpZih0aGlzLmdsb2JhbERhdGEuaXNEYXNoZWQpe1xyXG4gICAgICAgICAgICAgICAgICAgIGN0eC5zZXRMaW5lRGFzaCh0aGlzLmRhc2hSZXNldHRlcik7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5nbG9iYWxEYXRhLmlzRGFzaGVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgbm9kZXMgPSBlbGVtc1tqXS50ck5vZGVzO1xyXG4gICAgICAgICAgICBrTGVuID0gbm9kZXMubGVuZ3RoO1xyXG5cclxuICAgICAgICAgICAgZm9yKGs9MDtrPGtMZW47ays9MSl7XHJcbiAgICAgICAgICAgICAgICBpZihub2Rlc1trXS50ID09ICdtJyl7XHJcbiAgICAgICAgICAgICAgICAgICAgY3R4Lm1vdmVUbyhub2Rlc1trXS5wWzBdLG5vZGVzW2tdLnBbMV0pO1xyXG4gICAgICAgICAgICAgICAgfWVsc2UgaWYobm9kZXNba10udCA9PSAnYycpe1xyXG4gICAgICAgICAgICAgICAgICAgIGN0eC5iZXppZXJDdXJ2ZVRvKG5vZGVzW2tdLnAxWzBdLG5vZGVzW2tdLnAxWzFdLG5vZGVzW2tdLnAyWzBdLG5vZGVzW2tdLnAyWzFdLG5vZGVzW2tdLnAzWzBdLG5vZGVzW2tdLnAzWzFdKTtcclxuICAgICAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgICAgIGN0eC5jbG9zZVBhdGgoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZih0eXBlID09PSAnc3QnKXtcclxuICAgICAgICAgICAgICAgIGN0eC5zdHJva2UoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZih0eXBlICE9PSAnc3QnKXtcclxuICAgICAgICAgICAgY3R4LmZpbGwodGhpcy5zdHlsZXNMaXN0W2ldLnIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZW5kZXJlci5yZXN0b3JlKCk7XHJcbiAgICB9XHJcbiAgICByZW5kZXJlci5yZXN0b3JlKCk7XHJcbiAgICBpZih0aGlzLmZpcnN0RnJhbWUpe1xyXG4gICAgICAgIHRoaXMuZmlyc3RGcmFtZSA9IGZhbHNlO1xyXG4gICAgfVxyXG59O1xyXG5DVlNoYXBlRWxlbWVudC5wcm90b3R5cGUucmVuZGVyUGF0aCA9IGZ1bmN0aW9uKHBhdGhEYXRhLGl0ZW1EYXRhLGdyb3VwVHJhbnNmb3JtKXtcclxuICAgIHZhciBsZW4sIGksIGosakxlbjtcclxuICAgIHZhciByZWRyYXcgPSBncm91cFRyYW5zZm9ybS5tYXRNZGYgfHwgaXRlbURhdGEuc2gubWRmIHx8IHRoaXMuZmlyc3RGcmFtZTtcclxuICAgIGlmKHJlZHJhdykge1xyXG4gICAgICAgIHZhciBwYXRocyA9IGl0ZW1EYXRhLnNoLnBhdGhzO1xyXG4gICAgICAgIGpMZW4gPSBwYXRocy5fbGVuZ3RoO1xyXG4gICAgICAgIHZhciBwYXRoU3RyaW5nVHJhbnNmb3JtZWQgPSBpdGVtRGF0YS50ck5vZGVzO1xyXG4gICAgICAgIHBhdGhTdHJpbmdUcmFuc2Zvcm1lZC5sZW5ndGggPSAwO1xyXG4gICAgICAgIGZvcihqPTA7ajxqTGVuO2orPTEpe1xyXG4gICAgICAgICAgICB2YXIgcGF0aE5vZGVzID0gcGF0aHMuc2hhcGVzW2pdO1xyXG4gICAgICAgICAgICBpZihwYXRoTm9kZXMgJiYgcGF0aE5vZGVzLnYpe1xyXG4gICAgICAgICAgICAgICAgbGVuID0gcGF0aE5vZGVzLl9sZW5ndGg7XHJcbiAgICAgICAgICAgICAgICBmb3IgKGkgPSAxOyBpIDwgbGVuOyBpICs9IDEpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoaSA9PSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhdGhTdHJpbmdUcmFuc2Zvcm1lZC5wdXNoKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQ6ICdtJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHA6IGdyb3VwVHJhbnNmb3JtLm1hdC5hcHBseVRvUG9pbnRBcnJheShwYXRoTm9kZXMudlswXVswXSwgcGF0aE5vZGVzLnZbMF1bMV0sIDApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBwYXRoU3RyaW5nVHJhbnNmb3JtZWQucHVzaCh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHQ6ICdjJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgcDE6IGdyb3VwVHJhbnNmb3JtLm1hdC5hcHBseVRvUG9pbnRBcnJheShwYXRoTm9kZXMub1tpIC0gMV1bMF0sIHBhdGhOb2Rlcy5vW2kgLSAxXVsxXSwgMCksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHAyOiBncm91cFRyYW5zZm9ybS5tYXQuYXBwbHlUb1BvaW50QXJyYXkocGF0aE5vZGVzLmlbaV1bMF0sIHBhdGhOb2Rlcy5pW2ldWzFdLCAwKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgcDM6IGdyb3VwVHJhbnNmb3JtLm1hdC5hcHBseVRvUG9pbnRBcnJheShwYXRoTm9kZXMudltpXVswXSwgcGF0aE5vZGVzLnZbaV1bMV0sIDApXHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAobGVuID09IDEpIHtcclxuICAgICAgICAgICAgICAgICAgICBwYXRoU3RyaW5nVHJhbnNmb3JtZWQucHVzaCh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHQ6ICdtJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgcDogZ3JvdXBUcmFuc2Zvcm0ubWF0LmFwcGx5VG9Qb2ludEFycmF5KHBhdGhOb2Rlcy52WzBdWzBdLCBwYXRoTm9kZXMudlswXVsxXSwgMClcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChwYXRoTm9kZXMuYyAmJiBsZW4pIHtcclxuICAgICAgICAgICAgICAgICAgICBwYXRoU3RyaW5nVHJhbnNmb3JtZWQucHVzaCh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHQ6ICdjJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgcDE6IGdyb3VwVHJhbnNmb3JtLm1hdC5hcHBseVRvUG9pbnRBcnJheShwYXRoTm9kZXMub1tpIC0gMV1bMF0sIHBhdGhOb2Rlcy5vW2kgLSAxXVsxXSwgMCksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHAyOiBncm91cFRyYW5zZm9ybS5tYXQuYXBwbHlUb1BvaW50QXJyYXkocGF0aE5vZGVzLmlbMF1bMF0sIHBhdGhOb2Rlcy5pWzBdWzFdLCAwKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgcDM6IGdyb3VwVHJhbnNmb3JtLm1hdC5hcHBseVRvUG9pbnRBcnJheShwYXRoTm9kZXMudlswXVswXSwgcGF0aE5vZGVzLnZbMF1bMV0sIDApXHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgcGF0aFN0cmluZ1RyYW5zZm9ybWVkLnB1c2goe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0OiAneidcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGl0ZW1EYXRhLmxTdHIgPSBwYXRoU3RyaW5nVHJhbnNmb3JtZWQ7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoaXRlbURhdGEuc3QpIHtcclxuICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IDE2OyBpICs9IDEpIHtcclxuICAgICAgICAgICAgICAgIGl0ZW1EYXRhLnRyW2ldID0gZ3JvdXBUcmFuc2Zvcm0ubWF0LnByb3BzW2ldO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGl0ZW1EYXRhLnRyTm9kZXMgPSBwYXRoU3RyaW5nVHJhbnNmb3JtZWQ7XHJcblxyXG4gICAgfVxyXG59O1xyXG5cclxuXHJcblxyXG5DVlNoYXBlRWxlbWVudC5wcm90b3R5cGUucmVuZGVyRmlsbCA9IGZ1bmN0aW9uKHN0eWxlRGF0YSxpdGVtRGF0YSwgZ3JvdXBUcmFuc2Zvcm0pe1xyXG4gICAgdmFyIHN0eWxlRWxlbSA9IGl0ZW1EYXRhLnN0eWxlO1xyXG5cclxuICAgIGlmKGl0ZW1EYXRhLmMubWRmIHx8IHRoaXMuZmlyc3RGcmFtZSl7XHJcbiAgICAgICAgc3R5bGVFbGVtLmNvID0gJ3JnYignK2JtX2Zsb29yKGl0ZW1EYXRhLmMudlswXSkrJywnK2JtX2Zsb29yKGl0ZW1EYXRhLmMudlsxXSkrJywnK2JtX2Zsb29yKGl0ZW1EYXRhLmMudlsyXSkrJyknO1xyXG4gICAgfVxyXG4gICAgaWYoaXRlbURhdGEuby5tZGYgfHwgZ3JvdXBUcmFuc2Zvcm0ub3BNZGYgfHwgdGhpcy5maXJzdEZyYW1lKXtcclxuICAgICAgICBzdHlsZUVsZW0uY29PcCA9IGl0ZW1EYXRhLm8udipncm91cFRyYW5zZm9ybS5vcGFjaXR5O1xyXG4gICAgfVxyXG59O1xyXG5cclxuQ1ZTaGFwZUVsZW1lbnQucHJvdG90eXBlLnJlbmRlclN0cm9rZSA9IGZ1bmN0aW9uKHN0eWxlRGF0YSxpdGVtRGF0YSwgZ3JvdXBUcmFuc2Zvcm0pe1xyXG4gICAgdmFyIHN0eWxlRWxlbSA9IGl0ZW1EYXRhLnN0eWxlO1xyXG4gICAgLy9UT0RPIGZpeCBkYXNoZXNcclxuICAgIHZhciBkID0gaXRlbURhdGEuZDtcclxuICAgIHZhciBkYXNoYXJyYXksZGFzaG9mZnNldDtcclxuICAgIGlmKGQgJiYgKGQubWRmICB8fCB0aGlzLmZpcnN0RnJhbWUpKXtcclxuICAgICAgICBzdHlsZUVsZW0uZGEgPSBkLmRhc2hhcnJheTtcclxuICAgICAgICBzdHlsZUVsZW0uZG8gPSBkLmRhc2hvZmZzZXQ7XHJcbiAgICB9XHJcbiAgICBpZihpdGVtRGF0YS5jLm1kZiB8fCB0aGlzLmZpcnN0RnJhbWUpe1xyXG4gICAgICAgIHN0eWxlRWxlbS5jbyA9ICdyZ2IoJytibV9mbG9vcihpdGVtRGF0YS5jLnZbMF0pKycsJytibV9mbG9vcihpdGVtRGF0YS5jLnZbMV0pKycsJytibV9mbG9vcihpdGVtRGF0YS5jLnZbMl0pKycpJztcclxuICAgIH1cclxuICAgIGlmKGl0ZW1EYXRhLm8ubWRmIHx8IGdyb3VwVHJhbnNmb3JtLm9wTWRmIHx8IHRoaXMuZmlyc3RGcmFtZSl7XHJcbiAgICAgICAgc3R5bGVFbGVtLmNvT3AgPSBpdGVtRGF0YS5vLnYqZ3JvdXBUcmFuc2Zvcm0ub3BhY2l0eTtcclxuICAgIH1cclxuICAgIGlmKGl0ZW1EYXRhLncubWRmIHx8IHRoaXMuZmlyc3RGcmFtZSl7XHJcbiAgICAgICAgc3R5bGVFbGVtLndpID0gaXRlbURhdGEudy52O1xyXG4gICAgfVxyXG59O1xyXG5cclxuXHJcbkNWU2hhcGVFbGVtZW50LnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24oKXtcclxuICAgIHRoaXMuc2hhcGVzRGF0YSA9IG51bGw7XHJcbiAgICB0aGlzLmdsb2JhbERhdGEgPSBudWxsO1xyXG4gICAgdGhpcy5jYW52YXNDb250ZXh0ID0gbnVsbDtcclxuICAgIHRoaXMuc3R5bGVzTGlzdC5sZW5ndGggPSAwO1xyXG4gICAgdGhpcy5pdGVtRGF0YS5sZW5ndGggPSAwO1xyXG4gICAgdGhpcy5fcGFyZW50LmRlc3Ryb3kuY2FsbCh0aGlzLl9wYXJlbnQpO1xyXG59O1xyXG5cclxuXG5mdW5jdGlvbiBDVlNvbGlkRWxlbWVudChkYXRhLCBjb21wLGdsb2JhbERhdGEpe1xyXG4gICAgdGhpcy5fcGFyZW50LmNvbnN0cnVjdG9yLmNhbGwodGhpcyxkYXRhLCBjb21wLGdsb2JhbERhdGEpO1xyXG59XHJcbmNyZWF0ZUVsZW1lbnQoQ1ZCYXNlRWxlbWVudCwgQ1ZTb2xpZEVsZW1lbnQpO1xyXG5cclxuQ1ZTb2xpZEVsZW1lbnQucHJvdG90eXBlLnJlbmRlckZyYW1lID0gZnVuY3Rpb24ocGFyZW50TWF0cml4KXtcclxuICAgIGlmKHRoaXMuX3BhcmVudC5yZW5kZXJGcmFtZS5jYWxsKHRoaXMsIHBhcmVudE1hdHJpeCk9PT1mYWxzZSl7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgdmFyIGN0eCA9IHRoaXMuY2FudmFzQ29udGV4dDtcclxuICAgIHRoaXMuZ2xvYmFsRGF0YS5yZW5kZXJlci5zYXZlKCk7XHJcbiAgICB0aGlzLmdsb2JhbERhdGEucmVuZGVyZXIuY3R4VHJhbnNmb3JtKHRoaXMuZmluYWxUcmFuc2Zvcm0ubWF0LnByb3BzKTtcclxuICAgIHRoaXMuZ2xvYmFsRGF0YS5yZW5kZXJlci5jdHhPcGFjaXR5KHRoaXMuZmluYWxUcmFuc2Zvcm0ub3BhY2l0eSk7XHJcbiAgICBjdHguZmlsbFN0eWxlPXRoaXMuZGF0YS5zYztcclxuICAgIGN0eC5maWxsUmVjdCgwLDAsdGhpcy5kYXRhLnN3LHRoaXMuZGF0YS5zaCk7XHJcbiAgICB0aGlzLmdsb2JhbERhdGEucmVuZGVyZXIucmVzdG9yZSh0aGlzLmRhdGEuaGFzTWFzayk7XHJcbiAgICBpZih0aGlzLmZpcnN0RnJhbWUpe1xyXG4gICAgICAgIHRoaXMuZmlyc3RGcmFtZSA9IGZhbHNlO1xyXG4gICAgfVxyXG59O1xuZnVuY3Rpb24gQ1ZUZXh0RWxlbWVudChkYXRhLCBjb21wLCBnbG9iYWxEYXRhKXtcclxuICAgIHRoaXMudGV4dFNwYW5zID0gW107XHJcbiAgICB0aGlzLnlPZmZzZXQgPSAwO1xyXG4gICAgdGhpcy5maWxsQ29sb3JBbmltID0gZmFsc2U7XHJcbiAgICB0aGlzLnN0cm9rZUNvbG9yQW5pbSA9IGZhbHNlO1xyXG4gICAgdGhpcy5zdHJva2VXaWR0aEFuaW0gPSBmYWxzZTtcclxuICAgIHRoaXMuc3Ryb2tlID0gZmFsc2U7XHJcbiAgICB0aGlzLmZpbGwgPSBmYWxzZTtcclxuICAgIHRoaXMuanVzdGlmeU9mZnNldCA9IDA7XHJcbiAgICB0aGlzLmN1cnJlbnRSZW5kZXIgPSBudWxsO1xyXG4gICAgdGhpcy5yZW5kZXJUeXBlID0gJ2NhbnZhcyc7XHJcbiAgICB0aGlzLnZhbHVlcyA9IHtcclxuICAgICAgICBmaWxsOiAncmdiYSgwLDAsMCwwKScsXHJcbiAgICAgICAgc3Ryb2tlOiAncmdiYSgwLDAsMCwwKScsXHJcbiAgICAgICAgc1dpZHRoOiAwLFxyXG4gICAgICAgIGZWYWx1ZTogJydcclxuICAgIH1cclxuICAgIHRoaXMuX3BhcmVudC5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsZGF0YSxjb21wLCBnbG9iYWxEYXRhKTtcclxufVxyXG5jcmVhdGVFbGVtZW50KENWQmFzZUVsZW1lbnQsIENWVGV4dEVsZW1lbnQpO1xyXG5cclxuQ1ZUZXh0RWxlbWVudC5wcm90b3R5cGUuaW5pdCA9IElUZXh0RWxlbWVudC5wcm90b3R5cGUuaW5pdDtcclxuQ1ZUZXh0RWxlbWVudC5wcm90b3R5cGUuZ2V0TWVhc3VyZXMgPSBJVGV4dEVsZW1lbnQucHJvdG90eXBlLmdldE1lYXN1cmVzO1xyXG5DVlRleHRFbGVtZW50LnByb3RvdHlwZS5nZXRNdWx0ID0gSVRleHRFbGVtZW50LnByb3RvdHlwZS5nZXRNdWx0O1xyXG5DVlRleHRFbGVtZW50LnByb3RvdHlwZS5wcmVwYXJlRnJhbWUgPSBJVGV4dEVsZW1lbnQucHJvdG90eXBlLnByZXBhcmVGcmFtZTtcclxuXHJcbkNWVGV4dEVsZW1lbnQucHJvdG90eXBlLnRIZWxwZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKS5nZXRDb250ZXh0KCcyZCcpO1xyXG5cclxuQ1ZUZXh0RWxlbWVudC5wcm90b3R5cGUuY3JlYXRlRWxlbWVudHMgPSBmdW5jdGlvbigpe1xyXG5cclxuICAgIHRoaXMuX3BhcmVudC5jcmVhdGVFbGVtZW50cy5jYWxsKHRoaXMpO1xyXG4gICAgLy9jb25zb2xlLmxvZygndGhpcy5kYXRhOiAnLHRoaXMuZGF0YSk7XHJcblxyXG59O1xyXG5cclxuQ1ZUZXh0RWxlbWVudC5wcm90b3R5cGUuYnVpbGROZXdUZXh0ID0gZnVuY3Rpb24oKXtcclxuICAgIHZhciBkb2N1bWVudERhdGEgPSB0aGlzLmN1cnJlbnRUZXh0RG9jdW1lbnREYXRhO1xyXG4gICAgdGhpcy5yZW5kZXJlZExldHRlcnMgPSBBcnJheS5hcHBseShudWxsLHtsZW5ndGg6dGhpcy5jdXJyZW50VGV4dERvY3VtZW50RGF0YS5sID8gdGhpcy5jdXJyZW50VGV4dERvY3VtZW50RGF0YS5sLmxlbmd0aCA6IDB9KTtcclxuXHJcbiAgICB2YXIgaGFzRmlsbCA9IGZhbHNlO1xyXG4gICAgaWYoZG9jdW1lbnREYXRhLmZjKSB7XHJcbiAgICAgICAgaGFzRmlsbCA9IHRydWU7XHJcbiAgICAgICAgdGhpcy52YWx1ZXMuZmlsbCA9ICdyZ2IoJyArIE1hdGgucm91bmQoZG9jdW1lbnREYXRhLmZjWzBdKjI1NSkgKyAnLCcgKyBNYXRoLnJvdW5kKGRvY3VtZW50RGF0YS5mY1sxXSoyNTUpICsgJywnICsgTWF0aC5yb3VuZChkb2N1bWVudERhdGEuZmNbMl0qMjU1KSArICcpJztcclxuICAgIH1lbHNle1xyXG4gICAgICAgIHRoaXMudmFsdWVzLmZpbGwgPSAncmdiYSgwLDAsMCwwKSc7XHJcbiAgICB9XHJcbiAgICB0aGlzLmZpbGwgPSBoYXNGaWxsO1xyXG4gICAgdmFyIGhhc1N0cm9rZSA9IGZhbHNlO1xyXG4gICAgaWYoZG9jdW1lbnREYXRhLnNjKXtcclxuICAgICAgICBoYXNTdHJva2UgPSB0cnVlO1xyXG4gICAgICAgIHRoaXMudmFsdWVzLnN0cm9rZSA9ICdyZ2IoJyArIE1hdGgucm91bmQoZG9jdW1lbnREYXRhLnNjWzBdKjI1NSkgKyAnLCcgKyBNYXRoLnJvdW5kKGRvY3VtZW50RGF0YS5zY1sxXSoyNTUpICsgJywnICsgTWF0aC5yb3VuZChkb2N1bWVudERhdGEuc2NbMl0qMjU1KSArICcpJztcclxuICAgICAgICB0aGlzLnZhbHVlcy5zV2lkdGggPSBkb2N1bWVudERhdGEuc3c7XHJcbiAgICB9XHJcbiAgICB2YXIgZm9udERhdGEgPSB0aGlzLmdsb2JhbERhdGEuZm9udE1hbmFnZXIuZ2V0Rm9udEJ5TmFtZShkb2N1bWVudERhdGEuZik7XHJcbiAgICB2YXIgaSwgbGVuO1xyXG4gICAgdmFyIGxldHRlcnMgPSBkb2N1bWVudERhdGEubDtcclxuICAgIHZhciBtYXRyaXhIZWxwZXIgPSB0aGlzLm1IZWxwZXI7XHJcbiAgICB0aGlzLnN0cm9rZSA9IGhhc1N0cm9rZTtcclxuICAgIHRoaXMudmFsdWVzLmZWYWx1ZSA9IGRvY3VtZW50RGF0YS5zICsgJ3B4ICcrIHRoaXMuZ2xvYmFsRGF0YS5mb250TWFuYWdlci5nZXRGb250QnlOYW1lKGRvY3VtZW50RGF0YS5mKS5mRmFtaWx5O1xyXG4gICAgbGVuID0gZG9jdW1lbnREYXRhLnQubGVuZ3RoO1xyXG4gICAgdGhpcy50SGVscGVyLmZvbnQgPSB0aGlzLnZhbHVlcy5mVmFsdWU7XHJcbiAgICB2YXIgY2hhckRhdGEsIHNoYXBlRGF0YSwgaywga0xlbiwgc2hhcGVzLCBqLCBqTGVuLCBwYXRoTm9kZXMsIGNvbW1hbmRzLCBwYXRoQXJyLCBzaW5nbGVTaGFwZSA9IHRoaXMuZGF0YS5zaW5nbGVTaGFwZTtcclxuICAgIGlmIChzaW5nbGVTaGFwZSkge1xyXG4gICAgICAgIHZhciB4UG9zID0gMCwgeVBvcyA9IDAsIGxpbmVXaWR0aHMgPSBkb2N1bWVudERhdGEubGluZVdpZHRocywgYm94V2lkdGggPSBkb2N1bWVudERhdGEuYm94V2lkdGgsIGZpcnN0TGluZSA9IHRydWU7XHJcbiAgICB9XHJcbiAgICB2YXIgY250ID0gMDtcclxuICAgIGZvciAoaSA9IDA7aSA8IGxlbiA7aSArPSAxKSB7XHJcbiAgICAgICAgY2hhckRhdGEgPSB0aGlzLmdsb2JhbERhdGEuZm9udE1hbmFnZXIuZ2V0Q2hhckRhdGEoZG9jdW1lbnREYXRhLnQuY2hhckF0KGkpLCBmb250RGF0YS5mU3R5bGUsIHRoaXMuZ2xvYmFsRGF0YS5mb250TWFuYWdlci5nZXRGb250QnlOYW1lKGRvY3VtZW50RGF0YS5mKS5mRmFtaWx5KTtcclxuICAgICAgICB2YXIgc2hhcGVEYXRhO1xyXG4gICAgICAgIGlmKGNoYXJEYXRhKXtcclxuICAgICAgICAgICAgc2hhcGVEYXRhID0gY2hhckRhdGEuZGF0YTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBzaGFwZURhdGEgPSBudWxsO1xyXG4gICAgICAgIH1cclxuICAgICAgICBtYXRyaXhIZWxwZXIucmVzZXQoKTtcclxuICAgICAgICBpZihzaW5nbGVTaGFwZSAmJiBsZXR0ZXJzW2ldLm4pIHtcclxuICAgICAgICAgICAgeFBvcyA9IDA7XHJcbiAgICAgICAgICAgIHlQb3MgKz0gZG9jdW1lbnREYXRhLnlPZmZzZXQ7XHJcbiAgICAgICAgICAgIHlQb3MgKz0gZmlyc3RMaW5lID8gMSA6IDA7XHJcbiAgICAgICAgICAgIGZpcnN0TGluZSA9IGZhbHNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYoc2hhcGVEYXRhICYmIHNoYXBlRGF0YS5zaGFwZXMpe1xyXG4gICAgICAgICAgICBzaGFwZXMgPSBzaGFwZURhdGEuc2hhcGVzWzBdLml0O1xyXG4gICAgICAgICAgICBqTGVuID0gc2hhcGVzLmxlbmd0aDtcclxuICAgICAgICAgICAgbWF0cml4SGVscGVyLnNjYWxlKGRvY3VtZW50RGF0YS5zLzEwMCxkb2N1bWVudERhdGEucy8xMDApO1xyXG4gICAgICAgICAgICBpZihzaW5nbGVTaGFwZSl7XHJcbiAgICAgICAgICAgICAgICBpZihkb2N1bWVudERhdGEucHMpe1xyXG4gICAgICAgICAgICAgICAgICAgIG1hdHJpeEhlbHBlci50cmFuc2xhdGUoZG9jdW1lbnREYXRhLnBzWzBdLGRvY3VtZW50RGF0YS5wc1sxXSArIGRvY3VtZW50RGF0YS5hc2NlbnQsMCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBtYXRyaXhIZWxwZXIudHJhbnNsYXRlKDAsLWRvY3VtZW50RGF0YS5scywwKTtcclxuICAgICAgICAgICAgICAgIHN3aXRjaChkb2N1bWVudERhdGEuail7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAxOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBtYXRyaXhIZWxwZXIudHJhbnNsYXRlKGRvY3VtZW50RGF0YS5qdXN0aWZ5T2Zmc2V0ICsgKGJveFdpZHRoIC0gbGluZVdpZHRoc1tsZXR0ZXJzW2ldLmxpbmVdKSwwLDApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIDI6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1hdHJpeEhlbHBlci50cmFuc2xhdGUoZG9jdW1lbnREYXRhLmp1c3RpZnlPZmZzZXQgKyAoYm94V2lkdGggLSBsaW5lV2lkdGhzW2xldHRlcnNbaV0ubGluZV0pLzIsMCwwKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBtYXRyaXhIZWxwZXIudHJhbnNsYXRlKHhQb3MseVBvcywwKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjb21tYW5kcyA9IG5ldyBBcnJheShqTGVuKTtcclxuICAgICAgICAgICAgZm9yKGo9MDtqPGpMZW47ais9MSl7XHJcbiAgICAgICAgICAgICAgICBrTGVuID0gc2hhcGVzW2pdLmtzLmsuaS5sZW5ndGg7XHJcbiAgICAgICAgICAgICAgICBwYXRoTm9kZXMgPSBzaGFwZXNbal0ua3MuaztcclxuICAgICAgICAgICAgICAgIHBhdGhBcnIgPSBbXTtcclxuICAgICAgICAgICAgICAgIGZvcihrPTE7azxrTGVuO2srPTEpe1xyXG4gICAgICAgICAgICAgICAgICAgIGlmKGs9PTEpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwYXRoQXJyLnB1c2gobWF0cml4SGVscGVyLmFwcGx5VG9YKHBhdGhOb2Rlcy52WzBdWzBdLHBhdGhOb2Rlcy52WzBdWzFdLDApLG1hdHJpeEhlbHBlci5hcHBseVRvWShwYXRoTm9kZXMudlswXVswXSxwYXRoTm9kZXMudlswXVsxXSwwKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHBhdGhBcnIucHVzaChtYXRyaXhIZWxwZXIuYXBwbHlUb1gocGF0aE5vZGVzLm9bay0xXVswXSxwYXRoTm9kZXMub1trLTFdWzFdLDApLG1hdHJpeEhlbHBlci5hcHBseVRvWShwYXRoTm9kZXMub1trLTFdWzBdLHBhdGhOb2Rlcy5vW2stMV1bMV0sMCksbWF0cml4SGVscGVyLmFwcGx5VG9YKHBhdGhOb2Rlcy5pW2tdWzBdLHBhdGhOb2Rlcy5pW2tdWzFdLDApLG1hdHJpeEhlbHBlci5hcHBseVRvWShwYXRoTm9kZXMuaVtrXVswXSxwYXRoTm9kZXMuaVtrXVsxXSwwKSxtYXRyaXhIZWxwZXIuYXBwbHlUb1gocGF0aE5vZGVzLnZba11bMF0scGF0aE5vZGVzLnZba11bMV0sMCksbWF0cml4SGVscGVyLmFwcGx5VG9ZKHBhdGhOb2Rlcy52W2tdWzBdLHBhdGhOb2Rlcy52W2tdWzFdLDApKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHBhdGhBcnIucHVzaChtYXRyaXhIZWxwZXIuYXBwbHlUb1gocGF0aE5vZGVzLm9bay0xXVswXSxwYXRoTm9kZXMub1trLTFdWzFdLDApLG1hdHJpeEhlbHBlci5hcHBseVRvWShwYXRoTm9kZXMub1trLTFdWzBdLHBhdGhOb2Rlcy5vW2stMV1bMV0sMCksbWF0cml4SGVscGVyLmFwcGx5VG9YKHBhdGhOb2Rlcy5pWzBdWzBdLHBhdGhOb2Rlcy5pWzBdWzFdLDApLG1hdHJpeEhlbHBlci5hcHBseVRvWShwYXRoTm9kZXMuaVswXVswXSxwYXRoTm9kZXMuaVswXVsxXSwwKSxtYXRyaXhIZWxwZXIuYXBwbHlUb1gocGF0aE5vZGVzLnZbMF1bMF0scGF0aE5vZGVzLnZbMF1bMV0sMCksbWF0cml4SGVscGVyLmFwcGx5VG9ZKHBhdGhOb2Rlcy52WzBdWzBdLHBhdGhOb2Rlcy52WzBdWzFdLDApKTtcclxuICAgICAgICAgICAgICAgIGNvbW1hbmRzW2pdID0gcGF0aEFycjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICBjb21tYW5kcyA9IFtdO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZihzaW5nbGVTaGFwZSl7XHJcbiAgICAgICAgICAgIHhQb3MgKz0gbGV0dGVyc1tpXS5sO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZih0aGlzLnRleHRTcGFuc1tjbnRdKXtcclxuICAgICAgICAgICAgdGhpcy50ZXh0U3BhbnNbY250XS5lbGVtID0gY29tbWFuZHM7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy50ZXh0U3BhbnNbY250XSA9IHtlbGVtOiBjb21tYW5kc307XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNudCArPTE7XHJcbiAgICB9XHJcbn1cclxuXHJcbkNWVGV4dEVsZW1lbnQucHJvdG90eXBlLnJlbmRlckZyYW1lID0gZnVuY3Rpb24ocGFyZW50TWF0cml4KXtcclxuICAgIGlmKHRoaXMuX3BhcmVudC5yZW5kZXJGcmFtZS5jYWxsKHRoaXMsIHBhcmVudE1hdHJpeCk9PT1mYWxzZSl7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgdmFyIGN0eCA9IHRoaXMuY2FudmFzQ29udGV4dDtcclxuICAgIHZhciBmaW5hbE1hdCA9IHRoaXMuZmluYWxUcmFuc2Zvcm0ubWF0LnByb3BzO1xyXG4gICAgdGhpcy5nbG9iYWxEYXRhLnJlbmRlcmVyLnNhdmUoKTtcclxuICAgIHRoaXMuZ2xvYmFsRGF0YS5yZW5kZXJlci5jdHhUcmFuc2Zvcm0oZmluYWxNYXQpO1xyXG4gICAgdGhpcy5nbG9iYWxEYXRhLnJlbmRlcmVyLmN0eE9wYWNpdHkodGhpcy5maW5hbFRyYW5zZm9ybS5vcGFjaXR5KTtcclxuICAgIGN0eC5mb250ID0gdGhpcy52YWx1ZXMuZlZhbHVlO1xyXG4gICAgY3R4LmxpbmVDYXAgPSAnYnV0dCc7XHJcbiAgICBjdHgubGluZUpvaW4gPSAnbWl0ZXInO1xyXG4gICAgY3R4Lm1pdGVyTGltaXQgPSA0O1xyXG5cclxuICAgIGlmKCF0aGlzLmRhdGEuc2luZ2xlU2hhcGUpe1xyXG4gICAgICAgIHRoaXMuZ2V0TWVhc3VyZXMoKTtcclxuICAgIH1cclxuXHJcbiAgICB2YXIgIGksbGVuLCBqLCBqTGVuLCBrLCBrTGVuO1xyXG4gICAgdmFyIHJlbmRlcmVkTGV0dGVycyA9IHRoaXMucmVuZGVyZWRMZXR0ZXJzO1xyXG5cclxuICAgIHZhciBsZXR0ZXJzID0gdGhpcy5jdXJyZW50VGV4dERvY3VtZW50RGF0YS5sO1xyXG5cclxuICAgIGxlbiA9IGxldHRlcnMubGVuZ3RoO1xyXG4gICAgdmFyIHJlbmRlcmVkTGV0dGVyO1xyXG4gICAgdmFyIGxhc3RGaWxsID0gbnVsbCwgbGFzdFN0cm9rZSA9IG51bGwsIGxhc3RTdHJva2VXID0gbnVsbCwgY29tbWFuZHMsIHBhdGhBcnI7XHJcbiAgICBmb3IoaT0wO2k8bGVuO2krPTEpe1xyXG4gICAgICAgIGlmKGxldHRlcnNbaV0ubil7XHJcbiAgICAgICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZW5kZXJlZExldHRlciA9IHJlbmRlcmVkTGV0dGVyc1tpXTtcclxuICAgICAgICBpZihyZW5kZXJlZExldHRlcil7XHJcbiAgICAgICAgICAgIHRoaXMuZ2xvYmFsRGF0YS5yZW5kZXJlci5zYXZlKCk7XHJcbiAgICAgICAgICAgIHRoaXMuZ2xvYmFsRGF0YS5yZW5kZXJlci5jdHhUcmFuc2Zvcm0ocmVuZGVyZWRMZXR0ZXIucHJvcHMpO1xyXG4gICAgICAgICAgICB0aGlzLmdsb2JhbERhdGEucmVuZGVyZXIuY3R4T3BhY2l0eShyZW5kZXJlZExldHRlci5vKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYodGhpcy5maWxsKXtcclxuICAgICAgICAgICAgaWYocmVuZGVyZWRMZXR0ZXIgJiYgcmVuZGVyZWRMZXR0ZXIuZmMpe1xyXG4gICAgICAgICAgICAgICAgaWYobGFzdEZpbGwgIT09IHJlbmRlcmVkTGV0dGVyLmZjKXtcclxuICAgICAgICAgICAgICAgICAgICBsYXN0RmlsbCA9IHJlbmRlcmVkTGV0dGVyLmZjO1xyXG4gICAgICAgICAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSByZW5kZXJlZExldHRlci5mYztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfWVsc2UgaWYobGFzdEZpbGwgIT09IHRoaXMudmFsdWVzLmZpbGwpe1xyXG4gICAgICAgICAgICAgICAgbGFzdEZpbGwgPSB0aGlzLnZhbHVlcy5maWxsO1xyXG4gICAgICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9IHRoaXMudmFsdWVzLmZpbGw7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY29tbWFuZHMgPSB0aGlzLnRleHRTcGFuc1tpXS5lbGVtO1xyXG4gICAgICAgICAgICBqTGVuID0gY29tbWFuZHMubGVuZ3RoO1xyXG4gICAgICAgICAgICB0aGlzLmdsb2JhbERhdGEuY2FudmFzQ29udGV4dC5iZWdpblBhdGgoKTtcclxuICAgICAgICAgICAgZm9yKGo9MDtqPGpMZW47ais9MSkge1xyXG4gICAgICAgICAgICAgICAgcGF0aEFyciA9IGNvbW1hbmRzW2pdO1xyXG4gICAgICAgICAgICAgICAga0xlbiA9IHBhdGhBcnIubGVuZ3RoO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5nbG9iYWxEYXRhLmNhbnZhc0NvbnRleHQubW92ZVRvKHBhdGhBcnJbMF0sIHBhdGhBcnJbMV0pO1xyXG4gICAgICAgICAgICAgICAgZm9yIChrID0gMjsgayA8IGtMZW47IGsgKz0gNikge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZ2xvYmFsRGF0YS5jYW52YXNDb250ZXh0LmJlemllckN1cnZlVG8ocGF0aEFycltrXSwgcGF0aEFycltrICsgMV0sIHBhdGhBcnJbayArIDJdLCBwYXRoQXJyW2sgKyAzXSwgcGF0aEFycltrICsgNF0sIHBhdGhBcnJbayArIDVdKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLmdsb2JhbERhdGEuY2FudmFzQ29udGV4dC5jbG9zZVBhdGgoKTtcclxuICAgICAgICAgICAgdGhpcy5nbG9iYWxEYXRhLmNhbnZhc0NvbnRleHQuZmlsbCgpO1xyXG4gICAgICAgICAgICAvLy9jdHguZmlsbFRleHQodGhpcy50ZXh0U3BhbnNbaV0udmFsLDAsMCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmKHRoaXMuc3Ryb2tlKXtcclxuICAgICAgICAgICAgaWYocmVuZGVyZWRMZXR0ZXIgJiYgcmVuZGVyZWRMZXR0ZXIuc3cpe1xyXG4gICAgICAgICAgICAgICAgaWYobGFzdFN0cm9rZVcgIT09IHJlbmRlcmVkTGV0dGVyLnN3KXtcclxuICAgICAgICAgICAgICAgICAgICBsYXN0U3Ryb2tlVyA9IHJlbmRlcmVkTGV0dGVyLnN3O1xyXG4gICAgICAgICAgICAgICAgICAgIGN0eC5saW5lV2lkdGggPSByZW5kZXJlZExldHRlci5zdztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfWVsc2UgaWYobGFzdFN0cm9rZVcgIT09IHRoaXMudmFsdWVzLnNXaWR0aCl7XHJcbiAgICAgICAgICAgICAgICBsYXN0U3Ryb2tlVyA9IHRoaXMudmFsdWVzLnNXaWR0aDtcclxuICAgICAgICAgICAgICAgIGN0eC5saW5lV2lkdGggPSB0aGlzLnZhbHVlcy5zV2lkdGg7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYocmVuZGVyZWRMZXR0ZXIgJiYgcmVuZGVyZWRMZXR0ZXIuc2Mpe1xyXG4gICAgICAgICAgICAgICAgaWYobGFzdFN0cm9rZSAhPT0gcmVuZGVyZWRMZXR0ZXIuc2Mpe1xyXG4gICAgICAgICAgICAgICAgICAgIGxhc3RTdHJva2UgPSByZW5kZXJlZExldHRlci5zYztcclxuICAgICAgICAgICAgICAgICAgICBjdHguc3Ryb2tlU3R5bGUgPSByZW5kZXJlZExldHRlci5zYztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfWVsc2UgaWYobGFzdFN0cm9rZSAhPT0gdGhpcy52YWx1ZXMuc3Ryb2tlKXtcclxuICAgICAgICAgICAgICAgIGxhc3RTdHJva2UgPSB0aGlzLnZhbHVlcy5zdHJva2U7XHJcbiAgICAgICAgICAgICAgICBjdHguc3Ryb2tlU3R5bGUgPSB0aGlzLnZhbHVlcy5zdHJva2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY29tbWFuZHMgPSB0aGlzLnRleHRTcGFuc1tpXS5lbGVtO1xyXG4gICAgICAgICAgICBqTGVuID0gY29tbWFuZHMubGVuZ3RoO1xyXG4gICAgICAgICAgICB0aGlzLmdsb2JhbERhdGEuY2FudmFzQ29udGV4dC5iZWdpblBhdGgoKTtcclxuICAgICAgICAgICAgZm9yKGo9MDtqPGpMZW47ais9MSkge1xyXG4gICAgICAgICAgICAgICAgcGF0aEFyciA9IGNvbW1hbmRzW2pdO1xyXG4gICAgICAgICAgICAgICAga0xlbiA9IHBhdGhBcnIubGVuZ3RoO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5nbG9iYWxEYXRhLmNhbnZhc0NvbnRleHQubW92ZVRvKHBhdGhBcnJbMF0sIHBhdGhBcnJbMV0pO1xyXG4gICAgICAgICAgICAgICAgZm9yIChrID0gMjsgayA8IGtMZW47IGsgKz0gNikge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZ2xvYmFsRGF0YS5jYW52YXNDb250ZXh0LmJlemllckN1cnZlVG8ocGF0aEFycltrXSwgcGF0aEFycltrICsgMV0sIHBhdGhBcnJbayArIDJdLCBwYXRoQXJyW2sgKyAzXSwgcGF0aEFycltrICsgNF0sIHBhdGhBcnJbayArIDVdKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLmdsb2JhbERhdGEuY2FudmFzQ29udGV4dC5jbG9zZVBhdGgoKTtcclxuICAgICAgICAgICAgdGhpcy5nbG9iYWxEYXRhLmNhbnZhc0NvbnRleHQuc3Ryb2tlKCk7XHJcbiAgICAgICAgICAgIC8vL2N0eC5zdHJva2VUZXh0KGxldHRlcnNbaV0udmFsLDAsMCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmKHJlbmRlcmVkTGV0dGVyKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZ2xvYmFsRGF0YS5yZW5kZXJlci5yZXN0b3JlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgLyppZih0aGlzLmRhdGEuaGFzTWFzayl7XHJcbiAgICAgdGhpcy5nbG9iYWxEYXRhLnJlbmRlcmVyLnJlc3RvcmUodHJ1ZSk7XHJcbiAgICAgfSovXHJcbiAgICB0aGlzLmdsb2JhbERhdGEucmVuZGVyZXIucmVzdG9yZSh0aGlzLmRhdGEuaGFzTWFzayk7XHJcbiAgICBpZih0aGlzLmZpcnN0RnJhbWUpe1xyXG4gICAgICAgIHRoaXMuZmlyc3RGcmFtZSA9IGZhbHNlO1xyXG4gICAgfVxyXG59O1xuZnVuY3Rpb24gSEJhc2VFbGVtZW50KGRhdGEscGFyZW50Q29udGFpbmVyLGdsb2JhbERhdGEsY29tcCwgcGxhY2Vob2xkZXIpe1xyXG4gICAgdGhpcy5nbG9iYWxEYXRhID0gZ2xvYmFsRGF0YTtcclxuICAgIHRoaXMuY29tcCA9IGNvbXA7XHJcbiAgICB0aGlzLmRhdGEgPSBkYXRhO1xyXG4gICAgdGhpcy5tYXR0ZUVsZW1lbnQgPSBudWxsO1xyXG4gICAgdGhpcy5wYXJlbnRDb250YWluZXIgPSBwYXJlbnRDb250YWluZXI7XHJcbiAgICB0aGlzLmxheWVySWQgPSBwbGFjZWhvbGRlciA/IHBsYWNlaG9sZGVyLmxheWVySWQgOiAnbHlfJytyYW5kb21TdHJpbmcoMTApO1xyXG4gICAgdGhpcy5wbGFjZWhvbGRlciA9IHBsYWNlaG9sZGVyO1xyXG4gICAgdGhpcy5pbml0KCk7XHJcbn07XHJcblxyXG5jcmVhdGVFbGVtZW50KEJhc2VFbGVtZW50LCBIQmFzZUVsZW1lbnQpO1xyXG5IQmFzZUVsZW1lbnQucHJvdG90eXBlLmNoZWNrQmxlbmRNb2RlID0gZnVuY3Rpb24oKXtcclxuXHJcbn07XHJcbkhCYXNlRWxlbWVudC5wcm90b3R5cGUuc2V0QmxlbmRNb2RlID0gQmFzZUVsZW1lbnQucHJvdG90eXBlLnNldEJsZW5kTW9kZTtcclxuXHJcbi8qSEJhc2VFbGVtZW50LnByb3RvdHlwZS5hcHBlbmROb2RlVG9QYXJlbnQgPSBmdW5jdGlvbihub2RlKSB7XHJcbiAgICBpZih0aGlzLmRhdGEuaGQpe1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGlmKHRoaXMucGxhY2Vob2xkZXIpe1xyXG4gICAgICAgIHZhciBnID0gdGhpcy5wbGFjZWhvbGRlci5waEVsZW1lbnQ7XHJcbiAgICAgICAgZy5wYXJlbnROb2RlLmluc2VydEJlZm9yZShub2RlLCBnKTtcclxuICAgICAgICAvL2cucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChnKTtcclxuICAgIH1lbHNle1xyXG4gICAgICAgIHRoaXMucGFyZW50Q29udGFpbmVyLmFwcGVuZENoaWxkKG5vZGUpO1xyXG4gICAgfVxyXG59OyovXHJcblxyXG5cclxuSEJhc2VFbGVtZW50LnByb3RvdHlwZS5nZXRCYXNlRWxlbWVudCA9IGZ1bmN0aW9uKCl7XHJcbiAgICByZXR1cm4gdGhpcy5iYXNlRWxlbWVudDtcclxufTtcclxuXHJcbkhCYXNlRWxlbWVudC5wcm90b3R5cGUuY3JlYXRlRWxlbWVudHMgPSBmdW5jdGlvbigpe1xyXG4gICAgaWYodGhpcy5kYXRhLmhhc01hc2spe1xyXG4gICAgICAgIHRoaXMubGF5ZXJFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKHN2Z05TLCdzdmcnKTtcclxuICAgICAgICBzdHlsZURpdih0aGlzLmxheWVyRWxlbWVudCk7XHJcbiAgICAgICAgLy90aGlzLmFwcGVuZE5vZGVUb1BhcmVudCh0aGlzLmxheWVyRWxlbWVudCk7XHJcbiAgICAgICAgdGhpcy5iYXNlRWxlbWVudCA9IHRoaXMubGF5ZXJFbGVtZW50O1xyXG4gICAgICAgIHRoaXMubWFza2VkRWxlbWVudCA9IHRoaXMubGF5ZXJFbGVtZW50O1xyXG4gICAgfWVsc2V7XHJcbiAgICAgICAgdGhpcy5sYXllckVsZW1lbnQgPSB0aGlzLnBhcmVudENvbnRhaW5lcjtcclxuICAgIH1cclxuICAgIHRoaXMudHJhbnNmb3JtZWRFbGVtZW50ID0gdGhpcy5sYXllckVsZW1lbnQ7XHJcbiAgICBpZih0aGlzLmRhdGEubG4gJiYgKHRoaXMuZGF0YS50eSA9PT0gNCB8fCB0aGlzLmRhdGEudHkgPT09IDApKXtcclxuICAgICAgICBpZih0aGlzLmxheWVyRWxlbWVudCA9PT0gdGhpcy5wYXJlbnRDb250YWluZXIpe1xyXG4gICAgICAgICAgICB0aGlzLmxheWVyRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhzdmdOUywnZycpO1xyXG4gICAgICAgICAgICAvL3RoaXMuYXBwZW5kTm9kZVRvUGFyZW50KHRoaXMubGF5ZXJFbGVtZW50KTtcclxuICAgICAgICAgICAgdGhpcy5iYXNlRWxlbWVudCA9IHRoaXMubGF5ZXJFbGVtZW50O1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmxheWVyRWxlbWVudC5zZXRBdHRyaWJ1dGUoJ2lkJyx0aGlzLmRhdGEubG4pO1xyXG4gICAgfVxyXG4gICAgdGhpcy5zZXRCbGVuZE1vZGUoKTtcclxuICAgIGlmKHRoaXMubGF5ZXJFbGVtZW50ICE9PSB0aGlzLnBhcmVudENvbnRhaW5lcil7XHJcbiAgICAgICAgdGhpcy5wbGFjZWhvbGRlciA9IG51bGw7XHJcbiAgICB9XHJcbiAgICB0aGlzLmNoZWNrUGFyZW50aW5nKCk7XHJcbn07XHJcblxyXG5IQmFzZUVsZW1lbnQucHJvdG90eXBlLnJlbmRlckZyYW1lID0gZnVuY3Rpb24ocGFyZW50VHJhbnNmb3JtKXtcclxuICAgIGlmKHRoaXMuZGF0YS50eSA9PT0gMyl7XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIGlmKHRoaXMuY3VycmVudEZyYW1lTnVtID09PSB0aGlzLmxhc3ROdW0gfHwgIXRoaXMuaXNWaXNpYmxlKXtcclxuICAgICAgICByZXR1cm4gdGhpcy5pc1Zpc2libGU7XHJcbiAgICB9XHJcbiAgICB0aGlzLmxhc3ROdW0gPSB0aGlzLmN1cnJlbnRGcmFtZU51bTtcclxuXHJcbiAgICB0aGlzLmZpbmFsVHJhbnNmb3JtLm9wTWRmID0gdGhpcy5maW5hbFRyYW5zZm9ybS5vcC5tZGY7XHJcbiAgICB0aGlzLmZpbmFsVHJhbnNmb3JtLm1hdE1kZiA9IHRoaXMuZmluYWxUcmFuc2Zvcm0ubVByb3AubWRmO1xyXG4gICAgdGhpcy5maW5hbFRyYW5zZm9ybS5vcGFjaXR5ID0gdGhpcy5maW5hbFRyYW5zZm9ybS5vcC52O1xyXG4gICAgaWYodGhpcy5maXJzdEZyYW1lKXtcclxuICAgICAgICB0aGlzLmZpbmFsVHJhbnNmb3JtLm9wTWRmID0gdHJ1ZTtcclxuICAgICAgICB0aGlzLmZpbmFsVHJhbnNmb3JtLm1hdE1kZiA9IHRydWU7XHJcbiAgICB9XHJcblxyXG4gICAgdmFyIG1hdDtcclxuICAgIHZhciBmaW5hbE1hdCA9IHRoaXMuZmluYWxUcmFuc2Zvcm0ubWF0O1xyXG5cclxuICAgIGlmKHRoaXMuaGllcmFyY2h5KXtcclxuICAgICAgICB2YXIgaSwgbGVuID0gdGhpcy5oaWVyYXJjaHkubGVuZ3RoO1xyXG5cclxuICAgICAgICBtYXQgPSB0aGlzLmZpbmFsVHJhbnNmb3JtLm1Qcm9wLnYucHJvcHM7XHJcbiAgICAgICAgZmluYWxNYXQuY2xvbmVGcm9tUHJvcHMobWF0KTtcclxuICAgICAgICBmb3IoaT0wO2k8bGVuO2krPTEpe1xyXG4gICAgICAgICAgICB0aGlzLmZpbmFsVHJhbnNmb3JtLm1hdE1kZiA9IHRoaXMuaGllcmFyY2h5W2ldLmZpbmFsVHJhbnNmb3JtLm1Qcm9wLm1kZiA/IHRydWUgOiB0aGlzLmZpbmFsVHJhbnNmb3JtLm1hdE1kZjtcclxuICAgICAgICAgICAgbWF0ID0gdGhpcy5oaWVyYXJjaHlbaV0uZmluYWxUcmFuc2Zvcm0ubVByb3Audi5wcm9wcztcclxuICAgICAgICAgICAgZmluYWxNYXQudHJhbnNmb3JtKG1hdFswXSxtYXRbMV0sbWF0WzJdLG1hdFszXSxtYXRbNF0sbWF0WzVdLG1hdFs2XSxtYXRbN10sbWF0WzhdLG1hdFs5XSxtYXRbMTBdLG1hdFsxMV0sbWF0WzEyXSxtYXRbMTNdLG1hdFsxNF0sbWF0WzE1XSk7XHJcbiAgICAgICAgfVxyXG4gICAgfWVsc2V7XHJcbiAgICAgICAgaWYodGhpcy5pc1Zpc2libGUgJiYgdGhpcy5maW5hbFRyYW5zZm9ybS5tYXRNZGYpe1xyXG4gICAgICAgICAgICBpZighcGFyZW50VHJhbnNmb3JtKXtcclxuICAgICAgICAgICAgICAgIGZpbmFsTWF0LmNsb25lRnJvbVByb3BzKHRoaXMuZmluYWxUcmFuc2Zvcm0ubVByb3Audi5wcm9wcyk7XHJcbiAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgbWF0ID0gdGhpcy5maW5hbFRyYW5zZm9ybS5tUHJvcC52LnByb3BzO1xyXG4gICAgICAgICAgICAgICAgZmluYWxNYXQuY2xvbmVGcm9tUHJvcHMobWF0KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGlmKHRoaXMuZGF0YS5oYXNNYXNrKXtcclxuICAgICAgICB0aGlzLm1hc2tNYW5hZ2VyLnJlbmRlckZyYW1lKGZpbmFsTWF0KTtcclxuICAgIH1cclxuXHJcbiAgICBpZihwYXJlbnRUcmFuc2Zvcm0pe1xyXG4gICAgICAgIG1hdCA9IHBhcmVudFRyYW5zZm9ybS5tYXQucHJvcHM7XHJcbiAgICAgICAgZmluYWxNYXQuY2xvbmVGcm9tUHJvcHMobWF0KTtcclxuICAgICAgICB0aGlzLmZpbmFsVHJhbnNmb3JtLm9wYWNpdHkgKj0gcGFyZW50VHJhbnNmb3JtLm9wYWNpdHk7XHJcbiAgICAgICAgdGhpcy5maW5hbFRyYW5zZm9ybS5vcE1kZiA9IHBhcmVudFRyYW5zZm9ybS5vcE1kZiA/IHRydWUgOiB0aGlzLmZpbmFsVHJhbnNmb3JtLm9wTWRmO1xyXG4gICAgICAgIHRoaXMuZmluYWxUcmFuc2Zvcm0ubWF0TWRmID0gcGFyZW50VHJhbnNmb3JtLm1hdE1kZiA/IHRydWUgOiB0aGlzLmZpbmFsVHJhbnNmb3JtLm1hdE1kZlxyXG4gICAgfVxyXG5cclxuICAgIGlmKHRoaXMuZmluYWxUcmFuc2Zvcm0ubWF0TWRmKXtcclxuICAgICAgICB0aGlzLnRyYW5zZm9ybWVkRWxlbWVudC5zdHlsZS50cmFuc2Zvcm0gPSB0aGlzLnRyYW5zZm9ybWVkRWxlbWVudC5zdHlsZS53ZWJraXRUcmFuc2Zvcm0gPSBmaW5hbE1hdC50b0NTUygpO1xyXG4gICAgICAgIHRoaXMuZmluYWxNYXQgPSBmaW5hbE1hdDtcclxuICAgIH1cclxuICAgIGlmKHRoaXMuZmluYWxUcmFuc2Zvcm0ub3BNZGYpe1xyXG4gICAgICAgIHRoaXMudHJhbnNmb3JtZWRFbGVtZW50LnN0eWxlLm9wYWNpdHkgPSB0aGlzLmZpbmFsVHJhbnNmb3JtLm9wYWNpdHk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdGhpcy5pc1Zpc2libGU7XHJcbn07XHJcblxyXG5IQmFzZUVsZW1lbnQucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbigpe1xyXG4gICAgdGhpcy5sYXllckVsZW1lbnQgPSBudWxsO1xyXG4gICAgdGhpcy50cmFuc2Zvcm1lZEVsZW1lbnQgPSBudWxsO1xyXG4gICAgdGhpcy5wYXJlbnRDb250YWluZXIgPSBudWxsO1xyXG4gICAgaWYodGhpcy5tYXR0ZUVsZW1lbnQpIHtcclxuICAgICAgICB0aGlzLm1hdHRlRWxlbWVudCA9IG51bGw7XHJcbiAgICB9XHJcbiAgICBpZih0aGlzLm1hc2tNYW5hZ2VyKSB7XHJcbiAgICAgICAgdGhpcy5tYXNrTWFuYWdlci5kZXN0cm95KCk7XHJcbiAgICAgICAgdGhpcy5tYXNrTWFuYWdlciA9IG51bGw7XHJcbiAgICB9XHJcbn07XHJcblxyXG5IQmFzZUVsZW1lbnQucHJvdG90eXBlLmdldERvbUVsZW1lbnQgPSBmdW5jdGlvbigpe1xyXG4gICAgcmV0dXJuIHRoaXMubGF5ZXJFbGVtZW50O1xyXG59O1xyXG5IQmFzZUVsZW1lbnQucHJvdG90eXBlLmFkZE1hc2tzID0gZnVuY3Rpb24oZGF0YSl7XHJcbiAgICB0aGlzLm1hc2tNYW5hZ2VyID0gbmV3IE1hc2tFbGVtZW50KGRhdGEsdGhpcyx0aGlzLmdsb2JhbERhdGEpO1xyXG59O1xyXG5cclxuSEJhc2VFbGVtZW50LnByb3RvdHlwZS5oaWRlID0gZnVuY3Rpb24oKXtcclxufTtcclxuXHJcbkhCYXNlRWxlbWVudC5wcm90b3R5cGUuc2V0TWF0dGUgPSBmdW5jdGlvbigpe1xyXG5cclxufVxyXG5cclxuSEJhc2VFbGVtZW50LnByb3RvdHlwZS5idWlsZEVsZW1lbnRQYXJlbnRpbmcgPSBIeWJyaWRSZW5kZXJlci5wcm90b3R5cGUuYnVpbGRFbGVtZW50UGFyZW50aW5nO1xuZnVuY3Rpb24gSFNvbGlkRWxlbWVudChkYXRhLHBhcmVudENvbnRhaW5lcixnbG9iYWxEYXRhLGNvbXAsIHBsYWNlaG9sZGVyKXtcclxuICAgIHRoaXMuX3BhcmVudC5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsZGF0YSxwYXJlbnRDb250YWluZXIsZ2xvYmFsRGF0YSxjb21wLCBwbGFjZWhvbGRlcik7XHJcbn1cclxuY3JlYXRlRWxlbWVudChIQmFzZUVsZW1lbnQsIEhTb2xpZEVsZW1lbnQpO1xyXG5cclxuSFNvbGlkRWxlbWVudC5wcm90b3R5cGUuY3JlYXRlRWxlbWVudHMgPSBmdW5jdGlvbigpe1xyXG4gICAgdmFyIHBhcmVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgc3R5bGVEaXYocGFyZW50KTtcclxuICAgIHZhciBjb250ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKHN2Z05TLCdzdmcnKTtcclxuICAgIHN0eWxlRGl2KGNvbnQpO1xyXG4gICAgY29udC5zZXRBdHRyaWJ1dGUoJ3dpZHRoJyx0aGlzLmRhdGEuc3cpO1xyXG4gICAgY29udC5zZXRBdHRyaWJ1dGUoJ2hlaWdodCcsdGhpcy5kYXRhLnNoKTtcclxuICAgIHBhcmVudC5hcHBlbmRDaGlsZChjb250KTtcclxuICAgIHRoaXMubGF5ZXJFbGVtZW50ID0gcGFyZW50O1xyXG4gICAgdGhpcy50cmFuc2Zvcm1lZEVsZW1lbnQgPSBwYXJlbnQ7XHJcbiAgICAvL3RoaXMuYXBwZW5kTm9kZVRvUGFyZW50KHBhcmVudCk7XHJcbiAgICB0aGlzLmJhc2VFbGVtZW50ID0gcGFyZW50O1xyXG4gICAgdGhpcy5pbm5lckVsZW0gPSBwYXJlbnQ7XHJcbiAgICBpZih0aGlzLmRhdGEubG4pe1xyXG4gICAgICAgIHRoaXMuaW5uZXJFbGVtLnNldEF0dHJpYnV0ZSgnaWQnLHRoaXMuZGF0YS5sbik7XHJcbiAgICB9XHJcbiAgICBpZih0aGlzLmRhdGEuYm0gIT09IDApe1xyXG4gICAgICAgIHRoaXMuc2V0QmxlbmRNb2RlKCk7XHJcbiAgICB9XHJcbiAgICB2YXIgcmVjdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhzdmdOUywncmVjdCcpO1xyXG4gICAgcmVjdC5zZXRBdHRyaWJ1dGUoJ3dpZHRoJyx0aGlzLmRhdGEuc3cpO1xyXG4gICAgcmVjdC5zZXRBdHRyaWJ1dGUoJ2hlaWdodCcsdGhpcy5kYXRhLnNoKTtcclxuICAgIHJlY3Quc2V0QXR0cmlidXRlKCdmaWxsJyx0aGlzLmRhdGEuc2MpO1xyXG4gICAgY29udC5hcHBlbmRDaGlsZChyZWN0KTtcclxuICAgIGlmKHRoaXMuZGF0YS5oYXNNYXNrKXtcclxuICAgICAgICB0aGlzLm1hc2tlZEVsZW1lbnQgPSByZWN0O1xyXG4gICAgfVxyXG4gICAgdGhpcy5jaGVja1BhcmVudGluZygpO1xyXG59O1xyXG5cclxuXHJcblxyXG5IU29saWRFbGVtZW50LnByb3RvdHlwZS5oaWRlID0gU1ZHQmFzZUVsZW1lbnQucHJvdG90eXBlLmhpZGU7XHJcbkhTb2xpZEVsZW1lbnQucHJvdG90eXBlLnNob3cgPSBTVkdCYXNlRWxlbWVudC5wcm90b3R5cGUuc2hvdztcclxuSFNvbGlkRWxlbWVudC5wcm90b3R5cGUucmVuZGVyRnJhbWUgPSBJSW1hZ2VFbGVtZW50LnByb3RvdHlwZS5yZW5kZXJGcmFtZTtcclxuSFNvbGlkRWxlbWVudC5wcm90b3R5cGUuZGVzdHJveSA9IElJbWFnZUVsZW1lbnQucHJvdG90eXBlLmRlc3Ryb3k7XG5mdW5jdGlvbiBIQ29tcEVsZW1lbnQoZGF0YSxwYXJlbnRDb250YWluZXIsZ2xvYmFsRGF0YSxjb21wLCBwbGFjZWhvbGRlcil7XHJcbiAgICB0aGlzLl9wYXJlbnQuY29uc3RydWN0b3IuY2FsbCh0aGlzLGRhdGEscGFyZW50Q29udGFpbmVyLGdsb2JhbERhdGEsY29tcCwgcGxhY2Vob2xkZXIpO1xyXG4gICAgdGhpcy5sYXllcnMgPSBkYXRhLmxheWVycztcclxuICAgIHRoaXMuc3VwcG9ydHMzZCA9IHRydWU7XHJcbiAgICB0aGlzLmNvbXBsZXRlTGF5ZXJzID0gZmFsc2U7XHJcbiAgICB0aGlzLnBlbmRpbmdFbGVtZW50cyA9IFtdO1xyXG4gICAgdGhpcy5lbGVtZW50cyA9IEFycmF5LmFwcGx5KG51bGwse2xlbmd0aDp0aGlzLmxheWVycy5sZW5ndGh9KTtcclxuICAgIGlmKHRoaXMuZGF0YS50bSl7XHJcbiAgICAgICAgdGhpcy50bSA9IFByb3BlcnR5RmFjdG9yeS5nZXRQcm9wKHRoaXMsdGhpcy5kYXRhLnRtLDAsZ2xvYmFsRGF0YS5mcmFtZVJhdGUsdGhpcy5keW5hbWljUHJvcGVydGllcyk7XHJcbiAgICB9XHJcbiAgICBpZih0aGlzLmRhdGEuaGFzTWFzaykge1xyXG4gICAgICAgIHRoaXMuc3VwcG9ydHMzZCA9IGZhbHNlO1xyXG4gICAgfVxyXG4gICAgaWYodGhpcy5kYXRhLnh0KXtcclxuICAgICAgICB0aGlzLmxheWVyRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgfVxyXG4gICAgdGhpcy5idWlsZEFsbEl0ZW1zKCk7XHJcblxyXG59XHJcbmNyZWF0ZUVsZW1lbnQoSEJhc2VFbGVtZW50LCBIQ29tcEVsZW1lbnQpO1xyXG5cclxuSENvbXBFbGVtZW50LnByb3RvdHlwZS5jcmVhdGVFbGVtZW50cyA9IGZ1bmN0aW9uKCl7XHJcbiAgICB2YXIgZGl2RWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgc3R5bGVEaXYoZGl2RWxlbWVudCk7XHJcbiAgICBpZih0aGlzLmRhdGEubG4pe1xyXG4gICAgICAgIGRpdkVsZW1lbnQuc2V0QXR0cmlidXRlKCdpZCcsdGhpcy5kYXRhLmxuKTtcclxuICAgIH1cclxuICAgIGRpdkVsZW1lbnQuc3R5bGUuY2xpcCA9ICdyZWN0KDBweCwgJyt0aGlzLmRhdGEudysncHgsICcrdGhpcy5kYXRhLmgrJ3B4LCAwcHgpJztcclxuICAgIGlmKHRoaXMuZGF0YS5oYXNNYXNrKXtcclxuICAgICAgICB2YXIgY29tcFN2ZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhzdmdOUywnc3ZnJyk7XHJcbiAgICAgICAgc3R5bGVEaXYoY29tcFN2Zyk7XHJcbiAgICAgICAgY29tcFN2Zy5zZXRBdHRyaWJ1dGUoJ3dpZHRoJyx0aGlzLmRhdGEudyk7XHJcbiAgICAgICAgY29tcFN2Zy5zZXRBdHRyaWJ1dGUoJ2hlaWdodCcsdGhpcy5kYXRhLmgpO1xyXG4gICAgICAgIHZhciBnID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKHN2Z05TLCdnJyk7XHJcbiAgICAgICAgY29tcFN2Zy5hcHBlbmRDaGlsZChnKTtcclxuICAgICAgICBkaXZFbGVtZW50LmFwcGVuZENoaWxkKGNvbXBTdmcpO1xyXG4gICAgICAgIHRoaXMubWFza2VkRWxlbWVudCA9IGc7XHJcbiAgICAgICAgdGhpcy5iYXNlRWxlbWVudCA9IGRpdkVsZW1lbnQ7XHJcbiAgICAgICAgdGhpcy5sYXllckVsZW1lbnQgPSBnO1xyXG4gICAgICAgIHRoaXMudHJhbnNmb3JtZWRFbGVtZW50ID0gZGl2RWxlbWVudDtcclxuICAgIH1lbHNle1xyXG4gICAgICAgIHRoaXMubGF5ZXJFbGVtZW50ID0gZGl2RWxlbWVudDtcclxuICAgICAgICB0aGlzLmJhc2VFbGVtZW50ID0gdGhpcy5sYXllckVsZW1lbnQ7XHJcbiAgICAgICAgdGhpcy50cmFuc2Zvcm1lZEVsZW1lbnQgPSBkaXZFbGVtZW50O1xyXG4gICAgfVxyXG4gICAgLy90aGlzLmFwcGVuZE5vZGVUb1BhcmVudCh0aGlzLmxheWVyRWxlbWVudCk7XHJcbiAgICB0aGlzLmNoZWNrUGFyZW50aW5nKCk7XHJcbn07XHJcblxyXG5IQ29tcEVsZW1lbnQucHJvdG90eXBlLmhpZGUgPSBJQ29tcEVsZW1lbnQucHJvdG90eXBlLmhpZGU7XHJcbkhDb21wRWxlbWVudC5wcm90b3R5cGUucHJlcGFyZUZyYW1lID0gSUNvbXBFbGVtZW50LnByb3RvdHlwZS5wcmVwYXJlRnJhbWU7XHJcbkhDb21wRWxlbWVudC5wcm90b3R5cGUuc2V0RWxlbWVudHMgPSBJQ29tcEVsZW1lbnQucHJvdG90eXBlLnNldEVsZW1lbnRzO1xyXG5IQ29tcEVsZW1lbnQucHJvdG90eXBlLmdldEVsZW1lbnRzID0gSUNvbXBFbGVtZW50LnByb3RvdHlwZS5nZXRFbGVtZW50cztcclxuSENvbXBFbGVtZW50LnByb3RvdHlwZS5kZXN0cm95ID0gSUNvbXBFbGVtZW50LnByb3RvdHlwZS5kZXN0cm95O1xyXG5cclxuSENvbXBFbGVtZW50LnByb3RvdHlwZS5yZW5kZXJGcmFtZSA9IGZ1bmN0aW9uKHBhcmVudE1hdHJpeCl7XHJcbiAgICB2YXIgcmVuZGVyUGFyZW50ID0gdGhpcy5fcGFyZW50LnJlbmRlckZyYW1lLmNhbGwodGhpcyxwYXJlbnRNYXRyaXgpO1xyXG4gICAgdmFyIGksbGVuID0gdGhpcy5sYXllcnMubGVuZ3RoO1xyXG4gICAgaWYocmVuZGVyUGFyZW50PT09ZmFsc2Upe1xyXG4gICAgICAgIHRoaXMuaGlkZSgpO1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLmhpZGRlbiA9IGZhbHNlO1xyXG5cclxuICAgIGZvciggaSA9IDA7IGkgPCBsZW47IGkrPTEgKXtcclxuICAgICAgICBpZih0aGlzLmNvbXBsZXRlTGF5ZXJzIHx8IHRoaXMuZWxlbWVudHNbaV0pe1xyXG4gICAgICAgICAgICB0aGlzLmVsZW1lbnRzW2ldLnJlbmRlckZyYW1lKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgaWYodGhpcy5maXJzdEZyYW1lKXtcclxuICAgICAgICB0aGlzLmZpcnN0RnJhbWUgPSBmYWxzZTtcclxuICAgIH1cclxufTtcclxuXHJcbkhDb21wRWxlbWVudC5wcm90b3R5cGUuY2hlY2tMYXllcnMgPSBCYXNlUmVuZGVyZXIucHJvdG90eXBlLmNoZWNrTGF5ZXJzO1xyXG5IQ29tcEVsZW1lbnQucHJvdG90eXBlLmJ1aWxkSXRlbSA9IEh5YnJpZFJlbmRlcmVyLnByb3RvdHlwZS5idWlsZEl0ZW07XHJcbkhDb21wRWxlbWVudC5wcm90b3R5cGUuY2hlY2tQZW5kaW5nRWxlbWVudHMgPSBIeWJyaWRSZW5kZXJlci5wcm90b3R5cGUuY2hlY2tQZW5kaW5nRWxlbWVudHM7XHJcbkhDb21wRWxlbWVudC5wcm90b3R5cGUuYWRkUGVuZGluZ0VsZW1lbnQgPSBIeWJyaWRSZW5kZXJlci5wcm90b3R5cGUuYWRkUGVuZGluZ0VsZW1lbnQ7XHJcbkhDb21wRWxlbWVudC5wcm90b3R5cGUuYnVpbGRBbGxJdGVtcyA9IEJhc2VSZW5kZXJlci5wcm90b3R5cGUuYnVpbGRBbGxJdGVtcztcclxuSENvbXBFbGVtZW50LnByb3RvdHlwZS5jcmVhdGVJdGVtID0gSHlicmlkUmVuZGVyZXIucHJvdG90eXBlLmNyZWF0ZUl0ZW07XHJcbkhDb21wRWxlbWVudC5wcm90b3R5cGUuYnVpbGRFbGVtZW50UGFyZW50aW5nID0gSHlicmlkUmVuZGVyZXIucHJvdG90eXBlLmJ1aWxkRWxlbWVudFBhcmVudGluZztcclxuSENvbXBFbGVtZW50LnByb3RvdHlwZS5jcmVhdGVJbWFnZSA9IEh5YnJpZFJlbmRlcmVyLnByb3RvdHlwZS5jcmVhdGVJbWFnZTtcclxuSENvbXBFbGVtZW50LnByb3RvdHlwZS5jcmVhdGVDb21wID0gSHlicmlkUmVuZGVyZXIucHJvdG90eXBlLmNyZWF0ZUNvbXA7XHJcbkhDb21wRWxlbWVudC5wcm90b3R5cGUuY3JlYXRlU29saWQgPSBIeWJyaWRSZW5kZXJlci5wcm90b3R5cGUuY3JlYXRlU29saWQ7XHJcbkhDb21wRWxlbWVudC5wcm90b3R5cGUuY3JlYXRlU2hhcGUgPSBIeWJyaWRSZW5kZXJlci5wcm90b3R5cGUuY3JlYXRlU2hhcGU7XHJcbkhDb21wRWxlbWVudC5wcm90b3R5cGUuY3JlYXRlVGV4dCA9IEh5YnJpZFJlbmRlcmVyLnByb3RvdHlwZS5jcmVhdGVUZXh0O1xyXG5IQ29tcEVsZW1lbnQucHJvdG90eXBlLmNyZWF0ZUJhc2UgPSBIeWJyaWRSZW5kZXJlci5wcm90b3R5cGUuY3JlYXRlQmFzZTtcclxuSENvbXBFbGVtZW50LnByb3RvdHlwZS5hcHBlbmRFbGVtZW50SW5Qb3MgPSBIeWJyaWRSZW5kZXJlci5wcm90b3R5cGUuYXBwZW5kRWxlbWVudEluUG9zO1xuZnVuY3Rpb24gSFNoYXBlRWxlbWVudChkYXRhLHBhcmVudENvbnRhaW5lcixnbG9iYWxEYXRhLGNvbXAsIHBsYWNlaG9sZGVyKXtcclxuICAgIHRoaXMuc2hhcGVzID0gW107XHJcbiAgICB0aGlzLnNoYXBlc0RhdGEgPSBkYXRhLnNoYXBlcztcclxuICAgIHRoaXMuc3R5bGVzTGlzdCA9IFtdO1xyXG4gICAgdGhpcy5pdGVtc0RhdGEgPSBbXTtcclxuICAgIHRoaXMucHJldlZpZXdEYXRhID0gW107XHJcbiAgICB0aGlzLnNoYXBlTW9kaWZpZXJzID0gW107XHJcbiAgICB0aGlzLnByb2Nlc3NlZEVsZW1lbnRzID0gW107XHJcbiAgICB0aGlzLl9wYXJlbnQuY29uc3RydWN0b3IuY2FsbCh0aGlzLGRhdGEscGFyZW50Q29udGFpbmVyLGdsb2JhbERhdGEsY29tcCwgcGxhY2Vob2xkZXIpO1xyXG4gICAgdGhpcy5jdXJyZW50QkJveCA9IHtcclxuICAgICAgICB4Ojk5OTk5OSxcclxuICAgICAgICB5OiAtOTk5OTk5LFxyXG4gICAgICAgIGg6IDAsXHJcbiAgICAgICAgdzogMFxyXG4gICAgfTtcclxufVxyXG5jcmVhdGVFbGVtZW50KEhCYXNlRWxlbWVudCwgSFNoYXBlRWxlbWVudCk7XHJcbnZhciBwYXJlbnQgPSBIU2hhcGVFbGVtZW50LnByb3RvdHlwZS5fcGFyZW50O1xyXG5leHRlbmRQcm90b3R5cGUoSVNoYXBlRWxlbWVudCwgSFNoYXBlRWxlbWVudCk7XHJcbkhTaGFwZUVsZW1lbnQucHJvdG90eXBlLl9wYXJlbnQgPSBwYXJlbnQ7XHJcbkhTaGFwZUVsZW1lbnQucHJvdG90eXBlLl9yZW5kZXJTaGFwZUZyYW1lID0gSFNoYXBlRWxlbWVudC5wcm90b3R5cGUucmVuZGVyRnJhbWU7XHJcblxyXG5IU2hhcGVFbGVtZW50LnByb3RvdHlwZS5jcmVhdGVFbGVtZW50cyA9IGZ1bmN0aW9uKCl7XHJcbiAgICB2YXIgcGFyZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICBzdHlsZURpdihwYXJlbnQpO1xyXG4gICAgdmFyIGNvbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoc3ZnTlMsJ3N2ZycpO1xyXG4gICAgc3R5bGVEaXYoY29udCk7XHJcbiAgICB2YXIgc2l6ZSA9IHRoaXMuY29tcC5kYXRhID8gdGhpcy5jb21wLmRhdGEgOiB0aGlzLmdsb2JhbERhdGEuY29tcFNpemU7XHJcbiAgICBjb250LnNldEF0dHJpYnV0ZSgnd2lkdGgnLHNpemUudyk7XHJcbiAgICBjb250LnNldEF0dHJpYnV0ZSgnaGVpZ2h0JyxzaXplLmgpO1xyXG4gICAgaWYodGhpcy5kYXRhLmhhc01hc2spe1xyXG4gICAgICAgIHZhciBnID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKHN2Z05TLCdnJyk7XHJcbiAgICAgICAgcGFyZW50LmFwcGVuZENoaWxkKGNvbnQpO1xyXG4gICAgICAgIGNvbnQuYXBwZW5kQ2hpbGQoZyk7XHJcbiAgICAgICAgdGhpcy5tYXNrZWRFbGVtZW50ID0gZztcclxuICAgICAgICB0aGlzLmxheWVyRWxlbWVudCA9IGc7XHJcbiAgICAgICAgdGhpcy5zaGFwZXNDb250YWluZXIgPSBnO1xyXG4gICAgfWVsc2V7XHJcbiAgICAgICAgcGFyZW50LmFwcGVuZENoaWxkKGNvbnQpO1xyXG4gICAgICAgIHRoaXMubGF5ZXJFbGVtZW50ID0gY29udDtcclxuICAgICAgICB0aGlzLnNoYXBlc0NvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhzdmdOUywnZycpO1xyXG4gICAgICAgIHRoaXMubGF5ZXJFbGVtZW50LmFwcGVuZENoaWxkKHRoaXMuc2hhcGVzQ29udGFpbmVyKTtcclxuICAgIH1cclxuICAgIGlmKCF0aGlzLmRhdGEuaGQpe1xyXG4gICAgICAgIC8vdGhpcy5wYXJlbnRDb250YWluZXIuYXBwZW5kQ2hpbGQocGFyZW50KTtcclxuICAgICAgICB0aGlzLmJhc2VFbGVtZW50ID0gcGFyZW50O1xyXG4gICAgfVxyXG4gICAgdGhpcy5pbm5lckVsZW0gPSBwYXJlbnQ7XHJcbiAgICBpZih0aGlzLmRhdGEubG4pe1xyXG4gICAgICAgIHRoaXMuaW5uZXJFbGVtLnNldEF0dHJpYnV0ZSgnaWQnLHRoaXMuZGF0YS5sbik7XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5zZWFyY2hTaGFwZXModGhpcy5zaGFwZXNEYXRhLHRoaXMuaXRlbXNEYXRhLHRoaXMucHJldlZpZXdEYXRhLHRoaXMubGF5ZXJFbGVtZW50LHRoaXMuZHluYW1pY1Byb3BlcnRpZXMsMCwgW10sIHRydWUpO1xyXG4gICAgdGhpcy5idWlsZEV4cHJlc3Npb25JbnRlcmZhY2UoKTtcclxuICAgIHRoaXMubGF5ZXJFbGVtZW50ID0gcGFyZW50O1xyXG4gICAgdGhpcy50cmFuc2Zvcm1lZEVsZW1lbnQgPSBwYXJlbnQ7XHJcbiAgICB0aGlzLnNoYXBlQ29udCA9IGNvbnQ7XHJcbiAgICBpZih0aGlzLmRhdGEuYm0gIT09IDApe1xyXG4gICAgICAgIHRoaXMuc2V0QmxlbmRNb2RlKCk7XHJcbiAgICB9XHJcbiAgICB0aGlzLmNoZWNrUGFyZW50aW5nKCk7XHJcbn07XHJcblxyXG5IU2hhcGVFbGVtZW50LnByb3RvdHlwZS5yZW5kZXJGcmFtZSA9IGZ1bmN0aW9uKHBhcmVudE1hdHJpeCl7XHJcbiAgICB2YXIgZmlyc3RGcmFtZSA9IHRoaXMuZmlyc3RGcmFtZTtcclxuICAgIHRoaXMuX3JlbmRlclNoYXBlRnJhbWUoKTtcclxuXHJcbiAgICBpZih0aGlzLmlzVmlzaWJsZSAmJiAodGhpcy5lbGVtTWRmIHx8IGZpcnN0RnJhbWUpKXtcclxuICAgICAgICB2YXIgYm91bmRpbmdCb3ggPSB0aGlzLnNoYXBlQ29udC5nZXRCQm94KCk7XHJcbiAgICAgICAgdmFyIGNoYW5nZWQgPSBmYWxzZTtcclxuICAgICAgICBpZih0aGlzLmN1cnJlbnRCQm94LncgIT09IGJvdW5kaW5nQm94LndpZHRoKXtcclxuICAgICAgICAgICAgdGhpcy5jdXJyZW50QkJveC53ID0gYm91bmRpbmdCb3gud2lkdGg7XHJcbiAgICAgICAgICAgIHRoaXMuc2hhcGVDb250LnNldEF0dHJpYnV0ZSgnd2lkdGgnLGJvdW5kaW5nQm94LndpZHRoKTtcclxuICAgICAgICAgICAgY2hhbmdlZCA9IHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmKHRoaXMuY3VycmVudEJCb3guaCAhPT0gYm91bmRpbmdCb3guaGVpZ2h0KXtcclxuICAgICAgICAgICAgdGhpcy5jdXJyZW50QkJveC5oID0gYm91bmRpbmdCb3guaGVpZ2h0O1xyXG4gICAgICAgICAgICB0aGlzLnNoYXBlQ29udC5zZXRBdHRyaWJ1dGUoJ2hlaWdodCcsYm91bmRpbmdCb3guaGVpZ2h0KTtcclxuICAgICAgICAgICAgY2hhbmdlZCA9IHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmKGNoYW5nZWQgIHx8IHRoaXMuY3VycmVudEJCb3gueCAhPT0gYm91bmRpbmdCb3gueCAgfHwgdGhpcy5jdXJyZW50QkJveC55ICE9PSBib3VuZGluZ0JveC55KXtcclxuICAgICAgICAgICAgdGhpcy5jdXJyZW50QkJveC53ID0gYm91bmRpbmdCb3gud2lkdGg7XHJcbiAgICAgICAgICAgIHRoaXMuY3VycmVudEJCb3guaCA9IGJvdW5kaW5nQm94LmhlaWdodDtcclxuICAgICAgICAgICAgdGhpcy5jdXJyZW50QkJveC54ID0gYm91bmRpbmdCb3gueDtcclxuICAgICAgICAgICAgdGhpcy5jdXJyZW50QkJveC55ID0gYm91bmRpbmdCb3gueTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuc2hhcGVDb250LnNldEF0dHJpYnV0ZSgndmlld0JveCcsdGhpcy5jdXJyZW50QkJveC54KycgJyt0aGlzLmN1cnJlbnRCQm94LnkrJyAnK3RoaXMuY3VycmVudEJCb3gudysnICcrdGhpcy5jdXJyZW50QkJveC5oKTtcclxuICAgICAgICAgICAgdGhpcy5zaGFwZUNvbnQuc3R5bGUudHJhbnNmb3JtID0gdGhpcy5zaGFwZUNvbnQuc3R5bGUud2Via2l0VHJhbnNmb3JtID0gJ3RyYW5zbGF0ZSgnICsgdGhpcy5jdXJyZW50QkJveC54ICsgJ3B4LCcgKyB0aGlzLmN1cnJlbnRCQm94LnkgKyAncHgpJztcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG59O1xuZnVuY3Rpb24gSFRleHRFbGVtZW50KGRhdGEscGFyZW50Q29udGFpbmVyLGdsb2JhbERhdGEsY29tcCwgcGxhY2Vob2xkZXIpe1xyXG4gICAgdGhpcy50ZXh0U3BhbnMgPSBbXTtcclxuICAgIHRoaXMudGV4dFBhdGhzID0gW107XHJcbiAgICB0aGlzLmN1cnJlbnRCQm94ID0ge1xyXG4gICAgICAgIHg6OTk5OTk5LFxyXG4gICAgICAgIHk6IC05OTk5OTksXHJcbiAgICAgICAgaDogMCxcclxuICAgICAgICB3OiAwXHJcbiAgICB9XHJcbiAgICB0aGlzLnJlbmRlclR5cGUgPSAnc3ZnJztcclxuICAgIHRoaXMuaXNNYXNrZWQgPSBmYWxzZTtcclxuICAgIHRoaXMuX3BhcmVudC5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsZGF0YSxwYXJlbnRDb250YWluZXIsZ2xvYmFsRGF0YSxjb21wLCBwbGFjZWhvbGRlcik7XHJcblxyXG59XHJcbmNyZWF0ZUVsZW1lbnQoSEJhc2VFbGVtZW50LCBIVGV4dEVsZW1lbnQpO1xyXG5cclxuSFRleHRFbGVtZW50LnByb3RvdHlwZS5pbml0ID0gSVRleHRFbGVtZW50LnByb3RvdHlwZS5pbml0O1xyXG5IVGV4dEVsZW1lbnQucHJvdG90eXBlLmdldE1lYXN1cmVzID0gSVRleHRFbGVtZW50LnByb3RvdHlwZS5nZXRNZWFzdXJlcztcclxuSFRleHRFbGVtZW50LnByb3RvdHlwZS5jcmVhdGVQYXRoU2hhcGUgPSBJVGV4dEVsZW1lbnQucHJvdG90eXBlLmNyZWF0ZVBhdGhTaGFwZTtcclxuSFRleHRFbGVtZW50LnByb3RvdHlwZS5wcmVwYXJlRnJhbWUgPSBJVGV4dEVsZW1lbnQucHJvdG90eXBlLnByZXBhcmVGcmFtZTtcclxuSFRleHRFbGVtZW50LnByb3RvdHlwZS5idWlsZFNoYXBlU3RyaW5nID0gSVRleHRFbGVtZW50LnByb3RvdHlwZS5idWlsZFNoYXBlU3RyaW5nO1xyXG5cclxuSFRleHRFbGVtZW50LnByb3RvdHlwZS5jcmVhdGVFbGVtZW50cyA9IGZ1bmN0aW9uKCl7XHJcbiAgICB0aGlzLmlzTWFza2VkID0gdGhpcy5jaGVja01hc2tzKCk7XHJcbiAgICB2YXIgcGFyZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICBzdHlsZURpdihwYXJlbnQpO1xyXG4gICAgdGhpcy5sYXllckVsZW1lbnQgPSBwYXJlbnQ7XHJcbiAgICB0aGlzLnRyYW5zZm9ybWVkRWxlbWVudCA9IHBhcmVudDtcclxuICAgIGlmKHRoaXMuaXNNYXNrZWQpe1xyXG4gICAgICAgIHRoaXMucmVuZGVyVHlwZSA9ICdzdmcnO1xyXG4gICAgICAgIHZhciBjb250ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKHN2Z05TLCdzdmcnKTtcclxuICAgICAgICBzdHlsZURpdihjb250KTtcclxuICAgICAgICB0aGlzLmNvbnQgPSBjb250O1xyXG4gICAgICAgIHRoaXMuY29tcFcgPSB0aGlzLmNvbXAuZGF0YS53O1xyXG4gICAgICAgIHRoaXMuY29tcEggPSB0aGlzLmNvbXAuZGF0YS5oO1xyXG4gICAgICAgIGNvbnQuc2V0QXR0cmlidXRlKCd3aWR0aCcsdGhpcy5jb21wVyk7XHJcbiAgICAgICAgY29udC5zZXRBdHRyaWJ1dGUoJ2hlaWdodCcsdGhpcy5jb21wSCk7XHJcbiAgICAgICAgdmFyIGcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoc3ZnTlMsJ2cnKTtcclxuICAgICAgICBjb250LmFwcGVuZENoaWxkKGcpO1xyXG4gICAgICAgIHBhcmVudC5hcHBlbmRDaGlsZChjb250KTtcclxuICAgICAgICB0aGlzLm1hc2tlZEVsZW1lbnQgPSBnO1xyXG4gICAgICAgIHRoaXMuaW5uZXJFbGVtID0gZztcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdGhpcy5yZW5kZXJUeXBlID0gJ2h0bWwnO1xyXG4gICAgICAgIHRoaXMuaW5uZXJFbGVtID0gcGFyZW50O1xyXG4gICAgfVxyXG4gICAgdGhpcy5iYXNlRWxlbWVudCA9IHBhcmVudDtcclxuXHJcbiAgICB0aGlzLmNoZWNrUGFyZW50aW5nKCk7XHJcblxyXG59O1xyXG5cclxuSFRleHRFbGVtZW50LnByb3RvdHlwZS5idWlsZE5ld1RleHQgPSBmdW5jdGlvbigpe1xyXG4gICAgdmFyIGRvY3VtZW50RGF0YSA9IHRoaXMuY3VycmVudFRleHREb2N1bWVudERhdGE7XHJcbiAgICB0aGlzLnJlbmRlcmVkTGV0dGVycyA9IEFycmF5LmFwcGx5KG51bGwse2xlbmd0aDp0aGlzLmN1cnJlbnRUZXh0RG9jdW1lbnREYXRhLmwgPyB0aGlzLmN1cnJlbnRUZXh0RG9jdW1lbnREYXRhLmwubGVuZ3RoIDogMH0pO1xyXG4gICAgaWYoZG9jdW1lbnREYXRhLmZjKSB7XHJcbiAgICAgICAgdGhpcy5pbm5lckVsZW0uc3R5bGUuY29sb3IgPSB0aGlzLmlubmVyRWxlbS5zdHlsZS5maWxsID0gJ3JnYignICsgTWF0aC5yb3VuZChkb2N1bWVudERhdGEuZmNbMF0qMjU1KSArICcsJyArIE1hdGgucm91bmQoZG9jdW1lbnREYXRhLmZjWzFdKjI1NSkgKyAnLCcgKyBNYXRoLnJvdW5kKGRvY3VtZW50RGF0YS5mY1syXSoyNTUpICsgJyknO1xyXG4gICAgICAgIC8vLy90aGlzLmlubmVyRWxlbS5zZXRBdHRyaWJ1dGUoJ2ZpbGwnLCAncmdiKCcgKyBkb2N1bWVudERhdGEuZmNbMF0gKyAnLCcgKyBkb2N1bWVudERhdGEuZmNbMV0gKyAnLCcgKyBkb2N1bWVudERhdGEuZmNbMl0gKyAnKScpO1xyXG4gICAgfWVsc2V7XHJcbiAgICAgICAgdGhpcy5pbm5lckVsZW0uc3R5bGUuY29sb3IgPSB0aGlzLmlubmVyRWxlbS5zdHlsZS5maWxsID0gJ3JnYmEoMCwwLDAsMCknO1xyXG4gICAgICAgIC8vLy90aGlzLmlubmVyRWxlbS5zZXRBdHRyaWJ1dGUoJ2ZpbGwnLCAncmdiYSgwLDAsMCwwKScpO1xyXG4gICAgfVxyXG4gICAgaWYoZG9jdW1lbnREYXRhLnNjKXtcclxuICAgICAgICAvLy8vdGhpcy5pbm5lckVsZW0uc2V0QXR0cmlidXRlKCdzdHJva2UnLCAncmdiKCcgKyBkb2N1bWVudERhdGEuc2NbMF0gKyAnLCcgKyBkb2N1bWVudERhdGEuc2NbMV0gKyAnLCcgKyBkb2N1bWVudERhdGEuc2NbMl0gKyAnKScpO1xyXG4gICAgICAgIHRoaXMuaW5uZXJFbGVtLnN0eWxlLnN0cm9rZSA9ICdyZ2IoJyArIE1hdGgucm91bmQoZG9jdW1lbnREYXRhLnNjWzBdKjI1NSkgKyAnLCcgKyBNYXRoLnJvdW5kKGRvY3VtZW50RGF0YS5zY1sxXSoyNTUpICsgJywnICsgTWF0aC5yb3VuZChkb2N1bWVudERhdGEuc2NbMl0qMjU1KSArICcpJztcclxuICAgICAgICAvLy8vdGhpcy5pbm5lckVsZW0uc2V0QXR0cmlidXRlKCdzdHJva2Utd2lkdGgnLCBkb2N1bWVudERhdGEuc3cpO1xyXG4gICAgICAgIHRoaXMuaW5uZXJFbGVtLnN0eWxlLnN0cm9rZVdpZHRoID0gZG9jdW1lbnREYXRhLnN3KydweCc7XHJcbiAgICB9XHJcbiAgICAvLy8vdGhpcy5pbm5lckVsZW0uc2V0QXR0cmlidXRlKCdmb250LXNpemUnLCBkb2N1bWVudERhdGEucyk7XHJcbiAgICB2YXIgZm9udERhdGEgPSB0aGlzLmdsb2JhbERhdGEuZm9udE1hbmFnZXIuZ2V0Rm9udEJ5TmFtZShkb2N1bWVudERhdGEuZik7XHJcbiAgICBpZighdGhpcy5nbG9iYWxEYXRhLmZvbnRNYW5hZ2VyLmNoYXJzKXtcclxuICAgICAgICB0aGlzLmlubmVyRWxlbS5zdHlsZS5mb250U2l6ZSA9IGRvY3VtZW50RGF0YS5zKydweCc7XHJcbiAgICAgICAgdGhpcy5pbm5lckVsZW0uc3R5bGUubGluZUhlaWdodCA9IGRvY3VtZW50RGF0YS5zKydweCc7XHJcbiAgICAgICAgaWYoZm9udERhdGEuZkNsYXNzKXtcclxuICAgICAgICAgICAgdGhpcy5pbm5lckVsZW0uY2xhc3NOYW1lID0gZm9udERhdGEuZkNsYXNzO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIC8vLy90aGlzLmlubmVyRWxlbS5zZXRBdHRyaWJ1dGUoJ2ZvbnQtZmFtaWx5JywgZm9udERhdGEuZkZhbWlseSk7XHJcbiAgICAgICAgICAgIHRoaXMuaW5uZXJFbGVtLnN0eWxlLmZvbnRGYW1pbHkgPSBmb250RGF0YS5mRmFtaWx5O1xyXG4gICAgICAgICAgICB2YXIgZldlaWdodCA9IGRvY3VtZW50RGF0YS5mV2VpZ2h0LCBmU3R5bGUgPSBkb2N1bWVudERhdGEuZlN0eWxlO1xyXG4gICAgICAgICAgICAvLy8vdGhpcy5pbm5lckVsZW0uc2V0QXR0cmlidXRlKCdmb250LXN0eWxlJywgZlN0eWxlKTtcclxuICAgICAgICAgICAgdGhpcy5pbm5lckVsZW0uc3R5bGUuZm9udFN0eWxlID0gZlN0eWxlO1xyXG4gICAgICAgICAgICAvLy8vdGhpcy5pbm5lckVsZW0uc2V0QXR0cmlidXRlKCdmb250LXdlaWdodCcsIGZXZWlnaHQpO1xyXG4gICAgICAgICAgICB0aGlzLmlubmVyRWxlbS5zdHlsZS5mb250V2VpZ2h0ID0gZldlaWdodDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICB2YXIgaSwgbGVuO1xyXG5cclxuICAgIHZhciBsZXR0ZXJzID0gZG9jdW1lbnREYXRhLmw7XHJcbiAgICBsZW4gPSBsZXR0ZXJzLmxlbmd0aDtcclxuICAgIHZhciB0U3Bhbix0UGFyZW50LHRDb250O1xyXG4gICAgdmFyIG1hdHJpeEhlbHBlciA9IHRoaXMubUhlbHBlcjtcclxuICAgIHZhciBzaGFwZXMsIHNoYXBlU3RyID0gJyc7XHJcbiAgICB2YXIgY250ID0gMDtcclxuICAgIGZvciAoaSA9IDA7aSA8IGxlbiA7aSArPSAxKSB7XHJcbiAgICAgICAgaWYodGhpcy5nbG9iYWxEYXRhLmZvbnRNYW5hZ2VyLmNoYXJzKXtcclxuICAgICAgICAgICAgaWYoIXRoaXMudGV4dFBhdGhzW2NudF0pe1xyXG4gICAgICAgICAgICAgICAgdFNwYW4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoc3ZnTlMsJ3BhdGgnKTtcclxuICAgICAgICAgICAgICAgIHRTcGFuLnNldEF0dHJpYnV0ZSgnc3Ryb2tlLWxpbmVjYXAnLCAnYnV0dCcpO1xyXG4gICAgICAgICAgICAgICAgdFNwYW4uc2V0QXR0cmlidXRlKCdzdHJva2UtbGluZWpvaW4nLCdyb3VuZCcpO1xyXG4gICAgICAgICAgICAgICAgdFNwYW4uc2V0QXR0cmlidXRlKCdzdHJva2UtbWl0ZXJsaW1pdCcsJzQnKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRTcGFuID0gdGhpcy50ZXh0UGF0aHNbY250XTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZighdGhpcy5pc01hc2tlZCl7XHJcbiAgICAgICAgICAgICAgICBpZih0aGlzLnRleHRTcGFuc1tjbnRdKXtcclxuICAgICAgICAgICAgICAgICAgICB0UGFyZW50ID0gdGhpcy50ZXh0U3BhbnNbY250XTtcclxuICAgICAgICAgICAgICAgICAgICB0Q29udCA9IHRQYXJlbnQuY2hpbGRyZW5bMF07XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB0UGFyZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICAgICAgICAgICAgICAgICAgdENvbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoc3ZnTlMsJ3N2ZycpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRDb250LmFwcGVuZENoaWxkKHRTcGFuKTtcclxuICAgICAgICAgICAgICAgICAgICBzdHlsZURpdih0UGFyZW50KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICBpZighdGhpcy5pc01hc2tlZCl7XHJcbiAgICAgICAgICAgICAgICBpZih0aGlzLnRleHRTcGFuc1tjbnRdKXtcclxuICAgICAgICAgICAgICAgICAgICB0UGFyZW50ID0gdGhpcy50ZXh0U3BhbnNbY250XTtcclxuICAgICAgICAgICAgICAgICAgICB0U3BhbiA9IHRoaXMudGV4dFBhdGhzW2NudF07XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHRQYXJlbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgc3R5bGVEaXYodFBhcmVudCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdFNwYW4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgc3R5bGVEaXYodFNwYW4pO1xyXG4gICAgICAgICAgICAgICAgICAgIHRQYXJlbnQuYXBwZW5kQ2hpbGQodFNwYW4pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdFNwYW4gPSB0aGlzLnRleHRQYXRoc1tjbnRdID8gdGhpcy50ZXh0UGF0aHNbY250XSA6IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhzdmdOUywndGV4dCcpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vdFNwYW4uc2V0QXR0cmlidXRlKCd2aXNpYmlsaXR5JywgJ2hpZGRlbicpO1xyXG4gICAgICAgIGlmKHRoaXMuZ2xvYmFsRGF0YS5mb250TWFuYWdlci5jaGFycyl7XHJcbiAgICAgICAgICAgIHZhciBjaGFyRGF0YSA9IHRoaXMuZ2xvYmFsRGF0YS5mb250TWFuYWdlci5nZXRDaGFyRGF0YShkb2N1bWVudERhdGEudC5jaGFyQXQoaSksIGZvbnREYXRhLmZTdHlsZSwgdGhpcy5nbG9iYWxEYXRhLmZvbnRNYW5hZ2VyLmdldEZvbnRCeU5hbWUoZG9jdW1lbnREYXRhLmYpLmZGYW1pbHkpO1xyXG4gICAgICAgICAgICB2YXIgc2hhcGVEYXRhO1xyXG4gICAgICAgICAgICBpZihjaGFyRGF0YSl7XHJcbiAgICAgICAgICAgICAgICBzaGFwZURhdGEgPSBjaGFyRGF0YS5kYXRhO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgc2hhcGVEYXRhID0gbnVsbDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBtYXRyaXhIZWxwZXIucmVzZXQoKTtcclxuICAgICAgICAgICAgaWYoc2hhcGVEYXRhICYmIHNoYXBlRGF0YS5zaGFwZXMpe1xyXG4gICAgICAgICAgICAgICAgc2hhcGVzID0gc2hhcGVEYXRhLnNoYXBlc1swXS5pdDtcclxuICAgICAgICAgICAgICAgIG1hdHJpeEhlbHBlci5zY2FsZShkb2N1bWVudERhdGEucy8xMDAsZG9jdW1lbnREYXRhLnMvMTAwKTtcclxuICAgICAgICAgICAgICAgIHNoYXBlU3RyID0gdGhpcy5jcmVhdGVQYXRoU2hhcGUobWF0cml4SGVscGVyLHNoYXBlcyk7XHJcbiAgICAgICAgICAgICAgICB0U3Bhbi5zZXRBdHRyaWJ1dGUoJ2QnLHNoYXBlU3RyKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZighdGhpcy5pc01hc2tlZCl7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmlubmVyRWxlbS5hcHBlbmRDaGlsZCh0UGFyZW50KTtcclxuICAgICAgICAgICAgICAgIGlmKHNoYXBlRGF0YSAmJiBzaGFwZURhdGEuc2hhcGVzKXtcclxuICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHRDb250KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGJvdW5kaW5nQm94ID0gdENvbnQuZ2V0QkJveCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRDb250LnNldEF0dHJpYnV0ZSgnd2lkdGgnLGJvdW5kaW5nQm94LndpZHRoKTtcclxuICAgICAgICAgICAgICAgICAgICB0Q29udC5zZXRBdHRyaWJ1dGUoJ2hlaWdodCcsYm91bmRpbmdCb3guaGVpZ2h0KTtcclxuICAgICAgICAgICAgICAgICAgICB0Q29udC5zZXRBdHRyaWJ1dGUoJ3ZpZXdCb3gnLGJvdW5kaW5nQm94LngrJyAnKyBib3VuZGluZ0JveC55KycgJysgYm91bmRpbmdCb3gud2lkdGgrJyAnKyBib3VuZGluZ0JveC5oZWlnaHQpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRDb250LnN0eWxlLnRyYW5zZm9ybSA9IHRDb250LnN0eWxlLndlYmtpdFRyYW5zZm9ybSA9ICd0cmFuc2xhdGUoJyArIGJvdW5kaW5nQm94LnggKyAncHgsJyArIGJvdW5kaW5nQm94LnkgKyAncHgpJztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgbGV0dGVyc1tpXS55T2Zmc2V0ID0gYm91bmRpbmdCb3gueTtcclxuICAgICAgICAgICAgICAgICAgICB0UGFyZW50LmFwcGVuZENoaWxkKHRDb250KTtcclxuXHJcbiAgICAgICAgICAgICAgICB9IGVsc2V7XHJcbiAgICAgICAgICAgICAgICAgICAgdENvbnQuc2V0QXR0cmlidXRlKCd3aWR0aCcsMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdENvbnQuc2V0QXR0cmlidXRlKCdoZWlnaHQnLDEpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgIHRoaXMuaW5uZXJFbGVtLmFwcGVuZENoaWxkKHRTcGFuKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICB0U3Bhbi50ZXh0Q29udGVudCA9IGxldHRlcnNbaV0udmFsO1xyXG4gICAgICAgICAgICB0U3Bhbi5zZXRBdHRyaWJ1dGVOUyhcImh0dHA6Ly93d3cudzMub3JnL1hNTC8xOTk4L25hbWVzcGFjZVwiLCBcInhtbDpzcGFjZVwiLFwicHJlc2VydmVcIik7XHJcbiAgICAgICAgICAgIGlmKCF0aGlzLmlzTWFza2VkKXtcclxuICAgICAgICAgICAgICAgIHRoaXMuaW5uZXJFbGVtLmFwcGVuZENoaWxkKHRQYXJlbnQpO1xyXG4gICAgICAgICAgICAgICAgLy9cclxuICAgICAgICAgICAgICAgIHRTcGFuLnN0eWxlLnRyYW5zZm9ybSA9IHRTcGFuLnN0eWxlLndlYmtpdFRyYW5zZm9ybSA9ICd0cmFuc2xhdGUzZCgwLCcrIC1kb2N1bWVudERhdGEucy8xLjIrJ3B4LDApJztcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuaW5uZXJFbGVtLmFwcGVuZENoaWxkKHRTcGFuKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICAvL1xyXG4gICAgICAgIGlmKCF0aGlzLmlzTWFza2VkKXtcclxuICAgICAgICAgICAgdGhpcy50ZXh0U3BhbnNbY250XSA9IHRQYXJlbnQ7XHJcbiAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgIHRoaXMudGV4dFNwYW5zW2NudF0gPSB0U3BhbjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy50ZXh0U3BhbnNbY250XS5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJztcclxuICAgICAgICB0aGlzLnRleHRQYXRoc1tjbnRdID0gdFNwYW47XHJcbiAgICAgICAgY250ICs9IDE7XHJcbiAgICB9XHJcbiAgICB3aGlsZShjbnQgPCB0aGlzLnRleHRTcGFucy5sZW5ndGgpe1xyXG4gICAgICAgIHRoaXMudGV4dFNwYW5zW2NudF0uc3R5bGUuZGlzcGxheSA9ICdub25lJztcclxuICAgICAgICBjbnQgKz0gMTtcclxuICAgIH1cclxufVxyXG5cclxuSFRleHRFbGVtZW50LnByb3RvdHlwZS5oaWRlID0gU1ZHVGV4dEVsZW1lbnQucHJvdG90eXBlLmhpZGU7XHJcblxyXG5IVGV4dEVsZW1lbnQucHJvdG90eXBlLnJlbmRlckZyYW1lID0gZnVuY3Rpb24ocGFyZW50TWF0cml4KXtcclxuXHJcbiAgICB2YXIgcmVuZGVyUGFyZW50ID0gdGhpcy5fcGFyZW50LnJlbmRlckZyYW1lLmNhbGwodGhpcyxwYXJlbnRNYXRyaXgpO1xyXG4gICAgaWYocmVuZGVyUGFyZW50PT09ZmFsc2Upe1xyXG4gICAgICAgIHRoaXMuaGlkZSgpO1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGlmKHRoaXMuaGlkZGVuKXtcclxuICAgICAgICB0aGlzLmhpZGRlbiA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMuaW5uZXJFbGVtLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snO1xyXG4gICAgICAgIHRoaXMubGF5ZXJFbGVtZW50LnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snO1xyXG4gICAgfVxyXG5cclxuICAgIGlmKHRoaXMuZGF0YS5zaW5nbGVTaGFwZSl7XHJcbiAgICAgICAgaWYoIXRoaXMuZmlyc3RGcmFtZSAmJiAhdGhpcy5sZXR0ZXJzQ2hhbmdlZEZsYWcpe1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgLy8gVG9kbyBCZW5jaG1hcmsgaWYgdXNpbmcgdGhpcyBpcyBiZXR0ZXIgdGhhbiBnZXRCQm94XHJcbiAgICAgICAgICAgICBpZih0aGlzLmlzTWFza2VkICYmIHRoaXMuZmluYWxUcmFuc2Zvcm0ubWF0TWRmKXtcclxuICAgICAgICAgICAgICAgICB0aGlzLmNvbnQuc2V0QXR0cmlidXRlKCd2aWV3Qm94JywtdGhpcy5maW5hbFRyYW5zZm9ybS5tUHJvcC5wLnZbMF0rJyAnKyAtdGhpcy5maW5hbFRyYW5zZm9ybS5tUHJvcC5wLnZbMV0rJyAnK3RoaXMuY29tcFcrJyAnK3RoaXMuY29tcEgpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jb250LnN0eWxlLnRyYW5zZm9ybSA9IHRoaXMuY29udC5zdHlsZS53ZWJraXRUcmFuc2Zvcm0gPSAndHJhbnNsYXRlKCcgKyAtdGhpcy5maW5hbFRyYW5zZm9ybS5tUHJvcC5wLnZbMF0gKyAncHgsJyArIC10aGlzLmZpbmFsVHJhbnNmb3JtLm1Qcm9wLnAudlsxXSArICdweCknO1xyXG4gICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICB0aGlzLmdldE1lYXN1cmVzKCk7XHJcbiAgICBpZighdGhpcy5sZXR0ZXJzQ2hhbmdlZEZsYWcpe1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIHZhciAgaSxsZW47XHJcbiAgICB2YXIgcmVuZGVyZWRMZXR0ZXJzID0gdGhpcy5yZW5kZXJlZExldHRlcnM7XHJcblxyXG4gICAgdmFyIGxldHRlcnMgPSB0aGlzLmN1cnJlbnRUZXh0RG9jdW1lbnREYXRhLmw7XHJcblxyXG4gICAgbGVuID0gbGV0dGVycy5sZW5ndGg7XHJcbiAgICB2YXIgcmVuZGVyZWRMZXR0ZXI7XHJcbiAgICBmb3IoaT0wO2k8bGVuO2krPTEpe1xyXG4gICAgICAgIGlmKGxldHRlcnNbaV0ubil7XHJcbiAgICAgICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZW5kZXJlZExldHRlciA9IHJlbmRlcmVkTGV0dGVyc1tpXTtcclxuICAgICAgICBpZighdGhpcy5pc01hc2tlZCl7XHJcbiAgICAgICAgICAgIHRoaXMudGV4dFNwYW5zW2ldLnN0eWxlLnRyYW5zZm9ybSA9IHRoaXMudGV4dFNwYW5zW2ldLnN0eWxlLndlYmtpdFRyYW5zZm9ybSA9IHJlbmRlcmVkTGV0dGVyLm07XHJcbiAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgIHRoaXMudGV4dFNwYW5zW2ldLnNldEF0dHJpYnV0ZSgndHJhbnNmb3JtJyxyZW5kZXJlZExldHRlci5tKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8vL3RoaXMudGV4dFNwYW5zW2ldLnNldEF0dHJpYnV0ZSgnb3BhY2l0eScscmVuZGVyZWRMZXR0ZXIubyk7XHJcbiAgICAgICAgdGhpcy50ZXh0U3BhbnNbaV0uc3R5bGUub3BhY2l0eSA9IHJlbmRlcmVkTGV0dGVyLm87XHJcbiAgICAgICAgaWYocmVuZGVyZWRMZXR0ZXIuc3cpe1xyXG4gICAgICAgICAgICB0aGlzLnRleHRQYXRoc1tpXS5zZXRBdHRyaWJ1dGUoJ3N0cm9rZS13aWR0aCcscmVuZGVyZWRMZXR0ZXIuc3cpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZihyZW5kZXJlZExldHRlci5zYyl7XHJcbiAgICAgICAgICAgIHRoaXMudGV4dFBhdGhzW2ldLnNldEF0dHJpYnV0ZSgnc3Ryb2tlJyxyZW5kZXJlZExldHRlci5zYyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmKHJlbmRlcmVkTGV0dGVyLmZjKXtcclxuICAgICAgICAgICAgdGhpcy50ZXh0UGF0aHNbaV0uc2V0QXR0cmlidXRlKCdmaWxsJyxyZW5kZXJlZExldHRlci5mYyk7XHJcbiAgICAgICAgICAgIHRoaXMudGV4dFBhdGhzW2ldLnN0eWxlLmNvbG9yID0gcmVuZGVyZWRMZXR0ZXIuZmM7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgaWYodGhpcy5pc1Zpc2libGUgJiYgKHRoaXMuZWxlbU1kZiB8fCB0aGlzLmZpcnN0RnJhbWUpKXtcclxuICAgICAgICBpZih0aGlzLmlubmVyRWxlbS5nZXRCQm94KXtcclxuICAgICAgICAgICAgdmFyIGJvdW5kaW5nQm94ID0gdGhpcy5pbm5lckVsZW0uZ2V0QkJveCgpO1xyXG5cclxuICAgICAgICAgICAgaWYodGhpcy5jdXJyZW50QkJveC53ICE9PSBib3VuZGluZ0JveC53aWR0aCl7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRCQm94LncgPSBib3VuZGluZ0JveC53aWR0aDtcclxuICAgICAgICAgICAgICAgIHRoaXMuY29udC5zZXRBdHRyaWJ1dGUoJ3dpZHRoJyxib3VuZGluZ0JveC53aWR0aCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYodGhpcy5jdXJyZW50QkJveC5oICE9PSBib3VuZGluZ0JveC5oZWlnaHQpe1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50QkJveC5oID0gYm91bmRpbmdCb3guaGVpZ2h0O1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jb250LnNldEF0dHJpYnV0ZSgnaGVpZ2h0Jyxib3VuZGluZ0JveC5oZWlnaHQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmKHRoaXMuY3VycmVudEJCb3gudyAhPT0gYm91bmRpbmdCb3gud2lkdGggfHwgdGhpcy5jdXJyZW50QkJveC5oICE9PSBib3VuZGluZ0JveC5oZWlnaHQgIHx8IHRoaXMuY3VycmVudEJCb3gueCAhPT0gYm91bmRpbmdCb3gueCAgfHwgdGhpcy5jdXJyZW50QkJveC55ICE9PSBib3VuZGluZ0JveC55KXtcclxuICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudEJCb3gudyA9IGJvdW5kaW5nQm94LndpZHRoO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50QkJveC5oID0gYm91bmRpbmdCb3guaGVpZ2h0O1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50QkJveC54ID0gYm91bmRpbmdCb3gueDtcclxuICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudEJCb3gueSA9IGJvdW5kaW5nQm94Lnk7XHJcblxyXG4gICAgICAgICAgICAgICAgdGhpcy5jb250LnNldEF0dHJpYnV0ZSgndmlld0JveCcsdGhpcy5jdXJyZW50QkJveC54KycgJyt0aGlzLmN1cnJlbnRCQm94LnkrJyAnK3RoaXMuY3VycmVudEJCb3gudysnICcrdGhpcy5jdXJyZW50QkJveC5oKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuY29udC5zdHlsZS50cmFuc2Zvcm0gPSB0aGlzLmNvbnQuc3R5bGUud2Via2l0VHJhbnNmb3JtID0gJ3RyYW5zbGF0ZSgnICsgdGhpcy5jdXJyZW50QkJveC54ICsgJ3B4LCcgKyB0aGlzLmN1cnJlbnRCQm94LnkgKyAncHgpJztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGlmKHRoaXMuZmlyc3RGcmFtZSl7XHJcbiAgICAgICAgdGhpcy5maXJzdEZyYW1lID0gZmFsc2U7XHJcbiAgICB9XHJcbn1cclxuXHJcblxyXG5IVGV4dEVsZW1lbnQucHJvdG90eXBlLmRlc3Ryb3kgPSBTVkdUZXh0RWxlbWVudC5wcm90b3R5cGUuZGVzdHJveTtcbmZ1bmN0aW9uIEhJbWFnZUVsZW1lbnQoZGF0YSxwYXJlbnRDb250YWluZXIsZ2xvYmFsRGF0YSxjb21wLCBwbGFjZWhvbGRlcil7XHJcbiAgICB0aGlzLmFzc2V0RGF0YSA9IGdsb2JhbERhdGEuZ2V0QXNzZXREYXRhKGRhdGEucmVmSWQpO1xyXG4gICAgdGhpcy5fcGFyZW50LmNvbnN0cnVjdG9yLmNhbGwodGhpcyxkYXRhLHBhcmVudENvbnRhaW5lcixnbG9iYWxEYXRhLGNvbXAsIHBsYWNlaG9sZGVyKTtcclxufVxyXG5jcmVhdGVFbGVtZW50KEhCYXNlRWxlbWVudCwgSEltYWdlRWxlbWVudCk7XHJcblxyXG5ISW1hZ2VFbGVtZW50LnByb3RvdHlwZS5jcmVhdGVFbGVtZW50cyA9IGZ1bmN0aW9uKCl7XHJcblxyXG4gICAgdmFyIGFzc2V0UGF0aCA9IHRoaXMuZ2xvYmFsRGF0YS5nZXRBc3NldHNQYXRoKHRoaXMuYXNzZXREYXRhKTtcclxuICAgIHZhciBpbWcgPSBuZXcgSW1hZ2UoKTtcclxuXHJcbiAgICBpZih0aGlzLmRhdGEuaGFzTWFzayl7XHJcbiAgICAgICAgdmFyIHBhcmVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICAgIHN0eWxlRGl2KHBhcmVudCk7XHJcbiAgICAgICAgdmFyIGNvbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoc3ZnTlMsJ3N2ZycpO1xyXG4gICAgICAgIHN0eWxlRGl2KGNvbnQpO1xyXG4gICAgICAgIGNvbnQuc2V0QXR0cmlidXRlKCd3aWR0aCcsdGhpcy5hc3NldERhdGEudyk7XHJcbiAgICAgICAgY29udC5zZXRBdHRyaWJ1dGUoJ2hlaWdodCcsdGhpcy5hc3NldERhdGEuaCk7XHJcbiAgICAgICAgcGFyZW50LmFwcGVuZENoaWxkKGNvbnQpO1xyXG4gICAgICAgIHRoaXMuaW1hZ2VFbGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKHN2Z05TLCdpbWFnZScpO1xyXG4gICAgICAgIHRoaXMuaW1hZ2VFbGVtLnNldEF0dHJpYnV0ZSgnd2lkdGgnLHRoaXMuYXNzZXREYXRhLncrXCJweFwiKTtcclxuICAgICAgICB0aGlzLmltYWdlRWxlbS5zZXRBdHRyaWJ1dGUoJ2hlaWdodCcsdGhpcy5hc3NldERhdGEuaCtcInB4XCIpO1xyXG4gICAgICAgIHRoaXMuaW1hZ2VFbGVtLnNldEF0dHJpYnV0ZU5TKCdodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rJywnaHJlZicsYXNzZXRQYXRoKTtcclxuICAgICAgICBjb250LmFwcGVuZENoaWxkKHRoaXMuaW1hZ2VFbGVtKTtcclxuICAgICAgICB0aGlzLmxheWVyRWxlbWVudCA9IHBhcmVudDtcclxuICAgICAgICB0aGlzLnRyYW5zZm9ybWVkRWxlbWVudCA9IHBhcmVudDtcclxuICAgICAgICB0aGlzLmJhc2VFbGVtZW50ID0gcGFyZW50O1xyXG4gICAgICAgIHRoaXMuaW5uZXJFbGVtID0gcGFyZW50O1xyXG4gICAgICAgIHRoaXMubWFza2VkRWxlbWVudCA9IHRoaXMuaW1hZ2VFbGVtO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICBzdHlsZURpdihpbWcpO1xyXG4gICAgICAgIHRoaXMubGF5ZXJFbGVtZW50ID0gaW1nO1xyXG4gICAgICAgIHRoaXMuYmFzZUVsZW1lbnQgPSBpbWc7XHJcbiAgICAgICAgdGhpcy5pbm5lckVsZW0gPSBpbWc7XHJcbiAgICAgICAgdGhpcy50cmFuc2Zvcm1lZEVsZW1lbnQgPSBpbWc7XHJcbiAgICB9XHJcbiAgICBpbWcuc3JjID0gYXNzZXRQYXRoO1xyXG4gICAgaWYodGhpcy5kYXRhLmxuKXtcclxuICAgICAgICB0aGlzLmlubmVyRWxlbS5zZXRBdHRyaWJ1dGUoJ2lkJyx0aGlzLmRhdGEubG4pO1xyXG4gICAgfVxyXG4gICAgdGhpcy5jaGVja1BhcmVudGluZygpO1xyXG59O1xyXG5cclxuSEltYWdlRWxlbWVudC5wcm90b3R5cGUuaGlkZSA9IEhTb2xpZEVsZW1lbnQucHJvdG90eXBlLmhpZGU7XHJcbkhJbWFnZUVsZW1lbnQucHJvdG90eXBlLnJlbmRlckZyYW1lID0gSFNvbGlkRWxlbWVudC5wcm90b3R5cGUucmVuZGVyRnJhbWU7XHJcbkhJbWFnZUVsZW1lbnQucHJvdG90eXBlLmRlc3Ryb3kgPSBIU29saWRFbGVtZW50LnByb3RvdHlwZS5kZXN0cm95O1xuZnVuY3Rpb24gSENhbWVyYUVsZW1lbnQoZGF0YSxwYXJlbnRDb250YWluZXIsZ2xvYmFsRGF0YSxjb21wLCBwbGFjZWhvbGRlcil7XHJcbiAgICB0aGlzLl9wYXJlbnQuY29uc3RydWN0b3IuY2FsbCh0aGlzLGRhdGEscGFyZW50Q29udGFpbmVyLGdsb2JhbERhdGEsY29tcCwgcGxhY2Vob2xkZXIpO1xyXG4gICAgdGhpcy5wZSA9IFByb3BlcnR5RmFjdG9yeS5nZXRQcm9wKHRoaXMsZGF0YS5wZSwwLDAsdGhpcy5keW5hbWljUHJvcGVydGllcyk7XHJcbiAgICBpZihkYXRhLmtzLnAucyl7XHJcbiAgICAgICAgdGhpcy5weCA9IFByb3BlcnR5RmFjdG9yeS5nZXRQcm9wKHRoaXMsZGF0YS5rcy5wLngsMSwwLHRoaXMuZHluYW1pY1Byb3BlcnRpZXMpO1xyXG4gICAgICAgIHRoaXMucHkgPSBQcm9wZXJ0eUZhY3RvcnkuZ2V0UHJvcCh0aGlzLGRhdGEua3MucC55LDEsMCx0aGlzLmR5bmFtaWNQcm9wZXJ0aWVzKTtcclxuICAgICAgICB0aGlzLnB6ID0gUHJvcGVydHlGYWN0b3J5LmdldFByb3AodGhpcyxkYXRhLmtzLnAueiwxLDAsdGhpcy5keW5hbWljUHJvcGVydGllcyk7XHJcbiAgICB9ZWxzZXtcclxuICAgICAgICB0aGlzLnAgPSBQcm9wZXJ0eUZhY3RvcnkuZ2V0UHJvcCh0aGlzLGRhdGEua3MucCwxLDAsdGhpcy5keW5hbWljUHJvcGVydGllcyk7XHJcbiAgICB9XHJcbiAgICBpZihkYXRhLmtzLmEpe1xyXG4gICAgICAgIHRoaXMuYSA9IFByb3BlcnR5RmFjdG9yeS5nZXRQcm9wKHRoaXMsZGF0YS5rcy5hLDEsMCx0aGlzLmR5bmFtaWNQcm9wZXJ0aWVzKTtcclxuICAgIH1cclxuICAgIGlmKGRhdGEua3Mub3Iuay5sZW5ndGggJiYgZGF0YS5rcy5vci5rWzBdLnRvKXtcclxuICAgICAgICB2YXIgaSxsZW4gPSBkYXRhLmtzLm9yLmsubGVuZ3RoO1xyXG4gICAgICAgIGZvcihpPTA7aTxsZW47aSs9MSl7XHJcbiAgICAgICAgICAgIGRhdGEua3Mub3Iua1tpXS50byA9IG51bGw7XHJcbiAgICAgICAgICAgIGRhdGEua3Mub3Iua1tpXS50aSA9IG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgdGhpcy5vciA9IFByb3BlcnR5RmFjdG9yeS5nZXRQcm9wKHRoaXMsZGF0YS5rcy5vciwxLGRlZ1RvUmFkcyx0aGlzLmR5bmFtaWNQcm9wZXJ0aWVzKTtcclxuICAgIHRoaXMub3Iuc2ggPSB0cnVlO1xyXG4gICAgdGhpcy5yeCA9IFByb3BlcnR5RmFjdG9yeS5nZXRQcm9wKHRoaXMsZGF0YS5rcy5yeCwwLGRlZ1RvUmFkcyx0aGlzLmR5bmFtaWNQcm9wZXJ0aWVzKTtcclxuICAgIHRoaXMucnkgPSBQcm9wZXJ0eUZhY3RvcnkuZ2V0UHJvcCh0aGlzLGRhdGEua3MucnksMCxkZWdUb1JhZHMsdGhpcy5keW5hbWljUHJvcGVydGllcyk7XHJcbiAgICB0aGlzLnJ6ID0gUHJvcGVydHlGYWN0b3J5LmdldFByb3AodGhpcyxkYXRhLmtzLnJ6LDAsZGVnVG9SYWRzLHRoaXMuZHluYW1pY1Byb3BlcnRpZXMpO1xyXG4gICAgdGhpcy5tYXQgPSBuZXcgTWF0cml4KCk7XHJcbn1cclxuY3JlYXRlRWxlbWVudChIQmFzZUVsZW1lbnQsIEhDYW1lcmFFbGVtZW50KTtcclxuXHJcbkhDYW1lcmFFbGVtZW50LnByb3RvdHlwZS5zZXR1cCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgdmFyIGksIGxlbiA9IHRoaXMuY29tcC50aHJlZURFbGVtZW50cy5sZW5ndGgsIGNvbXA7XHJcbiAgICBmb3IoaT0wO2k8bGVuO2krPTEpe1xyXG4gICAgICAgIC8vW3BlcnNwZWN0aXZlRWxlbSxjb250YWluZXJdXHJcbiAgICAgICAgY29tcCA9IHRoaXMuY29tcC50aHJlZURFbGVtZW50c1tpXTtcclxuICAgICAgICBjb21wLnBlcnNwZWN0aXZlRWxlbS5zdHlsZS5wZXJzcGVjdGl2ZSA9IGNvbXAucGVyc3BlY3RpdmVFbGVtLnN0eWxlLndlYmtpdFBlcnNwZWN0aXZlID0gdGhpcy5wZS52KydweCc7XHJcbiAgICAgICAgY29tcC5jb250YWluZXIuc3R5bGUudHJhbnNmb3JtT3JpZ2luID0gY29tcC5jb250YWluZXIuc3R5bGUubW96VHJhbnNmb3JtT3JpZ2luID0gY29tcC5jb250YWluZXIuc3R5bGUud2Via2l0VHJhbnNmb3JtT3JpZ2luID0gXCIwcHggMHB4IDBweFwiO1xyXG4gICAgICAgIGNvbXAucGVyc3BlY3RpdmVFbGVtLnN0eWxlLnRyYW5zZm9ybSA9IGNvbXAucGVyc3BlY3RpdmVFbGVtLnN0eWxlLndlYmtpdFRyYW5zZm9ybSA9ICdtYXRyaXgzZCgxLDAsMCwwLDAsMSwwLDAsMCwwLDEsMCwwLDAsMCwxKSc7XHJcbiAgICB9XHJcbn07XHJcblxyXG5IQ2FtZXJhRWxlbWVudC5wcm90b3R5cGUuY3JlYXRlRWxlbWVudHMgPSBmdW5jdGlvbigpe1xyXG59O1xyXG5cclxuSENhbWVyYUVsZW1lbnQucHJvdG90eXBlLmhpZGUgPSBmdW5jdGlvbigpe1xyXG59O1xyXG5cclxuSENhbWVyYUVsZW1lbnQucHJvdG90eXBlLnJlbmRlckZyYW1lID0gZnVuY3Rpb24oKXtcclxuICAgIHZhciBtZGYgPSB0aGlzLmZpcnN0RnJhbWU7XHJcbiAgICB2YXIgaSwgbGVuO1xyXG4gICAgaWYodGhpcy5oaWVyYXJjaHkpe1xyXG4gICAgICAgIGxlbiA9IHRoaXMuaGllcmFyY2h5Lmxlbmd0aDtcclxuICAgICAgICBmb3IoaT0wO2k8bGVuO2krPTEpe1xyXG4gICAgICAgICAgICBtZGYgPSB0aGlzLmhpZXJhcmNoeVtpXS5maW5hbFRyYW5zZm9ybS5tUHJvcC5tZGYgPyB0cnVlIDogbWRmO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGlmKG1kZiB8fCAodGhpcy5wICYmIHRoaXMucC5tZGYpIHx8ICh0aGlzLnB4ICYmICh0aGlzLnB4Lm1kZiB8fCB0aGlzLnB5Lm1kZiB8fCB0aGlzLnB6Lm1kZikpIHx8IHRoaXMucngubWRmIHx8IHRoaXMucnkubWRmIHx8IHRoaXMucnoubWRmIHx8IHRoaXMub3IubWRmIHx8ICh0aGlzLmEgJiYgdGhpcy5hLm1kZikpIHtcclxuICAgICAgICB0aGlzLm1hdC5yZXNldCgpO1xyXG5cclxuICAgICAgICBpZih0aGlzLnApe1xyXG4gICAgICAgICAgICB0aGlzLm1hdC50cmFuc2xhdGUoLXRoaXMucC52WzBdLC10aGlzLnAudlsxXSx0aGlzLnAudlsyXSk7XHJcbiAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgIHRoaXMubWF0LnRyYW5zbGF0ZSgtdGhpcy5weC52LC10aGlzLnB5LnYsdGhpcy5wei52KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYodGhpcy5hKXtcclxuICAgICAgICAgICAgdmFyIGRpZmZWZWN0b3IgPSBbdGhpcy5wLnZbMF0tdGhpcy5hLnZbMF0sdGhpcy5wLnZbMV0tdGhpcy5hLnZbMV0sdGhpcy5wLnZbMl0tdGhpcy5hLnZbMl1dO1xyXG4gICAgICAgICAgICB2YXIgbWFnID0gTWF0aC5zcXJ0KE1hdGgucG93KGRpZmZWZWN0b3JbMF0sMikrTWF0aC5wb3coZGlmZlZlY3RvclsxXSwyKStNYXRoLnBvdyhkaWZmVmVjdG9yWzJdLDIpKTtcclxuICAgICAgICAgICAgLy92YXIgbG9va0RpciA9IGdldE5vcm1hbGl6ZWRQb2ludChnZXREaWZmVmVjdG9yKHRoaXMuYS52LHRoaXMucC52KSk7XHJcbiAgICAgICAgICAgIHZhciBsb29rRGlyID0gW2RpZmZWZWN0b3JbMF0vbWFnLGRpZmZWZWN0b3JbMV0vbWFnLGRpZmZWZWN0b3JbMl0vbWFnXTtcclxuICAgICAgICAgICAgdmFyIGxvb2tMZW5ndGhPblhaID0gTWF0aC5zcXJ0KCBsb29rRGlyWzJdKmxvb2tEaXJbMl0gKyBsb29rRGlyWzBdKmxvb2tEaXJbMF0gKTtcclxuICAgICAgICAgICAgdmFyIG1fcm90YXRpb25YID0gKE1hdGguYXRhbjIoIGxvb2tEaXJbMV0sIGxvb2tMZW5ndGhPblhaICkpO1xyXG4gICAgICAgICAgICB2YXIgbV9yb3RhdGlvblkgPSAoTWF0aC5hdGFuMiggbG9va0RpclswXSwgLWxvb2tEaXJbMl0pKTtcclxuICAgICAgICAgICAgdGhpcy5tYXQucm90YXRlWShtX3JvdGF0aW9uWSkucm90YXRlWCgtbV9yb3RhdGlvblgpO1xyXG5cclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5tYXQucm90YXRlWCgtdGhpcy5yeC52KS5yb3RhdGVZKC10aGlzLnJ5LnYpLnJvdGF0ZVoodGhpcy5yei52KTtcclxuICAgICAgICB0aGlzLm1hdC5yb3RhdGVYKC10aGlzLm9yLnZbMF0pLnJvdGF0ZVkoLXRoaXMub3IudlsxXSkucm90YXRlWih0aGlzLm9yLnZbMl0pO1xyXG4gICAgICAgIHRoaXMubWF0LnRyYW5zbGF0ZSh0aGlzLmdsb2JhbERhdGEuY29tcFNpemUudy8yLHRoaXMuZ2xvYmFsRGF0YS5jb21wU2l6ZS5oLzIsMCk7XHJcbiAgICAgICAgdGhpcy5tYXQudHJhbnNsYXRlKDAsMCx0aGlzLnBlLnYpO1xyXG4gICAgICAgIGlmKHRoaXMuaGllcmFyY2h5KXtcclxuICAgICAgICAgICAgdmFyIG1hdDtcclxuICAgICAgICAgICAgbGVuID0gdGhpcy5oaWVyYXJjaHkubGVuZ3RoO1xyXG4gICAgICAgICAgICBmb3IoaT0wO2k8bGVuO2krPTEpe1xyXG4gICAgICAgICAgICAgICAgbWF0ID0gdGhpcy5oaWVyYXJjaHlbaV0uZmluYWxUcmFuc2Zvcm0ubVByb3AuaXYucHJvcHM7XHJcbiAgICAgICAgICAgICAgICB0aGlzLm1hdC50cmFuc2Zvcm0obWF0WzBdLG1hdFsxXSxtYXRbMl0sbWF0WzNdLG1hdFs0XSxtYXRbNV0sbWF0WzZdLG1hdFs3XSxtYXRbOF0sbWF0WzldLG1hdFsxMF0sbWF0WzExXSwtbWF0WzEyXSwtbWF0WzEzXSxtYXRbMTRdLG1hdFsxNV0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGxlbiA9IHRoaXMuY29tcC50aHJlZURFbGVtZW50cy5sZW5ndGg7XHJcbiAgICAgICAgdmFyIGNvbXA7XHJcbiAgICAgICAgZm9yKGk9MDtpPGxlbjtpKz0xKXtcclxuICAgICAgICAgICAgY29tcCA9IHRoaXMuY29tcC50aHJlZURFbGVtZW50c1tpXTtcclxuICAgICAgICAgICAgY29tcC5jb250YWluZXIuc3R5bGUudHJhbnNmb3JtID0gY29tcC5jb250YWluZXIuc3R5bGUud2Via2l0VHJhbnNmb3JtID0gdGhpcy5tYXQudG9DU1MoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICB0aGlzLmZpcnN0RnJhbWUgPSBmYWxzZTtcclxufTtcclxuXHJcbkhDYW1lcmFFbGVtZW50LnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24oKXtcclxufTtcbnZhciBFeHByZXNzaW9ucyA9IChmdW5jdGlvbigpe1xyXG4gICAgdmFyIG9iID0ge307XHJcbiAgICBvYi5pbml0RXhwcmVzc2lvbnMgPSBpbml0RXhwcmVzc2lvbnM7XHJcblxyXG5cclxuICAgIGZ1bmN0aW9uIGluaXRFeHByZXNzaW9ucyhhbmltYXRpb24pe1xyXG4gICAgICAgIGFuaW1hdGlvbi5yZW5kZXJlci5jb21wSW50ZXJmYWNlID0gQ29tcEV4cHJlc3Npb25JbnRlcmZhY2UoYW5pbWF0aW9uLnJlbmRlcmVyKTtcclxuICAgICAgICBhbmltYXRpb24ucmVuZGVyZXIuZ2xvYmFsRGF0YS5wcm9qZWN0SW50ZXJmYWNlLnJlZ2lzdGVyQ29tcG9zaXRpb24oYW5pbWF0aW9uLnJlbmRlcmVyKTtcclxuICAgIH1cclxuICAgcmV0dXJuIG9iO1xyXG59KCkpO1xyXG5cclxuZXhwcmVzc2lvbnNQbHVnaW4gPSBFeHByZXNzaW9ucztcclxuXG4oZnVuY3Rpb24gYWRkUHJvcGVydHlEZWNvcmF0b3IoKSB7XHJcblxyXG4gICAgZnVuY3Rpb24gZ2V0U3RhdGljVmFsdWVBdFRpbWUoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMucHY7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gZ2V0VmFsdWVBdFRpbWUoZnJhbWVOdW0sIG9mZnNldFRpbWUpIHtcclxuICAgICAgICBmcmFtZU51bSAqPSB0aGlzLmVsZW0uZ2xvYmFsRGF0YS5mcmFtZVJhdGU7XHJcbiAgICAgICAgdmFyIGkgPSAwLGxlbiA9IHRoaXMua2V5ZnJhbWVzLmxlbmd0aC0gMSxkaXI9IDEsZmxhZyA9IHRydWU7XHJcbiAgICAgICAgdmFyIGtleURhdGEsIG5leHRLZXlEYXRhO1xyXG4gICAgICAgIG9mZnNldFRpbWUgPSBvZmZzZXRUaW1lID09PSB1bmRlZmluZWQgPyB0aGlzLm9mZnNldFRpbWUgOiAwO1xyXG4gICAgICAgIC8vY29uc29sZS5sb2codGhpcy5vZmZzZXRUaW1lKTtcclxuICAgICAgICB2YXIgcmV0VmFsID0gdHlwZW9mIHRoaXMucHYgPT09ICdvYmplY3QnID8gW3RoaXMucHYubGVuZ3RoXSA6IDA7XHJcblxyXG4gICAgICAgIHdoaWxlKGZsYWcpe1xyXG4gICAgICAgICAgICBrZXlEYXRhID0gdGhpcy5rZXlmcmFtZXNbaV07XHJcbiAgICAgICAgICAgIG5leHRLZXlEYXRhID0gdGhpcy5rZXlmcmFtZXNbaSsxXTtcclxuICAgICAgICAgICAgaWYoaSA9PSBsZW4tMSAmJiBmcmFtZU51bSA+PSBuZXh0S2V5RGF0YS50IC0gb2Zmc2V0VGltZSl7XHJcbiAgICAgICAgICAgICAgICBpZihrZXlEYXRhLmgpe1xyXG4gICAgICAgICAgICAgICAgICAgIGtleURhdGEgPSBuZXh0S2V5RGF0YTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmKChuZXh0S2V5RGF0YS50IC0gb2Zmc2V0VGltZSkgPiBmcmFtZU51bSl7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZihpIDwgbGVuIC0gMSl7XHJcbiAgICAgICAgICAgICAgICBpICs9IGRpcjtcclxuICAgICAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgICAgICBmbGFnID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZhciBrLCBrTGVuLHBlcmMsakxlbiwgaiA9IDAsIGZuYztcclxuICAgICAgICBpZiAoa2V5RGF0YS50bykge1xyXG5cclxuICAgICAgICAgICAgaWYgKCFrZXlEYXRhLmJlemllckRhdGEpIHtcclxuICAgICAgICAgICAgICAgIGJlei5idWlsZEJlemllckRhdGEoa2V5RGF0YSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdmFyIGJlemllckRhdGEgPSBrZXlEYXRhLmJlemllckRhdGE7XHJcbiAgICAgICAgICAgIGlmIChmcmFtZU51bSA+PSBuZXh0S2V5RGF0YS50LW9mZnNldFRpbWUgfHwgZnJhbWVOdW0gPCBrZXlEYXRhLnQtb2Zmc2V0VGltZSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGluZCA9IGZyYW1lTnVtID49IG5leHRLZXlEYXRhLnQtb2Zmc2V0VGltZSA/IGJlemllckRhdGEucG9pbnRzLmxlbmd0aCAtIDEgOiAwO1xyXG4gICAgICAgICAgICAgICAga0xlbiA9IGJlemllckRhdGEucG9pbnRzW2luZF0ucG9pbnQubGVuZ3RoO1xyXG4gICAgICAgICAgICAgICAgZm9yKGsgPSAwOyBrIDwga0xlbjsgayArPSAxKXtcclxuICAgICAgICAgICAgICAgICAgICByZXRWYWxba10gPSBiZXppZXJEYXRhLnBvaW50c1tpbmRdLnBvaW50W2tdO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgaWYgKGtleURhdGEuX19mbmN0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZm5jID0ga2V5RGF0YS5fX2ZuY3Q7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vZm5jID0gYmV6LmdldEVhc2luZ0N1cnZlKGtleURhdGEuby54LGtleURhdGEuby55LGtleURhdGEuaS54LGtleURhdGEuaS55LGtleURhdGEubik7XHJcbiAgICAgICAgICAgICAgICAgICAgZm5jID0gQmV6aWVyRmFjdG9yeS5nZXRCZXppZXJFYXNpbmcoa2V5RGF0YS5vLngsIGtleURhdGEuby55LCBrZXlEYXRhLmkueCwga2V5RGF0YS5pLnksIGtleURhdGEubikuZ2V0O1xyXG4gICAgICAgICAgICAgICAgICAgIGtleURhdGEuX19mbmN0ID0gZm5jO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcGVyYyA9IGZuYygoZnJhbWVOdW0gLSAoa2V5RGF0YS50IC0gb2Zmc2V0VGltZSkpIC8gKChuZXh0S2V5RGF0YS50IC0gb2Zmc2V0VGltZSkgLSAoa2V5RGF0YS50IC0gb2Zmc2V0VGltZSkpKTtcclxuICAgICAgICAgICAgICAgIHZhciBkaXN0YW5jZUluTGluZSA9IGJlemllckRhdGEuc2VnbWVudExlbmd0aCAqIHBlcmM7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIHNlZ21lbnRQZXJjO1xyXG4gICAgICAgICAgICAgICAgdmFyIGFkZGVkTGVuZ3RoID0gMDtcclxuICAgICAgICAgICAgICAgIGRpciA9IDE7XHJcbiAgICAgICAgICAgICAgICBmbGFnID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIGpMZW4gPSBiZXppZXJEYXRhLnBvaW50cy5sZW5ndGg7XHJcbiAgICAgICAgICAgICAgICB3aGlsZShmbGFnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYWRkZWRMZW5ndGggKz0gYmV6aWVyRGF0YS5wb2ludHNbal0ucGFydGlhbExlbmd0aCpkaXI7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRpc3RhbmNlSW5MaW5lID09PSAwIHx8IHBlcmMgPT09IDAgfHwgaiA9PSBiZXppZXJEYXRhLnBvaW50cy5sZW5ndGggLSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGtMZW4gPSBiZXppZXJEYXRhLnBvaW50c1tqXS5wb2ludC5sZW5ndGg7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoayA9IDA7IGsgPCBrTGVuOyBrICs9IDEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldFZhbFtrXSA9IGJlemllckRhdGEucG9pbnRzW2pdLnBvaW50W2tdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZGlzdGFuY2VJbkxpbmUgPj0gYWRkZWRMZW5ndGggJiYgZGlzdGFuY2VJbkxpbmUgPCBhZGRlZExlbmd0aCArIGJlemllckRhdGEucG9pbnRzW2orMV0ucGFydGlhbExlbmd0aCl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlZ21lbnRQZXJjID0gKGRpc3RhbmNlSW5MaW5lIC0gYWRkZWRMZW5ndGgpIC8gKGJlemllckRhdGEucG9pbnRzW2ogKyAxXS5wYXJ0aWFsTGVuZ3RoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAga0xlbiA9IGJlemllckRhdGEucG9pbnRzW2pdLnBvaW50Lmxlbmd0aDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChrID0gMDsgayA8IGtMZW47IGsgKz0gMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0VmFsW2tdID0gYmV6aWVyRGF0YS5wb2ludHNbal0ucG9pbnRba10gKyAoYmV6aWVyRGF0YS5wb2ludHNbaisxXS5wb2ludFtrXSAtIGJlemllckRhdGEucG9pbnRzW2pdLnBvaW50W2tdKSAqIHNlZ21lbnRQZXJjO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAoaiA8IGpMZW4gLSAxICYmIGRpciA9PSAxIHx8IGogPiAwICYmIGRpciA9PSAtMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBqICs9IGRpcjtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmbGFnID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdmFyIG91dFgsb3V0WSxpblgsaW5ZLCBpc0FycmF5ID0gZmFsc2UsIGtleVZhbHVlO1xyXG4gICAgICAgICAgICBsZW4gPSBrZXlEYXRhLnMubGVuZ3RoO1xyXG4gICAgICAgICAgICBmb3IoaT0wO2k8bGVuO2krPTEpe1xyXG4gICAgICAgICAgICAgICAgaWYoa2V5RGF0YS5oICE9PSAxKXtcclxuICAgICAgICAgICAgICAgICAgICBpZihrZXlEYXRhLm8ueCBpbnN0YW5jZW9mIEFycmF5KXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaXNBcnJheSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCFrZXlEYXRhLl9fZm5jdCl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBrZXlEYXRhLl9fZm5jdCA9IFtdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCFrZXlEYXRhLl9fZm5jdFtpXSl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvdXRYID0ga2V5RGF0YS5vLnhbaV0gfHwga2V5RGF0YS5vLnhbMF07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvdXRZID0ga2V5RGF0YS5vLnlbaV0gfHwga2V5RGF0YS5vLnlbMF07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpblggPSBrZXlEYXRhLmkueFtpXSB8fCBrZXlEYXRhLmkueFswXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluWSA9IGtleURhdGEuaS55W2ldIHx8IGtleURhdGEuaS55WzBdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzQXJyYXkgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYoIWtleURhdGEuX19mbmN0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvdXRYID0ga2V5RGF0YS5vLng7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvdXRZID0ga2V5RGF0YS5vLnk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpblggPSBrZXlEYXRhLmkueDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluWSA9IGtleURhdGEuaS55O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmKGlzQXJyYXkpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZihrZXlEYXRhLl9fZm5jdFtpXSl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmbmMgPSBrZXlEYXRhLl9fZm5jdFtpXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL2ZuYyA9IGJlei5nZXRFYXNpbmdDdXJ2ZShvdXRYLG91dFksaW5YLGluWSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmbmMgPSBCZXppZXJGYWN0b3J5LmdldEJlemllckVhc2luZyhvdXRYLG91dFksaW5YLGluWSkuZ2V0O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAga2V5RGF0YS5fX2ZuY3RbaV0gPSBmbmM7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYoa2V5RGF0YS5fX2ZuY3Qpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm5jID0ga2V5RGF0YS5fX2ZuY3Q7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9mbmMgPSBiZXouZ2V0RWFzaW5nQ3VydmUob3V0WCxvdXRZLGluWCxpblkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm5jID0gQmV6aWVyRmFjdG9yeS5nZXRCZXppZXJFYXNpbmcob3V0WCxvdXRZLGluWCxpblkpLmdldDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtleURhdGEuX19mbmN0ID0gZm5jO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmKGZyYW1lTnVtID49IG5leHRLZXlEYXRhLnQtb2Zmc2V0VGltZSl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBlcmMgPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgIH1lbHNlIGlmKGZyYW1lTnVtIDwga2V5RGF0YS50LW9mZnNldFRpbWUpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwZXJjID0gMDtcclxuICAgICAgICAgICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcGVyYyA9IGZuYygoZnJhbWVOdW0tKGtleURhdGEudC1vZmZzZXRUaW1lKSkvKChuZXh0S2V5RGF0YS50LW9mZnNldFRpbWUpLShrZXlEYXRhLnQtb2Zmc2V0VGltZSkpKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZih0aGlzLnNoICYmIGtleURhdGEuaCAhPT0gMSl7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGluaXRQID0ga2V5RGF0YS5zW2ldO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBlbmRQID0ga2V5RGF0YS5lW2ldO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmKGluaXRQLWVuZFAgPCAtMTgwKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaW5pdFAgKz0gMzYwO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZihpbml0UC1lbmRQID4gMTgwKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaW5pdFAgLT0gMzYwO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBrZXlWYWx1ZSA9IGluaXRQKyhlbmRQLWluaXRQKSpwZXJjO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBrZXlWYWx1ZSA9IGtleURhdGEuaCA9PT0gMSA/IGtleURhdGEuc1tpXSA6IGtleURhdGEuc1tpXSsoa2V5RGF0YS5lW2ldLWtleURhdGEuc1tpXSkqcGVyYztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmKGxlbiA9PT0gMSl7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0VmFsID0ga2V5VmFsdWU7XHJcbiAgICAgICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgICAgICByZXRWYWxbaV0gPSBrZXlWYWx1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcmV0VmFsO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIGdldFZlbG9jaXR5QXRUaW1lKGZyYW1lTnVtKSB7XHJcbiAgICAgICAgaWYodGhpcy52ZWwgIT09IHVuZGVmaW5lZCl7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnZlbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIGRlbHRhID0gLTAuMDE7XHJcbiAgICAgICAgLy9mcmFtZU51bSArPSB0aGlzLmVsZW0uZGF0YS5zdDtcclxuICAgICAgICB2YXIgdjEgPSB0aGlzLmdldFZhbHVlQXRUaW1lKGZyYW1lTnVtLCAwKTtcclxuICAgICAgICB2YXIgdjIgPSB0aGlzLmdldFZhbHVlQXRUaW1lKGZyYW1lTnVtICsgZGVsdGEsIDApO1xyXG4gICAgICAgIHZhciB2ZWxvY2l0eTtcclxuICAgICAgICBpZih2MS5sZW5ndGgpe1xyXG4gICAgICAgICAgICB2ZWxvY2l0eSA9IEFycmF5LmFwcGx5KG51bGwse2xlbmd0aDp2MS5sZW5ndGh9KTtcclxuICAgICAgICAgICAgdmFyIGk7XHJcbiAgICAgICAgICAgIGZvcihpPTA7aTx2MS5sZW5ndGg7aSs9MSl7XHJcbiAgICAgICAgICAgICAgICAvL3JlbW92aW5nIGZyYW1lUmF0ZVxyXG4gICAgICAgICAgICAgICAgLy9pZiBuZWVkZWQsIGRvbid0IGFkZCBpdCBoZXJlXHJcbiAgICAgICAgICAgICAgICAvL3ZlbG9jaXR5W2ldID0gdGhpcy5lbGVtLmdsb2JhbERhdGEuZnJhbWVSYXRlKigodjJbaV0gLSB2MVtpXSkvZGVsdGEpO1xyXG4gICAgICAgICAgICAgICAgdmVsb2NpdHlbaV0gPSAodjJbaV0gLSB2MVtpXSkvZGVsdGE7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB2ZWxvY2l0eSA9ICh2MiAtIHYxKS9kZWx0YTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHZlbG9jaXR5O1xyXG4gICAgfTtcclxuXHJcbiAgICBmdW5jdGlvbiBzZXRHcm91cFByb3BlcnR5KHByb3BlcnR5R3JvdXApe1xyXG4gICAgICAgIHRoaXMucHJvcGVydHlHcm91cCA9IHByb3BlcnR5R3JvdXA7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gc2VhcmNoRXhwcmVzc2lvbnMoZWxlbSxkYXRhLHByb3Ape1xyXG4gICAgICAgIGlmKGRhdGEueCl7XHJcbiAgICAgICAgICAgIHByb3AuayA9IHRydWU7XHJcbiAgICAgICAgICAgIHByb3AueCA9IHRydWU7XHJcbiAgICAgICAgICAgIGlmKHByb3AuZ2V0VmFsdWUpIHtcclxuICAgICAgICAgICAgICAgIHByb3AuZ2V0UHJlVmFsdWUgPSBwcm9wLmdldFZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHByb3AuZ2V0VmFsdWUgPSBFeHByZXNzaW9uTWFuYWdlci5pbml0aWF0ZUV4cHJlc3Npb24uYmluZChwcm9wKShlbGVtLGRhdGEscHJvcCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIGdldFRyYW5zZm9ybVZhbHVlQXRUaW1lKHRpbWUpIHtcclxuICAgICAgICBjb25zb2xlLmxvZygndGltZTonLCB0aW1lKVxyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIGdldFRyYW5zZm9ybVN0YXRpY1ZhbHVlQXRUaW1lKHRpbWUpIHtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgdmFyIFRleHRFeHByZXNzaW9uU2VsZWN0b3JQcm9wID0gKGZ1bmN0aW9uKCl7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldFZhbHVlUHJveHkoaW5kZXgsdG90YWwpe1xyXG4gICAgICAgICAgICB0aGlzLnRleHRJbmRleCA9IGluZGV4KzE7XHJcbiAgICAgICAgICAgIHRoaXMudGV4dFRvdGFsID0gdG90YWw7XHJcbiAgICAgICAgICAgIHRoaXMuZ2V0VmFsdWUoKTtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMudjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBmdW5jdGlvbiBUZXh0RXhwcmVzc2lvblNlbGVjdG9yUHJvcChlbGVtLGRhdGEpe1xyXG4gICAgICAgICAgICB0aGlzLnB2ID0gMTtcclxuICAgICAgICAgICAgdGhpcy5jb21wID0gZWxlbS5jb21wO1xyXG4gICAgICAgICAgICB0aGlzLmVsZW0gPSBlbGVtO1xyXG4gICAgICAgICAgICB0aGlzLm11bHQgPSAuMDE7XHJcbiAgICAgICAgICAgIHRoaXMudHlwZSA9ICd0ZXh0U2VsZWN0b3InO1xyXG4gICAgICAgICAgICB0aGlzLnRleHRUb3RhbCA9IGRhdGEudG90YWxDaGFycztcclxuICAgICAgICAgICAgdGhpcy5zZWxlY3RvclZhbHVlID0gMTAwO1xyXG4gICAgICAgICAgICB0aGlzLmxhc3RWYWx1ZSA9IFsxLDEsMV07XHJcbiAgICAgICAgICAgIHNlYXJjaEV4cHJlc3Npb25zLmJpbmQodGhpcykoZWxlbSxkYXRhLHRoaXMpO1xyXG4gICAgICAgICAgICB0aGlzLmdldE11bHQgPSBnZXRWYWx1ZVByb3h5O1xyXG4gICAgICAgICAgICB0aGlzLmdldFZlbG9jaXR5QXRUaW1lID0gZ2V0VmVsb2NpdHlBdFRpbWU7XHJcbiAgICAgICAgICAgIGlmKHRoaXMua2Ype1xyXG4gICAgICAgICAgICAgICAgdGhpcy5nZXRWYWx1ZUF0VGltZSA9IGdldFZhbHVlQXRUaW1lLmJpbmQodGhpcyk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmdldFZhbHVlQXRUaW1lID0gZ2V0U3RhdGljVmFsdWVBdFRpbWUuYmluZCh0aGlzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLnNldEdyb3VwUHJvcGVydHkgPSBzZXRHcm91cFByb3BlcnR5O1xyXG4gICAgICAgIH1cclxuICAgIH0oKSk7XHJcblxyXG5cclxuICAgIHZhciBwcm9wZXJ0eUdldFByb3AgPSBQcm9wZXJ0eUZhY3RvcnkuZ2V0UHJvcDtcclxuICAgIFByb3BlcnR5RmFjdG9yeS5nZXRQcm9wID0gZnVuY3Rpb24oZWxlbSxkYXRhLHR5cGUsIG11bHQsIGFycil7XHJcbiAgICAgICAgdmFyIHByb3AgPSBwcm9wZXJ0eUdldFByb3AoZWxlbSxkYXRhLHR5cGUsIG11bHQsIGFycik7XHJcbiAgICAgICAgcHJvcC5nZXRWZWxvY2l0eUF0VGltZSA9IGdldFZlbG9jaXR5QXRUaW1lO1xyXG4gICAgICAgIGlmKHR5cGUgPT09IDIpIHtcclxuICAgICAgICAgICAgaWYocHJvcC5keW5hbWljUHJvcGVydGllcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIHByb3AuZ2V0VmFsdWVBdFRpbWUgPSBnZXRUcmFuc2Zvcm1WYWx1ZUF0VGltZS5iaW5kKHByb3ApO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcHJvcC5nZXRWYWx1ZUF0VGltZSA9IGdldFRyYW5zZm9ybVN0YXRpY1ZhbHVlQXRUaW1lLmJpbmQocHJvcCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBpZihwcm9wLmtmKXtcclxuICAgICAgICAgICAgICAgIHByb3AuZ2V0VmFsdWVBdFRpbWUgPSBnZXRWYWx1ZUF0VGltZS5iaW5kKHByb3ApO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcHJvcC5nZXRWYWx1ZUF0VGltZSA9IGdldFN0YXRpY1ZhbHVlQXRUaW1lLmJpbmQocHJvcCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcHJvcC5zZXRHcm91cFByb3BlcnR5ID0gc2V0R3JvdXBQcm9wZXJ0eTtcclxuICAgICAgICB2YXIgaXNBZGRlZCA9IHByb3AuaztcclxuICAgICAgICBpZihkYXRhLml4ICE9PSB1bmRlZmluZWQpe1xyXG4gICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkocHJvcCwncHJvcGVydHlJbmRleCcse1xyXG4gICAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRhLml4O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgIH1cclxuICAgICAgICBzZWFyY2hFeHByZXNzaW9ucyhlbGVtLGRhdGEscHJvcCk7XHJcbiAgICAgICAgaWYoIWlzQWRkZWQgJiYgcHJvcC54KXtcclxuICAgICAgICAgICAgYXJyLnB1c2gocHJvcCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gcHJvcDtcclxuICAgIH1cclxuXHJcbiAgICB2YXIgcHJvcGVydHlHZXRTaGFwZVByb3AgPSBTaGFwZVByb3BlcnR5RmFjdG9yeS5nZXRTaGFwZVByb3A7XHJcbiAgICBTaGFwZVByb3BlcnR5RmFjdG9yeS5nZXRTaGFwZVByb3AgPSBmdW5jdGlvbihlbGVtLGRhdGEsdHlwZSwgYXJyLCB0cmltcyl7XHJcbiAgICAgICAgdmFyIHByb3AgPSBwcm9wZXJ0eUdldFNoYXBlUHJvcChlbGVtLGRhdGEsdHlwZSwgYXJyLCB0cmltcyk7XHJcbiAgICAgICAgcHJvcC5zZXRHcm91cFByb3BlcnR5ID0gc2V0R3JvdXBQcm9wZXJ0eTtcclxuICAgICAgICBpZihwcm9wLmtmKXtcclxuICAgICAgICAgICAgcHJvcC5nZXRWYWx1ZUF0VGltZSA9IGdldFZhbHVlQXRUaW1lO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHByb3AuZ2V0VmFsdWVBdFRpbWUgPSBnZXRTdGF0aWNWYWx1ZUF0VGltZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIGlzQWRkZWQgPSBwcm9wLms7XHJcbiAgICAgICAgaWYoZGF0YS5peCAhPT0gdW5kZWZpbmVkKXtcclxuICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHByb3AsJ3Byb3BlcnR5SW5kZXgnLHtcclxuICAgICAgICAgICAgICAgIGdldDogZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF0YS5peDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSlcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYodHlwZSA9PT0gMyl7XHJcbiAgICAgICAgICAgIHNlYXJjaEV4cHJlc3Npb25zKGVsZW0sZGF0YS5wdCxwcm9wKTtcclxuICAgICAgICB9IGVsc2UgaWYodHlwZSA9PT0gNCl7XHJcbiAgICAgICAgICAgIHNlYXJjaEV4cHJlc3Npb25zKGVsZW0sZGF0YS5rcyxwcm9wKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYoIWlzQWRkZWQgJiYgcHJvcC54KXtcclxuICAgICAgICAgICAgYXJyLnB1c2gocHJvcCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBwcm9wO1xyXG4gICAgfVxyXG5cclxuICAgIHZhciBwcm9wZXJ0eUdldFRleHRQcm9wID0gUHJvcGVydHlGYWN0b3J5LmdldFRleHRTZWxlY3RvclByb3A7XHJcbiAgICBQcm9wZXJ0eUZhY3RvcnkuZ2V0VGV4dFNlbGVjdG9yUHJvcCA9IGZ1bmN0aW9uKGVsZW0sIGRhdGEsYXJyKXtcclxuICAgICAgICBpZihkYXRhLnQgPT09IDEpe1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFRleHRFeHByZXNzaW9uU2VsZWN0b3JQcm9wKGVsZW0sIGRhdGEsYXJyKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gcHJvcGVydHlHZXRUZXh0UHJvcChlbGVtLGRhdGEsYXJyKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn0oKSk7XG52YXIgRXhwcmVzc2lvbk1hbmFnZXIgPSAoZnVuY3Rpb24oKXtcclxuICAgIHZhciBvYiA9IHt9O1xyXG4gICAgdmFyIE1hdGggPSBCTU1hdGg7XHJcbiAgICB2YXIgd2luZG93ID0gbnVsbDtcclxuICAgIHZhciBkb2N1bWVudCA9IG51bGw7XHJcblxyXG4gICAgZnVuY3Rpb24gZHVwbGljYXRlUHJvcGVydHlWYWx1ZSh2YWx1ZSwgbXVsdCl7XHJcbiAgICAgICAgbXVsdCA9IG11bHQgfHwgMTtcclxuXHJcbiAgICAgICAgaWYodHlwZW9mIHZhbHVlID09PSAnbnVtYmVyJyAgfHwgdmFsdWUgaW5zdGFuY2VvZiBOdW1iZXIpe1xyXG4gICAgICAgICAgICByZXR1cm4gdmFsdWUqbXVsdDtcclxuICAgICAgICB9ZWxzZSBpZih2YWx1ZS5pKXtcclxuICAgICAgICAgICAgcmV0dXJuIEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodmFsdWUpKTtcclxuICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgdmFyIGFyciA9IEFycmF5LmFwcGx5KG51bGwse2xlbmd0aDp2YWx1ZS5sZW5ndGh9KTtcclxuICAgICAgICAgICAgdmFyIGksIGxlbiA9IHZhbHVlLmxlbmd0aDtcclxuICAgICAgICAgICAgZm9yKGk9MDtpPGxlbjtpKz0xKXtcclxuICAgICAgICAgICAgICAgIGFycltpXT12YWx1ZVtpXSptdWx0O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBhcnI7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIHNoYXBlc0VxdWFsKHNoYXBlMSwgc2hhcGUyKSB7XHJcbiAgICAgICAgaWYoc2hhcGUxLl9sZW5ndGggIT09IHNoYXBlMi5fbGVuZ3RoIHx8IHNoYXBlMS5jICE9PSBzaGFwZTIuYyl7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIGksIGxlbiA9IHNoYXBlMS5fbGVuZ3RoO1xyXG4gICAgICAgIGZvcihpID0gMDsgaSA8IGxlbjsgaSArPSAxKSB7XHJcbiAgICAgICAgICAgIGlmKHNoYXBlMS52W2ldWzBdICE9PSBzaGFwZTIudltpXVswXSB8fCBzaGFwZTEudltpXVsxXSAhPT0gc2hhcGUyLnZbaV1bMV1cclxuICAgICAgICAgICAgICAgIHx8IHNoYXBlMS5vW2ldWzBdICE9PSBzaGFwZTIub1tpXVswXSB8fCBzaGFwZTEub1tpXVsxXSAhPT0gc2hhcGUyLm9baV1bMV1cclxuICAgICAgICAgICAgICAgIHx8IHNoYXBlMS5pW2ldWzBdICE9PSBzaGFwZTIuaVtpXVswXSB8fCBzaGFwZTEuaVtpXVsxXSAhPT0gc2hhcGUyLmlbaV1bMV0pe1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uICRibV9uZWcoYSl7XHJcbiAgICAgICAgdmFyIHRPZkEgPSB0eXBlb2YgYTtcclxuICAgICAgICBpZih0T2ZBID09PSAnbnVtYmVyJyB8fCB0T2ZBID09PSAnYm9vbGVhbicgIHx8IGEgaW5zdGFuY2VvZiBOdW1iZXIgKXtcclxuICAgICAgICAgICAgcmV0dXJuIC1hO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZihhLmNvbnN0cnVjdG9yID09PSBBcnJheSl7XHJcbiAgICAgICAgICAgIHZhciBpLCBsZW5BID0gYS5sZW5ndGg7XHJcbiAgICAgICAgICAgIHZhciByZXRBcnIgPSBbXTtcclxuICAgICAgICAgICAgZm9yKGk9MDtpPGxlbkE7aSs9MSl7XHJcbiAgICAgICAgICAgICAgICByZXRBcnJbaV0gPSAtYVtpXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gcmV0QXJyO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBzdW0oYSxiKSB7XHJcbiAgICAgICAgdmFyIHRPZkEgPSB0eXBlb2YgYTtcclxuICAgICAgICB2YXIgdE9mQiA9IHR5cGVvZiBiO1xyXG4gICAgICAgIGlmKHRPZkEgPT09ICdzdHJpbmcnIHx8IHRPZkIgPT09ICdzdHJpbmcnKXtcclxuICAgICAgICAgICAgcmV0dXJuIGEgKyBiO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZigodE9mQSA9PT0gJ251bWJlcicgfHwgdE9mQSA9PT0gJ2Jvb2xlYW4nIHx8IHRPZkEgPT09ICdzdHJpbmcnIHx8IGEgaW5zdGFuY2VvZiBOdW1iZXIpICYmICh0T2ZCID09PSAnbnVtYmVyJyB8fCB0T2ZCID09PSAnYm9vbGVhbicgfHwgdE9mQiA9PT0gJ3N0cmluZycgIHx8IGIgaW5zdGFuY2VvZiBOdW1iZXIpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBhICsgYjtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYoYS5jb25zdHJ1Y3RvciA9PT0gQXJyYXkgJiYgKHRPZkIgPT09ICdudW1iZXInIHx8IHRPZkIgPT09ICdib29sZWFuJyB8fCB0T2ZCID09PSAnc3RyaW5nJyB8fCBiIGluc3RhbmNlb2YgTnVtYmVyICkpe1xyXG4gICAgICAgICAgICBhWzBdID0gYVswXSArIGI7XHJcbiAgICAgICAgICAgIHJldHVybiBhO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZigodE9mQSA9PT0gJ251bWJlcicgfHwgdE9mQSA9PT0gJ2Jvb2xlYW4nIHx8IHRPZkEgPT09ICdzdHJpbmcnIHx8IGEgaW5zdGFuY2VvZiBOdW1iZXIgKSAmJiBiLmNvbnN0cnVjdG9yID09PSBBcnJheSl7XHJcbiAgICAgICAgICAgIGJbMF0gPSBhICsgYlswXTtcclxuICAgICAgICAgICAgcmV0dXJuIGI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmKGEuY29uc3RydWN0b3IgPT09IEFycmF5ICYmIGIuY29uc3RydWN0b3IgPT09IEFycmF5KXtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIHZhciBpID0gMCwgbGVuQSA9IGEubGVuZ3RoLCBsZW5CID0gYi5sZW5ndGg7XHJcbiAgICAgICAgICAgIHZhciByZXRBcnIgPSBbXTtcclxuICAgICAgICAgICAgd2hpbGUoaTxsZW5BIHx8IGkgPCBsZW5CKXtcclxuICAgICAgICAgICAgICAgIGlmKCh0eXBlb2YgYVtpXSA9PT0gJ251bWJlcicgfHwgYVtpXSBpbnN0YW5jZW9mIE51bWJlcikgJiYgKHR5cGVvZiBiW2ldID09PSAnbnVtYmVyJyB8fCBiW2ldIGluc3RhbmNlb2YgTnVtYmVyKSl7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0QXJyW2ldID0gYVtpXSArIGJbaV07XHJcbiAgICAgICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgICAgICByZXRBcnJbaV0gPSBiW2ldID09IHVuZGVmaW5lZCA/IGFbaV0gOiBhW2ldIHx8IGJbaV07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpICs9IDE7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHJldEFycjtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIDA7XHJcbiAgICB9XHJcbiAgICB2YXIgYWRkID0gc3VtO1xyXG5cclxuICAgIGZ1bmN0aW9uIHN1YihhLGIpIHtcclxuICAgICAgICB2YXIgdE9mQSA9IHR5cGVvZiBhO1xyXG4gICAgICAgIHZhciB0T2ZCID0gdHlwZW9mIGI7XHJcbiAgICAgICAgaWYoKHRPZkEgPT09ICdudW1iZXInIHx8IHRPZkEgPT09ICdib29sZWFuJyB8fCB0T2ZBID09PSAnc3RyaW5nJyB8fCBhIGluc3RhbmNlb2YgTnVtYmVyICkgJiYgKHRPZkIgPT09ICdudW1iZXInIHx8IHRPZkIgPT09ICdib29sZWFuJyB8fCB0T2ZCID09PSAnc3RyaW5nJyB8fCBiIGluc3RhbmNlb2YgTnVtYmVyICkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGEgLSBiO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiggYS5jb25zdHJ1Y3RvciA9PT0gQXJyYXkgJiYgKHRPZkIgPT09ICdudW1iZXInIHx8IHRPZkIgPT09ICdib29sZWFuJyB8fCB0T2ZCID09PSAnc3RyaW5nJyB8fCBiIGluc3RhbmNlb2YgTnVtYmVyICkpe1xyXG4gICAgICAgICAgICBhWzBdID0gYVswXSAtIGI7XHJcbiAgICAgICAgICAgIHJldHVybiBhO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZigodE9mQSA9PT0gJ251bWJlcicgfHwgdE9mQSA9PT0gJ2Jvb2xlYW4nIHx8IHRPZkEgPT09ICdzdHJpbmcnIHx8IGEgaW5zdGFuY2VvZiBOdW1iZXIgKSAmJiAgYi5jb25zdHJ1Y3RvciA9PT0gQXJyYXkpe1xyXG4gICAgICAgICAgICBiWzBdID0gYSAtIGJbMF07XHJcbiAgICAgICAgICAgIHJldHVybiBiO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZihhLmNvbnN0cnVjdG9yID09PSBBcnJheSAmJiBiLmNvbnN0cnVjdG9yID09PSBBcnJheSl7XHJcbiAgICAgICAgICAgIHZhciBpID0gMCwgbGVuQSA9IGEubGVuZ3RoLCBsZW5CID0gYi5sZW5ndGg7XHJcbiAgICAgICAgICAgIHZhciByZXRBcnIgPSBbXTtcclxuICAgICAgICAgICAgd2hpbGUoaTxsZW5BIHx8IGkgPCBsZW5CKXtcclxuICAgICAgICAgICAgICAgIGlmKCh0eXBlb2YgYVtpXSA9PT0gJ251bWJlcicgfHwgYVtpXSBpbnN0YW5jZW9mIE51bWJlcikgJiYgdHlwZW9mICh0eXBlb2YgYltpXSA9PT0gJ251bWJlcicgfHwgYltpXSBpbnN0YW5jZW9mIE51bWJlcikpe1xyXG4gICAgICAgICAgICAgICAgICAgIHJldEFycltpXSA9IGFbaV0gLSBiW2ldO1xyXG4gICAgICAgICAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0QXJyW2ldID0gYltpXSA9PSB1bmRlZmluZWQgPyBhW2ldIDogYVtpXSB8fCBiW2ldO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaSArPSAxO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiByZXRBcnI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiAwO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIG11bChhLGIpIHtcclxuICAgICAgICB2YXIgdE9mQSA9IHR5cGVvZiBhO1xyXG4gICAgICAgIHZhciB0T2ZCID0gdHlwZW9mIGI7XHJcbiAgICAgICAgdmFyIGFycjtcclxuICAgICAgICBpZigodE9mQSA9PT0gJ251bWJlcicgfHwgdE9mQSA9PT0gJ2Jvb2xlYW4nIHx8IHRPZkEgPT09ICdzdHJpbmcnIHx8IGEgaW5zdGFuY2VvZiBOdW1iZXIgKSAmJiAodE9mQiA9PT0gJ251bWJlcicgfHwgdE9mQiA9PT0gJ2Jvb2xlYW4nIHx8IHRPZkIgPT09ICdzdHJpbmcnIHx8IGIgaW5zdGFuY2VvZiBOdW1iZXIgKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gYSAqIGI7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2YXIgaSwgbGVuO1xyXG4gICAgICAgIGlmKGEuY29uc3RydWN0b3IgPT09IEFycmF5ICYmICh0T2ZCID09PSAnbnVtYmVyJyB8fCB0T2ZCID09PSAnYm9vbGVhbicgfHwgdE9mQiA9PT0gJ3N0cmluZycgfHwgYiBpbnN0YW5jZW9mIE51bWJlciApKXtcclxuICAgICAgICAgICAgbGVuID0gYS5sZW5ndGg7XHJcbiAgICAgICAgICAgIGFyciA9IEFycmF5LmFwcGx5KG51bGwse2xlbmd0aDpsZW59KTtcclxuICAgICAgICAgICAgZm9yKGk9MDtpPGxlbjtpKz0xKXtcclxuICAgICAgICAgICAgICAgIGFycltpXSA9IGFbaV0gKiBiO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBhcnI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmKCh0T2ZBID09PSAnbnVtYmVyJyB8fCB0T2ZBID09PSAnYm9vbGVhbicgfHwgdE9mQSA9PT0gJ3N0cmluZycgfHwgYSBpbnN0YW5jZW9mIE51bWJlciApICYmIGIuY29uc3RydWN0b3IgPT09IEFycmF5KXtcclxuICAgICAgICAgICAgbGVuID0gYi5sZW5ndGg7XHJcbiAgICAgICAgICAgIGFyciA9IEFycmF5LmFwcGx5KG51bGwse2xlbmd0aDpsZW59KTtcclxuICAgICAgICAgICAgZm9yKGk9MDtpPGxlbjtpKz0xKXtcclxuICAgICAgICAgICAgICAgIGFycltpXSA9IGEgKiBiW2ldO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBhcnI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiAwO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIGRpdihhLGIpIHtcclxuICAgICAgICB2YXIgdE9mQSA9IHR5cGVvZiBhO1xyXG4gICAgICAgIHZhciB0T2ZCID0gdHlwZW9mIGI7XHJcbiAgICAgICAgdmFyIGFycjtcclxuICAgICAgICBpZigodE9mQSA9PT0gJ251bWJlcicgfHwgdE9mQSA9PT0gJ2Jvb2xlYW4nIHx8IHRPZkEgPT09ICdzdHJpbmcnIHx8IGEgaW5zdGFuY2VvZiBOdW1iZXIgKSAmJiAodE9mQiA9PT0gJ251bWJlcicgfHwgdE9mQiA9PT0gJ2Jvb2xlYW4nIHx8IHRPZkIgPT09ICdzdHJpbmcnIHx8IGIgaW5zdGFuY2VvZiBOdW1iZXIgKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gYSAvIGI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBpLCBsZW47XHJcbiAgICAgICAgaWYoYS5jb25zdHJ1Y3RvciA9PT0gQXJyYXkgJiYgKHRPZkIgPT09ICdudW1iZXInIHx8IHRPZkIgPT09ICdib29sZWFuJyB8fCB0T2ZCID09PSAnc3RyaW5nJyB8fCBiIGluc3RhbmNlb2YgTnVtYmVyICApKXtcclxuICAgICAgICAgICAgbGVuID0gYS5sZW5ndGg7XHJcbiAgICAgICAgICAgIGFyciA9IEFycmF5LmFwcGx5KG51bGwse2xlbmd0aDpsZW59KTtcclxuICAgICAgICAgICAgZm9yKGk9MDtpPGxlbjtpKz0xKXtcclxuICAgICAgICAgICAgICAgIGFycltpXSA9IGFbaV0gLyBiO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBhcnI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmKCh0T2ZBID09PSAnbnVtYmVyJyB8fCB0T2ZBID09PSAnYm9vbGVhbicgfHwgdE9mQSA9PT0gJ3N0cmluZycgfHwgYSBpbnN0YW5jZW9mIE51bWJlciApICYmIGIuY29uc3RydWN0b3IgPT09IEFycmF5KXtcclxuICAgICAgICAgICAgbGVuID0gYi5sZW5ndGg7XHJcbiAgICAgICAgICAgIGFyciA9IEFycmF5LmFwcGx5KG51bGwse2xlbmd0aDpsZW59KTtcclxuICAgICAgICAgICAgZm9yKGk9MDtpPGxlbjtpKz0xKXtcclxuICAgICAgICAgICAgICAgIGFycltpXSA9IGEgLyBiW2ldO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBhcnI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiAwO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIGNsYW1wKG51bSwgbWluLCBtYXgpIHtcclxuICAgICAgICBpZihtaW4gPiBtYXgpe1xyXG4gICAgICAgICAgICB2YXIgbW0gPSBtYXg7XHJcbiAgICAgICAgICAgIG1heCA9IG1pbjtcclxuICAgICAgICAgICAgbWluID0gbW07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBNYXRoLm1pbihNYXRoLm1heChudW0sIG1pbiksIG1heCk7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gcmFkaWFuc1RvRGVncmVlcyh2YWwpIHtcclxuICAgICAgICByZXR1cm4gdmFsL2RlZ1RvUmFkcztcclxuICAgIH1cclxuICAgIHZhciByYWRpYW5zX3RvX2RlZ3JlZXMgPSByYWRpYW5zVG9EZWdyZWVzO1xyXG5cclxuICAgIGZ1bmN0aW9uIGRlZ3JlZXNUb1JhZGlhbnModmFsKSB7XHJcbiAgICAgICAgcmV0dXJuIHZhbCpkZWdUb1JhZHM7XHJcbiAgICB9XHJcbiAgICB2YXIgZGVncmVlc190b19yYWRpYW5zID0gcmFkaWFuc1RvRGVncmVlcztcclxuXHJcbiAgICB2YXIgaGVscGVyTGVuZ3RoQXJyYXkgPSBbMCwwLDAsMCwwLDBdO1xyXG5cclxuICAgIGZ1bmN0aW9uIGxlbmd0aChhcnIxLGFycjIpe1xyXG4gICAgICAgIGlmKHR5cGVvZiBhcnIxID09PSBcIm51bWJlclwiKXtcclxuICAgICAgICAgICAgYXJyMiA9IGFycjIgfHwgMDtcclxuICAgICAgICAgICAgcmV0dXJuIE1hdGguYWJzKGFycjEgLSBhcnIyKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYoIWFycjIpe1xyXG4gICAgICAgICAgICBhcnIyID0gaGVscGVyTGVuZ3RoQXJyYXk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBpLGxlbiA9IE1hdGgubWluKGFycjEubGVuZ3RoLGFycjIubGVuZ3RoKTtcclxuICAgICAgICB2YXIgYWRkZWRMZW5ndGggPSAwO1xyXG4gICAgICAgIGZvcihpPTA7aTxsZW47aSs9MSl7XHJcbiAgICAgICAgICAgIGFkZGVkTGVuZ3RoICs9IE1hdGgucG93KGFycjJbaV0tYXJyMVtpXSwyKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIE1hdGguc3FydChhZGRlZExlbmd0aCk7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gbm9ybWFsaXplKHZlYyl7XHJcbiAgICAgICAgcmV0dXJuIGRpdih2ZWMsIGxlbmd0aCh2ZWMpKTtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiByZ2JUb0hzbCh2YWwpe1xyXG4gICAgICAgIHZhciByID0gdmFsWzBdOyB2YXIgZyA9IHZhbFsxXTsgdmFyIGIgPSB2YWxbMl07XHJcbiAgICAgICAgdmFyIG1heCA9IE1hdGgubWF4KHIsIGcsIGIpLCBtaW4gPSBNYXRoLm1pbihyLCBnLCBiKTtcclxuICAgICAgICB2YXIgaCwgcywgbCA9IChtYXggKyBtaW4pIC8gMjtcclxuXHJcbiAgICAgICAgaWYobWF4ID09IG1pbil7XHJcbiAgICAgICAgICAgIGggPSBzID0gMDsgLy8gYWNocm9tYXRpY1xyXG4gICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICB2YXIgZCA9IG1heCAtIG1pbjtcclxuICAgICAgICAgICAgcyA9IGwgPiAwLjUgPyBkIC8gKDIgLSBtYXggLSBtaW4pIDogZCAvIChtYXggKyBtaW4pO1xyXG4gICAgICAgICAgICBzd2l0Y2gobWF4KXtcclxuICAgICAgICAgICAgICAgIGNhc2UgcjogaCA9IChnIC0gYikgLyBkICsgKGcgPCBiID8gNiA6IDApOyBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgZzogaCA9IChiIC0gcikgLyBkICsgMjsgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlIGI6IGggPSAociAtIGcpIC8gZCArIDQ7IGJyZWFrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGggLz0gNjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBbaCwgcywgbCx2YWxbM11dO1xyXG4gICAgfVxyXG4gICAgZnVuY3Rpb24gaHNsVG9SZ2IodmFsKXtcclxuICAgICAgICB2YXIgaCA9IHZhbFswXTtcclxuICAgICAgICB2YXIgcyA9IHZhbFsxXTtcclxuICAgICAgICB2YXIgbCA9IHZhbFsyXTtcclxuXHJcbiAgICAgICAgdmFyIHIsIGcsIGI7XHJcblxyXG4gICAgICAgIGlmKHMgPT0gMCl7XHJcbiAgICAgICAgICAgIHIgPSBnID0gYiA9IGw7IC8vIGFjaHJvbWF0aWNcclxuICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgZnVuY3Rpb24gaHVlMnJnYihwLCBxLCB0KXtcclxuICAgICAgICAgICAgICAgIGlmKHQgPCAwKSB0ICs9IDE7XHJcbiAgICAgICAgICAgICAgICBpZih0ID4gMSkgdCAtPSAxO1xyXG4gICAgICAgICAgICAgICAgaWYodCA8IDEvNikgcmV0dXJuIHAgKyAocSAtIHApICogNiAqIHQ7XHJcbiAgICAgICAgICAgICAgICBpZih0IDwgMS8yKSByZXR1cm4gcTtcclxuICAgICAgICAgICAgICAgIGlmKHQgPCAyLzMpIHJldHVybiBwICsgKHEgLSBwKSAqICgyLzMgLSB0KSAqIDY7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdmFyIHEgPSBsIDwgMC41ID8gbCAqICgxICsgcykgOiBsICsgcyAtIGwgKiBzO1xyXG4gICAgICAgICAgICB2YXIgcCA9IDIgKiBsIC0gcTtcclxuICAgICAgICAgICAgciA9IGh1ZTJyZ2IocCwgcSwgaCArIDEvMyk7XHJcbiAgICAgICAgICAgIGcgPSBodWUycmdiKHAsIHEsIGgpO1xyXG4gICAgICAgICAgICBiID0gaHVlMnJnYihwLCBxLCBoIC0gMS8zKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBbciwgZyAsIGIsIHZhbFszXV07XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gbGluZWFyKHQsIHRNaW4sIHRNYXgsIHZhbHVlMSwgdmFsdWUyKXtcclxuICAgICAgICBpZih2YWx1ZTEgPT09IHVuZGVmaW5lZCB8fCB2YWx1ZTIgPT09IHVuZGVmaW5lZCl7XHJcbiAgICAgICAgICAgIHJldHVybiBsaW5lYXIodCwwLDEsdE1pbix0TWF4KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYodCA8PSB0TWluKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB2YWx1ZTE7XHJcbiAgICAgICAgfWVsc2UgaWYodCA+PSB0TWF4KXtcclxuICAgICAgICAgICAgcmV0dXJuIHZhbHVlMjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIHBlcmMgPSB0TWF4ID09PSB0TWluID8gMCA6ICh0LXRNaW4pLyh0TWF4LXRNaW4pO1xyXG4gICAgICAgIGlmKCF2YWx1ZTEubGVuZ3RoKXtcclxuICAgICAgICAgICAgcmV0dXJuIHZhbHVlMSArICh2YWx1ZTItdmFsdWUxKSpwZXJjO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgaSwgbGVuID0gdmFsdWUxLmxlbmd0aDtcclxuICAgICAgICB2YXIgYXJyID0gQXJyYXkuYXBwbHkoIG51bGwsIHsgbGVuZ3RoOiBsZW4gfSApO1xyXG4gICAgICAgIGZvcihpPTA7aTxsZW47aSs9MSl7XHJcbiAgICAgICAgICAgIGFycltpXSA9IHZhbHVlMVtpXSArICh2YWx1ZTJbaV0tdmFsdWUxW2ldKSpwZXJjO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gYXJyO1xyXG4gICAgfVxyXG4gICAgZnVuY3Rpb24gcmFuZG9tKG1pbixtYXgpe1xyXG4gICAgICAgIGlmKG1heCA9PT0gdW5kZWZpbmVkKXtcclxuICAgICAgICAgICAgaWYobWluID09PSB1bmRlZmluZWQpe1xyXG4gICAgICAgICAgICAgICAgbWluID0gMDtcclxuICAgICAgICAgICAgICAgIG1heCA9IDE7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBtYXggPSBtaW47XHJcbiAgICAgICAgICAgICAgICBtaW4gPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgaWYobWF4Lmxlbmd0aCl7XHJcbiAgICAgICAgICAgIHZhciBpLCBsZW4gPSBtYXgubGVuZ3RoO1xyXG4gICAgICAgICAgICBpZighbWluKXtcclxuICAgICAgICAgICAgICAgIG1pbiA9IEFycmF5LmFwcGx5KG51bGwse2xlbmd0aDpsZW59KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB2YXIgYXJyID0gQXJyYXkuYXBwbHkobnVsbCx7bGVuZ3RoOmxlbn0pO1xyXG4gICAgICAgICAgICB2YXIgcm5kID0gQk1NYXRoLnJhbmRvbSgpO1xyXG4gICAgICAgICAgICBmb3IoaT0wO2k8bGVuO2krPTEpe1xyXG4gICAgICAgICAgICAgICAgYXJyW2ldID0gbWluW2ldICsgcm5kKihtYXhbaV0tbWluW2ldKVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBhcnI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmKG1pbiA9PT0gdW5kZWZpbmVkKXtcclxuICAgICAgICAgICAgbWluID0gMDtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIHJuZG0gPSBCTU1hdGgucmFuZG9tKCk7XHJcbiAgICAgICAgcmV0dXJuIG1pbiArIHJuZG0qKG1heC1taW4pO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIGluaXRpYXRlRXhwcmVzc2lvbihlbGVtLGRhdGEscHJvcGVydHkpe1xyXG4gICAgICAgIHZhciB2YWwgPSBkYXRhLng7XHJcbiAgICAgICAgdmFyIG5lZWRzVmVsb2NpdHkgPSAvdmVsb2NpdHkoPyFbXFx3XFxkXSkvLnRlc3QodmFsKTtcclxuICAgICAgICB2YXIgX25lZWRzUmFuZG9tID0gdmFsLmluZGV4T2YoJ3JhbmRvbScpICE9PSAtMTtcclxuICAgICAgICB2YXIgZWxlbVR5cGUgPSBlbGVtLmRhdGEudHk7XHJcbiAgICAgICAgdmFyIHRyYW5zZm9ybSxjb250ZW50LGVmZmVjdDtcclxuICAgICAgICB2YXIgdGhpc0NvbXAgPSBlbGVtLmNvbXA7XHJcbiAgICAgICAgdmFyIHRoaXNQcm9wZXJ0eSA9IHByb3BlcnR5O1xyXG4gICAgICAgIGVsZW0uY29tcC5mcmFtZUR1cmF0aW9uID0gMS9lbGVtLmNvbXAuZ2xvYmFsRGF0YS5mcmFtZVJhdGU7XHJcbiAgICAgICAgdmFyIGluUG9pbnQgPSBlbGVtLmRhdGEuaXAvZWxlbS5jb21wLmdsb2JhbERhdGEuZnJhbWVSYXRlO1xyXG4gICAgICAgIHZhciBvdXRQb2ludCA9IGVsZW0uZGF0YS5vcC9lbGVtLmNvbXAuZ2xvYmFsRGF0YS5mcmFtZVJhdGU7XHJcbiAgICAgICAgdmFyIHdpZHRoID0gZWxlbS5kYXRhLnN3ID8gZWxlbS5kYXRhLnN3IDogMDtcclxuICAgICAgICB2YXIgaGVpZ2h0ID0gZWxlbS5kYXRhLnNoID8gZWxlbS5kYXRhLnNoIDogMDtcclxuICAgICAgICB2YXIgdG9Xb3JsZCxmcm9tV29ybGQsYW5jaG9yUG9pbnQsdGhpc0xheWVyLHRoaXNDb21wO1xyXG4gICAgICAgIHZhciBmbiA9IG5ldyBGdW5jdGlvbigpO1xyXG4gICAgICAgIC8vdmFyIGZuU3RyID0gJ3ZhciBmbiA9IGZ1bmN0aW9uKCl7Jyt2YWwrJzt0aGlzLnYgPSAkYm1fcnQ7fSc7XHJcbiAgICAgICAgLy9ldmFsKGZuU3RyKTtcclxuXHJcbiAgICAgICAgdmFyIGZuID0gZXZhbCgnW2Z1bmN0aW9uKCl7JyArIHZhbCsnO3RoaXMudiA9ICRibV9ydDt9JyArICddJylbMF07XHJcbiAgICAgICAgdmFyIGJpbmRlZEZuID0gZm4uYmluZCh0aGlzKTtcclxuICAgICAgICB2YXIgbnVtS2V5cyA9IHByb3BlcnR5LmtmID8gZGF0YS5rLmxlbmd0aCA6IDA7XHJcblxyXG4gICAgICAgIHZhciB3aWdnbGUgPSBmdW5jdGlvbiB3aWdnbGUoZnJlcSxhbXApe1xyXG4gICAgICAgICAgICB2YXIgaSxqLCBsZW4gPSB0aGlzLnB2Lmxlbmd0aCA/IHRoaXMucHYubGVuZ3RoIDogMTtcclxuICAgICAgICAgICAgdmFyIGFkZGVkQW1wcyA9IEFycmF5LmFwcGx5KG51bGwse2xlbjpsZW59KTtcclxuICAgICAgICAgICAgZm9yKGo9MDtqPGxlbjtqKz0xKXtcclxuICAgICAgICAgICAgICAgIGFkZGVkQW1wc1tqXSA9IDA7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZnJlcSA9IDU7XHJcbiAgICAgICAgICAgIHZhciBpdGVyYXRpb25zID0gTWF0aC5mbG9vcih0aW1lKmZyZXEpO1xyXG4gICAgICAgICAgICBpID0gMDtcclxuICAgICAgICAgICAgaiA9IDA7XHJcbiAgICAgICAgICAgIHdoaWxlKGk8aXRlcmF0aW9ucyl7XHJcbiAgICAgICAgICAgICAgICAvL3ZhciBybmQgPSBCTU1hdGgucmFuZG9tKCk7XHJcbiAgICAgICAgICAgICAgICBmb3Ioaj0wO2o8bGVuO2orPTEpe1xyXG4gICAgICAgICAgICAgICAgICAgIGFkZGVkQW1wc1tqXSArPSAtYW1wICsgYW1wKjIqQk1NYXRoLnJhbmRvbSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vYWRkZWRBbXBzW2pdICs9IC1hbXAgKyBhbXAqMipybmQ7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpICs9IDE7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy92YXIgcm5kMiA9IEJNTWF0aC5yYW5kb20oKTtcclxuICAgICAgICAgICAgdmFyIHBlcmlvZHMgPSB0aW1lKmZyZXE7XHJcbiAgICAgICAgICAgIHZhciBwZXJjID0gcGVyaW9kcyAtIE1hdGguZmxvb3IocGVyaW9kcyk7XHJcbiAgICAgICAgICAgIHZhciBhcnIgPSBBcnJheS5hcHBseSh7bGVuZ3RoOmxlbn0pO1xyXG4gICAgICAgICAgICBpZihsZW4+MSl7XHJcbiAgICAgICAgICAgICAgICBmb3Ioaj0wO2o8bGVuO2orPTEpe1xyXG4gICAgICAgICAgICAgICAgICAgIGFycltqXSA9IHRoaXMucHZbal0gKyBhZGRlZEFtcHNbal0gKyAoLWFtcCArIGFtcCoyKkJNTWF0aC5yYW5kb20oKSkqcGVyYztcclxuICAgICAgICAgICAgICAgICAgICAvL2FycltqXSA9IHRoaXMucHZbal0gKyBhZGRlZEFtcHNbal0gKyAoLWFtcCArIGFtcCoyKnJuZCkqcGVyYztcclxuICAgICAgICAgICAgICAgICAgICAvL2FycltpXSA9IHRoaXMucHZbaV0gKyBhZGRlZEFtcCArIGFtcDEqcGVyYyArIGFtcDIqKDEtcGVyYyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gYXJyO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucHYgKyBhZGRlZEFtcHNbMF0gKyAoLWFtcCArIGFtcCoyKkJNTWF0aC5yYW5kb20oKSkqcGVyYztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0uYmluZCh0aGlzKTtcclxuXHJcbiAgICAgICAgdmFyIGxvb3BJbiA9IGZ1bmN0aW9uIGxvb3BJbih0eXBlLGR1cmF0aW9uLCBkdXJhdGlvbkZsYWcpIHtcclxuICAgICAgICAgICAgaWYoIXRoaXMuayl7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5wdjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB2YXIgY3VycmVudEZyYW1lID0gdGltZSplbGVtLmNvbXAuZ2xvYmFsRGF0YS5mcmFtZVJhdGU7XHJcbiAgICAgICAgICAgIHZhciBrZXlmcmFtZXMgPSB0aGlzLmtleWZyYW1lcztcclxuICAgICAgICAgICAgdmFyIGZpcnN0S2V5RnJhbWUgPSBrZXlmcmFtZXNbMF0udDtcclxuICAgICAgICAgICAgaWYoY3VycmVudEZyYW1lPj1maXJzdEtleUZyYW1lKXtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnB2O1xyXG4gICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgIHZhciBjeWNsZUR1cmF0aW9uLCBsYXN0S2V5RnJhbWU7XHJcbiAgICAgICAgICAgICAgICBpZighZHVyYXRpb25GbGFnKXtcclxuICAgICAgICAgICAgICAgICAgICBpZighZHVyYXRpb24gfHwgZHVyYXRpb24gPiBrZXlmcmFtZXMubGVuZ3RoIC0gMSl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uID0ga2V5ZnJhbWVzLmxlbmd0aCAtIDE7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGxhc3RLZXlGcmFtZSA9IGtleWZyYW1lc1tkdXJhdGlvbl0udDtcclxuICAgICAgICAgICAgICAgICAgICBjeWNsZUR1cmF0aW9uID0gbGFzdEtleUZyYW1lIC0gZmlyc3RLZXlGcmFtZTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYoIWR1cmF0aW9uKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY3ljbGVEdXJhdGlvbiA9IE1hdGgubWF4KDAsdGhpcy5lbGVtLmRhdGEub3AgLSBmaXJzdEtleUZyYW1lKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjeWNsZUR1cmF0aW9uID0gTWF0aC5hYnMoZWxlbS5jb21wLmdsb2JhbERhdGEuZnJhbWVSYXRlKmR1cmF0aW9uKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgbGFzdEtleUZyYW1lID0gZmlyc3RLZXlGcmFtZSArIGN5Y2xlRHVyYXRpb247XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB2YXIgaSwgbGVuLCByZXQ7XHJcbiAgICAgICAgICAgICAgICBpZih0eXBlID09PSAncGluZ3BvbmcnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGl0ZXJhdGlvbnMgPSBNYXRoLmZsb29yKChmaXJzdEtleUZyYW1lIC0gY3VycmVudEZyYW1lKS9jeWNsZUR1cmF0aW9uKTtcclxuICAgICAgICAgICAgICAgICAgICBpZihpdGVyYXRpb25zICUgMiA9PT0gMCl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmdldFZhbHVlQXRUaW1lKCgoZmlyc3RLZXlGcmFtZSAtIGN1cnJlbnRGcmFtZSklY3ljbGVEdXJhdGlvbiArICBmaXJzdEtleUZyYW1lKSAvIHRoaXMuY29tcC5nbG9iYWxEYXRhLmZyYW1lUmF0ZSwgMCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmKHR5cGUgPT09ICdvZmZzZXQnKXtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgaW5pdFYgPSB0aGlzLmdldFZhbHVlQXRUaW1lKGZpcnN0S2V5RnJhbWUgLyB0aGlzLmNvbXAuZ2xvYmFsRGF0YS5mcmFtZVJhdGUsIDApO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBlbmRWID0gdGhpcy5nZXRWYWx1ZUF0VGltZShsYXN0S2V5RnJhbWUgLyB0aGlzLmNvbXAuZ2xvYmFsRGF0YS5mcmFtZVJhdGUsIDApO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBjdXJyZW50ID0gdGhpcy5nZXRWYWx1ZUF0VGltZSgoY3ljbGVEdXJhdGlvbiAtIChmaXJzdEtleUZyYW1lIC0gY3VycmVudEZyYW1lKSVjeWNsZUR1cmF0aW9uICsgIGZpcnN0S2V5RnJhbWUpIC8gdGhpcy5jb21wLmdsb2JhbERhdGEuZnJhbWVSYXRlLCAwKTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgcmVwZWF0cyA9IE1hdGguZmxvb3IoKGZpcnN0S2V5RnJhbWUgLSBjdXJyZW50RnJhbWUpL2N5Y2xlRHVyYXRpb24pKzE7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYodGhpcy5wdi5sZW5ndGgpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXQgPSBuZXcgQXJyYXkoaW5pdFYubGVuZ3RoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGVuID0gcmV0Lmxlbmd0aDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yKGk9MDtpPGxlbjtpKz0xKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldFtpXSA9IGN1cnJlbnRbaV0tKGVuZFZbaV0taW5pdFZbaV0pKnJlcGVhdHM7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGN1cnJlbnQtKGVuZFYtaW5pdFYpKnJlcGVhdHM7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYodHlwZSA9PT0gJ2NvbnRpbnVlJyl7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGZpcnN0VmFsdWUgPSB0aGlzLmdldFZhbHVlQXRUaW1lKGZpcnN0S2V5RnJhbWUgLyB0aGlzLmNvbXAuZ2xvYmFsRGF0YS5mcmFtZVJhdGUsIDApO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBuZXh0Rmlyc3RWYWx1ZSA9IHRoaXMuZ2V0VmFsdWVBdFRpbWUoKGZpcnN0S2V5RnJhbWUgKyAwLjAwMSkgLyB0aGlzLmNvbXAuZ2xvYmFsRGF0YS5mcmFtZVJhdGUsIDApO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmKHRoaXMucHYubGVuZ3RoKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0ID0gbmV3IEFycmF5KGZpcnN0VmFsdWUubGVuZ3RoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGVuID0gcmV0Lmxlbmd0aDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yKGk9MDtpPGxlbjtpKz0xKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldFtpXSA9IGZpcnN0VmFsdWVbaV0gKyAoZmlyc3RWYWx1ZVtpXS1uZXh0Rmlyc3RWYWx1ZVtpXSkqKGZpcnN0S2V5RnJhbWUgLSBjdXJyZW50RnJhbWUpLzAuMDAxO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXQ7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmaXJzdFZhbHVlICsgKGZpcnN0VmFsdWUtbmV4dEZpcnN0VmFsdWUpKihmaXJzdEtleUZyYW1lIC0gY3VycmVudEZyYW1lKS8wLjAwMTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmdldFZhbHVlQXRUaW1lKChjeWNsZUR1cmF0aW9uIC0gKGZpcnN0S2V5RnJhbWUgLSBjdXJyZW50RnJhbWUpICUgY3ljbGVEdXJhdGlvbiArICBmaXJzdEtleUZyYW1lKSAvIHRoaXMuY29tcC5nbG9iYWxEYXRhLmZyYW1lUmF0ZSwgMCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9LmJpbmQodGhpcyk7XHJcblxyXG4gICAgICAgIHZhciBsb29wSW5EdXJhdGlvbiA9IGZ1bmN0aW9uIGxvb3BJbkR1cmF0aW9uKHR5cGUsZHVyYXRpb24pe1xyXG4gICAgICAgICAgICByZXR1cm4gbG9vcEluKHR5cGUsZHVyYXRpb24sdHJ1ZSk7XHJcbiAgICAgICAgfS5iaW5kKHRoaXMpO1xyXG5cclxuICAgICAgICB2YXIgbG9vcE91dCA9IGZ1bmN0aW9uIGxvb3BPdXQodHlwZSxkdXJhdGlvbixkdXJhdGlvbkZsYWcpe1xyXG4gICAgICAgICAgICBpZighdGhpcy5rIHx8ICF0aGlzLmtleWZyYW1lcyl7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5wdjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB2YXIgY3VycmVudEZyYW1lID0gdGltZSplbGVtLmNvbXAuZ2xvYmFsRGF0YS5mcmFtZVJhdGU7XHJcbiAgICAgICAgICAgIHZhciBrZXlmcmFtZXMgPSB0aGlzLmtleWZyYW1lcztcclxuICAgICAgICAgICAgdmFyIGxhc3RLZXlGcmFtZSA9IGtleWZyYW1lc1trZXlmcmFtZXMubGVuZ3RoIC0gMV0udDtcclxuICAgICAgICAgICAgaWYoY3VycmVudEZyYW1lPD1sYXN0S2V5RnJhbWUpe1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucHY7XHJcbiAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgdmFyIGN5Y2xlRHVyYXRpb24sIGZpcnN0S2V5RnJhbWU7XHJcbiAgICAgICAgICAgICAgICBpZighZHVyYXRpb25GbGFnKXtcclxuICAgICAgICAgICAgICAgICAgICBpZighZHVyYXRpb24gfHwgZHVyYXRpb24gPiBrZXlmcmFtZXMubGVuZ3RoIC0gMSl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uID0ga2V5ZnJhbWVzLmxlbmd0aCAtIDE7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGZpcnN0S2V5RnJhbWUgPSBrZXlmcmFtZXNba2V5ZnJhbWVzLmxlbmd0aCAtIDEgLSBkdXJhdGlvbl0udDtcclxuICAgICAgICAgICAgICAgICAgICBjeWNsZUR1cmF0aW9uID0gbGFzdEtleUZyYW1lIC0gZmlyc3RLZXlGcmFtZTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYoIWR1cmF0aW9uKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY3ljbGVEdXJhdGlvbiA9IE1hdGgubWF4KDAsbGFzdEtleUZyYW1lIC0gdGhpcy5lbGVtLmRhdGEuaXApO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGN5Y2xlRHVyYXRpb24gPSBNYXRoLmFicyhsYXN0S2V5RnJhbWUgLSBlbGVtLmNvbXAuZ2xvYmFsRGF0YS5mcmFtZVJhdGUqZHVyYXRpb24pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBmaXJzdEtleUZyYW1lID0gbGFzdEtleUZyYW1lIC0gY3ljbGVEdXJhdGlvbjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHZhciBpLCBsZW4sIHJldDtcclxuICAgICAgICAgICAgICAgIGlmKHR5cGUgPT09ICdwaW5ncG9uZycpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgaXRlcmF0aW9ucyA9IE1hdGguZmxvb3IoKGN1cnJlbnRGcmFtZSAtIGZpcnN0S2V5RnJhbWUpL2N5Y2xlRHVyYXRpb24pO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmKGl0ZXJhdGlvbnMgJSAyICE9PSAwKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0VmFsdWVBdFRpbWUoKGN5Y2xlRHVyYXRpb24gLSAoY3VycmVudEZyYW1lIC0gZmlyc3RLZXlGcmFtZSkgJSBjeWNsZUR1cmF0aW9uICsgIGZpcnN0S2V5RnJhbWUpIC8gdGhpcy5jb21wLmdsb2JhbERhdGEuZnJhbWVSYXRlLCAwKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYodHlwZSA9PT0gJ29mZnNldCcpe1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBpbml0ViA9IHRoaXMuZ2V0VmFsdWVBdFRpbWUoZmlyc3RLZXlGcmFtZSAvIHRoaXMuY29tcC5nbG9iYWxEYXRhLmZyYW1lUmF0ZSwgMCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGVuZFYgPSB0aGlzLmdldFZhbHVlQXRUaW1lKGxhc3RLZXlGcmFtZSAvIHRoaXMuY29tcC5nbG9iYWxEYXRhLmZyYW1lUmF0ZSwgMCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGN1cnJlbnQgPSB0aGlzLmdldFZhbHVlQXRUaW1lKCgoY3VycmVudEZyYW1lIC0gZmlyc3RLZXlGcmFtZSkgJSBjeWNsZUR1cmF0aW9uICsgIGZpcnN0S2V5RnJhbWUpIC8gdGhpcy5jb21wLmdsb2JhbERhdGEuZnJhbWVSYXRlLCAwKTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgcmVwZWF0cyA9IE1hdGguZmxvb3IoKGN1cnJlbnRGcmFtZSAtIGZpcnN0S2V5RnJhbWUpL2N5Y2xlRHVyYXRpb24pO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmKHRoaXMucHYubGVuZ3RoKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0ID0gbmV3IEFycmF5KGluaXRWLmxlbmd0aCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxlbiA9IHJldC5sZW5ndGg7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvcihpPTA7aTxsZW47aSs9MSl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXRbaV0gPSAoZW5kVltpXS1pbml0VltpXSkqcmVwZWF0cyArIGN1cnJlbnRbaV07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChlbmRWLWluaXRWKSpyZXBlYXRzICsgY3VycmVudDtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZih0eXBlID09PSAnY29udGludWUnKXtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgbGFzdFZhbHVlID0gdGhpcy5nZXRWYWx1ZUF0VGltZShsYXN0S2V5RnJhbWUgLyB0aGlzLmNvbXAuZ2xvYmFsRGF0YS5mcmFtZVJhdGUsIDApO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBuZXh0TGFzdFZhbHVlID0gdGhpcy5nZXRWYWx1ZUF0VGltZSgobGFzdEtleUZyYW1lIC0gMC4wMDEpIC8gdGhpcy5jb21wLmdsb2JhbERhdGEuZnJhbWVSYXRlLCAwKTtcclxuICAgICAgICAgICAgICAgICAgICBpZih0aGlzLnB2Lmxlbmd0aCl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldCA9IG5ldyBBcnJheShsYXN0VmFsdWUubGVuZ3RoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGVuID0gcmV0Lmxlbmd0aDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yKGk9MDtpPGxlbjtpKz0xKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldFtpXSA9IGxhc3RWYWx1ZVtpXSArIChsYXN0VmFsdWVbaV0tbmV4dExhc3RWYWx1ZVtpXSkqKChjdXJyZW50RnJhbWUgLSBsYXN0S2V5RnJhbWUpLyB0aGlzLmNvbXAuZ2xvYmFsRGF0YS5mcmFtZVJhdGUpLzAuMDAwNTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0O1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbGFzdFZhbHVlICsgKGxhc3RWYWx1ZS1uZXh0TGFzdFZhbHVlKSooKChjdXJyZW50RnJhbWUgLSBsYXN0S2V5RnJhbWUpKS8wLjAwMSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRWYWx1ZUF0VGltZSgoKGN1cnJlbnRGcmFtZSAtIGZpcnN0S2V5RnJhbWUpICUgY3ljbGVEdXJhdGlvbiArICBmaXJzdEtleUZyYW1lKSAvIHRoaXMuY29tcC5nbG9iYWxEYXRhLmZyYW1lUmF0ZSwgMCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9LmJpbmQodGhpcyk7XHJcbiAgICAgICAgdmFyIGxvb3Bfb3V0ID0gbG9vcE91dDtcclxuXHJcbiAgICAgICAgdmFyIGxvb3BPdXREdXJhdGlvbiA9IGZ1bmN0aW9uIGxvb3BPdXREdXJhdGlvbih0eXBlLGR1cmF0aW9uKXtcclxuICAgICAgICAgICAgcmV0dXJuIGxvb3BPdXQodHlwZSxkdXJhdGlvbix0cnVlKTtcclxuICAgICAgICB9LmJpbmQodGhpcyk7XHJcblxyXG4gICAgICAgIHZhciB2YWx1ZUF0VGltZSA9IGZ1bmN0aW9uIHZhbHVlQXRUaW1lKHQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0VmFsdWVBdFRpbWUodCwgMCk7XHJcbiAgICAgICAgfS5iaW5kKHRoaXMpO1xyXG5cclxuICAgICAgICB2YXIgdmVsb2NpdHlBdFRpbWUgPSBmdW5jdGlvbiB2ZWxvY2l0eUF0VGltZSh0KSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmdldFZlbG9jaXR5QXRUaW1lKHQpO1xyXG4gICAgICAgIH0uYmluZCh0aGlzKTtcclxuXHJcbiAgICAgICAgdmFyIGNvbXAgPSBlbGVtLmNvbXAuZ2xvYmFsRGF0YS5wcm9qZWN0SW50ZXJmYWNlLmJpbmQoZWxlbS5jb21wLmdsb2JhbERhdGEucHJvamVjdEludGVyZmFjZSk7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGxvb2tBdChlbGVtMSxlbGVtMil7XHJcbiAgICAgICAgICAgIHZhciBmVmVjID0gW2VsZW0yWzBdLWVsZW0xWzBdLGVsZW0yWzFdLWVsZW0xWzFdLGVsZW0yWzJdLWVsZW0xWzJdXTtcclxuICAgICAgICAgICAgdmFyIHBpdGNoID0gTWF0aC5hdGFuMihmVmVjWzBdLE1hdGguc3FydChmVmVjWzFdKmZWZWNbMV0rZlZlY1syXSpmVmVjWzJdKSkvZGVnVG9SYWRzO1xyXG4gICAgICAgICAgICB2YXIgeWF3ID0gLU1hdGguYXRhbjIoZlZlY1sxXSxmVmVjWzJdKS9kZWdUb1JhZHM7XHJcbiAgICAgICAgICAgIHJldHVybiBbeWF3LHBpdGNoLDBdO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGVhc2VPdXQodCwgdmFsMSwgdmFsMil7XHJcbiAgICAgICAgICAgIHJldHVybiAtKHZhbDItdmFsMSkgKiB0Kih0LTIpICsgdmFsMTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBuZWFyZXN0S2V5KHRpbWUpe1xyXG4gICAgICAgICAgICB2YXIgaSwgbGVuID0gZGF0YS5rLmxlbmd0aCxpbmRleCxrZXlUaW1lO1xyXG4gICAgICAgICAgICBpZighZGF0YS5rLmxlbmd0aCB8fCB0eXBlb2YoZGF0YS5rWzBdKSA9PT0gJ251bWJlcicpe1xyXG4gICAgICAgICAgICAgICAgaW5kZXggPSAwO1xyXG4gICAgICAgICAgICAgICAga2V5VGltZSA9IDA7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBpbmRleCA9IC0xO1xyXG4gICAgICAgICAgICAgICAgdGltZSAqPSBlbGVtLmNvbXAuZ2xvYmFsRGF0YS5mcmFtZVJhdGU7XHJcbiAgICAgICAgICAgICAgICBpZiAodGltZSA8IGRhdGEua1swXS50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaW5kZXggPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgIGtleVRpbWUgPSBkYXRhLmtbMF0udDtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yKGk9MDtpPGxlbi0xO2krPTEpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZih0aW1lID09PSBkYXRhLmtbaV0udCl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmRleCA9IGkgKyAxO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAga2V5VGltZSA9IGRhdGEua1tpXS50O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1lbHNlIGlmKHRpbWU+ZGF0YS5rW2ldLnQgJiYgdGltZTxkYXRhLmtbaSsxXS50KXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKHRpbWUtZGF0YS5rW2ldLnQgPiBkYXRhLmtbaSsxXS50IC0gdGltZSl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXggPSBpICsgMjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBrZXlUaW1lID0gZGF0YS5rW2krMV0udDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXggPSBpICsgMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBrZXlUaW1lID0gZGF0YS5rW2ldLnQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZihpbmRleCA9PT0gLTEpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpbmRleCA9IGkgKyAxO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBrZXlUaW1lID0gZGF0YS5rW2ldLnQ7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdmFyIG9iID0ge307XHJcbiAgICAgICAgICAgIG9iLmluZGV4ID0gaW5kZXg7XHJcbiAgICAgICAgICAgIG9iLnRpbWUgPSBrZXlUaW1lL2VsZW0uY29tcC5nbG9iYWxEYXRhLmZyYW1lUmF0ZTtcclxuICAgICAgICAgICAgcmV0dXJuIG9iO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGtleShpbmQpe1xyXG4gICAgICAgICAgICBpZighZGF0YS5rLmxlbmd0aCB8fCB0eXBlb2YoZGF0YS5rWzBdKSA9PT0gJ251bWJlcicpe1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHt0aW1lOjB9O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGluZCAtPSAxO1xyXG4gICAgICAgICAgICB2YXIgb2IgPSB7XHJcbiAgICAgICAgICAgICAgICB0aW1lOiBkYXRhLmtbaW5kXS50L2VsZW0uY29tcC5nbG9iYWxEYXRhLmZyYW1lUmF0ZVxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB2YXIgYXJyO1xyXG4gICAgICAgICAgICBpZihpbmQgPT09IGRhdGEuay5sZW5ndGggLSAxICYmICFkYXRhLmtbaW5kXS5oKXtcclxuICAgICAgICAgICAgICAgIGFyciA9IGRhdGEua1tpbmQtMV0uZTtcclxuICAgICAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgICAgICBhcnIgPSBkYXRhLmtbaW5kXS5zO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZhciBpLCBsZW4gPSBhcnIubGVuZ3RoO1xyXG4gICAgICAgICAgICBmb3IoaT0wO2k8bGVuO2krPTEpe1xyXG4gICAgICAgICAgICAgICAgb2JbaV0gPSBhcnJbaV07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIG9iO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGZyYW1lc1RvVGltZShmcmFtZXMsZnBzKXtcclxuICAgICAgICAgICAgaWYoIWZwcyl7XHJcbiAgICAgICAgICAgICAgICBmcHMgPSBlbGVtLmNvbXAuZ2xvYmFsRGF0YS5mcmFtZVJhdGU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIGZyYW1lcy9mcHM7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gdGltZVRvRnJhbWVzKHQsZnBzKXtcclxuICAgICAgICAgICAgaWYoIXQpe1xyXG4gICAgICAgICAgICAgICAgdCA9IHRpbWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYoIWZwcyl7XHJcbiAgICAgICAgICAgICAgICBmcHMgPSBlbGVtLmNvbXAuZ2xvYmFsRGF0YS5mcmFtZVJhdGU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHQqZnBzO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHNlZWRSYW5kb20oc2VlZCl7XHJcbiAgICAgICAgICAgIEJNTWF0aC5zZWVkcmFuZG9tKHJhbmRTZWVkICsgc2VlZCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHRpbWUsdmVsb2NpdHksIHZhbHVlLHRleHRJbmRleCx0ZXh0VG90YWwsc2VsZWN0b3JWYWx1ZTtcclxuICAgICAgICB2YXIgaW5kZXggPSBlbGVtLmRhdGEuaW5kO1xyXG4gICAgICAgIHZhciBoYXNQYXJlbnQgPSAhIShlbGVtLmhpZXJhcmNoeSAmJiBlbGVtLmhpZXJhcmNoeS5sZW5ndGgpO1xyXG4gICAgICAgIHZhciBwYXJlbnQ7XHJcbiAgICAgICAgdmFyIHJhbmRTZWVkID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpKjEwMDAwMDApO1xyXG4gICAgICAgIGZ1bmN0aW9uIGV4ZWN1dGUoKXtcclxuICAgICAgICAgICAgaWYoX25lZWRzUmFuZG9tKXtcclxuICAgICAgICAgICAgICAgIHNlZWRSYW5kb20ocmFuZFNlZWQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmKHRoaXMuZnJhbWVFeHByZXNzaW9uSWQgPT09IGVsZW0uZ2xvYmFsRGF0YS5mcmFtZUlkICYmIHRoaXMudHlwZSAhPT0gJ3RleHRTZWxlY3Rvcicpe1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmKHRoaXMubG9jayl7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnYgPSBkdXBsaWNhdGVQcm9wZXJ0eVZhbHVlKHRoaXMucHYsdGhpcy5tdWx0KTtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmKHRoaXMudHlwZSA9PT0gJ3RleHRTZWxlY3Rvcicpe1xyXG4gICAgICAgICAgICAgICAgdGV4dEluZGV4ID0gdGhpcy50ZXh0SW5kZXg7XHJcbiAgICAgICAgICAgICAgICB0ZXh0VG90YWwgPSB0aGlzLnRleHRUb3RhbDtcclxuICAgICAgICAgICAgICAgIHNlbGVjdG9yVmFsdWUgPSB0aGlzLnNlbGVjdG9yVmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYoIXRoaXNMYXllcil7XHJcbiAgICAgICAgICAgICAgICB0aGlzTGF5ZXIgPSBlbGVtLmxheWVySW50ZXJmYWNlO1xyXG4gICAgICAgICAgICAgICAgdGhpc0NvbXAgPSBlbGVtLmNvbXAuY29tcEludGVyZmFjZTtcclxuICAgICAgICAgICAgICAgIHRvV29ybGQgPSB0aGlzTGF5ZXIudG9Xb3JsZC5iaW5kKHRoaXNMYXllcik7XHJcbiAgICAgICAgICAgICAgICBmcm9tV29ybGQgPSB0aGlzTGF5ZXIuZnJvbVdvcmxkLmJpbmQodGhpc0xheWVyKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZighdHJhbnNmb3JtKXtcclxuICAgICAgICAgICAgICAgIHRyYW5zZm9ybSA9IGVsZW0ubGF5ZXJJbnRlcmZhY2UoXCJBREJFIFRyYW5zZm9ybSBHcm91cFwiKTtcclxuICAgICAgICAgICAgICAgIGFuY2hvclBvaW50ID0gdHJhbnNmb3JtLmFuY2hvclBvaW50O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBpZihlbGVtVHlwZSA9PT0gNCAmJiAhY29udGVudCl7XHJcbiAgICAgICAgICAgICAgICBjb250ZW50ID0gdGhpc0xheWVyKFwiQURCRSBSb290IFZlY3RvcnMgR3JvdXBcIik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYoIWVmZmVjdCl7XHJcbiAgICAgICAgICAgICAgICBlZmZlY3QgPSB0aGlzTGF5ZXIoNCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaGFzUGFyZW50ID0gISEoZWxlbS5oaWVyYXJjaHkgJiYgZWxlbS5oaWVyYXJjaHkubGVuZ3RoKTtcclxuICAgICAgICAgICAgaWYoaGFzUGFyZW50ICYmICFwYXJlbnQpe1xyXG4gICAgICAgICAgICAgICAgcGFyZW50ID0gZWxlbS5oaWVyYXJjaHlbMF0ubGF5ZXJJbnRlcmZhY2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5sb2NrID0gdHJ1ZTtcclxuICAgICAgICAgICAgaWYodGhpcy5nZXRQcmVWYWx1ZSl7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmdldFByZVZhbHVlKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdmFsdWUgPSB0aGlzLnB2O1xyXG4gICAgICAgICAgICB0aW1lID0gdGhpcy5jb21wLnJlbmRlcmVkRnJhbWUvdGhpcy5jb21wLmdsb2JhbERhdGEuZnJhbWVSYXRlO1xyXG4gICAgICAgICAgICBpZihuZWVkc1ZlbG9jaXR5KXtcclxuICAgICAgICAgICAgICAgIHZlbG9jaXR5ID0gdmVsb2NpdHlBdFRpbWUodGltZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgYmluZGVkRm4oKTtcclxuICAgICAgICAgICAgdGhpcy5mcmFtZUV4cHJlc3Npb25JZCA9IGVsZW0uZ2xvYmFsRGF0YS5mcmFtZUlkO1xyXG4gICAgICAgICAgICB2YXIgaSxsZW47XHJcbiAgICAgICAgICAgIGlmKHRoaXMubXVsdCl7XHJcbiAgICAgICAgICAgICAgICBpZih0eXBlb2YgdGhpcy52ID09PSAnbnVtYmVyJyB8fCB0aGlzLnYgaW5zdGFuY2VvZiBOdW1iZXIgfHwgdHlwZW9mIHRoaXMudiA9PT0gJ3N0cmluZycpe1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudiAqPSB0aGlzLm11bHQ7XHJcbiAgICAgICAgICAgICAgICB9ZWxzZSBpZih0aGlzLnYubGVuZ3RoID09PSAxKXtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnYgPSB0aGlzLnZbMF0gKiB0aGlzLm11bHQ7XHJcbiAgICAgICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgICAgICBsZW4gPSB0aGlzLnYubGVuZ3RoO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmKHZhbHVlID09PSB0aGlzLnYpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnYgPSBsZW4gPT09IDIgPyBbdmFsdWVbMF0sdmFsdWVbMV1dIDogW3ZhbHVlWzBdLHZhbHVlWzFdLHZhbHVlWzJdXTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yKGkgPSAwOyBpIDwgbGVuOyBpICs9IDEpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnZbaV0gKj0gdGhpcy5tdWx0O1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYodGhpcy52Lmxlbmd0aCA9PT0gMSl7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnYgPSB0aGlzLnZbMF07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYodHlwZW9mIHRoaXMudiA9PT0gJ251bWJlcicgfHwgdGhpcy52IGluc3RhbmNlb2YgTnVtYmVyIHx8IHR5cGVvZiB0aGlzLnYgPT09ICdzdHJpbmcnKXtcclxuICAgICAgICAgICAgICAgIGlmKHRoaXMubGFzdFZhbHVlICE9PSB0aGlzLnYpe1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMubGFzdFZhbHVlID0gdGhpcy52O1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMubWRmID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfWVsc2UgaWYodGhpcy52Ll9sZW5ndGgpe1xyXG4gICAgICAgICAgICAgICAgaWYoIXNoYXBlc0VxdWFsKHRoaXMudix0aGlzLmxvY2FsU2hhcGVDb2xsZWN0aW9uLnNoYXBlc1swXSkpe1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMubWRmID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmxvY2FsU2hhcGVDb2xsZWN0aW9uLnJlbGVhc2VTaGFwZXMoKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmxvY2FsU2hhcGVDb2xsZWN0aW9uLmFkZFNoYXBlKHNoYXBlX3Bvb2wuY2xvbmUodGhpcy52KSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgbGVuID0gdGhpcy52Lmxlbmd0aDtcclxuICAgICAgICAgICAgICAgIGZvcihpID0gMDsgaSA8IGxlbjsgaSArPSAxKXtcclxuICAgICAgICAgICAgICAgICAgICBpZih0aGlzLnZbaV0gIT09IHRoaXMubGFzdFZhbHVlW2ldKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sYXN0VmFsdWVbaV0gPSB0aGlzLnZbaV07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubWRmID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5sb2NrID0gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBleGVjdXRlO1xyXG4gICAgfTtcclxuXHJcbiAgICBvYi5pbml0aWF0ZUV4cHJlc3Npb24gPSBpbml0aWF0ZUV4cHJlc3Npb247XHJcbiAgICByZXR1cm4gb2I7XHJcbn0oKSk7XG52YXIgU2hhcGVFeHByZXNzaW9uSW50ZXJmYWNlID0gKGZ1bmN0aW9uKCl7XHJcbiAgICB2YXIgb2IgPSB7XHJcbiAgICAgICAgY3JlYXRlU2hhcGVJbnRlcmZhY2U6Y3JlYXRlU2hhcGVJbnRlcmZhY2UsXHJcbiAgICAgICAgY3JlYXRlR3JvdXBJbnRlcmZhY2U6Y3JlYXRlR3JvdXBJbnRlcmZhY2UsXHJcbiAgICAgICAgY3JlYXRlVHJpbUludGVyZmFjZTpjcmVhdGVUcmltSW50ZXJmYWNlLFxyXG4gICAgICAgIGNyZWF0ZVN0cm9rZUludGVyZmFjZTpjcmVhdGVTdHJva2VJbnRlcmZhY2UsXHJcbiAgICAgICAgY3JlYXRlVHJhbnNmb3JtSW50ZXJmYWNlOmNyZWF0ZVRyYW5zZm9ybUludGVyZmFjZSxcclxuICAgICAgICBjcmVhdGVFbGxpcHNlSW50ZXJmYWNlOmNyZWF0ZUVsbGlwc2VJbnRlcmZhY2UsXHJcbiAgICAgICAgY3JlYXRlU3RhckludGVyZmFjZTpjcmVhdGVTdGFySW50ZXJmYWNlLFxyXG4gICAgICAgIGNyZWF0ZVJlY3RJbnRlcmZhY2U6Y3JlYXRlUmVjdEludGVyZmFjZSxcclxuICAgICAgICBjcmVhdGVSb3VuZGVkSW50ZXJmYWNlOmNyZWF0ZVJvdW5kZWRJbnRlcmZhY2UsXHJcbiAgICAgICAgY3JlYXRlUmVwYXRlYXJJbnRlcmZhY2U6Y3JlYXRlUmVwYXRlYXJJbnRlcmZhY2UsXHJcbiAgICAgICAgY3JlYXRlUGF0aEludGVyZmFjZTpjcmVhdGVQYXRoSW50ZXJmYWNlLFxyXG4gICAgICAgIGNyZWF0ZUZpbGxJbnRlcmZhY2U6Y3JlYXRlRmlsbEludGVyZmFjZVxyXG4gICAgfTtcclxuICAgIGZ1bmN0aW9uIGNyZWF0ZVNoYXBlSW50ZXJmYWNlKHNoYXBlcyx2aWV3LHByb3BlcnR5R3JvdXApe1xyXG4gICAgICAgIHJldHVybiBzaGFwZUludGVyZmFjZUZhY3Rvcnkoc2hhcGVzLHZpZXcscHJvcGVydHlHcm91cCk7XHJcbiAgICB9XHJcbiAgICBmdW5jdGlvbiBjcmVhdGVHcm91cEludGVyZmFjZShzaGFwZXMsdmlldyxwcm9wZXJ0eUdyb3VwKXtcclxuICAgICAgICByZXR1cm4gZ3JvdXBJbnRlcmZhY2VGYWN0b3J5KHNoYXBlcyx2aWV3LHByb3BlcnR5R3JvdXApO1xyXG4gICAgfVxyXG4gICAgZnVuY3Rpb24gY3JlYXRlRmlsbEludGVyZmFjZShzaGFwZSx2aWV3LHByb3BlcnR5R3JvdXApe1xyXG4gICAgICAgIHJldHVybiBmaWxsSW50ZXJmYWNlRmFjdG9yeShzaGFwZSx2aWV3LHByb3BlcnR5R3JvdXApO1xyXG4gICAgfVxyXG4gICAgZnVuY3Rpb24gY3JlYXRlU3Ryb2tlSW50ZXJmYWNlKHNoYXBlLHZpZXcscHJvcGVydHlHcm91cCl7XHJcbiAgICAgICAgcmV0dXJuIHN0cm9rZUludGVyZmFjZUZhY3Rvcnkoc2hhcGUsdmlldyxwcm9wZXJ0eUdyb3VwKTtcclxuICAgIH1cclxuICAgIGZ1bmN0aW9uIGNyZWF0ZVRyaW1JbnRlcmZhY2Uoc2hhcGUsdmlldyxwcm9wZXJ0eUdyb3VwKXtcclxuICAgICAgICByZXR1cm4gdHJpbUludGVyZmFjZUZhY3Rvcnkoc2hhcGUsdmlldyxwcm9wZXJ0eUdyb3VwKTtcclxuICAgIH1cclxuICAgIGZ1bmN0aW9uIGNyZWF0ZVRyYW5zZm9ybUludGVyZmFjZShzaGFwZSx2aWV3LHByb3BlcnR5R3JvdXApe1xyXG4gICAgICAgIHJldHVybiB0cmFuc2Zvcm1JbnRlcmZhY2VGYWN0b3J5KHNoYXBlLHZpZXcscHJvcGVydHlHcm91cCk7XHJcbiAgICB9XHJcbiAgICBmdW5jdGlvbiBjcmVhdGVFbGxpcHNlSW50ZXJmYWNlKHNoYXBlLHZpZXcscHJvcGVydHlHcm91cCl7XHJcbiAgICAgICAgcmV0dXJuIGVsbGlwc2VJbnRlcmZhY2VGYWN0b3J5KHNoYXBlLHZpZXcscHJvcGVydHlHcm91cCk7XHJcbiAgICB9XHJcbiAgICBmdW5jdGlvbiBjcmVhdGVTdGFySW50ZXJmYWNlKHNoYXBlLHZpZXcscHJvcGVydHlHcm91cCl7XHJcbiAgICAgICAgcmV0dXJuIHN0YXJJbnRlcmZhY2VGYWN0b3J5KHNoYXBlLHZpZXcscHJvcGVydHlHcm91cCk7XHJcbiAgICB9XHJcbiAgICBmdW5jdGlvbiBjcmVhdGVSZWN0SW50ZXJmYWNlKHNoYXBlLHZpZXcscHJvcGVydHlHcm91cCl7XHJcbiAgICAgICAgcmV0dXJuIHJlY3RJbnRlcmZhY2VGYWN0b3J5KHNoYXBlLHZpZXcscHJvcGVydHlHcm91cCk7XHJcbiAgICB9XHJcbiAgICBmdW5jdGlvbiBjcmVhdGVSb3VuZGVkSW50ZXJmYWNlKHNoYXBlLHZpZXcscHJvcGVydHlHcm91cCl7XHJcbiAgICAgICAgcmV0dXJuIHJvdW5kZWRJbnRlcmZhY2VGYWN0b3J5KHNoYXBlLHZpZXcscHJvcGVydHlHcm91cCk7XHJcbiAgICB9XHJcbiAgICBmdW5jdGlvbiBjcmVhdGVSZXBhdGVhckludGVyZmFjZShzaGFwZSx2aWV3LHByb3BlcnR5R3JvdXApe1xyXG4gICAgICAgIHJldHVybiByZXBlYXRlckludGVyZmFjZUZhY3Rvcnkoc2hhcGUsdmlldyxwcm9wZXJ0eUdyb3VwKTtcclxuICAgIH1cclxuICAgIGZ1bmN0aW9uIGNyZWF0ZVBhdGhJbnRlcmZhY2Uoc2hhcGUsdmlldyxwcm9wZXJ0eUdyb3VwKXtcclxuICAgICAgICByZXR1cm4gcGF0aEludGVyZmFjZUZhY3Rvcnkoc2hhcGUsdmlldyxwcm9wZXJ0eUdyb3VwKTtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBpdGVyYXRlRWxlbWVudHMoc2hhcGVzLHZpZXcsIHByb3BlcnR5R3JvdXApe1xyXG4gICAgICAgIHZhciBhcnIgPSBbXTtcclxuICAgICAgICB2YXIgaSwgbGVuID0gc2hhcGVzID8gc2hhcGVzLmxlbmd0aCA6IDA7XHJcbiAgICAgICAgZm9yKGk9MDtpPGxlbjtpKz0xKXtcclxuICAgICAgICAgICAgaWYoc2hhcGVzW2ldLnR5ID09ICdncicpe1xyXG4gICAgICAgICAgICAgICAgYXJyLnB1c2goU2hhcGVFeHByZXNzaW9uSW50ZXJmYWNlLmNyZWF0ZUdyb3VwSW50ZXJmYWNlKHNoYXBlc1tpXSx2aWV3W2ldLHByb3BlcnR5R3JvdXApKTtcclxuICAgICAgICAgICAgfWVsc2UgaWYoc2hhcGVzW2ldLnR5ID09ICdmbCcpe1xyXG4gICAgICAgICAgICAgICAgYXJyLnB1c2goU2hhcGVFeHByZXNzaW9uSW50ZXJmYWNlLmNyZWF0ZUZpbGxJbnRlcmZhY2Uoc2hhcGVzW2ldLHZpZXdbaV0scHJvcGVydHlHcm91cCkpO1xyXG4gICAgICAgICAgICB9ZWxzZSBpZihzaGFwZXNbaV0udHkgPT0gJ3N0Jyl7XHJcbiAgICAgICAgICAgICAgICBhcnIucHVzaChTaGFwZUV4cHJlc3Npb25JbnRlcmZhY2UuY3JlYXRlU3Ryb2tlSW50ZXJmYWNlKHNoYXBlc1tpXSx2aWV3W2ldLHByb3BlcnR5R3JvdXApKTtcclxuICAgICAgICAgICAgfWVsc2UgaWYoc2hhcGVzW2ldLnR5ID09ICd0bScpe1xyXG4gICAgICAgICAgICAgICAgYXJyLnB1c2goU2hhcGVFeHByZXNzaW9uSW50ZXJmYWNlLmNyZWF0ZVRyaW1JbnRlcmZhY2Uoc2hhcGVzW2ldLHZpZXdbaV0scHJvcGVydHlHcm91cCkpO1xyXG4gICAgICAgICAgICB9ZWxzZSBpZihzaGFwZXNbaV0udHkgPT0gJ3RyJyl7XHJcbiAgICAgICAgICAgICAgICAvL2Fyci5wdXNoKFNoYXBlRXhwcmVzc2lvbkludGVyZmFjZS5jcmVhdGVUcmFuc2Zvcm1JbnRlcmZhY2Uoc2hhcGVzW2ldLHZpZXdbaV0scHJvcGVydHlHcm91cCkpO1xyXG4gICAgICAgICAgICB9ZWxzZSBpZihzaGFwZXNbaV0udHkgPT0gJ2VsJyl7XHJcbiAgICAgICAgICAgICAgICBhcnIucHVzaChTaGFwZUV4cHJlc3Npb25JbnRlcmZhY2UuY3JlYXRlRWxsaXBzZUludGVyZmFjZShzaGFwZXNbaV0sdmlld1tpXSxwcm9wZXJ0eUdyb3VwKSk7XHJcbiAgICAgICAgICAgIH1lbHNlIGlmKHNoYXBlc1tpXS50eSA9PSAnc3InKXtcclxuICAgICAgICAgICAgICAgIGFyci5wdXNoKFNoYXBlRXhwcmVzc2lvbkludGVyZmFjZS5jcmVhdGVTdGFySW50ZXJmYWNlKHNoYXBlc1tpXSx2aWV3W2ldLHByb3BlcnR5R3JvdXApKTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmKHNoYXBlc1tpXS50eSA9PSAnc2gnKXtcclxuICAgICAgICAgICAgICAgIGFyci5wdXNoKFNoYXBlRXhwcmVzc2lvbkludGVyZmFjZS5jcmVhdGVQYXRoSW50ZXJmYWNlKHNoYXBlc1tpXSx2aWV3W2ldLHByb3BlcnR5R3JvdXApKTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmKHNoYXBlc1tpXS50eSA9PSAncmMnKXtcclxuICAgICAgICAgICAgICAgIGFyci5wdXNoKFNoYXBlRXhwcmVzc2lvbkludGVyZmFjZS5jcmVhdGVSZWN0SW50ZXJmYWNlKHNoYXBlc1tpXSx2aWV3W2ldLHByb3BlcnR5R3JvdXApKTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmKHNoYXBlc1tpXS50eSA9PSAncmQnKXtcclxuICAgICAgICAgICAgICAgIGFyci5wdXNoKFNoYXBlRXhwcmVzc2lvbkludGVyZmFjZS5jcmVhdGVSb3VuZGVkSW50ZXJmYWNlKHNoYXBlc1tpXSx2aWV3W2ldLHByb3BlcnR5R3JvdXApKTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmKHNoYXBlc1tpXS50eSA9PSAncnAnKXtcclxuICAgICAgICAgICAgICAgIGFyci5wdXNoKFNoYXBlRXhwcmVzc2lvbkludGVyZmFjZS5jcmVhdGVSZXBhdGVhckludGVyZmFjZShzaGFwZXNbaV0sdmlld1tpXSxwcm9wZXJ0eUdyb3VwKSk7XHJcbiAgICAgICAgICAgIH0gZWxzZXtcclxuICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coc2hhcGVzW2ldLnR5KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gYXJyO1xyXG4gICAgfVxyXG5cclxuICAgIHZhciBzaGFwZUludGVyZmFjZUZhY3RvcnkgPSAoZnVuY3Rpb24oKXtcclxuICAgICAgICByZXR1cm4gZnVuY3Rpb24oc2hhcGVzLHZpZXcscHJvcGVydHlHcm91cCl7XHJcbiAgICAgICAgICAgIHZhciBpbnRlcmZhY2VzO1xyXG4gICAgICAgICAgICBmdW5jdGlvbiBfaW50ZXJmYWNlRnVuY3Rpb24odmFsdWUpe1xyXG4gICAgICAgICAgICAgICAgaWYodHlwZW9mIHZhbHVlID09PSAnbnVtYmVyJyl7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGludGVyZmFjZXNbdmFsdWUtMV07XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBpID0gMCwgbGVuID0gaW50ZXJmYWNlcy5sZW5ndGg7XHJcbiAgICAgICAgICAgICAgICAgICAgd2hpbGUoaTxsZW4pe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZihpbnRlcmZhY2VzW2ldLl9uYW1lID09PSB2YWx1ZSl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaW50ZXJmYWNlc1tpXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpKz0xO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBfaW50ZXJmYWNlRnVuY3Rpb24ucHJvcGVydHlHcm91cCA9IHByb3BlcnR5R3JvdXA7XHJcbiAgICAgICAgICAgIGludGVyZmFjZXMgPSBpdGVyYXRlRWxlbWVudHMoc2hhcGVzLCB2aWV3LCBfaW50ZXJmYWNlRnVuY3Rpb24pO1xyXG4gICAgICAgICAgICByZXR1cm4gX2ludGVyZmFjZUZ1bmN0aW9uO1xyXG4gICAgICAgIH1cclxuICAgIH0oKSk7XHJcblxyXG4gICAgdmFyIGNvbnRlbnRzSW50ZXJmYWNlRmFjdG9yeSA9IChmdW5jdGlvbigpe1xyXG4gICAgICAgcmV0dXJuIGZ1bmN0aW9uKHNoYXBlLHZpZXcsIHByb3BlcnR5R3JvdXApe1xyXG4gICAgICAgICAgIHZhciBpbnRlcmZhY2VzO1xyXG4gICAgICAgICAgIHZhciBpbnRlcmZhY2VGdW5jdGlvbiA9IGZ1bmN0aW9uIF9pbnRlcmZhY2VGdW5jdGlvbih2YWx1ZSl7XHJcbiAgICAgICAgICAgICAgIHZhciBpID0gMCwgbGVuID0gaW50ZXJmYWNlcy5sZW5ndGg7XHJcbiAgICAgICAgICAgICAgICB3aGlsZShpPGxlbil7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYoaW50ZXJmYWNlc1tpXS5fbmFtZSA9PT0gdmFsdWUgfHwgaW50ZXJmYWNlc1tpXS5tbiA9PT0gdmFsdWUgfHwgaW50ZXJmYWNlc1tpXS5wcm9wZXJ0eUluZGV4ID09PSB2YWx1ZSB8fCBpbnRlcmZhY2VzW2ldLml4ID09PSB2YWx1ZSB8fCBpbnRlcmZhY2VzW2ldLmluZCA9PT0gdmFsdWUpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpbnRlcmZhY2VzW2ldO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpKz0xO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYodHlwZW9mIHZhbHVlID09PSAnbnVtYmVyJyl7XHJcbiAgICAgICAgICAgICAgICAgICByZXR1cm4gaW50ZXJmYWNlc1t2YWx1ZS0xXTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICB9O1xyXG4gICAgICAgICAgIGludGVyZmFjZUZ1bmN0aW9uLnByb3BlcnR5R3JvdXAgPSBmdW5jdGlvbih2YWwpe1xyXG4gICAgICAgICAgICAgICBpZih2YWwgPT09IDEpe1xyXG4gICAgICAgICAgICAgICAgICAgcmV0dXJuIGludGVyZmFjZUZ1bmN0aW9uO1xyXG4gICAgICAgICAgICAgICB9IGVsc2V7XHJcbiAgICAgICAgICAgICAgICAgICByZXR1cm4gcHJvcGVydHlHcm91cCh2YWwtMSk7XHJcbiAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICB9O1xyXG4gICAgICAgICAgIGludGVyZmFjZXMgPSBpdGVyYXRlRWxlbWVudHMoc2hhcGUuaXQsIHZpZXcuaXQsIGludGVyZmFjZUZ1bmN0aW9uLnByb3BlcnR5R3JvdXApO1xyXG4gICAgICAgICAgIGludGVyZmFjZUZ1bmN0aW9uLm51bVByb3BlcnRpZXMgPSBpbnRlcmZhY2VzLmxlbmd0aDtcclxuICAgICAgICAgICBpbnRlcmZhY2VGdW5jdGlvbi5wcm9wZXJ0eUluZGV4ID0gc2hhcGUuY2l4O1xyXG5cclxuICAgICAgICAgICByZXR1cm4gaW50ZXJmYWNlRnVuY3Rpb247XHJcbiAgICAgICB9XHJcbiAgICB9KCkpO1xyXG5cclxuICAgIHZhciBncm91cEludGVyZmFjZUZhY3RvcnkgPSAoZnVuY3Rpb24oKXtcclxuICAgICAgICByZXR1cm4gZnVuY3Rpb24oc2hhcGUsdmlldywgcHJvcGVydHlHcm91cCl7XHJcbiAgICAgICAgICAgIHZhciBpbnRlcmZhY2VGdW5jdGlvbiA9IGZ1bmN0aW9uIF9pbnRlcmZhY2VGdW5jdGlvbih2YWx1ZSl7XHJcbiAgICAgICAgICAgICAgICBzd2l0Y2godmFsdWUpe1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ0FEQkUgVmVjdG9ycyBHcm91cCc6XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnQ29udGVudHMnOlxyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMjpcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGludGVyZmFjZUZ1bmN0aW9uLmNvbnRlbnQ7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnQURCRSBWZWN0b3IgVHJhbnNmb3JtIEdyb3VwJzpcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIDM6XHJcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGludGVyZmFjZUZ1bmN0aW9uLnRyYW5zZm9ybTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIC8qaWYodmFsdWUgPT09ICdBREJFIFZlY3RvciBUcmFuc2Zvcm0gR3JvdXAnKXtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gaW50ZXJmYWNlRnVuY3Rpb24udHJhbnNmb3JtO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBpID0gMCwgbGVuID0gaW50ZXJmYWNlcy5sZW5ndGg7XHJcbiAgICAgICAgICAgICAgICAgICAgd2hpbGUoaTxsZW4pe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZihpbnRlcmZhY2VzW2ldLnR5ID09PSAndHInKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpbnRlcmZhY2VzW2ldO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGkrPTE7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYodHlwZW9mIHZhbHVlID09PSAnbnVtYmVyJyl7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGludGVyZmFjZXNbdmFsdWUtMV07XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBpID0gMCwgbGVuID0gaW50ZXJmYWNlcy5sZW5ndGg7XHJcbiAgICAgICAgICAgICAgICAgICAgd2hpbGUoaTxsZW4pe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZihpbnRlcmZhY2VzW2ldLl9uYW1lID09PSB2YWx1ZSl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaW50ZXJmYWNlc1tpXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpKz0xO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0qL1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGludGVyZmFjZUZ1bmN0aW9uLnByb3BlcnR5R3JvdXAgPSBmdW5jdGlvbih2YWwpe1xyXG4gICAgICAgICAgICAgICAgaWYodmFsID09PSAxKXtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gaW50ZXJmYWNlRnVuY3Rpb247XHJcbiAgICAgICAgICAgICAgICB9IGVsc2V7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHByb3BlcnR5R3JvdXAodmFsLTEpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB2YXIgY29udGVudCA9IGNvbnRlbnRzSW50ZXJmYWNlRmFjdG9yeShzaGFwZSx2aWV3LGludGVyZmFjZUZ1bmN0aW9uLnByb3BlcnR5R3JvdXApO1xyXG4gICAgICAgICAgICB2YXIgdHJhbnNmb3JtSW50ZXJmYWNlID0gU2hhcGVFeHByZXNzaW9uSW50ZXJmYWNlLmNyZWF0ZVRyYW5zZm9ybUludGVyZmFjZShzaGFwZS5pdFtzaGFwZS5pdC5sZW5ndGggLSAxXSx2aWV3Lml0W3ZpZXcuaXQubGVuZ3RoIC0gMV0saW50ZXJmYWNlRnVuY3Rpb24ucHJvcGVydHlHcm91cCk7XHJcbiAgICAgICAgICAgIGludGVyZmFjZUZ1bmN0aW9uLmNvbnRlbnQgPSBjb250ZW50O1xyXG4gICAgICAgICAgICBpbnRlcmZhY2VGdW5jdGlvbi50cmFuc2Zvcm0gPSB0cmFuc2Zvcm1JbnRlcmZhY2U7XHJcbiAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShpbnRlcmZhY2VGdW5jdGlvbiwgJ19uYW1lJywge1xyXG4gICAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBzaGFwZS5ubTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIC8vaW50ZXJmYWNlRnVuY3Rpb24uY29udGVudCA9IGludGVyZmFjZUZ1bmN0aW9uO1xyXG4gICAgICAgICAgICBpbnRlcmZhY2VGdW5jdGlvbi5udW1Qcm9wZXJ0aWVzID0gc2hhcGUubnA7XHJcbiAgICAgICAgICAgIGludGVyZmFjZUZ1bmN0aW9uLnByb3BlcnR5SW5kZXggPSBzaGFwZS5peDtcclxuICAgICAgICAgICAgaW50ZXJmYWNlRnVuY3Rpb24ubm0gPSBzaGFwZS5ubTtcclxuICAgICAgICAgICAgaW50ZXJmYWNlRnVuY3Rpb24ubW4gPSBzaGFwZS5tbjtcclxuICAgICAgICAgICAgcmV0dXJuIGludGVyZmFjZUZ1bmN0aW9uO1xyXG4gICAgICAgIH1cclxuICAgIH0oKSk7XHJcblxyXG4gICAgdmFyIGZpbGxJbnRlcmZhY2VGYWN0b3J5ID0gKGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKHNoYXBlLHZpZXcscHJvcGVydHlHcm91cCl7XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBpbnRlcmZhY2VGdW5jdGlvbih2YWwpe1xyXG4gICAgICAgICAgICAgICAgaWYodmFsID09PSAnQ29sb3InIHx8IHZhbCA9PT0gJ2NvbG9yJyl7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGludGVyZmFjZUZ1bmN0aW9uLmNvbG9yO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmKHZhbCA9PT0gJ09wYWNpdHknIHx8IHZhbCA9PT0gJ29wYWNpdHknKXtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gaW50ZXJmYWNlRnVuY3Rpb24ub3BhY2l0eTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoaW50ZXJmYWNlRnVuY3Rpb24sICdjb2xvcicsIHtcclxuICAgICAgICAgICAgICAgIGdldDogZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gRXhwcmVzc2lvblZhbHVlKHZpZXcuYywgMSAvIHZpZXcuYy5tdWx0LCAnY29sb3InKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShpbnRlcmZhY2VGdW5jdGlvbiwgJ29wYWNpdHknLCB7XHJcbiAgICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEV4cHJlc3Npb25WYWx1ZSh2aWV3Lm8sIDEwMCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoaW50ZXJmYWNlRnVuY3Rpb24sICdfbmFtZScsIHsgdmFsdWU6IHNoYXBlLm5tIH0pO1xyXG4gICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoaW50ZXJmYWNlRnVuY3Rpb24sICdtbicsIHsgdmFsdWU6IHNoYXBlLm1uIH0pO1xyXG5cclxuICAgICAgICAgICAgdmlldy5jLnNldEdyb3VwUHJvcGVydHkocHJvcGVydHlHcm91cCk7XHJcbiAgICAgICAgICAgIHZpZXcuby5zZXRHcm91cFByb3BlcnR5KHByb3BlcnR5R3JvdXApO1xyXG4gICAgICAgICAgICByZXR1cm4gaW50ZXJmYWNlRnVuY3Rpb247XHJcbiAgICAgICAgfVxyXG4gICAgfSgpKTtcclxuXHJcbiAgICB2YXIgc3Ryb2tlSW50ZXJmYWNlRmFjdG9yeSA9IChmdW5jdGlvbigpe1xyXG4gICAgICAgIHJldHVybiBmdW5jdGlvbihzaGFwZSx2aWV3LHByb3BlcnR5R3JvdXApe1xyXG4gICAgICAgICAgICBmdW5jdGlvbiBfcHJvcGVydHlHcm91cCh2YWwpe1xyXG4gICAgICAgICAgICAgICAgaWYodmFsID09PSAxKXtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2I7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2V7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHByb3BlcnR5R3JvdXAodmFsLTEpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICBmdW5jdGlvbiBfZGFzaFByb3BlcnR5R3JvdXAodmFsKXtcclxuICAgICAgICAgICAgICAgIGlmKHZhbCA9PT0gMSl7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhc2hPYjtcclxuICAgICAgICAgICAgICAgIH0gZWxzZXtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gX3Byb3BlcnR5R3JvdXAodmFsLTEpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICBmdW5jdGlvbiBhZGRQcm9wZXJ0eVRvRGFzaE9iKGkpIHtcclxuICAgICAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShkYXNoT2IsIHNoYXBlLmRbaV0ubm0sIHtcclxuICAgICAgICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBFeHByZXNzaW9uVmFsdWUodmlldy5kLmRhdGFQcm9wc1tpXS5wKVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZhciBpLCBsZW4gPSBzaGFwZS5kID8gc2hhcGUuZC5sZW5ndGggOiAwO1xyXG4gICAgICAgICAgICB2YXIgZGFzaE9iID0ge31cclxuICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IGxlbjsgaSArPSAxKSB7XHJcbiAgICAgICAgICAgICAgICBhZGRQcm9wZXJ0eVRvRGFzaE9iKGkpO1xyXG4gICAgICAgICAgICAgICAgdmlldy5kLmRhdGFQcm9wc1tpXS5wLnNldEdyb3VwUHJvcGVydHkoX2Rhc2hQcm9wZXJ0eUdyb3VwKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gaW50ZXJmYWNlRnVuY3Rpb24odmFsKXtcclxuICAgICAgICAgICAgICAgIGlmKHZhbCA9PT0gJ0NvbG9yJyB8fCB2YWwgPT09ICdjb2xvcicpe1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBpbnRlcmZhY2VGdW5jdGlvbi5jb2xvcjtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZih2YWwgPT09ICdPcGFjaXR5JyB8fCB2YWwgPT09ICdvcGFjaXR5Jyl7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGludGVyZmFjZUZ1bmN0aW9uLm9wYWNpdHk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYodmFsID09PSAnU3Ryb2tlIFdpZHRoJyB8fCB2YWwgPT09ICdzdHJva2Ugd2lkdGgnKXtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gaW50ZXJmYWNlRnVuY3Rpb24uc3Ryb2tlV2lkdGg7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGludGVyZmFjZUZ1bmN0aW9uLCAnY29sb3InLCB7XHJcbiAgICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEV4cHJlc3Npb25WYWx1ZSh2aWV3LmMsIDEgLyB2aWV3LmMubXVsdCwgJ2NvbG9yJyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoaW50ZXJmYWNlRnVuY3Rpb24sICdvcGFjaXR5Jywge1xyXG4gICAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBFeHByZXNzaW9uVmFsdWUodmlldy5vLCAxMDApO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGludGVyZmFjZUZ1bmN0aW9uLCAnc3Ryb2tlV2lkdGgnLCB7XHJcbiAgICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEV4cHJlc3Npb25WYWx1ZSh2aWV3LncpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGludGVyZmFjZUZ1bmN0aW9uLCAnZGFzaCcsIHtcclxuICAgICAgICAgICAgICAgIGdldDogZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGFzaE9iO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGludGVyZmFjZUZ1bmN0aW9uLCAnX25hbWUnLCB7IHZhbHVlOiBzaGFwZS5ubSB9KTtcclxuICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGludGVyZmFjZUZ1bmN0aW9uLCAnbW4nLCB7IHZhbHVlOiBzaGFwZS5tbiB9KTtcclxuXHJcbiAgICAgICAgICAgIHZpZXcuYy5zZXRHcm91cFByb3BlcnR5KF9wcm9wZXJ0eUdyb3VwKTtcclxuICAgICAgICAgICAgdmlldy5vLnNldEdyb3VwUHJvcGVydHkoX3Byb3BlcnR5R3JvdXApO1xyXG4gICAgICAgICAgICB2aWV3Lncuc2V0R3JvdXBQcm9wZXJ0eShfcHJvcGVydHlHcm91cCk7XHJcbiAgICAgICAgICAgIHJldHVybiBpbnRlcmZhY2VGdW5jdGlvbjtcclxuICAgICAgICB9XHJcbiAgICB9KCkpO1xyXG5cclxuICAgIHZhciB0cmltSW50ZXJmYWNlRmFjdG9yeSA9IChmdW5jdGlvbigpe1xyXG4gICAgICAgIHJldHVybiBmdW5jdGlvbihzaGFwZSx2aWV3LHByb3BlcnR5R3JvdXApe1xyXG4gICAgICAgICAgICBmdW5jdGlvbiBfcHJvcGVydHlHcm91cCh2YWwpe1xyXG4gICAgICAgICAgICAgICAgaWYodmFsID09IDEpe1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBpbnRlcmZhY2VGdW5jdGlvbjtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHByb3BlcnR5R3JvdXAoLS12YWwpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGludGVyZmFjZUZ1bmN0aW9uLnByb3BlcnR5SW5kZXggPSBzaGFwZS5peDtcclxuXHJcbiAgICAgICAgICAgIHZpZXcucy5zZXRHcm91cFByb3BlcnR5KF9wcm9wZXJ0eUdyb3VwKTtcclxuICAgICAgICAgICAgdmlldy5lLnNldEdyb3VwUHJvcGVydHkoX3Byb3BlcnR5R3JvdXApO1xyXG4gICAgICAgICAgICB2aWV3Lm8uc2V0R3JvdXBQcm9wZXJ0eShfcHJvcGVydHlHcm91cCk7XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBpbnRlcmZhY2VGdW5jdGlvbih2YWwpe1xyXG4gICAgICAgICAgICAgICAgaWYodmFsID09PSBzaGFwZS5lLml4IHx8IHZhbCA9PT0gJ0VuZCcgfHwgdmFsID09PSAnZW5kJyl7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGludGVyZmFjZUZ1bmN0aW9uLmVuZDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmKHZhbCA9PT0gc2hhcGUucy5peCl7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGludGVyZmFjZUZ1bmN0aW9uLnN0YXJ0O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYodmFsID09PSBzaGFwZS5vLml4KXtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gaW50ZXJmYWNlRnVuY3Rpb24ub2Zmc2V0O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGludGVyZmFjZUZ1bmN0aW9uLnByb3BlcnR5SW5kZXggPSBzaGFwZS5peDtcclxuICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGludGVyZmFjZUZ1bmN0aW9uLCAnc3RhcnQnLCB7XHJcbiAgICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEV4cHJlc3Npb25WYWx1ZSh2aWV3LnMsIDEgLyB2aWV3LnMubXVsdCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoaW50ZXJmYWNlRnVuY3Rpb24sICdlbmQnLCB7XHJcbiAgICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEV4cHJlc3Npb25WYWx1ZSh2aWV3LmUsIDEgLyB2aWV3LmUubXVsdCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoaW50ZXJmYWNlRnVuY3Rpb24sICdvZmZzZXQnLCB7XHJcbiAgICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEV4cHJlc3Npb25WYWx1ZSh2aWV3Lm8pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGludGVyZmFjZUZ1bmN0aW9uLCAnX25hbWUnLCB7XHJcbiAgICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNoYXBlLm5tO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgaW50ZXJmYWNlRnVuY3Rpb24ubW4gPSBzaGFwZS5tbjtcclxuICAgICAgICAgICAgcmV0dXJuIGludGVyZmFjZUZ1bmN0aW9uO1xyXG4gICAgICAgIH1cclxuICAgIH0oKSk7XHJcblxyXG4gICAgdmFyIHRyYW5zZm9ybUludGVyZmFjZUZhY3RvcnkgPSAoZnVuY3Rpb24oKXtcclxuICAgICAgICByZXR1cm4gZnVuY3Rpb24oc2hhcGUsdmlldyxwcm9wZXJ0eUdyb3VwKXtcclxuICAgICAgICAgICAgZnVuY3Rpb24gX3Byb3BlcnR5R3JvdXAodmFsKXtcclxuICAgICAgICAgICAgICAgIGlmKHZhbCA9PSAxKXtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gaW50ZXJmYWNlRnVuY3Rpb247XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBwcm9wZXJ0eUdyb3VwKC0tdmFsKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB2aWV3LnRyYW5zZm9ybS5tUHJvcHMuby5zZXRHcm91cFByb3BlcnR5KF9wcm9wZXJ0eUdyb3VwKTtcclxuICAgICAgICAgICAgdmlldy50cmFuc2Zvcm0ubVByb3BzLnAuc2V0R3JvdXBQcm9wZXJ0eShfcHJvcGVydHlHcm91cCk7XHJcbiAgICAgICAgICAgIHZpZXcudHJhbnNmb3JtLm1Qcm9wcy5hLnNldEdyb3VwUHJvcGVydHkoX3Byb3BlcnR5R3JvdXApO1xyXG4gICAgICAgICAgICB2aWV3LnRyYW5zZm9ybS5tUHJvcHMucy5zZXRHcm91cFByb3BlcnR5KF9wcm9wZXJ0eUdyb3VwKTtcclxuICAgICAgICAgICAgdmlldy50cmFuc2Zvcm0ubVByb3BzLnIuc2V0R3JvdXBQcm9wZXJ0eShfcHJvcGVydHlHcm91cCk7XHJcbiAgICAgICAgICAgIGlmKHZpZXcudHJhbnNmb3JtLm1Qcm9wcy5zayl7XHJcbiAgICAgICAgICAgICAgICB2aWV3LnRyYW5zZm9ybS5tUHJvcHMuc2suc2V0R3JvdXBQcm9wZXJ0eShfcHJvcGVydHlHcm91cCk7XHJcbiAgICAgICAgICAgICAgICB2aWV3LnRyYW5zZm9ybS5tUHJvcHMuc2Euc2V0R3JvdXBQcm9wZXJ0eShfcHJvcGVydHlHcm91cCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdmlldy50cmFuc2Zvcm0ub3Auc2V0R3JvdXBQcm9wZXJ0eShfcHJvcGVydHlHcm91cCk7XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBpbnRlcmZhY2VGdW5jdGlvbih2YWx1ZSl7XHJcbiAgICAgICAgICAgICAgICBpZihzaGFwZS5hLml4ID09PSB2YWx1ZSl7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGludGVyZmFjZUZ1bmN0aW9uLmFuY2hvclBvaW50O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYoc2hhcGUuby5peCA9PT0gdmFsdWUpe1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBpbnRlcmZhY2VGdW5jdGlvbi5vcGFjaXR5O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYoc2hhcGUucC5peCA9PT0gdmFsdWUpe1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBpbnRlcmZhY2VGdW5jdGlvbi5wb3NpdGlvbjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmKHNoYXBlLnIuaXggPT09IHZhbHVlKXtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gaW50ZXJmYWNlRnVuY3Rpb24ucm90YXRpb247XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZihzaGFwZS5zLml4ID09PSB2YWx1ZSl7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGludGVyZmFjZUZ1bmN0aW9uLnNjYWxlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYoc2hhcGUuc2sgJiYgc2hhcGUuc2suaXggPT09IHZhbHVlKXtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gaW50ZXJmYWNlRnVuY3Rpb24uc2tldztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmKHNoYXBlLnNhICYmIHNoYXBlLnNhLml4ID09PSB2YWx1ZSl7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGludGVyZmFjZUZ1bmN0aW9uLnNrZXdBeGlzO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYodmFsdWUgPT09ICdPcGFjaXR5Jykge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBpbnRlcmZhY2VGdW5jdGlvbi5vcGFjaXR5O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYodmFsdWUgPT09ICdQb3NpdGlvbicpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gaW50ZXJmYWNlRnVuY3Rpb24ucG9zaXRpb247XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZih2YWx1ZSA9PT0gJ0FuY2hvciBQb2ludCcpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gaW50ZXJmYWNlRnVuY3Rpb24uYW5jaG9yUG9pbnQ7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZih2YWx1ZSA9PT0gJ1NjYWxlJykge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBpbnRlcmZhY2VGdW5jdGlvbi5zY2FsZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmKHZhbHVlID09PSAnUm90YXRpb24nIHx8IHZhbHVlID09PSAnQURCRSBWZWN0b3IgUm90YXRpb24nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGludGVyZmFjZUZ1bmN0aW9uLnJvdGF0aW9uO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYodmFsdWUgPT09ICdTa2V3Jykge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBpbnRlcmZhY2VGdW5jdGlvbi5za2V3O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYodmFsdWUgPT09ICdTa2V3IEF4aXMnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGludGVyZmFjZUZ1bmN0aW9uLnNrZXdBeGlzO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoaW50ZXJmYWNlRnVuY3Rpb24sICdvcGFjaXR5Jywge1xyXG4gICAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBFeHByZXNzaW9uVmFsdWUodmlldy50cmFuc2Zvcm0ubVByb3BzLm8sIDEvdmlldy50cmFuc2Zvcm0ubVByb3BzLm8ubXVsdCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoaW50ZXJmYWNlRnVuY3Rpb24sICdwb3NpdGlvbicsIHtcclxuICAgICAgICAgICAgICAgIGdldDogZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gRXhwcmVzc2lvblZhbHVlKHZpZXcudHJhbnNmb3JtLm1Qcm9wcy5wKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShpbnRlcmZhY2VGdW5jdGlvbiwgJ2FuY2hvclBvaW50Jywge1xyXG4gICAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBFeHByZXNzaW9uVmFsdWUodmlldy50cmFuc2Zvcm0ubVByb3BzLmEpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgdmFyIHNjYWxlQXJyYXkgPSBbXTtcclxuICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGludGVyZmFjZUZ1bmN0aW9uLCAnc2NhbGUnLCB7XHJcbiAgICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEV4cHJlc3Npb25WYWx1ZSh2aWV3LnRyYW5zZm9ybS5tUHJvcHMucywgMSAvIHZpZXcudHJhbnNmb3JtLm1Qcm9wcy5zLm11bHQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGludGVyZmFjZUZ1bmN0aW9uLCAncm90YXRpb24nLCB7XHJcbiAgICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEV4cHJlc3Npb25WYWx1ZSh2aWV3LnRyYW5zZm9ybS5tUHJvcHMuciwgMSAvIHZpZXcudHJhbnNmb3JtLm1Qcm9wcy5yLm11bHQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGludGVyZmFjZUZ1bmN0aW9uLCAnc2tldycsIHtcclxuICAgICAgICAgICAgICAgIGdldDogZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gRXhwcmVzc2lvblZhbHVlKHZpZXcudHJhbnNmb3JtLm1Qcm9wcy5zayk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoaW50ZXJmYWNlRnVuY3Rpb24sICdza2V3QXhpcycsIHtcclxuICAgICAgICAgICAgICAgIGdldDogZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gRXhwcmVzc2lvblZhbHVlKHZpZXcudHJhbnNmb3JtLm1Qcm9wcy5zYSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoaW50ZXJmYWNlRnVuY3Rpb24sICdfbmFtZScsIHtcclxuICAgICAgICAgICAgICAgIGdldDogZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2hhcGUubm07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBpbnRlcmZhY2VGdW5jdGlvbi50eSA9ICd0cic7XHJcbiAgICAgICAgICAgIGludGVyZmFjZUZ1bmN0aW9uLm1uID0gc2hhcGUubW47XHJcbiAgICAgICAgICAgIHJldHVybiBpbnRlcmZhY2VGdW5jdGlvbjtcclxuICAgICAgICB9XHJcbiAgICB9KCkpO1xyXG5cclxuICAgIHZhciBlbGxpcHNlSW50ZXJmYWNlRmFjdG9yeSA9IChmdW5jdGlvbigpe1xyXG4gICAgICAgIHJldHVybiBmdW5jdGlvbihzaGFwZSx2aWV3LHByb3BlcnR5R3JvdXApe1xyXG4gICAgICAgICAgICBmdW5jdGlvbiBfcHJvcGVydHlHcm91cCh2YWwpe1xyXG4gICAgICAgICAgICAgICAgaWYodmFsID09IDEpe1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBpbnRlcmZhY2VGdW5jdGlvbjtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHByb3BlcnR5R3JvdXAoLS12YWwpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGludGVyZmFjZUZ1bmN0aW9uLnByb3BlcnR5SW5kZXggPSBzaGFwZS5peDtcclxuICAgICAgICAgICAgdmFyIHByb3AgPSB2aWV3LnNoLnR5ID09PSAndG0nID8gdmlldy5zaC5wcm9wIDogdmlldy5zaDtcclxuICAgICAgICAgICAgcHJvcC5zLnNldEdyb3VwUHJvcGVydHkoX3Byb3BlcnR5R3JvdXApO1xyXG4gICAgICAgICAgICBwcm9wLnAuc2V0R3JvdXBQcm9wZXJ0eShfcHJvcGVydHlHcm91cCk7XHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGludGVyZmFjZUZ1bmN0aW9uKHZhbHVlKXtcclxuICAgICAgICAgICAgICAgIGlmKHNoYXBlLnAuaXggPT09IHZhbHVlKXtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gaW50ZXJmYWNlRnVuY3Rpb24ucG9zaXRpb247XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZihzaGFwZS5zLml4ID09PSB2YWx1ZSl7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGludGVyZmFjZUZ1bmN0aW9uLnNpemU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGludGVyZmFjZUZ1bmN0aW9uLCAnc2l6ZScsIHtcclxuICAgICAgICAgICAgICAgIGdldDogZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gRXhwcmVzc2lvblZhbHVlKHByb3Aucyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoaW50ZXJmYWNlRnVuY3Rpb24sICdwb3NpdGlvbicsIHtcclxuICAgICAgICAgICAgICAgIGdldDogZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gRXhwcmVzc2lvblZhbHVlKHByb3AucCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoaW50ZXJmYWNlRnVuY3Rpb24sICdfbmFtZScsIHtcclxuICAgICAgICAgICAgICAgIGdldDogZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2hhcGUubm07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBpbnRlcmZhY2VGdW5jdGlvbi5tbiA9IHNoYXBlLm1uO1xyXG4gICAgICAgICAgICByZXR1cm4gaW50ZXJmYWNlRnVuY3Rpb247XHJcbiAgICAgICAgfVxyXG4gICAgfSgpKTtcclxuXHJcbiAgICB2YXIgc3RhckludGVyZmFjZUZhY3RvcnkgPSAoZnVuY3Rpb24oKXtcclxuICAgICAgICByZXR1cm4gZnVuY3Rpb24oc2hhcGUsdmlldyxwcm9wZXJ0eUdyb3VwKXtcclxuICAgICAgICAgICAgZnVuY3Rpb24gX3Byb3BlcnR5R3JvdXAodmFsKXtcclxuICAgICAgICAgICAgICAgIGlmKHZhbCA9PSAxKXtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gaW50ZXJmYWNlRnVuY3Rpb247XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBwcm9wZXJ0eUdyb3VwKC0tdmFsKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB2YXIgcHJvcCA9IHZpZXcuc2gudHkgPT09ICd0bScgPyB2aWV3LnNoLnByb3AgOiB2aWV3LnNoO1xyXG4gICAgICAgICAgICBpbnRlcmZhY2VGdW5jdGlvbi5wcm9wZXJ0eUluZGV4ID0gc2hhcGUuaXg7XHJcbiAgICAgICAgICAgIHByb3Aub3Iuc2V0R3JvdXBQcm9wZXJ0eShfcHJvcGVydHlHcm91cCk7XHJcbiAgICAgICAgICAgIHByb3Aub3Muc2V0R3JvdXBQcm9wZXJ0eShfcHJvcGVydHlHcm91cCk7XHJcbiAgICAgICAgICAgIHByb3AucHQuc2V0R3JvdXBQcm9wZXJ0eShfcHJvcGVydHlHcm91cCk7XHJcbiAgICAgICAgICAgIHByb3AucC5zZXRHcm91cFByb3BlcnR5KF9wcm9wZXJ0eUdyb3VwKTtcclxuICAgICAgICAgICAgcHJvcC5yLnNldEdyb3VwUHJvcGVydHkoX3Byb3BlcnR5R3JvdXApO1xyXG4gICAgICAgICAgICBpZihzaGFwZS5pcil7XHJcbiAgICAgICAgICAgICAgICBwcm9wLmlyLnNldEdyb3VwUHJvcGVydHkoX3Byb3BlcnR5R3JvdXApO1xyXG4gICAgICAgICAgICAgICAgcHJvcC5pcy5zZXRHcm91cFByb3BlcnR5KF9wcm9wZXJ0eUdyb3VwKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gaW50ZXJmYWNlRnVuY3Rpb24odmFsdWUpe1xyXG4gICAgICAgICAgICAgICAgaWYoc2hhcGUucC5peCA9PT0gdmFsdWUpe1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBpbnRlcmZhY2VGdW5jdGlvbi5wb3NpdGlvbjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmKHNoYXBlLnIuaXggPT09IHZhbHVlKXtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gaW50ZXJmYWNlRnVuY3Rpb24ucm90YXRpb247XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZihzaGFwZS5wdC5peCA9PT0gdmFsdWUpe1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBpbnRlcmZhY2VGdW5jdGlvbi5wb2ludHM7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZihzaGFwZS5vci5peCA9PT0gdmFsdWUgfHwgJ0FEQkUgVmVjdG9yIFN0YXIgT3V0ZXIgUmFkaXVzJyA9PT0gdmFsdWUpe1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBpbnRlcmZhY2VGdW5jdGlvbi5vdXRlclJhZGl1cztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmKHNoYXBlLm9zLml4ID09PSB2YWx1ZSl7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGludGVyZmFjZUZ1bmN0aW9uLm91dGVyUm91bmRuZXNzO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYoc2hhcGUuaXIgJiYgKHNoYXBlLmlyLml4ID09PSB2YWx1ZSB8fCAnQURCRSBWZWN0b3IgU3RhciBJbm5lciBSYWRpdXMnID09PSB2YWx1ZSkpe1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBpbnRlcmZhY2VGdW5jdGlvbi5pbm5lclJhZGl1cztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmKHNoYXBlLmlzICYmIHNoYXBlLmlzLml4ID09PSB2YWx1ZSl7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGludGVyZmFjZUZ1bmN0aW9uLmlubmVyUm91bmRuZXNzO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoaW50ZXJmYWNlRnVuY3Rpb24sICdwb3NpdGlvbicsIHtcclxuICAgICAgICAgICAgICAgIGdldDogZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gRXhwcmVzc2lvblZhbHVlKHByb3AucCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoaW50ZXJmYWNlRnVuY3Rpb24sICdyb3RhdGlvbicsIHtcclxuICAgICAgICAgICAgICAgIGdldDogZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gRXhwcmVzc2lvblZhbHVlKHByb3AuciwgMSAvIHByb3Auci5tdWx0KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShpbnRlcmZhY2VGdW5jdGlvbiwgJ3BvaW50cycsIHtcclxuICAgICAgICAgICAgICAgIGdldDogZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gRXhwcmVzc2lvblZhbHVlKHByb3AucHQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGludGVyZmFjZUZ1bmN0aW9uLCAnb3V0ZXJSYWRpdXMnLCB7XHJcbiAgICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEV4cHJlc3Npb25WYWx1ZShwcm9wLm9yKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShpbnRlcmZhY2VGdW5jdGlvbiwgJ291dGVyUm91bmRuZXNzJywge1xyXG4gICAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBFeHByZXNzaW9uVmFsdWUocHJvcC5vcyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoaW50ZXJmYWNlRnVuY3Rpb24sICdpbm5lclJhZGl1cycsIHtcclxuICAgICAgICAgICAgICAgIGdldDogZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgICAgICAgICBpZighcHJvcC5pcil7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAwO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gRXhwcmVzc2lvblZhbHVlKHByb3AuaXIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGludGVyZmFjZUZ1bmN0aW9uLCAnaW5uZXJSb3VuZG5lc3MnLCB7XHJcbiAgICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYoIXByb3AuaXMpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gMDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEV4cHJlc3Npb25WYWx1ZShwcm9wLmlzLCAxIC8gcHJvcC5pcy5tdWx0KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShpbnRlcmZhY2VGdW5jdGlvbiwgJ19uYW1lJywge1xyXG4gICAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBzaGFwZS5ubTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIGludGVyZmFjZUZ1bmN0aW9uLm1uID0gc2hhcGUubW47XHJcbiAgICAgICAgICAgIHJldHVybiBpbnRlcmZhY2VGdW5jdGlvbjtcclxuICAgICAgICB9XHJcbiAgICB9KCkpO1xyXG5cclxuICAgIHZhciByZWN0SW50ZXJmYWNlRmFjdG9yeSA9IChmdW5jdGlvbigpe1xyXG4gICAgICAgIHJldHVybiBmdW5jdGlvbihzaGFwZSx2aWV3LHByb3BlcnR5R3JvdXApe1xyXG4gICAgICAgICAgICBmdW5jdGlvbiBfcHJvcGVydHlHcm91cCh2YWwpe1xyXG4gICAgICAgICAgICAgICAgaWYodmFsID09IDEpe1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBpbnRlcmZhY2VGdW5jdGlvbjtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHByb3BlcnR5R3JvdXAoLS12YWwpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZhciBwcm9wID0gdmlldy5zaC50eSA9PT0gJ3RtJyA/IHZpZXcuc2gucHJvcCA6IHZpZXcuc2g7XHJcbiAgICAgICAgICAgIGludGVyZmFjZUZ1bmN0aW9uLnByb3BlcnR5SW5kZXggPSBzaGFwZS5peDtcclxuICAgICAgICAgICAgcHJvcC5wLnNldEdyb3VwUHJvcGVydHkoX3Byb3BlcnR5R3JvdXApO1xyXG4gICAgICAgICAgICBwcm9wLnMuc2V0R3JvdXBQcm9wZXJ0eShfcHJvcGVydHlHcm91cCk7XHJcbiAgICAgICAgICAgIHByb3Auci5zZXRHcm91cFByb3BlcnR5KF9wcm9wZXJ0eUdyb3VwKTtcclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGludGVyZmFjZUZ1bmN0aW9uKHZhbHVlKXtcclxuICAgICAgICAgICAgICAgIGlmKHNoYXBlLnAuaXggPT09IHZhbHVlKXtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gaW50ZXJmYWNlRnVuY3Rpb24ucG9zaXRpb247XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZihzaGFwZS5yLml4ID09PSB2YWx1ZSl7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGludGVyZmFjZUZ1bmN0aW9uLnJvdGF0aW9uO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYoc2hhcGUucy5peCA9PT0gdmFsdWUgfHwgdmFsdWUgPT09ICdTaXplJyl7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGludGVyZmFjZUZ1bmN0aW9uLnNpemU7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShpbnRlcmZhY2VGdW5jdGlvbiwgJ3Bvc2l0aW9uJywge1xyXG4gICAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBFeHByZXNzaW9uVmFsdWUocHJvcC5wKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShpbnRlcmZhY2VGdW5jdGlvbiwgJ3JvdW5kbmVzcycsIHtcclxuICAgICAgICAgICAgICAgIGdldDogZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gRXhwcmVzc2lvblZhbHVlKHByb3Aucik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoaW50ZXJmYWNlRnVuY3Rpb24sICdzaXplJywge1xyXG4gICAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBFeHByZXNzaW9uVmFsdWUocHJvcC5zKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoaW50ZXJmYWNlRnVuY3Rpb24sICdfbmFtZScsIHtcclxuICAgICAgICAgICAgICAgIGdldDogZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2hhcGUubm07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBpbnRlcmZhY2VGdW5jdGlvbi5tbiA9IHNoYXBlLm1uO1xyXG4gICAgICAgICAgICByZXR1cm4gaW50ZXJmYWNlRnVuY3Rpb247XHJcbiAgICAgICAgfVxyXG4gICAgfSgpKTtcclxuXHJcbiAgICB2YXIgcm91bmRlZEludGVyZmFjZUZhY3RvcnkgPSAoZnVuY3Rpb24oKXtcclxuICAgICAgICByZXR1cm4gZnVuY3Rpb24oc2hhcGUsdmlldyxwcm9wZXJ0eUdyb3VwKXtcclxuICAgICAgICAgICAgZnVuY3Rpb24gX3Byb3BlcnR5R3JvdXAodmFsKXtcclxuICAgICAgICAgICAgICAgIGlmKHZhbCA9PSAxKXtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gaW50ZXJmYWNlRnVuY3Rpb247XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBwcm9wZXJ0eUdyb3VwKC0tdmFsKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB2YXIgcHJvcCA9IHZpZXc7XHJcbiAgICAgICAgICAgIGludGVyZmFjZUZ1bmN0aW9uLnByb3BlcnR5SW5kZXggPSBzaGFwZS5peDtcclxuICAgICAgICAgICAgcHJvcC5yZC5zZXRHcm91cFByb3BlcnR5KF9wcm9wZXJ0eUdyb3VwKTtcclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGludGVyZmFjZUZ1bmN0aW9uKHZhbHVlKXtcclxuICAgICAgICAgICAgICAgIGlmKHNoYXBlLnIuaXggPT09IHZhbHVlIHx8ICdSb3VuZCBDb3JuZXJzIDEnID09PSB2YWx1ZSl7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGludGVyZmFjZUZ1bmN0aW9uLnJhZGl1cztcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGludGVyZmFjZUZ1bmN0aW9uLCAncmFkaXVzJywge1xyXG4gICAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBFeHByZXNzaW9uVmFsdWUocHJvcC5yZCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGludGVyZmFjZUZ1bmN0aW9uLCAnX25hbWUnLCB7XHJcbiAgICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNoYXBlLm5tO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgaW50ZXJmYWNlRnVuY3Rpb24ubW4gPSBzaGFwZS5tbjtcclxuICAgICAgICAgICAgcmV0dXJuIGludGVyZmFjZUZ1bmN0aW9uO1xyXG4gICAgICAgIH1cclxuICAgIH0oKSk7XHJcblxyXG4gICAgdmFyIHJlcGVhdGVySW50ZXJmYWNlRmFjdG9yeSA9IChmdW5jdGlvbigpe1xyXG4gICAgICAgIHJldHVybiBmdW5jdGlvbihzaGFwZSx2aWV3LHByb3BlcnR5R3JvdXApe1xyXG4gICAgICAgICAgICBmdW5jdGlvbiBfcHJvcGVydHlHcm91cCh2YWwpe1xyXG4gICAgICAgICAgICAgICAgaWYodmFsID09IDEpe1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBpbnRlcmZhY2VGdW5jdGlvbjtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHByb3BlcnR5R3JvdXAoLS12YWwpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZhciBwcm9wID0gdmlldztcclxuICAgICAgICAgICAgaW50ZXJmYWNlRnVuY3Rpb24ucHJvcGVydHlJbmRleCA9IHNoYXBlLml4O1xyXG4gICAgICAgICAgICBwcm9wLmMuc2V0R3JvdXBQcm9wZXJ0eShfcHJvcGVydHlHcm91cCk7XHJcbiAgICAgICAgICAgIHByb3Auby5zZXRHcm91cFByb3BlcnR5KF9wcm9wZXJ0eUdyb3VwKTtcclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGludGVyZmFjZUZ1bmN0aW9uKHZhbHVlKXtcclxuICAgICAgICAgICAgICAgIGlmKHNoYXBlLmMuaXggPT09IHZhbHVlIHx8ICdDb3BpZXMnID09PSB2YWx1ZSl7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGludGVyZmFjZUZ1bmN0aW9uLmNvcGllcztcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZihzaGFwZS5vLml4ID09PSB2YWx1ZSB8fCAnT2Zmc2V0JyA9PT0gdmFsdWUpe1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBpbnRlcmZhY2VGdW5jdGlvbi5vZmZzZXQ7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShpbnRlcmZhY2VGdW5jdGlvbiwgJ2NvcGllcycsIHtcclxuICAgICAgICAgICAgICAgIGdldDogZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gRXhwcmVzc2lvblZhbHVlKHByb3AuYyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGludGVyZmFjZUZ1bmN0aW9uLCAnb2Zmc2V0Jywge1xyXG4gICAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBFeHByZXNzaW9uVmFsdWUocHJvcC5vKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoaW50ZXJmYWNlRnVuY3Rpb24sICdfbmFtZScsIHtcclxuICAgICAgICAgICAgICAgIGdldDogZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2hhcGUubm07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBpbnRlcmZhY2VGdW5jdGlvbi5tbiA9IHNoYXBlLm1uO1xyXG4gICAgICAgICAgICByZXR1cm4gaW50ZXJmYWNlRnVuY3Rpb247XHJcbiAgICAgICAgfVxyXG4gICAgfSgpKTtcclxuXHJcbiAgICB2YXIgcGF0aEludGVyZmFjZUZhY3RvcnkgPSAoZnVuY3Rpb24oKXtcclxuICAgICAgICByZXR1cm4gZnVuY3Rpb24oc2hhcGUsdmlldyxwcm9wZXJ0eUdyb3VwKXtcclxuICAgICAgICAgICAgdmFyIHByb3AgPSB2aWV3LnNoLnR5ID09PSAndG0nID8gdmlldy5zaC5wcm9wIDogdmlldy5zaDtcclxuICAgICAgICAgICAgZnVuY3Rpb24gX3Byb3BlcnR5R3JvdXAodmFsKXtcclxuICAgICAgICAgICAgICAgIGlmKHZhbCA9PSAxKXtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gaW50ZXJmYWNlRnVuY3Rpb247XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBwcm9wZXJ0eUdyb3VwKC0tdmFsKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBwcm9wLnNldEdyb3VwUHJvcGVydHkoX3Byb3BlcnR5R3JvdXApO1xyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gaW50ZXJmYWNlRnVuY3Rpb24odmFsKXtcclxuICAgICAgICAgICAgICAgIGlmKHZhbCA9PT0gJ1NoYXBlJyB8fCB2YWwgPT09ICdzaGFwZScgfHwgdmFsID09PSAnUGF0aCcgfHwgdmFsID09PSAncGF0aCcpe1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBpbnRlcmZhY2VGdW5jdGlvbi5wYXRoO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShpbnRlcmZhY2VGdW5jdGlvbiwgJ3BhdGgnLCB7XHJcbiAgICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYocHJvcC5rKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcHJvcC5nZXRWYWx1ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcHJvcC52O1xyXG4gICAgICAgICAgICAgICAgICAgIC8vcmV0dXJuIHNoYXBlX3Bvb2wuY2xvbmUocHJvcC52KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShpbnRlcmZhY2VGdW5jdGlvbiwgJ3NoYXBlJywge1xyXG4gICAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICAgICAgICAgIGlmKHByb3Auayl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb3AuZ2V0VmFsdWUoKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHByb3AudjtcclxuICAgICAgICAgICAgICAgICAgICAvL3JldHVybiBzaGFwZV9wb29sLmNsb25lKHByb3Audik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoaW50ZXJmYWNlRnVuY3Rpb24sICdfbmFtZScsIHsgdmFsdWU6IHNoYXBlLm5tIH0pO1xyXG4gICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoaW50ZXJmYWNlRnVuY3Rpb24sICdpeCcsIHsgdmFsdWU6IHNoYXBlLml4IH0pO1xyXG4gICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoaW50ZXJmYWNlRnVuY3Rpb24sICdtbicsIHsgdmFsdWU6IHNoYXBlLm1uIH0pO1xyXG4gICAgICAgICAgICByZXR1cm4gaW50ZXJmYWNlRnVuY3Rpb247XHJcbiAgICAgICAgfVxyXG4gICAgfSgpKTtcclxuXHJcblxyXG4gICAgcmV0dXJuIG9iO1xyXG59KCkpXHJcblxudmFyIFRleHRFeHByZXNzaW9uSW50ZXJmYWNlID0gKGZ1bmN0aW9uKCl7XHJcblx0cmV0dXJuIGZ1bmN0aW9uKGVsZW0pe1xyXG4gICAgICAgIGZ1bmN0aW9uIF90aGlzTGF5ZXJGdW5jdGlvbigpe1xyXG4gICAgICAgIH1cclxuICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoX3RoaXNMYXllckZ1bmN0aW9uLCBcInNvdXJjZVRleHRcIiwge1xyXG4gICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgIFx0aWYoIWVsZW0uY3VycmVudFRleHREb2N1bWVudERhdGEudCkge1xyXG4gICAgICAgICAgICBcdFx0cmV0dXJuICcnXHJcbiAgICAgICAgICAgIFx0fVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVsZW0uY3VycmVudFRleHREb2N1bWVudERhdGEudDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHJldHVybiBfdGhpc0xheWVyRnVuY3Rpb247XHJcbiAgICB9XHJcbn0oKSlcbnZhciBMYXllckV4cHJlc3Npb25JbnRlcmZhY2UgPSAoZnVuY3Rpb24gKCl7XHJcbiAgICBmdW5jdGlvbiB0b1dvcmxkKGFyciwgdGltZSl7XHJcbiAgICAgICAgdmFyIHRvV29ybGRNYXQgPSBuZXcgTWF0cml4KCk7XHJcbiAgICAgICAgdG9Xb3JsZE1hdC5yZXNldCgpO1xyXG4gICAgICAgIHZhciB0cmFuc2Zvcm1NYXQ7XHJcbiAgICAgICAgaWYodGltZSkge1xyXG4gICAgICAgICAgICAvL1RvZG8gaW1wbGVtZW50IHZhbHVlIGF0IHRpbWUgb24gdHJhbnNmb3JtIHByb3BlcnRpZXNcclxuICAgICAgICAgICAgLy90cmFuc2Zvcm1NYXQgPSB0aGlzLl9lbGVtLmZpbmFsVHJhbnNmb3JtLm1Qcm9wLmdldFZhbHVlQXRUaW1lKHRpbWUpO1xyXG4gICAgICAgICAgICB0cmFuc2Zvcm1NYXQgPSB0aGlzLl9lbGVtLmZpbmFsVHJhbnNmb3JtLm1Qcm9wO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRyYW5zZm9ybU1hdCA9IHRoaXMuX2VsZW0uZmluYWxUcmFuc2Zvcm0ubVByb3A7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRyYW5zZm9ybU1hdC5hcHBseVRvTWF0cml4KHRvV29ybGRNYXQpO1xyXG4gICAgICAgIGlmKHRoaXMuX2VsZW0uaGllcmFyY2h5ICYmIHRoaXMuX2VsZW0uaGllcmFyY2h5Lmxlbmd0aCl7XHJcbiAgICAgICAgICAgIHZhciBpLCBsZW4gPSB0aGlzLl9lbGVtLmhpZXJhcmNoeS5sZW5ndGg7XHJcbiAgICAgICAgICAgIGZvcihpPTA7aTxsZW47aSs9MSl7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9lbGVtLmhpZXJhcmNoeVtpXS5maW5hbFRyYW5zZm9ybS5tUHJvcC5hcHBseVRvTWF0cml4KHRvV29ybGRNYXQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiB0b1dvcmxkTWF0LmFwcGx5VG9Qb2ludEFycmF5KGFyclswXSxhcnJbMV0sYXJyWzJdfHwwKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRvV29ybGRNYXQuYXBwbHlUb1BvaW50QXJyYXkoYXJyWzBdLGFyclsxXSxhcnJbMl18fDApO1xyXG4gICAgfVxyXG4gICAgZnVuY3Rpb24gZnJvbVdvcmxkKGFyciwgdGltZSl7XHJcbiAgICAgICAgdmFyIHRvV29ybGRNYXQgPSBuZXcgTWF0cml4KCk7XHJcbiAgICAgICAgdG9Xb3JsZE1hdC5yZXNldCgpO1xyXG4gICAgICAgIHZhciB0cmFuc2Zvcm1NYXQ7XHJcbiAgICAgICAgaWYodGltZSkge1xyXG4gICAgICAgICAgICAvL1RvZG8gaW1wbGVtZW50IHZhbHVlIGF0IHRpbWUgb24gdHJhbnNmb3JtIHByb3BlcnRpZXNcclxuICAgICAgICAgICAgLy90cmFuc2Zvcm1NYXQgPSB0aGlzLl9lbGVtLmZpbmFsVHJhbnNmb3JtLm1Qcm9wLmdldFZhbHVlQXRUaW1lKHRpbWUpO1xyXG4gICAgICAgICAgICB0cmFuc2Zvcm1NYXQgPSB0aGlzLl9lbGVtLmZpbmFsVHJhbnNmb3JtLm1Qcm9wO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRyYW5zZm9ybU1hdCA9IHRoaXMuX2VsZW0uZmluYWxUcmFuc2Zvcm0ubVByb3A7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRyYW5zZm9ybU1hdC5hcHBseVRvTWF0cml4KHRvV29ybGRNYXQpO1xyXG4gICAgICAgIGlmKHRoaXMuX2VsZW0uaGllcmFyY2h5ICYmIHRoaXMuX2VsZW0uaGllcmFyY2h5Lmxlbmd0aCl7XHJcbiAgICAgICAgICAgIHZhciBpLCBsZW4gPSB0aGlzLl9lbGVtLmhpZXJhcmNoeS5sZW5ndGg7XHJcbiAgICAgICAgICAgIGZvcihpPTA7aTxsZW47aSs9MSl7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9lbGVtLmhpZXJhcmNoeVtpXS5maW5hbFRyYW5zZm9ybS5tUHJvcC5hcHBseVRvTWF0cml4KHRvV29ybGRNYXQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiB0b1dvcmxkTWF0LmludmVyc2VQb2ludChhcnIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdG9Xb3JsZE1hdC5pbnZlcnNlUG9pbnQoYXJyKTtcclxuICAgIH1cclxuICAgIGZ1bmN0aW9uIGZyb21Db21wKGFycil7XHJcbiAgICAgICAgdmFyIHRvV29ybGRNYXQgPSBuZXcgTWF0cml4KCk7XHJcbiAgICAgICAgdG9Xb3JsZE1hdC5yZXNldCgpO1xyXG4gICAgICAgIHRoaXMuX2VsZW0uZmluYWxUcmFuc2Zvcm0ubVByb3AuYXBwbHlUb01hdHJpeCh0b1dvcmxkTWF0KTtcclxuICAgICAgICBpZih0aGlzLl9lbGVtLmhpZXJhcmNoeSAmJiB0aGlzLl9lbGVtLmhpZXJhcmNoeS5sZW5ndGgpe1xyXG4gICAgICAgICAgICB2YXIgaSwgbGVuID0gdGhpcy5fZWxlbS5oaWVyYXJjaHkubGVuZ3RoO1xyXG4gICAgICAgICAgICBmb3IoaT0wO2k8bGVuO2krPTEpe1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fZWxlbS5oaWVyYXJjaHlbaV0uZmluYWxUcmFuc2Zvcm0ubVByb3AuYXBwbHlUb01hdHJpeCh0b1dvcmxkTWF0KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gdG9Xb3JsZE1hdC5pbnZlcnNlUG9pbnQoYXJyKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRvV29ybGRNYXQuaW52ZXJzZVBvaW50KGFycik7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIHJldHVybiBmdW5jdGlvbihlbGVtKXtcclxuXHJcbiAgICAgICAgdmFyIHRyYW5zZm9ybUludGVyZmFjZSA9IFRyYW5zZm9ybUV4cHJlc3Npb25JbnRlcmZhY2UoZWxlbS50cmFuc2Zvcm0pO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBfcmVnaXN0ZXJNYXNrSW50ZXJmYWNlKG1hc2tNYW5hZ2VyKXtcclxuICAgICAgICAgICAgX3RoaXNMYXllckZ1bmN0aW9uLm1hc2sgPSBtYXNrTWFuYWdlci5nZXRNYXNrLmJpbmQobWFza01hbmFnZXIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBmdW5jdGlvbiBfcmVnaXN0ZXJFZmZlY3RzSW50ZXJmYWNlKGVmZmVjdHMpe1xyXG4gICAgICAgICAgICBfdGhpc0xheWVyRnVuY3Rpb24uZWZmZWN0ID0gZWZmZWN0cztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIF90aGlzTGF5ZXJGdW5jdGlvbihuYW1lKXtcclxuICAgICAgICAgICAgc3dpdGNoKG5hbWUpe1xyXG4gICAgICAgICAgICAgICAgY2FzZSBcIkFEQkUgUm9vdCBWZWN0b3JzIEdyb3VwXCI6XHJcbiAgICAgICAgICAgICAgICBjYXNlIFwiQ29udGVudHNcIjpcclxuICAgICAgICAgICAgICAgIGNhc2UgMjpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gX3RoaXNMYXllckZ1bmN0aW9uLnNoYXBlSW50ZXJmYWNlO1xyXG4gICAgICAgICAgICAgICAgY2FzZSAxOlxyXG4gICAgICAgICAgICAgICAgY2FzZSA2OlxyXG4gICAgICAgICAgICAgICAgY2FzZSBcIlRyYW5zZm9ybVwiOlxyXG4gICAgICAgICAgICAgICAgY2FzZSBcInRyYW5zZm9ybVwiOlxyXG4gICAgICAgICAgICAgICAgY2FzZSBcIkFEQkUgVHJhbnNmb3JtIEdyb3VwXCI6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRyYW5zZm9ybUludGVyZmFjZTtcclxuICAgICAgICAgICAgICAgIGNhc2UgNDpcclxuICAgICAgICAgICAgICAgIGNhc2UgXCJBREJFIEVmZmVjdCBQYXJhZGVcIjpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gX3RoaXNMYXllckZ1bmN0aW9uLmVmZmVjdDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBfdGhpc0xheWVyRnVuY3Rpb24udG9Xb3JsZCA9IHRvV29ybGQ7XHJcbiAgICAgICAgX3RoaXNMYXllckZ1bmN0aW9uLmZyb21Xb3JsZCA9IGZyb21Xb3JsZDtcclxuICAgICAgICBfdGhpc0xheWVyRnVuY3Rpb24udG9Db21wID0gdG9Xb3JsZDtcclxuICAgICAgICBfdGhpc0xheWVyRnVuY3Rpb24uZnJvbUNvbXAgPSBmcm9tQ29tcDtcclxuICAgICAgICBfdGhpc0xheWVyRnVuY3Rpb24uX2VsZW0gPSBlbGVtO1xyXG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShfdGhpc0xheWVyRnVuY3Rpb24sICdoYXNQYXJlbnQnLCB7XHJcbiAgICAgICAgICAgIGdldDogZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgICAgIHJldHVybiAhIWVsZW0uaGllcmFyY2h5O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KF90aGlzTGF5ZXJGdW5jdGlvbiwgJ3BhcmVudCcsIHtcclxuICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVsZW0uaGllcmFyY2h5WzBdLmxheWVySW50ZXJmYWNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KF90aGlzTGF5ZXJGdW5jdGlvbiwgXCJyb3RhdGlvblwiLCB7XHJcbiAgICAgICAgICAgIGdldDogZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0cmFuc2Zvcm1JbnRlcmZhY2Uucm90YXRpb247XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoX3RoaXNMYXllckZ1bmN0aW9uLCBcInNjYWxlXCIsIHtcclxuICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJhbnNmb3JtSW50ZXJmYWNlLnNjYWxlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShfdGhpc0xheWVyRnVuY3Rpb24sIFwicG9zaXRpb25cIiwge1xyXG4gICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0cmFuc2Zvcm1JbnRlcmZhY2UucG9zaXRpb247XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KF90aGlzTGF5ZXJGdW5jdGlvbiwgXCJhbmNob3JQb2ludFwiLCB7XHJcbiAgICAgICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRyYW5zZm9ybUludGVyZmFjZS5hbmNob3JQb2ludDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoX3RoaXNMYXllckZ1bmN0aW9uLCBcInRyYW5zZm9ybVwiLCB7XHJcbiAgICAgICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRyYW5zZm9ybUludGVyZmFjZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoX3RoaXNMYXllckZ1bmN0aW9uLCBcIndpZHRoXCIsIHtcclxuICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBpZihlbGVtLmRhdGEudHkgPT09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZWxlbS5kYXRhLndcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybiAxMDA7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KF90aGlzTGF5ZXJGdW5jdGlvbiwgXCJoZWlnaHRcIiwge1xyXG4gICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIGlmKGVsZW0uZGF0YS50eSA9PT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBlbGVtLmRhdGEuaFxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIDEwMDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoX3RoaXNMYXllckZ1bmN0aW9uLCBcInNvdXJjZVwiLCB7XHJcbiAgICAgICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVsZW0uZGF0YS5yZWZJZDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoX3RoaXNMYXllckZ1bmN0aW9uLCBcIl9uYW1lXCIsIHsgdmFsdWU6ZWxlbS5kYXRhLm5tIH0pO1xyXG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShfdGhpc0xheWVyRnVuY3Rpb24sIFwiY29udGVudFwiLCB7XHJcbiAgICAgICAgICAgIGdldDogZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgICAgIHJldHVybiBfdGhpc0xheWVyRnVuY3Rpb24uc2hhcGVJbnRlcmZhY2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KF90aGlzTGF5ZXJGdW5jdGlvbiwgXCJhY3RpdmVcIiwge1xyXG4gICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZWxlbS5pc1Zpc2libGU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KF90aGlzTGF5ZXJGdW5jdGlvbiwgXCJ0ZXh0XCIsIHtcclxuICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzTGF5ZXJGdW5jdGlvbi50ZXh0SW50ZXJmYWNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIF90aGlzTGF5ZXJGdW5jdGlvbi5yZWdpc3Rlck1hc2tJbnRlcmZhY2UgPSBfcmVnaXN0ZXJNYXNrSW50ZXJmYWNlO1xyXG4gICAgICAgIF90aGlzTGF5ZXJGdW5jdGlvbi5yZWdpc3RlckVmZmVjdHNJbnRlcmZhY2UgPSBfcmVnaXN0ZXJFZmZlY3RzSW50ZXJmYWNlO1xyXG4gICAgICAgIHJldHVybiBfdGhpc0xheWVyRnVuY3Rpb247XHJcbiAgICB9XHJcbn0oKSk7XHJcblxudmFyIENvbXBFeHByZXNzaW9uSW50ZXJmYWNlID0gKGZ1bmN0aW9uICgpe1xyXG4gICAgcmV0dXJuIGZ1bmN0aW9uKGNvbXApe1xyXG4gICAgICAgIGZ1bmN0aW9uIF90aGlzTGF5ZXJGdW5jdGlvbihuYW1lKXtcclxuICAgICAgICAgICAgdmFyIGk9MCwgbGVuID0gY29tcC5sYXllcnMubGVuZ3RoO1xyXG4gICAgICAgICAgICB3aGlsZShpPGxlbil7XHJcbiAgICAgICAgICAgICAgICBpZihjb21wLmxheWVyc1tpXS5ubSA9PT0gbmFtZSB8fCBjb21wLmxheWVyc1tpXS5pbmQgPT09IG5hbWUpe1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBjb21wLmVsZW1lbnRzW2ldLmxheWVySW50ZXJmYWNlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaSArPSAxO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiB7YWN0aXZlOmZhbHNlfVxyXG4gICAgICAgIH1cclxuICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoX3RoaXNMYXllckZ1bmN0aW9uLCBcIl9uYW1lXCIsIHsgdmFsdWU6Y29tcC5kYXRhLm5tIH0pO1xyXG4gICAgICAgIF90aGlzTGF5ZXJGdW5jdGlvbi5sYXllciA9IF90aGlzTGF5ZXJGdW5jdGlvbjtcclxuICAgICAgICBfdGhpc0xheWVyRnVuY3Rpb24ucGl4ZWxBc3BlY3QgPSAxO1xyXG4gICAgICAgIF90aGlzTGF5ZXJGdW5jdGlvbi5oZWlnaHQgPSBjb21wLmdsb2JhbERhdGEuY29tcFNpemUuaDtcclxuICAgICAgICBfdGhpc0xheWVyRnVuY3Rpb24ud2lkdGggPSBjb21wLmdsb2JhbERhdGEuY29tcFNpemUudztcclxuICAgICAgICBfdGhpc0xheWVyRnVuY3Rpb24ucGl4ZWxBc3BlY3QgPSAxO1xyXG4gICAgICAgIF90aGlzTGF5ZXJGdW5jdGlvbi5mcmFtZUR1cmF0aW9uID0gMS9jb21wLmdsb2JhbERhdGEuZnJhbWVSYXRlO1xyXG4gICAgICAgIHJldHVybiBfdGhpc0xheWVyRnVuY3Rpb247XHJcbiAgICB9XHJcbn0oKSk7XG52YXIgVHJhbnNmb3JtRXhwcmVzc2lvbkludGVyZmFjZSA9IChmdW5jdGlvbiAoKXtcclxuICAgIHJldHVybiBmdW5jdGlvbih0cmFuc2Zvcm0pe1xyXG4gICAgICAgIGZ1bmN0aW9uIF90aGlzRnVuY3Rpb24obmFtZSl7XHJcbiAgICAgICAgICAgIHN3aXRjaChuYW1lKXtcclxuICAgICAgICAgICAgICAgIGNhc2UgXCJzY2FsZVwiOlxyXG4gICAgICAgICAgICAgICAgY2FzZSBcIlNjYWxlXCI6XHJcbiAgICAgICAgICAgICAgICBjYXNlIFwiQURCRSBTY2FsZVwiOlxyXG4gICAgICAgICAgICAgICAgY2FzZSA2OlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBfdGhpc0Z1bmN0aW9uLnNjYWxlO1xyXG4gICAgICAgICAgICAgICAgY2FzZSBcInJvdGF0aW9uXCI6XHJcbiAgICAgICAgICAgICAgICBjYXNlIFwiUm90YXRpb25cIjpcclxuICAgICAgICAgICAgICAgIGNhc2UgXCJBREJFIFJvdGF0aW9uXCI6XHJcbiAgICAgICAgICAgICAgICBjYXNlIFwiQURCRSBSb3RhdGUgWlwiOlxyXG4gICAgICAgICAgICAgICAgY2FzZSAxMDpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gX3RoaXNGdW5jdGlvbi5yb3RhdGlvbjtcclxuICAgICAgICAgICAgICAgIGNhc2UgXCJwb3NpdGlvblwiOlxyXG4gICAgICAgICAgICAgICAgY2FzZSBcIlBvc2l0aW9uXCI6XHJcbiAgICAgICAgICAgICAgICBjYXNlIFwiQURCRSBQb3NpdGlvblwiOlxyXG4gICAgICAgICAgICAgICAgY2FzZSAyOlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cmFuc2Zvcm0ucG9zaXRpb247XHJcbiAgICAgICAgICAgICAgICBjYXNlIFwiYW5jaG9yUG9pbnRcIjpcclxuICAgICAgICAgICAgICAgIGNhc2UgXCJBbmNob3JQb2ludFwiOlxyXG4gICAgICAgICAgICAgICAgY2FzZSBcIkFuY2hvciBQb2ludFwiOlxyXG4gICAgICAgICAgICAgICAgY2FzZSBcIkFEQkUgQW5jaG9yUG9pbnRcIjpcclxuICAgICAgICAgICAgICAgIGNhc2UgMTpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gX3RoaXNGdW5jdGlvbi5hbmNob3JQb2ludDtcclxuICAgICAgICAgICAgICAgIGNhc2UgXCJvcGFjaXR5XCI6XHJcbiAgICAgICAgICAgICAgICBjYXNlIFwiT3BhY2l0eVwiOlxyXG4gICAgICAgICAgICAgICAgY2FzZSAxMTpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gX3RoaXNGdW5jdGlvbi5vcGFjaXR5O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoX3RoaXNGdW5jdGlvbiwgXCJyb3RhdGlvblwiLCB7XHJcbiAgICAgICAgICAgIGdldDogZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0cmFuc2Zvcm0ucm90YXRpb247XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoX3RoaXNGdW5jdGlvbiwgXCJzY2FsZVwiLCB7XHJcbiAgICAgICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRyYW5zZm9ybS5zY2FsZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoX3RoaXNGdW5jdGlvbiwgXCJwb3NpdGlvblwiLCB7XHJcbiAgICAgICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRyYW5zZm9ybS5wb3NpdGlvbjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoX3RoaXNGdW5jdGlvbiwgXCJ4UG9zaXRpb25cIiwge1xyXG4gICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0cmFuc2Zvcm0ueFBvc2l0aW9uO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShfdGhpc0Z1bmN0aW9uLCBcInlQb3NpdGlvblwiLCB7XHJcbiAgICAgICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRyYW5zZm9ybS55UG9zaXRpb247XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KF90aGlzRnVuY3Rpb24sIFwiYW5jaG9yUG9pbnRcIiwge1xyXG4gICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0cmFuc2Zvcm0uYW5jaG9yUG9pbnQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KF90aGlzRnVuY3Rpb24sIFwib3BhY2l0eVwiLCB7XHJcbiAgICAgICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRyYW5zZm9ybS5vcGFjaXR5O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShfdGhpc0Z1bmN0aW9uLCBcInNrZXdcIiwge1xyXG4gICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0cmFuc2Zvcm0uc2tldztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoX3RoaXNGdW5jdGlvbiwgXCJza2V3QXhpc1wiLCB7XHJcbiAgICAgICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRyYW5zZm9ybS5za2V3QXhpcztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICByZXR1cm4gX3RoaXNGdW5jdGlvbjtcclxuICAgIH1cclxufSgpKTtcbnZhciBQcm9qZWN0SW50ZXJmYWNlID0gKGZ1bmN0aW9uICgpe1xyXG5cclxuICAgIGZ1bmN0aW9uIHJlZ2lzdGVyQ29tcG9zaXRpb24oY29tcCl7XHJcbiAgICAgICAgdGhpcy5jb21wb3NpdGlvbnMucHVzaChjb21wKTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gZnVuY3Rpb24oKXtcclxuICAgICAgICBmdW5jdGlvbiBfdGhpc1Byb2plY3RGdW5jdGlvbihuYW1lKXtcclxuICAgICAgICAgICAgdmFyIGkgPSAwLCBsZW4gPSB0aGlzLmNvbXBvc2l0aW9ucy5sZW5ndGg7XHJcbiAgICAgICAgICAgIHdoaWxlKGk8bGVuKXtcclxuICAgICAgICAgICAgICAgIGlmKHRoaXMuY29tcG9zaXRpb25zW2ldLmRhdGEgJiYgdGhpcy5jb21wb3NpdGlvbnNbaV0uZGF0YS5ubSA9PT0gbmFtZSl7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYodGhpcy5jb21wb3NpdGlvbnNbaV0ucHJlcGFyZUZyYW1lKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY29tcG9zaXRpb25zW2ldLnByZXBhcmVGcmFtZSh0aGlzLmN1cnJlbnRGcmFtZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmNvbXBvc2l0aW9uc1tpXS5jb21wSW50ZXJmYWNlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaSs9MTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgX3RoaXNQcm9qZWN0RnVuY3Rpb24uY29tcG9zaXRpb25zID0gW107XHJcbiAgICAgICAgX3RoaXNQcm9qZWN0RnVuY3Rpb24uY3VycmVudEZyYW1lID0gMDtcclxuXHJcbiAgICAgICAgX3RoaXNQcm9qZWN0RnVuY3Rpb24ucmVnaXN0ZXJDb21wb3NpdGlvbiA9IHJlZ2lzdGVyQ29tcG9zaXRpb247XHJcblxyXG5cclxuXHJcbiAgICAgICAgcmV0dXJuIF90aGlzUHJvamVjdEZ1bmN0aW9uO1xyXG4gICAgfVxyXG59KCkpO1xudmFyIEVmZmVjdHNFeHByZXNzaW9uSW50ZXJmYWNlID0gKGZ1bmN0aW9uICgpe1xyXG4gICAgdmFyIG9iID0ge1xyXG4gICAgICAgIGNyZWF0ZUVmZmVjdHNJbnRlcmZhY2U6IGNyZWF0ZUVmZmVjdHNJbnRlcmZhY2VcclxuICAgIH07XHJcblxyXG4gICAgZnVuY3Rpb24gY3JlYXRlRWZmZWN0c0ludGVyZmFjZShlbGVtLCBwcm9wZXJ0eUdyb3VwKXtcclxuICAgICAgICBpZihlbGVtLmVmZmVjdHMpe1xyXG5cclxuICAgICAgICAgICAgdmFyIGVmZmVjdEVsZW1lbnRzID0gW107XHJcbiAgICAgICAgICAgIHZhciBlZmZlY3RzRGF0YSA9IGVsZW0uZGF0YS5lZjtcclxuICAgICAgICAgICAgdmFyIGksIGxlbiA9IGVsZW0uZWZmZWN0cy5lZmZlY3RFbGVtZW50cy5sZW5ndGg7XHJcbiAgICAgICAgICAgIGZvcihpPTA7aTxsZW47aSs9MSl7XHJcbiAgICAgICAgICAgICAgICBlZmZlY3RFbGVtZW50cy5wdXNoKGNyZWF0ZUdyb3VwSW50ZXJmYWNlKGVmZmVjdHNEYXRhW2ldLGVsZW0uZWZmZWN0cy5lZmZlY3RFbGVtZW50c1tpXSxwcm9wZXJ0eUdyb3VwLGVsZW0pKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKG5hbWUpe1xyXG4gICAgICAgICAgICAgICAgdmFyIGVmZmVjdHMgPSBlbGVtLmRhdGEuZWYsIGkgPSAwLCBsZW4gPSBlZmZlY3RzLmxlbmd0aDtcclxuICAgICAgICAgICAgICAgIHdoaWxlKGk8bGVuKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYobmFtZSA9PT0gZWZmZWN0c1tpXS5ubSB8fCBuYW1lID09PSBlZmZlY3RzW2ldLm1uIHx8IG5hbWUgPT09IGVmZmVjdHNbaV0uaXgpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZWZmZWN0RWxlbWVudHNbaV07XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGkgKz0gMTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBjcmVhdGVHcm91cEludGVyZmFjZShkYXRhLGVsZW1lbnRzLCBwcm9wZXJ0eUdyb3VwLCBlbGVtKXtcclxuICAgICAgICB2YXIgZWZmZWN0RWxlbWVudHMgPSBbXTtcclxuICAgICAgICB2YXIgaSwgbGVuID0gZGF0YS5lZi5sZW5ndGg7XHJcbiAgICAgICAgZm9yKGk9MDtpPGxlbjtpKz0xKXtcclxuICAgICAgICAgICAgaWYoZGF0YS5lZltpXS50eSA9PT0gNSl7XHJcbiAgICAgICAgICAgICAgICBlZmZlY3RFbGVtZW50cy5wdXNoKGNyZWF0ZUdyb3VwSW50ZXJmYWNlKGRhdGEuZWZbaV0sZWxlbWVudHMuZWZmZWN0RWxlbWVudHNbaV0scHJvcGVydHlHcm91cCwgZWxlbSkpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgZWZmZWN0RWxlbWVudHMucHVzaChjcmVhdGVWYWx1ZUludGVyZmFjZShlbGVtZW50cy5lZmZlY3RFbGVtZW50c1tpXSxkYXRhLmVmW2ldLnR5LCBlbGVtKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIGdyb3VwSW50ZXJmYWNlID0gZnVuY3Rpb24obmFtZSl7XHJcbiAgICAgICAgICAgIHZhciBlZmZlY3RzID0gZGF0YS5lZiwgaSA9IDAsIGxlbiA9IGVmZmVjdHMubGVuZ3RoO1xyXG4gICAgICAgICAgICB3aGlsZShpPGxlbikge1xyXG4gICAgICAgICAgICAgICAgaWYobmFtZSA9PT0gZWZmZWN0c1tpXS5ubSB8fCBuYW1lID09PSBlZmZlY3RzW2ldLm1uIHx8IG5hbWUgPT09IGVmZmVjdHNbaV0uaXgpe1xyXG4gICAgICAgICAgICAgICAgICAgIGlmKGVmZmVjdHNbaV0udHkgPT09IDUpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZWZmZWN0RWxlbWVudHNbaV07XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVmZmVjdEVsZW1lbnRzW2ldKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaSArPSAxO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBlZmZlY3RFbGVtZW50c1swXSgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZihkYXRhLm1uID09PSAnQURCRSBDb2xvciBDb250cm9sJyl7XHJcbiAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShncm91cEludGVyZmFjZSwgJ2NvbG9yJywge1xyXG4gICAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBlZmZlY3RFbGVtZW50c1swXSgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZ3JvdXBJbnRlcmZhY2UuYWN0aXZlID0gZGF0YS5lbiAhPT0gMDtcclxuICAgICAgICByZXR1cm4gZ3JvdXBJbnRlcmZhY2VcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBjcmVhdGVWYWx1ZUludGVyZmFjZShlbGVtZW50LCB0eXBlLCBlbGVtKXtcclxuICAgICAgICByZXR1cm4gZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgaWYodHlwZSA9PT0gMTApe1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVsZW0uY29tcC5jb21wSW50ZXJmYWNlKGVsZW1lbnQucC52KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gRXhwcmVzc2lvblZhbHVlKGVsZW1lbnQucCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBvYjtcclxuXHJcbn0oKSk7XG52YXIgRXhwcmVzc2lvblZhbHVlID0gKGZ1bmN0aW9uKCkge1xyXG5cdHJldHVybiBmdW5jdGlvbihlbGVtZW50UHJvcCwgbXVsdCwgdHlwZSkge1xyXG4gICAgICAgIHZhciBleHByZXNzaW9uVmFsdWUsIGFycmF5VmFsdWU7XHJcblxyXG5cdFx0aWYgKGVsZW1lbnRQcm9wLmspIHtcclxuICAgICAgICAgICAgZWxlbWVudFByb3AuZ2V0VmFsdWUoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIGksIGxlbiwgYXJyVmFsdWU7XHJcbiAgICAgICAgaWYgKHR5cGUpIHtcclxuICAgICAgICBcdGlmKHR5cGUgPT09ICdjb2xvcicpIHtcclxuICAgICAgICBcdFx0bGVuID0gNDtcclxuXHRcdCAgICAgICAgZXhwcmVzc2lvblZhbHVlID0gQXJyYXkuYXBwbHkobnVsbCwge2xlbmd0aDogbGVufSk7XHJcblx0XHQgICAgICAgIGFyclZhbHVlID0gQXJyYXkuYXBwbHkobnVsbCwge2xlbmd0aDogbGVufSk7XHJcblx0XHQgICAgICAgIGZvciAoaSA9IDA7IGkgPCBsZW47IGkgKz0gMSkge1xyXG5cdFx0ICAgICAgICAgICAgZXhwcmVzc2lvblZhbHVlW2ldID0gYXJyVmFsdWVbaV0gPSAobXVsdCAmJiBpIDwgMykgPyBlbGVtZW50UHJvcC52W2ldICogbXVsdCA6IDE7XHJcblx0XHQgICAgICAgIH1cclxuXHQgICAgICAgIFx0ZXhwcmVzc2lvblZhbHVlLnZhbHVlID0gYXJyVmFsdWU7XHJcbiAgICAgICAgXHR9XHJcbiAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgZWxlbWVudFByb3AudiA9PT0gJ251bWJlcicgfHwgZWxlbWVudFByb3AudiBpbnN0YW5jZW9mIE51bWJlcil7XHJcbiAgICAgICAgICAgIGV4cHJlc3Npb25WYWx1ZSA9IG11bHQgPyBuZXcgTnVtYmVyKGVsZW1lbnRQcm9wLnYgKiBtdWx0KSA6IG5ldyBOdW1iZXIoZWxlbWVudFByb3Audik7XHJcbiAgICAgICAgICAgIGV4cHJlc3Npb25WYWx1ZS52YWx1ZSA9IG11bHQgPyBlbGVtZW50UHJvcC52ICogbXVsdCA6IGVsZW1lbnRQcm9wLnY7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICBcdGxlbiA9IGVsZW1lbnRQcm9wLnYubGVuZ3RoO1xyXG5cdCAgICAgICAgZXhwcmVzc2lvblZhbHVlID0gQXJyYXkuYXBwbHkobnVsbCwge2xlbmd0aDogbGVufSk7XHJcblx0ICAgICAgICBhcnJWYWx1ZSA9IEFycmF5LmFwcGx5KG51bGwsIHtsZW5ndGg6IGxlbn0pO1xyXG5cdCAgICAgICAgZm9yIChpID0gMDsgaSA8IGxlbjsgaSArPSAxKSB7XHJcblx0ICAgICAgICAgICAgZXhwcmVzc2lvblZhbHVlW2ldID0gYXJyVmFsdWVbaV0gPSBtdWx0ID8gZWxlbWVudFByb3AudltpXSAqIG11bHQgOiBlbGVtZW50UHJvcC52W2ldO1xyXG5cdCAgICAgICAgfVxyXG5cdCAgICAgICAgZXhwcmVzc2lvblZhbHVlLnZhbHVlID0gYXJyVmFsdWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIGV4cHJlc3Npb25WYWx1ZS5udW1LZXlzID0gZWxlbWVudFByb3Aua2V5ZnJhbWVzID8gZWxlbWVudFByb3Aua2V5ZnJhbWVzLmxlbmd0aCA6IDA7XHJcbiAgICAgICAgZXhwcmVzc2lvblZhbHVlLmtleSA9IGZ1bmN0aW9uKHBvcykge1xyXG4gICAgICAgICAgICBpZiAoIWV4cHJlc3Npb25WYWx1ZS5udW1LZXlzKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gMDtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBlbGVtZW50UHJvcC5rZXlmcmFtZXNbcG9zLTFdLnQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgICAgIGV4cHJlc3Npb25WYWx1ZS52YWx1ZUF0VGltZSA9IGVsZW1lbnRQcm9wLmdldFZhbHVlQXRUaW1lO1xyXG4gICAgICAgIGV4cHJlc3Npb25WYWx1ZS5wcm9wZXJ0eUdyb3VwID0gZWxlbWVudFByb3AucHJvcGVydHlHcm91cDtcclxuICAgICAgICByZXR1cm4gZXhwcmVzc2lvblZhbHVlO1xyXG5cdH1cclxufSgpKVxuZnVuY3Rpb24gU2xpZGVyRWZmZWN0KGRhdGEsZWxlbSwgZHluYW1pY1Byb3BlcnRpZXMpe1xyXG4gICAgdGhpcy5wID0gUHJvcGVydHlGYWN0b3J5LmdldFByb3AoZWxlbSxkYXRhLnYsMCwwLGR5bmFtaWNQcm9wZXJ0aWVzKTtcclxufVxyXG5mdW5jdGlvbiBBbmdsZUVmZmVjdChkYXRhLGVsZW0sIGR5bmFtaWNQcm9wZXJ0aWVzKXtcclxuICAgIHRoaXMucCA9IFByb3BlcnR5RmFjdG9yeS5nZXRQcm9wKGVsZW0sZGF0YS52LDAsMCxkeW5hbWljUHJvcGVydGllcyk7XHJcbn1cclxuZnVuY3Rpb24gQ29sb3JFZmZlY3QoZGF0YSxlbGVtLCBkeW5hbWljUHJvcGVydGllcyl7XHJcbiAgICB0aGlzLnAgPSBQcm9wZXJ0eUZhY3RvcnkuZ2V0UHJvcChlbGVtLGRhdGEudiwxLDAsZHluYW1pY1Byb3BlcnRpZXMpO1xyXG59XHJcbmZ1bmN0aW9uIFBvaW50RWZmZWN0KGRhdGEsZWxlbSwgZHluYW1pY1Byb3BlcnRpZXMpe1xyXG4gICAgdGhpcy5wID0gUHJvcGVydHlGYWN0b3J5LmdldFByb3AoZWxlbSxkYXRhLnYsMSwwLGR5bmFtaWNQcm9wZXJ0aWVzKTtcclxufVxyXG5mdW5jdGlvbiBMYXllckluZGV4RWZmZWN0KGRhdGEsZWxlbSwgZHluYW1pY1Byb3BlcnRpZXMpe1xyXG4gICAgdGhpcy5wID0gUHJvcGVydHlGYWN0b3J5LmdldFByb3AoZWxlbSxkYXRhLnYsMCwwLGR5bmFtaWNQcm9wZXJ0aWVzKTtcclxufVxyXG5mdW5jdGlvbiBNYXNrSW5kZXhFZmZlY3QoZGF0YSxlbGVtLCBkeW5hbWljUHJvcGVydGllcyl7XHJcbiAgICB0aGlzLnAgPSBQcm9wZXJ0eUZhY3RvcnkuZ2V0UHJvcChlbGVtLGRhdGEudiwwLDAsZHluYW1pY1Byb3BlcnRpZXMpO1xyXG59XHJcbmZ1bmN0aW9uIENoZWNrYm94RWZmZWN0KGRhdGEsZWxlbSwgZHluYW1pY1Byb3BlcnRpZXMpe1xyXG4gICAgdGhpcy5wID0gUHJvcGVydHlGYWN0b3J5LmdldFByb3AoZWxlbSxkYXRhLnYsMCwwLGR5bmFtaWNQcm9wZXJ0aWVzKTtcclxufVxyXG5mdW5jdGlvbiBOb1ZhbHVlRWZmZWN0KCl7XHJcbiAgICB0aGlzLnAgPSB7fTtcclxufVxuZnVuY3Rpb24gRWZmZWN0c01hbmFnZXIoZGF0YSxlbGVtZW50LGR5bmFtaWNQcm9wZXJ0aWVzKXtcclxuICAgIHZhciBlZmZlY3RzID0gZGF0YS5lZjtcclxuICAgIHRoaXMuZWZmZWN0RWxlbWVudHMgPSBbXTtcclxuICAgIHZhciBpLGxlbiA9IGVmZmVjdHMubGVuZ3RoO1xyXG4gICAgdmFyIGVmZmVjdEl0ZW07XHJcbiAgICBmb3IoaT0wO2k8bGVuO2krKykge1xyXG4gICAgICAgIGVmZmVjdEl0ZW0gPSBuZXcgR3JvdXBFZmZlY3QoZWZmZWN0c1tpXSxlbGVtZW50LGR5bmFtaWNQcm9wZXJ0aWVzKTtcclxuICAgICAgICB0aGlzLmVmZmVjdEVsZW1lbnRzLnB1c2goZWZmZWN0SXRlbSk7XHJcbiAgICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIEdyb3VwRWZmZWN0KGRhdGEsZWxlbWVudCxkeW5hbWljUHJvcGVydGllcyl7XHJcbiAgICB0aGlzLmR5bmFtaWNQcm9wZXJ0aWVzID0gW107XHJcbiAgICB0aGlzLmluaXQoZGF0YSxlbGVtZW50LHRoaXMuZHluYW1pY1Byb3BlcnRpZXMpO1xyXG4gICAgaWYodGhpcy5keW5hbWljUHJvcGVydGllcy5sZW5ndGgpe1xyXG4gICAgICAgIGR5bmFtaWNQcm9wZXJ0aWVzLnB1c2godGhpcyk7XHJcbiAgICB9XHJcbn1cclxuXHJcbkdyb3VwRWZmZWN0LnByb3RvdHlwZS5nZXRWYWx1ZSA9IGZ1bmN0aW9uKCl7XHJcbiAgICB0aGlzLm1kZiA9IGZhbHNlO1xyXG4gICAgdmFyIGksIGxlbiA9IHRoaXMuZHluYW1pY1Byb3BlcnRpZXMubGVuZ3RoO1xyXG4gICAgZm9yKGk9MDtpPGxlbjtpKz0xKXtcclxuICAgICAgICB0aGlzLmR5bmFtaWNQcm9wZXJ0aWVzW2ldLmdldFZhbHVlKCk7XHJcbiAgICAgICAgdGhpcy5tZGYgPSB0aGlzLmR5bmFtaWNQcm9wZXJ0aWVzW2ldLm1kZiA/IHRydWUgOiB0aGlzLm1kZjtcclxuICAgIH1cclxufTtcclxuXHJcbkdyb3VwRWZmZWN0LnByb3RvdHlwZS5pbml0ID0gZnVuY3Rpb24oZGF0YSxlbGVtZW50LGR5bmFtaWNQcm9wZXJ0aWVzKXtcclxuICAgIHRoaXMuZGF0YSA9IGRhdGE7XHJcbiAgICB0aGlzLm1kZiA9IGZhbHNlO1xyXG4gICAgdGhpcy5lZmZlY3RFbGVtZW50cyA9IFtdO1xyXG4gICAgdmFyIGksIGxlbiA9IHRoaXMuZGF0YS5lZi5sZW5ndGg7XHJcbiAgICB2YXIgZWZmLCBlZmZlY3RzID0gdGhpcy5kYXRhLmVmO1xyXG4gICAgZm9yKGk9MDtpPGxlbjtpKz0xKXtcclxuICAgICAgICBzd2l0Y2goZWZmZWN0c1tpXS50eSl7XHJcbiAgICAgICAgICAgIGNhc2UgMDpcclxuICAgICAgICAgICAgICAgIGVmZiA9IG5ldyBTbGlkZXJFZmZlY3QoZWZmZWN0c1tpXSxlbGVtZW50LGR5bmFtaWNQcm9wZXJ0aWVzKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuZWZmZWN0RWxlbWVudHMucHVzaChlZmYpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgMTpcclxuICAgICAgICAgICAgICAgIGVmZiA9IG5ldyBBbmdsZUVmZmVjdChlZmZlY3RzW2ldLGVsZW1lbnQsZHluYW1pY1Byb3BlcnRpZXMpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5lZmZlY3RFbGVtZW50cy5wdXNoKGVmZik7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAyOlxyXG4gICAgICAgICAgICAgICAgZWZmID0gbmV3IENvbG9yRWZmZWN0KGVmZmVjdHNbaV0sZWxlbWVudCxkeW5hbWljUHJvcGVydGllcyk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmVmZmVjdEVsZW1lbnRzLnB1c2goZWZmKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIDM6XHJcbiAgICAgICAgICAgICAgICBlZmYgPSBuZXcgUG9pbnRFZmZlY3QoZWZmZWN0c1tpXSxlbGVtZW50LGR5bmFtaWNQcm9wZXJ0aWVzKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuZWZmZWN0RWxlbWVudHMucHVzaChlZmYpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgNDpcclxuICAgICAgICAgICAgY2FzZSA3OlxyXG4gICAgICAgICAgICAgICAgZWZmID0gbmV3IENoZWNrYm94RWZmZWN0KGVmZmVjdHNbaV0sZWxlbWVudCxkeW5hbWljUHJvcGVydGllcyk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmVmZmVjdEVsZW1lbnRzLnB1c2goZWZmKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIDEwOlxyXG4gICAgICAgICAgICAgICAgZWZmID0gbmV3IExheWVySW5kZXhFZmZlY3QoZWZmZWN0c1tpXSxlbGVtZW50LGR5bmFtaWNQcm9wZXJ0aWVzKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuZWZmZWN0RWxlbWVudHMucHVzaChlZmYpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgMTE6XHJcbiAgICAgICAgICAgICAgICBlZmYgPSBuZXcgTWFza0luZGV4RWZmZWN0KGVmZmVjdHNbaV0sZWxlbWVudCxkeW5hbWljUHJvcGVydGllcyk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmVmZmVjdEVsZW1lbnRzLnB1c2goZWZmKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIDU6XHJcbiAgICAgICAgICAgICAgICBlZmYgPSBuZXcgRWZmZWN0c01hbmFnZXIoZWZmZWN0c1tpXSxlbGVtZW50LGR5bmFtaWNQcm9wZXJ0aWVzKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuZWZmZWN0RWxlbWVudHMucHVzaChlZmYpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgNjpcclxuICAgICAgICAgICAgICAgIGVmZiA9IG5ldyBOb1ZhbHVlRWZmZWN0KGVmZmVjdHNbaV0sZWxlbWVudCxkeW5hbWljUHJvcGVydGllcyk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmVmZmVjdEVsZW1lbnRzLnB1c2goZWZmKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufTt2YXIgYm9keW1vdmluanMgPSB7fTsgZnVuY3Rpb24gcGxheShhbmltYXRpb24peyBhbmltYXRpb25NYW5hZ2VyLnBsYXkoYW5pbWF0aW9uKTsgfSBmdW5jdGlvbiBwYXVzZShhbmltYXRpb24peyBhbmltYXRpb25NYW5hZ2VyLnBhdXNlKGFuaW1hdGlvbik7IH0gZnVuY3Rpb24gdG9nZ2xlUGF1c2UoYW5pbWF0aW9uKXsgYW5pbWF0aW9uTWFuYWdlci50b2dnbGVQYXVzZShhbmltYXRpb24pOyB9IGZ1bmN0aW9uIHNldFNwZWVkKHZhbHVlLGFuaW1hdGlvbil7IGFuaW1hdGlvbk1hbmFnZXIuc2V0U3BlZWQodmFsdWUsIGFuaW1hdGlvbik7IH0gZnVuY3Rpb24gc2V0RGlyZWN0aW9uKHZhbHVlLGFuaW1hdGlvbil7IGFuaW1hdGlvbk1hbmFnZXIuc2V0RGlyZWN0aW9uKHZhbHVlLCBhbmltYXRpb24pOyB9IGZ1bmN0aW9uIHN0b3AoYW5pbWF0aW9uKXsgYW5pbWF0aW9uTWFuYWdlci5zdG9wKGFuaW1hdGlvbik7IH0gZnVuY3Rpb24gbW92ZUZyYW1lKHZhbHVlKXsgYW5pbWF0aW9uTWFuYWdlci5tb3ZlRnJhbWUodmFsdWUpOyB9IGZ1bmN0aW9uIHNlYXJjaEFuaW1hdGlvbnMoKXsgaWYoc3RhbmRhbG9uZSA9PT0gdHJ1ZSl7IGFuaW1hdGlvbk1hbmFnZXIuc2VhcmNoQW5pbWF0aW9ucyhhbmltYXRpb25EYXRhLHN0YW5kYWxvbmUsIHJlbmRlcmVyKTsgfWVsc2V7IGFuaW1hdGlvbk1hbmFnZXIuc2VhcmNoQW5pbWF0aW9ucygpOyB9IH0gZnVuY3Rpb24gcmVnaXN0ZXJBbmltYXRpb24oZWxlbSl7IHJldHVybiBhbmltYXRpb25NYW5hZ2VyLnJlZ2lzdGVyQW5pbWF0aW9uKGVsZW0pOyB9IGZ1bmN0aW9uIHJlc2l6ZSgpeyBhbmltYXRpb25NYW5hZ2VyLnJlc2l6ZSgpOyB9IGZ1bmN0aW9uIHN0YXJ0KCl7IGFuaW1hdGlvbk1hbmFnZXIuc3RhcnQoKTsgfSBmdW5jdGlvbiBnb1RvQW5kU3RvcCh2YWwsaXNGcmFtZSwgYW5pbWF0aW9uKXsgYW5pbWF0aW9uTWFuYWdlci5nb1RvQW5kU3RvcCh2YWwsaXNGcmFtZSwgYW5pbWF0aW9uKTsgfSBmdW5jdGlvbiBzZXRTdWJmcmFtZVJlbmRlcmluZyhmbGFnKXsgc3ViZnJhbWVFbmFibGVkID0gZmxhZzsgfSBmdW5jdGlvbiBsb2FkQW5pbWF0aW9uKHBhcmFtcyl7IGlmKHN0YW5kYWxvbmUgPT09IHRydWUpeyBwYXJhbXMuYW5pbWF0aW9uRGF0YSA9IEpTT04ucGFyc2UoYW5pbWF0aW9uRGF0YSk7IH0gcmV0dXJuIGFuaW1hdGlvbk1hbmFnZXIubG9hZEFuaW1hdGlvbihwYXJhbXMpOyB9IGZ1bmN0aW9uIGRlc3Ryb3koYW5pbWF0aW9uKXsgcmV0dXJuIGFuaW1hdGlvbk1hbmFnZXIuZGVzdHJveShhbmltYXRpb24pOyB9IGZ1bmN0aW9uIHNldFF1YWxpdHkodmFsdWUpeyBpZih0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKXsgc3dpdGNoKHZhbHVlKXsgY2FzZSAnaGlnaCc6IGRlZmF1bHRDdXJ2ZVNlZ21lbnRzID0gMjAwOyBicmVhazsgY2FzZSAnbWVkaXVtJzogZGVmYXVsdEN1cnZlU2VnbWVudHMgPSA1MDsgYnJlYWs7IGNhc2UgJ2xvdyc6IGRlZmF1bHRDdXJ2ZVNlZ21lbnRzID0gMTA7IGJyZWFrOyB9IH1lbHNlIGlmKCFpc05hTih2YWx1ZSkgJiYgdmFsdWUgPiAxKXsgZGVmYXVsdEN1cnZlU2VnbWVudHMgPSB2YWx1ZTsgfSBpZihkZWZhdWx0Q3VydmVTZWdtZW50cyA+PSA1MCl7IHJvdW5kVmFsdWVzKGZhbHNlKTsgfWVsc2V7IHJvdW5kVmFsdWVzKHRydWUpOyB9IH0gZnVuY3Rpb24gaW5Ccm93c2VyKCkgeyByZXR1cm4gdHlwZW9mIG5hdmlnYXRvciAhPT0gJ3VuZGVmaW5lZCc7IH0gZnVuY3Rpb24gaW5zdGFsbFBsdWdpbih0eXBlLHBsdWdpbil7IGlmKHR5cGU9PT0nZXhwcmVzc2lvbnMnKXsgZXhwcmVzc2lvbnNQbHVnaW4gPSBwbHVnaW47IH0gfSBmdW5jdGlvbiBnZXRGYWN0b3J5KG5hbWUpeyBzd2l0Y2gobmFtZSl7IGNhc2UgXCJwcm9wZXJ0eUZhY3RvcnlcIjogcmV0dXJuIFByb3BlcnR5RmFjdG9yeTtjYXNlIFwic2hhcGVQcm9wZXJ0eUZhY3RvcnlcIjogcmV0dXJuIFNoYXBlUHJvcGVydHlGYWN0b3J5OyBjYXNlIFwibWF0cml4XCI6IHJldHVybiBNYXRyaXg7IH0gfSBib2R5bW92aW5qcy5wbGF5ID0gcGxheTsgYm9keW1vdmluanMucGF1c2UgPSBwYXVzZTsgYm9keW1vdmluanMudG9nZ2xlUGF1c2UgPSB0b2dnbGVQYXVzZTsgYm9keW1vdmluanMuc2V0U3BlZWQgPSBzZXRTcGVlZDsgYm9keW1vdmluanMuc2V0RGlyZWN0aW9uID0gc2V0RGlyZWN0aW9uOyBib2R5bW92aW5qcy5zdG9wID0gc3RvcDsgYm9keW1vdmluanMubW92ZUZyYW1lID0gbW92ZUZyYW1lOyBib2R5bW92aW5qcy5zZWFyY2hBbmltYXRpb25zID0gc2VhcmNoQW5pbWF0aW9uczsgYm9keW1vdmluanMucmVnaXN0ZXJBbmltYXRpb24gPSByZWdpc3RlckFuaW1hdGlvbjsgYm9keW1vdmluanMubG9hZEFuaW1hdGlvbiA9IGxvYWRBbmltYXRpb247IGJvZHltb3ZpbmpzLnNldFN1YmZyYW1lUmVuZGVyaW5nID0gc2V0U3ViZnJhbWVSZW5kZXJpbmc7IGJvZHltb3ZpbmpzLnJlc2l6ZSA9IHJlc2l6ZTsgYm9keW1vdmluanMuc3RhcnQgPSBzdGFydDsgYm9keW1vdmluanMuZ29Ub0FuZFN0b3AgPSBnb1RvQW5kU3RvcDsgYm9keW1vdmluanMuZGVzdHJveSA9IGRlc3Ryb3k7IGJvZHltb3ZpbmpzLnNldFF1YWxpdHkgPSBzZXRRdWFsaXR5OyBib2R5bW92aW5qcy5pbkJyb3dzZXIgPSBpbkJyb3dzZXI7IGJvZHltb3ZpbmpzLmluc3RhbGxQbHVnaW4gPSBpbnN0YWxsUGx1Z2luOyBib2R5bW92aW5qcy5fX2dldEZhY3RvcnkgPSBnZXRGYWN0b3J5OyBib2R5bW92aW5qcy52ZXJzaW9uID0gJzQuOS4wJzsgZnVuY3Rpb24gY2hlY2tSZWFkeSgpeyBpZiAoZG9jdW1lbnQucmVhZHlTdGF0ZSA9PT0gXCJjb21wbGV0ZVwiKSB7IGNsZWFySW50ZXJ2YWwocmVhZHlTdGF0ZUNoZWNrSW50ZXJ2YWwpOyBzZWFyY2hBbmltYXRpb25zKCk7IH0gfSBmdW5jdGlvbiBnZXRRdWVyeVZhcmlhYmxlKHZhcmlhYmxlKSB7IHZhciB2YXJzID0gcXVlcnlTdHJpbmcuc3BsaXQoJyYnKTsgZm9yICh2YXIgaSA9IDA7IGkgPCB2YXJzLmxlbmd0aDsgaSsrKSB7IHZhciBwYWlyID0gdmFyc1tpXS5zcGxpdCgnPScpOyBpZiAoZGVjb2RlVVJJQ29tcG9uZW50KHBhaXJbMF0pID09IHZhcmlhYmxlKSB7IHJldHVybiBkZWNvZGVVUklDb21wb25lbnQocGFpclsxXSk7IH0gfSB9IHZhciBzdGFuZGFsb25lID0gJ19fW1NUQU5EQUxPTkVdX18nOyB2YXIgYW5pbWF0aW9uRGF0YSA9ICdfX1tBTklNQVRJT05EQVRBXV9fJzsgdmFyIHJlbmRlcmVyID0gJyc7IGlmKHN0YW5kYWxvbmUpIHsgdmFyIHNjcmlwdHMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnc2NyaXB0Jyk7IHZhciBpbmRleCA9IHNjcmlwdHMubGVuZ3RoIC0gMTsgdmFyIG15U2NyaXB0ID0gc2NyaXB0c1tpbmRleF0gfHwgeyBzcmM6ICcnIH07IHZhciBxdWVyeVN0cmluZyA9IG15U2NyaXB0LnNyYy5yZXBsYWNlKC9eW15cXD9dK1xcPz8vLCcnKTsgcmVuZGVyZXIgPSBnZXRRdWVyeVZhcmlhYmxlKCdyZW5kZXJlcicpOyB9IHZhciByZWFkeVN0YXRlQ2hlY2tJbnRlcnZhbCA9IHNldEludGVydmFsKGNoZWNrUmVhZHksIDEwMCk7IHJldHVybiBib2R5bW92aW5qczsgfSkpOyAgXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9ub2RlX21vZHVsZXMvYm9keW1vdmluL2J1aWxkL3BsYXllci9ib2R5bW92aW4uanNcbi8vIG1vZHVsZSBpZCA9IDFcbi8vIG1vZHVsZSBjaHVua3MgPSAwIl0sInNvdXJjZVJvb3QiOiIifQ==